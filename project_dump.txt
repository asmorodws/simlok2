
=== FILE: eslint.config.js ===
const { FlatCompat } = require("@eslint/eslintrc");
const path = require("path");

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    rules: {
      // Disable problematic rules for now
      "import/order": "off",
      "react/jsx-sort-props": "off",
      "@typescript-eslint/no-explicit-any": "off",
      "@typescript-eslint/consistent-type-imports": "off",
      "@typescript-eslint/no-unused-vars": "off",
      "react/no-unescaped-entities": "off",
      "react/self-closing-comp": "off",
      "@next/next/no-img-element": "off",
      "jsx-a11y/alt-text": "off",
      "no-console": "off",
      "react-hooks/exhaustive-deps": "off",
      
      // Keep important rules
      "react/prop-types": "off",
      "react/react-in-jsx-scope": "off",
      "prefer-const": "error",
      "no-var": "error",
      "no-debugger": "error"
    },
  },
  {
    files: ["**/*.test.{ts,tsx}", "**/*.spec.{ts,tsx}"],
    languageOptions: {
      globals: {
        jest: true,
      },
    },
  },
];

module.exports = eslintConfig;


=== FILE: extract.js ===
#!/usr/bin/env node

/**
 * Script: extract.js
 * Fungsi: Mengekstrak struktur & isi file kode Next.js ke file teks
 * Format: CommonJS (require)
 */

const fs = require("fs");
const path = require("path");

// Root project (ubah jika perlu)
const rootDir = process.cwd();

// Ekstensi file code yang ingin diambil
const allowedExt = [".js", ".jsx", ".ts", ".tsx", ".json", ".css"];

// Folder yang di-skip
const ignoredDirs = ["node_modules", ".next", ".git", "dist", "build"];

// Rekursi baca folder
function walkDir(dir, callback) {
  fs.readdirSync(dir, { withFileTypes: true }).forEach((entry) => {
    const fullPath = path.join(dir, entry.name);

    // Skip folder tertentu
    if (entry.isDirectory()) {
      if (!ignoredDirs.includes(entry.name)) {
        walkDir(fullPath, callback);
      }
    } else {
      // Ambil hanya file dengan ekstensi tertentu
      if (allowedExt.includes(path.extname(entry.name))) {
        callback(fullPath);
      }
    }
  });
}

// Dump isi proyek
function extractProject() {
  let output = "";

  walkDir(rootDir, (filePath) => {
    const relPath = path.relative(rootDir, filePath);
    const content = fs.readFileSync(filePath, "utf8");

    output += `\n=== FILE: ${relPath} ===\n`;
    output += content + "\n";
  });

  fs.writeFileSync("project_dump.txt", output, "utf8");
  console.log("✅ Ekstraksi selesai → project_dump.txt");
}

// Jalankan
extractProject();


=== FILE: middleware.ts ===
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import { getToken } from "next-auth/jwt";
import { SessionValidationService } from "@/middleware/SessionValidation";

const roleHierarchy = {
  SUPER_ADMIN: 6,
  APPROVER: 4,
  REVIEWER: 3,
  VERIFIER: 2,
  VENDOR: 1,
} as const;

type Role = keyof typeof roleHierarchy;

// mapping route prefix -> minimum role
const protectedRoutes: { prefix: string; minRole: Role }[] = [
  { prefix: "/super-admin", minRole: "SUPER_ADMIN" },
  { prefix: "/approver", minRole: "APPROVER" },
  { prefix: "/reviewer", minRole: "REVIEWER" },
  { prefix: "/verifier", minRole: "VERIFIER" },
  { prefix: "/vendor", minRole: "VENDOR" },
  { prefix: "/dashboard", minRole: "VENDOR" }, // contoh: semua role bisa akses /dashboard, nanti UI berbeda
];

export async function middleware(req: NextRequest) {
  const { pathname } = req.nextUrl;

  // Skip verification check for public paths
  if (pathname === "/verification-pending" || 
      pathname === "/login" || 
      pathname === "/signup" || 
      pathname.startsWith("/api/auth") ||
      pathname === "/") {
    return NextResponse.next();
  }

  // Session validation with auto-logout
  if (!SessionValidationService.shouldExcludePath(pathname)) {
    const sessionResult = await SessionValidationService.validateSession(req);
    if (!sessionResult.isValid && sessionResult.shouldLogout) {
      console.log(`Auto-logout triggered: ${sessionResult.reason}`);
      return SessionValidationService.createLogoutResponse(req, sessionResult.reason);
    }
  }

  // check if this path is protected
  const matched = protectedRoutes.find((r) => pathname.startsWith(r.prefix));
  if (!matched) return NextResponse.next();

  // read token (jwt) from cookie (NEXTAUTH_TOKEN)
  const token = await getToken({ 
    req, 
    secret: process.env.NEXTAUTH_SECRET || 'fallback-secret' 
  });
  if (!token) {
    const url = req.nextUrl.clone();
    url.pathname = "/login";
    url.searchParams.set("callbackUrl", req.nextUrl.pathname);
    return NextResponse.redirect(url);
  }

  // token may have role (set in callbacks.jwt)
  const userRole = (token as any).role as string | undefined;
  const verified_at = (token as any).verified_at as string | undefined;

  console.log('Middleware - pathname:', pathname);
  console.log('Middleware - userRole:', userRole);
  console.log('Middleware - verified_at:', verified_at);

  if (!userRole) {
    // forbidden
    return new NextResponse("Forbidden", { status: 403 });
  }

  // Check if user is verified (except for super admin, reviewer, and approver)
  if (userRole !== "SUPER_ADMIN" && userRole !== "REVIEWER" && userRole !== "APPROVER" && !verified_at) {
    console.log('Middleware - User not verified, redirecting to verification-pending');
    const url = req.nextUrl.clone();
    url.pathname = "/verification-pending";
    return NextResponse.redirect(url);
  }

  if (roleHierarchy[userRole as Role] < roleHierarchy[matched.minRole]) {
    return new NextResponse("Forbidden", { status: 403 });
  }

  return NextResponse.next();
}

// apply to all routes; tune matcher as needed
export const config = {
  matcher: ["/super-admin/:path*", "/approver/:path*", "/reviewer/:path*", "/verifier/:path*", "/vendor/:path*", "/dashboard/:path*", "/verification-pending"],
};


=== FILE: next-env.d.ts ===
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.


=== FILE: next.config.ts ===
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'www.w3schools.com',
        pathname: '/howto/**',
      },
    ],
  },
  typescript: {
    // !! WARN !!
    // Dangerously allow production builds to successfully complete even if
    // your project has type errors.
    // !! WARN !!
    ignoreBuildErrors: true,
  },
  // Optional: Add bundle analyzer support
  ...(process.env.ANALYZE === 'true' && {
    webpack: (config: any) => {
      if (typeof require !== 'undefined') {
        const BundleAnalyzerPlugin = require('@next/bundle-analyzer')({
          enabled: true,
        });
        config.plugins.push(new BundleAnalyzerPlugin());
      }
      return config;
    },
  }),
};

export default nextConfig;


=== FILE: package-lock.json ===
{
  "name": "simple-crud-auth",
  "version": "0.1.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "simple-crud-auth",
      "version": "0.1.0",
      "dependencies": {
        "@heroicons/react": "^2.2.0",
        "@prisma/client": "^6.13.0",
        "@socket.io/redis-adapter": "^8.3.0",
        "@types/qrcode": "^1.5.5",
        "@zxing/browser": "^0.1.5",
        "@zxing/library": "^0.21.3",
        "bcryptjs": "^3.0.2",
        "clsx": "^2.1.1",
        "date-fns": "^4.1.0",
        "ioredis": "^5.7.0",
        "lucide-react": "^0.539.0",
        "next": "15.4.6",
        "next-auth": "^4.24.11",
        "pdf-lib": "^1.17.1",
        "qrcode": "^1.5.4",
        "react": "19.1.0",
        "react-datepicker": "^8.7.0",
        "react-dom": "19.1.0",
        "socket.io": "^4.8.1",
        "socket.io-client": "^4.8.1",
        "tailwind-merge": "^3.3.1",
        "xlsx": "^0.18.5",
        "zod": "^4.0.17",
        "zustand": "^5.0.8"
      },
      "devDependencies": {
        "@eslint/eslintrc": "^3.3.1",
        "@next/bundle-analyzer": "^15.5.2",
        "@tailwindcss/postcss": "^4",
        "@types/node": "^20.19.10",
        "@types/react": "^19",
        "@types/react-dom": "^19",
        "cross-env": "^10.0.0",
        "eslint": "^9.35.0",
        "eslint-config-next": "^15.5.2",
        "prisma": "^6.13.0",
        "tailwindcss": "^4",
        "ts-node": "^10.9.2",
        "tsx": "^4.20.4",
        "typescript": "^5.9.2"
      }
    },
    "node_modules/@alloc/quick-lru": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/@alloc/quick-lru/-/quick-lru-5.2.0.tgz",
      "integrity": "sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/@babel/runtime": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/runtime/-/runtime-7.28.4.tgz",
      "integrity": "sha512-Q/N6JNWvIvPnLDvjlE1OUBLPQHH6l3CltCEsHIujp45zQUSSh8K+gHnaEX45yAT1nyngnINhvWtzN+Nb9D8RAQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@cspotcode/source-map-support": {
      "version": "0.8.1",
      "resolved": "https://registry.npmjs.org/@cspotcode/source-map-support/-/source-map-support-0.8.1.tgz",
      "integrity": "sha512-IchNf6dN4tHoMFIn/7OE8LWZ19Y6q/67Bmf6vnGREv8RSbBVb9LPJxEcnwrcwX6ixSvaiGoomAUvu4YSxXrVgw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/trace-mapping": "0.3.9"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/@cspotcode/source-map-support/node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.9.tgz",
      "integrity": "sha512-3Belt6tdc8bPgAtbcmdtNJlirVoTmEb5e2gC94PnkwEW9jI6CAHUeoG85tjWP5WquqfavoMtMwiG4P926ZKKuQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.0.3",
        "@jridgewell/sourcemap-codec": "^1.4.10"
      }
    },
    "node_modules/@discoveryjs/json-ext": {
      "version": "0.5.7",
      "resolved": "https://registry.npmjs.org/@discoveryjs/json-ext/-/json-ext-0.5.7.tgz",
      "integrity": "sha512-dBVuXR082gk3jsFp7Rd/JI4kytwGHecnCoTtXFb7DB6CNHp4rg5k1bhg0nWdLGLnOV71lmDzGQaLMy8iPLY0pw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/@emnapi/core": {
      "version": "1.5.0",
      "resolved": "https://registry.npmjs.org/@emnapi/core/-/core-1.5.0.tgz",
      "integrity": "sha512-sbP8GzB1WDzacS8fgNPpHlp6C9VZe+SJP3F90W9rLemaQj2PzIuTEl1qDOYQf58YIpyjViI24y9aPWCjEzY2cg==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/wasi-threads": "1.1.0",
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/runtime": {
      "version": "1.5.0",
      "resolved": "https://registry.npmjs.org/@emnapi/runtime/-/runtime-1.5.0.tgz",
      "integrity": "sha512-97/BJ3iXHww3djw6hYIfErCZFee7qCtrneuLa20UXFCOTCfBM2cvQHjWJ2EG0s0MtdNwInarqCTz35i4wWXHsQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/wasi-threads": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@emnapi/wasi-threads/-/wasi-threads-1.1.0.tgz",
      "integrity": "sha512-WI0DdZ8xFSbgMjR1sFsKABJ/C5OnRrjT06JXbZKexJGrDuPTzZdDYfFlsgcCXCyf+suG5QU2e/y1Wo2V/OapLQ==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@epic-web/invariant": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@epic-web/invariant/-/invariant-1.0.0.tgz",
      "integrity": "sha512-lrTPqgvfFQtR/eY/qkIzp98OGdNJu0m5ji3q/nJI8v3SXkRKEnWiOxMmbvcSoAIzv/cGiuvRy57k4suKQSAdwA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.25.10.tgz",
      "integrity": "sha512-0NFWnA+7l41irNuaSVlLfgNT12caWJVLzp5eAVhZ0z1qpxbockccEt3s+149rE64VUI3Ml2zt8Nv5JVc4QXTsw==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-arm": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.25.10.tgz",
      "integrity": "sha512-dQAxF1dW1C3zpeCDc5KqIYuZ1tgAdRXNoZP7vkBIRtKZPYe2xVr/d3SkirklCHudW1B45tGiUlz2pUWDfbDD4w==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.25.10.tgz",
      "integrity": "sha512-LSQa7eDahypv/VO6WKohZGPSJDq5OVOo3UoFR1E4t4Gj1W7zEQMUhI+lo81H+DtB+kP+tDgBp+M4oNCwp6kffg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.25.10.tgz",
      "integrity": "sha512-MiC9CWdPrfhibcXwr39p9ha1x0lZJ9KaVfvzA0Wxwz9ETX4v5CHfF09bx935nHlhi+MxhA63dKRRQLiVgSUtEg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.25.10.tgz",
      "integrity": "sha512-JC74bdXcQEpW9KkV326WpZZjLguSZ3DfS8wrrvPMHgQOIEIG/sPXEN/V8IssoJhbefLRcRqw6RQH2NnpdprtMA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.25.10.tgz",
      "integrity": "sha512-tguWg1olF6DGqzws97pKZ8G2L7Ig1vjDmGTwcTuYHbuU6TTjJe5FXbgs5C1BBzHbJ2bo1m3WkQDbWO2PvamRcg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.25.10.tgz",
      "integrity": "sha512-3ZioSQSg1HT2N05YxeJWYR+Libe3bREVSdWhEEgExWaDtyFbbXWb49QgPvFH8u03vUPX10JhJPcz7s9t9+boWg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.25.10.tgz",
      "integrity": "sha512-LLgJfHJk014Aa4anGDbh8bmI5Lk+QidDmGzuC2D+vP7mv/GeSN+H39zOf7pN5N8p059FcOfs2bVlrRr4SK9WxA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.25.10.tgz",
      "integrity": "sha512-oR31GtBTFYCqEBALI9r6WxoU/ZofZl962pouZRTEYECvNF/dtXKku8YXcJkhgK/beU+zedXfIzHijSRapJY3vg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.25.10.tgz",
      "integrity": "sha512-5luJWN6YKBsawd5f9i4+c+geYiVEw20FVW5x0v1kEMWNq8UctFjDiMATBxLvmmHA4bf7F6hTRaJgtghFr9iziQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.25.10.tgz",
      "integrity": "sha512-NrSCx2Kim3EnnWgS4Txn0QGt0Xipoumb6z6sUtl5bOEZIVKhzfyp/Lyw4C1DIYvzeW/5mWYPBFJU3a/8Yr75DQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-loong64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.25.10.tgz",
      "integrity": "sha512-xoSphrd4AZda8+rUDDfD9J6FUMjrkTz8itpTITM4/xgerAZZcFW7Dv+sun7333IfKxGG8gAq+3NbfEMJfiY+Eg==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.25.10.tgz",
      "integrity": "sha512-ab6eiuCwoMmYDyTnyptoKkVS3k8fy/1Uvq7Dj5czXI6DF2GqD2ToInBI0SHOp5/X1BdZ26RKc5+qjQNGRBelRA==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.25.10.tgz",
      "integrity": "sha512-NLinzzOgZQsGpsTkEbdJTCanwA5/wozN9dSgEl12haXJBzMTpssebuXR42bthOF3z7zXFWH1AmvWunUCkBE4EA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.25.10.tgz",
      "integrity": "sha512-FE557XdZDrtX8NMIeA8LBJX3dC2M8VGXwfrQWU7LB5SLOajfJIxmSdyL/gU1m64Zs9CBKvm4UAuBp5aJ8OgnrA==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.25.10.tgz",
      "integrity": "sha512-3BBSbgzuB9ajLoVZk0mGu+EHlBwkusRmeNYdqmznmMc9zGASFjSsxgkNsqmXugpPk00gJ0JNKh/97nxmjctdew==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.25.10.tgz",
      "integrity": "sha512-QSX81KhFoZGwenVyPoberggdW1nrQZSvfVDAIUXr3WqLRZGZqWk/P4T8p2SP+de2Sr5HPcvjhcJzEiulKgnxtA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/netbsd-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-arm64/-/netbsd-arm64-0.25.10.tgz",
      "integrity": "sha512-AKQM3gfYfSW8XRk8DdMCzaLUFB15dTrZfnX8WXQoOUpUBQ+NaAFCP1kPS/ykbbGYz7rxn0WS48/81l9hFl3u4A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.25.10.tgz",
      "integrity": "sha512-7RTytDPGU6fek/hWuN9qQpeGPBZFfB4zZgcz2VK2Z5VpdUxEI8JKYsg3JfO0n/Z1E/6l05n0unDCNc4HnhQGig==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.25.10.tgz",
      "integrity": "sha512-5Se0VM9Wtq797YFn+dLimf2Zx6McttsH2olUBsDml+lm0GOCRVebRWUvDtkY4BWYv/3NgzS8b/UM3jQNh5hYyw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.25.10.tgz",
      "integrity": "sha512-XkA4frq1TLj4bEMB+2HnI0+4RnjbuGZfet2gs/LNs5Hc7D89ZQBHQ0gL2ND6Lzu1+QVkjp3x1gIcPKzRNP8bXw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/openharmony-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/openharmony-arm64/-/openharmony-arm64-0.25.10.tgz",
      "integrity": "sha512-AVTSBhTX8Y/Fz6OmIVBip9tJzZEUcY8WLh7I59+upa5/GPhh2/aM6bvOMQySspnCCHvFi79kMtdJS1w0DXAeag==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.25.10.tgz",
      "integrity": "sha512-fswk3XT0Uf2pGJmOpDB7yknqhVkJQkAQOcW/ccVOtfx05LkbWOaRAtn5SaqXypeKQra1QaEa841PgrSL9ubSPQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.25.10.tgz",
      "integrity": "sha512-ah+9b59KDTSfpaCg6VdJoOQvKjI33nTaQr4UluQwW7aEwZQsbMCfTmfEO4VyewOxx4RaDT/xCy9ra2GPWmO7Kw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.25.10.tgz",
      "integrity": "sha512-QHPDbKkrGO8/cz9LKVnJU22HOi4pxZnZhhA2HYHez5Pz4JeffhDjf85E57Oyco163GnzNCVkZK0b/n4Y0UHcSw==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.25.10.tgz",
      "integrity": "sha512-9KpxSVFCu0iK1owoez6aC/s/EdUQLDN3adTxGCqxMVhrPDj6bt5dbrHDXUuq+Bs2vATFBBrQS5vdQ/Ed2P+nbw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@eslint-community/eslint-utils": {
      "version": "4.9.0",
      "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.9.0.tgz",
      "integrity": "sha512-ayVFHdtZ+hsq1t2Dy24wCmGXGe4q9Gu3smhLYALJrr473ZH27MsnSL+LKUlimp4BWJqMDMLmPpx/Q9R3OAlL4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "eslint-visitor-keys": "^3.4.3"
      },
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      },
      "peerDependencies": {
        "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
      "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint-community/regexpp": {
      "version": "4.12.1",
      "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.12.1.tgz",
      "integrity": "sha512-CCZCDJuduB9OUkFkY2IgppNZMi2lBQgD2qzwXkEia16cge2pijY/aXi96CJMquDMn3nJdlPV1A5KrJEXwfLNzQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
      }
    },
    "node_modules/@eslint/config-array": {
      "version": "0.21.0",
      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.21.0.tgz",
      "integrity": "sha512-ENIdc4iLu0d93HeYirvKmrzshzofPw6VkZRKQGe9Nv46ZnWUzcF1xV01dcvEg/1wXUR61OmmlSfyeyO7EvjLxQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/object-schema": "^2.1.6",
        "debug": "^4.3.1",
        "minimatch": "^3.1.2"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/config-helpers": {
      "version": "0.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.3.1.tgz",
      "integrity": "sha512-xR93k9WhrDYpXHORXpxVL5oHj3Era7wo6k/Wd8/IsQNnZUTzkGS29lyn3nAT05v6ltUuTFVCCYDEGfy2Or/sPA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/core": {
      "version": "0.15.2",
      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.15.2.tgz",
      "integrity": "sha512-78Md3/Rrxh83gCxoUc0EiciuOHsIITzLy53m3d9UyiW8y9Dj2D29FeETqyKA+BRK76tnTp6RXWb3pCay8Oyomg==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@types/json-schema": "^7.0.15"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/eslintrc": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.3.1.tgz",
      "integrity": "sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ajv": "^6.12.4",
        "debug": "^4.3.2",
        "espree": "^10.0.1",
        "globals": "^14.0.0",
        "ignore": "^5.2.0",
        "import-fresh": "^3.2.1",
        "js-yaml": "^4.1.0",
        "minimatch": "^3.1.2",
        "strip-json-comments": "^3.1.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint/js": {
      "version": "9.36.0",
      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-9.36.0.tgz",
      "integrity": "sha512-uhCbYtYynH30iZErszX78U+nR3pJU3RHGQ57NXy5QupD4SBVwDeU8TNBy+MjMngc1UyIW9noKqsRqfjQTBU2dw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      }
    },
    "node_modules/@eslint/object-schema": {
      "version": "2.1.6",
      "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-2.1.6.tgz",
      "integrity": "sha512-RBMg5FRL0I0gs51M/guSAj5/e14VQ4tpZnQNWwuDT66P14I43ItmPfIZRhO9fUVIPOAQXU47atlywZ/czoqFPA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/plugin-kit": {
      "version": "0.3.5",
      "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.3.5.tgz",
      "integrity": "sha512-Z5kJ+wU3oA7MMIqVR9tyZRtjYPr4OC004Q4Rw7pgOKUOKkJfZ3O24nz3WYfGRpMDNmcOi3TwQOmgm7B7Tpii0w==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^0.15.2",
        "levn": "^0.4.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@floating-ui/core": {
      "version": "1.7.3",
      "resolved": "https://registry.npmjs.org/@floating-ui/core/-/core-1.7.3.tgz",
      "integrity": "sha512-sGnvb5dmrJaKEZ+LDIpguvdX3bDlEllmv4/ClQ9awcmCZrlx5jQyyMWFM5kBI+EyNOCDDiKk8il0zeuX3Zlg/w==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/utils": "^0.2.10"
      }
    },
    "node_modules/@floating-ui/dom": {
      "version": "1.7.4",
      "resolved": "https://registry.npmjs.org/@floating-ui/dom/-/dom-1.7.4.tgz",
      "integrity": "sha512-OOchDgh4F2CchOX94cRVqhvy7b3AFb+/rQXyswmzmGakRfkMgoWVjfnLWkRirfLEfuD4ysVW16eXzwt3jHIzKA==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/core": "^1.7.3",
        "@floating-ui/utils": "^0.2.10"
      }
    },
    "node_modules/@floating-ui/react": {
      "version": "0.27.16",
      "resolved": "https://registry.npmjs.org/@floating-ui/react/-/react-0.27.16.tgz",
      "integrity": "sha512-9O8N4SeG2z++TSM8QA/KTeKFBVCNEz/AGS7gWPJf6KFRzmRWixFRnCnkPHRDwSVZW6QPDO6uT0P2SpWNKCc9/g==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/react-dom": "^2.1.6",
        "@floating-ui/utils": "^0.2.10",
        "tabbable": "^6.0.0"
      },
      "peerDependencies": {
        "react": ">=17.0.0",
        "react-dom": ">=17.0.0"
      }
    },
    "node_modules/@floating-ui/react-dom": {
      "version": "2.1.6",
      "resolved": "https://registry.npmjs.org/@floating-ui/react-dom/-/react-dom-2.1.6.tgz",
      "integrity": "sha512-4JX6rEatQEvlmgU80wZyq9RT96HZJa88q8hp0pBd+LrczeDI4o6uA2M+uvxngVHo4Ihr8uibXxH6+70zhAFrVw==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/dom": "^1.7.4"
      },
      "peerDependencies": {
        "react": ">=16.8.0",
        "react-dom": ">=16.8.0"
      }
    },
    "node_modules/@floating-ui/utils": {
      "version": "0.2.10",
      "resolved": "https://registry.npmjs.org/@floating-ui/utils/-/utils-0.2.10.tgz",
      "integrity": "sha512-aGTxbpbg8/b5JfU1HXSrbH3wXZuLPJcNEcZQFMxLs3oSzgtVu6nFPkbbGGUvBcUjKV2YyB9Wxxabo+HEH9tcRQ==",
      "license": "MIT"
    },
    "node_modules/@heroicons/react": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/@heroicons/react/-/react-2.2.0.tgz",
      "integrity": "sha512-LMcepvRaS9LYHJGsF0zzmgKCUim/X3N/DQKc4jepAXJ7l8QxJ1PmxJzqplF2Z3FE4PqBAIGyJAQ/w4B5dsqbtQ==",
      "license": "MIT",
      "peerDependencies": {
        "react": ">= 16 || ^19.0.0-rc"
      }
    },
    "node_modules/@humanfs/core": {
      "version": "0.19.1",
      "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.1.tgz",
      "integrity": "sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanfs/node": {
      "version": "0.16.7",
      "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.7.tgz",
      "integrity": "sha512-/zUx+yOsIrG4Y43Eh2peDeKCxlRt/gET6aHfaKpuq267qXdYDFViVHfMaLyygZOnl0kGWxFIgsBy8QFuTLUXEQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@humanfs/core": "^0.19.1",
        "@humanwhocodes/retry": "^0.4.0"
      },
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanwhocodes/module-importer": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",
      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=12.22"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@humanwhocodes/retry": {
      "version": "0.4.3",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.4.3.tgz",
      "integrity": "sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@img/colour": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@img/colour/-/colour-1.0.0.tgz",
      "integrity": "sha512-A5P/LfWGFSl6nsckYtjw9da+19jB8hkJ6ACTGcDfEJ0aE+l2n2El7dsVM7UVHZQ9s2lmYMWlrS21YLy2IR1LUw==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/@img/sharp-darwin-arm64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-arm64/-/sharp-darwin-arm64-0.34.4.tgz",
      "integrity": "sha512-sitdlPzDVyvmINUdJle3TNHl+AG9QcwiAMsXmccqsCOMZNIdW2/7S26w0LyU8euiLVzFBL3dXPwVCq/ODnf2vA==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-arm64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-darwin-x64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-x64/-/sharp-darwin-x64-0.34.4.tgz",
      "integrity": "sha512-rZheupWIoa3+SOdF/IcUe1ah4ZDpKBGWcsPX6MT0lYniH9micvIU7HQkYTfrx5Xi8u+YqwLtxC/3vl8TQN6rMg==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-x64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-arm64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-arm64/-/sharp-libvips-darwin-arm64-1.2.3.tgz",
      "integrity": "sha512-QzWAKo7kpHxbuHqUC28DZ9pIKpSi2ts2OJnoIGI26+HMgq92ZZ4vk8iJd4XsxN+tYfNJxzH6W62X5eTcsBymHw==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-x64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-x64/-/sharp-libvips-darwin-x64-1.2.3.tgz",
      "integrity": "sha512-Ju+g2xn1E2AKO6YBhxjj+ACcsPQRHT0bhpglxcEf+3uyPY+/gL8veniKoo96335ZaPo03bdDXMv0t+BBFAbmRA==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm/-/sharp-libvips-linux-arm-1.2.3.tgz",
      "integrity": "sha512-x1uE93lyP6wEwGvgAIV0gP6zmaL/a0tGzJs/BIDDG0zeBhMnuUPm7ptxGhUbcGs4okDJrk4nxgrmxpib9g6HpA==",
      "cpu": [
        "arm"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm64/-/sharp-libvips-linux-arm64-1.2.3.tgz",
      "integrity": "sha512-I4RxkXU90cpufazhGPyVujYwfIm9Nk1QDEmiIsaPwdnm013F7RIceaCc87kAH+oUB1ezqEvC6ga4m7MSlqsJvQ==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-ppc64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-ppc64/-/sharp-libvips-linux-ppc64-1.2.3.tgz",
      "integrity": "sha512-Y2T7IsQvJLMCBM+pmPbM3bKT/yYJvVtLJGfCs4Sp95SjvnFIjynbjzsa7dY1fRJX45FTSfDksbTp6AGWudiyCg==",
      "cpu": [
        "ppc64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-s390x": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-s390x/-/sharp-libvips-linux-s390x-1.2.3.tgz",
      "integrity": "sha512-RgWrs/gVU7f+K7P+KeHFaBAJlNkD1nIZuVXdQv6S+fNA6syCcoboNjsV2Pou7zNlVdNQoQUpQTk8SWDHUA3y/w==",
      "cpu": [
        "s390x"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-x64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-x64/-/sharp-libvips-linux-x64-1.2.3.tgz",
      "integrity": "sha512-3JU7LmR85K6bBiRzSUc/Ff9JBVIFVvq6bomKE0e63UXGeRw2HPVEjoJke1Yx+iU4rL7/7kUjES4dZ/81Qjhyxg==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-arm64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-arm64/-/sharp-libvips-linuxmusl-arm64-1.2.3.tgz",
      "integrity": "sha512-F9q83RZ8yaCwENw1GieztSfj5msz7GGykG/BA+MOUefvER69K/ubgFHNeSyUu64amHIYKGDs4sRCMzXVj8sEyw==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-x64": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-x64/-/sharp-libvips-linuxmusl-x64-1.2.3.tgz",
      "integrity": "sha512-U5PUY5jbc45ANM6tSJpsgqmBF/VsL6LnxJmIf11kB7J5DctHgqm0SkuXzVWtIY90GnJxKnC/JT251TDnk1fu/g==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-linux-arm": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm/-/sharp-linux-arm-0.34.4.tgz",
      "integrity": "sha512-Xyam4mlqM0KkTHYVSuc6wXRmM7LGN0P12li03jAnZ3EJWZqj83+hi8Y9UxZUbxsgsK1qOEwg7O0Bc0LjqQVtxA==",
      "cpu": [
        "arm"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linux-arm64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm64/-/sharp-linux-arm64-0.34.4.tgz",
      "integrity": "sha512-YXU1F/mN/Wu786tl72CyJjP/Ngl8mGHN1hST4BGl+hiW5jhCnV2uRVTNOcaYPs73NeT/H8Upm3y9582JVuZHrQ==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linux-ppc64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-ppc64/-/sharp-linux-ppc64-0.34.4.tgz",
      "integrity": "sha512-F4PDtF4Cy8L8hXA2p3TO6s4aDt93v+LKmpcYFLAVdkkD3hSxZzee0rh6/+94FpAynsuMpLX5h+LRsSG3rIciUQ==",
      "cpu": [
        "ppc64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-ppc64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linux-s390x": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-s390x/-/sharp-linux-s390x-0.34.4.tgz",
      "integrity": "sha512-qVrZKE9Bsnzy+myf7lFKvng6bQzhNUAYcVORq2P7bDlvmF6u2sCmK2KyEQEBdYk+u3T01pVsPrkj943T1aJAsw==",
      "cpu": [
        "s390x"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-s390x": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linux-x64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-x64/-/sharp-linux-x64-0.34.4.tgz",
      "integrity": "sha512-ZfGtcp2xS51iG79c6Vhw9CWqQC8l2Ot8dygxoDoIQPTat/Ov3qAa8qpxSrtAEAJW+UjTXc4yxCjNfxm4h6Xm2A==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-x64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linuxmusl-arm64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-arm64/-/sharp-linuxmusl-arm64-0.34.4.tgz",
      "integrity": "sha512-8hDVvW9eu4yHWnjaOOR8kHVrew1iIX+MUgwxSuH2XyYeNRtLUe4VNioSqbNkB7ZYQJj9rUTT4PyRscyk2PXFKA==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-arm64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-linuxmusl-x64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-x64/-/sharp-linuxmusl-x64-0.34.4.tgz",
      "integrity": "sha512-lU0aA5L8QTlfKjpDCEFOZsTYGn3AEiO6db8W5aQDxj0nQkVrZWmN3ZP9sYKWJdtq3PWPhUNlqehWyXpYDcI9Sg==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-x64": "1.2.3"
      }
    },
    "node_modules/@img/sharp-wasm32": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-wasm32/-/sharp-wasm32-0.34.4.tgz",
      "integrity": "sha512-33QL6ZO/qpRyG7woB/HUALz28WnTMI2W1jgX3Nu2bypqLIKx/QKMILLJzJjI+SIbvXdG9fUnmrxR7vbi1sTBeA==",
      "cpu": [
        "wasm32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later AND MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/runtime": "^1.5.0"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-arm64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-arm64/-/sharp-win32-arm64-0.34.4.tgz",
      "integrity": "sha512-2Q250do/5WXTwxW3zjsEuMSv5sUU4Tq9VThWKlU2EYLm4MB7ZeMwF+SFJutldYODXF6jzc6YEOC+VfX0SZQPqA==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-ia32": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-ia32/-/sharp-win32-ia32-0.34.4.tgz",
      "integrity": "sha512-3ZeLue5V82dT92CNL6rsal6I2weKw1cYu+rGKm8fOCCtJTR2gYeUfY3FqUnIJsMUPIH68oS5jmZ0NiJ508YpEw==",
      "cpu": [
        "ia32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-x64": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-x64/-/sharp-win32-x64-0.34.4.tgz",
      "integrity": "sha512-xIyj4wpYs8J18sVN3mSQjwrw7fKUqRw+Z5rnHNCy5fYTxigBz81u5mOMPmFumwjcn8+ld1ppptMBCLic1nz6ig==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@ioredis/commands": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/@ioredis/commands/-/commands-1.4.0.tgz",
      "integrity": "sha512-aFT2yemJJo+TZCmieA7qnYGQooOS7QfNmYrzGtsYd3g9j5iDP8AimYYAesf79ohjbLG12XxC4nG5DyEnC88AsQ==",
      "license": "MIT"
    },
    "node_modules/@isaacs/fs-minipass": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/@isaacs/fs-minipass/-/fs-minipass-4.0.1.tgz",
      "integrity": "sha512-wgm9Ehl2jpeqP3zw/7mo3kRHFp5MEDhqAdwy1fTGkHAwnkGOVsgpvQhL8B5n1qlb01jV3n/bI0ZfZp5lWA1k4w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "minipass": "^7.0.4"
      },
      "engines": {
        "node": ">=18.0.0"
      }
    },
    "node_modules/@jridgewell/gen-mapping": {
      "version": "0.3.13",
      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/remapping": {
      "version": "2.3.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/remapping/-/remapping-2.3.5.tgz",
      "integrity": "sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/gen-mapping": "^0.3.5",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.31",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",
      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.1.0",
        "@jridgewell/sourcemap-codec": "^1.4.14"
      }
    },
    "node_modules/@napi-rs/wasm-runtime": {
      "version": "0.2.12",
      "resolved": "https://registry.npmjs.org/@napi-rs/wasm-runtime/-/wasm-runtime-0.2.12.tgz",
      "integrity": "sha512-ZVWUcfwY4E/yPitQJl481FjFo3K22D6qF0DuFH6Y/nbnE11GY5uguDxZMGXPQ8WQ0128MXQD7TnfHyK4oWoIJQ==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/core": "^1.4.3",
        "@emnapi/runtime": "^1.4.3",
        "@tybys/wasm-util": "^0.10.0"
      }
    },
    "node_modules/@next/bundle-analyzer": {
      "version": "15.5.4",
      "resolved": "https://registry.npmjs.org/@next/bundle-analyzer/-/bundle-analyzer-15.5.4.tgz",
      "integrity": "sha512-wMtpIjEHi+B/wC34ZbEcacGIPgQTwTFjjp0+F742s9TxC6QwT0MwB/O0QEgalMe8s3SH/K09DO0gmTvUSJrLRA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "webpack-bundle-analyzer": "4.10.1"
      }
    },
    "node_modules/@next/env": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/env/-/env-15.4.6.tgz",
      "integrity": "sha512-yHDKVTcHrZy/8TWhj0B23ylKv5ypocuCwey9ZqPyv4rPdUdRzpGCkSi03t04KBPyU96kxVtUqx6O3nE1kpxASQ==",
      "license": "MIT"
    },
    "node_modules/@next/eslint-plugin-next": {
      "version": "15.5.4",
      "resolved": "https://registry.npmjs.org/@next/eslint-plugin-next/-/eslint-plugin-next-15.5.4.tgz",
      "integrity": "sha512-SR1vhXNNg16T4zffhJ4TS7Xn7eq4NfKfcOsRwea7RIAHrjRpI9ALYbamqIJqkAhowLlERffiwk0FMvTLNdnVtw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-glob": "3.3.1"
      }
    },
    "node_modules/@next/swc-darwin-arm64": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-darwin-arm64/-/swc-darwin-arm64-15.4.6.tgz",
      "integrity": "sha512-667R0RTP4DwxzmrqTs4Lr5dcEda9OxuZsVFsjVtxVMVhzSpo6nLclXejJVfQo2/g7/Z9qF3ETDmN3h65mTjpTQ==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-darwin-x64": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-darwin-x64/-/swc-darwin-x64-15.4.6.tgz",
      "integrity": "sha512-KMSFoistFkaiQYVQQnaU9MPWtp/3m0kn2Xed1Ces5ll+ag1+rlac20sxG+MqhH2qYWX1O2GFOATQXEyxKiIscg==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-arm64-gnu": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-15.4.6.tgz",
      "integrity": "sha512-PnOx1YdO0W7m/HWFeYd2A6JtBO8O8Eb9h6nfJia2Dw1sRHoHpNf6lN1U4GKFRzRDBi9Nq2GrHk9PF3Vmwf7XVw==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-arm64-musl": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-15.4.6.tgz",
      "integrity": "sha512-XBbuQddtY1p5FGPc2naMO0kqs4YYtLYK/8aPausI5lyOjr4J77KTG9mtlU4P3NwkLI1+OjsPzKVvSJdMs3cFaw==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-x64-gnu": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-15.4.6.tgz",
      "integrity": "sha512-+WTeK7Qdw82ez3U9JgD+igBAP75gqZ1vbK6R8PlEEuY0OIe5FuYXA4aTjL811kWPf7hNeslD4hHK2WoM9W0IgA==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-x64-musl": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-15.4.6.tgz",
      "integrity": "sha512-XP824mCbgQsK20jlXKrUpZoh/iO3vUWhMpxCz8oYeagoiZ4V0TQiKy0ASji1KK6IAe3DYGfj5RfKP6+L2020OQ==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-win32-arm64-msvc": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-15.4.6.tgz",
      "integrity": "sha512-FxrsenhUz0LbgRkNWx6FRRJIPe/MI1JRA4W4EPd5leXO00AZ6YU8v5vfx4MDXTvN77lM/EqsE3+6d2CIeF5NYg==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-win32-x64-msvc": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-15.4.6.tgz",
      "integrity": "sha512-T4ufqnZ4u88ZheczkBTtOF+eKaM14V8kbjud/XrAakoM5DKQWjW09vD6B9fsdsWS2T7D5EY31hRHdta7QKWOng==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@nodelib/fs.scandir": {
      "version": "2.1.5",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz",
      "integrity": "sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "2.0.5",
        "run-parallel": "^1.1.9"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nodelib/fs.stat": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.stat/-/fs.stat-2.0.5.tgz",
      "integrity": "sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nodelib/fs.walk": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.walk/-/fs.walk-1.2.8.tgz",
      "integrity": "sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.scandir": "2.1.5",
        "fastq": "^1.6.0"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nolyfill/is-core-module": {
      "version": "1.0.39",
      "resolved": "https://registry.npmjs.org/@nolyfill/is-core-module/-/is-core-module-1.0.39.tgz",
      "integrity": "sha512-nn5ozdjYQpUCZlWGuxcJY/KpxkWQs4DcbMCmKojjyrYDEAGy4Ce19NN4v5MduafTwJlbKc99UA8YhSVqq9yPZA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12.4.0"
      }
    },
    "node_modules/@panva/hkdf": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/@panva/hkdf/-/hkdf-1.2.1.tgz",
      "integrity": "sha512-6oclG6Y3PiDFcoyk8srjLfVKyMfVCKJ27JwNPViuXziFpmdz+MZnZN/aKY0JGXgYuO/VghU0jcOAZgWXZ1Dmrw==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/panva"
      }
    },
    "node_modules/@pdf-lib/standard-fonts": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@pdf-lib/standard-fonts/-/standard-fonts-1.0.0.tgz",
      "integrity": "sha512-hU30BK9IUN/su0Mn9VdlVKsWBS6GyhVfqjwl1FjZN4TxP6cCw0jP2w7V3Hf5uX7M0AZJ16vey9yE0ny7Sa59ZA==",
      "license": "MIT",
      "dependencies": {
        "pako": "^1.0.6"
      }
    },
    "node_modules/@pdf-lib/upng": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@pdf-lib/upng/-/upng-1.0.1.tgz",
      "integrity": "sha512-dQK2FUMQtowVP00mtIksrlZhdFXQZPC+taih1q4CvPZ5vqdxR/LKBaFg0oAfzd1GlHZXXSPdQfzQnt+ViGvEIQ==",
      "license": "MIT",
      "dependencies": {
        "pako": "^1.0.10"
      }
    },
    "node_modules/@polka/url": {
      "version": "1.0.0-next.29",
      "resolved": "https://registry.npmjs.org/@polka/url/-/url-1.0.0-next.29.tgz",
      "integrity": "sha512-wwQAWhWSuHaag8c4q/KN/vCoeOJYshAIvMQwD4GpSb3OiZklFfvAgmj0VCBBImRpuF/aFgIRzllXlVX93Jevww==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@prisma/client": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/client/-/client-6.16.2.tgz",
      "integrity": "sha512-E00PxBcalMfYO/TWnXobBVUai6eW/g5OsifWQsQDzJYm7yaY+IRLo7ZLsaefi0QkTpxfuhFcQ/w180i6kX3iJw==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "peerDependencies": {
        "prisma": "*",
        "typescript": ">=5.1.0"
      },
      "peerDependenciesMeta": {
        "prisma": {
          "optional": true
        },
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/@prisma/config": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/config/-/config-6.16.2.tgz",
      "integrity": "sha512-mKXSUrcqXj0LXWPmJsK2s3p9PN+aoAbyMx7m5E1v1FufofR1ZpPoIArjjzOIm+bJRLLvYftoNYLx1tbHgF9/yg==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "c12": "3.1.0",
        "deepmerge-ts": "7.1.5",
        "effect": "3.16.12",
        "empathic": "2.0.0"
      }
    },
    "node_modules/@prisma/debug": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/debug/-/debug-6.16.2.tgz",
      "integrity": "sha512-bo4/gA/HVV6u8YK2uY6glhNsJ7r+k/i5iQ9ny/3q5bt9ijCj7WMPUwfTKPvtEgLP+/r26Z686ly11hhcLiQ8zA==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/engines": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/engines/-/engines-6.16.2.tgz",
      "integrity": "sha512-7yf3AjfPUgsg/l7JSu1iEhsmZZ/YE00yURPjTikqm2z4btM0bCl2coFtTGfeSOWbQMmq45Jab+53yGUIAT1sjA==",
      "devOptional": true,
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.16.2",
        "@prisma/engines-version": "6.16.0-7.1c57fdcd7e44b29b9313256c76699e91c3ac3c43",
        "@prisma/fetch-engine": "6.16.2",
        "@prisma/get-platform": "6.16.2"
      }
    },
    "node_modules/@prisma/engines-version": {
      "version": "6.16.0-7.1c57fdcd7e44b29b9313256c76699e91c3ac3c43",
      "resolved": "https://registry.npmjs.org/@prisma/engines-version/-/engines-version-6.16.0-7.1c57fdcd7e44b29b9313256c76699e91c3ac3c43.tgz",
      "integrity": "sha512-ThvlDaKIVrnrv97ujNFDYiQbeMQpLa0O86HFA2mNoip4mtFqM7U5GSz2ie1i2xByZtvPztJlNRgPsXGeM/kqAA==",
      "devOptional": true,
      "license": "Apache-2.0"
    },
    "node_modules/@prisma/fetch-engine": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/fetch-engine/-/fetch-engine-6.16.2.tgz",
      "integrity": "sha512-wPnZ8DMRqpgzye758ZvfAMiNJRuYpz+rhgEBZi60ZqDIgOU2694oJxiuu3GKFeYeR/hXxso4/2oBC243t/whxQ==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.16.2",
        "@prisma/engines-version": "6.16.0-7.1c57fdcd7e44b29b9313256c76699e91c3ac3c43",
        "@prisma/get-platform": "6.16.2"
      }
    },
    "node_modules/@prisma/get-platform": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/@prisma/get-platform/-/get-platform-6.16.2.tgz",
      "integrity": "sha512-U/P36Uke5wS7r1+omtAgJpEB94tlT4SdlgaeTc6HVTTT93pXj7zZ+B/cZnmnvjcNPfWddgoDx8RLjmQwqGDYyA==",
      "devOptional": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/debug": "6.16.2"
      }
    },
    "node_modules/@rtsao/scc": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@rtsao/scc/-/scc-1.1.0.tgz",
      "integrity": "sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rushstack/eslint-patch": {
      "version": "1.12.0",
      "resolved": "https://registry.npmjs.org/@rushstack/eslint-patch/-/eslint-patch-1.12.0.tgz",
      "integrity": "sha512-5EwMtOqvJMMa3HbmxLlF74e+3/HhwBTMcvt3nqVJgGCozO6hzIPOBlwm8mGVNR9SN2IJpxSnlxczyDjcn7qIyw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@socket.io/component-emitter": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@socket.io/component-emitter/-/component-emitter-3.1.2.tgz",
      "integrity": "sha512-9BCxFwvbGg/RsZK9tjXd8s4UcwR0MWeFQ1XEKIQVVvAGJyINdrqKMcTRyLoK8Rse1GjzLV9cwjWV1olXRWEXVA==",
      "license": "MIT"
    },
    "node_modules/@socket.io/redis-adapter": {
      "version": "8.3.0",
      "resolved": "https://registry.npmjs.org/@socket.io/redis-adapter/-/redis-adapter-8.3.0.tgz",
      "integrity": "sha512-ly0cra+48hDmChxmIpnESKrc94LjRL80TEmZVscuQ/WWkRP81nNj8W8cCGMqbI4L6NCuAaPRSzZF1a9GlAxxnA==",
      "license": "MIT",
      "dependencies": {
        "debug": "~4.3.1",
        "notepack.io": "~3.0.1",
        "uid2": "1.0.0"
      },
      "engines": {
        "node": ">=10.0.0"
      },
      "peerDependencies": {
        "socket.io-adapter": "^2.5.4"
      }
    },
    "node_modules/@socket.io/redis-adapter/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/@standard-schema/spec": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/@standard-schema/spec/-/spec-1.0.0.tgz",
      "integrity": "sha512-m2bOd0f2RT9k8QJx1JN85cZYyH1RqFBdlwtkSlf4tBDYLCiiZnv1fIIwacK6cqwXavOydf0NPToMQgpKq+dVlA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/@swc/helpers": {
      "version": "0.5.15",
      "resolved": "https://registry.npmjs.org/@swc/helpers/-/helpers-0.5.15.tgz",
      "integrity": "sha512-JQ5TuMi45Owi4/BIMAJBoSQoOJu12oOk/gADqlcUL9JEdHB8vyjUSsxqeNXnmXHjYKMi2WcYtezGEEhqUI/E2g==",
      "license": "Apache-2.0",
      "dependencies": {
        "tslib": "^2.8.0"
      }
    },
    "node_modules/@tailwindcss/node": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/node/-/node-4.1.13.tgz",
      "integrity": "sha512-eq3ouolC1oEFOAvOMOBAmfCIqZBJuvWvvYWh5h5iOYfe1HFC6+GZ6EIL0JdM3/niGRJmnrOc+8gl9/HGUaaptw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/remapping": "^2.3.4",
        "enhanced-resolve": "^5.18.3",
        "jiti": "^2.5.1",
        "lightningcss": "1.30.1",
        "magic-string": "^0.30.18",
        "source-map-js": "^1.2.1",
        "tailwindcss": "4.1.13"
      }
    },
    "node_modules/@tailwindcss/oxide": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide/-/oxide-4.1.13.tgz",
      "integrity": "sha512-CPgsM1IpGRa880sMbYmG1s4xhAy3xEt1QULgTJGQmZUeNgXFR7s1YxYygmJyBGtou4SyEosGAGEeYqY7R53bIA==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "detect-libc": "^2.0.4",
        "tar": "^7.4.3"
      },
      "engines": {
        "node": ">= 10"
      },
      "optionalDependencies": {
        "@tailwindcss/oxide-android-arm64": "4.1.13",
        "@tailwindcss/oxide-darwin-arm64": "4.1.13",
        "@tailwindcss/oxide-darwin-x64": "4.1.13",
        "@tailwindcss/oxide-freebsd-x64": "4.1.13",
        "@tailwindcss/oxide-linux-arm-gnueabihf": "4.1.13",
        "@tailwindcss/oxide-linux-arm64-gnu": "4.1.13",
        "@tailwindcss/oxide-linux-arm64-musl": "4.1.13",
        "@tailwindcss/oxide-linux-x64-gnu": "4.1.13",
        "@tailwindcss/oxide-linux-x64-musl": "4.1.13",
        "@tailwindcss/oxide-wasm32-wasi": "4.1.13",
        "@tailwindcss/oxide-win32-arm64-msvc": "4.1.13",
        "@tailwindcss/oxide-win32-x64-msvc": "4.1.13"
      }
    },
    "node_modules/@tailwindcss/oxide-android-arm64": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-android-arm64/-/oxide-android-arm64-4.1.13.tgz",
      "integrity": "sha512-BrpTrVYyejbgGo57yc8ieE+D6VT9GOgnNdmh5Sac6+t0m+v+sKQevpFVpwX3pBrM2qKrQwJ0c5eDbtjouY/+ew==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-darwin-arm64": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-darwin-arm64/-/oxide-darwin-arm64-4.1.13.tgz",
      "integrity": "sha512-YP+Jksc4U0KHcu76UhRDHq9bx4qtBftp9ShK/7UGfq0wpaP96YVnnjFnj3ZFrUAjc5iECzODl/Ts0AN7ZPOANQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-darwin-x64": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-darwin-x64/-/oxide-darwin-x64-4.1.13.tgz",
      "integrity": "sha512-aAJ3bbwrn/PQHDxCto9sxwQfT30PzyYJFG0u/BWZGeVXi5Hx6uuUOQEI2Fa43qvmUjTRQNZnGqe9t0Zntexeuw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-freebsd-x64": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-freebsd-x64/-/oxide-freebsd-x64-4.1.13.tgz",
      "integrity": "sha512-Wt8KvASHwSXhKE/dJLCCWcTSVmBj3xhVhp/aF3RpAhGeZ3sVo7+NTfgiN8Vey/Fi8prRClDs6/f0KXPDTZE6nQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm-gnueabihf": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm-gnueabihf/-/oxide-linux-arm-gnueabihf-4.1.13.tgz",
      "integrity": "sha512-mbVbcAsW3Gkm2MGwA93eLtWrwajz91aXZCNSkGTx/R5eb6KpKD5q8Ueckkh9YNboU8RH7jiv+ol/I7ZyQ9H7Bw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm64-gnu": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm64-gnu/-/oxide-linux-arm64-gnu-4.1.13.tgz",
      "integrity": "sha512-wdtfkmpXiwej/yoAkrCP2DNzRXCALq9NVLgLELgLim1QpSfhQM5+ZxQQF8fkOiEpuNoKLp4nKZ6RC4kmeFH0HQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm64-musl": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm64-musl/-/oxide-linux-arm64-musl-4.1.13.tgz",
      "integrity": "sha512-hZQrmtLdhyqzXHB7mkXfq0IYbxegaqTmfa1p9MBj72WPoDD3oNOh1Lnxf6xZLY9C3OV6qiCYkO1i/LrzEdW2mg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-x64-gnu": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-x64-gnu/-/oxide-linux-x64-gnu-4.1.13.tgz",
      "integrity": "sha512-uaZTYWxSXyMWDJZNY1Ul7XkJTCBRFZ5Fo6wtjrgBKzZLoJNrG+WderJwAjPzuNZOnmdrVg260DKwXCFtJ/hWRQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-x64-musl": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-x64-musl/-/oxide-linux-x64-musl-4.1.13.tgz",
      "integrity": "sha512-oXiPj5mi4Hdn50v5RdnuuIms0PVPI/EG4fxAfFiIKQh5TgQgX7oSuDWntHW7WNIi/yVLAiS+CRGW4RkoGSSgVQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-wasm32-wasi": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-wasm32-wasi/-/oxide-wasm32-wasi-4.1.13.tgz",
      "integrity": "sha512-+LC2nNtPovtrDwBc/nqnIKYh/W2+R69FA0hgoeOn64BdCX522u19ryLh3Vf3F8W49XBcMIxSe665kwy21FkhvA==",
      "bundleDependencies": [
        "@napi-rs/wasm-runtime",
        "@emnapi/core",
        "@emnapi/runtime",
        "@tybys/wasm-util",
        "@emnapi/wasi-threads",
        "tslib"
      ],
      "cpu": [
        "wasm32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/core": "^1.4.5",
        "@emnapi/runtime": "^1.4.5",
        "@emnapi/wasi-threads": "^1.0.4",
        "@napi-rs/wasm-runtime": "^0.2.12",
        "@tybys/wasm-util": "^0.10.0",
        "tslib": "^2.8.0"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@tailwindcss/oxide-win32-arm64-msvc": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-win32-arm64-msvc/-/oxide-win32-arm64-msvc-4.1.13.tgz",
      "integrity": "sha512-dziTNeQXtoQ2KBXmrjCxsuPk3F3CQ/yb7ZNZNA+UkNTeiTGgfeh+gH5Pi7mRncVgcPD2xgHvkFCh/MhZWSgyQg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-win32-x64-msvc": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-win32-x64-msvc/-/oxide-win32-x64-msvc-4.1.13.tgz",
      "integrity": "sha512-3+LKesjXydTkHk5zXX01b5KMzLV1xl2mcktBJkje7rhFUpUlYJy7IMOLqjIRQncLTa1WZZiFY/foAeB5nmaiTw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/postcss": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/@tailwindcss/postcss/-/postcss-4.1.13.tgz",
      "integrity": "sha512-HLgx6YSFKJT7rJqh9oJs/TkBFhxuMOfUKSBEPYwV+t78POOBsdQ7crhZLzwcH3T0UyUuOzU/GK5pk5eKr3wCiQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@alloc/quick-lru": "^5.2.0",
        "@tailwindcss/node": "4.1.13",
        "@tailwindcss/oxide": "4.1.13",
        "postcss": "^8.4.41",
        "tailwindcss": "4.1.13"
      }
    },
    "node_modules/@tsconfig/node10": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/@tsconfig/node10/-/node10-1.0.11.tgz",
      "integrity": "sha512-DcRjDCujK/kCk/cUe8Xz8ZSpm8mS3mNNpta+jGCA6USEDfktlNvm1+IuZ9eTcDbNk41BHwpHHeW+N1lKCz4zOw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node12": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/@tsconfig/node12/-/node12-1.0.11.tgz",
      "integrity": "sha512-cqefuRsh12pWyGsIoBKJA9luFu3mRxCA+ORZvA4ktLSzIuCUtWVxGIuXigEwO5/ywWFMZ2QEGKWvkZG1zDMTag==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node14": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/@tsconfig/node14/-/node14-1.0.3.tgz",
      "integrity": "sha512-ysT8mhdixWK6Hw3i1V2AeRqZ5WfXg1G43mqoYlM2nc6388Fq5jcXyr5mRsqViLx/GJYdoL0bfXD8nmF+Zn/Iow==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tsconfig/node16": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/@tsconfig/node16/-/node16-1.0.4.tgz",
      "integrity": "sha512-vxhUy4J8lyeyinH7Azl1pdd43GJhZH/tP2weN8TntQblOY+A0XbT8DJk1/oCPuOOyg/Ja757rG0CgHcWC8OfMA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@tybys/wasm-util": {
      "version": "0.10.1",
      "resolved": "https://registry.npmjs.org/@tybys/wasm-util/-/wasm-util-0.10.1.tgz",
      "integrity": "sha512-9tTaPJLSiejZKx+Bmog4uSubteqTvFrVrURwkmHixBo0G4seD0zUxp98E1DzUBJxLQ3NPwXrGKDiVjwx/DpPsg==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@types/cors": {
      "version": "2.8.19",
      "resolved": "https://registry.npmjs.org/@types/cors/-/cors-2.8.19.tgz",
      "integrity": "sha512-mFNylyeyqN93lfe/9CSxOGREz8cpzAhH+E93xJ4xWQf62V8sQ/24reV2nyzUWM6H6Xji+GGHpkbLe7pVoUEskg==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json-schema": {
      "version": "7.0.15",
      "resolved": "https://registry.npmjs.org/@types/json-schema/-/json-schema-7.0.15.tgz",
      "integrity": "sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json5": {
      "version": "0.0.29",
      "resolved": "https://registry.npmjs.org/@types/json5/-/json5-0.0.29.tgz",
      "integrity": "sha512-dRLjCWHYg4oaA77cxO64oO+7JwCwnIzkZPdrrC71jQmQtlhM556pwKo5bUzqvZndkVbeFLIIi+9TC40JNF5hNQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/node": {
      "version": "20.19.17",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-20.19.17.tgz",
      "integrity": "sha512-gfehUI8N1z92kygssiuWvLiwcbOB3IRktR6hTDgJlXMYh5OvkPSRmgfoBUmfZt+vhwJtX7v1Yw4KvvAf7c5QKQ==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~6.21.0"
      }
    },
    "node_modules/@types/qrcode": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@types/qrcode/-/qrcode-1.5.5.tgz",
      "integrity": "sha512-CdfBi/e3Qk+3Z/fXYShipBT13OJ2fDO2Q2w5CIP5anLTLIndQG9z6P1cnm+8zCWSpm5dnxMFd/uREtb0EXuQzg==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/react": {
      "version": "19.1.15",
      "resolved": "https://registry.npmjs.org/@types/react/-/react-19.1.15.tgz",
      "integrity": "sha512-+kLxJpaJzXybyDyFXYADyP1cznTO8HSuBpenGlnKOAkH4hyNINiywvXS/tGJhsrGGP/gM185RA3xpjY0Yg4erA==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "csstype": "^3.0.2"
      }
    },
    "node_modules/@types/react-dom": {
      "version": "19.1.9",
      "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-19.1.9.tgz",
      "integrity": "sha512-qXRuZaOsAdXKFyOhRBg6Lqqc0yay13vN7KrIg4L7N4aaHN68ma9OK3NE1BoDFgFOTfM7zg+3/8+2n8rLUH3OKQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "^19.0.0"
      }
    },
    "node_modules/@typescript-eslint/eslint-plugin": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.44.1.tgz",
      "integrity": "sha512-molgphGqOBT7t4YKCSkbasmu1tb1MgrZ2szGzHbclF7PNmOkSTQVHy+2jXOSnxvR3+Xe1yySHFZoqMpz3TfQsw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/regexpp": "^4.10.0",
        "@typescript-eslint/scope-manager": "8.44.1",
        "@typescript-eslint/type-utils": "8.44.1",
        "@typescript-eslint/utils": "8.44.1",
        "@typescript-eslint/visitor-keys": "8.44.1",
        "graphemer": "^1.4.0",
        "ignore": "^7.0.0",
        "natural-compare": "^1.4.0",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "@typescript-eslint/parser": "^8.44.1",
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/eslint-plugin/node_modules/ignore": {
      "version": "7.0.5",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-7.0.5.tgz",
      "integrity": "sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/@typescript-eslint/parser": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/parser/-/parser-8.44.1.tgz",
      "integrity": "sha512-EHrrEsyhOhxYt8MTg4zTF+DJMuNBzWwgvvOYNj/zm1vnaD/IC5zCXFehZv94Piqa2cRFfXrTFxIvO95L7Qc/cw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/scope-manager": "8.44.1",
        "@typescript-eslint/types": "8.44.1",
        "@typescript-eslint/typescript-estree": "8.44.1",
        "@typescript-eslint/visitor-keys": "8.44.1",
        "debug": "^4.3.4"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/project-service": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/project-service/-/project-service-8.44.1.tgz",
      "integrity": "sha512-ycSa60eGg8GWAkVsKV4E6Nz33h+HjTXbsDT4FILyL8Obk5/mx4tbvCNsLf9zret3ipSumAOG89UcCs/KRaKYrA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/tsconfig-utils": "^8.44.1",
        "@typescript-eslint/types": "^8.44.1",
        "debug": "^4.3.4"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/scope-manager": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-8.44.1.tgz",
      "integrity": "sha512-NdhWHgmynpSvyhchGLXh+w12OMT308Gm25JoRIyTZqEbApiBiQHD/8xgb6LqCWCFcxFtWwaVdFsLPQI3jvhywg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.44.1",
        "@typescript-eslint/visitor-keys": "8.44.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@typescript-eslint/tsconfig-utils": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.44.1.tgz",
      "integrity": "sha512-B5OyACouEjuIvof3o86lRMvyDsFwZm+4fBOqFHccIctYgBjqR3qT39FBYGN87khcgf0ExpdCBeGKpKRhSFTjKQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/type-utils": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-8.44.1.tgz",
      "integrity": "sha512-KdEerZqHWXsRNKjF9NYswNISnFzXfXNDfPxoTh7tqohU/PRIbwTmsjGK6V9/RTYWau7NZvfo52lgVk+sJh0K3g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.44.1",
        "@typescript-eslint/typescript-estree": "8.44.1",
        "@typescript-eslint/utils": "8.44.1",
        "debug": "^4.3.4",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/types": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/types/-/types-8.44.1.tgz",
      "integrity": "sha512-Lk7uj7y9uQUOEguiDIDLYLJOrYHQa7oBiURYVFqIpGxclAFQ78f6VUOM8lI2XEuNOKNB7XuvM2+2cMXAoq4ALQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-8.44.1.tgz",
      "integrity": "sha512-qnQJ+mVa7szevdEyvfItbO5Vo+GfZ4/GZWWDRRLjrxYPkhM+6zYB2vRYwCsoJLzqFCdZT4mEqyJoyzkunsZ96A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/project-service": "8.44.1",
        "@typescript-eslint/tsconfig-utils": "8.44.1",
        "@typescript-eslint/types": "8.44.1",
        "@typescript-eslint/visitor-keys": "8.44.1",
        "debug": "^4.3.4",
        "fast-glob": "^3.3.2",
        "is-glob": "^4.0.3",
        "minimatch": "^9.0.4",
        "semver": "^7.6.0",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/brace-expansion": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.2.tgz",
      "integrity": "sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/fast-glob": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.3.tgz",
      "integrity": "sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "^2.0.2",
        "@nodelib/fs.walk": "^1.2.3",
        "glob-parent": "^5.1.2",
        "merge2": "^1.3.0",
        "micromatch": "^4.0.8"
      },
      "engines": {
        "node": ">=8.6.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/glob-parent": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
      "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/minimatch": {
      "version": "9.0.5",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz",
      "integrity": "sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^2.0.1"
      },
      "engines": {
        "node": ">=16 || 14 >=14.17"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/@typescript-eslint/utils": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/utils/-/utils-8.44.1.tgz",
      "integrity": "sha512-DpX5Fp6edTlocMCwA+mHY8Mra+pPjRZ0TfHkXI8QFelIKcbADQz1LUPNtzOFUriBB2UYqw4Pi9+xV4w9ZczHFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.7.0",
        "@typescript-eslint/scope-manager": "8.44.1",
        "@typescript-eslint/types": "8.44.1",
        "@typescript-eslint/typescript-estree": "8.44.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/visitor-keys": {
      "version": "8.44.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-8.44.1.tgz",
      "integrity": "sha512-576+u0QD+Jp3tZzvfRfxon0EA2lzcDt3lhUbsC6Lgzy9x2VR4E+JUiNyGHi5T8vk0TV+fpJ5GLG1JsJuWCaKhw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.44.1",
        "eslint-visitor-keys": "^4.2.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@unrs/resolver-binding-android-arm-eabi": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-android-arm-eabi/-/resolver-binding-android-arm-eabi-1.11.1.tgz",
      "integrity": "sha512-ppLRUgHVaGRWUx0R0Ut06Mjo9gBaBkg3v/8AxusGLhsIotbBLuRk51rAzqLC8gq6NyyAojEXglNjzf6R948DNw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@unrs/resolver-binding-android-arm64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-android-arm64/-/resolver-binding-android-arm64-1.11.1.tgz",
      "integrity": "sha512-lCxkVtb4wp1v+EoN+HjIG9cIIzPkX5OtM03pQYkG+U5O/wL53LC4QbIeazgiKqluGeVEeBlZahHalCaBvU1a2g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@unrs/resolver-binding-darwin-arm64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-darwin-arm64/-/resolver-binding-darwin-arm64-1.11.1.tgz",
      "integrity": "sha512-gPVA1UjRu1Y/IsB/dQEsp2V1pm44Of6+LWvbLc9SDk1c2KhhDRDBUkQCYVWe6f26uJb3fOK8saWMgtX8IrMk3g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@unrs/resolver-binding-darwin-x64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-darwin-x64/-/resolver-binding-darwin-x64-1.11.1.tgz",
      "integrity": "sha512-cFzP7rWKd3lZaCsDze07QX1SC24lO8mPty9vdP+YVa3MGdVgPmFc59317b2ioXtgCMKGiCLxJ4HQs62oz6GfRQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@unrs/resolver-binding-freebsd-x64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-freebsd-x64/-/resolver-binding-freebsd-x64-1.11.1.tgz",
      "integrity": "sha512-fqtGgak3zX4DCB6PFpsH5+Kmt/8CIi4Bry4rb1ho6Av2QHTREM+47y282Uqiu3ZRF5IQioJQ5qWRV6jduA+iGw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm-gnueabihf": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm-gnueabihf/-/resolver-binding-linux-arm-gnueabihf-1.11.1.tgz",
      "integrity": "sha512-u92mvlcYtp9MRKmP+ZvMmtPN34+/3lMHlyMj7wXJDeXxuM0Vgzz0+PPJNsro1m3IZPYChIkn944wW8TYgGKFHw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm-musleabihf": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm-musleabihf/-/resolver-binding-linux-arm-musleabihf-1.11.1.tgz",
      "integrity": "sha512-cINaoY2z7LVCrfHkIcmvj7osTOtm6VVT16b5oQdS4beibX2SYBwgYLmqhBjA1t51CarSaBuX5YNsWLjsqfW5Cw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm64-gnu/-/resolver-binding-linux-arm64-gnu-1.11.1.tgz",
      "integrity": "sha512-34gw7PjDGB9JgePJEmhEqBhWvCiiWCuXsL9hYphDF7crW7UgI05gyBAi6MF58uGcMOiOqSJ2ybEeCvHcq0BCmQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm64-musl/-/resolver-binding-linux-arm64-musl-1.11.1.tgz",
      "integrity": "sha512-RyMIx6Uf53hhOtJDIamSbTskA99sPHS96wxVE/bJtePJJtpdKGXO1wY90oRdXuYOGOTuqjT8ACccMc4K6QmT3w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-ppc64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-ppc64-gnu/-/resolver-binding-linux-ppc64-gnu-1.11.1.tgz",
      "integrity": "sha512-D8Vae74A4/a+mZH0FbOkFJL9DSK2R6TFPC9M+jCWYia/q2einCubX10pecpDiTmkJVUH+y8K3BZClycD8nCShA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-riscv64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-riscv64-gnu/-/resolver-binding-linux-riscv64-gnu-1.11.1.tgz",
      "integrity": "sha512-frxL4OrzOWVVsOc96+V3aqTIQl1O2TjgExV4EKgRY09AJ9leZpEg8Ak9phadbuX0BA4k8U5qtvMSQQGGmaJqcQ==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-riscv64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-riscv64-musl/-/resolver-binding-linux-riscv64-musl-1.11.1.tgz",
      "integrity": "sha512-mJ5vuDaIZ+l/acv01sHoXfpnyrNKOk/3aDoEdLO/Xtn9HuZlDD6jKxHlkN8ZhWyLJsRBxfv9GYM2utQ1SChKew==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-s390x-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-s390x-gnu/-/resolver-binding-linux-s390x-gnu-1.11.1.tgz",
      "integrity": "sha512-kELo8ebBVtb9sA7rMe1Cph4QHreByhaZ2QEADd9NzIQsYNQpt9UkM9iqr2lhGr5afh885d/cB5QeTXSbZHTYPg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-x64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-x64-gnu/-/resolver-binding-linux-x64-gnu-1.11.1.tgz",
      "integrity": "sha512-C3ZAHugKgovV5YvAMsxhq0gtXuwESUKc5MhEtjBpLoHPLYM+iuwSj3lflFwK3DPm68660rZ7G8BMcwSro7hD5w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-x64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-x64-musl/-/resolver-binding-linux-x64-musl-1.11.1.tgz",
      "integrity": "sha512-rV0YSoyhK2nZ4vEswT/QwqzqQXw5I6CjoaYMOX0TqBlWhojUf8P94mvI7nuJTeaCkkds3QE4+zS8Ko+GdXuZtA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-wasm32-wasi": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-wasm32-wasi/-/resolver-binding-wasm32-wasi-1.11.1.tgz",
      "integrity": "sha512-5u4RkfxJm+Ng7IWgkzi3qrFOvLvQYnPBmjmZQ8+szTK/b31fQCnleNl1GgEt7nIsZRIf5PLhPwT0WM+q45x/UQ==",
      "cpu": [
        "wasm32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@napi-rs/wasm-runtime": "^0.2.11"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@unrs/resolver-binding-win32-arm64-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-arm64-msvc/-/resolver-binding-win32-arm64-msvc-1.11.1.tgz",
      "integrity": "sha512-nRcz5Il4ln0kMhfL8S3hLkxI85BXs3o8EYoattsJNdsX4YUU89iOkVn7g0VHSRxFuVMdM4Q1jEpIId1Ihim/Uw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@unrs/resolver-binding-win32-ia32-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-ia32-msvc/-/resolver-binding-win32-ia32-msvc-1.11.1.tgz",
      "integrity": "sha512-DCEI6t5i1NmAZp6pFonpD5m7i6aFrpofcp4LA2i8IIq60Jyo28hamKBxNrZcyOwVOZkgsRp9O2sXWBWP8MnvIQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@unrs/resolver-binding-win32-x64-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-x64-msvc/-/resolver-binding-win32-x64-msvc-1.11.1.tgz",
      "integrity": "sha512-lrW200hZdbfRtztbygyaq/6jP6AKE8qQN2KvPcJ+x7wiD038YtnYtZ82IMNJ69GJibV7bwL3y9FgK+5w/pYt6g==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@zxing/browser": {
      "version": "0.1.5",
      "resolved": "https://registry.npmjs.org/@zxing/browser/-/browser-0.1.5.tgz",
      "integrity": "sha512-4Lmrn/il4+UNb87Gk8h1iWnhj39TASEHpd91CwwSJtY5u+wa0iH9qS0wNLAWbNVYXR66WmT5uiMhZ7oVTrKfxw==",
      "license": "MIT",
      "optionalDependencies": {
        "@zxing/text-encoding": "^0.9.0"
      },
      "peerDependencies": {
        "@zxing/library": "^0.21.0"
      }
    },
    "node_modules/@zxing/library": {
      "version": "0.21.3",
      "resolved": "https://registry.npmjs.org/@zxing/library/-/library-0.21.3.tgz",
      "integrity": "sha512-hZHqFe2JyH/ZxviJZosZjV+2s6EDSY0O24R+FQmlWZBZXP9IqMo7S3nb3+2LBWxodJQkSurdQGnqE7KXqrYgow==",
      "license": "MIT",
      "dependencies": {
        "ts-custom-error": "^3.2.1"
      },
      "engines": {
        "node": ">= 10.4.0"
      },
      "optionalDependencies": {
        "@zxing/text-encoding": "~0.9.0"
      }
    },
    "node_modules/@zxing/text-encoding": {
      "version": "0.9.0",
      "resolved": "https://registry.npmjs.org/@zxing/text-encoding/-/text-encoding-0.9.0.tgz",
      "integrity": "sha512-U/4aVJ2mxI0aDNI8Uq0wEhMgY+u4CNtEb0om3+y3+niDAsoTCOB33UF0sxpzqzdqXLqmvc+vZyAt4O8pPdfkwA==",
      "license": "(Unlicense OR Apache-2.0)",
      "optional": true
    },
    "node_modules/accepts": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",
      "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "~2.1.34",
        "negotiator": "0.6.3"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/acorn": {
      "version": "8.15.0",
      "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.15.0.tgz",
      "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "acorn": "bin/acorn"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/acorn-jsx": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/acorn-jsx/-/acorn-jsx-5.3.2.tgz",
      "integrity": "sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "acorn": "^6.0.0 || ^7.0.0 || ^8.0.0"
      }
    },
    "node_modules/acorn-walk": {
      "version": "8.3.4",
      "resolved": "https://registry.npmjs.org/acorn-walk/-/acorn-walk-8.3.4.tgz",
      "integrity": "sha512-ueEepnujpqee2o5aIYnvHU6C0A42MNdsIDeqy5BydrkuC5R1ZuUFnm27EeFJGoEHJQgn3uleRvmTXaJgfXbt4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "acorn": "^8.11.0"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/adler-32": {
      "version": "1.3.1",
      "resolved": "https://registry.npmjs.org/adler-32/-/adler-32-1.3.1.tgz",
      "integrity": "sha512-ynZ4w/nUUv5rrsR8UUGoe1VC9hZj6V5hU9Qw1HlMDJGEJw5S7TfTErWTjMys6M7vr0YWcPqs3qAr4ss0nDfP+A==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/ajv": {
      "version": "6.12.6",
      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",
      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-deep-equal": "^3.1.1",
        "fast-json-stable-stringify": "^2.0.0",
        "json-schema-traverse": "^0.4.1",
        "uri-js": "^4.2.2"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/epoberezkin"
      }
    },
    "node_modules/ansi-regex": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/ansi-styles": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
      "license": "MIT",
      "dependencies": {
        "color-convert": "^2.0.1"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/arg": {
      "version": "4.1.3",
      "resolved": "https://registry.npmjs.org/arg/-/arg-4.1.3.tgz",
      "integrity": "sha512-58S9QDqG0Xx27YwPSt9fJxivjYl432YCwfDMfZ+71RAqUrZef7LrKQZ3LHLOwCS4FLNBplP533Zx895SeOCHvA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/argparse": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz",
      "integrity": "sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==",
      "dev": true,
      "license": "Python-2.0"
    },
    "node_modules/aria-query": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/aria-query/-/aria-query-5.3.2.tgz",
      "integrity": "sha512-COROpnaoap1E2F000S62r6A60uHZnmlvomhfyT2DlTcrY1OrBKn2UhH7qn5wTC9zMvD0AY7csdPSNwKP+7WiQw==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/array-buffer-byte-length": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/array-buffer-byte-length/-/array-buffer-byte-length-1.0.2.tgz",
      "integrity": "sha512-LHE+8BuR7RYGDKvnrmcuSq3tDcKv9OFEXQt/HpbZhY7V6h0zlUXutnAD82GiFx9rdieCMjkvtcsPqBwgUl1Iiw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "is-array-buffer": "^3.0.5"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array-includes": {
      "version": "3.1.9",
      "resolved": "https://registry.npmjs.org/array-includes/-/array-includes-3.1.9.tgz",
      "integrity": "sha512-FmeCCAenzH0KH381SPT5FZmiA/TmpndpcaShhfgEN9eCVjnFBqq3l1xrI42y8+PPLI6hypzou4GXw00WHmPBLQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.24.0",
        "es-object-atoms": "^1.1.1",
        "get-intrinsic": "^1.3.0",
        "is-string": "^1.1.1",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.findlast": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/array.prototype.findlast/-/array.prototype.findlast-1.2.5.tgz",
      "integrity": "sha512-CVvd6FHg1Z3POpBLxO6E6zr+rSKEQ9L6rZHAaY7lLfhKsWYUBBOuMs0e9o24oopj6H+geRCX0YJ+TJLBK2eHyQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.findlastindex": {
      "version": "1.2.6",
      "resolved": "https://registry.npmjs.org/array.prototype.findlastindex/-/array.prototype.findlastindex-1.2.6.tgz",
      "integrity": "sha512-F/TKATkzseUExPlfvmwQKGITM3DGTK+vkAsCZoDc5daVygbJBnjEUCbgkAvVFsgfXfX4YIqZ/27G3k3tdXrTxQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.9",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "es-shim-unscopables": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.flat": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/array.prototype.flat/-/array.prototype.flat-1.3.3.tgz",
      "integrity": "sha512-rwG/ja1neyLqCuGZ5YYrznA62D4mZXg0i1cIskIUKSiqF3Cje9/wXAls9B9s1Wa2fomMsIv8czB8jZcPmxCXFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.flatmap": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/array.prototype.flatmap/-/array.prototype.flatmap-1.3.3.tgz",
      "integrity": "sha512-Y7Wt51eKJSyi80hFrJCePGGNo5ktJCslFuboqJsbf57CCPcm5zztluPlc4/aD8sWsKvlwatezpV4U1efk8kpjg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.tosorted": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/array.prototype.tosorted/-/array.prototype.tosorted-1.1.4.tgz",
      "integrity": "sha512-p6Fx8B7b7ZhL/gmUsAy0D15WhvDccw3mnGNbZpi3pmeJdxtWsj2jEaI4Y6oo3XiHfzuSgPwKc04MYt6KgvC/wA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.3",
        "es-errors": "^1.3.0",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/arraybuffer.prototype.slice": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/arraybuffer.prototype.slice/-/arraybuffer.prototype.slice-1.0.4.tgz",
      "integrity": "sha512-BNoCY6SXXPQ7gF2opIP4GBE+Xw7U+pHMYKuzjgCN3GwiaIR09UUeKfheyIry77QtrCBlC0KK0q5/TER/tYh3PQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-buffer-byte-length": "^1.0.1",
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "is-array-buffer": "^3.0.4"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/ast-types-flow": {
      "version": "0.0.8",
      "resolved": "https://registry.npmjs.org/ast-types-flow/-/ast-types-flow-0.0.8.tgz",
      "integrity": "sha512-OH/2E5Fg20h2aPrbe+QL8JZQFko0YZaF+j4mnQ7BGhfavO7OpSLa8a0y9sBwomHdSbkhTS8TQNayBfnW5DwbvQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/async-function": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/async-function/-/async-function-1.0.0.tgz",
      "integrity": "sha512-hsU18Ae8CDTR6Kgu9DYf0EbCr/a5iGL0rytQDobUcdpYOKokk8LEjVphnXkDkgpi0wYVsqrXuP0bZxJaTqdgoA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/available-typed-arrays": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/available-typed-arrays/-/available-typed-arrays-1.0.7.tgz",
      "integrity": "sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "possible-typed-array-names": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/axe-core": {
      "version": "4.10.3",
      "resolved": "https://registry.npmjs.org/axe-core/-/axe-core-4.10.3.tgz",
      "integrity": "sha512-Xm7bpRXnDSX2YE2YFfBk2FnF0ep6tmG7xPh8iHee8MIcrgq762Nkce856dYtJYLkuIoYZvGfTs/PbZhideTcEg==",
      "dev": true,
      "license": "MPL-2.0",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/axobject-query": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/axobject-query/-/axobject-query-4.1.0.tgz",
      "integrity": "sha512-qIj0G9wZbMGNLjLmg1PT6v2mE9AH2zlnADJD/2tC6E00hgmhUOfEB6greHPAfLRSufHqROIUTkw6E+M3lH0PTQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/balanced-match": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.2.tgz",
      "integrity": "sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/base64id": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/base64id/-/base64id-2.0.0.tgz",
      "integrity": "sha512-lGe34o6EHj9y3Kts9R4ZYs/Gr+6N7MCaMlIFA3F1R2O5/m7K06AxfSeO5530PEERE6/WyEg3lsuyw4GHlPZHog==",
      "license": "MIT",
      "engines": {
        "node": "^4.5.0 || >= 5.9"
      }
    },
    "node_modules/bcryptjs": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/bcryptjs/-/bcryptjs-3.0.2.tgz",
      "integrity": "sha512-k38b3XOZKv60C4E2hVsXTolJWfkGRMbILBIe2IBITXciy5bOsTKot5kDrf3ZfufQtQOUN5mXceUEpU1rTl9Uog==",
      "license": "BSD-3-Clause",
      "bin": {
        "bcrypt": "bin/bcrypt"
      }
    },
    "node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/braces": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/braces/-/braces-3.0.3.tgz",
      "integrity": "sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fill-range": "^7.1.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/c12": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/c12/-/c12-3.1.0.tgz",
      "integrity": "sha512-uWoS8OU1MEIsOv8p/5a82c3H31LsWVR5qiyXVfBNOzfffjUWtPnhAb4BYI2uG2HfGmZmFjCtui5XNWaps+iFuw==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "chokidar": "^4.0.3",
        "confbox": "^0.2.2",
        "defu": "^6.1.4",
        "dotenv": "^16.6.1",
        "exsolve": "^1.0.7",
        "giget": "^2.0.0",
        "jiti": "^2.4.2",
        "ohash": "^2.0.11",
        "pathe": "^2.0.3",
        "perfect-debounce": "^1.0.0",
        "pkg-types": "^2.2.0",
        "rc9": "^2.1.2"
      },
      "peerDependencies": {
        "magicast": "^0.3.5"
      },
      "peerDependenciesMeta": {
        "magicast": {
          "optional": true
        }
      }
    },
    "node_modules/call-bind": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/call-bind/-/call-bind-1.0.8.tgz",
      "integrity": "sha512-oKlSFMcMwpUg2ednkhQ454wfWiU/ul3CkJe/PEHcTKuiX6RpbehUiFMXu13HalGZxfUwCQzZG747YXBn1im9ww==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.0",
        "es-define-property": "^1.0.0",
        "get-intrinsic": "^1.2.4",
        "set-function-length": "^1.2.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/callsites": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/callsites/-/callsites-3.1.0.tgz",
      "integrity": "sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/camelcase": {
      "version": "5.3.1",
      "resolved": "https://registry.npmjs.org/camelcase/-/camelcase-5.3.1.tgz",
      "integrity": "sha512-L28STB170nwWS63UjtlEOE3dldQApaJXZkOI1uMFfzf3rRuPegHaHesyee+YxQ+W6SvRDQV6UrdOdRiR153wJg==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/caniuse-lite": {
      "version": "1.0.30001745",
      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001745.tgz",
      "integrity": "sha512-ywt6i8FzvdgrrrGbr1jZVObnVv6adj+0if2/omv9cmR2oiZs30zL4DIyaptKcbOrBdOIc74QTMoJvSE2QHh5UQ==",
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "CC-BY-4.0"
    },
    "node_modules/cfb": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/cfb/-/cfb-1.2.2.tgz",
      "integrity": "sha512-KfdUZsSOw19/ObEWasvBP/Ac4reZvAGauZhs6S/gqNhXhI7cKwvlH7ulj+dOEYnca4bm4SGo8C1bTAQvnTjgQA==",
      "license": "Apache-2.0",
      "dependencies": {
        "adler-32": "~1.3.0",
        "crc-32": "~1.2.0"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/chalk": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz",
      "integrity": "sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ansi-styles": "^4.1.0",
        "supports-color": "^7.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/chalk?sponsor=1"
      }
    },
    "node_modules/chokidar": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/chokidar/-/chokidar-4.0.3.tgz",
      "integrity": "sha512-Qgzu8kfBvo+cA4962jnP1KkS6Dop5NS6g7R5LFYJr4b8Ub94PPQXUksCw9PvXoeXPRRddRNC5C1JQUR2SMGtnA==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "readdirp": "^4.0.1"
      },
      "engines": {
        "node": ">= 14.16.0"
      },
      "funding": {
        "url": "https://paulmillr.com/funding/"
      }
    },
    "node_modules/chownr": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/chownr/-/chownr-3.0.0.tgz",
      "integrity": "sha512-+IxzY9BZOQd/XuYPRmrvEVjF/nqj5kgT4kEq7VofrDoM1MxoRjEWkrCC3EtLi59TVawxTAn+orJwFQcrqEN1+g==",
      "dev": true,
      "license": "BlueOak-1.0.0",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/citty": {
      "version": "0.1.6",
      "resolved": "https://registry.npmjs.org/citty/-/citty-0.1.6.tgz",
      "integrity": "sha512-tskPPKEs8D2KPafUypv2gxwJP8h/OaJmC82QQGGDQcHvXX43xF2VDACcJVmZ0EuSxkpO9Kc4MlrA3q0+FG58AQ==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "consola": "^3.2.3"
      }
    },
    "node_modules/client-only": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/client-only/-/client-only-0.0.1.tgz",
      "integrity": "sha512-IV3Ou0jSMzZrd3pZ48nLkT9DA7Ag1pnPzaiQhpW7c3RbcqqzvzzVu+L8gfqMp/8IM2MQtSiqaCxrrcfu8I8rMA==",
      "license": "MIT"
    },
    "node_modules/cliui": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/cliui/-/cliui-6.0.0.tgz",
      "integrity": "sha512-t6wbgtoCXvAzst7QgXxJYqPt0usEfbgQdftEPbLL/cvv6HPE5VgvqCuAIDR0NgU52ds6rFwqrgakNLrHEjCbrQ==",
      "license": "ISC",
      "dependencies": {
        "string-width": "^4.2.0",
        "strip-ansi": "^6.0.0",
        "wrap-ansi": "^6.2.0"
      }
    },
    "node_modules/clsx": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz",
      "integrity": "sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/cluster-key-slot": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/cluster-key-slot/-/cluster-key-slot-1.1.2.tgz",
      "integrity": "sha512-RMr0FhtfXemyinomL4hrWcYJxmX6deFdCxpJzhDttxgO1+bcCnkk+9drydLVDmAMG7NE6aN/fl4F7ucU/90gAA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/codepage": {
      "version": "1.15.0",
      "resolved": "https://registry.npmjs.org/codepage/-/codepage-1.15.0.tgz",
      "integrity": "sha512-3g6NUTPd/YtuuGrhMnOMRjFc+LJw/bnMp3+0r/Wcz3IXUuCosKRJvMphm5+Q+bvTVGcJJuRvVLuYba+WojaFaA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "license": "MIT",
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "license": "MIT"
    },
    "node_modules/commander": {
      "version": "7.2.0",
      "resolved": "https://registry.npmjs.org/commander/-/commander-7.2.0.tgz",
      "integrity": "sha512-QrWXB+ZQSVPmIWIhtEO9H+gwHaMGYiF5ChvoJ+K9ZGHG/sVsa6yiesAD1GC/x46sET00Xlwo1u49RVVVzvcSkw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/concat-map": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
      "integrity": "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/confbox": {
      "version": "0.2.2",
      "resolved": "https://registry.npmjs.org/confbox/-/confbox-0.2.2.tgz",
      "integrity": "sha512-1NB+BKqhtNipMsov4xI/NnhCKp9XG9NamYp5PVm9klAT0fsrNPjaFICsCFhNhwZJKNh7zB/3q8qXz0E9oaMNtQ==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/consola": {
      "version": "3.4.2",
      "resolved": "https://registry.npmjs.org/consola/-/consola-3.4.2.tgz",
      "integrity": "sha512-5IKcdX0nnYavi6G7TtOhwkYzyjfJlatbjMjuLSfE2kYT5pMDOilZ4OvMhi637CcDICTmz3wARPoyhqyX1Y+XvA==",
      "devOptional": true,
      "license": "MIT",
      "engines": {
        "node": "^14.18.0 || >=16.10.0"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.2.tgz",
      "integrity": "sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cors": {
      "version": "2.8.5",
      "resolved": "https://registry.npmjs.org/cors/-/cors-2.8.5.tgz",
      "integrity": "sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g==",
      "license": "MIT",
      "dependencies": {
        "object-assign": "^4",
        "vary": "^1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/crc-32": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/crc-32/-/crc-32-1.2.2.tgz",
      "integrity": "sha512-ROmzCKrTnOwybPcJApAA6WBWij23HVfGVNKqqrZpuyZOHqK2CwHSvpGuyt/UNNvaIjEd8X5IFGp4Mh+Ie1IHJQ==",
      "license": "Apache-2.0",
      "bin": {
        "crc32": "bin/crc32.njs"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/create-require": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/create-require/-/create-require-1.1.1.tgz",
      "integrity": "sha512-dcKFX3jn0MpIaXjisoRvexIJVEKzaq7z2rZKxf+MSr9TkdmHmsU4m2lcLojrj/FHl8mk5VxMmYA+ftRkP/3oKQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/cross-env": {
      "version": "10.0.0",
      "resolved": "https://registry.npmjs.org/cross-env/-/cross-env-10.0.0.tgz",
      "integrity": "sha512-aU8qlEK/nHYtVuN4p7UQgAwVljzMg8hB4YK5ThRqD2l/ziSnryncPNn7bMLt5cFYsKVKBh8HqLqyCoTupEUu7Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@epic-web/invariant": "^1.0.0",
        "cross-spawn": "^7.0.6"
      },
      "bin": {
        "cross-env": "dist/bin/cross-env.js",
        "cross-env-shell": "dist/bin/cross-env-shell.js"
      },
      "engines": {
        "node": ">=20"
      }
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/csstype": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz",
      "integrity": "sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/damerau-levenshtein": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/damerau-levenshtein/-/damerau-levenshtein-1.0.8.tgz",
      "integrity": "sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==",
      "dev": true,
      "license": "BSD-2-Clause"
    },
    "node_modules/data-view-buffer": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/data-view-buffer/-/data-view-buffer-1.0.2.tgz",
      "integrity": "sha512-EmKO5V3OLXh1rtK2wgXRansaK1/mtVdTUEiEI0W8RkvgT05kfxaH29PliLnpLP73yYO6142Q72QNa8Wx/A5CqQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/data-view-byte-length": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/data-view-byte-length/-/data-view-byte-length-1.0.2.tgz",
      "integrity": "sha512-tuhGbE6CfTM9+5ANGf+oQb72Ky/0+s3xKUpHvShfiz2RxMFgFPjsXuRLBVMtvMs15awe45SRb83D6wH4ew6wlQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/inspect-js"
      }
    },
    "node_modules/data-view-byte-offset": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/data-view-byte-offset/-/data-view-byte-offset-1.0.1.tgz",
      "integrity": "sha512-BS8PfmtDGnrgYdOonGZQdLZslWIeCGFP9tpan0hi1Co2Zr2NKADsvGYA8XxuG/4UWgJ6Cjtv+YJnB6MM69QGlQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/date-fns": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/date-fns/-/date-fns-4.1.0.tgz",
      "integrity": "sha512-Ukq0owbQXxa/U3EGtsdVBkR1w7KOQ5gIBqdH2hkvknzZPYvBxb/aa6E8L7tmjFtkwZBu3UXBbjIgPo/Ez4xaNg==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/kossnocorp"
      }
    },
    "node_modules/debounce": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/debounce/-/debounce-1.2.1.tgz",
      "integrity": "sha512-XRRe6Glud4rd/ZGQfiV1ruXSfbvfJedlV9Y6zOlP+2K04vBYiJEte6stfFkCP03aMnY5tsipamumUjL14fofug==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/decamelize": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/decamelize/-/decamelize-1.2.0.tgz",
      "integrity": "sha512-z2S+W9X73hAUUki+N+9Za2lBlun89zigOyGrsax+KUQ6wKW4ZoWpEYBkGhQjwAjjDCkWxhY0VKEhk8wzY7F5cA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/deep-is": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz",
      "integrity": "sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/deepmerge-ts": {
      "version": "7.1.5",
      "resolved": "https://registry.npmjs.org/deepmerge-ts/-/deepmerge-ts-7.1.5.tgz",
      "integrity": "sha512-HOJkrhaYsweh+W+e74Yn7YStZOilkoPb6fycpwNLKzSPtruFs48nYis0zy5yJz1+ktUhHxoRDJ27RQAWLIJVJw==",
      "devOptional": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=16.0.0"
      }
    },
    "node_modules/define-data-property": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/define-data-property/-/define-data-property-1.1.4.tgz",
      "integrity": "sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-define-property": "^1.0.0",
        "es-errors": "^1.3.0",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/define-properties": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/define-properties/-/define-properties-1.2.1.tgz",
      "integrity": "sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.0.1",
        "has-property-descriptors": "^1.0.0",
        "object-keys": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/defu": {
      "version": "6.1.4",
      "resolved": "https://registry.npmjs.org/defu/-/defu-6.1.4.tgz",
      "integrity": "sha512-mEQCMmwJu317oSz8CwdIOdwf3xMif1ttiM8LTufzc3g6kR+9Pe236twL8j3IYT1F7GfRgGcW6MWxzZjLIkuHIg==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/denque": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/denque/-/denque-2.1.0.tgz",
      "integrity": "sha512-HVQE3AAb/pxF8fQAoiqpvg9i3evqug3hoiwakOyZAwJm+6vZehbkYXZ0l4JxS+I3QxM97v5aaRNhj8v5oBhekw==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/destr": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/destr/-/destr-2.0.5.tgz",
      "integrity": "sha512-ugFTXCtDZunbzasqBxrK93Ik/DRYsO6S/fedkWEMKqt04xZ4csmnmwGDBAb07QWNaGMAmnTIemsYZCksjATwsA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/detect-libc": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/detect-libc/-/detect-libc-2.1.1.tgz",
      "integrity": "sha512-ecqj/sy1jcK1uWrwpR67UhYrIFQ+5WlGxth34WquCbamhFA6hkkwiu37o6J5xCHdo1oixJRfVRw+ywV+Hq/0Aw==",
      "devOptional": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/diff": {
      "version": "4.0.2",
      "resolved": "https://registry.npmjs.org/diff/-/diff-4.0.2.tgz",
      "integrity": "sha512-58lmxKSA4BNyLz+HHMUzlOEpg09FV+ev6ZMe3vJihgdxzgcwZ8VoEEPmALCZG9LmqfVoNMMKpttIYTVG6uDY7A==",
      "dev": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.3.1"
      }
    },
    "node_modules/dijkstrajs": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/dijkstrajs/-/dijkstrajs-1.0.3.tgz",
      "integrity": "sha512-qiSlmBq9+BCdCA/L46dw8Uy93mloxsPSbwnm5yrKn2vMPiy8KyAskTF6zuV/j5BMsmOGZDPs7KjU+mjb670kfA==",
      "license": "MIT"
    },
    "node_modules/doctrine": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/doctrine/-/doctrine-2.1.0.tgz",
      "integrity": "sha512-35mSku4ZXK0vfCuHEDAwt55dg2jNajHZ1odvF+8SSr82EsZY4QmXfuWso8oEd8zRhVObSN18aM0CjSdoBX7zIw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "esutils": "^2.0.2"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/dotenv": {
      "version": "16.6.1",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-16.6.1.tgz",
      "integrity": "sha512-uBq4egWHTcTt33a72vpSG0z3HnPuIl6NqYcTrKEg2azoEyl2hpW0zqlxysq2pK9HlDIHyHyakeYaYnSAwd8bow==",
      "devOptional": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/duplexer": {
      "version": "0.1.2",
      "resolved": "https://registry.npmjs.org/duplexer/-/duplexer-0.1.2.tgz",
      "integrity": "sha512-jtD6YG370ZCIi/9GTaJKQxWTZD045+4R4hTk/x1UyoqadyJ9x9CgSi1RlVDQF8U2sxLLSnFkCaMihqljHIWgMg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/effect": {
      "version": "3.16.12",
      "resolved": "https://registry.npmjs.org/effect/-/effect-3.16.12.tgz",
      "integrity": "sha512-N39iBk0K71F9nb442TLbTkjl24FLUzuvx2i1I2RsEAQsdAdUTuUoW0vlfUXgkMTUOnYqKnWcFfqw4hK4Pw27hg==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "@standard-schema/spec": "^1.0.0",
        "fast-check": "^3.23.1"
      }
    },
    "node_modules/emoji-regex": {
      "version": "9.2.2",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
      "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/empathic": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/empathic/-/empathic-2.0.0.tgz",
      "integrity": "sha512-i6UzDscO/XfAcNYD75CfICkmfLedpyPDdozrLMmQc5ORaQcdMoc21OnlEylMIqI7U8eniKrPMxxtj8k0vhmJhA==",
      "devOptional": true,
      "license": "MIT",
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/engine.io": {
      "version": "6.6.4",
      "resolved": "https://registry.npmjs.org/engine.io/-/engine.io-6.6.4.tgz",
      "integrity": "sha512-ZCkIjSYNDyGn0R6ewHDtXgns/Zre/NT6Agvq1/WobF7JXgFff4SeDroKiCO3fNJreU9YG429Sc81o4w5ok/W5g==",
      "license": "MIT",
      "dependencies": {
        "@types/cors": "^2.8.12",
        "@types/node": ">=10.0.0",
        "accepts": "~1.3.4",
        "base64id": "2.0.0",
        "cookie": "~0.7.2",
        "cors": "~2.8.5",
        "debug": "~4.3.1",
        "engine.io-parser": "~5.2.1",
        "ws": "~8.17.1"
      },
      "engines": {
        "node": ">=10.2.0"
      }
    },
    "node_modules/engine.io-client": {
      "version": "6.6.3",
      "resolved": "https://registry.npmjs.org/engine.io-client/-/engine.io-client-6.6.3.tgz",
      "integrity": "sha512-T0iLjnyNWahNyv/lcjS2y4oE358tVS/SYQNxYXGAJ9/GLgH4VCvOQ/mhTjqU88mLZCQgiG8RIegFHYCdVC+j5w==",
      "license": "MIT",
      "dependencies": {
        "@socket.io/component-emitter": "~3.1.0",
        "debug": "~4.3.1",
        "engine.io-parser": "~5.2.1",
        "ws": "~8.17.1",
        "xmlhttprequest-ssl": "~2.1.1"
      }
    },
    "node_modules/engine.io-client/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/engine.io-parser": {
      "version": "5.2.3",
      "resolved": "https://registry.npmjs.org/engine.io-parser/-/engine.io-parser-5.2.3.tgz",
      "integrity": "sha512-HqD3yTBfnBxIrbnM1DoD6Pcq8NECnh8d4As1Qgh0z5Gg3jRRIqijury0CL3ghu/edArpUYiYqQiDUQBIs4np3Q==",
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/engine.io/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/enhanced-resolve": {
      "version": "5.18.3",
      "resolved": "https://registry.npmjs.org/enhanced-resolve/-/enhanced-resolve-5.18.3.tgz",
      "integrity": "sha512-d4lC8xfavMeBjzGr2vECC3fsGXziXZQyJxD868h2M/mBI3PwAuODxAkLkq5HYuvrPYcUtiLzsTo8U3PgX3Ocww==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "graceful-fs": "^4.2.4",
        "tapable": "^2.2.0"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/es-abstract": {
      "version": "1.24.0",
      "resolved": "https://registry.npmjs.org/es-abstract/-/es-abstract-1.24.0.tgz",
      "integrity": "sha512-WSzPgsdLtTcQwm4CROfS5ju2Wa1QQcVeT37jFjYzdFz1r9ahadC8B8/a4qxJxM+09F18iumCdRmlr96ZYkQvEg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-buffer-byte-length": "^1.0.2",
        "arraybuffer.prototype.slice": "^1.0.4",
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "data-view-buffer": "^1.0.2",
        "data-view-byte-length": "^1.0.2",
        "data-view-byte-offset": "^1.0.1",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "es-set-tostringtag": "^2.1.0",
        "es-to-primitive": "^1.3.0",
        "function.prototype.name": "^1.1.8",
        "get-intrinsic": "^1.3.0",
        "get-proto": "^1.0.1",
        "get-symbol-description": "^1.1.0",
        "globalthis": "^1.0.4",
        "gopd": "^1.2.0",
        "has-property-descriptors": "^1.0.2",
        "has-proto": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "internal-slot": "^1.1.0",
        "is-array-buffer": "^3.0.5",
        "is-callable": "^1.2.7",
        "is-data-view": "^1.0.2",
        "is-negative-zero": "^2.0.3",
        "is-regex": "^1.2.1",
        "is-set": "^2.0.3",
        "is-shared-array-buffer": "^1.0.4",
        "is-string": "^1.1.1",
        "is-typed-array": "^1.1.15",
        "is-weakref": "^1.1.1",
        "math-intrinsics": "^1.1.0",
        "object-inspect": "^1.13.4",
        "object-keys": "^1.1.1",
        "object.assign": "^4.1.7",
        "own-keys": "^1.0.1",
        "regexp.prototype.flags": "^1.5.4",
        "safe-array-concat": "^1.1.3",
        "safe-push-apply": "^1.0.0",
        "safe-regex-test": "^1.1.0",
        "set-proto": "^1.0.0",
        "stop-iteration-iterator": "^1.1.0",
        "string.prototype.trim": "^1.2.10",
        "string.prototype.trimend": "^1.0.9",
        "string.prototype.trimstart": "^1.0.8",
        "typed-array-buffer": "^1.0.3",
        "typed-array-byte-length": "^1.0.3",
        "typed-array-byte-offset": "^1.0.4",
        "typed-array-length": "^1.0.7",
        "unbox-primitive": "^1.1.0",
        "which-typed-array": "^1.1.19"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-iterator-helpers": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/es-iterator-helpers/-/es-iterator-helpers-1.2.1.tgz",
      "integrity": "sha512-uDn+FE1yrDzyC0pCo961B2IHbdM8y/ACZsKD4dG6WqrjV53BADjwa7D+1aom2rsNVfLyDgU/eigvlJGJ08OQ4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.6",
        "es-errors": "^1.3.0",
        "es-set-tostringtag": "^2.0.3",
        "function-bind": "^1.1.2",
        "get-intrinsic": "^1.2.6",
        "globalthis": "^1.0.4",
        "gopd": "^1.2.0",
        "has-property-descriptors": "^1.0.2",
        "has-proto": "^1.2.0",
        "has-symbols": "^1.1.0",
        "internal-slot": "^1.1.0",
        "iterator.prototype": "^1.1.4",
        "safe-array-concat": "^1.1.3"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-shim-unscopables": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/es-shim-unscopables/-/es-shim-unscopables-1.1.0.tgz",
      "integrity": "sha512-d9T8ucsEhh8Bi1woXCf+TIKDIROLG5WCkxg8geBCbvk22kzwC5G2OnXVMO6FUsvQlgUUXQ2itephWDLqDzbeCw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-to-primitive": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-to-primitive/-/es-to-primitive-1.3.0.tgz",
      "integrity": "sha512-w+5mJ3GuFL+NjVtJlvydShqE1eN3h3PbI7/5LAsYJP/2qtuMXjfL2LpHSRqo4b4eSF5K/DH1JXKUAHSB2UW50g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-callable": "^1.2.7",
        "is-date-object": "^1.0.5",
        "is-symbol": "^1.0.4"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/esbuild": {
      "version": "0.25.10",
      "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.25.10.tgz",
      "integrity": "sha512-9RiGKvCwaqxO2owP61uQ4BgNborAQskMR6QusfWzQqv7AZOg5oGehdY2pRJMTKuwxd1IDBP4rSbI5lHzU7SMsQ==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "bin": {
        "esbuild": "bin/esbuild"
      },
      "engines": {
        "node": ">=18"
      },
      "optionalDependencies": {
        "@esbuild/aix-ppc64": "0.25.10",
        "@esbuild/android-arm": "0.25.10",
        "@esbuild/android-arm64": "0.25.10",
        "@esbuild/android-x64": "0.25.10",
        "@esbuild/darwin-arm64": "0.25.10",
        "@esbuild/darwin-x64": "0.25.10",
        "@esbuild/freebsd-arm64": "0.25.10",
        "@esbuild/freebsd-x64": "0.25.10",
        "@esbuild/linux-arm": "0.25.10",
        "@esbuild/linux-arm64": "0.25.10",
        "@esbuild/linux-ia32": "0.25.10",
        "@esbuild/linux-loong64": "0.25.10",
        "@esbuild/linux-mips64el": "0.25.10",
        "@esbuild/linux-ppc64": "0.25.10",
        "@esbuild/linux-riscv64": "0.25.10",
        "@esbuild/linux-s390x": "0.25.10",
        "@esbuild/linux-x64": "0.25.10",
        "@esbuild/netbsd-arm64": "0.25.10",
        "@esbuild/netbsd-x64": "0.25.10",
        "@esbuild/openbsd-arm64": "0.25.10",
        "@esbuild/openbsd-x64": "0.25.10",
        "@esbuild/openharmony-arm64": "0.25.10",
        "@esbuild/sunos-x64": "0.25.10",
        "@esbuild/win32-arm64": "0.25.10",
        "@esbuild/win32-ia32": "0.25.10",
        "@esbuild/win32-x64": "0.25.10"
      }
    },
    "node_modules/escape-string-regexp": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
      "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/eslint": {
      "version": "9.36.0",
      "resolved": "https://registry.npmjs.org/eslint/-/eslint-9.36.0.tgz",
      "integrity": "sha512-hB4FIzXovouYzwzECDcUkJ4OcfOEkXTv2zRY6B9bkwjx/cprAq0uvm1nl7zvQ0/TsUk0zQiN4uPfJpB9m+rPMQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.8.0",
        "@eslint-community/regexpp": "^4.12.1",
        "@eslint/config-array": "^0.21.0",
        "@eslint/config-helpers": "^0.3.1",
        "@eslint/core": "^0.15.2",
        "@eslint/eslintrc": "^3.3.1",
        "@eslint/js": "9.36.0",
        "@eslint/plugin-kit": "^0.3.5",
        "@humanfs/node": "^0.16.6",
        "@humanwhocodes/module-importer": "^1.0.1",
        "@humanwhocodes/retry": "^0.4.2",
        "@types/estree": "^1.0.6",
        "@types/json-schema": "^7.0.15",
        "ajv": "^6.12.4",
        "chalk": "^4.0.0",
        "cross-spawn": "^7.0.6",
        "debug": "^4.3.2",
        "escape-string-regexp": "^4.0.0",
        "eslint-scope": "^8.4.0",
        "eslint-visitor-keys": "^4.2.1",
        "espree": "^10.4.0",
        "esquery": "^1.5.0",
        "esutils": "^2.0.2",
        "fast-deep-equal": "^3.1.3",
        "file-entry-cache": "^8.0.0",
        "find-up": "^5.0.0",
        "glob-parent": "^6.0.2",
        "ignore": "^5.2.0",
        "imurmurhash": "^0.1.4",
        "is-glob": "^4.0.0",
        "json-stable-stringify-without-jsonify": "^1.0.1",
        "lodash.merge": "^4.6.2",
        "minimatch": "^3.1.2",
        "natural-compare": "^1.4.0",
        "optionator": "^0.9.3"
      },
      "bin": {
        "eslint": "bin/eslint.js"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      },
      "peerDependencies": {
        "jiti": "*"
      },
      "peerDependenciesMeta": {
        "jiti": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-config-next": {
      "version": "15.5.4",
      "resolved": "https://registry.npmjs.org/eslint-config-next/-/eslint-config-next-15.5.4.tgz",
      "integrity": "sha512-BzgVVuT3kfJes8i2GHenC1SRJ+W3BTML11lAOYFOOPzrk2xp66jBOAGEFRw+3LkYCln5UzvFsLhojrshb5Zfaw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@next/eslint-plugin-next": "15.5.4",
        "@rushstack/eslint-patch": "^1.10.3",
        "@typescript-eslint/eslint-plugin": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",
        "@typescript-eslint/parser": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",
        "eslint-import-resolver-node": "^0.3.6",
        "eslint-import-resolver-typescript": "^3.5.2",
        "eslint-plugin-import": "^2.31.0",
        "eslint-plugin-jsx-a11y": "^6.10.0",
        "eslint-plugin-react": "^7.37.0",
        "eslint-plugin-react-hooks": "^5.0.0"
      },
      "peerDependencies": {
        "eslint": "^7.23.0 || ^8.0.0 || ^9.0.0",
        "typescript": ">=3.3.1"
      },
      "peerDependenciesMeta": {
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-import-resolver-node": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/eslint-import-resolver-node/-/eslint-import-resolver-node-0.3.9.tgz",
      "integrity": "sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "debug": "^3.2.7",
        "is-core-module": "^2.13.0",
        "resolve": "^1.22.4"
      }
    },
    "node_modules/eslint-import-resolver-node/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-import-resolver-typescript": {
      "version": "3.10.1",
      "resolved": "https://registry.npmjs.org/eslint-import-resolver-typescript/-/eslint-import-resolver-typescript-3.10.1.tgz",
      "integrity": "sha512-A1rHYb06zjMGAxdLSkN2fXPBwuSaQ0iO5M/hdyS0Ajj1VBaRp0sPD3dn1FhME3c/JluGFbwSxyCfqdSbtQLAHQ==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "@nolyfill/is-core-module": "1.0.39",
        "debug": "^4.4.0",
        "get-tsconfig": "^4.10.0",
        "is-bun-module": "^2.0.0",
        "stable-hash": "^0.0.5",
        "tinyglobby": "^0.2.13",
        "unrs-resolver": "^1.6.2"
      },
      "engines": {
        "node": "^14.18.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint-import-resolver-typescript"
      },
      "peerDependencies": {
        "eslint": "*",
        "eslint-plugin-import": "*",
        "eslint-plugin-import-x": "*"
      },
      "peerDependenciesMeta": {
        "eslint-plugin-import": {
          "optional": true
        },
        "eslint-plugin-import-x": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-module-utils": {
      "version": "2.12.1",
      "resolved": "https://registry.npmjs.org/eslint-module-utils/-/eslint-module-utils-2.12.1.tgz",
      "integrity": "sha512-L8jSWTze7K2mTg0vos/RuLRS5soomksDPoJLXIslC7c8Wmut3bx7CPpJijDcBZtxQ5lrbUdM+s0OlNbz0DCDNw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "debug": "^3.2.7"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependenciesMeta": {
        "eslint": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-module-utils/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-plugin-import": {
      "version": "2.32.0",
      "resolved": "https://registry.npmjs.org/eslint-plugin-import/-/eslint-plugin-import-2.32.0.tgz",
      "integrity": "sha512-whOE1HFo/qJDyX4SnXzP4N6zOWn79WhnCUY/iDR0mPfQZO8wcYE4JClzI2oZrhBnnMUCBCHZhO6VQyoBU95mZA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@rtsao/scc": "^1.1.0",
        "array-includes": "^3.1.9",
        "array.prototype.findlastindex": "^1.2.6",
        "array.prototype.flat": "^1.3.3",
        "array.prototype.flatmap": "^1.3.3",
        "debug": "^3.2.7",
        "doctrine": "^2.1.0",
        "eslint-import-resolver-node": "^0.3.9",
        "eslint-module-utils": "^2.12.1",
        "hasown": "^2.0.2",
        "is-core-module": "^2.16.1",
        "is-glob": "^4.0.3",
        "minimatch": "^3.1.2",
        "object.fromentries": "^2.0.8",
        "object.groupby": "^1.0.3",
        "object.values": "^1.2.1",
        "semver": "^6.3.1",
        "string.prototype.trimend": "^1.0.9",
        "tsconfig-paths": "^3.15.0"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependencies": {
        "eslint": "^2 || ^3 || ^4 || ^5 || ^6 || ^7.2.0 || ^8 || ^9"
      }
    },
    "node_modules/eslint-plugin-import/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-plugin-import/node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/eslint-plugin-jsx-a11y": {
      "version": "6.10.2",
      "resolved": "https://registry.npmjs.org/eslint-plugin-jsx-a11y/-/eslint-plugin-jsx-a11y-6.10.2.tgz",
      "integrity": "sha512-scB3nz4WmG75pV8+3eRUQOHZlNSUhFNq37xnpgRkCCELU3XMvXAxLk1eqWWyE22Ki4Q01Fnsw9BA3cJHDPgn2Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "aria-query": "^5.3.2",
        "array-includes": "^3.1.8",
        "array.prototype.flatmap": "^1.3.2",
        "ast-types-flow": "^0.0.8",
        "axe-core": "^4.10.0",
        "axobject-query": "^4.1.0",
        "damerau-levenshtein": "^1.0.8",
        "emoji-regex": "^9.2.2",
        "hasown": "^2.0.2",
        "jsx-ast-utils": "^3.3.5",
        "language-tags": "^1.0.9",
        "minimatch": "^3.1.2",
        "object.fromentries": "^2.0.8",
        "safe-regex-test": "^1.0.3",
        "string.prototype.includes": "^2.0.1"
      },
      "engines": {
        "node": ">=4.0"
      },
      "peerDependencies": {
        "eslint": "^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9"
      }
    },
    "node_modules/eslint-plugin-react": {
      "version": "7.37.5",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react/-/eslint-plugin-react-7.37.5.tgz",
      "integrity": "sha512-Qteup0SqU15kdocexFNAJMvCJEfa2xUKNV4CC1xsVMrIIqEy3SQ/rqyxCWNzfrd3/ldy6HMlD2e0JDVpDg2qIA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-includes": "^3.1.8",
        "array.prototype.findlast": "^1.2.5",
        "array.prototype.flatmap": "^1.3.3",
        "array.prototype.tosorted": "^1.1.4",
        "doctrine": "^2.1.0",
        "es-iterator-helpers": "^1.2.1",
        "estraverse": "^5.3.0",
        "hasown": "^2.0.2",
        "jsx-ast-utils": "^2.4.1 || ^3.0.0",
        "minimatch": "^3.1.2",
        "object.entries": "^1.1.9",
        "object.fromentries": "^2.0.8",
        "object.values": "^1.2.1",
        "prop-types": "^15.8.1",
        "resolve": "^2.0.0-next.5",
        "semver": "^6.3.1",
        "string.prototype.matchall": "^4.0.12",
        "string.prototype.repeat": "^1.0.0"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependencies": {
        "eslint": "^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9.7"
      }
    },
    "node_modules/eslint-plugin-react-hooks": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-5.2.0.tgz",
      "integrity": "sha512-+f15FfK64YQwZdJNELETdn5ibXEUQmW1DZL6KXhNnc2heoy/sg9VJJeT7n8TlMWouzWqSWavFkIhHyIbIAEapg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0"
      }
    },
    "node_modules/eslint-plugin-react/node_modules/resolve": {
      "version": "2.0.0-next.5",
      "resolved": "https://registry.npmjs.org/resolve/-/resolve-2.0.0-next.5.tgz",
      "integrity": "sha512-U7WjGVG9sH8tvjW5SmGbQuui75FiyjAX72HX15DwBBwF9dNiQZRQAg9nnPhYy+TUnE0+VcrttuvNI8oSxZcocA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-core-module": "^2.13.0",
        "path-parse": "^1.0.7",
        "supports-preserve-symlinks-flag": "^1.0.0"
      },
      "bin": {
        "resolve": "bin/resolve"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/eslint-plugin-react/node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/eslint-scope": {
      "version": "8.4.0",
      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-8.4.0.tgz",
      "integrity": "sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "esrecurse": "^4.3.0",
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/eslint-visitor-keys": {
      "version": "4.2.1",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.2.1.tgz",
      "integrity": "sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/espree": {
      "version": "10.4.0",
      "resolved": "https://registry.npmjs.org/espree/-/espree-10.4.0.tgz",
      "integrity": "sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "acorn": "^8.15.0",
        "acorn-jsx": "^5.3.2",
        "eslint-visitor-keys": "^4.2.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/esquery": {
      "version": "1.6.0",
      "resolved": "https://registry.npmjs.org/esquery/-/esquery-1.6.0.tgz",
      "integrity": "sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==",
      "dev": true,
      "license": "BSD-3-Clause",
      "dependencies": {
        "estraverse": "^5.1.0"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/esrecurse": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/esrecurse/-/esrecurse-4.3.0.tgz",
      "integrity": "sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/estraverse": {
      "version": "5.3.0",
      "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz",
      "integrity": "sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/esutils": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz",
      "integrity": "sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/exsolve": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/exsolve/-/exsolve-1.0.7.tgz",
      "integrity": "sha512-VO5fQUzZtI6C+vx4w/4BWJpg3s/5l+6pRQEHzFRM8WFi4XffSP1Z+4qi7GbjWbvRQEbdIco5mIMq+zX4rPuLrw==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/fast-check": {
      "version": "3.23.2",
      "resolved": "https://registry.npmjs.org/fast-check/-/fast-check-3.23.2.tgz",
      "integrity": "sha512-h5+1OzzfCC3Ef7VbtKdcv7zsstUQwUDlYpUTvjeUsJAssPgLn7QzbboPtL5ro04Mq0rPOsMzl7q5hIbRs2wD1A==",
      "devOptional": true,
      "funding": [
        {
          "type": "individual",
          "url": "https://github.com/sponsors/dubzzz"
        },
        {
          "type": "opencollective",
          "url": "https://opencollective.com/fast-check"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "pure-rand": "^6.1.0"
      },
      "engines": {
        "node": ">=8.0.0"
      }
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-glob": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.1.tgz",
      "integrity": "sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "^2.0.2",
        "@nodelib/fs.walk": "^1.2.3",
        "glob-parent": "^5.1.2",
        "merge2": "^1.3.0",
        "micromatch": "^4.0.4"
      },
      "engines": {
        "node": ">=8.6.0"
      }
    },
    "node_modules/fast-glob/node_modules/glob-parent": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
      "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/fast-json-stable-stringify": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
      "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-levenshtein": {
      "version": "2.0.6",
      "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
      "integrity": "sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fastq": {
      "version": "1.19.1",
      "resolved": "https://registry.npmjs.org/fastq/-/fastq-1.19.1.tgz",
      "integrity": "sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "reusify": "^1.0.4"
      }
    },
    "node_modules/file-entry-cache": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",
      "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flat-cache": "^4.0.0"
      },
      "engines": {
        "node": ">=16.0.0"
      }
    },
    "node_modules/fill-range": {
      "version": "7.1.1",
      "resolved": "https://registry.npmjs.org/fill-range/-/fill-range-7.1.1.tgz",
      "integrity": "sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "to-regex-range": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/find-up": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/find-up/-/find-up-5.0.0.tgz",
      "integrity": "sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "locate-path": "^6.0.0",
        "path-exists": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/flat-cache": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",
      "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flatted": "^3.2.9",
        "keyv": "^4.5.4"
      },
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/flatted": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/flatted/-/flatted-3.3.3.tgz",
      "integrity": "sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/for-each": {
      "version": "0.3.5",
      "resolved": "https://registry.npmjs.org/for-each/-/for-each-0.3.5.tgz",
      "integrity": "sha512-dKx12eRCVIzqCxFGplyFKJMPvLEWgmNtUrpTiJIR5u97zEhRG8ySrtboPHZXx7daLxQVrl643cTzbab2tkQjxg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-callable": "^1.2.7"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/frac": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/frac/-/frac-1.1.2.tgz",
      "integrity": "sha512-w/XBfkibaTl3YDqASwfDUqkna4Z2p9cFSr1aHDt0WoMTECnRfBOv2WArlZILlqgWlmdIlALXGpM2AOhEk5W3IA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/fsevents": {
      "version": "2.3.3",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
      "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/function.prototype.name": {
      "version": "1.1.8",
      "resolved": "https://registry.npmjs.org/function.prototype.name/-/function.prototype.name-1.1.8.tgz",
      "integrity": "sha512-e5iwyodOHhbMr/yNrc7fDYG4qlbIvI5gajyzPnb5TCwyhjApznQh1BMFou9b30SevY43gCJKXycoCBjMbsuW0Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "functions-have-names": "^1.2.3",
        "hasown": "^2.0.2",
        "is-callable": "^1.2.7"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/functions-have-names": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/functions-have-names/-/functions-have-names-1.2.3.tgz",
      "integrity": "sha512-xckBUXyTIqT97tq2x2AMb+g163b5JFysYk0x4qxNFwbfQkmNZoiRHb6sPzI9/QV33WeuvVYBUIiD4NzNIyqaRQ==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-caller-file": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/get-caller-file/-/get-caller-file-2.0.5.tgz",
      "integrity": "sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==",
      "license": "ISC",
      "engines": {
        "node": "6.* || 8.* || >= 10.*"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/get-symbol-description": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/get-symbol-description/-/get-symbol-description-1.1.0.tgz",
      "integrity": "sha512-w9UMqWwJxHNOvoNzSJ2oPF5wvYcvP7jUvYzhp67yEhTi17ZDBBC1z9pTdGuzjD+EFIqLSYRweZjqfiPzQ06Ebg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-tsconfig": {
      "version": "4.10.1",
      "resolved": "https://registry.npmjs.org/get-tsconfig/-/get-tsconfig-4.10.1.tgz",
      "integrity": "sha512-auHyJ4AgMz7vgS8Hp3N6HXSmlMdUyhSUrfBF16w153rxtLIEOE+HGqaBppczZvnHLqQJfiHotCYpNhl0lUROFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "resolve-pkg-maps": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/privatenumber/get-tsconfig?sponsor=1"
      }
    },
    "node_modules/giget": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/giget/-/giget-2.0.0.tgz",
      "integrity": "sha512-L5bGsVkxJbJgdnwyuheIunkGatUF/zssUoxxjACCseZYAVbaqdh9Tsmmlkl8vYan09H7sbvKt4pS8GqKLBrEzA==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "citty": "^0.1.6",
        "consola": "^3.4.0",
        "defu": "^6.1.4",
        "node-fetch-native": "^1.6.6",
        "nypm": "^0.6.0",
        "pathe": "^2.0.3"
      },
      "bin": {
        "giget": "dist/cli.mjs"
      }
    },
    "node_modules/glob-parent": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz",
      "integrity": "sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.3"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/globals": {
      "version": "14.0.0",
      "resolved": "https://registry.npmjs.org/globals/-/globals-14.0.0.tgz",
      "integrity": "sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/globalthis": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/globalthis/-/globalthis-1.0.4.tgz",
      "integrity": "sha512-DpLKbNU4WylpxJykQujfCcwYWiV/Jhm50Goo0wrVILAv5jOr9d+H+UR3PhSCD2rCCEIg0uc+G+muBTwD54JhDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-properties": "^1.2.1",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/graceful-fs": {
      "version": "4.2.11",
      "resolved": "https://registry.npmjs.org/graceful-fs/-/graceful-fs-4.2.11.tgz",
      "integrity": "sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/graphemer": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/graphemer/-/graphemer-1.4.0.tgz",
      "integrity": "sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/gzip-size": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/gzip-size/-/gzip-size-6.0.0.tgz",
      "integrity": "sha512-ax7ZYomf6jqPTQ4+XCpUGyXKHk5WweS+e05MBO4/y3WJ5RkmPXNKvX+bx1behVILVwr6JSQvZAku021CHPXG3Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "duplexer": "^0.1.2"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/has-bigints": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-bigints/-/has-bigints-1.1.0.tgz",
      "integrity": "sha512-R3pbpkcIqv2Pm3dUwgjclDRVmWpTJW2DcMzcIhEXEx1oh/CEMObMm3KLmRJOdvhM7o4uQBnwr8pzRK2sJWIqfg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-flag": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz",
      "integrity": "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/has-property-descriptors": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-property-descriptors/-/has-property-descriptors-1.0.2.tgz",
      "integrity": "sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-define-property": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-proto": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/has-proto/-/has-proto-1.2.0.tgz",
      "integrity": "sha512-KIL7eQPfHQRC8+XluaIw7BHUwwqL19bQn4hzNgdr+1wXoU0KKj6rufu47lhY7KbJR2C6T6+PfyN0Ea7wkSS+qQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/html-escaper": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/html-escaper/-/html-escaper-2.0.2.tgz",
      "integrity": "sha512-H2iMtd0I4Mt5eYiapRdIDjp+XzelXQ0tFE4JS7YFwFevXXMmOp9myNrUvCg0D6ws8iqkRPBfKHgbwig1SmlLfg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/ignore": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-5.3.2.tgz",
      "integrity": "sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/import-fresh": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/import-fresh/-/import-fresh-3.3.1.tgz",
      "integrity": "sha512-TR3KfrTZTYLPB6jUjfx6MF9WcWrHL9su5TObK4ZkYgBdWKPOFoSoQIdEuTuR82pmtxH2spWG9h6etwfr1pLBqQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "parent-module": "^1.0.0",
        "resolve-from": "^4.0.0"
      },
      "engines": {
        "node": ">=6"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/imurmurhash": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/imurmurhash/-/imurmurhash-0.1.4.tgz",
      "integrity": "sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.8.19"
      }
    },
    "node_modules/internal-slot": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/internal-slot/-/internal-slot-1.1.0.tgz",
      "integrity": "sha512-4gd7VpWNQNB4UKKCFFVcp1AVv+FMOgs9NKzjHKusc8jTMhd5eL1NqQqOpE0KzMds804/yHlglp3uxgluOqAPLw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "hasown": "^2.0.2",
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/ioredis": {
      "version": "5.8.0",
      "resolved": "https://registry.npmjs.org/ioredis/-/ioredis-5.8.0.tgz",
      "integrity": "sha512-AUXbKn9gvo9hHKvk6LbZJQSKn/qIfkWXrnsyL9Yrf+oeXmla9Nmf6XEumOddyhM8neynpK5oAV6r9r99KBuwzA==",
      "license": "MIT",
      "dependencies": {
        "@ioredis/commands": "1.4.0",
        "cluster-key-slot": "^1.1.0",
        "debug": "^4.3.4",
        "denque": "^2.1.0",
        "lodash.defaults": "^4.2.0",
        "lodash.isarguments": "^3.1.0",
        "redis-errors": "^1.2.0",
        "redis-parser": "^3.0.0",
        "standard-as-callback": "^2.1.0"
      },
      "engines": {
        "node": ">=12.22.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/ioredis"
      }
    },
    "node_modules/is-array-buffer": {
      "version": "3.0.5",
      "resolved": "https://registry.npmjs.org/is-array-buffer/-/is-array-buffer-3.0.5.tgz",
      "integrity": "sha512-DDfANUiiG2wC1qawP66qlTugJeL5HyzMpfr8lLK+jMQirGzNod0B12cFB/9q838Ru27sBwfw78/rdoU7RERz6A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-async-function": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-async-function/-/is-async-function-2.1.1.tgz",
      "integrity": "sha512-9dgM/cZBnNvjzaMYHVoxxfPj2QXt22Ev7SuuPrs+xav0ukGB0S6d4ydZdEiM48kLx5kDV+QBPrpVnFyefL8kkQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "async-function": "^1.0.0",
        "call-bound": "^1.0.3",
        "get-proto": "^1.0.1",
        "has-tostringtag": "^1.0.2",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-bigint": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-bigint/-/is-bigint-1.1.0.tgz",
      "integrity": "sha512-n4ZT37wG78iz03xPRKJrHTdZbe3IicyucEtdRsV5yglwc3GyUfbAfpSeD0FJ41NbUNSt5wbhqfp1fS+BgnvDFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-bigints": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-boolean-object": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/is-boolean-object/-/is-boolean-object-1.2.2.tgz",
      "integrity": "sha512-wa56o2/ElJMYqjCjGkXri7it5FbebW5usLw/nPmCMs5DeZ7eziSYZhSmPRn0txqeW4LnAmQQU7FgqLpsEFKM4A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-bun-module": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/is-bun-module/-/is-bun-module-2.0.0.tgz",
      "integrity": "sha512-gNCGbnnnnFAUGKeZ9PdbyeGYJqewpmc2aKHUEMO5nQPWU9lOmv7jcmQIv+qHD8fXW6W7qfuCwX4rY9LNRjXrkQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "semver": "^7.7.1"
      }
    },
    "node_modules/is-callable": {
      "version": "1.2.7",
      "resolved": "https://registry.npmjs.org/is-callable/-/is-callable-1.2.7.tgz",
      "integrity": "sha512-1BC0BVFhS/p0qtw6enp8e+8OD0UrK0oFLztSjNzhcKA3WDuJxxAPXzPuPtKkjEY9UUoEWlX/8fgKeu2S8i9JTA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-core-module": {
      "version": "2.16.1",
      "resolved": "https://registry.npmjs.org/is-core-module/-/is-core-module-2.16.1.tgz",
      "integrity": "sha512-UfoeMA6fIJ8wTYFEUjelnaGI67v6+N7qXJEvQuIGa99l4xsCruSYOVSQ0uPANn4dAzm8lkYPaKLrrijLq7x23w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-data-view": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/is-data-view/-/is-data-view-1.0.2.tgz",
      "integrity": "sha512-RKtWF8pGmS87i2D6gqQu/l7EYRlVdfzemCJN/P3UOs//x1QE7mfhvzHIApBTRf7axvT6DMGwSwBXYCT0nfB9xw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "get-intrinsic": "^1.2.6",
        "is-typed-array": "^1.1.13"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-date-object": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-date-object/-/is-date-object-1.1.0.tgz",
      "integrity": "sha512-PwwhEakHVKTdRNVOw+/Gyh0+MzlCl4R6qKvkhuvLtPMggI1WAHt9sOwZxQLSGpUaDnrdyDsomoRgNnCfKNSXXg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-extglob": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-extglob/-/is-extglob-2.1.1.tgz",
      "integrity": "sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-finalizationregistry": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-finalizationregistry/-/is-finalizationregistry-1.1.1.tgz",
      "integrity": "sha512-1pC6N8qWJbWoPtEjgcL2xyhQOP491EQjeUo3qTKcmV8YSDDJrOepfG8pcC7h/QgnQHYSv0mJ3Z/ZWxmatVrysg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-fullwidth-code-point": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
      "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/is-generator-function": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-generator-function/-/is-generator-function-1.1.0.tgz",
      "integrity": "sha512-nPUB5km40q9e8UfN/Zc24eLlzdSf9OfKByBw9CIdw4H1giPMeA0OIJvbchsCu4npfI2QcMVBsGEBHKZ7wLTWmQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "get-proto": "^1.0.0",
        "has-tostringtag": "^1.0.2",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-glob": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
      "integrity": "sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-extglob": "^2.1.1"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-map": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-map/-/is-map-2.0.3.tgz",
      "integrity": "sha512-1Qed0/Hr2m+YqxnM09CjA2d/i6YZNfF6R2oRAOj36eUdS6qIV/huPJNSEpKbupewFs+ZsJlxsjjPbc0/afW6Lw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-negative-zero": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-negative-zero/-/is-negative-zero-2.0.3.tgz",
      "integrity": "sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-number": {
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/is-number/-/is-number-7.0.0.tgz",
      "integrity": "sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.12.0"
      }
    },
    "node_modules/is-number-object": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-number-object/-/is-number-object-1.1.1.tgz",
      "integrity": "sha512-lZhclumE1G6VYD8VHe35wFaIif+CTy5SJIi5+3y4psDgWu4wPDoBhF8NxUOinEc7pHgiTsT6MaBb92rKhhD+Xw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-plain-object": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/is-plain-object/-/is-plain-object-5.0.0.tgz",
      "integrity": "sha512-VRSzKkbMm5jMDoKLbltAkFQ5Qr7VDiTFGXxYFXXowVj387GeGNOCsOH6Msy00SGZ3Fp84b1Naa1psqgcCIEP5Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-regex": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/is-regex/-/is-regex-1.2.1.tgz",
      "integrity": "sha512-MjYsKHO5O7mCsmRGxWcLWheFqN9DJ/2TmngvjKXihe6efViPqc274+Fx/4fYj/r03+ESvBdTXK0V6tA3rgez1g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "gopd": "^1.2.0",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-set": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-set/-/is-set-2.0.3.tgz",
      "integrity": "sha512-iPAjerrse27/ygGLxw+EBR9agv9Y6uLeYVJMu+QNCoouJ1/1ri0mGrcWpfCqFZuzzx3WjtwxG098X+n4OuRkPg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-shared-array-buffer": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/is-shared-array-buffer/-/is-shared-array-buffer-1.0.4.tgz",
      "integrity": "sha512-ISWac8drv4ZGfwKl5slpHG9OwPNty4jOWPRIhBpxOoD+hqITiwuipOQ2bNthAzwA3B4fIjO4Nln74N0S9byq8A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-string": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-string/-/is-string-1.1.1.tgz",
      "integrity": "sha512-BtEeSsoaQjlSPBemMQIrY1MY0uM6vnS1g5fmufYOtnxLGUZM2178PKbhsk7Ffv58IX+ZtcvoGwccYsh0PglkAA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-symbol": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-symbol/-/is-symbol-1.1.1.tgz",
      "integrity": "sha512-9gGx6GTtCQM73BgmHQXfDmLtfjjTUDSyoxTCbp5WtoixAhfgsDirWIcVQ/IHpvI5Vgd5i/J5F7B9cN/WlVbC/w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "has-symbols": "^1.1.0",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-typed-array": {
      "version": "1.1.15",
      "resolved": "https://registry.npmjs.org/is-typed-array/-/is-typed-array-1.1.15.tgz",
      "integrity": "sha512-p3EcsicXjit7SaskXHs1hA91QxgTw46Fv6EFKKGS5DRFLD8yKnohjF3hxoju94b/OcMZoQukzpPpBE9uLVKzgQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "which-typed-array": "^1.1.16"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakmap": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/is-weakmap/-/is-weakmap-2.0.2.tgz",
      "integrity": "sha512-K5pXYOm9wqY1RgjpL3YTkF39tni1XajUIkawTLUo9EZEVUFga5gSQJF8nNS7ZwJQ02y+1YCNYcMh+HIf1ZqE+w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakref": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-weakref/-/is-weakref-1.1.1.tgz",
      "integrity": "sha512-6i9mGWSlqzNMEqpCp93KwRS1uUOodk2OJ6b+sq7ZPDSy2WuI5NFIxp/254TytR8ftefexkWn5xNiHUNpPOfSew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakset": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/is-weakset/-/is-weakset-2.0.4.tgz",
      "integrity": "sha512-mfcwb6IzQyOKTs84CQMrOwW4gQcaTOAWJ0zzJCl2WSPDrWk/OzDaImWFH3djXhb24g4eudZfLRozAvPGw4d9hQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/isarray": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-2.0.5.tgz",
      "integrity": "sha512-xHjhDr3cNBK0BzdUJSPXZntQUx/mwMS5Rw4A7lPJ90XGAO6ISP/ePDNuo0vhqOZU+UD5JoodwCAAoZQd3FeAKw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/iterator.prototype": {
      "version": "1.1.5",
      "resolved": "https://registry.npmjs.org/iterator.prototype/-/iterator.prototype-1.1.5.tgz",
      "integrity": "sha512-H0dkQoCa3b2VEeKQBOxFph+JAbcrQdE7KC0UkqwpLmv2EC4P41QXP+rqo9wYodACiG5/WM5s9oDApTU8utwj9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.6",
        "get-proto": "^1.0.0",
        "has-symbols": "^1.1.0",
        "set-function-name": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/jiti": {
      "version": "2.6.0",
      "resolved": "https://registry.npmjs.org/jiti/-/jiti-2.6.0.tgz",
      "integrity": "sha512-VXe6RjJkBPj0ohtqaO8vSWP3ZhAKo66fKrFNCll4BTcwljPLz03pCbaNKfzGP5MbrCYcbJ7v0nOYYwUzTEIdXQ==",
      "devOptional": true,
      "license": "MIT",
      "bin": {
        "jiti": "lib/jiti-cli.mjs"
      }
    },
    "node_modules/jose": {
      "version": "4.15.9",
      "resolved": "https://registry.npmjs.org/jose/-/jose-4.15.9.tgz",
      "integrity": "sha512-1vUQX+IdDMVPj4k8kOxgUqlcK518yluMuGZwqlr44FS1ppZB/5GWh4rZG89erpOBOJjU/OBsnCVFfapsRz6nEA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/panva"
      }
    },
    "node_modules/js-tokens": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
      "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/js-yaml": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.0.tgz",
      "integrity": "sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "argparse": "^2.0.1"
      },
      "bin": {
        "js-yaml": "bin/js-yaml.js"
      }
    },
    "node_modules/json-buffer": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
      "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-schema-traverse": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-stable-stringify-without-jsonify": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/json-stable-stringify-without-jsonify/-/json-stable-stringify-without-jsonify-1.0.1.tgz",
      "integrity": "sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json5": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/json5/-/json5-1.0.2.tgz",
      "integrity": "sha512-g1MWMLBiz8FKi1e4w0UyVL3w+iJceWAFBAaBnnGKOpNa5f8TLktkbre1+s6oICydWAm+HRUGTmI+//xv2hvXYA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "minimist": "^1.2.0"
      },
      "bin": {
        "json5": "lib/cli.js"
      }
    },
    "node_modules/jsx-ast-utils": {
      "version": "3.3.5",
      "resolved": "https://registry.npmjs.org/jsx-ast-utils/-/jsx-ast-utils-3.3.5.tgz",
      "integrity": "sha512-ZZow9HBI5O6EPgSJLUb8n2NKgmVWTwCvHGwFuJlMjvLFqlGG6pjirPhtdsseaLZjSibD8eegzmYpUZwoIlj2cQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-includes": "^3.1.6",
        "array.prototype.flat": "^1.3.1",
        "object.assign": "^4.1.4",
        "object.values": "^1.1.6"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/keyv": {
      "version": "4.5.4",
      "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
      "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "json-buffer": "3.0.1"
      }
    },
    "node_modules/language-subtag-registry": {
      "version": "0.3.23",
      "resolved": "https://registry.npmjs.org/language-subtag-registry/-/language-subtag-registry-0.3.23.tgz",
      "integrity": "sha512-0K65Lea881pHotoGEa5gDlMxt3pctLi2RplBb7Ezh4rRdLEOtgi7n4EwK9lamnUCkKBqaeKRVebTq6BAxSkpXQ==",
      "dev": true,
      "license": "CC0-1.0"
    },
    "node_modules/language-tags": {
      "version": "1.0.9",
      "resolved": "https://registry.npmjs.org/language-tags/-/language-tags-1.0.9.tgz",
      "integrity": "sha512-MbjN408fEndfiQXbFQ1vnd+1NoLDsnQW41410oQBXiyXDMYH5z505juWa4KUE1LqxRC7DgOgZDbKLxHIwm27hA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "language-subtag-registry": "^0.3.20"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/levn": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/levn/-/levn-0.4.1.tgz",
      "integrity": "sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1",
        "type-check": "~0.4.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/lightningcss": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss/-/lightningcss-1.30.1.tgz",
      "integrity": "sha512-xi6IyHML+c9+Q3W0S4fCQJOym42pyurFiJUHEcEyHS0CeKzia4yZDEsLlqOFykxOdHpNy0NmvVO31vcSqAxJCg==",
      "dev": true,
      "license": "MPL-2.0",
      "dependencies": {
        "detect-libc": "^2.0.3"
      },
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      },
      "optionalDependencies": {
        "lightningcss-darwin-arm64": "1.30.1",
        "lightningcss-darwin-x64": "1.30.1",
        "lightningcss-freebsd-x64": "1.30.1",
        "lightningcss-linux-arm-gnueabihf": "1.30.1",
        "lightningcss-linux-arm64-gnu": "1.30.1",
        "lightningcss-linux-arm64-musl": "1.30.1",
        "lightningcss-linux-x64-gnu": "1.30.1",
        "lightningcss-linux-x64-musl": "1.30.1",
        "lightningcss-win32-arm64-msvc": "1.30.1",
        "lightningcss-win32-x64-msvc": "1.30.1"
      }
    },
    "node_modules/lightningcss-darwin-arm64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-darwin-arm64/-/lightningcss-darwin-arm64-1.30.1.tgz",
      "integrity": "sha512-c8JK7hyE65X1MHMN+Viq9n11RRC7hgin3HhYKhrMyaXflk5GVplZ60IxyoVtzILeKr+xAJwg6zK6sjTBJ0FKYQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-darwin-x64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-darwin-x64/-/lightningcss-darwin-x64-1.30.1.tgz",
      "integrity": "sha512-k1EvjakfumAQoTfcXUcHQZhSpLlkAuEkdMBsI/ivWw9hL+7FtilQc0Cy3hrx0AAQrVtQAbMI7YjCgYgvn37PzA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-freebsd-x64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-freebsd-x64/-/lightningcss-freebsd-x64-1.30.1.tgz",
      "integrity": "sha512-kmW6UGCGg2PcyUE59K5r0kWfKPAVy4SltVeut+umLCFoJ53RdCUWxcRDzO1eTaxf/7Q2H7LTquFHPL5R+Gjyig==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm-gnueabihf": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm-gnueabihf/-/lightningcss-linux-arm-gnueabihf-1.30.1.tgz",
      "integrity": "sha512-MjxUShl1v8pit+6D/zSPq9S9dQ2NPFSQwGvxBCYaBYLPlCWuPh9/t1MRS8iUaR8i+a6w7aps+B4N0S1TYP/R+Q==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm64-gnu": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm64-gnu/-/lightningcss-linux-arm64-gnu-1.30.1.tgz",
      "integrity": "sha512-gB72maP8rmrKsnKYy8XUuXi/4OctJiuQjcuqWNlJQ6jZiWqtPvqFziskH3hnajfvKB27ynbVCucKSm2rkQp4Bw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm64-musl": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm64-musl/-/lightningcss-linux-arm64-musl-1.30.1.tgz",
      "integrity": "sha512-jmUQVx4331m6LIX+0wUhBbmMX7TCfjF5FoOH6SD1CttzuYlGNVpA7QnrmLxrsub43ClTINfGSYyHe2HWeLl5CQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-x64-gnu": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-x64-gnu/-/lightningcss-linux-x64-gnu-1.30.1.tgz",
      "integrity": "sha512-piWx3z4wN8J8z3+O5kO74+yr6ze/dKmPnI7vLqfSqI8bccaTGY5xiSGVIJBDd5K5BHlvVLpUB3S2YCfelyJ1bw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-x64-musl": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-x64-musl/-/lightningcss-linux-x64-musl-1.30.1.tgz",
      "integrity": "sha512-rRomAK7eIkL+tHY0YPxbc5Dra2gXlI63HL+v1Pdi1a3sC+tJTcFrHX+E86sulgAXeI7rSzDYhPSeHHjqFhqfeQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-win32-arm64-msvc": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-win32-arm64-msvc/-/lightningcss-win32-arm64-msvc-1.30.1.tgz",
      "integrity": "sha512-mSL4rqPi4iXq5YVqzSsJgMVFENoa4nGTT/GjO2c0Yl9OuQfPsIfncvLrEW6RbbB24WtZ3xP/2CCmI3tNkNV4oA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-win32-x64-msvc": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-win32-x64-msvc/-/lightningcss-win32-x64-msvc-1.30.1.tgz",
      "integrity": "sha512-PVqXh48wh4T53F/1CCu8PIPCxLzWyCnn/9T5W1Jpmdy5h9Cwd+0YQS6/LwhHXSafuc61/xg9Lv5OrCby6a++jg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/locate-path": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-6.0.0.tgz",
      "integrity": "sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-locate": "^5.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/lodash.defaults": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/lodash.defaults/-/lodash.defaults-4.2.0.tgz",
      "integrity": "sha512-qjxPLHd3r5DnsdGacqOMU6pb/avJzdh9tFX2ymgoZE27BmjXrNy/y4LoaiTeAb+O3gL8AfpJGtqfX/ae2leYYQ==",
      "license": "MIT"
    },
    "node_modules/lodash.isarguments": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/lodash.isarguments/-/lodash.isarguments-3.1.0.tgz",
      "integrity": "sha512-chi4NHZlZqZD18a0imDHnZPrDeBbTtVN7GXMwuGdRH9qotxAjYs3aVLKc7zNOG9eddR5Ksd8rvFEBc9SsggPpg==",
      "license": "MIT"
    },
    "node_modules/lodash.merge": {
      "version": "4.6.2",
      "resolved": "https://registry.npmjs.org/lodash.merge/-/lodash.merge-4.6.2.tgz",
      "integrity": "sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/loose-envify": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz",
      "integrity": "sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "js-tokens": "^3.0.0 || ^4.0.0"
      },
      "bin": {
        "loose-envify": "cli.js"
      }
    },
    "node_modules/lru-cache": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-6.0.0.tgz",
      "integrity": "sha512-Jo6dJ04CmSjuznwJSS3pUeWmd/H0ffTlkXXgwZi+eq1UCmqQwCh+eLsYOYCwY991i2Fah4h1BEMCx4qThGbsiA==",
      "license": "ISC",
      "dependencies": {
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/lucide-react": {
      "version": "0.539.0",
      "resolved": "https://registry.npmjs.org/lucide-react/-/lucide-react-0.539.0.tgz",
      "integrity": "sha512-VVISr+VF2krO91FeuCrm1rSOLACQUYVy7NQkzrOty52Y8TlTPcXcMdQFj9bYzBgXbWCiywlwSZ3Z8u6a+6bMlg==",
      "license": "ISC",
      "peerDependencies": {
        "react": "^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      }
    },
    "node_modules/magic-string": {
      "version": "0.30.19",
      "resolved": "https://registry.npmjs.org/magic-string/-/magic-string-0.30.19.tgz",
      "integrity": "sha512-2N21sPY9Ws53PZvsEpVtNuSW+ScYbQdp4b9qUaL+9QkHUrGFKo56Lg9Emg5s9V/qrtNBmiR01sYhUOwu3H+VOw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.5"
      }
    },
    "node_modules/make-error": {
      "version": "1.3.6",
      "resolved": "https://registry.npmjs.org/make-error/-/make-error-1.3.6.tgz",
      "integrity": "sha512-s8UhlNe7vPKomQhC1qFelMokr/Sc3AgNbso3n74mVPA5LTZwkB9NlXf4XPamLxJE8h0gh73rM94xvwRT2CVInw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/merge2": {
      "version": "1.4.1",
      "resolved": "https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz",
      "integrity": "sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/micromatch": {
      "version": "4.0.8",
      "resolved": "https://registry.npmjs.org/micromatch/-/micromatch-4.0.8.tgz",
      "integrity": "sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "braces": "^3.0.3",
        "picomatch": "^2.3.1"
      },
      "engines": {
        "node": ">=8.6"
      }
    },
    "node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/minimist": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/minimist/-/minimist-1.2.8.tgz",
      "integrity": "sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/minipass": {
      "version": "7.1.2",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
      "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": ">=16 || 14 >=14.17"
      }
    },
    "node_modules/minizlib": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/minizlib/-/minizlib-3.1.0.tgz",
      "integrity": "sha512-KZxYo1BUkWD2TVFLr0MQoM8vUUigWD3LlD83a/75BqC+4qE0Hb1Vo5v1FgcfaNXvfXzr+5EhQ6ing/CaBijTlw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "minipass": "^7.1.2"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/mrmime": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/mrmime/-/mrmime-2.0.1.tgz",
      "integrity": "sha512-Y3wQdFg2Va6etvQ5I82yUhGdsKrcYox6p7FfL1LbK2J4V01F9TGlepTIhnK24t7koZibmg82KGglhA1XK5IsLQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
      }
    },
    "node_modules/napi-postinstall": {
      "version": "0.3.3",
      "resolved": "https://registry.npmjs.org/napi-postinstall/-/napi-postinstall-0.3.3.tgz",
      "integrity": "sha512-uTp172LLXSxuSYHv/kou+f6KW3SMppU9ivthaVTXian9sOt3XM/zHYHpRZiLgQoxeWfYUnslNWQHF1+G71xcow==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "napi-postinstall": "lib/cli.js"
      },
      "engines": {
        "node": "^12.20.0 || ^14.18.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/napi-postinstall"
      }
    },
    "node_modules/natural-compare": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
      "integrity": "sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/negotiator": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.3.tgz",
      "integrity": "sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/next": {
      "version": "15.4.6",
      "resolved": "https://registry.npmjs.org/next/-/next-15.4.6.tgz",
      "integrity": "sha512-us++E/Q80/8+UekzB3SAGs71AlLDsadpFMXVNM/uQ0BMwsh9m3mr0UNQIfjKed8vpWXsASe+Qifrnu1oLIcKEQ==",
      "license": "MIT",
      "dependencies": {
        "@next/env": "15.4.6",
        "@swc/helpers": "0.5.15",
        "caniuse-lite": "^1.0.30001579",
        "postcss": "8.4.31",
        "styled-jsx": "5.1.6"
      },
      "bin": {
        "next": "dist/bin/next"
      },
      "engines": {
        "node": "^18.18.0 || ^19.8.0 || >= 20.0.0"
      },
      "optionalDependencies": {
        "@next/swc-darwin-arm64": "15.4.6",
        "@next/swc-darwin-x64": "15.4.6",
        "@next/swc-linux-arm64-gnu": "15.4.6",
        "@next/swc-linux-arm64-musl": "15.4.6",
        "@next/swc-linux-x64-gnu": "15.4.6",
        "@next/swc-linux-x64-musl": "15.4.6",
        "@next/swc-win32-arm64-msvc": "15.4.6",
        "@next/swc-win32-x64-msvc": "15.4.6",
        "sharp": "^0.34.3"
      },
      "peerDependencies": {
        "@opentelemetry/api": "^1.1.0",
        "@playwright/test": "^1.51.1",
        "babel-plugin-react-compiler": "*",
        "react": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",
        "react-dom": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",
        "sass": "^1.3.0"
      },
      "peerDependenciesMeta": {
        "@opentelemetry/api": {
          "optional": true
        },
        "@playwright/test": {
          "optional": true
        },
        "babel-plugin-react-compiler": {
          "optional": true
        },
        "sass": {
          "optional": true
        }
      }
    },
    "node_modules/next-auth": {
      "version": "4.24.11",
      "resolved": "https://registry.npmjs.org/next-auth/-/next-auth-4.24.11.tgz",
      "integrity": "sha512-pCFXzIDQX7xmHFs4KVH4luCjaCbuPRtZ9oBUjUhOk84mZ9WVPf94n87TxYI4rSRf9HmfHEF8Yep3JrYDVOo3Cw==",
      "license": "ISC",
      "dependencies": {
        "@babel/runtime": "^7.20.13",
        "@panva/hkdf": "^1.0.2",
        "cookie": "^0.7.0",
        "jose": "^4.15.5",
        "oauth": "^0.9.15",
        "openid-client": "^5.4.0",
        "preact": "^10.6.3",
        "preact-render-to-string": "^5.1.19",
        "uuid": "^8.3.2"
      },
      "peerDependencies": {
        "@auth/core": "0.34.2",
        "next": "^12.2.5 || ^13 || ^14 || ^15",
        "nodemailer": "^6.6.5",
        "react": "^17.0.2 || ^18 || ^19",
        "react-dom": "^17.0.2 || ^18 || ^19"
      },
      "peerDependenciesMeta": {
        "@auth/core": {
          "optional": true
        },
        "nodemailer": {
          "optional": true
        }
      }
    },
    "node_modules/next/node_modules/postcss": {
      "version": "8.4.31",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.4.31.tgz",
      "integrity": "sha512-PS08Iboia9mts/2ygV3eLpY5ghnUcfLV/EXTOW1E2qYxJKGGBUtNjN76FYHnMs36RmARn41bC0AZmn+rR0OVpQ==",
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.6",
        "picocolors": "^1.0.0",
        "source-map-js": "^1.0.2"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/node-fetch-native": {
      "version": "1.6.7",
      "resolved": "https://registry.npmjs.org/node-fetch-native/-/node-fetch-native-1.6.7.tgz",
      "integrity": "sha512-g9yhqoedzIUm0nTnTqAQvueMPVOuIY16bqgAJJC8XOOubYFNwz6IER9qs0Gq2Xd0+CecCKFjtdDTMA4u4xG06Q==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/notepack.io": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/notepack.io/-/notepack.io-3.0.1.tgz",
      "integrity": "sha512-TKC/8zH5pXIAMVQio2TvVDTtPRX+DJPHDqjRbxogtFiByHyzKmy96RA0JtCQJ+WouyyL4A10xomQzgbUT+1jCg==",
      "license": "MIT"
    },
    "node_modules/nypm": {
      "version": "0.6.2",
      "resolved": "https://registry.npmjs.org/nypm/-/nypm-0.6.2.tgz",
      "integrity": "sha512-7eM+hpOtrKrBDCh7Ypu2lJ9Z7PNZBdi/8AT3AX8xoCj43BBVHD0hPSTEvMtkMpfs8FCqBGhxB+uToIQimA111g==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "citty": "^0.1.6",
        "consola": "^3.4.2",
        "pathe": "^2.0.3",
        "pkg-types": "^2.3.0",
        "tinyexec": "^1.0.1"
      },
      "bin": {
        "nypm": "dist/cli.mjs"
      },
      "engines": {
        "node": "^14.16.0 || >=16.10.0"
      }
    },
    "node_modules/oauth": {
      "version": "0.9.15",
      "resolved": "https://registry.npmjs.org/oauth/-/oauth-0.9.15.tgz",
      "integrity": "sha512-a5ERWK1kh38ExDEfoO6qUHJb32rd7aYmPHuyCu3Fta/cnICvYmgd2uhuKXvPD+PXB+gCEYYEaQdIRAjCOwAKNA==",
      "license": "MIT"
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/object-hash": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/object-hash/-/object-hash-2.2.0.tgz",
      "integrity": "sha512-gScRMn0bS5fH+IuwyIFgnh9zBdo4DV+6GhygmWM9HyNJSgS0hScp1f5vjtm7oIIOiT9trXrShAkLFSc2IqKNgw==",
      "license": "MIT",
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object-keys": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/object-keys/-/object-keys-1.1.1.tgz",
      "integrity": "sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.assign": {
      "version": "4.1.7",
      "resolved": "https://registry.npmjs.org/object.assign/-/object.assign-4.1.7.tgz",
      "integrity": "sha512-nK28WOo+QIjBkDduTINE4JkF/UJJKyf2EJxvJKfblDpyg0Q+pkOHNTL0Qwy6NP6FhE/EnzV73BxxqcJaXY9anw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0",
        "has-symbols": "^1.1.0",
        "object-keys": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object.entries": {
      "version": "1.1.9",
      "resolved": "https://registry.npmjs.org/object.entries/-/object.entries-1.1.9.tgz",
      "integrity": "sha512-8u/hfXFRBD1O0hPUjioLhoWFHRmt6tKA4/vZPyckBr18l1KE9uHrFaFaUi8MDRTpi4uak2goyPTSNJLXX2k2Hw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.fromentries": {
      "version": "2.0.8",
      "resolved": "https://registry.npmjs.org/object.fromentries/-/object.fromentries-2.0.8.tgz",
      "integrity": "sha512-k6E21FzySsSK5a21KRADBd/NGneRegFO5pLHfdQLpRDETUNJueLXs3WCzyQ3tFRDYgbq3KHGXfTbi2bs8WQ6rQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object.groupby": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/object.groupby/-/object.groupby-1.0.3.tgz",
      "integrity": "sha512-+Lhy3TQTuzXI5hevh8sBGqbmurHbbIjAi0Z4S63nthVLmLxfbj4T54a4CfZrXIrt9iP4mVAPYMo/v99taj3wjQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.values": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/object.values/-/object.values-1.2.1.tgz",
      "integrity": "sha512-gXah6aZrcUxjWg2zR2MwouP2eHlCBzdV4pygudehaKXSGW4v2AsRQUK+lwwXhii6KFZcunEnmSUoYp5CXibxtA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/ohash": {
      "version": "2.0.11",
      "resolved": "https://registry.npmjs.org/ohash/-/ohash-2.0.11.tgz",
      "integrity": "sha512-RdR9FQrFwNBNXAr4GixM8YaRZRJ5PUWbKYbE5eOsrwAjJW0q2REGcf79oYPsLyskQCZG1PLN+S/K1V00joZAoQ==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/oidc-token-hash": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/oidc-token-hash/-/oidc-token-hash-5.1.1.tgz",
      "integrity": "sha512-D7EmwxJV6DsEB6vOFLrBM2OzsVgQzgPWyHlV2OOAVj772n+WTXpudC9e9u5BVKQnYwaD30Ivhi9b+4UeBcGu9g==",
      "license": "MIT",
      "engines": {
        "node": "^10.13.0 || >=12.0.0"
      }
    },
    "node_modules/opener": {
      "version": "1.5.2",
      "resolved": "https://registry.npmjs.org/opener/-/opener-1.5.2.tgz",
      "integrity": "sha512-ur5UIdyw5Y7yEj9wLzhqXiy6GZ3Mwx0yGI+5sMn2r0N0v3cKJvUmFH5yPP+WXh9e0xfyzyJX95D8l088DNFj7A==",
      "dev": true,
      "license": "(WTFPL OR MIT)",
      "bin": {
        "opener": "bin/opener-bin.js"
      }
    },
    "node_modules/openid-client": {
      "version": "5.7.1",
      "resolved": "https://registry.npmjs.org/openid-client/-/openid-client-5.7.1.tgz",
      "integrity": "sha512-jDBPgSVfTnkIh71Hg9pRvtJc6wTwqjRkN88+gCFtYWrlP4Yx2Dsrow8uPi3qLr/aeymPF3o2+dS+wOpglK04ew==",
      "license": "MIT",
      "dependencies": {
        "jose": "^4.15.9",
        "lru-cache": "^6.0.0",
        "object-hash": "^2.2.0",
        "oidc-token-hash": "^5.0.3"
      },
      "funding": {
        "url": "https://github.com/sponsors/panva"
      }
    },
    "node_modules/optionator": {
      "version": "0.9.4",
      "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz",
      "integrity": "sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "deep-is": "^0.1.3",
        "fast-levenshtein": "^2.0.6",
        "levn": "^0.4.1",
        "prelude-ls": "^1.2.1",
        "type-check": "^0.4.0",
        "word-wrap": "^1.2.5"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/own-keys": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/own-keys/-/own-keys-1.0.1.tgz",
      "integrity": "sha512-qFOyK5PjiWZd+QQIh+1jhdb9LpxTF0qs7Pm8o5QHYZ0M3vKqSqzsZaEB6oWlxZ+q2sJBMI/Ktgd2N5ZwQoRHfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "get-intrinsic": "^1.2.6",
        "object-keys": "^1.1.1",
        "safe-push-apply": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/p-limit": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
      "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^0.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-locate": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-5.0.0.tgz",
      "integrity": "sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-limit": "^3.0.2"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-try": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/p-try/-/p-try-2.2.0.tgz",
      "integrity": "sha512-R4nPAVTAU0B9D35/Gk3uJf/7XYbQcyohSKdvAxIRSNghFl4e71hVoGnBNQz9cWaXxO2I10KTC+3jMdvvoKw6dQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/pako": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/pako/-/pako-1.0.11.tgz",
      "integrity": "sha512-4hLB8Py4zZce5s4yd9XzopqwVv/yGNhV1Bl8NTmCq1763HeK2+EwVTv+leGeL13Dnh2wfbqowVPXCIO0z4taYw==",
      "license": "(MIT AND Zlib)"
    },
    "node_modules/parent-module": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
      "integrity": "sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "callsites": "^3.0.0"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/path-exists": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-exists/-/path-exists-4.0.0.tgz",
      "integrity": "sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==",
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-parse": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/path-parse/-/path-parse-1.0.7.tgz",
      "integrity": "sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/pathe": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/pathe/-/pathe-2.0.3.tgz",
      "integrity": "sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/pdf-lib": {
      "version": "1.17.1",
      "resolved": "https://registry.npmjs.org/pdf-lib/-/pdf-lib-1.17.1.tgz",
      "integrity": "sha512-V/mpyJAoTsN4cnP31vc0wfNA1+p20evqqnap0KLoRUN0Yk/p3wN52DOEsL4oBFcLdb76hlpKPtzJIgo67j/XLw==",
      "license": "MIT",
      "dependencies": {
        "@pdf-lib/standard-fonts": "^1.0.0",
        "@pdf-lib/upng": "^1.0.1",
        "pako": "^1.0.11",
        "tslib": "^1.11.1"
      }
    },
    "node_modules/pdf-lib/node_modules/tslib": {
      "version": "1.14.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-1.14.1.tgz",
      "integrity": "sha512-Xni35NKzjgMrwevysHTCArtLDpPvye8zV/0E4EyYn43P7/7qvQwPh9BGkHewbMulVntbigmcT7rdX3BNo9wRJg==",
      "license": "0BSD"
    },
    "node_modules/perfect-debounce": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/perfect-debounce/-/perfect-debounce-1.0.0.tgz",
      "integrity": "sha512-xCy9V055GLEqoFaHoC1SoLIaLmWctgCUaBaWxDZ7/Zx4CTyX7cJQLJOok/orfjZAh9kEYpjJa4d0KcJmCbctZA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "license": "ISC"
    },
    "node_modules/picomatch": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-2.3.1.tgz",
      "integrity": "sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/pkg-types": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/pkg-types/-/pkg-types-2.3.0.tgz",
      "integrity": "sha512-SIqCzDRg0s9npO5XQ3tNZioRY1uK06lA41ynBC1YmFTmnY6FjUjVt6s4LoADmwoig1qqD0oK8h1p/8mlMx8Oig==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "confbox": "^0.2.2",
        "exsolve": "^1.0.7",
        "pathe": "^2.0.3"
      }
    },
    "node_modules/pngjs": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/pngjs/-/pngjs-5.0.0.tgz",
      "integrity": "sha512-40QW5YalBNfQo5yRYmiw7Yz6TKKVr3h6970B2YE+3fQpsWcrbj1PzJgxeJ19DRQjhMbKPIuMY8rFaXc8moolVw==",
      "license": "MIT",
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/possible-typed-array-names": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/possible-typed-array-names/-/possible-typed-array-names-1.1.0.tgz",
      "integrity": "sha512-/+5VFTchJDoVj3bhoqi6UeymcD00DAwb1nJwamzPvHEszJ4FpF6SNNbUbOS8yI56qHzdV8eK0qEfOSiodkTdxg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/preact": {
      "version": "10.27.2",
      "resolved": "https://registry.npmjs.org/preact/-/preact-10.27.2.tgz",
      "integrity": "sha512-5SYSgFKSyhCbk6SrXyMpqjb5+MQBgfvEKE/OC+PujcY34sOpqtr+0AZQtPYx5IA6VxynQ7rUPCtKzyovpj9Bpg==",
      "license": "MIT",
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/preact"
      }
    },
    "node_modules/preact-render-to-string": {
      "version": "5.2.6",
      "resolved": "https://registry.npmjs.org/preact-render-to-string/-/preact-render-to-string-5.2.6.tgz",
      "integrity": "sha512-JyhErpYOvBV1hEPwIxc/fHWXPfnEGdRKxc8gFdAZ7XV4tlzyzG847XAyEZqoDnynP88akM4eaHcSOzNcLWFguw==",
      "license": "MIT",
      "dependencies": {
        "pretty-format": "^3.8.0"
      },
      "peerDependencies": {
        "preact": ">=10"
      }
    },
    "node_modules/prelude-ls": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
      "integrity": "sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/pretty-format": {
      "version": "3.8.0",
      "resolved": "https://registry.npmjs.org/pretty-format/-/pretty-format-3.8.0.tgz",
      "integrity": "sha512-WuxUnVtlWL1OfZFQFuqvnvs6MiAGk9UNsBostyBOB0Is9wb5uRESevA6rnl/rkksXaGX3GzZhPup5d6Vp1nFew==",
      "license": "MIT"
    },
    "node_modules/prisma": {
      "version": "6.16.2",
      "resolved": "https://registry.npmjs.org/prisma/-/prisma-6.16.2.tgz",
      "integrity": "sha512-aRvldGE5UUJTtVmFiH3WfNFNiqFlAtePUxcI0UEGlnXCX7DqhiMT5TRYwncHFeA/Reca5W6ToXXyCMTeFPdSXA==",
      "devOptional": true,
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@prisma/config": "6.16.2",
        "@prisma/engines": "6.16.2"
      },
      "bin": {
        "prisma": "build/index.js"
      },
      "engines": {
        "node": ">=18.18"
      },
      "peerDependencies": {
        "typescript": ">=5.1.0"
      },
      "peerDependenciesMeta": {
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/prop-types": {
      "version": "15.8.1",
      "resolved": "https://registry.npmjs.org/prop-types/-/prop-types-15.8.1.tgz",
      "integrity": "sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.4.0",
        "object-assign": "^4.1.1",
        "react-is": "^16.13.1"
      }
    },
    "node_modules/punycode": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
      "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/pure-rand": {
      "version": "6.1.0",
      "resolved": "https://registry.npmjs.org/pure-rand/-/pure-rand-6.1.0.tgz",
      "integrity": "sha512-bVWawvoZoBYpp6yIoQtQXHZjmz35RSVHnUOTefl8Vcjr8snTPY1wnpSPMWekcFwbxI6gtmT7rSYPFvz71ldiOA==",
      "devOptional": true,
      "funding": [
        {
          "type": "individual",
          "url": "https://github.com/sponsors/dubzzz"
        },
        {
          "type": "opencollective",
          "url": "https://opencollective.com/fast-check"
        }
      ],
      "license": "MIT"
    },
    "node_modules/qrcode": {
      "version": "1.5.4",
      "resolved": "https://registry.npmjs.org/qrcode/-/qrcode-1.5.4.tgz",
      "integrity": "sha512-1ca71Zgiu6ORjHqFBDpnSMTR2ReToX4l1Au1VFLyVeBTFavzQnv5JxMFr3ukHVKpSrSA2MCk0lNJSykjUfz7Zg==",
      "license": "MIT",
      "dependencies": {
        "dijkstrajs": "^1.0.1",
        "pngjs": "^5.0.0",
        "yargs": "^15.3.1"
      },
      "bin": {
        "qrcode": "bin/qrcode"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/queue-microtask": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/queue-microtask/-/queue-microtask-1.2.3.tgz",
      "integrity": "sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/rc9": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/rc9/-/rc9-2.1.2.tgz",
      "integrity": "sha512-btXCnMmRIBINM2LDZoEmOogIZU7Qe7zn4BpomSKZ/ykbLObuBdvG+mFq11DL6fjH1DRwHhrlgtYWG96bJiC7Cg==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "defu": "^6.1.4",
        "destr": "^2.0.3"
      }
    },
    "node_modules/react": {
      "version": "19.1.0",
      "resolved": "https://registry.npmjs.org/react/-/react-19.1.0.tgz",
      "integrity": "sha512-FS+XFBNvn3GTAWq26joslQgWNoFu08F4kl0J4CgdNKADkdSGXQyTCnKteIAJy96Br6YbpEU1LSzV5dYtjMkMDg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-datepicker": {
      "version": "8.7.0",
      "resolved": "https://registry.npmjs.org/react-datepicker/-/react-datepicker-8.7.0.tgz",
      "integrity": "sha512-r5OJbiLWc3YiVNy69Kau07/aVgVGsFVMA6+nlqCV7vyQ8q0FUOnJ+wAI4CgVxHejG3i5djAEiebrF8/Eip4rIw==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/react": "^0.27.15",
        "clsx": "^2.1.1",
        "date-fns": "^4.1.0"
      },
      "peerDependencies": {
        "react": "^16.9.0 || ^17 || ^18 || ^19 || ^19.0.0-rc",
        "react-dom": "^16.9.0 || ^17 || ^18 || ^19 || ^19.0.0-rc"
      }
    },
    "node_modules/react-dom": {
      "version": "19.1.0",
      "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-19.1.0.tgz",
      "integrity": "sha512-Xs1hdnE+DyKgeHJeJznQmYMIBG3TKIHJJT95Q58nHLSrElKlGQqDTR2HQ9fx5CN/Gk6Vh/kupBTDLU11/nDk/g==",
      "license": "MIT",
      "dependencies": {
        "scheduler": "^0.26.0"
      },
      "peerDependencies": {
        "react": "^19.1.0"
      }
    },
    "node_modules/react-is": {
      "version": "16.13.1",
      "resolved": "https://registry.npmjs.org/react-is/-/react-is-16.13.1.tgz",
      "integrity": "sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/readdirp": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/readdirp/-/readdirp-4.1.2.tgz",
      "integrity": "sha512-GDhwkLfywWL2s6vEjyhri+eXmfH6j1L7JE27WhqLeYzoh/A3DBaYGEj2H/HFZCn/kMfim73FXxEJTw06WtxQwg==",
      "devOptional": true,
      "license": "MIT",
      "engines": {
        "node": ">= 14.18.0"
      },
      "funding": {
        "type": "individual",
        "url": "https://paulmillr.com/funding/"
      }
    },
    "node_modules/redis-errors": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/redis-errors/-/redis-errors-1.2.0.tgz",
      "integrity": "sha512-1qny3OExCf0UvUV/5wpYKf2YwPcOqXzkwKKSmKHiE6ZMQs5heeE/c8eXK+PNllPvmjgAbfnsbpkGZWy8cBpn9w==",
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/redis-parser": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/redis-parser/-/redis-parser-3.0.0.tgz",
      "integrity": "sha512-DJnGAeenTdpMEH6uAJRK/uiyEIH9WVsUmoLwzudwGJUwZPp80PDBWPHXSAGNPwNvIXAbe7MSUB1zQFugFml66A==",
      "license": "MIT",
      "dependencies": {
        "redis-errors": "^1.0.0"
      },
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/reflect.getprototypeof": {
      "version": "1.0.10",
      "resolved": "https://registry.npmjs.org/reflect.getprototypeof/-/reflect.getprototypeof-1.0.10.tgz",
      "integrity": "sha512-00o4I+DVrefhv+nX0ulyi3biSHCPDe+yLv5o/p6d/UVlirijB8E16FtfwSAi4g3tcqrQ4lRAqQSoFEZJehYEcw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.9",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.7",
        "get-proto": "^1.0.1",
        "which-builtin-type": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/regexp.prototype.flags": {
      "version": "1.5.4",
      "resolved": "https://registry.npmjs.org/regexp.prototype.flags/-/regexp.prototype.flags-1.5.4.tgz",
      "integrity": "sha512-dYqgNSZbDwkaJ2ceRd9ojCGjBq+mOm9LmtXnAnEGyHhN/5R7iDW2TRw3h+o/jCFxus3P2LfWIIiwowAjANm7IA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-errors": "^1.3.0",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "set-function-name": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/require-directory": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/require-directory/-/require-directory-2.1.1.tgz",
      "integrity": "sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/require-main-filename": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/require-main-filename/-/require-main-filename-2.0.0.tgz",
      "integrity": "sha512-NKN5kMDylKuldxYLSUfrbo5Tuzh4hd+2E8NPPX02mZtn1VuREQToYe/ZdlJy+J3uCpfaiGF05e7B8W0iXbQHmg==",
      "license": "ISC"
    },
    "node_modules/resolve": {
      "version": "1.22.10",
      "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.22.10.tgz",
      "integrity": "sha512-NPRy+/ncIMeDlTAsuqwKIiferiawhefFJtkNSW0qZJEqMEb+qBt/77B/jGeeek+F0uOeN05CDa6HXbbIgtVX4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-core-module": "^2.16.0",
        "path-parse": "^1.0.7",
        "supports-preserve-symlinks-flag": "^1.0.0"
      },
      "bin": {
        "resolve": "bin/resolve"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/resolve-from": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/resolve-from/-/resolve-from-4.0.0.tgz",
      "integrity": "sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/resolve-pkg-maps": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/resolve-pkg-maps/-/resolve-pkg-maps-1.0.0.tgz",
      "integrity": "sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/privatenumber/resolve-pkg-maps?sponsor=1"
      }
    },
    "node_modules/reusify": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/reusify/-/reusify-1.1.0.tgz",
      "integrity": "sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "iojs": ">=1.0.0",
        "node": ">=0.10.0"
      }
    },
    "node_modules/run-parallel": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/run-parallel/-/run-parallel-1.2.0.tgz",
      "integrity": "sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "queue-microtask": "^1.2.2"
      }
    },
    "node_modules/safe-array-concat": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/safe-array-concat/-/safe-array-concat-1.1.3.tgz",
      "integrity": "sha512-AURm5f0jYEOydBj7VQlVvDrjeFgthDdEF5H1dP+6mNpoXOMo1quQqJ4wvJDyRZ9+pO3kGWoOdmV08cSv2aJV6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "get-intrinsic": "^1.2.6",
        "has-symbols": "^1.1.0",
        "isarray": "^2.0.5"
      },
      "engines": {
        "node": ">=0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/safe-push-apply": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/safe-push-apply/-/safe-push-apply-1.0.0.tgz",
      "integrity": "sha512-iKE9w/Z7xCzUMIZqdBsp6pEQvwuEebH4vdpjcDWnyzaI6yl6O9FHvVpmGelvEHNsoY6wGblkxR6Zty/h00WiSA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "isarray": "^2.0.5"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/safe-regex-test": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/safe-regex-test/-/safe-regex-test-1.1.0.tgz",
      "integrity": "sha512-x/+Cz4YrimQxQccJf5mKEbIa1NzeCRNI5Ecl/ekmlYaampdNLPalVyIcCZNNH3MvmqBugV5TMYZXv0ljslUlaw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "is-regex": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/scheduler": {
      "version": "0.26.0",
      "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.26.0.tgz",
      "integrity": "sha512-NlHwttCI/l5gCPR3D1nNXtWABUmBwvZpEQiD4IXSbIDq8BzLIK/7Ir5gTFSGZDUu37K5cMNp0hFtzO38sC7gWA==",
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "7.7.2",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.2.tgz",
      "integrity": "sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==",
      "devOptional": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/set-blocking": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/set-blocking/-/set-blocking-2.0.0.tgz",
      "integrity": "sha512-KiKBS8AnWGEyLzofFfmvKwpdPzqiy16LvQfK3yv/fVH7Bj13/wl3JSR1J+rfgRE9q7xUJK4qvgS8raSOeLUehw==",
      "license": "ISC"
    },
    "node_modules/set-function-length": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/set-function-length/-/set-function-length-1.2.2.tgz",
      "integrity": "sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2",
        "get-intrinsic": "^1.2.4",
        "gopd": "^1.0.1",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/set-function-name": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/set-function-name/-/set-function-name-2.0.2.tgz",
      "integrity": "sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-errors": "^1.3.0",
        "functions-have-names": "^1.2.3",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/set-proto": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/set-proto/-/set-proto-1.0.0.tgz",
      "integrity": "sha512-RJRdvCo6IAnPdsvP/7m6bsQqNnn1FCBX5ZNtFL98MmFF/4xAIJTIg1YbHW5DC2W5SKZanrC6i4HsJqlajw/dZw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/sharp": {
      "version": "0.34.4",
      "resolved": "https://registry.npmjs.org/sharp/-/sharp-0.34.4.tgz",
      "integrity": "sha512-FUH39xp3SBPnxWvd5iib1X8XY7J0K0X7d93sie9CJg2PO8/7gmg89Nve6OjItK53/MlAushNNxteBYfM6DEuoA==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "@img/colour": "^1.0.0",
        "detect-libc": "^2.1.0",
        "semver": "^7.7.2"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-darwin-arm64": "0.34.4",
        "@img/sharp-darwin-x64": "0.34.4",
        "@img/sharp-libvips-darwin-arm64": "1.2.3",
        "@img/sharp-libvips-darwin-x64": "1.2.3",
        "@img/sharp-libvips-linux-arm": "1.2.3",
        "@img/sharp-libvips-linux-arm64": "1.2.3",
        "@img/sharp-libvips-linux-ppc64": "1.2.3",
        "@img/sharp-libvips-linux-s390x": "1.2.3",
        "@img/sharp-libvips-linux-x64": "1.2.3",
        "@img/sharp-libvips-linuxmusl-arm64": "1.2.3",
        "@img/sharp-libvips-linuxmusl-x64": "1.2.3",
        "@img/sharp-linux-arm": "0.34.4",
        "@img/sharp-linux-arm64": "0.34.4",
        "@img/sharp-linux-ppc64": "0.34.4",
        "@img/sharp-linux-s390x": "0.34.4",
        "@img/sharp-linux-x64": "0.34.4",
        "@img/sharp-linuxmusl-arm64": "0.34.4",
        "@img/sharp-linuxmusl-x64": "0.34.4",
        "@img/sharp-wasm32": "0.34.4",
        "@img/sharp-win32-arm64": "0.34.4",
        "@img/sharp-win32-ia32": "0.34.4",
        "@img/sharp-win32-x64": "0.34.4"
      }
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/sirv": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/sirv/-/sirv-2.0.4.tgz",
      "integrity": "sha512-94Bdh3cC2PKrbgSOUqTiGPWVZeSiXfKOVZNJniWoqrWrRkB1CJzBU3NEbiTsPcYy1lDsANA/THzS+9WBiy5nfQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@polka/url": "^1.0.0-next.24",
        "mrmime": "^2.0.0",
        "totalist": "^3.0.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/socket.io": {
      "version": "4.8.1",
      "resolved": "https://registry.npmjs.org/socket.io/-/socket.io-4.8.1.tgz",
      "integrity": "sha512-oZ7iUCxph8WYRHHcjBEc9unw3adt5CmSNlppj/5Q4k2RIrhl8Z5yY2Xr4j9zj0+wzVZ0bxmYoGSzKJnRl6A4yg==",
      "license": "MIT",
      "dependencies": {
        "accepts": "~1.3.4",
        "base64id": "~2.0.0",
        "cors": "~2.8.5",
        "debug": "~4.3.2",
        "engine.io": "~6.6.0",
        "socket.io-adapter": "~2.5.2",
        "socket.io-parser": "~4.2.4"
      },
      "engines": {
        "node": ">=10.2.0"
      }
    },
    "node_modules/socket.io-adapter": {
      "version": "2.5.5",
      "resolved": "https://registry.npmjs.org/socket.io-adapter/-/socket.io-adapter-2.5.5.tgz",
      "integrity": "sha512-eLDQas5dzPgOWCk9GuuJC2lBqItuhKI4uxGgo9aIV7MYbk2h9Q6uULEh8WBzThoI7l+qU9Ast9fVUmkqPP9wYg==",
      "license": "MIT",
      "dependencies": {
        "debug": "~4.3.4",
        "ws": "~8.17.1"
      }
    },
    "node_modules/socket.io-adapter/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io-client": {
      "version": "4.8.1",
      "resolved": "https://registry.npmjs.org/socket.io-client/-/socket.io-client-4.8.1.tgz",
      "integrity": "sha512-hJVXfu3E28NmzGk8o1sHhN3om52tRvwYeidbj7xKy2eIIse5IoKX3USlS6Tqt3BHAtflLIkCQBkzVrEEfWUyYQ==",
      "license": "MIT",
      "dependencies": {
        "@socket.io/component-emitter": "~3.1.0",
        "debug": "~4.3.2",
        "engine.io-client": "~6.6.1",
        "socket.io-parser": "~4.2.4"
      },
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/socket.io-client/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io-parser": {
      "version": "4.2.4",
      "resolved": "https://registry.npmjs.org/socket.io-parser/-/socket.io-parser-4.2.4.tgz",
      "integrity": "sha512-/GbIKmo8ioc+NIWIhwdecY0ge+qVBSMdgxGygevmdHj24bsfgtCmcUUcQ5ZzcylGFHsN3k4HB4Cgkl96KVnuew==",
      "license": "MIT",
      "dependencies": {
        "@socket.io/component-emitter": "~3.1.0",
        "debug": "~4.3.1"
      },
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/socket.io-parser/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/ssf": {
      "version": "0.11.2",
      "resolved": "https://registry.npmjs.org/ssf/-/ssf-0.11.2.tgz",
      "integrity": "sha512-+idbmIXoYET47hH+d7dfm2epdOMUDjqcB4648sTZ+t2JwoyBFL/insLfB/racrDmsKB3diwsDA696pZMieAC5g==",
      "license": "Apache-2.0",
      "dependencies": {
        "frac": "~1.1.2"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/stable-hash": {
      "version": "0.0.5",
      "resolved": "https://registry.npmjs.org/stable-hash/-/stable-hash-0.0.5.tgz",
      "integrity": "sha512-+L3ccpzibovGXFK+Ap/f8LOS0ahMrHTf3xu7mMLSpEGU0EO9ucaysSylKo9eRDFNhWve/y275iPmIZ4z39a9iA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/standard-as-callback": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/standard-as-callback/-/standard-as-callback-2.1.0.tgz",
      "integrity": "sha512-qoRRSyROncaz1z0mvYqIE4lCd9p2R90i6GxW3uZv5ucSu8tU7B5HXUP1gG8pVZsYNVaXjk8ClXHPttLyxAL48A==",
      "license": "MIT"
    },
    "node_modules/stop-iteration-iterator": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/stop-iteration-iterator/-/stop-iteration-iterator-1.1.0.tgz",
      "integrity": "sha512-eLoXW/DHyl62zxY4SCaIgnRhuMr6ri4juEYARS8E6sCEqzKpOiE521Ucofdx+KnDZl5xmvGYaaKCk5FEOxJCoQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "internal-slot": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/string-width": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
      "license": "MIT",
      "dependencies": {
        "emoji-regex": "^8.0.0",
        "is-fullwidth-code-point": "^3.0.0",
        "strip-ansi": "^6.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/string-width/node_modules/emoji-regex": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
      "license": "MIT"
    },
    "node_modules/string.prototype.includes": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/string.prototype.includes/-/string.prototype.includes-2.0.1.tgz",
      "integrity": "sha512-o7+c9bW6zpAdJHTtujeePODAhkuicdAryFsfVKwA+wGw89wJ4GTY484WTucM9hLtDEOpOvI+aHnzqnC5lHp4Rg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.3"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/string.prototype.matchall": {
      "version": "4.0.12",
      "resolved": "https://registry.npmjs.org/string.prototype.matchall/-/string.prototype.matchall-4.0.12.tgz",
      "integrity": "sha512-6CC9uyBL+/48dYizRf7H7VAYCMCNTBeM78x/VTUe9bFEaxBepPJDa1Ow99LqI/1yF7kuy7Q3cQsYMrcjGUcskA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.6",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.6",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "internal-slot": "^1.1.0",
        "regexp.prototype.flags": "^1.5.3",
        "set-function-name": "^2.0.2",
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.repeat": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/string.prototype.repeat/-/string.prototype.repeat-1.0.0.tgz",
      "integrity": "sha512-0u/TldDbKD8bFCQ/4f5+mNRrXwZ8hg2w7ZR8wa16e8z9XpePWl3eGEcUD0OXpEH/VJH/2G3gjUtR3ZOiBe2S/w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-properties": "^1.1.3",
        "es-abstract": "^1.17.5"
      }
    },
    "node_modules/string.prototype.trim": {
      "version": "1.2.10",
      "resolved": "https://registry.npmjs.org/string.prototype.trim/-/string.prototype.trim-1.2.10.tgz",
      "integrity": "sha512-Rs66F0P/1kedk5lyYyH9uBzuiI/kNRmwJAR9quK6VOtIpZ2G+hMZd+HQbbv25MgCA6gEffoMZYxlTod4WcdrKA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "define-data-property": "^1.1.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-object-atoms": "^1.0.0",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.trimend": {
      "version": "1.0.9",
      "resolved": "https://registry.npmjs.org/string.prototype.trimend/-/string.prototype.trimend-1.0.9.tgz",
      "integrity": "sha512-G7Ok5C6E/j4SGfyLCloXTrngQIQU3PWtXGst3yM7Bea9FRURf1S42ZHlZZtsNque2FN2PoUhfZXYLNWwEr4dLQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.trimstart": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/string.prototype.trimstart/-/string.prototype.trimstart-1.0.8.tgz",
      "integrity": "sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/strip-ansi": {
      "version": "6.0.1",
      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
      "license": "MIT",
      "dependencies": {
        "ansi-regex": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/strip-bom": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/strip-bom/-/strip-bom-3.0.0.tgz",
      "integrity": "sha512-vavAMRXOgBVNF6nyEEmL3DBK19iRpDcoIwW+swQ+CbGiu7lju6t+JklA1MHweoWtadgt4ISVUsXLyDq34ddcwA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/strip-json-comments": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
      "integrity": "sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/styled-jsx": {
      "version": "5.1.6",
      "resolved": "https://registry.npmjs.org/styled-jsx/-/styled-jsx-5.1.6.tgz",
      "integrity": "sha512-qSVyDTeMotdvQYoHWLNGwRFJHC+i+ZvdBRYosOFgC+Wg1vx4frN2/RG/NA7SYqqvKNLf39P2LSRA2pu6n0XYZA==",
      "license": "MIT",
      "dependencies": {
        "client-only": "0.0.1"
      },
      "engines": {
        "node": ">= 12.0.0"
      },
      "peerDependencies": {
        "react": ">= 16.8.0 || 17.x.x || ^18.0.0-0 || ^19.0.0-0"
      },
      "peerDependenciesMeta": {
        "@babel/core": {
          "optional": true
        },
        "babel-plugin-macros": {
          "optional": true
        }
      }
    },
    "node_modules/supports-color": {
      "version": "7.2.0",
      "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz",
      "integrity": "sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-flag": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/supports-preserve-symlinks-flag": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/supports-preserve-symlinks-flag/-/supports-preserve-symlinks-flag-1.0.0.tgz",
      "integrity": "sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/tabbable": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/tabbable/-/tabbable-6.2.0.tgz",
      "integrity": "sha512-Cat63mxsVJlzYvN51JmVXIgNoUokrIaT2zLclCXjRd8boZ0004U4KCs/sToJ75C6sdlByWxpYnb5Boif1VSFew==",
      "license": "MIT"
    },
    "node_modules/tailwind-merge": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/tailwind-merge/-/tailwind-merge-3.3.1.tgz",
      "integrity": "sha512-gBXpgUm/3rp1lMZZrM/w7D8GKqshif0zAymAhbCyIt8KMe+0v9DQ7cdYLR4FHH/cKpdTXb+A/tKKU3eolfsI+g==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/dcastil"
      }
    },
    "node_modules/tailwindcss": {
      "version": "4.1.13",
      "resolved": "https://registry.npmjs.org/tailwindcss/-/tailwindcss-4.1.13.tgz",
      "integrity": "sha512-i+zidfmTqtwquj4hMEwdjshYYgMbOrPzb9a0M3ZgNa0JMoZeFC6bxZvO8yr8ozS6ix2SDz0+mvryPeBs2TFE+w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/tapable": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/tapable/-/tapable-2.2.3.tgz",
      "integrity": "sha512-ZL6DDuAlRlLGghwcfmSn9sK3Hr6ArtyudlSAiCqQ6IfE+b+HHbydbYDIG15IfS5do+7XQQBdBiubF/cV2dnDzg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/webpack"
      }
    },
    "node_modules/tar": {
      "version": "7.5.1",
      "resolved": "https://registry.npmjs.org/tar/-/tar-7.5.1.tgz",
      "integrity": "sha512-nlGpxf+hv0v7GkWBK2V9spgactGOp0qvfWRxUMjqHyzrt3SgwE48DIv/FhqPHJYLHpgW1opq3nERbz5Anq7n1g==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "@isaacs/fs-minipass": "^4.0.0",
        "chownr": "^3.0.0",
        "minipass": "^7.1.2",
        "minizlib": "^3.1.0",
        "yallist": "^5.0.0"
      },
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/tar/node_modules/yallist": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-5.0.0.tgz",
      "integrity": "sha512-YgvUTfwqyc7UXVMrB+SImsVYSmTS8X/tSrtdNZMImM+n7+QTriRXyXim0mBrTXNeqzVF0KWGgHPeiyViFFrNDw==",
      "dev": true,
      "license": "BlueOak-1.0.0",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/tinyexec": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/tinyexec/-/tinyexec-1.0.1.tgz",
      "integrity": "sha512-5uC6DDlmeqiOwCPmK9jMSdOuZTh8bU39Ys6yidB+UTt5hfZUPGAypSgFRiEp+jbi9qH40BLDvy85jIU88wKSqw==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/tinyglobby": {
      "version": "0.2.15",
      "resolved": "https://registry.npmjs.org/tinyglobby/-/tinyglobby-0.2.15.tgz",
      "integrity": "sha512-j2Zq4NyQYG5XMST4cbs02Ak8iJUdxRM0XI5QyxXuZOzKOINmWurp3smXu3y5wDcJrptwpSjgXHzIQxR0omXljQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fdir": "^6.5.0",
        "picomatch": "^4.0.3"
      },
      "engines": {
        "node": ">=12.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/SuperchupuDev"
      }
    },
    "node_modules/tinyglobby/node_modules/fdir": {
      "version": "6.5.0",
      "resolved": "https://registry.npmjs.org/fdir/-/fdir-6.5.0.tgz",
      "integrity": "sha512-tIbYtZbucOs0BRGqPJkshJUYdL+SDH7dVM8gjy+ERp3WAUjLEFJE+02kanyHtwjWOnwrKYBiwAmM0p4kLJAnXg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12.0.0"
      },
      "peerDependencies": {
        "picomatch": "^3 || ^4"
      },
      "peerDependenciesMeta": {
        "picomatch": {
          "optional": true
        }
      }
    },
    "node_modules/tinyglobby/node_modules/picomatch": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
      "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/to-regex-range": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",
      "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-number": "^7.0.0"
      },
      "engines": {
        "node": ">=8.0"
      }
    },
    "node_modules/totalist": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/totalist/-/totalist-3.0.1.tgz",
      "integrity": "sha512-sf4i37nQ2LBx4m3wB74y+ubopq6W/dIzXg0FDGjsYnZHVa1Da8FH853wlL2gtUhg+xJXjfk3kUZS3BRoQeoQBQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/ts-api-utils": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/ts-api-utils/-/ts-api-utils-2.1.0.tgz",
      "integrity": "sha512-CUgTZL1irw8u29bzrOD/nH85jqyc74D6SshFgujOIA7osm2Rz7dYH77agkx7H4FBNxDq7Cjf+IjaX/8zwFW+ZQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18.12"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4"
      }
    },
    "node_modules/ts-custom-error": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/ts-custom-error/-/ts-custom-error-3.3.1.tgz",
      "integrity": "sha512-5OX1tzOjxWEgsr/YEUWSuPrQ00deKLh6D7OTWcvNHm12/7QPyRh8SYpyWvA4IZv8H/+GQWQEh/kwo95Q9OVW1A==",
      "license": "MIT",
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/ts-node": {
      "version": "10.9.2",
      "resolved": "https://registry.npmjs.org/ts-node/-/ts-node-10.9.2.tgz",
      "integrity": "sha512-f0FFpIdcHgn8zcPSbf1dRevwt047YMnaiJM3u2w2RewrB+fob/zePZcrOyQoLMMO7aBIddLcQIEK5dYjkLnGrQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@cspotcode/source-map-support": "^0.8.0",
        "@tsconfig/node10": "^1.0.7",
        "@tsconfig/node12": "^1.0.7",
        "@tsconfig/node14": "^1.0.0",
        "@tsconfig/node16": "^1.0.2",
        "acorn": "^8.4.1",
        "acorn-walk": "^8.1.1",
        "arg": "^4.1.0",
        "create-require": "^1.1.0",
        "diff": "^4.0.1",
        "make-error": "^1.1.1",
        "v8-compile-cache-lib": "^3.0.1",
        "yn": "3.1.1"
      },
      "bin": {
        "ts-node": "dist/bin.js",
        "ts-node-cwd": "dist/bin-cwd.js",
        "ts-node-esm": "dist/bin-esm.js",
        "ts-node-script": "dist/bin-script.js",
        "ts-node-transpile-only": "dist/bin-transpile.js",
        "ts-script": "dist/bin-script-deprecated.js"
      },
      "peerDependencies": {
        "@swc/core": ">=1.2.50",
        "@swc/wasm": ">=1.2.50",
        "@types/node": "*",
        "typescript": ">=2.7"
      },
      "peerDependenciesMeta": {
        "@swc/core": {
          "optional": true
        },
        "@swc/wasm": {
          "optional": true
        }
      }
    },
    "node_modules/tsconfig-paths": {
      "version": "3.15.0",
      "resolved": "https://registry.npmjs.org/tsconfig-paths/-/tsconfig-paths-3.15.0.tgz",
      "integrity": "sha512-2Ac2RgzDe/cn48GvOe3M+o82pEFewD3UPbyoUHHdKasHwJKjds4fLXWf/Ux5kATBKN20oaFGu+jbElp1pos0mg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/json5": "^0.0.29",
        "json5": "^1.0.2",
        "minimist": "^1.2.6",
        "strip-bom": "^3.0.0"
      }
    },
    "node_modules/tslib": {
      "version": "2.8.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-2.8.1.tgz",
      "integrity": "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==",
      "license": "0BSD"
    },
    "node_modules/tsx": {
      "version": "4.20.6",
      "resolved": "https://registry.npmjs.org/tsx/-/tsx-4.20.6.tgz",
      "integrity": "sha512-ytQKuwgmrrkDTFP4LjR0ToE2nqgy886GpvRSpU0JAnrdBYppuY5rLkRUYPU1yCryb24SsKBTL/hlDQAEFVwtZg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "esbuild": "~0.25.0",
        "get-tsconfig": "^4.7.5"
      },
      "bin": {
        "tsx": "dist/cli.mjs"
      },
      "engines": {
        "node": ">=18.0.0"
      },
      "optionalDependencies": {
        "fsevents": "~2.3.3"
      }
    },
    "node_modules/type-check": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz",
      "integrity": "sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/typed-array-buffer": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/typed-array-buffer/-/typed-array-buffer-1.0.3.tgz",
      "integrity": "sha512-nAYYwfY3qnzX30IkA6AQZjVbtK6duGontcQm1WSG1MD94YLqK0515GNApXkoxKOWMusVssAHWLh9SeaoefYFGw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-typed-array": "^1.1.14"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/typed-array-byte-length": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/typed-array-byte-length/-/typed-array-byte-length-1.0.3.tgz",
      "integrity": "sha512-BaXgOuIxz8n8pIq3e7Atg/7s+DpiYrxn4vdot3w9KbnBhcRQq6o3xemQdIfynqSeXeDrF32x+WvfzmOjPiY9lg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "for-each": "^0.3.3",
        "gopd": "^1.2.0",
        "has-proto": "^1.2.0",
        "is-typed-array": "^1.1.14"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typed-array-byte-offset": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/typed-array-byte-offset/-/typed-array-byte-offset-1.0.4.tgz",
      "integrity": "sha512-bTlAFB/FBYMcuX81gbL4OcpH5PmlFHqlCCpAl8AlEzMz5k53oNDvN8p1PNOWLEmI2x4orp3raOFB51tv9X+MFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "for-each": "^0.3.3",
        "gopd": "^1.2.0",
        "has-proto": "^1.2.0",
        "is-typed-array": "^1.1.15",
        "reflect.getprototypeof": "^1.0.9"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typed-array-length": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/typed-array-length/-/typed-array-length-1.0.7.tgz",
      "integrity": "sha512-3KS2b+kL7fsuk/eJZ7EQdnEmQoaho/r6KUef7hxvltNA5DR8NAUM+8wJMbJyZ4G9/7i3v5zPBIMN5aybAh2/Jg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "for-each": "^0.3.3",
        "gopd": "^1.0.1",
        "is-typed-array": "^1.1.13",
        "possible-typed-array-names": "^1.0.0",
        "reflect.getprototypeof": "^1.0.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typescript": {
      "version": "5.9.2",
      "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.9.2.tgz",
      "integrity": "sha512-CWBzXQrc/qOkhidw1OzBTQuYRbfyxDXJMVJ1XNwUHGROVmuaeiEm3OslpZ1RV96d7SKKjZKrSJu3+t/xlw3R9A==",
      "devOptional": true,
      "license": "Apache-2.0",
      "bin": {
        "tsc": "bin/tsc",
        "tsserver": "bin/tsserver"
      },
      "engines": {
        "node": ">=14.17"
      }
    },
    "node_modules/uid2": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/uid2/-/uid2-1.0.0.tgz",
      "integrity": "sha512-+I6aJUv63YAcY9n4mQreLUt0d4lvwkkopDNmpomkAUz0fAkEMV9pRWxN0EjhW1YfRhcuyHg2v3mwddCDW1+LFQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 4.0.0"
      }
    },
    "node_modules/unbox-primitive": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/unbox-primitive/-/unbox-primitive-1.1.0.tgz",
      "integrity": "sha512-nWJ91DjeOkej/TA8pXQ3myruKpKEYgqvpw9lz4OPHj/NWFNluYrjbz9j01CJ8yKQd2g4jFoOkINCTW2I5LEEyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-bigints": "^1.0.2",
        "has-symbols": "^1.1.0",
        "which-boxed-primitive": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/undici-types": {
      "version": "6.21.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz",
      "integrity": "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==",
      "license": "MIT"
    },
    "node_modules/unrs-resolver": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/unrs-resolver/-/unrs-resolver-1.11.1.tgz",
      "integrity": "sha512-bSjt9pjaEBnNiGgc9rUiHGKv5l4/TGzDmYw3RhnkJGtLhbnnA/5qJj7x3dNDCRx/PJxu774LlH8lCOlB4hEfKg==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "napi-postinstall": "^0.3.0"
      },
      "funding": {
        "url": "https://opencollective.com/unrs-resolver"
      },
      "optionalDependencies": {
        "@unrs/resolver-binding-android-arm-eabi": "1.11.1",
        "@unrs/resolver-binding-android-arm64": "1.11.1",
        "@unrs/resolver-binding-darwin-arm64": "1.11.1",
        "@unrs/resolver-binding-darwin-x64": "1.11.1",
        "@unrs/resolver-binding-freebsd-x64": "1.11.1",
        "@unrs/resolver-binding-linux-arm-gnueabihf": "1.11.1",
        "@unrs/resolver-binding-linux-arm-musleabihf": "1.11.1",
        "@unrs/resolver-binding-linux-arm64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-arm64-musl": "1.11.1",
        "@unrs/resolver-binding-linux-ppc64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-riscv64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-riscv64-musl": "1.11.1",
        "@unrs/resolver-binding-linux-s390x-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-x64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-x64-musl": "1.11.1",
        "@unrs/resolver-binding-wasm32-wasi": "1.11.1",
        "@unrs/resolver-binding-win32-arm64-msvc": "1.11.1",
        "@unrs/resolver-binding-win32-ia32-msvc": "1.11.1",
        "@unrs/resolver-binding-win32-x64-msvc": "1.11.1"
      }
    },
    "node_modules/uri-js": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
      "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "punycode": "^2.1.0"
      }
    },
    "node_modules/uuid": {
      "version": "8.3.2",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",
      "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",
      "license": "MIT",
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/v8-compile-cache-lib": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/v8-compile-cache-lib/-/v8-compile-cache-lib-3.0.1.tgz",
      "integrity": "sha512-wa7YjyUGfNZngI/vtK0UHAN+lgDCxBPCylVXGp0zu59Fz5aiGtNXaq3DhIov063MorB+VfufLh3JlF2KdTK3xg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/webpack-bundle-analyzer": {
      "version": "4.10.1",
      "resolved": "https://registry.npmjs.org/webpack-bundle-analyzer/-/webpack-bundle-analyzer-4.10.1.tgz",
      "integrity": "sha512-s3P7pgexgT/HTUSYgxJyn28A+99mmLq4HsJepMPzu0R8ImJc52QNqaFYW1Z2z2uIb1/J3eYgaAWVpaC+v/1aAQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@discoveryjs/json-ext": "0.5.7",
        "acorn": "^8.0.4",
        "acorn-walk": "^8.0.0",
        "commander": "^7.2.0",
        "debounce": "^1.2.1",
        "escape-string-regexp": "^4.0.0",
        "gzip-size": "^6.0.0",
        "html-escaper": "^2.0.2",
        "is-plain-object": "^5.0.0",
        "opener": "^1.5.2",
        "picocolors": "^1.0.0",
        "sirv": "^2.0.3",
        "ws": "^7.3.1"
      },
      "bin": {
        "webpack-bundle-analyzer": "lib/bin/analyzer.js"
      },
      "engines": {
        "node": ">= 10.13.0"
      }
    },
    "node_modules/webpack-bundle-analyzer/node_modules/ws": {
      "version": "7.5.10",
      "resolved": "https://registry.npmjs.org/ws/-/ws-7.5.10.tgz",
      "integrity": "sha512-+dbF1tHwZpXcbOJdVOkzLDxZP1ailvSxM6ZweXTegylPny803bFhA+vqBYw4s31NSAk4S2Qz+AKXK9a4wkdjcQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8.3.0"
      },
      "peerDependencies": {
        "bufferutil": "^4.0.1",
        "utf-8-validate": "^5.0.2"
      },
      "peerDependenciesMeta": {
        "bufferutil": {
          "optional": true
        },
        "utf-8-validate": {
          "optional": true
        }
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/which-boxed-primitive": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/which-boxed-primitive/-/which-boxed-primitive-1.1.1.tgz",
      "integrity": "sha512-TbX3mj8n0odCBFVlY8AxkqcHASw3L60jIuF8jFP78az3C2YhmGvqbHBpAjTRH2/xqYunrJ9g1jSyjCjpoWzIAA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-bigint": "^1.1.0",
        "is-boolean-object": "^1.2.1",
        "is-number-object": "^1.1.1",
        "is-string": "^1.1.1",
        "is-symbol": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-builtin-type": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/which-builtin-type/-/which-builtin-type-1.2.1.tgz",
      "integrity": "sha512-6iBczoX+kDQ7a3+YJBnh3T+KZRxM/iYNPXicqk66/Qfm1b93iu+yOImkg0zHbj5LNOcNv1TEADiZ0xa34B4q6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "function.prototype.name": "^1.1.6",
        "has-tostringtag": "^1.0.2",
        "is-async-function": "^2.0.0",
        "is-date-object": "^1.1.0",
        "is-finalizationregistry": "^1.1.0",
        "is-generator-function": "^1.0.10",
        "is-regex": "^1.2.1",
        "is-weakref": "^1.0.2",
        "isarray": "^2.0.5",
        "which-boxed-primitive": "^1.1.0",
        "which-collection": "^1.0.2",
        "which-typed-array": "^1.1.16"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-collection": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/which-collection/-/which-collection-1.0.2.tgz",
      "integrity": "sha512-K4jVyjnBdgvc86Y6BkaLZEN933SwYOuBFkdmBu9ZfkcAbdVbpITnDmjvZ/aQjRXQrv5EPkTnD1s39GiiqbngCw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-map": "^2.0.3",
        "is-set": "^2.0.3",
        "is-weakmap": "^2.0.2",
        "is-weakset": "^2.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-module": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/which-module/-/which-module-2.0.1.tgz",
      "integrity": "sha512-iBdZ57RDvnOR9AGBhML2vFZf7h8vmBjhoaZqODJBFWHVtKkDmKuHai3cx5PgVMrX5YDNp27AofYbAwctSS+vhQ==",
      "license": "ISC"
    },
    "node_modules/which-typed-array": {
      "version": "1.1.19",
      "resolved": "https://registry.npmjs.org/which-typed-array/-/which-typed-array-1.1.19.tgz",
      "integrity": "sha512-rEvr90Bck4WZt9HHFC4DJMsjvu7x+r6bImz0/BrbWb7A2djJ8hnZMrWnHo9F8ssv0OMErasDhftrfROTyqSDrw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "for-each": "^0.3.5",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/wmf": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wmf/-/wmf-1.0.2.tgz",
      "integrity": "sha512-/p9K7bEh0Dj6WbXg4JG0xvLQmIadrner1bi45VMJTfnbVHsc7yIajZyoSoK60/dtVBs12Fm6WkUI5/3WAVsNMw==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/word": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/word/-/word-0.3.0.tgz",
      "integrity": "sha512-OELeY0Q61OXpdUfTp+oweA/vtLVg5VDOXh+3he3PNzLGG/y0oylSOC1xRVj0+l4vQ3tj/bB1HVHv1ocXkQceFA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/word-wrap": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz",
      "integrity": "sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/wrap-ansi": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-6.2.0.tgz",
      "integrity": "sha512-r6lPcBGxZXlIcymEu7InxDMhdW0KDxpLgoFLcguasxCaJ/SOIZwINatK9KY/tf+ZrlywOKU0UDj3ATXUBfxJXA==",
      "license": "MIT",
      "dependencies": {
        "ansi-styles": "^4.0.0",
        "string-width": "^4.1.0",
        "strip-ansi": "^6.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/ws": {
      "version": "8.17.1",
      "resolved": "https://registry.npmjs.org/ws/-/ws-8.17.1.tgz",
      "integrity": "sha512-6XQFvXTkbfUOZOKKILFG1PDK2NDQs4azKQl26T0YS5CxqWLgXajbPZ+h4gZekJyRqFU8pvnbAbbs/3TgRPy+GQ==",
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      },
      "peerDependencies": {
        "bufferutil": "^4.0.1",
        "utf-8-validate": ">=5.0.2"
      },
      "peerDependenciesMeta": {
        "bufferutil": {
          "optional": true
        },
        "utf-8-validate": {
          "optional": true
        }
      }
    },
    "node_modules/xlsx": {
      "version": "0.18.5",
      "resolved": "https://registry.npmjs.org/xlsx/-/xlsx-0.18.5.tgz",
      "integrity": "sha512-dmg3LCjBPHZnQp5/F/+nnTa+miPJxUXB6vtk42YjBBKayDNagxGEeIdWApkYPOf3Z3pm3k62Knjzp7lMeTEtFQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "adler-32": "~1.3.0",
        "cfb": "~1.2.1",
        "codepage": "~1.15.0",
        "crc-32": "~1.2.1",
        "ssf": "~0.11.2",
        "wmf": "~1.0.1",
        "word": "~0.3.0"
      },
      "bin": {
        "xlsx": "bin/xlsx.njs"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/xmlhttprequest-ssl": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/xmlhttprequest-ssl/-/xmlhttprequest-ssl-2.1.2.tgz",
      "integrity": "sha512-TEU+nJVUUnA4CYJFLvK5X9AOeH4KvDvhIfm0vV1GaQRtchnG0hgK5p8hw/xjv8cunWYCsiPCSDzObPyhEwq3KQ==",
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/y18n": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/y18n/-/y18n-4.0.3.tgz",
      "integrity": "sha512-JKhqTOwSrqNA1NY5lSztJ1GrBiUodLMmIZuLiDaMRJ+itFd+ABVE8XBjOvIWL+rSqNDC74LCSFmlb/U4UZ4hJQ==",
      "license": "ISC"
    },
    "node_modules/yallist": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz",
      "integrity": "sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==",
      "license": "ISC"
    },
    "node_modules/yargs": {
      "version": "15.4.1",
      "resolved": "https://registry.npmjs.org/yargs/-/yargs-15.4.1.tgz",
      "integrity": "sha512-aePbxDmcYW++PaqBsJ+HYUFwCdv4LVvdnhBy78E57PIor8/OVvhMrADFFEDh8DHDFRv/O9i3lPhsENjO7QX0+A==",
      "license": "MIT",
      "dependencies": {
        "cliui": "^6.0.0",
        "decamelize": "^1.2.0",
        "find-up": "^4.1.0",
        "get-caller-file": "^2.0.1",
        "require-directory": "^2.1.1",
        "require-main-filename": "^2.0.0",
        "set-blocking": "^2.0.0",
        "string-width": "^4.2.0",
        "which-module": "^2.0.0",
        "y18n": "^4.0.0",
        "yargs-parser": "^18.1.2"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/yargs-parser": {
      "version": "18.1.3",
      "resolved": "https://registry.npmjs.org/yargs-parser/-/yargs-parser-18.1.3.tgz",
      "integrity": "sha512-o50j0JeToy/4K6OZcaQmW6lyXXKhq7csREXcDwk2omFPJEwUNOVtJKvmDr9EI1fAJZUyZcRF7kxGBWmRXudrCQ==",
      "license": "ISC",
      "dependencies": {
        "camelcase": "^5.0.0",
        "decamelize": "^1.2.0"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/yargs/node_modules/find-up": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/find-up/-/find-up-4.1.0.tgz",
      "integrity": "sha512-PpOwAdQ/YlXQ2vj8a3h8IipDuYRi3wceVQQGYWxNINccq40Anw7BlsEXCMbt1Zt+OLA6Fq9suIpIWD0OsnISlw==",
      "license": "MIT",
      "dependencies": {
        "locate-path": "^5.0.0",
        "path-exists": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/yargs/node_modules/locate-path": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-5.0.0.tgz",
      "integrity": "sha512-t7hw9pI+WvuwNJXwk5zVHpyhIqzg2qTlklJOf0mVxGSbe3Fp2VieZcduNYjaLDoy6p9uGpQEGWG87WpMKlNq8g==",
      "license": "MIT",
      "dependencies": {
        "p-locate": "^4.1.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/yargs/node_modules/p-limit": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-2.3.0.tgz",
      "integrity": "sha512-//88mFWSJx8lxCzwdAABTJL2MyWB12+eIY7MDL2SqLmAkeKU9qxRvWuSyTjm3FUmpBEMuFfckAIqEaVGUDxb6w==",
      "license": "MIT",
      "dependencies": {
        "p-try": "^2.0.0"
      },
      "engines": {
        "node": ">=6"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/yargs/node_modules/p-locate": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-4.1.0.tgz",
      "integrity": "sha512-R79ZZ/0wAxKGu3oYMlz8jy/kbhsNrS7SKZ7PxEHBgJ5+F2mtFW2fK2cOtBh1cHYkQsbzFV7I+EoRKe6Yt0oK7A==",
      "license": "MIT",
      "dependencies": {
        "p-limit": "^2.2.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/yn": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/yn/-/yn-3.1.1.tgz",
      "integrity": "sha512-Ux4ygGWsu2c7isFWe8Yu1YluJmqVhxqK2cLXNQA5AcC3QfbGNpM7fu0Y8b/z16pXLnFxZYvWhd3fhBY9DLmC6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/yocto-queue": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
      "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/zod": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/zod/-/zod-4.1.11.tgz",
      "integrity": "sha512-WPsqwxITS2tzx1bzhIKsEs19ABD5vmCVa4xBo2tq/SrV4RNZtfws1EnCWQXM6yh8bD08a1idvkB5MZSBiZsjwg==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/colinhacks"
      }
    },
    "node_modules/zustand": {
      "version": "5.0.8",
      "resolved": "https://registry.npmjs.org/zustand/-/zustand-5.0.8.tgz",
      "integrity": "sha512-gyPKpIaxY9XcO2vSMrLbiER7QMAMGOQZVRdJ6Zi782jkbzZygq5GI9nG8g+sMgitRtndwaBSl7uiqC49o1SSiw==",
      "license": "MIT",
      "engines": {
        "node": ">=12.20.0"
      },
      "peerDependencies": {
        "@types/react": ">=18.0.0",
        "immer": ">=9.0.6",
        "react": ">=18.0.0",
        "use-sync-external-store": ">=1.2.0"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "immer": {
          "optional": true
        },
        "react": {
          "optional": true
        },
        "use-sync-external-store": {
          "optional": true
        }
      }
    }
  }
}


=== FILE: package.json ===
{
  "name": "simple-crud-auth",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "dev:server": "node server.js",
    "build": "next build",
    "start": "next start",
    "start:server": "NODE_ENV=production node server.js",
    "lint": "eslint .",
    "typecheck": "tsc -p tsconfig.json --noEmit",
    "seed": "npx prisma migrate reset && tsx prisma/seed.ts",
    "seed:new": "npx prisma migrate reset && tsx prisma/new-seed.ts",
    "analyze": "cross-env ANALYZE=true next build"
  },
  "prisma": {
    "seed": "tsx prisma/seed.ts"
  },
  "dependencies": {
    "@heroicons/react": "^2.2.0",
    "@prisma/client": "^6.13.0",
    "@socket.io/redis-adapter": "^8.3.0",
    "@types/qrcode": "^1.5.5",
    "@zxing/browser": "^0.1.5",
    "@zxing/library": "^0.21.3",
    "bcryptjs": "^3.0.2",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "ioredis": "^5.7.0",
    "lucide-react": "^0.539.0",
    "next": "15.4.6",
    "next-auth": "^4.24.11",
    "pdf-lib": "^1.17.1",
    "qrcode": "^1.5.4",
    "react": "19.1.0",
    "react-datepicker": "^8.7.0",
    "react-dom": "19.1.0",
    "socket.io": "^4.8.1",
    "socket.io-client": "^4.8.1",
    "tailwind-merge": "^3.3.1",
    "xlsx": "^0.18.5",
    "zod": "^4.0.17",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.3.1",
    "@next/bundle-analyzer": "^15.5.2",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20.19.10",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "cross-env": "^10.0.0",
    "eslint": "^9.35.0",
    "eslint-config-next": "^15.5.2",
    "prisma": "^6.13.0",
    "tailwindcss": "^4",
    "ts-node": "^10.9.2",
    "tsx": "^4.20.4",
    "typescript": "^5.9.2"
  }
}


=== FILE: prisma/new-seed.ts ===
import { PrismaClient, User_role } from "@prisma/client";
import bcrypt from "bcryptjs";

const prisma = new PrismaClient();

async function cleanDatabase() {
  console.log("🧹 Membersihkan database sebelum seeding...");
  
  try {
    // Hapus data dengan urutan yang benar (child tables dulu, lalu parent tables)
    await prisma.qrScan.deleteMany({});
    console.log("   ✓ Semua data QR scans dihapus");
    
    await prisma.notificationRead.deleteMany({});
    console.log("   ✓ Semua data notification reads dihapus");
    
    await prisma.notification.deleteMany({});
    console.log("   ✓ Semua data notifications dihapus");
    
    await prisma.workerList.deleteMany({});
    console.log("   ✓ Semua data worker list dihapus");
    
    await prisma.submission.deleteMany({});
    console.log("   ✓ Semua data submission dihapus");
    
    await prisma.refreshToken.deleteMany({});
    console.log("   ✓ Semua data refresh tokens dihapus");
    
    await prisma.session.deleteMany({});
    console.log("   ✓ Semua data sessions dihapus");
    
    await prisma.account.deleteMany({});
    console.log("   ✓ Semua data accounts dihapus");
    
    await prisma.user.deleteMany({});
    console.log("   ✓ Semua data user dihapus");
    
    console.log("🧹 Database berhasil dibersihkan");
  } catch (error) {
    console.error("❌ Error saat membersihkan database:", error);
    throw error;
  }
}

async function main() {
  // Bersihkan database terlebih dahulu
  await cleanDatabase();

  console.log("🌱 Memulai proses seeding...");
  
  const users = [
    {
      officer_name: "Super Admin",
      email: "superadmin@example.com",
      password: "superadmin123",
      role: User_role.SUPER_ADMIN,
      profile_photo: null,
      address: "Jl. Super Admin No. 1, Jakarta",
      phone_number: "081234567888",
      vendor_name: null, // kosong untuk super admin
      verified_at: new Date(), // super admin sudah terverifikasi
      verified_by: "SYSTEM",
    },
    {
      officer_name: "Verifier Utama",
      email: "verifier@example.com",
      password: "verifier123",
      role: User_role.VERIFIER,
      profile_photo: null,
      address: "Jl. Verifier No. 2, Jakarta",
      phone_number: "081234567891",
      vendor_name: null, // kosong untuk verifier
      verified_at: new Date(), // verifier sudah terverifikasi
      verified_by: "SUPER_ADMIN",
    },
    {
      officer_name: "Verifier Kedua",
      email: "verifier2@example.com",
      password: "verifier123",
      role: User_role.VERIFIER,
      profile_photo: null,
      address: "Jl. Verifier No. 3, Bandung",
      phone_number: "081234567899",
      vendor_name: null,
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
    },
    {
      officer_name: "Vendor A Petugas",
      email: "vendora@example.com",
      password: "vendor123",
      role: User_role.VENDOR,
      profile_photo: null,
      address: "Jl. Vendor A No. 3, Jakarta",
      phone_number: "081234567892",
      vendor_name: "PT. AHMAD VENDOR SERVICES",
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
    },
    {
      officer_name: "Vendor B Petugas",
      email: "vendorb@example.com",
      password: "vendor123",
      role: User_role.VENDOR,
      profile_photo: null,
      address: "Jl. Vendor B No. 4, Bandung",
      phone_number: "081234567893",
      vendor_name: "PT. BUANA KONSTRUKSI",
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
    },
    {
      officer_name: "Vendor C Petugas",
      email: "vendorc@example.com",
      password: "vendor123",
      role: User_role.VENDOR,
      profile_photo: null,
      address: "Jl. Vendor C No. 5, Surabaya",
      phone_number: "081234567894",
      vendor_name: "CV. CIPTA MANDIRI",
      verified_at: null, // vendor belum terverifikasi
      verified_by: null,
    },
    {
      officer_name: "Vendor D Petugas",
      email: "vendord@example.com",
      password: "vendor123",
      role: User_role.VENDOR,
      profile_photo: null,
      address: "Jl. Vendor D No. 6, Medan",
      phone_number: "081234567895",
      vendor_name: "PT. DELTA ENGINEERING",
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
    },
  ];

  console.log("👥 Membuat users...");
  const createdUsers: { [key: string]: any } = {};

  for (const user of users) {
    const hashedPassword = await bcrypt.hash(user.password, 10);

    const createdUser = await prisma.user.upsert({
      where: { email: user.email },
      update: {}, // tidak update kalau sudah ada
      create: {
        officer_name: user.officer_name,
        email: user.email,
        password: hashedPassword,
        role: user.role,
        profile_photo: user.profile_photo,
        address: user.address,
        phone_number: user.phone_number,
        vendor_name: user.vendor_name,
        verified_at: user.verified_at,
        verified_by: user.verified_by,
      },
    });

    createdUsers[user.email] = createdUser;
  }

  console.log(`   ✓ ${Object.keys(createdUsers).length} users berhasil dibuat`);

  // Create sample submissions
  console.log("📋 Membuat sample submissions...");
  const superAdmin = createdUsers["superadmin@example.com"];
  const verifiers = Object.values(createdUsers).filter((user: any) => user.role === 'VERIFIER');
  const vendorUsers = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR');

  const submissionTemplates = [
    {
      based_on: "Kontrak Kerja No. KK/2024/001",
      job_description: "Maintenance Mesin Produksi",
      work_location: "Pabrik Jakarta Plant 1",
      working_hours: "08:00 - 17:00 WIB",
      work_facilities: "Toolkit lengkap, APD standar, crane mobile",
      worker_names: "Ahmad Suharto\nBudi Santoso\nCarlos Wijaya\nDedi Pratama\nEko Setiawan",
      signer_position: "Manager Operasional",
      signer_name: "Ir. Bambang Suryadi",
    },
    {
      based_on: "SPK No. SPK/2024/002",
      job_description: "Instalasi Sistem Keamanan",
      work_location: "Gedung Kantor Pusat",
      working_hours: "09:00 - 16:00 WIB",
      work_facilities: "Kamera CCTV, kabel, tools instalasi",
      worker_names: "Fajar Nugraha\nGunawan Putra\nHendro Saputra",
      signer_position: "Kepala Security",
      signer_name: "Drs. Agus Salim",
    },
    {
      based_on: "Kontrak Pembangunan No. KB/2024/003",
      job_description: "Renovasi Gudang",
      work_location: "Gudang Distribusi Bandung",
      working_hours: "07:00 - 16:00 WIB",
      work_facilities: "Alat berat, material bangunan, scaffolding",
      worker_names: "Irwan Budiman\nJoko Susilo\nKarim Abdullah\nLutfi Rahman\nMaman Suryadi\nNando Pratama\nOktavio Wijaya\nPutra Ramadhan\nQomar Yusuf\nRizky Mahendra",
      signer_position: "Project Manager",
      signer_name: "Ir. Siti Nurhaliza, MT",
    },
    {
      based_on: "Work Order No. WO/2024/004",
      job_description: "Pemeliharaan Jaringan IT",
      work_location: "Data Center Jakarta",
      working_hours: "20:00 - 05:00 WIB",
      work_facilities: "Server equipment, testing tools, laptop",
      worker_names: "Sandi Kurniawan\nTeguh Prasetyo",
      signer_position: "IT Manager",
      signer_name: "Ir. Made Wirawan",
    },
    {
      based_on: "Kontrak Layanan No. KL/2024/005",
      job_description: "Cleaning Service",
      work_location: "Komplek Perkantoran",
      working_hours: "18:00 - 06:00 WIB",
      work_facilities: "Peralatan cleaning, chemical, vacuum cleaner",
      worker_names: "Usman Hakim\nVina Sari\nWahyu Utomo\nXenia Putri\nYulianto Siswanto\nZainal Abidin\nAni Rahayu\nBayu Setiawan",
      signer_position: "Facility Manager",
      signer_name: "Dra. Rina Kartika",
    },
    {
      based_on: "SPK No. SPK/2024/006",
      job_description: "Pengecatan Gedung",
      work_location: "Gedung Perkantoran Tower A",
      working_hours: "08:00 - 15:00 WIB",
      work_facilities: "Cat, kuas, roller, scaffolding, drop cloth",
      worker_names: "Candra Wijaya\nDani Hartono\nEdi Susanto\nFarid Nugroho\nGalih Pratama\nHaris Setiawan",
      signer_position: "Building Manager",
      signer_name: "Ir. Hendra Kusuma",
    },
    {
      based_on: "Kontrak Kerja No. KK/2024/007",
      job_description: "Instalasi AC Central",
      work_location: "Mall Jakarta Timur",
      working_hours: "06:00 - 14:00 WIB",
      work_facilities: "Unit AC, ducting, tools HVAC, crane",
      worker_names: "Iman Santoso\nJamal Abdurrahman\nKurnia Sari\nLanang Prasetyo\nMuhammad Rizki\nNurul Hidayah\nOctavianus Putra\nPratama Wijaya",
      signer_position: "Technical Manager",
      signer_name: "Ir. Yudi Prasetyo, MT",
    },
    {
      based_on: "Work Order No. WO/2024/008",
      job_description: "Perbaikan Jalan Akses",
      work_location: "Area Industri Cikarang",
      working_hours: "07:00 - 17:00 WIB",
      work_facilities: "Aspal, alat berat, roller, marka jalan",
      worker_names: "Qadri Mahfud\nRayhan Saputra\nSusilo Bambang\nTaufik Hidayat\nUmar Bakri\nVandy Kurniawan\nWawan Setiadi\nXavier Gunawan\nYogie Pratama\nZidane Ahmad\nAhmad Fauzi\nBambang Sutrisno",
      signer_position: "Site Manager",
      signer_name: "Ir. Wahyu Santoso",
    },
    {
      based_on: "SPK No. SPK/2024/009",
      job_description: "Maintenance Elevator",
      work_location: "Gedung Perkantoran 20 Lantai",
      working_hours: "10:00 - 18:00 WIB",
      work_facilities: "Tools elevator, spare parts, safety equipment",
      worker_names: "Ali Rahman\nBudi Gunawan\nCahya Permana\nDimas Pratama",
      signer_position: "Building Maintenance Manager",
      signer_name: "Ir. Joko Widodo",
    },
    {
      based_on: "Kontrak Kerja No. KK/2024/010",
      job_description: "Instalasi Fiber Optic",
      work_location: "Kampus Universitas",
      working_hours: "08:00 - 16:00 WIB",
      work_facilities: "Kabel fiber optic, fusion splicer, OTDR",
      worker_names: "Eko Prasetyo\nFahmi Hidayat\nGilang Ramadhan\nHasan Abdullah\nIrfan Maulana",
      signer_position: "Network Manager",
      signer_name: "Ir. Rudi Setiawan, MSc",
    },
  ];

  const statuses = ['PENDING', 'APPROVED', 'REJECTED'];
  const currentDate = new Date();
  const createdSubmissions: any[] = [];
  
  // Create multiple submissions for each vendor
  let submissionCount = 0;
  
  for (const vendor of vendorUsers) {
    const vendorData = vendor as any;
    
    // Each vendor gets 2-4 submissions
    const numSubmissions = Math.floor(Math.random() * 3) + 2; // 2-4 submissions
    
    for (let i = 0; i < numSubmissions; i++) {
      const template = submissionTemplates[submissionCount % submissionTemplates.length];
      
      if (!template) {
        console.warn('Template is undefined, skipping submission');
        continue;
      }
      
      const status = statuses[submissionCount % 3];
      
      // Create date variations
      const createdDate = new Date(currentDate);
      createdDate.setDate(createdDate.getDate() - Math.floor(Math.random() * 60)); // Random date within last 60 days
      
      const submissionData: any = {
        vendor_name: vendorData.vendor_name || `Vendor ${vendorData.officer_name}`,
        based_on: `${template.based_on.split('No.')[0]}No. ${template.based_on.split('/')[1]}/2024/${String(submissionCount + 1).padStart(3, '0')}`,
        officer_name: vendorData.officer_name,
        job_description: template.job_description,
        work_location: template.work_location,
        implementation: null, // akan diisi super admin saat approve
        working_hours: template.working_hours,
        other_notes: null, // akan diisi super admin saat approve
        work_facilities: template.work_facilities,
        worker_names: template.worker_names,
        content: null, // akan diisi super admin saat approve
        user_id: vendorData.id,
        approval_status: status,
        qrcode: `QR-${vendorData.id}-${Date.now()}-${submissionCount}`,
        created_at: createdDate,
        signer_position: template.signer_position,
        signer_name: template.signer_name,
        simja_number: submissionCount % 2 === 0 ? `SIMJA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,
        simja_date: submissionCount % 2 === 0 ? new Date(createdDate.getTime() - Math.random() * 10 * 24 * 60 * 60 * 1000) : null,
        sika_number: submissionCount % 3 === 0 ? `SIKA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,
        sika_date: submissionCount % 3 === 0 ? new Date(createdDate.getTime() - Math.random() * 15 * 24 * 60 * 60 * 1000) : null,
        implementation_start_date: null, // akan diisi super admin saat approve
        implementation_end_date: null, // akan diisi super admin saat approve
      };

      // Add approval data for approved/rejected submissions
      if (status === 'APPROVED') {
        submissionData.approved_by = superAdmin.id;
        submissionData.simlok_number = `SIMLOK/2024/${String(submissionCount + 1).padStart(3, '0')}`;
        submissionData.simlok_date = new Date(createdDate.getTime() + Math.random() * 5 * 24 * 60 * 60 * 1000);
        
        // Add implementation date range (7-30 days from approval)
        const startDaysFromApproval = Math.floor(Math.random() * 7) + 1; // 1-7 days
        const durationInDays = Math.floor(Math.random() * 14) + 7; // 7-20 days duration
        
        const implementationStart = new Date(submissionData.simlok_date);
        implementationStart.setDate(implementationStart.getDate() + startDaysFromApproval);
        
        const implementationEnd = new Date(implementationStart);
        implementationEnd.setDate(implementationEnd.getDate() + durationInDays);
        
        submissionData.implementation_start_date = implementationStart;
        submissionData.implementation_end_date = implementationEnd;
        
        submissionData.notes = 'Pengajuan disetujui dengan catatan mengikuti prosedur K3 dan laporan harian';
        // Super Admin mengisi implementation, other_notes, dan content saat approve
        submissionData.implementation = `${implementationStart.toISOString().split('T')[0]} s/d ${implementationEnd.toISOString().split('T')[0]}`;
        const otherNotesOptions = [
          'Koordinasi dengan supervisor produksi',
          'Bekerja di luar jam operasional kantor',
          'Memerlukan izin kerja tinggi',
          'Pekerjaan malam hari untuk minimal downtime',
          'Pekerjaan shift malam',
          'Memerlukan koordinasi dengan penghuni gedung',
          'Pekerjaan sebelum jam operasional mall',
          'Koordinasi dengan traffic management',
          'Pemeliharaan berkala sesuai schedule',
          'Instalasi diluar jam kuliah'
        ];
        submissionData.other_notes = otherNotesOptions[submissionCount % otherNotesOptions.length];
        
        // Super Admin mengisi content saat approve
        const contentOptions = [
          'Pemeliharaan rutin mesin produksi untuk memastikan kinerja optimal',
          'Pemasangan sistem CCTV dan alarm keamanan di seluruh area kantor',
          'Perbaikan struktur gudang dan peningkatan kapasitas penyimpanan',
          'Update sistem dan maintenance server untuk performa optimal',
          'Layanan kebersihan harian untuk seluruh area perkantoran',
          'Pengecatan ulang eksterior dan interior gedung perkantoran',
          'Pemasangan sistem AC central untuk seluruh area mall',
          'Perbaikan dan penambalan jalan akses menuju area industri',
          'Maintenance berkala elevator untuk keamanan pengguna',
          'Instalasi backbone fiber optic untuk koneksi high-speed'
        ];
        submissionData.content = contentOptions[submissionCount % contentOptions.length];
      } else if (status === 'REJECTED') {
        submissionData.approved_by = superAdmin.id;
        const rejectionReasons = [
          'Dokumen SIMJA belum lengkap, mohon dilengkapi terlebih dahulu',
          'Sertifikat pelatihan K3 sudah expired, mohon diperbaharui',
          'Jadwal pelaksanaan bertabrakan dengan kegiatan lain',
          'Spesifikasi alat kerja tidak sesuai standar, mohon disesuaikan',
          'Jumlah pekerja kurang memadai untuk scope pekerjaan ini',
          'Dokumen SIKA belum tersedia, mohon dilengkapi',
          'Koordinasi dengan pihak terkait belum dilakukan'
        ];
        submissionData.notes = rejectionReasons[submissionCount % rejectionReasons.length];
      }

      const createdSubmission = await prisma.submission.create({
        data: submissionData,
      });

      createdSubmissions.push(createdSubmission);

      // Create worker list for this submission
      const workerNamesArray = template.worker_names.split('\n');
      for (const workerName of workerNamesArray) {
        await prisma.workerList.create({
          data: {
            worker_name: workerName.trim(),
            worker_photo: null, // akan diupload nanti
            submission_id: createdSubmission.id,
          },
        });
      }
      
      submissionCount++;
    }
  }

  console.log(`   ✓ ${submissionCount} submissions berhasil dibuat`);

  // Create QR scan history for approved submissions
  console.log("📱 Membuat QR scan history...");
  const approvedSubmissions = createdSubmissions.filter(s => s.approval_status === 'APPROVED');
  
  let scanCount = 0;
  for (const submission of approvedSubmissions) {
    // Some submissions have been scanned by verifiers
    const shouldHaveScans = Math.random() > 0.3; // 70% chance of having scans
    
    if (shouldHaveScans) {
      const numScans = Math.floor(Math.random() * 3) + 1; // 1-3 scans per submission
      
      for (let i = 0; i < numScans; i++) {
        const randomVerifier = verifiers[Math.floor(Math.random() * verifiers.length)] as any;
        
        // Create scan date after submission approval
        const scanDate = new Date(submission.simlok_date || submission.created_at);
        scanDate.setDate(scanDate.getDate() + Math.floor(Math.random() * 30)); // Random scan within 30 days after approval
        
        await prisma.qrScan.create({
          data: {
            submission_id: submission.id,
            scanned_by: randomVerifier.id,
            scanned_at: scanDate,
            scanner_name: randomVerifier.officer_name,
            notes: i === 0 ? 'Scan pertama - verifikasi awal pelaksanaan' : 
                   i === 1 ? 'Scan kedua - monitoring progress pekerjaan' : 
                   'Scan ketiga - verifikasi penyelesaian pekerjaan',
          },
        });
        
        scanCount++;
      }
    }
  }

  console.log(`   ✓ ${scanCount} QR scans berhasil dibuat`);

  // Create sample notifications
  console.log("🔔 Membuat sample notifications...");
  
  // Create vendor registration notifications
  const unverifiedVendors = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR' && !user.verified_at);
  
  for (const vendor of unverifiedVendors) {
    const vendorData = vendor as any;
    
    // Create super admin notification for new vendor registration
    await prisma.notification.create({
      data: {
        scope: 'admin',
        vendor_id: null,
        type: 'new_vendor',
        title: 'Pendaftaran Vendor Baru',
        message: `Vendor baru mendaftar: ${vendorData.vendor_name}`,
        data: JSON.stringify({
          vendorId: vendorData.id,
          vendorName: vendorData.vendor_name,
          officerName: vendorData.officer_name,
        }),
        created_at: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000), // Random dalam 7 hari terakhir
      },
    });
  }

  // Create submission notifications
  const recentSubmissions = await prisma.submission.findMany({
    where: {
      created_at: {
        gte: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000), // 14 hari terakhir
      },
    },
    include: {
      user: true,
    },
  });

  for (const submission of recentSubmissions.slice(0, 8)) { // Ambil 8 submission terbaru
    // Create super admin notification for new submission
    await prisma.notification.create({
      data: {
        scope: 'admin',
        vendor_id: null,
        type: 'new_submission',
        title: 'Pengajuan Baru',
        message: `Pengajuan baru dari ${submission.user.vendor_name || submission.user.officer_name}: ${submission.job_description}`,
        data: JSON.stringify({
          submissionId: submission.id,
          vendorName: submission.user.vendor_name || submission.user.officer_name,
          jobDescription: submission.job_description,
        }),
        created_at: submission.created_at,
      },
    });

    // Create vendor notification for status changes (for approved/rejected submissions)
    if (submission.approval_status !== 'PENDING') {
      await prisma.notification.create({
        data: {
          scope: 'vendor',
          vendor_id: submission.user_id,
          type: 'status_change',
          title: 'Status Pengajuan Diperbarui',
          message: `Pengajuan Anda "${submission.job_description}" telah ${submission.approval_status === 'APPROVED' ? 'disetujui' : 'ditolak'}`,
          data: JSON.stringify({
            submissionId: submission.id,
            newStatus: submission.approval_status,
            jobDescription: submission.job_description,
          }),
          created_at: new Date(submission.created_at.getTime() + Math.random() * 2 * 24 * 60 * 60 * 1000), // 1-2 hari setelah submission
        },
      });
    }
  }

  // Create QR scan notifications for verifiers
  const recentScans = await prisma.qrScan.findMany({
    where: {
      scanned_at: {
        gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 hari terakhir
      },
    },
    include: {
      submission: {
        include: {
          user: true,
        },
      },
      user: true,
    },
    take: 5,
  });

  for (const scan of recentScans) {
    // Create super admin notification for QR scans
    await prisma.notification.create({
      data: {
        scope: 'admin',
        vendor_id: null,
        type: 'qr_scan',
        title: 'QR Code Discan',
        message: `${scan.user.officer_name} telah memindai QR submission "${scan.submission.job_description}"`,
        data: JSON.stringify({
          submissionId: scan.submission.id,
          scannerId: scan.user.id,
          scannerName: scan.user.officer_name,
          jobDescription: scan.submission.job_description,
          scanDate: scan.scanned_at,
        }),
        created_at: scan.scanned_at,
      },
    });
  }

  console.log("   ✓ Sample notifications berhasil dibuat");

  // Summary statistics
  const stats = {
    users: await prisma.user.count(),
    submissions: await prisma.submission.count(),
    workerList: await prisma.workerList.count(),
    qrScans: await prisma.qrScan.count(),
    notifications: await prisma.notification.count(),
  };

  console.log("\n📊 Summary Statistics:");
  console.log(`   👥 Users: ${stats.users}`);
  console.log(`   📋 Submissions: ${stats.submissions}`);
  console.log(`   👷 Worker List: ${stats.workerList}`);
  console.log(`   📱 QR Scans: ${stats.qrScans}`);
  console.log(`   🔔 Notifications: ${stats.notifications}`);
  
  console.log("\n✅ Seeding selesai dengan sukses!");
  console.log("\n🔑 Login Credentials:");
  console.log("Super Admin: superadmin@example.com / superadmin123");
  console.log("Verifier 1: verifier@example.com / verifier123");
  console.log("Verifier 2: verifier2@example.com / verifier123");
  console.log("Vendor A: vendora@example.com / vendor123");
  console.log("Vendor B: vendorb@example.com / vendor123");
  console.log("Vendor C: vendorc@example.com / vendor123 (belum terverifikasi)");
  console.log("Vendor D: vendord@example.com / vendor123");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });


=== FILE: prisma/seed.ts ===
import { PrismaClient } from "@prisma/client";
import bcrypt from "bcryptjs";

const prisma = new PrismaClient();

async function cleanDatabase() {
  console.log("🧹 Membersihkan database sebelum seeding...");
  
  try {
    // Hapus data dengan urutan yang benar (child tables dulu, lalu parent tables)
    await prisma.notificationRead.deleteMany({});
    console.log("   ✓ Semua data notification reads dihapus");
    
    await prisma.notification.deleteMany({});
    console.log("   ✓ Semua data notifications dihapus");
    
    await prisma.qrScan.deleteMany({});
    console.log("   ✓ Semua data QR scans dihapus");
    
    await prisma.workerList.deleteMany({});
    console.log("   ✓ Semua data worker list dihapus");
    
    await prisma.submission.deleteMany({});
    console.log("   ✓ Semua data submission dihapus");
    
    await prisma.refreshToken.deleteMany({});
    console.log("   ✓ Semua data refresh tokens dihapus");
    
    await prisma.session.deleteMany({});
    console.log("   ✓ Semua data sessions dihapus");
    
    await prisma.account.deleteMany({});
    console.log("   ✓ Semua data accounts dihapus");
    
    await prisma.user.deleteMany({});
    console.log("   ✓ Semua data user dihapus");
    
    console.log("🧹 Database berhasil dibersihkan");
  } catch (error) {
    console.error("❌ Error saat membersihkan database:", error);
    throw error;
  }
}

async function main() {
  // Bersihkan database terlebih dahulu
  await cleanDatabase();

  console.log("🌱 Memulai proses seeding...");
  
  const users = [
    {
      officer_name: "Super Admin",
      email: "superadmin@example.com",
      password: "super123", 
      role: "SUPER_ADMIN" as const,
      profile_photo: null,
      address: "Jl. Super Admin No. 1, Jakarta",
      phone_number: "081234567889",
      vendor_name: null, // kosong untuk super admin
      verified_at: new Date(), // super admin sudah terverifikasi
      verified_by: "SYSTEM",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Reviewer Utama",
      email: "reviewer@example.com",
      password: "reviewer123",
      role: "REVIEWER" as const,
      profile_photo: null,
      address: "Jl. Reviewer No. 2, Jakarta",
      phone_number: "081234567888",
      vendor_name: null, // kosong untuk reviewer
      verified_at: new Date(), // reviewer sudah terverifikasi
      verified_by: "SUPER_ADMIN",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Approver Utama",
      email: "approver@example.com",
      password: "approver123",
      role: "APPROVER" as const,
      profile_photo: null,
      address: "Jl. Approver No. 3, Jakarta",
      phone_number: "081234567887",
      vendor_name: null, // kosong untuk approver
      verified_at: new Date(), // approver sudah terverifikasi
      verified_by: "SUPER_ADMIN",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Verifier Utama",
      email: "verifier@example.com",
      password: "verifier123",
      role: "VERIFIER" as const,
      profile_photo: null,
      address: "Jl. Verifier No. 4, Jakarta",
      phone_number: "081234567891",
      vendor_name: null, // kosong untuk verifier
      verified_at: new Date(), // verifier sudah terverifikasi
      verified_by: "SUPER_ADMIN",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Vendor A Petugas",
      email: "vendora@example.com",
      password: "vendor123",
      role: "VENDOR" as const,
      profile_photo: null,
      address: "Jl. Vendor A No. 5, Jakarta",
      phone_number: "081234567892",
      vendor_name: "PT. AHMAD VENDOR SERVICES",
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Vendor B Petugas",
      email: "vendorb@example.com",
      password: "vendor123",
      role: "VENDOR" as const,
      profile_photo: null,
      address: "Jl. Vendor B No. 6, Bandung",
      phone_number: "081234567893",
      vendor_name: "PT. BUANA KONSTRUKSI",
      verified_at: new Date(),
      verified_by: "SUPER_ADMIN",
      verification_status: "VERIFIED" as const,
    },
    {
      officer_name: "Vendor C Petugas",
      email: "vendorc@example.com",
      password: "vendor123",
      role: "VENDOR" as const,
      profile_photo: null,
      address: "Jl. Vendor C No. 7, Surabaya",
      phone_number: "081234567894",
      vendor_name: "CV. CIPTA MANDIRI",
      verified_at: null, // vendor belum terverifikasi
      verified_by: null,
      verification_status: "PENDING" as const,
    },
    {
      officer_name: "Vendor D Petugas",
      email: "vendord@example.com",
      password: "vendor123",
      role: "VENDOR" as const,
      profile_photo: null,
      address: "Jl. Vendor D No. 8, Medan",
      phone_number: "081234567895",
      vendor_name: "PT. DYNAMIC SOLUTIONS",
      verified_at: null, // vendor belum terverifikasi
      verified_by: null,
      verification_status: "PENDING" as const,
    },
    {
      officer_name: "Vendor E Petugas",
      email: "vendore@example.com",
      password: "vendor123",
      role: "VENDOR" as const,
      profile_photo: null,
      address: "Jl. Vendor E No. 9, Yogyakarta",
      phone_number: "081234567896",
      vendor_name: "CV. EXCELLENT WORKS",
      verified_at: null, // vendor ditolak
      verified_by: null,
      verification_status: "REJECTED" as const,
      rejected_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 hari lalu
      rejected_by: "REVIEWER",
      rejection_reason: "Dokumen tidak lengkap dan tidak sesuai dengan persyaratan yang ditetapkan.",
    },
  ];

  console.log("👥 Membuat users...");
  const createdUsers: { [key: string]: any } = {};

  for (const user of users) {
    const hashedPassword = await bcrypt.hash(user.password, 10);

    const createdUser = await prisma.user.upsert({
      where: { email: user.email },
      update: {}, // tidak update kalau sudah ada
      create: {
        officer_name: user.officer_name,
        email: user.email,
        password: hashedPassword,
        role: user.role,
        profile_photo: user.profile_photo,
        address: user.address,
        phone_number: user.phone_number,
        vendor_name: user.vendor_name,
        verified_at: user.verified_at,
        verified_by: user.verified_by,
        verification_status: user.verification_status,
      },
    });

    createdUsers[user.email] = createdUser;
  }

  console.log(`   ✓ ${Object.keys(createdUsers).length} users berhasil dibuat`);

  // Create sample submissions
  console.log("📋 Membuat sample submissions...");
  const vendorUsers = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR');

  const submissionTemplates = [
    {
      based_on: "Kontrak Kerja No. KK/2024/001",
      job_description: "Maintenance Mesin Produksi",
      work_location: "Pabrik Jakarta Plant 1",
      working_hours: "08:00 - 17:00 WIB",
      work_facilities: "Toolkit lengkap, APD standar, crane mobile",
      worker_names: "Ahmad Suharto\nBudi Santoso\nCarlos Wijaya\nDedi Pratama\nEko Setiawan",
    },
    {
      based_on: "SPK No. SPK/2024/002",
      job_description: "Instalasi Sistem Keamanan",
      work_location: "Gedung Kantor Pusat",
      working_hours: "09:00 - 16:00 WIB",
      work_facilities: "Kamera CCTV, kabel, tools instalasi",
      worker_names: "Fajar Nugraha\nGunawan Putra\nHendro Saputra",
    },
    {
      based_on: "Kontrak Pembangunan No. KB/2024/003",
      job_description: "Renovasi Gudang",
      work_location: "Gudang Distribusi Bandung",
      working_hours: "07:00 - 16:00 WIB",
      work_facilities: "Alat berat, material bangunan, scaffolding",
      worker_names: "Irwan Budiman\nJoko Susilo\nKarim Abdullah\nLutfi Rahman\nMaman Suryadi\nNando Pratama\nOktavio Wijaya\nPutra Ramadhan\nQomar Yusuf\nRizky Mahendra",
    },
    {
      based_on: "Work Order No. WO/2024/004",
      job_description: "Pemeliharaan Jaringan IT",
      work_location: "Data Center Jakarta",
      working_hours: "20:00 - 05:00 WIB",
      work_facilities: "Server equipment, testing tools, laptop",
      worker_names: "Sandi Kurniawan\nTeguh Prasetyo",
    },
    {
      based_on: "Kontrak Layanan No. KL/2024/005",
      job_description: "Cleaning Service",
      work_location: "Komplek Perkantoran",
      working_hours: "18:00 - 06:00 WIB",
      work_facilities: "Peralatan cleaning, chemical, vacuum cleaner",
      worker_names: "Usman Hakim\nVina Sari\nWahyu Utomo\nXenia Putri\nYulianto Siswanto\nZainal Abidin\nAni Rahayu\nBayu Setiawan",
    },
    {
      based_on: "SPK No. SPK/2024/006",
      job_description: "Pengecatan Gedung",
      work_location: "Gedung Perkantoran Tower A",
      working_hours: "08:00 - 15:00 WIB",
      work_facilities: "Cat, kuas, roller, scaffolding, drop cloth",
      worker_names: "Candra Wijaya\nDani Hartono\nEdi Susanto\nFarid Nugroho\nGalih Pratama\nHaris Setiawan",
    },
    {
      based_on: "Kontrak Kerja No. KK/2024/007",
      job_description: "Instalasi AC Central",
      work_location: "Mall Jakarta Timur",
      working_hours: "06:00 - 14:00 WIB",
      work_facilities: "Unit AC, ducting, tools HVAC, crane",
      worker_names: "Iman Santoso\nJamal Abdurrahman\nKurnia Sari\nLanang Prasetyo\nMuhammad Rizki\nNurul Hidayah\nOctavianus Putra\nPratama Wijaya",
    },
    {
      based_on: "Work Order No. WO/2024/008",
      job_description: "Perbaikan Jalan Akses",
      work_location: "Area Industri Cikarang",
      working_hours: "07:00 - 17:00 WIB",
      work_facilities: "Aspal, alat berat, roller, marka jalan",
      worker_names: "Qadri Mahfud\nRayhan Saputra\nSusilo Bambang\nTaufik Hidayat\nUmar Bakri\nVandy Kurniawan\nWawan Setiadi\nXavier Gunawan\nYogie Pratama\nZidane Ahmad\nAhmad Fauzi\nBambang Sutrisno",
    },
  ];

  const currentDate = new Date();
  
  // Create multiple submissions for each vendor
  let submissionCount = 0;
  
  for (const vendor of vendorUsers) {
    const vendorData = vendor as any;
    
    // Each vendor gets 2-4 submissions
    const numSubmissions = Math.floor(Math.random() * 3) + 2; // 2-4 submissions
    
    for (let i = 0; i < numSubmissions; i++) {
      const template = submissionTemplates[submissionCount % submissionTemplates.length];
      
      if (!template) {
        console.warn('Template is undefined, skipping submission');
        continue;
      }
      
      // Create date variations
      const createdDate = new Date(currentDate);
      createdDate.setDate(createdDate.getDate() - Math.floor(Math.random() * 60)); // Random date within last 60 days
      
      const workerNamesArray = template.worker_names.split('\n');
      const workerCount = workerNamesArray.length;
      
      const submissionData: any = {
        vendor_name: vendorData.vendor_name,
        vendor_phone: vendorData.phone_number, // Ambil dari phone number vendor
        based_on: `${template.based_on.split('No.')[0]}No. ${template.based_on.split('/')[1]}/2024/${String(submissionCount + 1).padStart(3, '0')}`,
        officer_name: vendorData.officer_name,
        job_description: template.job_description,
        work_location: template.work_location,
        implementation: null, // akan diisi setelah diapprove
        working_hours: template.working_hours,
        other_notes: null, // akan diisi setelah diapprove
        work_facilities: template.work_facilities,
        worker_names: template.worker_names,
        worker_count: workerCount, // Hitung dari worker_names
        content: null, // akan diisi setelah diapprove
        user_id: vendorData.id,
        approval_status: 'PENDING', // Semua submission pending approval
        review_status: "PENDING_REVIEW", // Semua pending review dari reviewer
        final_status: "PENDING_APPROVAL", // Semua pending final approval dari approver
        review_note: null, // belum ada review
        final_note: null, // belum ada final note
        reviewed_by_id: null, // belum di-review
        reviewed_at: null, // belum di-review
        approved_by: null, // belum diapprove
        approved_by_final_id: null, // belum diapprove final
        approved_at: null, // belum diapprove
        qrcode: '', // akan diisi setelah diapprove
        created_at: createdDate,
        simja_number: submissionCount % 2 === 0 ? `SIMJA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,
        simja_date: submissionCount % 2 === 0 ? new Date(createdDate.getTime() - Math.random() * 10 * 24 * 60 * 60 * 1000) : null,
        sika_number: submissionCount % 3 === 0 ? `SIKA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,
        sika_date: submissionCount % 3 === 0 ? new Date(createdDate.getTime() - Math.random() * 15 * 24 * 60 * 60 * 1000) : null,
        simlok_number: null, // akan diisi setelah diapprove
        simlok_date: null, // akan diisi setelah diapprove
        implementation_start_date: null, // akan diisi setelah diapprove
        implementation_end_date: null, // akan diisi setelah diapprove
        signer_position: null, // akan diisi setelah diapprove
        signer_name: null, // akan diisi setelah diapprove
        sika_document_upload: null, // bisa diupload vendor
        simja_document_upload: null, // bisa diupload vendor
      };

      // Semua submission dibuat dengan status PENDING untuk testing review workflow
      // Reviewer/Super Admin akan review melalui UI
      // Approver akan melakukan final approval melalui UI
      // QR Code akan dibuat otomatis setelah final approval

      const createdSubmission = await prisma.submission.create({
        data: submissionData,
      });

      // Create worker list for this submission
      for (const workerName of workerNamesArray) {
        await prisma.workerList.create({
          data: {
            worker_name: workerName.trim(),
            worker_photo: null, // akan diupload nanti
            submission_id: createdSubmission.id,
          },
        });
      }
      
      submissionCount++;
    }
  }

  console.log(`   ✓ ${submissionCount} submissions berhasil dibuat`);

  // All submissions remain PENDING for review and final approval
  console.log("📋 Semua submissions dibuat dengan status PENDING_REVIEW dan PENDING_APPROVAL");
  console.log("   ✓ Reviewer dapat melakukan review submissions");
  console.log("   ✓ Approver dapat melakukan final approval setelah review");
  console.log("   ✓ QR codes akan dibuat setelah approval final");

  // Create sample notifications untuk submission baru saja
  console.log("🔔 Membuat sample notifications...");
  
  // Create vendor registration notifications
  const unverifiedVendors = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR' && !user.verified_at);
  
  for (const vendor of unverifiedVendors) {
    const vendorData = vendor as any;
    
    // Create admin notification for new vendor registration
    await prisma.notification.create({
      data: {
        scope: 'admin',
        vendor_id: null,
        type: 'new_vendor',
        title: 'Pendaftaran Vendor Baru',
        message: `Vendor baru mendaftar: ${vendorData.vendor_name}`,
        data: JSON.stringify({
          vendorId: vendorData.id,
          vendorName: vendorData.vendor_name,
          officerName: vendorData.officer_name,
        }),
        created_at: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000), // Random dalam 7 hari terakhir
      },
    });
  }

  // Create submission notifications untuk submissions yang baru dibuat
  const recentSubmissions = await prisma.submission.findMany({
    where: {
      created_at: {
        gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 hari terakhir
      },
    },
    include: {
      user: true,
    },
  });

  for (const submission of recentSubmissions.slice(0, 5)) { // Ambil 5 submission terbaru
    // Create admin notification for new submission
    await prisma.notification.create({
      data: {
        scope: 'admin',
        vendor_id: null,
        type: 'new_submission',
        title: 'Pengajuan Baru',
        message: `Pengajuan baru dari ${submission.vendor_name}: ${submission.job_description}`,
        data: JSON.stringify({
          submissionId: submission.id,
          vendorName: submission.vendor_name,
          jobDescription: submission.job_description,
        }),
        created_at: submission.created_at,
      },
    });

    // Create reviewer notification for pending review
    await prisma.notification.create({
      data: {
        scope: 'reviewer',
        vendor_id: null,
        type: 'pending_review',
        title: 'Pengajuan Menunggu Review',
        message: `Pengajuan dari ${submission.vendor_name} menunggu review: ${submission.job_description}`,
        data: JSON.stringify({
          submissionId: submission.id,
          vendorName: submission.vendor_name,
          jobDescription: submission.job_description,
        }),
        created_at: submission.created_at,
      },
    });
  }

  console.log("   ✓ Sample notifications berhasil dibuat");
  console.log("");
  console.log("✅ Seeding selesai dengan sukses!");
  console.log("");
  console.log("📊 Ringkasan data yang dibuat:");
  console.log(`   👥 ${Object.keys(createdUsers).length} users (termasuk super admin, reviewer, approver, verifier, vendor)`);
  console.log(`   📋 ${submissionCount} submissions (semua dengan status PENDING_REVIEW & PENDING_APPROVAL)`);
  console.log(`   🔔 Sample notifications untuk testing workflow`);
  console.log("");
  console.log("🎯 Workflow yang dapat ditest:");
  console.log("   1. Login sebagai Reviewer untuk melakukan review submissions");
  console.log("   2. Login sebagai Approver untuk melakukan final approval");
  console.log("   3. Login sebagai Verifier untuk melakukan QR scan (setelah approval)");
  console.log("   4. Login sebagai Vendor untuk melihat status submissions");
  console.log("");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });


=== FILE: src/app/(auth)/login/metadata.ts ===
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "Masuk - SIMLOK",
  description: "Halaman masuk ke sistem SIMLOK",
};

=== FILE: src/app/(auth)/login/page.tsx ===
"use client";

import { signIn } from "next-auth/react";
import { useRouter } from "next/navigation";
import { useState } from "react";
import AuthRedirect from "@/components/auth/AuthRedirect";
import SignInForm from "@/components/auth/SignInForm";

export default function LoginPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [showPassword, setShow] = useState(false);
  const [error, setError] = useState("");
  const router = useRouter();

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    setError("");

    const res = await signIn("credentials", {
      redirect: false,
      email,
      password,
    });

    if (res?.error) {
      // Convert NextAuth error codes to user-friendly messages
      switch (res.error) {
        case "CredentialsSignin":
          setError("Email atau password salah");
          break;
        case "ACCOUNT_REJECTED":
          setError("Akun Anda telah ditolak oleh administrator. Silakan hubungi admin untuk informasi lebih lanjut.");
          break;
        case "Configuration":
          setError("Terjadi kesalahan konfigurasi sistem");
          break;
        case "AccessDenied":
          setError("Akses ditolak");
          break;
        case "Verification":
          setError("Token verifikasi tidak valid");
          break;
        default:
          setError("Terjadi kesalahan saat login. Silakan coba lagi.");
          break;
      }
    } else {
      router.push("/");
    }
  }

  return (
    <AuthRedirect>
      <SignInForm
        email={email}
        password={password}
        showPassword={showPassword}
        error={error}
        setEmail={setEmail}
        setPassword={setPassword}
        setShow={setShow}
        handleSubmit={handleSubmit}
      />
    </AuthRedirect>
  );
}

=== FILE: src/app/(auth)/signup/metadata.ts ===
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "Daftar - SIMLOK",
  description: "Halaman pendaftaran akun baru untuk sistem SIMLOK",
};

=== FILE: src/app/(auth)/signup/page.tsx ===
// src/app/(auth)/signup/page.tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import AuthRedirect from "@/components/auth/AuthRedirect";
import SignUpForm from "@/components/auth/SignUpForm";
import { getCsrfToken } from "next-auth/react";

export default function SignupPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [nama_petugas, setNamaPetugas] = useState("");
  const [nama_vendor, setNamaVendor] = useState("");
  const [alamat, setAlamat] = useState("");
  const [no_telp, setNoTelp] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [agreed, setAgreed] = useState(false);
  const [error, setError] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  const validateForm = () => {
    if (!nama_petugas.trim()) {
      setError("Nama petugas harus diisi");
      return false;
    }
    if (!email.trim()) {
      setError("Email harus diisi");
      return false;
    }
    if (!no_telp.trim()) {
      setError("Nomor telepon harus diisi");
      return false;
    }
    if (!alamat.trim()) {
      setError("Alamat harus diisi");
      return false;
    }
    if (!nama_vendor.trim()) {
      setError("Nama vendor harus diisi");
      return false;
    }
    if (password.length < 8) {
      setError("Password minimal 8 karakter");
      return false;
    }
    if (password !== confirmPassword) {
      setError("Password dan konfirmasi password tidak sama");
      return false;
    }
    if (!agreed) {
      setError("Anda harus menyetujui syarat dan ketentuan");
      return false;
    }
    return true;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");

    if (!validateForm()) {
      return;
    }

    setIsLoading(true);

    try {
      const csrf = await getCsrfToken();
      
      const res = await fetch("/api/auth/signup", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
        },
        credentials: "include",
        body: JSON.stringify({
          csrfToken: csrf,
          officer_name: nama_petugas.trim(),
          email: email.trim().toLowerCase(),
          password,
          vendor_name: nama_vendor.trim(),
          address: alamat.trim(),
          phone_number: no_telp.trim(),
        }),
      });

      const data = await res.json();
      
      if (!res.ok) {
        setError(data.error || "Terjadi kesalahan saat mendaftar");
      } else {
        // Registration successful - redirect to verification pending page
        router.push("/verification-pending");
      }
    } catch (error) {
      console.error("Registration error:", error);
      setError("Terjadi kesalahan jaringan. Silakan coba lagi.");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <AuthRedirect>
      <SignUpForm
        email={email}
        password={password}
        confirmPassword={confirmPassword}
        nama_petugas={nama_petugas}
        nama_vendor={nama_vendor}
        alamat={alamat}
        no_telp={no_telp}
        showPassword={showPassword}
        showConfirmPassword={showConfirmPassword}
        agreeToTerms={agreed}
        error={error}
        isLoading={isLoading}
        setEmail={setEmail}
        setPassword={setPassword}
        setConfirmPassword={setConfirmPassword}
        setNamaPetugas={setNamaPetugas}
        setNamaVendor={setNamaVendor}
        setAlamat={setAlamat}
        setNoTelp={setNoTelp}
        setShowPassword={setShowPassword}
        setShowConfirmPassword={setShowConfirmPassword}
        setAgree={setAgreed}
        handleSubmit={handleSubmit}
      />
    </AuthRedirect>
  );
}

=== FILE: src/app/(auth)/verification-pending/page.tsx ===
'use client';

import { useSession, signOut } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import Card from '@/components/ui/Card';
import Button from '@/components/ui/button/Button';
import { 
  ClockIcon, 
  ExclamationTriangleIcon, 
  UserIcon,
  CheckCircleIcon,
  ArrowRightIcon,
  ShieldCheckIcon
} from '@heroicons/react/24/outline';
import PageLoader from '@/components/ui/PageLoader';

export default function VerificationPendingPage() {
  const { data: session, status } = useSession();
  const router = useRouter();
  const [countdown, setCountdown] = useState(15);
  const [autoRedirect, setAutoRedirect] = useState(true);

  // Auto redirect to login after 15 seconds if not logged in
  useEffect(() => {
    if (status === 'unauthenticated' && autoRedirect && countdown > 0) {
      const timer = setTimeout(() => {
        setCountdown(countdown - 1);
      }, 1000);
      return () => clearTimeout(timer);
    } else if (status === 'unauthenticated' && autoRedirect && countdown === 0) {
      router.push("/login");
    }
    return undefined;
  }, [countdown, autoRedirect, router, status]);

  useEffect(() => {
    // Redirect jika user sudah terverifikasi
    if (session?.user?.verified_at) {
      const role = session.user.role;
      if (role === "ADMIN") {
        router.push("/admin");
      } else if (role === "VENDOR") {
        router.push("/vendor");
      } else if (role === "VERIFIER") {
        router.push("/verifier");
      } else {
        router.push('/dashboard');
      }
    }
  }, [session, router]);

  if (status === 'loading') {
    return <PageLoader message="Memeriksa status verifikasi..." />;
  }

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    });
  };

  const formatTime = (dateString: string) => {
    return new Date(dateString).toLocaleTimeString('id-ID', {
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const handleLogout = async () => {
    await signOut({ callbackUrl: '/login' });
  };

  const handleStopAutoRedirect = () => {
    setAutoRedirect(false);
  };

  // If user is not logged in (just registered), show simplified version
  if (status === 'unauthenticated') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <div className="w-full max-w-md">
          <Card className="p-8 text-center shadow-xl">
            <div className="mb-6">
              <div className="mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4">
                <ClockIcon className="w-8 h-8 text-orange-600" />
              </div>
              <h1 className="text-2xl font-bold text-gray-900 mb-2">
                Pendaftaran Berhasil!
              </h1>
              <p className="text-gray-600">
                Akun vendor Anda telah berhasil dibuat
              </p>
            </div>

            <div className="space-y-6">
              {/* Status Steps */}
              <div className="space-y-4">
                <div className="flex items-center text-left bg-green-50 p-4 rounded-lg">
                  <CheckCircleIcon className="w-6 h-6 text-green-500 flex-shrink-0 mr-3" />
                  <div>
                    <p className="font-medium text-green-800">Pendaftaran Selesai</p>
                    <p className="text-sm text-green-600">Data vendor telah tersimpan</p>
                  </div>
                </div>

                <div className="flex items-center text-left bg-orange-50 p-4 rounded-lg">
                  <ClockIcon className="w-6 h-6 text-orange-500 flex-shrink-0 mr-3" />
                  <div>
                    <p className="font-medium text-orange-800">Menunggu Verifikasi</p>
                    <p className="text-sm text-orange-600">Admin sedang meninjau akun Anda</p>
                  </div>
                </div>

                <div className="flex items-center text-left bg-gray-50 p-4 rounded-lg">
                  <ShieldCheckIcon className="w-6 h-6 text-gray-400 flex-shrink-0 mr-3" />
                  <div>
                    <p className="font-medium text-gray-500">Akun Aktif</p>
                    <p className="text-sm text-gray-400">Setelah verifikasi selesai</p>
                  </div>
                </div>
              </div>

              {/* Information Box */}
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div className="flex items-start">
                  <ExclamationTriangleIcon className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5 mr-3" />
                  <div className="text-left">
                    <h3 className="font-medium text-blue-900 mb-2">Langkah Selanjutnya:</h3>
                    <ul className="text-sm text-blue-800 space-y-1">
                      <li>• Admin akan meninjau data pendaftaran Anda</li>
                      <li>• Proses verifikasi membutuhkan waktu 1-2 hari kerja</li>
                      <li>• Anda akan menerima notifikasi setelah akun diverifikasi</li>
                      <li>• Setelah diverifikasi, Anda dapat mengakses dashboard vendor</li>
                    </ul>
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="space-y-3">
                <Button
                  onClick={() => router.push("/login")}
                  className="w-full" 
                  size="md"
                >
                  <ArrowRightIcon className="w-4 h-4 mr-2" />
                  Lanjut ke Halaman Login
                </Button>
                
                {autoRedirect && (
                  <button
                    onClick={handleStopAutoRedirect}
                    className="text-sm text-gray-500 hover:text-gray-700 transition-colors"
                  >
                    Auto redirect dalam {countdown} detik
                    <br />
                    <span className="underline">Klik untuk membatalkan</span>
                  </button>
                )}
              </div>

              {/* Contact Information */}
              <div className="pt-4 border-t border-gray-200">
                <p className="text-xs text-gray-500 mb-2">
                  Butuh bantuan?
                </p>
                <p className="text-xs text-gray-600">
                  Hubungi admin di{" "}
                  <a href="mailto:admin@simlok.com" className="text-blue-600 hover:text-blue-700">
                    admin@simlok.com
                  </a>
                  <br />
                  atau telepon{" "}
                  <a href="tel:+6281234567890" className="text-blue-600 hover:text-blue-700">
                    +62 812-3456-7890
                  </a>
                </p>
              </div>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  // If user is logged in but not verified, show detailed version
  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
      <div className="w-full max-w-lg">
        <Card className="p-8">
          {/* Icon and Status */}
          <div className="flex flex-col items-center mb-8">
            <div className="w-20 h-20 bg-warning-100 rounded-full flex items-center justify-center mb-6">
              <ClockIcon className="w-10 h-10 text-warning-500" />
            </div>
            
            {/* Title */}
            <h1 className="text-2xl font-semibold text-gray-900 mb-3 text-center">
              Menunggu Verifikasi
            </h1>
            
            {/* Subtitle */}
            <p className="text-gray-600 text-center mb-6">
              Akun Anda sedang dalam proses verifikasi oleh administrator
            </p>
          </div>

          {/* User Info Card */}
          <Card className="bg-gray-50 p-6 mb-6">
            <div className="flex items-start gap-4">
              <div className="w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center flex-shrink-0">
                <UserIcon className="w-6 h-6 text-brand-500" />
              </div>
              <div className="flex-1">
                <h3 className="font-medium text-gray-900 mb-2">
                  Informasi Akun
                </h3>
                <div className="space-y-2 text-sm text-gray-600">
                  <div className="flex justify-between">
                    <span>Email:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.email}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Nama:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.officer_name || session?.user?.name || 'N/A'}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Vendor:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.vendor_name || 'N/A'}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Role:</span>
                    <span className="font-medium text-gray-900 capitalize">
                      {session?.user?.role?.toLowerCase()}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Tanggal Daftar:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.created_at ? 
                        formatDate(session.user.created_at.toString()) : 
                        'N/A'
                      }
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Waktu:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.created_at ? 
                        formatTime(session.user.created_at.toString()) : 
                        'N/A'
                      }
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </Card>

          {/* Info Alert */}
          <div className="flex gap-3 p-4 bg-blue-light-50 border border-blue-light-200 rounded-xl mb-8">
            <ExclamationTriangleIcon className="w-5 h-5 text-blue-light-500 flex-shrink-0 mt-0.5" />
            <div className="text-sm">
              <p className="text-blue-light-800 font-medium mb-1">
                Proses Verifikasi
              </p>
              <p className="text-blue-light-700">
                Administrator akan memverifikasi akun Anda dalam waktu 1-2 hari kerja. 
                Anda akan menerima notifikasi email setelah akun diverifikasi.
              </p>
            </div>
          </div>

          {/* Action Buttons */}
          <div className="flex flex-col gap-3">
            <Button 
              onClick={handleLogout}
              variant="primary"
              size="md"
              className="w-full"
            >
              Keluar
            </Button>
            
            <Button 
              onClick={() => window.location.reload()}
              variant="outline"
              size="md"
              className="w-full"
            >
              Refresh Status
            </Button>
          </div>

          {/* Footer Info */}
          <div className="mt-8 pt-6 border-t border-gray-200">
            <p className="text-xs text-gray-500 text-center">
              Butuh bantuan? Hubungi administrator melalui email atau sistem support.
            </p>
          </div>
        </Card>
      </div>
    </div>
  );
}


=== FILE: src/app/(auth)/verification-rejected/page.tsx ===
'use client';

import { useSession, signOut } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import Card from '@/components/ui/Card';
import Button from '@/components/ui/button/Button';
import { 
  XCircleIcon, 
  ExclamationTriangleIcon, 
  UserIcon,
  ArrowRightIcon,
  PhoneIcon,
  EnvelopeIcon
} from '@heroicons/react/24/outline';
import PageLoader from '@/components/ui/PageLoader';

export default function VerificationRejectedPage() {
  const { data: session, status } = useSession();
  const router = useRouter();
  const [countdown, setCountdown] = useState(15);
  const [autoRedirect, setAutoRedirect] = useState(true);

  // Auto redirect to login after 15 seconds if not logged in
  useEffect(() => {
    if (status === 'unauthenticated' && autoRedirect && countdown > 0) {
      const timer = setTimeout(() => {
        setCountdown(countdown - 1);
      }, 1000);
      return () => clearTimeout(timer);
    } else if (status === 'unauthenticated' && autoRedirect && countdown === 0) {
      router.push("/login");
    }
    return undefined;
  }, [countdown, autoRedirect, router, status]);

  useEffect(() => {
    // Redirect jika user sudah terverifikasi
    if (session?.user?.verified_at) {
      const role = session.user.role;
      if (role === "ADMIN") {
        router.push("/admin");
      } else if (role === "VENDOR") {
        router.push("/vendor");
      } else if (role === "VERIFIER") {
        router.push("/verifier");
      } else {
        router.push('/dashboard');
      }
    }
  }, [session, router]);

  if (status === 'loading') {
    return <PageLoader message="Memeriksa status verifikasi..." />;
  }

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    });
  };

  const handleLogout = async () => {
    await signOut({ callbackUrl: '/login' });
  };

  const handleStopAutoRedirect = () => {
    setAutoRedirect(false);
  };

  // If user is not logged in, redirect to login
  if (status === 'unauthenticated') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center p-4">
        <div className="w-full max-w-md">
          <Card className="p-8 text-center shadow-xl">
            <div className="mb-6">
              <div className="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                <XCircleIcon className="w-8 h-8 text-red-600" />
              </div>
              <h1 className="text-2xl font-bold text-gray-900 mb-2">
                Akun Ditolak
              </h1>
              <p className="text-gray-600">
                Verifikasi akun vendor Anda telah ditolak
              </p>
            </div>

            <div className="space-y-6">
              {/* Information Box */}
              <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                <div className="flex items-start">
                  <ExclamationTriangleIcon className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5 mr-3" />
                  <div className="text-left">
                    <h3 className="font-medium text-red-900 mb-2">Alasan Penolakan:</h3>
                    <p className="text-sm text-red-800">
                      Mohon hubungi administrator untuk informasi lebih lanjut mengenai penolakan akun Anda.
                    </p>
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="space-y-3">
                <Button
                  onClick={() => router.push("/login")}
                  className="w-full" 
                  size="md"
                >
                  <ArrowRightIcon className="w-4 h-4 mr-2" />
                  Kembali ke Login
                </Button>
                
                {autoRedirect && (
                  <button
                    onClick={handleStopAutoRedirect}
                    className="text-sm text-gray-500 hover:text-gray-700 transition-colors"
                  >
                    Auto redirect dalam {countdown} detik
                    <br />
                    <span className="underline">Klik untuk membatalkan</span>
                  </button>
                )}
              </div>

              {/* Contact Information */}
              <div className="pt-4 border-t border-gray-200">
                <p className="text-xs text-gray-500 mb-2">
                  Butuh bantuan?
                </p>
                <div className="space-y-2">
                  <div className="flex items-center justify-center text-xs text-gray-600">
                    <EnvelopeIcon className="w-4 h-4 mr-2" />
                    <a href="mailto:admin@simlok.com" className="text-blue-600 hover:text-blue-700">
                      admin@simlok.com
                    </a>
                  </div>
                  <div className="flex items-center justify-center text-xs text-gray-600">
                    <PhoneIcon className="w-4 h-4 mr-2" />
                    <a href="tel:+6281234567890" className="text-blue-600 hover:text-blue-700">
                      +62 812-3456-7890
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      </div>
    );
  }

  // If user is logged in and rejected, show detailed version
  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
      <div className="w-full max-w-lg">
        <Card className="p-8">
          {/* Icon and Status */}
          <div className="flex flex-col items-center mb-8">
            <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6">
              <XCircleIcon className="w-10 h-10 text-red-500" />
            </div>
            
            {/* Title */}
            <h1 className="text-2xl font-semibold text-gray-900 mb-3 text-center">
              Verifikasi Ditolak
            </h1>
            
            {/* Subtitle */}
            <p className="text-gray-600 text-center mb-6">
              Maaf, akun vendor Anda tidak dapat diverifikasi oleh administrator
            </p>
          </div>

          {/* User Info Card */}
          <Card className="bg-gray-50 p-6 mb-6">
            <div className="flex items-start gap-4">
              <div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0">
                <UserIcon className="w-6 h-6 text-red-500" />
              </div>
              <div className="flex-1">
                <h3 className="font-medium text-gray-900 mb-2">
                  Informasi Akun
                </h3>
                <div className="space-y-2 text-sm text-gray-600">
                  <div className="flex justify-between">
                    <span>Email:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.email}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Nama:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.officer_name || session?.user?.name || 'N/A'}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Vendor:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.vendor_name || 'N/A'}
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Status:</span>
                    <span className="font-medium text-red-600">
                      Ditolak
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span>Tanggal Daftar:</span>
                    <span className="font-medium text-gray-900">
                      {session?.user?.created_at ? 
                        formatDate(session.user.created_at.toString()) : 
                        'N/A'
                      }
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </Card>

          {/* Rejection Info Alert */}
          <div className="flex gap-3 p-4 bg-red-50 border border-red-200 rounded-xl mb-8">
            <ExclamationTriangleIcon className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />
            <div className="text-sm">
              <p className="text-red-800 font-medium mb-1">
                Akun Tidak Dapat Diverifikasi
              </p>
              <p className="text-red-700 mb-3">
                Administrator telah meninjau data akun Anda dan memutuskan untuk tidak memverifikasi akun ini.
              </p>
              <p className="text-red-700">
                Untuk informasi lebih lanjut mengenai alasan penolakan dan kemungkinan pengajuan ulang, 
                silakan hubungi administrator melalui kontak yang tersedia di bawah.
              </p>
            </div>
          </div>

          {/* Contact Information */}
          <Card className="bg-blue-50 p-6 mb-6">
            <h3 className="font-medium text-blue-900 mb-3 text-center">
              Hubungi Administrator
            </h3>
            <div className="space-y-3">
              <div className="flex items-center justify-center">
                <EnvelopeIcon className="w-5 h-5 text-blue-600 mr-3" />
                <div>
                  <p className="text-sm text-blue-800 font-medium">Email</p>
                  <a 
                    href="mailto:admin@simlok.com" 
                    className="text-sm text-blue-600 hover:text-blue-700 underline"
                  >
                    admin@simlok.com
                  </a>
                </div>
              </div>
              <div className="flex items-center justify-center">
                <PhoneIcon className="w-5 h-5 text-blue-600 mr-3" />
                <div>
                  <p className="text-sm text-blue-800 font-medium">Telepon</p>
                  <a 
                    href="tel:+6281234567890" 
                    className="text-sm text-blue-600 hover:text-blue-700 underline"
                  >
                    +62 812-3456-7890
                  </a>
                </div>
              </div>
            </div>
          </Card>

          {/* Action Buttons */}
          <div className="flex flex-col gap-3">
            <Button 
              onClick={handleLogout}
              variant="primary"
              size="md"
              className="w-full"
            >
              Keluar
            </Button>
            
            <Button 
              onClick={() => window.location.href = 'mailto:admin@simlok.com?subject=Pertanyaan Mengenai Penolakan Akun Vendor&body=Halo Admin,%0A%0ASaya ingin menanyakan mengenai penolakan verifikasi akun vendor saya.%0A%0AEmail: ' + session?.user?.email + '%0ANama: ' + (session?.user?.officer_name || '') + '%0APerusahaan: ' + (session?.user?.vendor_name || '') + '%0A%0AMohon penjelasan mengenai alasan penolakan dan apakah ada kemungkinan untuk pengajuan ulang.%0A%0ATerima kasih.'}
              variant="outline"
              size="md"
              className="w-full"
            >
              <EnvelopeIcon className="w-4 h-4 mr-2" />
              Kirim Email ke Admin
            </Button>
          </div>

          {/* Footer Info */}
          <div className="mt-8 pt-6 border-t border-gray-200">
            <p className="text-xs text-gray-500 text-center">
              Untuk pengajuan akun baru, silakan hubungi administrator terlebih dahulu.
            </p>
          </div>
        </Card>
      </div>
    </div>
  );
}

=== FILE: src/app/(dashboard)/approver/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ApproverDashboard from "@/components/approver/ApproverDashboard";

export const metadata: Metadata = {
  title: "Dashboard Approver - SIMLOK",
  description: "Halaman dashboard untuk approver mengelola persetujuan pengajuan Simlok",
};

export default function ApproverPage() {
  return (
    <RoleGate allowedRoles={["APPROVER" , "SUPER_ADMIN"]}>
      <SidebarLayout title="Approver Panel" titlePage="Dashboard Persetujuan">
        <ApproverDashboard />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/approver/scan-history/page.tsx ===
import { Metadata } from 'next';
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ApproverScanHistoryContent from '@/components/approver/ApproverScanHistoryContent';

export const metadata: Metadata = {
  title: 'Scan History - Approver Dashboard',
  description: 'Monitor submission scan activities by verifiers',
};

export default function ApproverScanHistoryPage() {
  return (
    <RoleGate allowedRoles={["APPROVER", "SUPER_ADMIN"]}>
      <SidebarLayout title="Approver Panel" titlePage="Scan History">
        <ApproverScanHistoryContent />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/approver/submissions/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ApproverSubmissionsManagement from "@/components/approver/ApproverSubmissionsManagement";

export const metadata: Metadata = {
  title: "Daftar Pengajuan - Approver SIMLOK",
  description: "Halaman untuk approver melihat dan menyetujui pengajuan Simlok",
};

export default function ApproverSubmissionsPage() {
  return (
    <RoleGate allowedRoles={["APPROVER", "SUPER_ADMIN"]}>
      <SidebarLayout title="Approver Panel" titlePage="Daftar Pengajuan">
        <ApproverSubmissionsManagement />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/dashboard/notifications/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useSession } from 'next-auth/react';
import { useToast } from '@/hooks/useToast';
import SidebarLayout from '@/components/layout/SidebarLayout';
import RoleGate from '@/components/security/RoleGate';
import { 
  BellIcon, 
  CheckIcon,
  CheckCircleIcon,
  ClockIcon,
  DocumentPlusIcon,
  UserPlusIcon,
  ShieldCheckIcon,
  MagnifyingGlassIcon,
  InboxIcon,
  XMarkIcon,
  ArrowRightIcon
} from '@heroicons/react/24/outline';
import Button from '@/components/ui/button/Button';
import PageLoader from '@/components/ui/PageLoader';
import SubmissionDetailModal from '@/components/vendor/SubmissionDetailModal';

// Interface untuk notification
interface Notification {
  id: string;
  type: string;
  title: string;
  message: string;
  data?: any;
  isRead: boolean;
  createdAt: string;
  scope: string;
  vendorId?: string;
}

// Interface untuk submission (dari AdminSubmissionDetailModal)
interface Submission {
  id: string;
  approval_status: string;
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  implementation_notes?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  signer_position?: string;
  signer_name?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  approved_by_user?: {
    id: string;
    officer_name: string;
    email: string;
  };
}

export default function NotificationsPage() {
  const { data: session, status } = useSession();
  const { showError } = useToast();
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);
  const [filter, setFilter] = useState<'all' | 'unread' | 'read'>('all');
  const [searchTerm, setSearchTerm] = useState('');

  // Fetch notifications based on user role
  useEffect(() => {
    const fetchNotifications = async () => {
      if (!session?.user?.id) return;
      
      setLoading(true);
      try {
        // Convert role to lowercase scope
        let scope = session.user.role.toLowerCase();
        
        // Handle SUPER_ADMIN case - they can see admin notifications
        if (session.user.role === 'SUPER_ADMIN') {
          scope = 'admin';
        }
        
        console.log('🔍 Fetching notifications for scope:', scope, 'user role:', session.user.role);
        
        const response = await fetch(`/api/v1/notifications?scope=${scope}&limit=50`);
        
        console.log('📡 Notifications API response status:', response.status);
        
        if (response.ok) {
          const data = await response.json();
          console.log('📋 Notifications API v1 response:', data);
          console.log('📅 First notification createdAt:', data.data?.data?.[0]?.createdAt);
          console.log('📊 Total notifications received:', data.data?.data?.length || 0);
          
          // API v1 returns nested structure: {success: true, data: {data: [...], pagination: {...}}}
          setNotifications(data.data?.data || []);
        } else {
          const errorData = await response.text();
          console.error('❌ Notifications API error:', response.status, errorData);
        }
      } catch (error) {
        console.error('💥 Error fetching notifications:', error);
      } finally {
        setLoading(false);
      }
    };

    if (status === 'authenticated') {
      fetchNotifications();
    }
  }, [session?.user?.id, session?.user?.role, status]);

  // Safely calculate unread count
  const unreadCount = Array.isArray(notifications) ? notifications.filter(n => !n.isRead).length : 0;

  const markAsRead = async (notificationId: string) => {
    try {
      console.log('🏷️ Marking notification as read:', notificationId);
      
      const response = await fetch(`/api/v1/notifications/${notificationId}/read`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (response.ok) {
        const result = await response.json();
        console.log('✅ Mark as read response:', result);
        
        // Update local state immediately for better UX
        setNotifications(prev => prev.map(notification => 
          notification.id === notificationId ? { ...notification, isRead: true } : notification
        ));
        
        console.log('🔄 Local state updated, notification should now appear as read');
      } else {
        const errorData = await response.text();
        console.error('❌ Failed to mark as read:', response.status, errorData);
      }
    } catch (error) {
      console.error('💥 Error marking notification as read:', error);
    }
  };

  const markAllAsRead = async () => {
    try {
      console.log('🏷️ Marking all notifications as read for scope:', session?.user?.role);
      
      const scope = session?.user?.role;
      const response = await fetch('/api/v1/notifications/read-all', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ scope }),
      });

      if (response.ok) {
        const result = await response.json();
        console.log('✅ Mark all as read response:', result);
        
        // Update local state
        setNotifications(prev => prev.map(notification => ({ ...notification, isRead: true })));
        
        console.log('🔄 All notifications marked as read in local state');
      } else {
        const errorData = await response.text();
        console.error('❌ Failed to mark all as read:', response.status, errorData);
      }
    } catch (error) {
      console.error('💥 Error marking all notifications as read:', error);
    }
  };

    const formatTimeAgo = (dateString: string): string => {
    if (!dateString) {
      return 'Tidak diketahui';
    }

    const date = new Date(dateString);
    if (isNaN(date.getTime())) {
      return 'Tanggal tidak valid';
    }

    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);

    if (diffInSeconds < 60) {
      return 'Baru saja';
    } else if (diffInSeconds < 3600) {
      const minutes = Math.floor(diffInSeconds / 60);
      return `${minutes} menit yang lalu`;
    } else if (diffInSeconds < 86400) {
      const hours = Math.floor(diffInSeconds / 3600);
      return `${hours} jam yang lalu`;
    } else if (diffInSeconds < 604800) {
      const days = Math.floor(diffInSeconds / 86400);
      return `${days} hari yang lalu`;
    } else {
      return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    }
  };

  const getNotificationIcon = (type: string) => {
    const iconClass = "w-5 h-5";
    switch (type) {
      case 'submission_approved':
        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;
      case 'submission_rejected':
        return <XMarkIcon className={`${iconClass} text-red-600`} />;
      case 'submission_pending':
        return <ClockIcon className={`${iconClass} text-amber-600`} />;
      case 'status_change':
        return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;
      case 'new_submission':
        return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;
      case 'new_vendor':
        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;
      case 'vendor_verified':
        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;
      case 'user_registered':
        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;
      default:
        return <BellIcon className={`${iconClass} text-gray-600`} />;
    }
  };

  const hasSubmissionData = (notification: Notification) => {
    // Cek berdasarkan type notification
    const submissionTypes = [
      'submission_approved', 
      'submission_rejected', 
      'submission_pending',
      'new_submission',
      'status_change'
    ];
    
    if (submissionTypes.includes(notification.type)) {
      return true;
    }
    
    // Cek di dalam data
    if (notification.data) {
      let parsedData;
      if (typeof notification.data === 'string') {
        try {
          parsedData = JSON.parse(notification.data);
        } catch {
          return notification.data.includes('submissionId');
        }
      } else {
        parsedData = notification.data;
      }
      
      if (parsedData && parsedData.submissionId) {
        return true;
      }
    }
    
    // Cek di message atau title
    const submissionKeywords = ['pengajuan', 'submission', 'simlok'];
    const text = `${notification.title} ${notification.message}`.toLowerCase();
    
    return submissionKeywords.some(keyword => text.includes(keyword));
  };

  const hasVendorData = (notification: Notification) => {
    console.log('🔍 Checking hasVendorData for:', notification);
    
    // Cek berdasarkan type notification
    const vendorTypes = [
      'new_vendor',
      'vendor_verified',
      'vendor_registered'
    ];
    
    if (vendorTypes.includes(notification.type)) {
      console.log('✅ Found vendor type:', notification.type);
      return true;
    }
    
    // Cek di dalam data
    if (notification.data) {
      let parsedData;
      if (typeof notification.data === 'string') {
        try {
          parsedData = JSON.parse(notification.data);
          console.log('📊 Parsed vendor data:', parsedData);
        } catch {
          const hasVendorId = notification.data.includes('vendorId');
          console.log('🔤 String contains vendorId:', hasVendorId);
          return hasVendorId;
        }
      } else {
        parsedData = notification.data;
        console.log('📊 Direct vendor data:', parsedData);
      }
      
      if (parsedData && parsedData.vendorId) {
        console.log('🎯 Found vendorId in data:', parsedData.vendorId);
        return true;
      }
    }
    
    // Cek di message atau title
    const vendorKeywords = ['vendor', 'perusahaan', 'pendaftaran vendor'];
    const text = `${notification.title} ${notification.message}`.toLowerCase();
    const hasKeyword = vendorKeywords.some(keyword => text.includes(keyword));
    
    console.log('🔍 Text search result:', hasKeyword, 'for text:', text);
    
    return hasKeyword;
  };

  const handleViewDetail = async (notification: Notification) => {
    console.log('🔍 handleViewDetail called with notification:', notification);
    console.log('🔍 notification.type:', notification.type);
    console.log('🔍 notification.data:', notification.data);
    
    // Mark as read when viewing
    if (!notification.isRead) {
      await markAsRead(notification.id);
    }

    // Check if it's a vendor notification
    const isVendorNotification = hasVendorData(notification);
    console.log('👤 Is vendor notification:', isVendorNotification);
    
    if (isVendorNotification) {
      console.log('📋 Processing vendor notification - feature not available');
      showError('Info', 'Detail vendor tidak tersedia saat ini');
      return;
    }

    // Handle submission notifications
    if (!hasSubmissionData(notification)) {
      console.log('❌ No submission data found');
      return;
    }
    
    try {
      // Extract submission ID from notification data
      let submissionId = '';
      
      console.log('📋 Processing submission notification.data:', notification.data);
      
      // Parse dari data JSON jika ada
      if (notification.data) {
        let parsedData;
        if (typeof notification.data === 'string') {
          try {
            parsedData = JSON.parse(notification.data);
            console.log('✅ Parsed submission data:', parsedData);
          } catch {
            // Jika tidak bisa parse JSON, coba extract dari string
            const match = notification.data.match(/submissionId[:\s]*([a-zA-Z0-9_-]+)/);
            if (match && match[1]) submissionId = match[1];
            console.log('🔤 String match result for submission:', match);
          }
        } else {
          parsedData = notification.data;
          console.log('📊 Direct submission data:', parsedData);
        }
        
        if (parsedData && parsedData.submissionId) {
          submissionId = parsedData.submissionId;
          console.log('🎯 Found submissionId in parsedData:', submissionId);
        }
      }
      
      // Jika belum ketemu, coba extract dari message atau title
      if (!submissionId) {
        console.log('🔍 Trying to extract from message/title...');
        const patterns = [
          /ID[:\s]*([a-zA-Z0-9_-]+)/,
          /submission[:\s]*([a-zA-Z0-9_-]+)/i,
          /pengajuan[:\s]*([a-zA-Z0-9_-]+)/i,
          /([a-zA-Z0-9_-]{20,})/  // Pattern untuk ID yang panjang
        ];
        
        for (const pattern of patterns) {
          const messageMatch = notification.message.match(pattern);
          const titleMatch = notification.title.match(pattern);
          
          console.log(`🔎 Pattern ${pattern} - Message match:`, messageMatch, 'Title match:', titleMatch);
          
          if (messageMatch && messageMatch[1]) {
            submissionId = messageMatch[1];
            console.log('✅ Found in message:', submissionId);
            break;
          }
          if (titleMatch && titleMatch[1]) {
            submissionId = titleMatch[1];
            console.log('✅ Found in title:', submissionId);
            break;
          }
        }
      }

      console.log('🔑 Final submission ID:', submissionId);

      if (submissionId) {
        console.log('🌐 Fetching submission details...');
        // Fetch submission details
        const response = await fetch(`/api/submissions/${submissionId}`);
        if (response.ok) {
          const submission = await response.json();
          console.log('✅ Submission loaded:', submission);
          setSelectedSubmission(submission);
        } else {
          console.error('❌ Failed to fetch submission:', response.statusText);
          showError('Error', 'Gagal memuat detail submission');
        }
      } else {
        console.warn('⚠️ No submission ID found in notification');
        showError('Error', 'ID submission tidak ditemukan dalam notifikasi ini');
      }
    } catch (error) {
      console.error('💥 Error handling notification detail:', error);
      showError('Error', 'Terjadi kesalahan saat memuat detail');
    }
  };

  // Add truncate function
  const truncateText = (text: string, maxLength: number = 100) => {
    return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;
  };

  // Filter notifications
  const filteredNotifications = Array.isArray(notifications) ? notifications
    .filter((notification: Notification) => {
      if (filter === 'unread') return !notification.isRead;
      if (filter === 'read') return notification.isRead;
      return true;
    })
    .filter((notification: Notification) => {
      if (!searchTerm) return true;
      return notification.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
             notification.message.toLowerCase().includes(searchTerm.toLowerCase());
    }) : [];

  if (status === 'loading') {
    return (
      <SidebarLayout title="Notifikasi" titlePage="Memuat...">
        <div className="max-w-5xl mx-auto px-3 md:px-6">
          <PageLoader message="Memuat notifikasi..." fullScreen={false} />
        </div>
      </SidebarLayout>
    );
  }

  return (
    <RoleGate allowedRoles={["SUPER_ADMIN", "VENDOR", "APPROVER", "REVIEWER"]}>
      <SidebarLayout title="Notifikasi" titlePage="Semua Notifikasi">
        <div className="max-w-5xl mx-auto space-y-4 md:space-y-6 px-3 md:px-6">
          
          {/* Header */}
          <div className="flex items-center justify-between rounded-xl border bg-white p-3 md:p-4 shadow-sm">
            <div className="flex items-center space-x-3">
              <div className="relative">
                <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                  <BellIcon className="w-5 h-5 text-blue-600" />
                </div>
                {unreadCount > 0 && (
                  <div className="absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5">
                    {unreadCount > 99 ? '99+' : unreadCount}
                  </div>
                )}
              </div>
              <div>
                <h1 className="text-base md:text-lg font-semibold text-gray-900">
                  {session?.user?.role === 'SUPER_ADMIN' ? 'Notifikasi' : 'Notifikasi'}
                </h1>
                <p className="text-sm text-gray-500">
                  {loading ? 'Memuat...' : unreadCount > 0 ? `${unreadCount} belum dibaca` : 'Semua sudah dibaca'}
                </p>
              </div>
            </div>
            
            {unreadCount > 0 && !loading && (
              <Button
                onClick={markAllAsRead}
                variant="outline"
                size="sm"
                className="flex items-center space-x-2 hover:bg-blue-50 hover:border-blue-300 transition-colors"
                aria-label="Tandai semua notifikasi sebagai dibaca"
              >
                <CheckIcon className="w-4 h-4" />
                <span className="hidden sm:inline">Tandai semua dibaca</span>
                <span className="sm:hidden">Tandai semua</span>
              </Button>
            )}
          </div>

          {/* Toolbar */}
          <div className="rounded-xl border bg-white p-3 md:p-4 shadow-sm">
            <div className="grid grid-cols-1 md:grid-cols-12 gap-3">
              {/* Search */}
              <div className="md:col-span-7">
                <div className="relative">
                  <MagnifyingGlassIcon className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                  <input
                    type="text"
                    placeholder="Cari notifikasi…"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900 placeholder:text-gray-500"
                    aria-label="Cari notifikasi"
                  />
                </div>
              </div>

              {/* Filters */}
              <div className="md:col-span-5 flex gap-2 md:justify-end">
                {/* Read State Filter */}
                <div className="flex rounded-lg border border-gray-300 bg-white p-1">
                  {(['all', 'unread', 'read'] as const).map((filterOption) => (
                    <button
                      key={filterOption}
                      onClick={() => setFilter(filterOption)}
                      className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${
                        filter === filterOption
                          ? 'bg-blue-100 text-blue-700'
                          : 'text-gray-600 hover:text-gray-900:text-gray-200'
                      }`}
                    >
                      {filterOption === 'all' && 'Semua'}
                      {filterOption === 'unread' && 'Belum Dibaca'}
                      {filterOption === 'read' && 'Sudah Dibaca'}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* Notifications List */}
          <div className="rounded-xl border bg-white shadow-sm overflow-hidden">
            {filteredNotifications.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-16 px-6">
                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                  <InboxIcon className="w-8 h-8 text-gray-400" />
                </div>
                <h3 className="text-lg font-medium text-gray-900 mb-2">
                  {searchTerm ? 'Tidak ada hasil' : 'Tidak ada notifikasi'}
                </h3>
                <p className="text-sm text-gray-500 text-center max-w-sm">
                  {searchTerm 
                    ? `Tidak ditemukan notifikasi yang cocok dengan "${searchTerm}"`
                    : 'Anda akan melihat notifikasi baru di sini ketika ada aktivitas'
                  }
                </p>
                {!searchTerm && (
                  <Button
                    onClick={() => window.location.href = '/dashboard'}
                    variant="outline"
                    size="sm"
                    className="mt-4"
                  >
                    Kembali ke Dashboard
                  </Button>
                )}
              </div>
            ) : (
              <div className="divide-y divide-gray-100">
                {filteredNotifications.map((notification: any) => {
                  const isUnread = !notification.isRead;
                  const fullTimestamp = new Date(notification.createdAt).toLocaleString('id-ID');
                  
                  return (
                    <div
                      key={notification.id}
                      className={`relative flex items-start gap-3 p-3 md:p-4 transition-all duration-200 hover:bg-gray-50:bg-gray-800/50 focus-within:ring-2 focus-within:ring-blue-500/30 ${
                        isUnread 
                          ? 'bg-blue-50/50 border-l-2 border-blue-500/50' 
                          : ''
                      } ${
                        hasSubmissionData(notification) || hasVendorData(notification) ? 'cursor-pointer' : ''
                      }`}
                      onClick={() => {
                        console.log('🖱️ Notification clicked:', notification);
                        console.log('📋 hasSubmissionData:', hasSubmissionData(notification));
                        console.log('👤 hasVendorData:', hasVendorData(notification));
                        
                        if (hasSubmissionData(notification) || hasVendorData(notification)) {
                          handleViewDetail(notification);
                        } else {
                          console.log('❌ No action taken - neither submission nor vendor data found');
                        }
                      }}
                      role="listitem"
                    >
                      {/* Unread indicator dot */}
                      {isUnread && (
                        <div className="absolute left-2 top-2.5 h-2 w-2 rounded-full bg-blue-600"></div>
                      )}

                      {/* Icon */}
                      <div className="shrink-0 h-9 w-9 rounded-full bg-gray-100 flex items-center justify-center ml-2">
                        {getNotificationIcon(notification.type)}
                      </div>

                      {/* Content */}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-start justify-between">
                          <div className="flex-1 min-w-0">
                            <h3 
                              className={`text-sm md:text-base leading-tight ${
                                isUnread 
                                  ? 'font-semibold text-gray-900' 
                                  : 'font-medium text-gray-800'
                              }`}
                              style={{ 
                                display: '-webkit-box',
                                WebkitLineClamp: 2,
                                WebkitBoxOrient: 'vertical',
                                overflow: 'hidden'
                              }}
                            >
                              {truncateText(notification.title, 80)}
                            </h3>
                            <p 
                              className="mt-0.5 text-xs md:text-sm text-gray-600 leading-relaxed"
                              style={{ 
                                display: '-webkit-box',
                                WebkitLineClamp: 2,
                                WebkitBoxOrient: 'vertical',
                                overflow: 'hidden'
                              }}
                            >
                              {truncateText(notification.message, 120)}
                            </p>
                          </div>
                          
                          <span 
                            className="text-[11px] md:text-xs text-gray-500 whitespace-nowrap ml-3"
                            title={fullTimestamp}
                          >
                            {formatTimeAgo(notification.createdAt)}
                          </span>
                        </div>

                        {/* Actions */}
                        {(hasSubmissionData(notification) || hasVendorData(notification)) && (
                          <div className="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
                            <button className="inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors">
                              {hasVendorData(notification) ? 'Lihat detail' : 'Lihat detail'}
                              <ArrowRightIcon className="w-3 h-3 ml-1" />
                            </button>
                            
                            {isUnread && (
                              <button
                                onClick={async (e) => {
                                  e.preventDefault();
                                  e.stopPropagation();
                                  await markAsRead(notification.id);
                                }}
                                className="inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50:bg-blue-900/20 transition-colors"
                                aria-label="Tandai sebagai dibaca"
                              >
                                <CheckIcon className="w-3 h-3" />
                                <span className="ml-1 hidden sm:inline">Tandai dibaca</span>
                              </button>
                            )}
                          </div>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}

            {/* Footer */}
            {filteredNotifications.length > 0 && (
              <div className="flex items-center justify-between text-sm text-gray-500 p-3 border-t border-gray-100 bg-gray-50/50">
                <span>
                  Menampilkan {filteredNotifications.length} dari {Array.isArray(notifications) ? notifications.length : 0} notifikasi
                </span>
                {/* Future: Load more functionality */}
              </div>
            )}
          </div>
        </div>

      {/* Modals */}
      {selectedSubmission && (
        <SubmissionDetailModal
          submission={selectedSubmission}
          isOpen={!!selectedSubmission}
          onClose={() => setSelectedSubmission(null)}
        />
      )}
      </SidebarLayout>
    </RoleGate>
  );
}


=== FILE: src/app/(dashboard)/dashboard/page.tsx ===
import { redirect } from "next/navigation";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

export default async function DashboardPage() {
  const session = await getServerSession(authOptions);
  if (!session) redirect("/login");

  const { role } = session.user;

  // Redirect to appropriate role-specific dashboard
  if (role === "SUPER_ADMIN") {
    redirect("/super-admin");
  } else if (role === "APPROVER") {
    redirect("/approver");
  } else if (role === "REVIEWER") {
    redirect("/reviewer");
  } else if (role === "VENDOR") {
    redirect("/vendor");
  } else if (role === "VERIFIER") {
    redirect("/verifier");
  }

  // Fallback
  redirect("/login");
}

=== FILE: src/app/(dashboard)/profile/page.tsx ===
import UserInfoCard from "@/components/user-profile/UserInfoCard";
import ChangePasswordCard from "@/components/user-profile/ChangePasswordCard";
import { Metadata } from "next";
import SidebarLayout from "@/components/layout/SidebarLayout";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/prisma";
import { redirect } from "next/navigation";

export const metadata: Metadata = {
  title: "Ubah Profil - SIMLOK",
  description: "Edit your profile information",
};

export default async function Profile() {
  const session = await getServerSession(authOptions);
  
  if (!session) {
    redirect('/login');
  }

  // Fetch complete user data
  const user = await prisma.user.findUnique({
    where: {
      id: session.user.id
    }
  });

  if (!user) {
    redirect('/login');
  }

  return (
    <SidebarLayout title="SIMLOK" titlePage="Ubah Profil">
      <div className="rounded-2xl border border-gray-200 bg-white p-5 lg:p-6">
        <div className="space-y-6">
          <UserInfoCard user={user} />
          <ChangePasswordCard />
        </div>
      </div>
    </SidebarLayout>
  );
}


=== FILE: src/app/(dashboard)/reviewer/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ReviewerDashboard from "@/components/reviewer/ReviewerDashboard";

export const metadata: Metadata = {
  title: "Dashboard Reviewer - SIMLOK",
  description: "Halaman dashboard untuk reviewer mengelola review pengajuan Simlok",
};

export default function ReviewerPage() {
  return (
    <RoleGate allowedRoles={["REVIEWER" , "SUPER_ADMIN"]}>
      <SidebarLayout title="Reviewer Panel" titlePage="Dashboard Review">
        <ReviewerDashboard />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/reviewer/scan-history/page.tsx ===
import { Metadata } from 'next';
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ReviewerScanHistoryContent from '@/components/reviewer/ReviewerScanHistoryContent';

export const metadata: Metadata = {
  title: 'Scan History - Reviewer Dashboard',
  description: 'Monitor submission scan activities by verifiers',
};

export default function ReviewerScanHistoryPage() {
  return (
    <RoleGate allowedRoles={["REVIEWER" , "SUPER_ADMIN"]}>
      <SidebarLayout title="Reviewer Panel" titlePage="Scan History">
        <ReviewerScanHistoryContent />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/reviewer/submissions/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import ReviewerSubmissionsManagement from "@/components/reviewer/ReviewerSubmissionsManagement";

export const metadata: Metadata = {
  title: "Daftar Pengajuan - Reviewer SIMLOK",
  description: "Halaman untuk reviewer melihat dan mengelola pengajuan Simlok",
};

export default function ReviewerSubmissionsPage() {
  return (
    <RoleGate allowedRoles={["REVIEWER", "SUPER_ADMIN"]}>
      <SidebarLayout title="Reviewer Panel" titlePage="Daftar Pengajuan">
        <ReviewerSubmissionsManagement />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/reviewer/users/page.tsx ===
"use client";

import { useState } from "react";
import { useSession } from "next-auth/react";
// Import role types
import { redirect } from "next/navigation";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import UserVerificationManagement from "@/components/reviewer/UserVerificationManagement";
import PageLoader from "@/components/ui/PageLoader";

export default function UserVerificationPage() {
  const { data: session, status } = useSession();
  
  // State untuk refresh tabel
  const [refreshTrigger] = useState(0);

  // Loading state
  if (status === "loading") {
    return <PageLoader message="Memuat halaman verifikasi user..." fullScreen={false} />;
  }

  // Redirect if not authenticated or not authorized
  if (!session || !["REVIEWER", "SUPER_ADMIN"].includes(session.user.role)) {
    redirect("/login");
  }

  return (
    <RoleGate allowedRoles={["REVIEWER", "SUPER_ADMIN"]}>
      <SidebarLayout title="Reviewer Panel" titlePage="Verifikasi User">
        <div className="space-y-6">
          {/* Header Section */}
          <div className="bg-white shadow-sm rounded-xl border border-gray-200/70">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-xl font-semibold text-gray-900">
                    Verifikasi User
                  </h1>
                  <p className="text-sm text-gray-600 mt-1">
                    Kelola dan verifikasi user vendor dalam sistem
                  </p>
                </div>
              </div>
            </div>

            {/* User Verification Management Component */}
            <div className="p-6">
              <UserVerificationManagement refreshTrigger={refreshTrigger} />
            </div>
          </div>
        </div>
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/super-admin/page.tsx ===
"use client";

import { useState, useEffect } from "react";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import Link from "next/link";
import { UserData } from "@/types/user";
import { UserIcon, CheckCircleIcon, ClockIcon } from "@heroicons/react/24/outline";

export default function SuperAdminDashboard() {
  const [stats, setStats] = useState({
    totalUsers: 0,
    pendingVerifications: 0,
    recentUsers: [] as UserData[]
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  useEffect(() => {
    async function fetchDashboardStats() {
      try {
        setLoading(true);
        const response = await fetch('/api/admin/dashboard-stats');
        if (!response.ok) {
          throw new Error('Failed to fetch dashboard statistics');
        }
        const data = await response.json();
        setStats({
          totalUsers: data.totalUsers,
          pendingVerifications: data.pendingVerifications,
          recentUsers: data.recentUsers
        });
      } catch (err) {
        console.error('Error fetching dashboard stats:', err);
        setError('Gagal memuat statistik dashboard');
      } finally {
        setLoading(false);
      }
    }

    fetchDashboardStats();
  }, []);

  const formatDate = (dateString: string | Date) => {
    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;
    return date.toLocaleDateString('id-ID', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  };

  return (
    <RoleGate allowedRoles={["SUPER_ADMIN"]}>
      <SidebarLayout title="Super Admin Panel" titlePage="Dashboard">
        <div className="space-y-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">
              Selamat Datang di Super Admin Dashboard
            </h1>
            <p className="text-gray-600 mt-2">
              Kelola seluruh user sistem SIMLOK dengan fitur CRUD lengkap.
            </p>
          </div>
          
          {/* Statistik Dashboard */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
              <div className="flex items-center">
                <div className="p-3 rounded-full bg-blue-100 mr-4">
                  <UserIcon className="h-6 w-6 text-blue-600" />
                </div>
                <div>
                  <p className="text-sm font-medium text-gray-600">Total User</p>
                  {loading ? (
                    <div className="h-6 w-16 bg-gray-200 animate-pulse rounded mt-1"></div>
                  ) : (
                    <p className="text-2xl font-bold text-gray-900">{stats.totalUsers}</p>
                  )}
                </div>
              </div>
            </div>
            
            <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
              <div className="flex items-center">
                <div className="p-3 rounded-full bg-green-100 mr-4">
                  <CheckCircleIcon className="h-6 w-6 text-green-600" />
                </div>
                <div>
                  <p className="text-sm font-medium text-gray-600">User Terverifikasi</p>
                  {loading ? (
                    <div className="h-6 w-16 bg-gray-200 animate-pulse rounded mt-1"></div>
                  ) : (
                    <p className="text-2xl font-bold text-gray-900">{stats.totalUsers - stats.pendingVerifications}</p>
                  )}
                </div>
              </div>
            </div>
            
            <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
              <div className="flex items-center">
                <div className="p-3 rounded-full bg-yellow-100 mr-4">
                  <ClockIcon className="h-6 w-6 text-yellow-600" />
                </div>
                <div>
                  <p className="text-sm font-medium text-gray-600">Menunggu Verifikasi</p>
                  {loading ? (
                    <div className="h-6 w-16 bg-gray-200 animate-pulse rounded mt-1"></div>
                  ) : (
                    <p className="text-2xl font-bold text-gray-900">{stats.pendingVerifications}</p>
                  )}
                </div>
              </div>
              {stats.pendingVerifications > 0 && (
                <div className="mt-4">
                  <Link
                    href="/super-admin/users?tab=pending"
                    className="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center"
                  >
                    Verifikasi sekarang
                    <svg className="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                  </Link>
                </div>
              )}
            </div>
          </div>
          
          {/* Tabel User Terbaru */}
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div className="px-6 py-4 border-b border-gray-200">
              <h2 className="text-lg font-semibold text-gray-900">User Terbaru</h2>
              <p className="text-sm text-gray-600">Daftar 5 user yang baru mendaftar</p>
            </div>
            
            {loading ? (
              <div className="p-6 space-y-4">
                {[...Array(5)].map((_, index) => (
                  <div key={index} className="flex items-center space-x-4">
                    <div className="h-10 w-10 rounded-full bg-gray-200 animate-pulse"></div>
                    <div className="space-y-2 flex-1">
                      <div className="h-4 bg-gray-200 rounded animate-pulse w-1/4"></div>
                      <div className="h-3 bg-gray-200 rounded animate-pulse w-1/2"></div>
                    </div>
                  </div>
                ))}
              </div>
            ) : error ? (
              <div className="p-6 text-center text-red-500">{error}</div>
            ) : stats.recentUsers.length === 0 ? (
              <div className="p-6 text-center text-gray-500">Tidak ada user terbaru</div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Daftar</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {stats.recentUsers.map((user) => (
                      <tr key={user.id}>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="text-sm font-medium text-gray-900">{user.officer_name}</div>
                          {user.vendor_name && (
                            <div className="text-sm text-gray-500">{user.vendor_name}</div>
                          )}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          {user.email}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <span className={`px-2 py-1 text-xs font-medium rounded-full ${

                            user.role === 'VENDOR' ? 'bg-blue-100 text-blue-800' :
                            user.role === 'VERIFIER' ? 'bg-green-100 text-green-800' : 
                            'bg-gray-100 text-gray-800'
                          }`}>
                            {user.role}
                          </span>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          {formatDate(user.created_at)}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          {user.verified_at ? (
                            <span className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                              Terverifikasi
                            </span>
                          ) : (
                            <span className="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
                              Menunggu
                            </span>
                          )}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <Link
                            href={`/super-admin/users?view=${user.id}`}
                            className="text-blue-600 hover:text-blue-900"
                          >
                            Detail
                          </Link>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
            
            <div className="px-6 py-4 border-t border-gray-200 bg-gray-50">
              <Link
                href="/super-admin/users"
                className="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center"
              >
                Lihat semua user
                <svg className="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </Link>
            </div>
          </div>
          
          {/* Card untuk akses cepat ke fitur */}
          <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
            <Link 
              href="/super-admin/users" 
              className="bg-white border border-gray-200 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow"
            >
              <h2 className="text-lg font-semibold text-gray-900 mb-2">Manajemen User</h2>
              <p className="text-gray-600 mb-4">
                Kelola semua pengguna sistem SIMLOK
              </p>
              <ul className="list-disc ml-5 text-gray-600 mb-4">
                <li>Menambah user baru dengan berbagai role</li>
                <li>Mengedit informasi user yang sudah ada</li>
                <li>Menghapus user yang tidak diperlukan</li>
              </ul>
            </Link>

            <Link 
              href="/super-admin/users?tab=pending" 
              className="bg-white border border-gray-200 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow"
            >
              <h2 className="text-lg font-semibold text-gray-900 mb-2">Approval Vendor Baru</h2>
              <p className="text-gray-600 mb-4">
                Verifikasi pendaftaran vendor baru
              </p>
              <ul className="list-disc ml-5 text-gray-600 mb-4">
                <li>Melihat detail vendor yang mendaftar</li>
                <li>Menyetujui pendaftaran yang valid</li>
                <li>Menolak pendaftaran yang tidak sesuai</li>
              </ul>
            </Link>
          </div>
        </div>
      </SidebarLayout>
    </RoleGate>
  );
}


=== FILE: src/app/(dashboard)/vendor/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import VendorDashboard from "@/components/dashboard/VendorDashboard";
import VerificationGuard from "@/components/security/VerificationGuard";

export const metadata: Metadata = {
  title: "Dashboard Vendor - SIMLOK",
  description: "Halaman dashboard untuk vendor mengelola pengajuan dan melihat status pengajuan",
};

export default function VendorPage() {
  return (
    <VerificationGuard>
      <RoleGate allowedRoles={["VENDOR"]}>
        <SidebarLayout title="Vendor Panel" titlePage="Dashboard">
          <VendorDashboard />
        </SidebarLayout>
      </RoleGate>
    </VerificationGuard>
  );
}

=== FILE: src/app/(dashboard)/vendor/submissions/create/page.tsx ===
import { getServerSession } from 'next-auth';
import { redirect } from 'next/navigation';
import { authOptions } from '@/lib/auth';
import SubmissionForm from '@/components/submissions/SubmissionForm';
import RoleGate from '@/components/security/RoleGate';
import SidebarLayout from '@/components/layout/SidebarLayout';
import VerificationGuard from '@/components/security/VerificationGuard';

export default async function CreateSubmissionPage() {
  const session = await getServerSession(authOptions);

  if (!session?.user) {
    redirect('/login');
  }

  if (session.user.role !== 'VENDOR') {
    redirect('/');
  }

  // Check verification status on server side
  if (!session.user.verified_at) {
    redirect('/verification-pending');
  }

  return (
    <VerificationGuard>
      <RoleGate allowedRoles={["VENDOR"]}>
        <SidebarLayout title="Vendor Panel" titlePage="Buat Pengajuan Baru">
          <SubmissionForm />
        </SidebarLayout>
      </RoleGate>
    </VerificationGuard>
  );
}


=== FILE: src/app/(dashboard)/vendor/submissions/edit/[id]/page.tsx ===
import { getServerSession } from 'next-auth';
import { redirect } from 'next/navigation';
import { authOptions } from '@/lib/auth';
import EditSubmissionForm from '../../../../../../components/vendor/EditSubmissionForm';
import SidebarLayout from '@/components/layout/SidebarLayout';

interface EditSubmissionPageProps {
  params: Promise<{
    id: string;
  }>;
}

export default async function EditSubmissionPage({ params }: EditSubmissionPageProps) {
  const session = await getServerSession(authOptions);

  if (!session?.user) {
    redirect('/login');
  }

  if (session.user.role !== 'VENDOR') {
    redirect('/admin');
  }

  // Await params as required by Next.js 15
  const { id } = await params;

  return (
    <SidebarLayout title="Vendor Panel" titlePage="Ubah Pengajuan SIMLOK">
      <div className="space-y-6">
      
        
        <EditSubmissionForm submissionId={id} />
      </div>
    </SidebarLayout>
  );
}


=== FILE: src/app/(dashboard)/vendor/submissions/page.tsx ===
import { Metadata } from "next";
import { getServerSession } from 'next-auth';
import { redirect } from 'next/navigation';
import { authOptions } from '@/lib/auth';
import RoleGate from '@/components/security/RoleGate';

export const metadata: Metadata = {
  title: "Daftar Pengajuan - SIMLOK",
  description: "Halaman untuk melihat dan mengelola daftar pengajuan vendor",
};
import SidebarLayout from '@/components/layout/SidebarLayout';
import VendorSubmissionsContent from '@/components/vendor/VendorSubmissionsContent';
import VerificationGuard from '@/components/security/VerificationGuard';

export default async function VendorSubmissionsPage() {
  const session = await getServerSession(authOptions);

  if (!session?.user) {
    redirect('/login');
  }

  if (session.user.role !== 'VENDOR') {
    redirect('/');
  }

  // Check verification status on server side
  if (!session.user.verified_at) {
    redirect('/verification-pending');
  }

  return (
    <VerificationGuard>
      <RoleGate allowedRoles={["VENDOR"]}>
        <SidebarLayout title="Vendor Panel" titlePage="Daftar Pengajuan">
          <VendorSubmissionsContent />
        </SidebarLayout>
      </RoleGate>
    </VerificationGuard>
  );
}


=== FILE: src/app/(dashboard)/verifier/history/page.tsx ===
import { Metadata } from 'next';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { redirect } from 'next/navigation';
import RoleGate from '@/components/security/RoleGate';
import SidebarLayout from '@/components/layout/SidebarLayout';
import VerifierScanHistory from '@/components/verifier/VerifierScanHistory';

export const metadata: Metadata = {
  title: 'Riwayat Scan - Verifier',
  description: 'Riwayat scan QR code SIMLOK oleh verifier',
};

export default async function VerifierHistoryPage() {
  const session = await getServerSession(authOptions);

  if (!session) {
    redirect('/auth/signin');
  }

  if (session.user.role !== 'VERIFIER') {
    redirect('/dashboard');
  }

  return (
    <RoleGate allowedRoles={["VERIFIER"]}>
      <SidebarLayout title="Riwayat Scan" titlePage="Verifier">
        <VerifierScanHistory />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/(dashboard)/verifier/page.tsx ===
import { Metadata } from "next";
import RoleGate from "@/components/security/RoleGate";
import SidebarLayout from "@/components/layout/SidebarLayout";
import VerifierDashboard from "@/components/verifier/VerifierDashboard";

export const metadata: Metadata = {
  title: "Dashboard Verifikator - SIMLOK",
  description: "Halaman dashboard untuk verifikator mengelola dan memverifikasi pengajuan",
};

export default function VerifierPage() {
  return (
    <RoleGate allowedRoles={["VERIFIER"]}>
      <SidebarLayout title="Verifier Panel" titlePage="Dashboard">
        <VerifierDashboard />
      </SidebarLayout>
    </RoleGate>
  );
}

=== FILE: src/app/api/approver/simloks/[id]/final/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { z } from 'zod';
import { generateQrString } from '@/lib/qr-security';

// Schema for validating final approval data
const finalApprovalSchema = z.object({
  final_status: z.enum(['APPROVED', 'REJECTED']),
  final_note: z.string().optional(),
  simlok_number: z.string().optional(),
  simlok_date: z.string().optional(),
});

// Function to generate simlok number - mengikuti sistem admin yang sudah ada
async function generateSimlokNumber(): Promise<string> {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format

  // Get the last SIMLOK number for current month/year
  const lastSubmission = await prisma.submission.findFirst({
    where: {
      simlok_number: {
        contains: `/${month}/${year}`
      }
    },
    orderBy: {
      simlok_number: 'desc'
    }
  });

  let nextNumber = 1;
  
  if (lastSubmission?.simlok_number) {
    // Extract number from format: number/MM/YYYY
    const match = lastSubmission.simlok_number.match(/^(\d+)\/\d{2}\/\d{4}$/);
    if (match && match[1]) {
      nextNumber = parseInt(match[1]) + 1;
    }
  }

  return `${nextNumber}/${month}/${year}`;
}

// PATCH /api/approver/simloks/[id]/final - Set final approval status
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });
    }

    const resolvedParams = await params;
    
    // Check if submission exists and has been reviewed
    const existingSubmission = await prisma.submission.findUnique({
      where: { id: resolvedParams.id },
      select: {
        id: true,
        review_status: true,
        final_status: true,
        user_id: true,
        implementation_start_date: true,
        implementation_end_date: true,
        user: {
          select: {
            id: true,
            vendor_name: true,
            officer_name: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
          }
        }
      }
    });

    if (!existingSubmission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Cannot finalize if not reviewed yet
    if (existingSubmission.review_status === 'PENDING_REVIEW') {
      return NextResponse.json({ 
        error: 'Cannot finalize submission that has not been reviewed yet' 
      }, { status: 400 });
    }

    // Cannot finalize if already finalized
    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {
      return NextResponse.json({ 
        error: 'Submission has already been finalized' 
      }, { status: 400 });
    }

    const body = await request.json();
    const validatedData = finalApprovalSchema.parse(body);

    // Generate simlok number only if approved
    const updateData: any = {
      final_status: validatedData.final_status,
      final_note: validatedData.final_note || null,
      approved_by_final_id: session.user.id,
      approved_at: new Date(),
    };

    if (validatedData.final_status === 'APPROVED') {
      // Use provided simlok number or generate one
      updateData.simlok_number = validatedData.simlok_number?.trim() || await generateSimlokNumber();
      
      // Use provided date or current date
      if (validatedData.simlok_date) {
        updateData.simlok_date = new Date(validatedData.simlok_date);
      } else {
        updateData.simlok_date = new Date();
      }
      
      // Auto-generate QR code when approved
      const qrString = generateQrString({
        id: resolvedParams.id,
        implementation_start_date: existingSubmission.implementation_start_date || null,
        implementation_end_date: existingSubmission.implementation_end_date || null
      });
      updateData.qrcode = qrString;
      
      updateData.approval_status = 'APPROVED'; // Update legacy field too
    } else {
      updateData.approval_status = 'REJECTED'; // Update legacy field too
    }

    const updatedSubmission = await prisma.submission.update({
      where: { id: resolvedParams.id },
      data: updateData,
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        approved_by_final_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        }
      }
    });

    // Log QR code generation for approved submissions
    if (validatedData.final_status === 'APPROVED' && updateData.qrcode) {
      console.log(`✅ QR Code auto-generated for approved submission ${resolvedParams.id}: ${updateData.qrcode.substring(0, 50)}...`);
    }

    // Import and use the event system for real-time notifications
    const { notifyVendorStatusChange, notifyReviewerSubmissionApproved } = await import('@/server/events');
    
    // Notify vendor with real-time updates
    const vendorStatus = validatedData.final_status === 'APPROVED' ? 'APPROVED' : 'REJECTED';
    await notifyVendorStatusChange(
      existingSubmission.user.id, 
      resolvedParams.id, 
      vendorStatus as 'APPROVED' | 'REJECTED'
    );

    // Notify reviewers when submission is approved
    if (validatedData.final_status === 'APPROVED') {
      await notifyReviewerSubmissionApproved(resolvedParams.id);
    }

    return NextResponse.json({ 
      submission: updatedSubmission,
      message: `Submission ${validatedData.final_status.toLowerCase()} successfully`
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json({ 
        error: 'Validation error', 
        details: error.issues 
      }, { status: 400 });
    }
    
    console.error('Error finalizing submission:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}


=== FILE: src/app/api/approver/simloks/[id]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

// GET /api/approver/simloks/[id] - Get single submission for final approval (read-only)
export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });
    }

    const resolvedParams = await params;
    const submission = await prisma.submission.findUnique({
      where: { id: resolvedParams.id },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        approved_by_final_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          select: {
            id: true,
            worker_name: true,
            worker_photo: true,
            created_at: true,
          },
          orderBy: {
            created_at: 'asc'
          }
        }
      }
    });

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    return NextResponse.json({ submission });
  } catch (error) {
    console.error('Error fetching submission for approval:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/approver/simloks/[id]/workers/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

interface Params {
  id: string;
}

export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<Params> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });
    }

    const { id } = await params;

    // Check if submission exists
    const submission = await prisma.submission.findUnique({
      where: { id: id }
    });

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Get workers for this submission
    const workers = await prisma.workerList.findMany({
      where: {
        submission_id: id
      },
      orderBy: {
        created_at: 'asc'
      }
    });

    return NextResponse.json({ workers });
  } catch (error) {
    console.error('Error fetching workers for approver:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/approver/simloks/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

// GET /api/approver/simloks - Get reviewed submissions for approval
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const reviewStatus = searchParams.get('reviewStatus');
    const finalStatus = searchParams.get('finalStatus');
    const vendorId = searchParams.get('vendorId');
    const search = searchParams.get('search');
    const sortBy = searchParams.get('sortBy') || 'reviewed_at';
    const sortOrder = searchParams.get('sortOrder') || 'desc';
    const skip = (page - 1) * limit;

    const whereClause: any = {
      // Only show submissions that have been reviewed (not pending review)
      review_status: {
        not: 'PENDING_REVIEW'
      }
    };

    // Filter by specific review status if provided
    if (reviewStatus && ['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {
      whereClause.review_status = reviewStatus;
    }

    // Filter by final status if provided
    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {
      whereClause.final_status = finalStatus;
    }

    // Filter by vendor if provided
    if (vendorId) {
      whereClause.user_id = vendorId;
    }

    // Filter by search term (vendor name, job description, or officer name)
    if (search) {
      whereClause.OR = [
        {
          vendor_name: {
            contains: search
          }
        },
        {
          job_description: {
            contains: search
          }
        },
        {
          officer_name: {
            contains: search
          }
        }
      ];
    }

    const [submissions, total, statistics] = await Promise.all([
      prisma.submission.findMany({
        where: whereClause,
        include: {
          user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
              vendor_name: true,
            }
          },
          reviewed_by_user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
            }
          },
          approved_by_final_user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
            }
          },
          worker_list: {
            select: {
              id: true,
              worker_name: true,
              worker_photo: true,
            }
          }
        },
        orderBy: { [sortBy]: sortOrder },
        skip,
        take: limit,
      }),
      prisma.submission.count({ where: whereClause }),
      // Get statistics for approver dashboard
      Promise.all([
        prisma.submission.count({
          where: {
            review_status: 'MEETS_REQUIREMENTS',
            final_status: 'PENDING_APPROVAL'
          }
        }),
        prisma.submission.count({
          where: {
            review_status: 'NOT_MEETS_REQUIREMENTS',
            final_status: 'PENDING_APPROVAL'
          }
        }),
        prisma.submission.count({
          where: {
            final_status: 'APPROVED'
          }
        }),
        prisma.submission.count({
          where: {
            final_status: 'REJECTED'
          }
        }),
      ])
    ]);

    // Format statistics
    const [meetsCount, notMeetsCount, approvedCount, rejectedCount] = statistics;
    const stats = {
      total: total,
      pending_approval_meets: meetsCount,
      pending_approval_not_meets: notMeetsCount,
      approved: approvedCount,
      rejected: rejectedCount,
    };

    return NextResponse.json({
      submissions,
      statistics: stats,
      pagination: {
        page,
        limit,
        total,
        pages: Math.ceil(total / limit),
      }
    });
  } catch (error) {
    console.error('Error fetching approver submissions:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/auth/[...nextauth]/route.ts ===
// app/api/auth/[...nextauth]/route.ts
import NextAuth from "next-auth";
import { authOptions } from "@/lib/auth";

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };

=== FILE: src/app/api/auth/signup/route.ts ===
// app/api/auth/signup/route.ts
import { NextRequest, NextResponse } from "next/server";
import { prisma } from "@/lib/singletons";
import bcrypt from "bcryptjs";
import { z } from "zod";
import { notifyAdminNewVendor } from "@/server/events";

// Validation schema for vendor registration
const vendorRegistrationSchema = z.object({
  csrfToken: z.string().min(1, "CSRF token is required"),
  officer_name: z.string()
    .min(2, "Nama petugas minimal 2 karakter")
    .max(100, "Nama petugas maksimal 100 karakter")
    .trim(),
  email: z.string()
    .email("Format email tidak valid")
    .min(5, "Email terlalu pendek")
    .max(100, "Email terlalu panjang")
    .toLowerCase(),
  password: z.string()
    .min(8, "Password minimal 8 karakter")
    .max(100, "Password terlalu panjang")
    .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, "Password harus mengandung huruf besar, huruf kecil, dan angka"),
  vendor_name: z.string()
    .min(2, "Nama vendor minimal 2 karakter")
    .max(150, "Nama vendor maksimal 150 karakter")
    .trim(),
  address: z.string()
    .min(10, "Alamat minimal 10 karakter")
    .max(500, "Alamat maksimal 500 karakter")
    .trim(),
  phone_number: z.string()
    .min(10, "Nomor telepon minimal 10 digit")
    .max(15, "Nomor telepon maksimal 15 digit")
    .regex(/^[0-9+\-\s]+$/, "Nomor telepon hanya boleh berisi angka, +, -, dan spasi")
    .trim(),
});

// Rate limiting store (in production, use Redis)
const registrationAttempts = new Map<string, { count: number; lastAttempt: number }>();

function checkRateLimit(ip: string): boolean {
  const now = Date.now();
  const windowMs = 15 * 60 * 1000; // 15 minutes
  const maxAttempts = 5; // Maximum 5 registration attempts per 15 minutes

  const attempts = registrationAttempts.get(ip);
  
  if (!attempts) {
    registrationAttempts.set(ip, { count: 1, lastAttempt: now });
    return true;
  }

  // Reset counter if window has passed
  if (now - attempts.lastAttempt > windowMs) {
    registrationAttempts.set(ip, { count: 1, lastAttempt: now });
    return true;
  }

  // Check if limit exceeded
  if (attempts.count >= maxAttempts) {
    return false;
  }

  // Increment counter
  attempts.count++;
  attempts.lastAttempt = now;
  return true;
}

function validateCsrfToken(req: NextRequest, csrfToken: string): boolean {
  try {
    const cookieHeader = req.headers.get("cookie") || "";
    const csrfCookie = cookieHeader
      .split("; ")
      .find((c) => c.startsWith("__Host-next-auth.csrf-token=") || c.startsWith("next-auth.csrf-token="));

    if (!csrfCookie) {
      return false;
    }

    // Format cookie: token|hash, URL encoded %7C = |
    const cookieValue = decodeURIComponent(csrfCookie.split("=")[1] || '');
    const [expectedToken] = cookieValue.split("|");
    
    return expectedToken === csrfToken;
  } catch (error) {
    console.error("CSRF validation error:", error);
    return false;
  }
}

export async function POST(req: NextRequest) {
  try {
    // Get client IP for rate limiting
    const clientIP = req.headers.get("x-forwarded-for") || 
                     req.headers.get("x-real-ip") || 
                     "127.0.0.1";

    // Check rate limit
    if (!checkRateLimit(clientIP)) {
      return NextResponse.json(
        { error: "Terlalu banyak percobaan pendaftaran. Silakan coba lagi dalam 15 menit." }, 
        { status: 429 }
      );
    }

    // Parse and validate request body
    const body = await req.json();
    
    // Validate input using Zod schema
    const validationResult = vendorRegistrationSchema.safeParse(body);
    
    if (!validationResult.success) {
      const errors = validationResult.error.issues.map((err: any) => err.message).join(", ");
      return NextResponse.json({ error: errors }, { status: 400 });
    }

    const { csrfToken, officer_name, email, password, vendor_name, address, phone_number } = validationResult.data;

    // Validate CSRF token
    if (!validateCsrfToken(req, csrfToken)) {
      return NextResponse.json({ error: "Invalid CSRF token" }, { status: 403 });
    }

    // Check if user already exists
    const existingUser = await prisma.user.findUnique({ 
      where: { email },
      select: { id: true, email: true }
    });
    
    if (existingUser) {
      return NextResponse.json({ error: "Email sudah terdaftar" }, { status: 409 });
    }

    // Check if vendor name already exists (case-insensitive)
    const existingVendor = await prisma.user.findFirst({
      where: { 
        vendor_name: {
          equals: vendor_name,
        }
      },
      select: { id: true, vendor_name: true }
    });

    if (existingVendor) {
      return NextResponse.json({ error: "Nama vendor sudah terdaftar" }, { status: 409 });
    }

    // Hash password with strong settings
    const saltRounds = 12;
    const hashedPassword = await bcrypt.hash(password, saltRounds);

    // Create new vendor user
    const newUser = await prisma.user.create({
      data: {
        officer_name,
        email,
        password: hashedPassword,
        vendor_name,
        address,
        phone_number,
        role: "VENDOR", // Always VENDOR for this registration endpoint
        verified_at: null, // Requires admin verification
      },
      select: {
        id: true,
        officer_name: true,
        email: true,
        vendor_name: true,
        role: true,
        created_at: true,
        verified_at: true,
      }
    });

    // Notify admin and reviewer about new vendor registration
    await notifyAdminNewVendor(newUser.id);
    
    const { notifyReviewerNewUser } = await import('@/server/events');
    await notifyReviewerNewUser(newUser.id);

    // Log successful registration (for audit purposes)
    console.log(`New vendor registered: ${email} (${vendor_name}) at ${new Date().toISOString()}`);

    return NextResponse.json(
      { 
        message: "Pendaftiran berhasil! Akun Anda sedang menunggu verifikasi admin.", 
        user: {
          id: newUser.id,
          officer_name: newUser.officer_name,
          email: newUser.email,
          vendor_name: newUser.vendor_name,
          role: newUser.role,
          verified: !!newUser.verified_at,
        }
      },
      { status: 201 }
    );

  } catch (error) {
    console.error("Registration error:", error);
    
    // Don't expose internal errors to client
    return NextResponse.json(
      { error: "Terjadi kesalahan internal server. Silakan coba lagi." }, 
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/debug/vendor-notifications/route.ts ===


=== FILE: src/app/api/files/[userId]/[category]/[filename]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { readFile } from 'fs/promises';
import { join } from 'path';
import { existsSync } from 'fs';

export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ userId: string; category: string; filename: string }> }
) {
  try {
    // Get session to check authentication
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Await params for Next.js 15 compatibility
    const { userId, category, filename } = await params;

    // Check if user can access this file
    // Users can only access their own files, unless they're super admin, reviewer, or approver
    const canAccess = 
      session.user.role === 'SUPER_ADMIN' || 
      session.user.role === 'REVIEWER' || 
      session.user.role === 'APPROVER' ||
      session.user.id === userId;

    // Debug logging
    console.log('File access check:', {
      requestedUserId: userId,
      sessionUserId: session.user.id,
      userRole: session.user.role,
      category,
      filename,
      canAccess
    });
      
    if (!canAccess) {
      return NextResponse.json({ error: 'Access denied' }, { status: 403 });
    }

    // Map category to folder name
    const categoryFolders = {
      sika: 'dokumen-sika',
      simja: 'dokumen-simja',
      other: 'lainnya',
      'worker-photo': 'foto-pekerja'
    };

    const folderName = categoryFolders[category as keyof typeof categoryFolders];
    if (!folderName) {
      return NextResponse.json({ error: 'Invalid category' }, { status: 400 });
    }

    // Construct file path
    const filePath = join(process.cwd(), 'public', 'uploads', userId, folderName, filename);

    // Check if file exists
    if (!existsSync(filePath)) {
      return NextResponse.json({ error: 'File not found' }, { status: 404 });
    }

    // Read file
    const fileBuffer = await readFile(filePath);

    // Determine content type based on file extension
    const extension = filename.split('.').pop()?.toLowerCase();
    let contentType = 'application/octet-stream';
    
    switch (extension) {
      case 'pdf':
        contentType = 'application/pdf';
        break;
      case 'jpg':
      case 'jpeg':
        contentType = 'image/jpeg';
        break;
      case 'png':
        contentType = 'image/png';
        break;
      case 'gif':
        contentType = 'image/gif';
        break;
      case 'doc':
        contentType = 'application/msword';
        break;
      case 'docx':
        contentType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';
        break;
    }

    // Return file with proper headers
    return new NextResponse(new Uint8Array(fileBuffer), {
      headers: {
        'Content-Type': contentType,
        'Content-Disposition': `inline; filename="${filename}"`,
        'Cache-Control': 'private, max-age=3600', // Cache for 1 hour
      },
    });

  } catch (error) {
    console.error('File serving error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}


=== FILE: src/app/api/files/manage/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { fileManager } from '@/lib/fileManager';

// GET /api/files/manage - List all user files
export async function GET() {
  try {
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const files = await fileManager.listUserFiles(session.user.id);
    
    return NextResponse.json({
      success: true,
      files
    });

  } catch (error) {
    console.error('Error listing files:', error);
    return NextResponse.json({ 
      error: 'Internal server error' 
    }, { status: 500 });
  }
}

// POST /api/files/manage - Rename or move file
export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const body = await request.json();
    const { action, oldFileName, newName, category } = body;

    if (action === 'rename') {
      if (!oldFileName || !newName) {
        return NextResponse.json({ 
          error: 'oldFileName and newName are required' 
        }, { status: 400 });
      }

      const result = await fileManager.renameFile(
        session.user.id,
        oldFileName,
        newName,
        category
      );

      if (!result) {
        return NextResponse.json({ 
          error: 'Failed to rename file' 
        }, { status: 400 });
      }

      return NextResponse.json({
        success: true,
        file: result
      });
    }

    if (action === 'migrate') {
      const result = await fileManager.migrateExistingFiles(session.user.id);
      
      return NextResponse.json({
        success: true,
        migrated: result.moved,
        errors: result.errors
      });
    }

    return NextResponse.json({ 
      error: 'Invalid action' 
    }, { status: 400 });

  } catch (error) {
    console.error('Error managing files:', error);
    return NextResponse.json({ 
      error: 'Internal server error' 
    }, { status: 500 });
  }
}

// DELETE /api/files/manage - Delete file
export async function DELETE(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(request.url);
    const fileName = searchParams.get('fileName');

    if (!fileName) {
      return NextResponse.json({ 
        error: 'fileName is required' 
      }, { status: 400 });
    }

    const success = await fileManager.deleteFile(session.user.id, fileName);

    if (!success) {
      return NextResponse.json({ 
        error: 'Failed to delete file' 
      }, { status: 400 });
    }

    return NextResponse.json({
      success: true,
      message: 'File deleted successfully'
    });

  } catch (error) {
    console.error('Error deleting file:', error);
    return NextResponse.json({ 
      error: 'Internal server error' 
    }, { status: 500 });
  }
}


=== FILE: src/app/api/notifications/stream/route.ts ===
import { NextRequest } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { redisPub } from '@/lib/singletons';

export const runtime = 'nodejs';

export async function GET(request: NextRequest) {
  const session = await getServerSession(authOptions);
  
  if (!session?.user) {
    return new Response('Unauthorized', { status: 401 });
  }

  const searchParams = request.nextUrl.searchParams;
  const scope = searchParams.get('scope') || 
    (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN' ? 'admin' :
     session.user.role === 'REVIEWER' ? 'reviewer' :
     session.user.role === 'APPROVER' ? 'approver' : 'vendor');
  const vendorId = searchParams.get('vendorId') || session.user.id;

  // Create Server-Sent Events stream
  const stream = new ReadableStream({
    start(controller) {
      console.log('🔥 SSE connection established for:', { scope, vendorId, role: session.user.role });

      // Send initial connection message
      const encoder = new TextEncoder();
      controller.enqueue(encoder.encode(`data: ${JSON.stringify({ 
        type: 'connected', 
        message: 'Real-time notifications connected',
        scope,
        vendorId,
        role: session.user.role
      })}\n\n`));

      // Subscribe to Redis channels for real-time updates
      let channelName: string;
      switch (scope) {
        case 'admin':
          channelName = 'notifications:admin';
          break;
        case 'reviewer':
          channelName = 'notifications:reviewer';
          break;
        case 'approver':
          channelName = 'notifications:approver';
          break;
        case 'vendor':
          channelName = `notifications:vendor:${vendorId}`;
          break;
        default:
          channelName = 'notifications:admin';
      }
      
      // Create a Redis subscriber for this connection
      const subscriber = redisPub.duplicate();
      
      subscriber.subscribe(channelName, (err, count) => {
        if (err) {
          console.error('Redis subscribe error:', err);
          return;
        }
        console.log(`📡 Subscribed to Redis channel: ${channelName} (${count} channels)`);
      });

      subscriber.on('message', (channel, message) => {
        try {
          console.log(`📨 SSE Received message on ${channel}:`, message);
          const data = JSON.parse(message);
          
          // Send the notification data to client
          controller.enqueue(encoder.encode(`data: ${JSON.stringify(data)}\n\n`));
          console.log(`📤 SSE Forwarded message to client:`, data.type);
        } catch (error) {
          console.error('❌ SSE Error processing Redis message:', error);
        }
      });

      // Keep connection alive with heartbeat
      const heartbeat = setInterval(() => {
        controller.enqueue(encoder.encode(`data: ${JSON.stringify({ 
          type: 'heartbeat', 
          timestamp: new Date().toISOString() 
        })}\n\n`));
      }, 30000); // Every 30 seconds

      // Cleanup on connection close
      request.signal.addEventListener('abort', () => {
        console.log('🔌 SSE connection closed for:', { scope, vendorId });
        clearInterval(heartbeat);
        subscriber.unsubscribe();
        subscriber.disconnect();
        controller.close();
      });
    }
  });

  return new Response(stream, {
    headers: {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive',
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Headers': 'Cache-Control',
    },
  });
}


=== FILE: src/app/api/qr/verify/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { parseQrString, type QrPayload } from '@/lib/qr-security';

// POST /api/qr/verify - Verify QR code and return submission data
export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only VERIFIER and ADMIN can scan QR codes/barcodes
    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ 
        error: 'Access denied. Only verifiers and admins can scan QR codes/barcodes.' 
      }, { status: 403 });
    }

    const body = await request.json();
    const { qrData, qr_data, scanLocation, scanNotes, scanner_type } = body;

    // Support both qrData and qr_data parameter names for compatibility
    const qrString = qr_data || qrData;

    console.log('=== QR VERIFY API ===');
    console.log('Received qrString:', qrString);
    console.log('qrString length:', qrString?.length);
    console.log('scanner_type:', scanner_type);
    console.log('session.user:', session.user);
    console.log('session.user.id:', session.user.id);
    console.log('session.user.role:', session.user.role);
    console.log('====================');

    if (!qrString) {
      console.log('ERROR: No QR/Barcode string provided');
      return NextResponse.json({ 
        success: false,
        message: 'QR/Barcode string is required' 
      }, { status: 400 });
    }

    // Parse and verify QR code or barcode
    const qrPayload: QrPayload | null = parseQrString(qrString);
    
    console.log('=== QR PARSING RESULT ===');
    console.log('Parsed payload:', qrPayload);
    console.log('========================');
    
    if (!qrPayload) {
      console.log('ERROR: Failed to parse QR/Barcode');
      return NextResponse.json({ 
        success: false,
        message: 'Invalid QR code/barcode or data has been tampered with. Please make sure you are scanning a valid SIMLOK QR code or barcode generated by the system.' 
      }, { status: 400 });
    }

    // Check if QR/Barcode is valid for current date (simplified check)
    const now = Date.now();
    if (qrPayload.timestamp && now > qrPayload.timestamp + (7 * 24 * 60 * 60 * 1000)) { // 7 days validity
      return NextResponse.json({ 
        success: false,
        message: 'QR code/barcode has expired. Please generate a new one.' 
      }, { status: 400 });
    }

    // Fetch submission data
    const submission = await prisma.submission.findUnique({
      where: { id: qrPayload.id },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        approved_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          select: {
            id: true,
            worker_name: true,
            worker_photo: true,
          },
          orderBy: {
            created_at: 'asc'
          }
        }
      }
    });

    if (!submission) {
      return NextResponse.json({ 
        success: false,
        message: 'Submission not found' 
      }, { status: 404 });
    }

    // Check if submission is approved
    if (submission.approval_status !== 'APPROVED') {
      return NextResponse.json({ 
        success: false,
        message: 'This submission is not approved yet' 
      }, { status: 400 });
    }

    // DEBUG: Check user session and database
    console.log('=== USER SESSION DEBUG ===');
    console.log('session.user:', JSON.stringify(session.user, null, 2));
    console.log('session.user.id:', session.user.id);
    
    // Check if this user exists in database
    const userExists = await prisma.user.findUnique({
      where: { id: session.user.id },
      select: { id: true, email: true, role: true, officer_name: true, address: true }
    });
    console.log('userExists in DB:', userExists);
    
    if (!userExists) {
      console.log('ERROR: User not found in database');
      return NextResponse.json({ 
        success: false,
        message: 'User session is invalid. Please login again.' 
      }, { status: 401 });
    }

    // Check for duplicate scans - only prevent same verifier scanning same SIMLOK on same day
    console.log('=== CHECKING FOR DUPLICATE SCAN BY SAME VERIFIER ON SAME DAY ===');
    console.log('submission_id:', qrPayload.id);
    console.log('scanned_by:', session.user.id);
    
    // Get today's date range (start and end of day)
    const today = new Date();
    const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);
    const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);
    
    // Check if the same verifier has already scanned today
    const existingTodayScanByUser = await prisma.qrScan.findFirst({
      where: {
        submission_id: qrPayload.id,
        scanned_by: session.user.id,
        scanned_at: {
          gte: startOfDay,
          lte: endOfDay,
        }
      },
      include: {
        user: {
          select: {
            officer_name: true,
          },
        },
      },
    });

    console.log('existingTodayScanByUser found:', !!existingTodayScanByUser);

    if (existingTodayScanByUser) {
      console.log('=== DUPLICATE SCAN BY SAME USER TODAY DETECTED ===');
      const scanDate = new Date(existingTodayScanByUser.scanned_at);
      const formattedDate = scanDate.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
      });

      return NextResponse.json({ 
        success: false, 
        error: 'duplicate_scan_same_day',
        message: `QR code sudah anda scan hari ini pada ${formattedDate}. Satu verifikator hanya dapat melakukan scan sekali per hari untuk SIMLOK yang sama.`,
        previousScan: {
          scanDate: existingTodayScanByUser.scanned_at,
          scanId: existingTodayScanByUser.id,
          scannerName: existingTodayScanByUser.user.officer_name,
        }
      }, { status: 409 });
    }

    // Note: Different verifiers CAN scan the same SIMLOK on the same day
    // This is allowed per the new requirements

    console.log('=== NO DUPLICATE FOUND, PROCEEDING TO CREATE SCAN RECORD ===');

    console.log('User verified for scan record creation:', userExists);

    // Record the scan in database
    try {
      const scanRecord = await prisma.qrScan.create({
        data: {
          submission_id: qrPayload.id,
          scanned_by: session.user.id,
          scanner_name: userExists.officer_name || session.user.officer_name,
          scan_location: userExists.address || 'Lokasi tidak tersedia',
          notes: scanNotes || `Scanned via ${scanner_type || 'scanner'} at: ${scanLocation || 'Unknown location'}`,
        },
        include: {
          user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
              role: true,
            }
          }
        }
      });

      console.log('=== SCAN RECORD CREATED SUCCESSFULLY ===');
      console.log('scanRecord.id:', scanRecord.id);

      // Return verification result with submission data in the format expected by the modal
      return NextResponse.json({
        success: true,
        message: 'QR code/barcode verified successfully',
        scan_id: scanRecord.id,
        scanned_at: scanRecord.scanned_at,
        scanned_by: scanRecord.user.officer_name,
        data: {
          submission: {
            id: submission.id,
            number: submission.simlok_number,
            title: submission.job_description,
            task: submission.implementation || 'No task description',
            workers: submission.worker_list.map(worker => ({ name: worker.worker_name })),
            vendor: submission.vendor_name ? { name: submission.vendor_name } : undefined,
            location: submission.work_location || undefined,
            implementation_start_date: submission.implementation_start_date?.toISOString(),
            implementation_end_date: submission.implementation_end_date?.toISOString(),
            status: submission.approval_status.toLowerCase(),
          }
        }
      });

    } catch (createError: any) {
      console.error('Error creating scan record:', createError);
      
      // Check if it's a unique constraint violation (in case of race condition)
      if (createError?.code === 'P2002') {
        console.log('=== UNIQUE CONSTRAINT VIOLATION DETECTED (RACE CONDITION) ===');
        
        // Check again for today's scans by same user only (race condition handling)
        const today = new Date();
        const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);
        const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);
        
        const raceConditionScan = await prisma.qrScan.findFirst({
          where: {
            submission_id: qrPayload.id,
            scanned_by: session.user.id, // Only check for same user
            scanned_at: {
              gte: startOfDay,
              lte: endOfDay,
            }
          },
          include: {
            user: {
              select: {
                officer_name: true,
              },
            },
          },
        });

        if (raceConditionScan) {
          const scanDate = new Date(raceConditionScan.scanned_at);
          const formattedDate = scanDate.toLocaleDateString('id-ID', {
            day: '2-digit',
            month: '2-digit', 
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
          });

          return NextResponse.json({ 
            success: false, 
            error: 'duplicate_scan_same_day',
            message: `Anda sudah melakukan scan untuk SIMLOK ini hari ini pada ${formattedDate}. Verifikator yang sama tidak dapat scan SIMLOK yang sama di hari yang sama.`
          }, { status: 409 });
        }

        return NextResponse.json({ 
          success: false, 
          error: 'duplicate_scan',
          message: 'QR Code ini sudah pernah discan hari ini (race condition detected)'
        }, { status: 409 });
      }
      
      throw createError; // Re-throw if it's not a constraint violation
    }

  } catch (error) {
    console.error('QR/Barcode verification error:', error);
    return NextResponse.json({ 
      success: false,
      message: 'Internal server error during QR/Barcode verification' 
    }, { status: 500 });
  }
}

// GET /api/qr/verify - Get recent scan history (for admin/verifier dashboard)
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only VERIFIER and ADMIN can view scan history
    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ 
        error: 'Access denied. Only verifiers and admins can view scan history.' 
      }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const limit = Math.min(parseInt(searchParams.get('limit') || '50'), 100);
    const offset = parseInt(searchParams.get('offset') || '0');
    const submissionId = searchParams.get('submission_id');
    const search = searchParams.get('search');
    const status = searchParams.get('status');
    const dateFrom = searchParams.get('dateFrom');
    const dateTo = searchParams.get('dateTo');
    const location = searchParams.get('location');

    // Build where clause
    const whereClause: any = {};
    
    if (submissionId) {
      whereClause.submission_id = submissionId;
    }

    // For verifiers, only show their own scans
    if (session.user.role === 'VERIFIER') {
      whereClause.scanned_by = session.user.id;
    }

    // Add search filter
    if (search) {
      whereClause.OR = [
        {
          submission: {
            simlok_number: {
              contains: search
            }
          }
        },
        {
          submission: {
            vendor_name: {
              contains: search
            }
          }
        },
        {
          scan_location: {
            contains: search
          }
        }
      ];
    }

    // Add status filter
    if (status) {
      whereClause.submission = {
        ...whereClause.submission,
        approval_status: status
      };
    }

    // Add date range filter
    if (dateFrom || dateTo) {
      whereClause.scanned_at = {};
      if (dateFrom) {
        whereClause.scanned_at.gte = new Date(dateFrom);
      }
      if (dateTo) {
        const endDate = new Date(dateTo);
        endDate.setHours(23, 59, 59, 999); // End of day
        whereClause.scanned_at.lte = endDate;
      }
    }

    // Add location filter
    if (location) {
      whereClause.scan_location = {
        contains: location
      };
    }

    // Fetch scan history
    const scans = await prisma.qrScan.findMany({
      where: whereClause,
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            role: true,
          }
        },
        submission: {
          select: {
            id: true,
            simlok_number: true,
            vendor_name: true,
            officer_name: true,
            job_description: true,
            work_location: true,
            approval_status: true,
          }
        }
      },
      orderBy: {
        scanned_at: 'desc'
      },
      take: limit,
      skip: offset,
    });

    // Get total count
    const totalCount = await prisma.qrScan.count({
      where: whereClause,
    });

    return NextResponse.json({
      scans,
      pagination: {
        total: totalCount,
        limit,
        offset,
        hasMore: offset + limit < totalCount,
      }
    });

  } catch (error) {
    console.error('Scan history fetch error:', error);
    return NextResponse.json({ 
      error: 'Internal server error while fetching scan history' 
    }, { status: 500 });
  }
}


=== FILE: src/app/api/reviewer/simloks/[id]/review/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { z } from 'zod';
import { notifyApproverReviewedSubmission } from '@/server/events';

// Schema for validating review data
const reviewSchema = z.object({
  review_status: z.enum(['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS']),
  review_note: z.string().optional(),
  final_note: z.string().optional(),
});

// PATCH /api/reviewer/simloks/[id]/review - Set review status and note
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const resolvedParams = await params;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    // Check if submission exists and is still reviewable
    const existingSubmission = await prisma.submission.findUnique({
      where: { id: resolvedParams.id },
      select: {
        id: true,
        final_status: true,
        user_id: true,
        user: {
          select: {
            vendor_name: true,
            officer_name: true,
          }
        }
      }
    });

    if (!existingSubmission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Reviewer cannot review after Approver has finalized
    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {
      return NextResponse.json({ 
        error: 'Cannot review submission after it has been finalized' 
      }, { status: 400 });
    }

    const body = await request.json();
    const validatedData = reviewSchema.parse(body);

    const updatedSubmission = await prisma.submission.update({
      where: { id: resolvedParams.id },
      data: {
        review_status: validatedData.review_status,
        review_note: validatedData.review_note || null,
        final_note: validatedData.final_note || null,
        reviewed_by_id: session.user.id,
        reviewed_at: new Date(),
      },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        }
      }
    });

    // Notify approvers about the review result (both meets and doesn't meet requirements)
    await notifyApproverReviewedSubmission(resolvedParams.id);

    return NextResponse.json({ 
      submission: updatedSubmission,
      message: 'Review submitted successfully'
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json({ 
        error: 'Validation error', 
        details: error.issues 
      }, { status: 400 });
    }
    
    console.error('Error submitting review:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/simloks/[id]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { z } from 'zod';

// Schema for validating submission updates
const updateSubmissionSchema = z.object({
  vendor_name: z.string().optional(),
  vendor_phone: z.string().optional(),
  based_on: z.string().optional(),
  officer_name: z.string().optional(),
  job_description: z.string().optional(),
  work_location: z.string().optional(),
  implementation: z.string().optional(),
  working_hours: z.string().optional(),
  other_notes: z.string().optional(),
  work_facilities: z.string().optional(),
  worker_count: z.number().optional(),
  simja_number: z.string().optional(),
  simja_date: z.string().optional(),
  sika_number: z.string().optional(),
  sika_date: z.string().optional(),
  implementation_start_date: z.string().optional(),
  implementation_end_date: z.string().optional(),
  worker_names: z.string().optional(),
  content: z.string().optional(),
  notes: z.string().optional(),

  signer_position: z.string().optional(),
  signer_name: z.string().optional(),
});

// GET /api/reviewer/simloks/[id] - Get single submission for review
export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const resolvedParams = await params;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const submission = await prisma.submission.findUnique({
      where: { id: resolvedParams.id },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
            phone_number: true,
            address: true,
            role: true,
            verified_at: true,
            verified_by: true,
            created_at: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        approved_by_final_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          select: {
            id: true,
            worker_name: true,
            worker_photo: true,
            created_at: true,
          }
        }
      }
    });

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    return NextResponse.json({ submission });
  } catch (error) {
    console.error('Error fetching submission for review:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// PATCH /api/reviewer/simloks/[id] - Update submission content (only if not finalized)
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const resolvedParams = await params;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    // Check if submission exists and is still editable
    const existingSubmission = await prisma.submission.findUnique({
      where: { id: resolvedParams.id },
      select: {
        id: true,
        final_status: true,
      }
    });

    if (!existingSubmission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Reviewer cannot edit after Approver has finalized
    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {
      return NextResponse.json({ 
        error: 'Cannot edit submission after it has been finalized' 
      }, { status: 400 });
    }

    const body = await request.json();
    const validatedData = updateSubmissionSchema.parse(body);

    // Convert date strings to Date objects if provided and not empty
    const updateData: any = { ...validatedData };
    
    // Remove empty date fields or convert to Date objects
    if (validatedData.simja_date && validatedData.simja_date.trim() !== '') {
      updateData.simja_date = new Date(validatedData.simja_date);
    } else {
      updateData.simja_date = null;
    }
    
    if (validatedData.sika_date && validatedData.sika_date.trim() !== '') {
      updateData.sika_date = new Date(validatedData.sika_date);
    } else {
      updateData.sika_date = null;
    }
    
    if (validatedData.implementation_start_date && validatedData.implementation_start_date.trim() !== '') {
      updateData.implementation_start_date = new Date(validatedData.implementation_start_date);
    } else {
      updateData.implementation_start_date = null;
    }
    
    if (validatedData.implementation_end_date && validatedData.implementation_end_date.trim() !== '') {
      updateData.implementation_end_date = new Date(validatedData.implementation_end_date);
    } else {
      updateData.implementation_end_date = null;
    }

    const updatedSubmission = await prisma.submission.update({
      where: { id: resolvedParams.id },
      data: updateData,
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
            phone_number: true,
            address: true,
            role: true,
            verified_at: true,
            verified_by: true,
            created_at: true,
          }
        },
        reviewed_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          select: {
            id: true,
            worker_name: true,
            worker_photo: true,
            created_at: true,
          }
        }
      }
    });

    console.log('Submission updated successfully by reviewer:', session.user.id);
    
    return NextResponse.json({
      message: 'Submission updated successfully',
      submission: updatedSubmission
    });

  } catch (error) {
    console.error('Error updating submission:', error);
    
    if (error instanceof z.ZodError) {
      return NextResponse.json({
        error: 'Invalid request data',
        details: error.issues
      }, { status: 400 });
    }

    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/simloks/[id]/workers/[workerId]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import fs from 'fs';
import path from 'path';

// DELETE /api/reviewer/simloks/[id]/workers/[workerId] - Delete worker photo
export async function DELETE(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string; workerId: string }> }
) {
  try {
    const resolvedParams = await params;
    const { id, workerId } = resolvedParams;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    // Check if submission exists and is still editable
    const existingSubmission = await prisma.submission.findUnique({
      where: { id },
      select: {
        id: true,
        final_status: true,
      }
    });

    if (!existingSubmission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Reviewer cannot edit after Approver has finalized
    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {
      return NextResponse.json({ 
        error: 'Cannot delete worker after submission has been finalized' 
      }, { status: 400 });
    }

    // Find the worker photo to delete
    const workerPhoto = await prisma.workerList.findUnique({
      where: { id: workerId },
      select: {
        id: true,
        worker_photo: true,
        submission_id: true,
      }
    });

    if (!workerPhoto) {
      return NextResponse.json({ error: 'Worker photo not found' }, { status: 404 });
    }

    // Verify the worker belongs to this submission
    if (workerPhoto.submission_id !== id) {
      return NextResponse.json({ error: 'Worker does not belong to this submission' }, { status: 400 });
    }

    // Delete the physical file if it exists
    try {
      const photoPath = workerPhoto.worker_photo;
      // Extract the relative path from the URL (assuming it starts with /uploads/)
      if (photoPath && photoPath.startsWith('/uploads/')) {
        const relativePath = photoPath.substring(1); // Remove leading slash
        const fullPath = path.join(process.cwd(), 'public', relativePath);
        
        if (fs.existsSync(fullPath)) {
          fs.unlinkSync(fullPath);
          console.log('Physical file deleted:', fullPath);
        }
      }
    } catch (fileError) {
      console.error('Error deleting physical file:', fileError);
      // Continue with database deletion even if file deletion fails
    }

    // Delete the worker photo from database
    await prisma.workerList.delete({
      where: { id: workerId }
    });

    console.log('Worker photo deleted successfully by reviewer:', session.user.id);
    
    return NextResponse.json({
      message: 'Worker photo deleted successfully'
    });

  } catch (error) {
    console.error('Error deleting worker photo:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/simloks/[id]/workers/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

interface Params {
  id: string;
}

export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<Params> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const { id } = await params;

    // Check if submission exists
    const submission = await prisma.submission.findUnique({
      where: { id: id }
    });

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Get workers for this submission
    const workers = await prisma.workerList.findMany({
      where: {
        submission_id: id
      },
      orderBy: {
        created_at: 'asc'
      }
    });

    return NextResponse.json({ workers });
  } catch (error) {
    console.error('Error fetching workers for reviewer:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/reviewer/simloks/export/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import * as XLSX from 'xlsx';

// GET /api/reviewer/simloks/export - Export submissions to Excel
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const reviewStatus = searchParams.get('reviewStatus');
    const finalStatus = searchParams.get('finalStatus');
    const search = searchParams.get('search');
    const startDate = searchParams.get('startDate');
    const endDate = searchParams.get('endDate');

    const whereClause: any = {};

    // Apply same filters as the main submissions list
    if (reviewStatus && ['PENDING_REVIEW', 'MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {
      whereClause.review_status = reviewStatus;
    }

    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {
      whereClause.final_status = finalStatus;
    }

    if (search) {
      whereClause.OR = [
        { vendor_name: { contains: search } },
        { job_description: { contains: search } },
        { officer_name: { contains: search } }
      ];
    }

    // Date range filter
    if (startDate || endDate) {
      whereClause.created_at = {};
      if (startDate) {
        whereClause.created_at.gte = new Date(startDate);
      }
      if (endDate) {
        const endDateTime = new Date(endDate);
        endDateTime.setHours(23, 59, 59, 999);
        whereClause.created_at.lte = endDateTime;
      }
    }

    // Fetch all submissions matching the filters
    const submissions = await prisma.submission.findMany({
      where: whereClause,
      select: {
        id: true,
        vendor_name: true,
        officer_name: true,
        job_description: true,
        work_location: true,
        implementation: true,
        working_hours: true,
        other_notes: true,
        work_facilities: true,
        based_on: true,
        approval_status: true,
        review_status: true,
        final_status: true,
        content: true,
        notes: true,
        review_note: true,
        final_note: true,
        simja_number: true,
        simja_date: true,
        sika_number: true,
        sika_date: true,
        simlok_number: true,
        simlok_date: true,
        signer_name: true,
        signer_position: true,
        created_at: true,
        reviewed_at: true,
        approved_at: true,
        user: {
          select: {
            email: true,
            phone_number: true,
            verification_status: true,
          }
        },
        reviewed_by_user: {
          select: {
            officer_name: true,
            email: true,
          }
        },
        approved_by_final_user: {
          select: {
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          select: {
            worker_name: true,
          }
        },
        _count: {
          select: {
            qrScans: true
          }
        },
        qrScans: {
          select: {
            scanned_at: true,
            scan_location: true,
          },
          orderBy: {
            scanned_at: 'desc'
          },
          take: 1
        }
      },
      orderBy: { created_at: 'desc' },
    });

    // Format data for Excel export
    const excelData = submissions.map((submission, index) => {
      // Get worker names as comma-separated string
      const workerNames = submission.worker_list.map(w => w.worker_name).join(', ');
      
      // Format dates
      const formatDate = (date: Date | string | null) => {
        if (!date) return '-';
        const d = new Date(date);
        return d.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      };

      // Format status
      const formatStatus = (status: string) => {
        switch (status) {
          case 'PENDING_REVIEW': return 'Menunggu Review';
          case 'MEETS_REQUIREMENTS': return 'Memenuhi Syarat';
          case 'NOT_MEETS_REQUIREMENTS': return 'Tidak Memenuhi Syarat';
          case 'PENDING_APPROVAL': return 'Menunggu Persetujuan';
          case 'APPROVED': return 'Disetujui';
          case 'REJECTED': return 'Ditolak';
          default: return status;
        }
      };

      return {
        'No': index + 1,
        'Tanggal Pengajuan': formatDate(submission.created_at),
        'Nama Vendor': submission.vendor_name,
        'Penanggung Jawab': submission.officer_name,
        'Email Vendor': submission.user?.email || '-',
        'Telepon': submission.user?.phone_number || '-',
        'Status Verifikasi Vendor': submission.user?.verification_status || '-',
        'Deskripsi Pekerjaan': submission.job_description,
        'Lokasi Kerja': submission.work_location,
        'Pelaksanaan': submission.implementation || '-',
        'Jam Kerja': submission.working_hours,
        'Fasilitas Kerja': submission.work_facilities,
        'Berdasarkan': submission.based_on,
        'Catatan Lain': submission.other_notes || '-',
        'Daftar Pekerja': workerNames,
        'Jumlah Pekerja': submission.worker_list.length,
        'Status Review': formatStatus(submission.review_status),
        'Status Final': formatStatus(submission.final_status),
        'Catatan Review': submission.review_note || '-',
        'Catatan Final': submission.final_note || '-',
        'Reviewer': submission.reviewed_by_user?.officer_name || '-',
        'Email Reviewer': submission.reviewed_by_user?.email || '-',
        'Approver': submission.approved_by_final_user?.officer_name || '-',
        'Email Approver': submission.approved_by_final_user?.email || '-',
        'Tanggal Review': formatDate(submission.reviewed_at),
        'Tanggal Approval': formatDate(submission.approved_at),
        'Nomor SIMJA': submission.simja_number || '-',
        'Tanggal SIMJA': submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '-',
        'Nomor SIKA': submission.sika_number || '-',
        'Tanggal SIKA': submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '-',
        'Nomor SIMLOK': submission.simlok_number || '-',
        'Tanggal SIMLOK': submission.simlok_date ? new Date(submission.simlok_date).toLocaleDateString('id-ID') : '-',
        'Nama Penandatangan': submission.signer_name || '-',
        'Jabatan Penandatangan': submission.signer_position || '-',
        'Jumlah Scan QR': submission._count.qrScans,
        'Terakhir Discan': submission.qrScans[0] ? formatDate(submission.qrScans[0].scanned_at) : '-',
        'Lokasi Scan Terakhir': submission.qrScans[0]?.scan_location || '-',
      };
    });

    // Create workbook and worksheet
    const workbook = XLSX.utils.book_new();
    const worksheet = XLSX.utils.json_to_sheet(excelData);

    // Set column widths for better readability
    const columnWidths = [
      { wch: 5 },   // No
      { wch: 18 },  // Tanggal Pengajuan
      { wch: 25 },  // Nama Vendor
      { wch: 20 },  // Penanggung Jawab
      { wch: 25 },  // Email Vendor
      { wch: 15 },  // Telepon
      { wch: 15 },  // Status Verifikasi
      { wch: 40 },  // Deskripsi Pekerjaan
      { wch: 30 },  // Lokasi Kerja
      { wch: 20 },  // Pelaksanaan
      { wch: 15 },  // Jam Kerja
      { wch: 30 },  // Fasilitas Kerja
      { wch: 15 },  // Berdasarkan
      { wch: 30 },  // Catatan Lain
      { wch: 50 },  // Daftar Pekerja
      { wch: 12 },  // Jumlah Pekerja
      { wch: 18 },  // Status Review
      { wch: 18 },  // Status Final
      { wch: 30 },  // Catatan Review
      { wch: 30 },  // Catatan Final
      { wch: 20 },  // Reviewer
      { wch: 25 },  // Email Reviewer
      { wch: 20 },  // Approver
      { wch: 25 },  // Email Approver
      { wch: 18 },  // Tanggal Review
      { wch: 18 },  // Tanggal Approval
      { wch: 15 },  // Nomor SIMJA
      { wch: 15 },  // Tanggal SIMJA
      { wch: 15 },  // Nomor SIKA
      { wch: 15 },  // Tanggal SIKA
      { wch: 15 },  // Nomor SIMLOK
      { wch: 15 },  // Tanggal SIMLOK
      { wch: 25 },  // Nama Penandatangan
      { wch: 25 },  // Jabatan Penandatangan
      { wch: 12 },  // Jumlah Scan QR
      { wch: 18 },  // Terakhir Discan
      { wch: 20 },  // Lokasi Scan Terakhir
    ];
    worksheet['!cols'] = columnWidths;

    // Add worksheet to workbook
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Pengajuan SIMLOK');

    // Generate Excel buffer
    const excelBuffer = XLSX.write(workbook, { 
      type: 'buffer', 
      bookType: 'xlsx',
      compression: true 
    });

    // Generate filename with timestamp
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
    let filename = `Data_Pengajuan_SIMLOK_${timestamp}`;
    
    // Add filter info to filename
    const filters = [];
    if (reviewStatus) filters.push(reviewStatus);
    if (finalStatus) filters.push(finalStatus);
    if (search) filters.push(`search-${search.substring(0, 10)}`);
    if (startDate || endDate) {
      if (startDate && endDate) {
        const start = new Date(startDate).toISOString().split('T')[0];
        const end = new Date(endDate).toISOString().split('T')[0];
        filters.push(`${start}_to_${end}`);
      } else if (startDate) {
        const start = new Date(startDate).toISOString().split('T')[0];
        filters.push(`dari_${start}`);
      } else if (endDate) {
        const end = new Date(endDate).toISOString().split('T')[0];
        filters.push(`sampai_${end}`);
      }
    }
    
    if (filters.length > 0) {
      filename += `_${filters.join('_')}`;
    }
    
    filename += '.xlsx';

    // Return Excel file
    return new NextResponse(excelBuffer, {
      status: 200,
      headers: {
        'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'Content-Disposition': `attachment; filename="${filename}"`,
        'Content-Length': excelBuffer.length.toString(),
      },
    });

  } catch (error) {
    console.error('Error exporting submissions to Excel:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/simloks/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

// GET /api/reviewer/simloks - Get submissions for reviewer dashboard
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const reviewStatus = searchParams.get('reviewStatus');
    const finalStatus = searchParams.get('finalStatus');
    const vendorId = searchParams.get('vendorId');
    const search = searchParams.get('search');
    const sortBy = searchParams.get('sortBy') || 'created_at';
    const sortOrder = searchParams.get('sortOrder') || 'desc';
    const skip = (page - 1) * limit;

    const whereClause: any = {};

    // Filter by review status if provided
    if (reviewStatus && ['PENDING_REVIEW', 'MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {
      whereClause.review_status = reviewStatus;
    }

    // Filter by final status if provided
    if (finalStatus && finalStatus.trim()) {
      if (['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {
        whereClause.final_status = finalStatus;
      }
    }
    // Note: If no finalStatus is provided, show all submissions (don't filter by final_status)

    // Filter by vendor if provided
    if (vendorId) {
      whereClause.user_id = vendorId;
    }

    // Filter by search term (vendor name, job description, or officer name)
    if (search) {
      whereClause.OR = [
        {
          vendor_name: {
            contains: search
          }
        },
        {
          job_description: {
            contains: search
          }
        },
        {
          officer_name: {
            contains: search
          }
        }
      ];
    }

    const [submissions, total, statistics, userStats] = await Promise.all([
      prisma.submission.findMany({
        where: whereClause,
        select: {
          id: true,
          approval_status: true,
          review_status: true,
          final_status: true,
          vendor_name: true,
          based_on: true,
          officer_name: true,
          job_description: true,
          work_location: true,
          implementation: true,
          working_hours: true,
          other_notes: true,
          work_facilities: true,
          simlok_number: true,
          simlok_date: true,
          created_at: true,
          user: {
            select: {
              vendor_name: true,
              officer_name: true,
            }
          },
          reviewed_by_user: {
            select: {
              officer_name: true,
            }
          },
          qrScans: {
            select: {
              scanned_at: true,
            },
            orderBy: {
              scanned_at: 'desc'
            },
            take: 1
          },
          _count: {
            select: {
              qrScans: true
            }
          }
        },
        orderBy: { [sortBy]: sortOrder },
        skip,
        take: limit,
      }),
      prisma.submission.count({ where: whereClause }),
      // Get statistics for reviewer dashboard
      prisma.submission.groupBy({
        by: ['review_status'],
        where: {
          final_status: 'PENDING_APPROVAL'
        },
        _count: {
          review_status: true
        }
      }),
      // Get user verification statistics
      Promise.all([
        prisma.user.count({
          where: { 
            role: 'VENDOR',
            verified_at: null 
          }
        }),
        prisma.user.count({
          where: { 
            role: 'VENDOR',
            verified_at: { not: null }
          }
        })
      ])
    ]);

    // Format submissions with scan data and remove IDs
    const formattedSubmissions = submissions.map(submission => ({
      approval_status: submission.approval_status,
      review_status: submission.review_status,
      final_status: submission.final_status,
      vendor_name: submission.vendor_name,
      based_on: submission.based_on,
      officer_name: submission.officer_name,
      job_description: submission.job_description,
      work_location: submission.work_location,
      implementation: submission.implementation,
      working_hours: submission.working_hours,
      other_notes: submission.other_notes,
      work_facilities: submission.work_facilities,
      simlok_number: submission.simlok_number,
      simlok_date: submission.simlok_date,
      created_at: submission.created_at,
      scan_count: submission._count.qrScans,
      last_scanned_at: submission.qrScans[0]?.scanned_at || null,
      user: {
        vendor_name: submission.vendor_name,
        officer_name: submission.officer_name,
      },
      reviewed_by_user: submission.reviewed_by_user ? {
        officer_name: submission.reviewed_by_user.officer_name,
      } : null,
      // Keep ID for internal operations but don't expose in list view
      id: submission.id
    }));

    // Format statistics for frontend
    const [pendingUserVerifications, totalVerifiedUsers] = userStats;
    const stats = {
      total: total,
      pendingReview: statistics.find(s => s.review_status === 'PENDING_REVIEW')?._count.review_status || 0,
      meetsRequirements: statistics.find(s => s.review_status === 'MEETS_REQUIREMENTS')?._count.review_status || 0,
      notMeetsRequirements: statistics.find(s => s.review_status === 'NOT_MEETS_REQUIREMENTS')?._count.review_status || 0,
      pendingUserVerifications,
      totalVerifiedUsers
    };

    return NextResponse.json({
      submissions: formattedSubmissions,
      stats,
      pagination: {
        page,
        limit,
        total,
        pages: Math.ceil(total / limit),
      }
    });
  } catch (error) {
    console.error('Error fetching reviewer submissions:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/users/[id]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { z } from 'zod';

// Schema for validating user verification data
const userVerificationSchema = z.object({
  status: z.enum(['VERIFY', 'REJECT']),
  note: z.string().optional(),
});

// PATCH /api/reviewer/users/[id] - Verify or reject user
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    // Check if user exists and is a vendor
    const existingUser = await prisma.user.findUnique({
      where: { id },
      select: {
        id: true,
        email: true,
        officer_name: true,
        vendor_name: true,
        role: true,
        verified_at: true,
        verification_status: true,
        created_at: true
      }
    });

    if (!existingUser) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 });
    }

    if (existingUser.role !== 'VENDOR') {
      return NextResponse.json({ error: 'Only vendor users can be verified' }, { status: 400 });
    }

    if (existingUser.verified_at) {
      return NextResponse.json({ error: 'User has already been verified' }, { status: 400 });
    }

    if (existingUser.verification_status === 'REJECTED') {
      return NextResponse.json({ error: 'User has already been rejected' }, { status: 400 });
    }

    const body = await request.json();
    const validatedData = userVerificationSchema.parse(body);

    let updatedUser;
    let notificationTitle: string;
    let notificationMessage: string;
    let notificationType: string;

    if (validatedData.status === 'VERIFY') {
      console.log(`Verifying user ${id} by ${session.user.id}`);
      
      // Verify the user
      updatedUser = await prisma.user.update({
        where: { id },
        data: {
          verified_at: new Date(),
          verified_by: session.user.id,
          verification_status: 'VERIFIED'
        },
        include: {
          submissions: {
            select: { id: true }
          }
        }
      });
      
      console.log(`User ${id} verification status updated to:`, updatedUser.verification_status);

      notificationTitle = 'Akun Anda Telah Diverifikasi';
      notificationMessage = 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.';
      notificationType = 'user_verified';
    } else {
      // Reject the user - update status instead of deleting
      updatedUser = await prisma.user.update({
        where: { id },
        data: {
          verification_status: 'REJECTED',
          rejected_at: new Date(),
          rejected_by: session.user.officer_name,
          rejection_reason: validatedData.note || 'No reason provided'
        },
        include: {
          submissions: {
            select: { id: true }
          }
        }
      });

      notificationTitle = 'Akun Anda Ditolak';
      notificationMessage = `Maaf, akun vendor Anda tidak dapat diverifikasi. ${validatedData.note || 'Silakan hubungi super admin untuk informasi lebih lanjut.'}`;
      notificationType = 'user_rejected';
    }

    // Create notification for the user
    await prisma.notification.create({
      data: {
        scope: 'vendor',
        vendor_id: id,
        type: notificationType,
        title: notificationTitle,
        message: notificationMessage,
        data: JSON.stringify({
          userId: id,
          verificationStatus: validatedData.status,
          verifiedBy: session.user.officer_name,
          verifiedAt: validatedData.status === 'VERIFY' ? new Date().toISOString() : null,
          rejectedAt: validatedData.status === 'REJECT' ? new Date().toISOString() : null,
          note: validatedData.note
        })
      }
    });

    // Notify the user via real-time events
    const { notifyUserVerificationResult } = await import('@/server/events');
    await notifyUserVerificationResult(id, validatedData.status, validatedData.note);

    const responseData = { 
      user: {
        id: updatedUser.id,
        email: updatedUser.email,
        officer_name: updatedUser.officer_name,
        vendor_name: updatedUser.vendor_name,
        verified_at: updatedUser.verified_at,
        verification_status: updatedUser.verification_status,
        rejected_at: updatedUser.rejected_at,
        rejected_by: updatedUser.rejected_by,
        rejection_reason: updatedUser.rejection_reason,
        verified_by: validatedData.status === 'VERIFY' ? session.user.id : null
      },
      message: `User ${validatedData.status === 'VERIFY' ? 'verified' : 'rejected'} successfully`
    };
    
    console.log('API Response:', JSON.stringify(responseData, null, 2));
    
    return NextResponse.json(responseData);
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json({ 
        error: 'Validation error', 
        details: error.issues 
      }, { status: 400 });
    }
    
    console.error('Error verifying user:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// GET /api/reviewer/users/[id] - Get user details for verification
export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params;
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const user = await prisma.user.findUnique({
      where: { id },
      select: {
        id: true,
        email: true,
        officer_name: true,
        vendor_name: true,
        address: true,
        phone_number: true,
        profile_photo: true,
        role: true,
        created_at: true,
        verified_at: true,
        verified_by: true,
        submissions: {
          select: {
            id: true,
            job_description: true,
            approval_status: true,
            created_at: true
          },
          orderBy: { created_at: 'desc' },
          take: 5 // Show recent submissions
        }
      }
    });

    if (!user) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 });
    }

    return NextResponse.json({ user });
  } catch (error) {
    console.error('Error fetching user details:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/users/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

// GET /api/reviewer/users - Get pending user verifications
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const search = searchParams.get('search');
    const status = searchParams.get('status'); // 'pending' | 'verified'
    const sortBy = searchParams.get('sortBy') || 'created_at';
    const sortOrder = searchParams.get('sortOrder') || 'desc';
    const skip = (page - 1) * limit;

    const whereClause: any = {
      role: 'VENDOR' // Only show vendor users for verification
    };

    // Filter by verification status
    if (status === 'pending') {
      whereClause.verification_status = 'PENDING';
    } else if (status === 'verified') {
      whereClause.verification_status = 'VERIFIED';
    } else if (status === 'rejected') {
      whereClause.verification_status = 'REJECTED';
    }

    // Search by name, vendor name, or email
    if (search) {
      whereClause.OR = [
        { officer_name: { contains: search } },
        { vendor_name: { contains: search } },
        { email: { contains: search } }
      ];
    }

    // Get users with pagination
    const [users, totalCount] = await Promise.all([
      prisma.user.findMany({
        where: whereClause,
        select: {
          id: true,
          email: true,
          officer_name: true,
          vendor_name: true,
          address: true,
          phone_number: true,
          profile_photo: true,
          created_at: true,
          verified_at: true,
          verified_by: true,
          verification_status: true,
          rejected_at: true,
          rejected_by: true,
          rejection_reason: true,
          role: true
        },
        orderBy: { [sortBy]: sortOrder },
        skip,
        take: limit,
      }),
      prisma.user.count({ where: whereClause })
    ]);

    // Get verification stats
    const stats = {
      totalPending: await prisma.user.count({
        where: { 
          role: 'VENDOR',
          verification_status: 'PENDING'
        }
      }),
      totalVerified: await prisma.user.count({
        where: { 
          role: 'VENDOR',
          verification_status: 'VERIFIED'
        }
      }),
      totalRejected: await prisma.user.count({
        where: { 
          role: 'VENDOR',
          verification_status: 'REJECTED'
        }
      }),
      totalUsers: await prisma.user.count({
        where: { role: 'VENDOR' }
      }),
      todayRegistrations: await prisma.user.count({
        where: {
          role: 'VENDOR',
          created_at: {
            gte: new Date(new Date().setHours(0, 0, 0, 0))
          }
        }
      })
    };

    return NextResponse.json({
      users,
      pagination: {
        page,
        limit,
        total: totalCount,
        totalPages: Math.ceil(totalCount / limit),
      },
      stats
    });
  } catch (error) {
    console.error('Error fetching users for verification:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/vendors/[id]/approve/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { z } from 'zod';

// Schema for validating vendor approval
const approveVendorSchema = z.object({
  approve: z.boolean(),
});

// PATCH /api/reviewer/vendors/[id]/approve - Approve or reject vendor registration
export async function PATCH(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can approve vendors
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const resolvedParams = await params;
    const body = await request.json();
    const { approve } = approveVendorSchema.parse(body);

    // Find the vendor user
    const vendor = await prisma.user.findUnique({
      where: { 
        id: resolvedParams.id,
        role: 'VENDOR'
      },
      select: {
        id: true,
        email: true,
        officer_name: true,
        vendor_name: true,
        verified_at: true,
      }
    });

    if (!vendor) {
      return NextResponse.json({ error: 'Vendor not found' }, { status: 404 });
    }

    if (vendor.verified_at) {
      return NextResponse.json({ error: 'Vendor is already verified' }, { status: 400 });
    }

    if (approve) {
      // Approve the vendor
      const updatedVendor = await prisma.user.update({
        where: { id: resolvedParams.id },
        data: {
          verified_at: new Date(),
          verified_by: session.user.id,
        },
        select: {
          id: true,
          email: true,
          officer_name: true,
          vendor_name: true,
          verified_at: true,
        }
      });

      // Create notification for the vendor
      await prisma.notification.create({
        data: {
          scope: 'vendor',
          vendor_id: vendor.id,
          type: 'vendor_approved',
          title: 'Akun Vendor Disetujui',
          message: 'Selamat! Akun vendor Anda telah disetujui dan dapat mulai mengajukan Simlok.',
          data: JSON.stringify({
            vendorId: vendor.id,
            approvedBy: session.user.officer_name,
          }),
        }
      });

      return NextResponse.json({ 
        vendor: updatedVendor,
        message: 'Vendor approved successfully'
      });
    } else {
      // For rejection, we might want to delete the vendor or mark as rejected
      // For now, let's just create a notification
      await prisma.notification.create({
        data: {
          scope: 'vendor',
          vendor_id: vendor.id,
          type: 'vendor_rejected',
          title: 'Akun Vendor Ditolak',
          message: 'Maaf, akun vendor Anda ditolak. Silakan hubungi administrator untuk informasi lebih lanjut.',
          data: JSON.stringify({
            vendorId: vendor.id,
            rejectedBy: session.user.officer_name,
          }),
        }
      });

      return NextResponse.json({ 
        message: 'Vendor registration rejected'
      });
    }
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json({ 
        error: 'Validation error', 
        details: error.issues 
      }, { status: 400 });
    }
    
    console.error('Error processing vendor approval:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/reviewer/worker-photos/[photoId]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import fs from 'fs/promises';
import path from 'path';

// DELETE /api/reviewer/worker-photos/[photoId] - Delete worker photo
export async function DELETE(
  _request: NextRequest,
  { params }: { params: Promise<{ photoId: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint
    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });
    }

    const resolvedParams = await params;
    
    // Find the worker and check if the submission is still editable
    const worker = await prisma.workerList.findUnique({
      where: { id: resolvedParams.photoId },
      include: {
        submission: {
          select: {
            id: true,
            final_status: true,
          }
        }
      }
    });

    if (!worker) {
      return NextResponse.json({ error: 'Worker not found' }, { status: 404 });
    }

    // Cannot delete photos after submission is finalized
    if (worker.submission.final_status !== 'PENDING_APPROVAL') {
      return NextResponse.json({ 
        error: 'Cannot delete worker photo after submission has been finalized' 
      }, { status: 400 });
    }

    // If worker has a photo, delete the file
    if (worker.worker_photo) {
      try {
        const photoPath = path.join(process.cwd(), 'public', worker.worker_photo);
        await fs.unlink(photoPath);
      } catch (fileError) {
        console.warn('Failed to delete photo file:', fileError);
        // Continue with database deletion even if file deletion fails
      }
    }

    // Update worker to remove photo reference
    const updatedWorker = await prisma.workerList.update({
      where: { id: resolvedParams.photoId },
      data: {
        worker_photo: null,
      }
    });

    return NextResponse.json({ 
      worker: updatedWorker,
      message: 'Worker photo deleted successfully'
    });
  } catch (error) {
    console.error('Error deleting worker photo:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/scan-history/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history
    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '20');
    const dateFrom = searchParams.get('dateFrom');
    const dateTo = searchParams.get('dateTo');
    const verifier = searchParams.get('verifier');
    const submissionId = searchParams.get('submissionId');
    const search = searchParams.get('search');

    const skip = (page - 1) * limit;

    // Build filter conditions
    const where: any = {};
    
    if (dateFrom || dateTo) {
      where.scanned_at = {};
      if (dateFrom) {
        where.scanned_at.gte = new Date(dateFrom);
      }
      if (dateTo) {
        // Add 1 day to include the entire date
        const endDate = new Date(dateTo);
        endDate.setDate(endDate.getDate() + 1);
        where.scanned_at.lt = endDate;
      }
    }

    if (verifier) {
      where.user = {
        officer_name: {
          contains: verifier
        }
      };
    }

    if (submissionId) {
      where.submission = {
        simlok_number: {
          contains: submissionId
        }
      };
    }

    // Add search functionality
    if (search) {
      where.OR = [
        {
          submission: {
            simlok_number: {
              contains: search
            }
          }
        },
        {
          submission: {
            vendor_name: {
              contains: search
            }
          }
        },
        {
          user: {
            officer_name: {
              contains: search
            }
          }
        },
        {
          scan_location: {
            contains: search
          }
        }
      ];
    }

    // Get total count for pagination
    const total = await prisma.qrScan.count({ where });

    // Get scan history with related data
    const scans = await prisma.qrScan.findMany({
      where,
      include: {
        submission: {
          select: {
            id: true,
            simlok_number: true,
            vendor_name: true,
            job_description: true,
            review_status: true,
            final_status: true,
          }
        },
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            role: true,
          }
        }
      },
      orderBy: {
        scanned_at: 'desc'
      },
      skip,
      take: limit,
    });

    return NextResponse.json({
      scans,
      total,
      page,
      limit,
      totalPages: Math.ceil(total / limit)
    });

  } catch (error) {
    console.error('Error fetching scan history:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/socket/route.ts ===
import { io } from '@/server/socket';
import { NextRequest } from 'next/server';

export const runtime = 'nodejs';

export async function GET(_request: NextRequest) {
  if (!io.httpServer) {
    // Attach to global server if not attached
    const server = (globalThis as any).__socket_server;
    if (server) {
      io.attach(server);
    }
  }
  
  return new Response('Socket.IO server is running', { 
    status: 200,
    headers: {
      'Content-Type': 'text/plain'
    }
  });
}


=== FILE: src/app/api/submissions/[id]/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { generateSIMLOKPDF, type SubmissionPDFData } from '@/utils/pdf/simlokTemplate';
import { notifyVendorStatusChange } from '@/server/events';
import { cleanupSubmissionNotifications } from '@/lib/notificationCleanup';
import { generateQrString } from '@/lib/qr-security';

// Function to generate auto SIMLOK number
async function generateSimlokNumber(): Promise<string> {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format

  // Get the last SIMLOK number for current month/year
  const lastSubmission = await prisma.submission.findFirst({
    where: {
      simlok_number: {
        contains: `/${month}/${year}`
      }
    },
    orderBy: {
      simlok_number: 'desc'
    }
  });

  let nextNumber = 1;
  
  if (lastSubmission?.simlok_number) {
    // Extract number from format: number/MM/YYYY
    const match = lastSubmission.simlok_number.match(/^(\d+)\/\d{2}\/\d{4}$/);
    if (match && match[1]) {
      nextNumber = parseInt(match[1]) + 1;
    }
  }

  return `${nextNumber}/${month}/${year}`;
}

interface RouteParams {
  params: Promise<{
    id: string;
  }>;
}

// GET /api/submissions/[id] - Get single submission with optional PDF generation
export async function GET(request: NextRequest, { params }: RouteParams) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { id } = await params;
    const { searchParams } = new URL(request.url);
    const isPdfRequest = searchParams.get('format') === 'pdf';
    const shouldClearCache = searchParams.get('clearCache') === 'true';

    // Clear image cache if requested (for PDF generation)
    if (shouldClearCache && isPdfRequest) {
      try {
        const { clearImageCache } = await import('@/utils/pdf/imageLoader');
        clearImageCache();
        console.log('API: Cleared image cache for fresh PDF generation');
      } catch (error) {
        console.warn('API: Failed to clear image cache:', error);
      }
    }

    // Fetch submission with user and approved by user details
    const submission = await prisma.submission.findFirst({
      where: { 
        id,
        // Vendors can only see their own submissions
        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})
      },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        approved_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        },
        worker_list: {
          orderBy: {
            created_at: 'asc'
          }
        }
      }
    });

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Check permissions
    if (session.user.role === 'VENDOR' && submission.user_id !== session.user.id) {
      return NextResponse.json({ error: 'Access denied' }, { status: 403 });
    }

    // If PDF is requested, generate and return PDF
    if (isPdfRequest) {
      return generatePDF(submission);
    }

    // Return regular JSON response
    const response = NextResponse.json(submission);
    
    // Add cache control for better performance
    response.headers.set('Cache-Control', 'private, max-age=60, stale-while-revalidate=300');
    
    return response;
  } catch (error) {
    console.error('Error fetching submission:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// Helper function to generate PDF
async function generatePDF(submission: any) {
  try {
    console.log('PDF Generation Debug:', {
      submissionId: submission.id,
      approval_status: submission.approval_status,
      final_status: submission.final_status,
      simlok_number: submission.simlok_number,
      has_simlok_number: !!submission.simlok_number
    });

    // Allow PDF generation for any submission
    // If no simlok_number, use a placeholder or generate temporary one
    const pdfData = { ...submission };
    
    if (!submission.simlok_number) {
      console.log('PDF Generation: Using placeholder simlok_number');
      // Create a temporary/placeholder SIMLOK number for PDF preview
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      pdfData.simlok_number = `[DRAFT]/XX/${month}/${year}`;
      pdfData.simlok_date = now;
    }

    // Generate PDF using the template with potentially modified data
    const pdfBytes = await generateSIMLOKPDF(pdfData as SubmissionPDFData);

    // Generate filename based on simlok_number (including placeholder)
    const filename = pdfData.simlok_number ? 
      `SIMLOK_${pdfData.simlok_number.replace(/[\[\]/\\]/g, '_')}.pdf` :
      `SIMLOK_PREVIEW_${submission.id}.pdf`;

    // Return PDF response with proper cache control
    return new NextResponse(Buffer.from(pdfBytes), {
      status: 200,
      headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `inline; filename="${filename}"`,
        'Cache-Control': 'no-store, no-cache, must-revalidate, proxy-revalidate',
        'Pragma': 'no-cache',
        'Expires': '0',
      },
    });

  } catch (error) {
    console.error('Error generating PDF:', error);
    return NextResponse.json(
      { error: 'Failed to generate PDF' },
      { status: 500 }
    );
  }
}

// PUT /api/submissions/[id] - Update submission (Admin for approval, Vendor for editing PENDING submissions)
export async function PUT(request: NextRequest, { params }: RouteParams) {
  try {
    const session = await getServerSession(authOptions);
    
    console.log('PUT /api/submissions/[id] - Session:', {
      userId: session?.user?.id,
      role: session?.user?.role,
      email: session?.user?.email
    });
    
    if (!session?.user) {
      console.log('PUT /api/submissions/[id] - No session found');
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { id } = await params;
    console.log('PUT /api/submissions/[id] - Submission ID:', id);

    // First, fetch the existing submission
    const existingSubmission = await prisma.submission.findFirst({
      where: { 
        id,
        // Vendors can only edit their own submissions
        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})
      }
    });

    console.log('PUT /api/submissions/[id] - Existing submission:', {
      found: !!existingSubmission,
      status: existingSubmission?.approval_status,
      userId: existingSubmission?.user_id
    });

    if (!existingSubmission) {
      console.log('PUT /api/submissions/[id] - Submission not found or access denied');
      return NextResponse.json({ error: 'Submission not found or access denied' }, { status: 404 });
    }

    // Check permissions based on role
    if (session.user.role === 'VENDOR') {
      // Vendors can only edit PENDING submissions and only their own
      if (existingSubmission.user_id !== session.user.id) {
        console.log('PUT /api/submissions/[id] - Access denied: not owner');
        return NextResponse.json({ error: 'Access denied' }, { status: 403 });
      }
      
      if (existingSubmission.approval_status !== 'PENDING') {
        console.log('PUT /api/submissions/[id] - Cannot edit non-pending submission');
        return NextResponse.json({ 
          error: 'Can only edit pending submissions' 
        }, { status: 400 });
      }
    }

    const body = await request.json();
    console.log('PUT /api/submissions/[id] - Request body keys:', Object.keys(body));

    const updateData: any = {};
    let statusChanged = false;
    let newStatus: 'PENDING' | 'APPROVED' | 'REJECTED' | undefined;

    // Handle different types of updates based on user role
    if (session.user.role === 'ADMIN' || session.user.role === 'VERIFIER') {
      // Admin/Verifier updating approval status
      if (body.status_approval_admin && ['APPROVED', 'REJECTED'].includes(body.status_approval_admin)) {
        console.log('PUT /api/submissions/[id] - Admin/Verifier approval update');
        console.log('PUT /api/submissions/[id] - Session user ID:', session.user.id);
        console.log('PUT /api/submissions/[id] - Session user role:', session.user.role);
        
        const approvalData: any = {
          approval_status: body.status_approval_admin,
          notes: body.keterangan,
          simlok_date: body.tanggal_simlok ? new Date(body.tanggal_simlok) : undefined,
        };

        // Track status change for notification
        if (existingSubmission.approval_status !== body.status_approval_admin) {
          statusChanged = true;
          newStatus = body.status_approval_admin;
        }

        // Only add fields that are provided and valid
        Object.entries(approvalData).forEach(([key, value]) => {
          if (value !== undefined && value !== null && value !== '') {
            updateData[key] = value;
          }
        });

        // If approving, add additional fields
        if (body.status_approval_admin === 'APPROVED') {
          // Generate auto SIMLOK number
          const autoSimlokNumber = await generateSimlokNumber();
          updateData.simlok_number = autoSimlokNumber;
          
          updateData.implementation = body.pelaksanaan;
          updateData.other_notes = body.lain_lain;
          updateData.content = body.content;
          updateData.signer_position = body.jabatan_signer;
          updateData.signer_name = body.nama_signer;
          
          // Add implementation date range if provided
          if (body.implementation_start_date) {
            updateData.implementation_start_date = new Date(body.implementation_start_date);
          }
          if (body.implementation_end_date) {
            updateData.implementation_end_date = new Date(body.implementation_end_date);
          }
          
          // Generate secure QR code with implementation dates
          const qrString = generateQrString({
            id: id,
            implementation_start_date: body.implementation_start_date ? new Date(body.implementation_start_date) : null,
            implementation_end_date: body.implementation_end_date ? new Date(body.implementation_end_date) : null,
          });
          updateData.qrcode = qrString;
          
          // Verify the user exists before setting approved_by
          const adminUser = await prisma.user.findUnique({
            where: { id: session.user.id }
          });
          
          if (adminUser) {
            updateData.approved_by = session.user.id;
          } else {
            console.log('PUT /api/submissions/[id] - Admin user not found:', session.user.id);
            return NextResponse.json({ 
              error: 'Your session is no longer valid. Please log out and log back in to continue.',
              code: 'INVALID_SESSION'
            }, { status: 401 });
          }
        }
      } else {
        console.log('PUT /api/submissions/[id] - Invalid approval status:', body.status_approval_admin);
        return NextResponse.json({ 
          error: 'Invalid approval status. Must be APPROVED or REJECTED' 
        }, { status: 400 });
      }
    } else if (session.user.role === 'VENDOR') {
      // Vendor updating their submission
      console.log('PUT /api/submissions/[id] - Vendor update');
      
      // Only allow vendor to update certain fields and only if submission is PENDING
      const allowedFields = [
        'vendor_name', 'based_on', 'officer_name', 'job_description', 
        'work_location', 'working_hours', 'work_facilities', 'worker_count',
        'simja_number', 'simja_date', 'sika_number', 'sika_date', 'worker_names',
        'sika_document_upload', 'simja_document_upload'
      ];

      allowedFields.forEach(field => {
        if (body[field] !== undefined) {
          updateData[field] = body[field];
        }
      });

      // Handle date fields
      if (body.simja_date) {
        updateData.simja_date = new Date(body.simja_date);
      }
      if (body.sika_date) {
        updateData.sika_date = new Date(body.sika_date);
      }

    }

    // Perform the update
    const updatedSubmission = await prisma.submission.update({
      where: { id },
      data: updateData,
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true,
          }
        },
        approved_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
          }
        }
      }
    });

    // Handle workers if provided (only for vendor updates)
    if (session.user.role === 'VENDOR' && body.workers && Array.isArray(body.workers)) {
      // Delete existing workers for this submission
      await prisma.workerList.deleteMany({
        where: {
          submission_id: id
        }
      });

      // Create new workers
      const validWorkers = body.workers.filter((worker: any) => 
        worker.worker_name && worker.worker_name.trim() !== ''
      );

      if (validWorkers.length > 0) {
        await prisma.workerList.createMany({
          data: validWorkers.map((worker: any) => ({
            worker_name: worker.worker_name.trim(),
            worker_photo: worker.worker_photo || null,
            submission_id: id
          }))
        });
      }
    }

    // Notify vendor if status changed
    if (statusChanged && newStatus && existingSubmission.user_id) {
      await notifyVendorStatusChange(
        existingSubmission.user_id,
        id,
        newStatus
      );
    }

    console.log('PUT /api/submissions/[id] - Update successful');
    return NextResponse.json(updatedSubmission);
  } catch (error) {
    console.error('PUT /api/submissions/[id] - Error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// DELETE /api/submissions/[id] - Delete submission 
export async function DELETE(_request: NextRequest, { params }: RouteParams) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { id } = await params;

    // Fetch the submission first to check permissions
    const existingSubmission = await prisma.submission.findUnique({
      where: { id }
    });

    if (!existingSubmission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Permission checks based on role
    if (session.user.role === 'VENDOR') {
      // Vendors can only delete their own PENDING submissions
      if (existingSubmission.user_id !== session.user.id) {
        return NextResponse.json({ 
          error: 'Access denied. You can only delete your own submissions.' 
        }, { status: 403 });
      }
      
      if (existingSubmission.approval_status !== 'PENDING') {
        return NextResponse.json({ 
          error: 'Can only delete pending submissions. Approved or rejected submissions cannot be deleted.' 
        }, { status: 400 });
      }
    } else if (session.user.role === 'ADMIN') {
      // Admins can delete any submission, but warn about approved ones
      if (existingSubmission.approval_status === 'APPROVED') {
        return NextResponse.json({ 
          error: 'Cannot delete approved submissions. This would affect issued SIMLOK documents.' 
        }, { status: 400 });
      }
    } else if (session.user.role === 'VERIFIER') {
      // Verifiers can delete pending and rejected submissions
      if (existingSubmission.approval_status === 'APPROVED') {
        return NextResponse.json({ 
          error: 'Cannot delete approved submissions.' 
        }, { status: 400 });
      }
    } else {
      return NextResponse.json({ 
        error: 'Invalid role. Only admins, verifiers, and vendors can delete submissions.' 
      }, { status: 403 });
    }

    // Clean up related notifications before deleting submission
    await cleanupSubmissionNotifications(id);

    // Delete the submission
    await prisma.submission.delete({
      where: { id }
    });

    return NextResponse.json({ 
      message: 'Submission deleted successfully',
      deletedId: id 
    });

  } catch (error) {
    console.error('Error deleting submission:', error);
    return NextResponse.json({ 
      error: 'Internal server error. Please try again later.' 
    }, { status: 500 });
  }
}


=== FILE: src/app/api/submissions/[id]/scans/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history
    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    const resolvedParams = await params;
    const submissionId = resolvedParams.id;

    // Get scan history for the specific submission
    const scans = await prisma.qrScan.findMany({
      where: {
        submission_id: submissionId
      },
      include: {
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            role: true,
          }
        }
      },
      orderBy: {
        scanned_at: 'desc'
      }
    });

    // Get total scan count
    const totalScans = scans.length;
    const lastScan = scans[0] || null;

    return NextResponse.json({
      scans,
      totalScans,
      lastScan,
      hasBeenScanned: totalScans > 0
    });

  } catch (error) {
    console.error('Error fetching submission scan history:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/submissions/[id]/workers/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

interface Params {
  id: string;
}

export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<Params> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { id } = await params;

    // Get submission - allow admin/reviewer/approver to access any submission, vendor only their own
    let submission;
    
    if (['ADMIN', 'SUPER_ADMIN', 'REVIEWER', 'APPROVER'].includes(session.user.role)) {
      submission = await prisma.submission.findUnique({
        where: { id: id }
      });
    } else {
      submission = await prisma.submission.findFirst({
        where: {
          id: id,
          user_id: session.user.id
        }
      });
    }

    if (!submission) {
      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });
    }

    // Get workers for this submission
    const workers = await prisma.workerList.findMany({
      where: {
        submission_id: id
      },
      orderBy: {
        created_at: 'asc'
      }
    });

    return NextResponse.json({ workers });
  } catch (error) {
    console.error('Error fetching workers:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/submissions/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';
import { SubmissionData } from '@/types/submission';
import { notifyAdminNewSubmission } from '@/server/events';

// GET /api/submissions - Get all submissions
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const status = searchParams.get('status');
    const search = searchParams.get('search') || '';
    const sortBy = searchParams.get('sortBy') || 'created_at';
    const sortOrder = searchParams.get('sortOrder') || 'desc';
    const vendorName = searchParams.get('vendor');
    const includeStats = searchParams.get('stats') === 'true';
    const skip = (page - 1) * limit;

    const whereClause: any = {};

    // Filter by role
    if (session.user.role === 'VENDOR') {
      whereClause.user_id = session.user.id;
    }

    // Filter by status if provided
    if (status) {
      whereClause.approval_status = status;
    }

    // Filter by vendor name if provided (admin/verifier only)
    if (vendorName && session.user.role !== 'VENDOR') {
      whereClause.vendor_name = {
        contains: vendorName
      };
    }

    // Add search functionality
    if (search) {
      const searchConditions = [
        { vendor_name: { contains: search } },
        { officer_name: { contains: search } },
        { job_description: { contains: search } },
        { work_location: { contains: search } },
        { worker_names: { contains: search } }
      ];
      
      whereClause.OR = searchConditions;
    }

    // Prepare orderBy
    const orderBy: any = {};
    orderBy[sortBy] = sortOrder;

    const [submissions, total] = await Promise.all([
      prisma.submission.findMany({
        where: whereClause,
        include: {
          user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
              vendor_name: true,
            }
          },
          approved_by_user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
            }
          }
        },
        orderBy: orderBy,
        skip,
        take: limit,
      }),
      prisma.submission.count({ where: whereClause }),
    ]);

    const response: any = {
      submissions,
      pagination: {
        page,
        limit,
        total,
        pages: Math.ceil(total / limit),
      }
    };

    // Include statistics for admin requests
    if (includeStats && session.user.role === 'ADMIN') {
      const statistics = await prisma.submission.groupBy({
        by: ['approval_status'],
        _count: {
          approval_status: true
        }
      });

      response.statistics = {
        total: total,
        pending: statistics.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,
        approved: statistics.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,
        rejected: statistics.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,
      };
    }

    return NextResponse.json(response);
  } catch (error) {
    console.error('Error fetching submissions:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

// POST /api/submissions - Create new submission
export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Debug logging
    console.log('POST /api/submissions - Session user:', {
      id: session.user.id,
      email: session.user.email,
      role: session.user.role
    });

    // Only VENDOR can create submissions
    if (session.user.role !== 'VENDOR') {
      return NextResponse.json({ error: 'Only vendors can create submissions' }, { status: 403 });
    }

    const body: SubmissionData = await request.json();
    
    // Debug logging for received data
    console.log('POST /api/submissions - Received data:', {
      ...body,
      // Don't log sensitive data, just check if required fields exist
      hasRequiredFields: {
        vendor_name: !!body.vendor_name,
        based_on: !!body.based_on,
        officer_name: !!body.officer_name,
        job_description: !!body.job_description,
        work_location: !!body.work_location,
        working_hours: !!body.working_hours,
        work_facilities: !!body.work_facilities,
        worker_names: !!body.worker_names
      }
    });

    // Validate required fields
    const requiredFields = [
      'vendor_name', 'based_on', 'officer_name', 'job_description', 
      'work_location', 'working_hours', 'work_facilities', 'worker_names'
    ];

    for (const field of requiredFields) {
      if (!body[field as keyof SubmissionData]) {
        console.log(`POST /api/submissions - Missing required field: ${field}`);
        return NextResponse.json({ 
          error: `Field ${field} is required` 
        }, { status: 400 });
      }
    }

    // Validate session user ID
    if (!session.user.id) {
      console.log('POST /api/submissions - Session user ID is missing');
      return NextResponse.json({ 
        error: 'User ID not found in session' 
      }, { status: 400 });
    }

    // Verify user exists in database
    const userExists = await prisma.user.findUnique({
      where: { id: session.user.id }
    });

    if (!userExists) {
      console.log('POST /api/submissions - User not found in database:', session.user.id);
      return NextResponse.json({ 
        error: 'User not found in database' 
      }, { status: 400 });
    }

    console.log('POST /api/submissions - User verified:', userExists.email);

    // Extract workers data and remove it from body since it's not part of Submission model
    const { workers, ...submissionData } = body as any;

    // Generate QR Code (simple implementation)
    const qrData = `${session.user.id}-${Date.now()}`;
    
    try {
      // Create submission first
      const submission = await prisma.submission.create({
        data: {
          ...submissionData,
          user_id: session.user.id,
          vendor_phone: userExists.phone_number, // Auto-fill dari data user
          worker_count: submissionData.worker_count || null,
          simja_date: submissionData.simja_date ? new Date(submissionData.simja_date) : null,
          sika_date: submissionData.sika_date ? new Date(submissionData.sika_date) : null,
          qrcode: qrData,
        },
        include: {
          user: {
            select: {
              id: true,
              officer_name: true,
              email: true,
              vendor_name: true,
            }
          }
        }
      });

      // Create workers if they exist
      if (workers && Array.isArray(workers) && workers.length > 0) {
        const workersData = workers.map((worker: any) => ({
          worker_name: worker.worker_name,
          worker_photo: worker.worker_photo || null,
          submission_id: submission.id,
        }));

        await prisma.workerList.createMany({
          data: workersData,
        });

        console.log('POST /api/submissions - Workers created:', workersData.length);
      }

      // Notify admin about new submission
      await notifyAdminNewSubmission(submission.id);

      console.log('POST /api/submissions - Submission created successfully:', submission.id);
      return NextResponse.json(submission, { status: 201 });
    } catch (dbError) {
      console.error('POST /api/submissions - Database error:', dbError);
      return NextResponse.json({ 
        error: 'Failed to create submission in database' 
      }, { status: 500 });
    }
  } catch (error) {
    console.error('POST /api/submissions - General error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}


=== FILE: src/app/api/test/notifications-debug/route.ts ===
/**
 * Test endpoint untuk debugging notification read status
 * GET /api/test/notifications-debug
 */

import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/singletons';

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(request.url);
    const scope = searchParams.get('scope') || session.user.role.toLowerCase();

    // Convert SUPER_ADMIN to admin
    const actualScope = session.user.role === 'SUPER_ADMIN' ? 'admin' : scope;

    console.log('🔍 Debug request for scope:', actualScope, 'by user:', session.user.officer_name);

    // Get notifications with read status - exactly like the main API
    const notifications = await prisma.notification.findMany({
      where: { scope: actualScope },
      include: {
        reads: {
          where: actualScope === 'vendor' 
            ? { vendor_id: session.user.id }
            : { user_id: session.user.id },
        },
      },
      orderBy: { created_at: 'desc' },
      take: 10,
    });

    const debugResult = {
      user: {
        id: session.user.id,
        name: session.user.officer_name,
        role: session.user.role
      },
      scope: actualScope,
      totalNotifications: notifications.length,
      notifications: notifications.map(notif => ({
        id: notif.id,
        title: notif.title,
        created_at: notif.created_at.toISOString(),
        reads_count: notif.reads.length,
        isRead: notif.reads.length > 0,
        read_details: notif.reads.map(read => ({
          read_at: read.read_at.toISOString(),
          user_id: read.user_id,
          vendor_id: read.vendor_id
        }))
      }))
    };

    console.log('📊 Debug result:', {
      scope: actualScope,
      totalNotifications: notifications.length,
      readNotifications: notifications.filter(n => n.reads.length > 0).length,
      unreadNotifications: notifications.filter(n => n.reads.length === 0).length
    });

    return NextResponse.json(debugResult);

  } catch (error) {
    console.error('Debug error:', error);
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
  }
}

=== FILE: src/app/api/upload/enhanced/route.ts ===
/**
 * Enhanced File Upload API with Validation and Compression
 * Demonstrates integration of FileValidationService and FileCompressionService
 */

import { NextRequest, NextResponse } from 'next/server';
import { writeFile, mkdir } from 'fs/promises';
import { join } from 'path';
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';
import { FileValidationService } from '@/services/FileValidationService';
import { FileCompressionService } from '@/services/FileCompressionService';

export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);

    if (!session?.user) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const formData = await request.formData();
    const file = formData.get('file') as File;
    const category = formData.get('category') as string || 'other';
    
    if (!file) {
      return NextResponse.json(
        { error: 'No file provided' },
        { status: 400 }
      );
    }

    // Create uploads directory
    const uploadsDir = join(process.cwd(), 'uploads', 'temp');
    await mkdir(uploadsDir, { recursive: true });

    // Save temporary file
    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);
    
    const originalName = file.name;
    const tempFilePath = join(uploadsDir, `temp_${Date.now()}_${originalName}`);
    await writeFile(tempFilePath, buffer);

    try {
      // Step 1: Validate file
      console.log('🔍 Validating file:', originalName);
      const validationResult = await FileValidationService.validateSIMLOKFile(
        tempFilePath,
        originalName,
        category as 'sika' | 'simja' | 'id_card' | 'other'
      );

      if (!validationResult.isValid) {
        return NextResponse.json(
          { 
            error: 'File validation failed',
            message: validationResult.error,
            securityChecks: validationResult.securityChecks
          },
          { status: 400 }
        );
      }

      // Step 2: Compress file if needed
      console.log('🗜️ Compressing file if needed...');
      let compressionApplied = false;
      
      if (FileCompressionService.canCompress(validationResult.mimeType)) {
        const compressionResult = await FileCompressionService.compressFile(
          tempFilePath,
          {
            quality: 60, // 40% compression for mobile optimization
            maxSizeBytes: 2 * 1024 * 1024, // 2MB max
            outputDir: uploadsDir,
          }
        );

        if (compressionResult.success && compressionResult.outputPath) {
          compressionApplied = true;
          console.log(`✅ Compression successful: ${compressionResult.originalSize} -> ${compressionResult.compressedSize}`);
        }
      }

      // Step 3: Move to permanent location (simulation)
      const finalDir = join(process.cwd(), 'uploads', category, session.user.id);
      await mkdir(finalDir, { recursive: true });
      
      const finalFileName = `${Date.now()}_${originalName}`;
      const permanentPath = join(finalDir, finalFileName);
      
      // In a real implementation, you would move the file and save to database
      console.log('📁 Final file path:', permanentPath);

      // Step 4: Return success response
      const response = {
        success: true,
        message: 'File uploaded successfully',
        file: {
          originalName,
          finalName: finalFileName,
          size: validationResult.size,
          mimeType: validationResult.mimeType,
          category,
        },
        validation: {
          isValid: validationResult.isValid,
          securityChecks: validationResult.securityChecks,
        },
        compression: compressionApplied ? {
          applied: true,
          originalSize: validationResult.size,
          // In real implementation, get actual compressed size
          compressedSize: Math.floor(validationResult.size * 0.6),
          quality: 60,
        } : {
          applied: false,
          reason: 'File type does not support compression or already within size limits'
        },
        paths: {
          category,
          fileName: finalFileName,
          relativePath: `/uploads/${category}/${session.user.id}/${finalFileName}`,
        }
      };

      return NextResponse.json(response, { status: 200 });

    } catch (processingError) {
      console.error('File processing error:', processingError);
      return NextResponse.json(
        { 
          error: 'File processing failed',
          message: processingError instanceof Error ? processingError.message : 'Unknown processing error'
        },
        { status: 500 }
      );
    }

  } catch (error) {
    console.error('File upload error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

// Get upload limits and allowed types
export async function GET() {
  const config = {
    maxFileSize: '10MB',
    allowedTypes: [
      'image/jpeg',
      'image/png',
      'application/pdf',
      'application/msword',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    ],
    allowedExtensions: [
      '.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'
    ],
    categories: [
      { id: 'sika', name: 'SIKA Documents', allowedTypes: ['image/*', 'application/pdf'] },
      { id: 'simja', name: 'SIMJA Documents', allowedTypes: ['image/*', 'application/pdf'] },
      { id: 'id_card', name: 'ID Card', allowedTypes: ['image/*'] },
      { id: 'other', name: 'Other Documents', allowedTypes: ['image/*', 'application/pdf'] },
    ],
    compression: {
      enabled: true,
      targetSize: '1-2MB',
      quality: '60% (40% compression)',
      supportedFormats: ['JPEG', 'PNG', 'PDF']
    },
    validation: {
      magicBytesCheck: true,
      malwareScanning: true,
      fileSignatureValidation: true,
    }
  };

  return NextResponse.json(config);
}

=== FILE: src/app/api/upload/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { fileManager } from '@/lib/fileManager';

// Configure maximum file size (8MB)
const MAX_FILE_SIZE = 8 * 1024 * 1024;

// Allowed file types
const ALLOWED_TYPES = [
  'application/pdf',
  'application/msword',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  'image/jpeg',
  'image/jpg', 
  'image/png',
  'image/gif'
];

// Allowed file extensions
const ALLOWED_EXTENSIONS = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif'];

export async function POST(request: NextRequest) {
  try {
    // Check authentication
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Parse form data
    const formData = await request.formData();
    const file = formData.get('file') as File | null;
    const fieldName = formData.get('fieldName') as string | null; // Optional field to determine category

    if (!file) {
      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });
    }

    // Validate file size
    if (file.size > MAX_FILE_SIZE) {
      return NextResponse.json({ 
        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` 
      }, { status: 400 });
    }

    // Validate file type
    if (!ALLOWED_TYPES.includes(file.type)) {
      return NextResponse.json({ 
        error: `File type not supported. Allowed types: ${ALLOWED_EXTENSIONS.join(', ')}` 
      }, { status: 400 });
    }

    // Validate file extension
    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();
    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {
      return NextResponse.json({ 
        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` 
      }, { status: 400 });
    }

    // Convert file to buffer
    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);

    // Save file using FileManager
    const fileInfo = await fileManager.saveFile(
      buffer,
      file.name,
      session.user.id,
      fieldName || undefined
    );

    return NextResponse.json({
      success: true,
      url: fileInfo.url,
      filename: fileInfo.newName,
      originalName: fileInfo.originalName,
      size: fileInfo.size,
      type: fileInfo.type,
      category: fileInfo.category,
      path: fileInfo.path
    });

  } catch (error) {
    console.error('Upload error:', error);
    return NextResponse.json({ 
      error: 'Internal server error during file upload' 
    }, { status: 500 });
  }
}

// GET /api/upload - Get upload info (optional)
export async function GET() {
  return NextResponse.json({
    maxFileSize: MAX_FILE_SIZE,
    allowedTypes: ALLOWED_TYPES,
    allowedExtensions: ALLOWED_EXTENSIONS
  });
}


=== FILE: src/app/api/upload/worker-photo/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { fileManager } from '@/lib/fileManager';

// Configure maximum file size (8MB)
const MAX_FILE_SIZE = 8 * 1024 * 1024;

// Allowed image types for worker photos
const ALLOWED_TYPES = [
  'image/jpeg',
  'image/jpg', 
  'image/png'
];

// Allowed image extensions
const ALLOWED_EXTENSIONS = ['.jpg', '.jpeg', '.png'];

export async function POST(request: NextRequest) {
  try {
    // Check authentication
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // Parse form data
    const formData = await request.formData();
    const file = formData.get('file') as File | null;
    const workerName = formData.get('workerName') as string | null;

    if (!file) {
      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });
    }

    if (!workerName) {
      return NextResponse.json({ error: 'Worker name is required' }, { status: 400 });
    }

    // Validate file size
    if (file.size > MAX_FILE_SIZE) {
      return NextResponse.json({ 
        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` 
      }, { status: 400 });
    }

    // Validate file type
    if (!ALLOWED_TYPES.includes(file.type)) {
      return NextResponse.json({ 
        error: `File type not supported. Only images are allowed: ${ALLOWED_EXTENSIONS.join(', ')}` 
      }, { status: 400 });
    }

    // Validate file extension
    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();
    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {
      return NextResponse.json({ 
        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` 
      }, { status: 400 });
    }

    // Convert file to buffer
    const bytes = await file.arrayBuffer();
    const buffer = Buffer.from(bytes);

    // Save worker photo using special method
    const fileInfo = await fileManager.saveWorkerPhoto(
      buffer,
      file.name,
      session.user.id,
      workerName
    );

    return NextResponse.json({
      success: true,
      url: fileInfo.url,
      filename: fileInfo.newName,
      originalName: fileInfo.originalName,
      workerName: workerName,
      size: fileInfo.size,
      type: fileInfo.type,
      category: fileInfo.category,
      path: fileInfo.path
    });

  } catch (error) {
    console.error('Worker photo upload error:', error);
    return NextResponse.json({ 
      error: 'Internal server error during worker photo upload' 
    }, { status: 500 });
  }
}

// GET /api/upload/worker-photo - Get upload info
export async function GET() {
  return NextResponse.json({
    maxFileSize: MAX_FILE_SIZE,
    allowedTypes: ALLOWED_TYPES,
    allowedExtensions: ALLOWED_EXTENSIONS,
    description: 'Upload endpoint for worker photos with worker name as filename'
  });
}


=== FILE: src/app/api/user/change-password/route.ts ===
import { NextResponse } from "next/server";
import { prisma } from "@/lib/prisma";
import bcrypt from "bcryptjs";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

export async function PUT(req: Request) {
  try {
    const session = await getServerSession(authOptions);
    if (!session?.user) {
      return new NextResponse("Unauthorized", { status: 401 });
    }

    const body = await req.json();
    const { currentPassword, newPassword } = body;

    // Get user from database
    const user = await prisma.user.findUnique({
      where: {
        id: session.user.id,
      },
    });

    if (!user) {
      return new NextResponse("User not found", { status: 404 });
    }

    // Verify current password
    const isValidPassword = await bcrypt.compare(currentPassword, user.password);
    if (!isValidPassword) {
      return new NextResponse("Invalid current password", { status: 400 });
    }

    // Hash new password
    const hashedPassword = await bcrypt.hash(newPassword, 10);

    // Update password in database
    await prisma.user.update({
      where: {
        id: session.user.id,
      },
      data: {
        password: hashedPassword,
      },
    });

    return new NextResponse("Password updated successfully", { status: 200 });
  } catch (error) {
    console.error("[PASSWORD_CHANGE_ERROR]", error);
    return new NextResponse("Internal Server Error", { status: 500 });
  }
}

=== FILE: src/app/api/users/[id]/route.ts ===
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";
import { User_role } from "@prisma/client";
import bcrypt from "bcryptjs";
import { z } from "zod";

// Schema validasi untuk update user
const updateUserSchema = z.object({
  officer_name: z.string().min(1, "Nama petugas wajib diisi").optional(),
  email: z.string().email("Email tidak valid").optional(),
  password: z.string().min(6, "Password minimal 6 karakter").optional(),
  role: z.nativeEnum(User_role).optional(),
  address: z.string().optional(),
  phone_number: z.string().optional(),
  vendor_name: z.string().optional(),
  verified_at: z.string().datetime().optional(),
});

// GET - Mengambil detail user berdasarkan ID
export async function GET(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    // Cek apakah user adalah super admin
    if (!session || session.user.role !== User_role.SUPER_ADMIN) {
      return NextResponse.json(
        { error: "Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini." },
        { status: 403 }
      );
    }

    const resolvedParams = await params;
    const user = await prisma.user.findUnique({
      where: { 
        id: resolvedParams.id
      },
      select: {
        id: true,
        officer_name: true,
        email: true,
        role: true,
        address: true,
        phone_number: true,
        vendor_name: true,
        created_at: true,
        verified_at: true,
        verified_by: true,
        profile_photo: true,
      }
    });

    if (!user) {
      return NextResponse.json(
        { error: "User tidak ditemukan" },
        { status: 404 }
      );
    }

    return NextResponse.json(user);

  } catch (error) {
    console.error("Error fetching user:", error);
    return NextResponse.json(
      { error: "Terjadi kesalahan saat mengambil data user" },
      { status: 500 }
    );
  }
}

  // PUT - Update user
export async function PUT(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    // Cek apakah user adalah super admin
    if (!session || session.user.role !== User_role.SUPER_ADMIN) {
      return NextResponse.json(
        { error: "Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini." },
        { status: 403 }
      );
    }

    const resolvedParams = await params;
    const body = await request.json();
    const validation = updateUserSchema.safeParse(body);

    if (!validation.success) {
      return NextResponse.json(
        { error: "Data tidak valid", details: validation.error.issues },
        { status: 400 }
      );
    }

    // Cek apakah user existe
    const existingUser = await prisma.user.findUnique({
      where: { 
        id: resolvedParams.id
      }
    });    if (!existingUser) {
      return NextResponse.json(
        { error: "User tidak ditemukan" },
        { status: 404 }
      );
    }

    const updateData: any = { ...validation.data };

    // Hash password jika ada
    if (updateData.password) {
      updateData.password = await bcrypt.hash(updateData.password, 10);
    }

    // Handle vendor_name berdasarkan role
    if (updateData.role === User_role.VERIFIER || updateData.role === User_role.SUPER_ADMIN) {
      updateData.vendor_name = null;
    }

    // Parse verified_at jika ada
    if (updateData.verified_at) {
      updateData.verified_at = new Date(updateData.verified_at);
    }

    // Cek email unik jika email diubah
    if (updateData.email && updateData.email !== existingUser.email) {
      const emailExists = await prisma.user.findUnique({
        where: { email: updateData.email }
      });

      if (emailExists) {
        return NextResponse.json(
          { error: "Email sudah digunakan" },
          { status: 400 }
        );
      }
    }

    const updatedUser = await prisma.user.update({
      where: { id: resolvedParams.id },
      data: updateData,
      select: {
        id: true,
        officer_name: true,
        email: true,
        role: true,
        address: true,
        phone_number: true,
        vendor_name: true,
        created_at: true,
        verified_at: true,
        verified_by: true,
        profile_photo: true,
      }
    });

    return NextResponse.json(updatedUser);

  } catch (error) {
    console.error("Error updating user:", error);
    return NextResponse.json(
      { error: "Terjadi kesalahan saat mengupdate user" },
      { status: 500 }
    );
  }
}

  // DELETE - Hapus user
export async function DELETE(
  _request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await getServerSession(authOptions);
    
    // Cek apakah user adalah super admin
    if (!session || session.user.role !== User_role.SUPER_ADMIN) {
      return NextResponse.json(
        { error: "Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini." },
        { status: 403 }
      );
    }

    const resolvedParams = await params;

    // Cek apakah user existe
    const existingUser = await prisma.user.findUnique({
      where: { 
        id: resolvedParams.id
      }
    });    if (!existingUser) {
      return NextResponse.json(
        { error: "User tidak ditemukan" },
        { status: 404 }
      );
    }

    await prisma.user.delete({
      where: { id: resolvedParams.id }
    });

    return NextResponse.json(
      { message: "User berhasil dihapus" },
      { status: 200 }
    );

  } catch (error) {
    console.error("Error deleting user:", error);
    return NextResponse.json(
      { error: "Terjadi kesalahan saat menghapus user" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/users/[id]/verify/route.ts ===
// app/api/users/[id]/verify/route.ts
import { NextRequest, NextResponse } from "next/server";
import { prisma } from "@/lib/singletons";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";

export async function PUT(
  request: NextRequest,
  context: { params: Promise<{ id: string }> }
) {
  try {
    const params = await context.params;
    const { id } = params;
    const { action } = await request.json(); // "approve" or "reject"

    // Check session
    const session = await getServerSession(authOptions);
    if (!session || (session.user.role !== "ADMIN" && session.user.role !== "SUPER_ADMIN")) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    // Find user
    const user = await prisma.user.findUnique({
      where: { id },
    });

    if (!user) {
      return NextResponse.json({ error: "User not found" }, { status: 404 });
    }

    let updatedUser;

    if (action === "approve") {
      // Approve user
      updatedUser = await prisma.user.update({
        where: { id },
        data: {
          verified_at: new Date(),
          verified_by: session.user.id,
        },
        select: {
          id: true,
          officer_name: true,
          email: true,
          role: true,
          vendor_name: true,
          verified_at: true,
          created_at: true,
        },
      });
    } else if (action === "reject") {
      // For now, we'll just delete the user. You might want to keep them with a "rejected" status
      await prisma.user.delete({
        where: { id },
      });
      
      return NextResponse.json({ 
        message: "User rejected and removed from system",
        success: true 
      });
    } else {
      return NextResponse.json({ error: "Invalid action" }, { status: 400 });
    }

    return NextResponse.json({
      message: `User ${action === "approve" ? "approved" : "rejected"} successfully`,
      user: updatedUser,
      success: true
    });

  } catch (error) {
    console.error("Error in user verification:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/users/profile/route.ts ===
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import { NextResponse } from "next/server";
import { prisma } from "@/lib/prisma";

export async function PUT(req: Request) {
  try {
    const session = await getServerSession(authOptions);

    if (!session) {
      return new NextResponse("Unauthorized", { status: 401 });
    }

    const body = await req.json();
    const { officer_name, vendor_name, phone_number, address } = body;

    // Basic validation
    if (!officer_name?.trim()) {
      return new NextResponse("Officer name is required", { status: 400 });
    }

    // Update user profile
    const updatedUser = await prisma.user.update({
      where: {
        id: session.user.id,
      },
      data: {
        officer_name,
        vendor_name: vendor_name || null,
        phone_number: phone_number || null,
        address: address || null,
      },
    });

    return NextResponse.json(updatedUser);
  } catch (error) {
    console.error("[PROFILE_UPDATE]", error);
    return new NextResponse("Internal Server Error", { status: 500 });
  }
}

=== FILE: src/app/api/users/route.ts ===
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";
import { User_role } from "@prisma/client";
import bcrypt from "bcryptjs";
import { z } from "zod";

const userSchema = z.object({
  officer_name: z.string().min(1, "Nama petugas wajib diisi"),
  email: z.string().email("Email tidak valid"),
  password: z.string().min(6, "Password minimal 6 karakter").optional(),
  role: z.nativeEnum(User_role),
  address: z.string().optional(),
  phone_number: z.string().optional(),
  vendor_name: z.string().optional(),
});

// GET - Mengambil daftar user dengan pagination, search, dan sort
export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    // Cek apakah user adalah super admin
    if (!session || session.user.role !== User_role.SUPER_ADMIN) {
      return NextResponse.json(
        { error: "Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini." },
        { status: 403 }
      );
    }

    // Get search params
    const { searchParams } = new URL(request.url);
    const page = parseInt(searchParams.get("page") || "1");
    const limit = parseInt(searchParams.get("limit") || "10");
    const search = searchParams.get("search") || "";
    const sortBy = searchParams.get("sortBy") || "created_at";
    const sortOrder = searchParams.get("sortOrder") || "desc";
    const role = searchParams.get("role") || "";
    const verificationStatus = searchParams.get("verificationStatus") || ""; // "pending", "verified", "all"

    console.log("API received params:", { 
      page, 
      limit, 
      search, 
      sortBy, 
      sortOrder, 
      role, 
      verificationStatus 
    });

    const skip = (page - 1) * limit;

    // Build where clause
    const where: any = {};

    // Filter by role if specified
    if (role && (role === User_role.VENDOR || role === User_role.VERIFIER)) {
      where.role = role;
    }

    // Filter by verification status
    if (verificationStatus === "pending") {
      where.verified_at = null;
      console.log("Filtering for pending verification (verified_at is null)");
    } else if (verificationStatus === "verified") {
      where.verified_at = { not: null };
      console.log("Filtering for verified users (verified_at is not null)");
    } else {
      console.log("No verification filter applied (showing all)");
    }
    // "all" shows both pending and verified

    console.log("Final query where clause:", JSON.stringify(where, null, 2));

    // Search functionality
    if (search) {
      where.OR = [
        { officer_name: { contains: search } },
        { email: { contains: search } },
        { vendor_name: { contains: search } },
        { phone_number: { contains: search } },
      ];
    }

    // Get total count
    const total = await prisma.user.count({ where });

    // Get users with pagination and sorting
    const users = await prisma.user.findMany({
      where,
      skip,
      take: limit,
      orderBy: {
        [sortBy]: sortOrder as "asc" | "desc"
      },
      select: {
        id: true,
        officer_name: true,
        email: true,
        role: true,
        address: true,
        phone_number: true,
        vendor_name: true,
        created_at: true,
        verified_at: true,
        verified_by: true,
        profile_photo: true,
      }
    });

    return NextResponse.json({
      users,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit)
      }
    });

  } catch (error) {
    console.error("Error fetching users:", error);
    return NextResponse.json(
      { error: "Terjadi kesalahan saat mengambil data user" },
      { status: 500 }
    );
  }
}

// POST - Membuat user baru
export async function POST(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    // Cek apakah user adalah super admin
    if (!session || session.user.role !== User_role.SUPER_ADMIN) {
      return NextResponse.json(
        { error: "Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini." },
        { status: 403 }
      );
    }

    const body = await request.json();
    const validation = userSchema.safeParse(body);

    if (!validation.success) {
      return NextResponse.json(
        { error: "Data tidak valid", details: validation.error.issues },
        { status: 400 }
      );
    }

    const { officer_name, email, password, role, address, phone_number, vendor_name } = validation.data;

    // Cek apakah email sudah ada
    const existingUser = await prisma.user.findUnique({
      where: { email }
    });

    if (existingUser) {
      return NextResponse.json(
        { error: "Email sudah digunakan" },
        { status: 400 }
      );
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password || "password123", 10);

    // Buat user baru
    const newUser = await prisma.user.create({
      data: {
        officer_name,
        email,
        password: hashedPassword,
        role,
        address: address || null,
        phone_number: phone_number || null,
        vendor_name: role === User_role.VENDOR ? (vendor_name || null) : null,
        verified_by: session.user.officer_name,
        verified_at: new Date(),
      },
      select: {
        id: true,
        officer_name: true,
        email: true,
        role: true,
        address: true,
        phone_number: true,
        vendor_name: true,
        created_at: true,
        verified_at: true,
        verified_by: true,
      }
    });

    return NextResponse.json(newUser, { status: 201 });

  } catch (error) {
    console.error("Error creating user:", error);
    return NextResponse.json(
      { error: "Terjadi kesalahan saat membuat user" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/v1/notifications/[id]/read/route.ts ===
/**
 * POST /api/v1/notifications/[id]/read
 * Mark a specific notification as read
 */

import { NextRequest } from 'next/server';
import { prisma } from '@/lib/singletons';
import { Cache, CacheNamespaces } from '@/lib/cache';
import { eventsPublisher } from '@/server/eventsPublisher';
import { 
  withErrorHandling, 
  apiSuccess, 
  apiError,
  getAuthenticatedSession,
  handleOptions,
} from '@/lib/api-utils';

async function markAsRead(
  _req: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params;
    const notificationId = id;

    console.log('🏷️ Mark as read request for notification:', notificationId);

    // Check authentication
    const { session, error: authError } = await getAuthenticatedSession();
    if (authError) {
      console.log('❌ Authentication failed:', authError);
      return authError;
    }

    console.log('👤 User attempting to mark as read:', {
      id: session.user.id,
      role: session.user.role,
      name: session.user.officer_name
    });

    // Get notification
    const notification = await prisma.notification.findUnique({
      where: { id: notificationId },
    });

    if (!notification) {
      console.log('❌ Notification not found:', notificationId);
      return apiError('Notification not found', 404);
    }

    console.log('📋 Found notification:', {
      id: notification.id,
      scope: notification.scope,
      type: notification.type,
      title: notification.title
    });

    // Check permissions
    if (notification.scope === 'admin' && !['ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      console.log('❌ Admin access denied for role:', session.user.role);
      return apiError('Access denied', 403);
    }

    if (notification.scope === 'vendor') {
      if (session.user.role !== 'VENDOR' || notification.vendor_id !== session.user.id) {
        console.log('❌ Vendor access denied:', { userRole: session.user.role, vendorId: notification.vendor_id, userId: session.user.id });
        return apiError('Access denied', 403);
      }
    }

    if (notification.scope === 'reviewer' && !['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      console.log('❌ Reviewer access denied for role:', session.user.role);
      return apiError('Access denied', 403);
    }

    if (notification.scope === 'approver' && !['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {
      console.log('❌ Approver access denied for role:', session.user.role);
      return apiError('Access denied', 403);
    }

    console.log('✅ Permission check passed');

    // Check if already read
    const existingRead = await prisma.notificationRead.findFirst({
      where: {
        notification_id: notificationId,
        ...(notification.scope === 'vendor' 
          ? { vendor_id: session.user.id }
          : { user_id: session.user.id } // For admin, reviewer, approver
        ),
      },
    });

    if (existingRead) {
      console.log('ℹ️ Notification already marked as read');
      return apiSuccess({ message: 'Already marked as read' });
    }

    console.log('📝 Creating read record...');

    // Use upsert to handle duplicate read attempts gracefully
    if (notification.scope === 'vendor') {
      await prisma.notificationRead.upsert({
        where: {
          notification_id_vendor_id: {
            notification_id: notificationId,
            vendor_id: session.user.id
          }
        },
        update: {
          read_at: new Date()
        },
        create: {
          notification_id: notificationId,
          vendor_id: session.user.id
        }
      });
    } else {
      await prisma.notificationRead.upsert({
        where: {
          notification_id_user_id: {
            notification_id: notificationId,
            user_id: session.user.id
          }
        },
        update: {
          read_at: new Date()
        },
        create: {
          notification_id: notificationId,
          user_id: session.user.id
        }
      });
    }

    console.log('✅ Read record created successfully');

    // Invalidate cache - use proper method
    // const vendorId = notification.scope === 'vendor' ? session.user.id : null;
    // const cacheKey = `notifications:${notification.scope}:${vendorId || 'all'}:start:50`;
    
    // Use the correct invalidation method
    await Cache.invalidateByPrefix(`notifications:${notification.scope}`, CacheNamespaces.NOTIFICATIONS);

    console.log('💾 Cache invalidated for notification read:', {
      scope: notification.scope,
      userId: session.user.id,
      notificationId,
      pattern: `notifications:${notification.scope}`
    });

    // Get updated unread count and emit event
    const unreadCount = await prisma.notification.count({
      where: {
        scope: notification.scope,
        ...(notification.scope === 'vendor' ? { vendor_id: session.user.id } : {}),
        reads: {
          none: notification.scope === 'vendor' 
            ? { vendor_id: session.user.id }
            : { user_id: session.user.id }, // For admin, reviewer, approver
        },
      },
    });

    console.log('📊 Updated unread count:', unreadCount);

    // Emit unread count update
    eventsPublisher.notificationUnreadCount({
      scope: notification.scope,
      vendorId: notification.scope === 'vendor' ? session.user.id : undefined,
      unreadCount,
      count: unreadCount,
    });

    return apiSuccess({
      message: 'Notification marked as read',
      unreadCount,
    });

  } catch (error) {
    console.error('💥 Error in markAsRead:', error);
    return apiError('Internal server error', 500);
  }
}

export const POST = withErrorHandling(markAsRead);
export const OPTIONS = handleOptions;


=== FILE: src/app/api/v1/notifications/read-all/route.ts ===
/**
 * POST /api/v1/notifications/read-all
 * Mark all notifications as read for current user/scope
 */

import { NextRequest } from 'next/server';
import { prisma } from '@/lib/singletons';
import { Cache, CacheNamespaces } from '@/lib/cache';
import { eventsPublisher } from '@/server/eventsPublisher';
import { 
  withErrorHandling, 
  apiSuccess, 
  apiError,
  validateRequestBody,
  getAuthenticatedSession,
  handleOptions,
} from '@/lib/api-utils';
import { MarkAllAsReadSchema } from '@/shared/dto';

async function markAllAsRead(req: NextRequest) {
  // Validate request body
  const { data: body, error: validationError } = await validateRequestBody(req, MarkAllAsReadSchema);
  if (validationError || !body) {
    return apiError(validationError || 'Invalid request body', 400);
  }

  // Check authentication
  const { session, error: authError } = await getAuthenticatedSession();
  if (authError) return authError;

  // Check permissions
  if (body.scope === 'admin' && !['SUPER_ADMIN'].includes(session.user.role)) {
    return apiError('Access denied', 403);
  }

  if (body.scope === 'vendor' && session.user.role !== 'VENDOR') {
    return apiError('Access denied', 403);
  }

  if (body.scope === 'reviewer' && !['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
    return apiError('Access denied', 403);
  }

  if (body.scope === 'approver' && !['APPROVER', 'SUPER_ADMIN'].includes(session.user.role)) {
    return apiError('Access denied', 403);
  }

  // For vendor scope, use session user ID if vendorId not provided
  const vendorId = body.scope === 'vendor' 
    ? (body.vendorId || session.user.id)
    : body.vendorId;

  // Get all unread notifications for this scope/user
  const unreadNotifications = await prisma.notification.findMany({
    where: {
      scope: body.scope,
      ...(body.scope === 'vendor' && vendorId ? { vendor_id: vendorId } : {}),
      reads: {
        none: body.scope === 'vendor'
          ? { vendor_id: vendorId }
          : { user_id: session.user.id }, // For admin, reviewer, approver
      },
    },
    select: { id: true },
  });

  if (unreadNotifications.length === 0) {
    return apiSuccess({ message: 'No unread notifications' });
  }

  // Mark all as read in bulk
  const readRecords = unreadNotifications.map(notification => ({
    notification_id: notification.id,
    ...(body.scope === 'vendor' 
      ? { vendor_id: vendorId }
      : { user_id: session.user.id } // For admin, reviewer, approver
    ),
  }));

  await prisma.notificationRead.createMany({
    data: readRecords,
    skipDuplicates: true,
  });

  // Invalidate cache
  await Cache.invalidateByPrefix('notifications', CacheNamespaces.NOTIFICATIONS);

  // Emit unread count update (should be 0 now)
  eventsPublisher.notificationUnreadCount({
    scope: body.scope,
    vendorId: body.scope === 'vendor' ? vendorId : undefined,
    unreadCount: 0,
    count: 0,
  });

  return apiSuccess({
    message: `Marked ${unreadNotifications.length} notifications as read`,
    markedCount: unreadNotifications.length,
  });
}

export const POST = withErrorHandling(markAllAsRead);
export const OPTIONS = handleOptions;


=== FILE: src/app/api/v1/notifications/route.ts ===
/**
 * GET /api/v1/notifications
 * Get paginated notifications for admin or vendor
 */

import { NextRequest } from 'next/server';
import { prisma } from '@/lib/singletons';
import { Cache, CacheNamespaces, CacheTTL } from '@/lib/cache';
import { 
  withErrorHandling, 
  apiSuccess, 
  apiError, 
  validateQueryParams,
  getAuthenticatedSession,
  handleOptions,
} from '@/lib/api-utils';
import { NotificationsQuerySchema, NotificationDto } from '@/shared/dto';

async function getNotifications(req: NextRequest) {
  // Validate query parameters
  const { data: query, error: validationError } = validateQueryParams(req, NotificationsQuerySchema);
  if (validationError || !query) {
    return apiError(validationError || 'Invalid query parameters', 400);
  }

  // Check authentication
  const { session, error: authError } = await getAuthenticatedSession();
  if (authError) return authError;

  // Validate permissions
  console.log('🔐 Validating permissions for scope:', query.scope, 'user role:', session.user.role);

  if (query.scope === 'admin' && !['SUPER_ADMIN'].includes(session.user.role)) {
    console.log('❌ Access denied for admin scope. User role:', session.user.role);
    return apiError('Access denied', 403);
  }

  if (query.scope === 'vendor' && !['VENDOR', 'SUPER_ADMIN'].includes(session.user.role)) {
    return apiError('Access denied', 403);
  }

  if (query.scope === 'reviewer' && !['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {
    console.log('❌ Access denied for reviewer scope. User role:', session.user.role);
    return apiError('Access denied', 403);
  }

  if (query.scope === 'approver' && !['APPROVER', 'SUPER_ADMIN'].includes(session.user.role)) {
    console.log('❌ Access denied for approver scope. User role:', session.user.role);
    return apiError('Access denied', 403);
  }

  // For vendor scope, use session user ID if vendorId not provided
  const vendorId = query.scope === 'vendor' 
    ? (query.vendorId || session.user.id)
    : query.vendorId;

  // Build cache key
  const cacheKey = `notifications:${query.scope}:${vendorId || 'all'}:${query.cursor || 'start'}:${query.limit}`;
  console.log('🔑 Cache key:', cacheKey);

  // Try to get from cache first - but skip cache if there are any read status changes
  const cached = await Cache.getJSON<{ notifications: NotificationDto[]; hasMore: boolean; nextCursor: string | null }>(
    cacheKey, 
    { namespace: CacheNamespaces.NOTIFICATIONS, ttl: CacheTTL.SHORT }
  );

  if (cached) {
    console.log('📦 Returning cached result (may not reflect latest read status)');
    return apiSuccess({
      data: cached.notifications,
      pagination: {
        nextCursor: cached.nextCursor,
        hasMore: cached.hasMore,
      }
    });
  } else {
    console.log('🔄 Cache miss, fetching from database');
  }

  // Build where clause
  const whereClause: any = {
    scope: query.scope,
  };

  console.log('🔍 Building where clause for scope:', query.scope);

  if (query.scope === 'vendor' && vendorId) {
    whereClause.vendor_id = vendorId;
    console.log('📋 Adding vendor_id filter:', vendorId);
  }

  // Handle cursor pagination
  if (query.cursor) {
    whereClause.id = {
      lt: query.cursor, // Get notifications before this cursor
    };
  }

  console.log('🎯 Final where clause:', whereClause);

  // Get notifications with read status
  const notifications = await prisma.notification.findMany({
    where: whereClause,
    include: {
      reads: {
        where: query.scope === 'vendor' 
          ? { vendor_id: vendorId }
          : { user_id: session.user.id }, // For admin, reviewer, approver
      },
    },
    orderBy: {
      created_at: 'desc',
    },
    take: query.limit + 1, // Get one extra to check if there are more
  });

  console.log('📊 Found notifications count:', notifications.length);
  console.log('� Read status debug for first 3 notifications:');
  notifications.slice(0, 3).forEach((n, index) => {
    console.log(`  ${index + 1}. ${n.title}`);
    console.log(`     ID: ${n.id}`);
    console.log(`     Reads count: ${n.reads.length}`);
    console.log(`     User ID filter: ${session.user.id}`);
    // if (n.reads.length > 0) {
    //   console.log(`     Read by: ${n.reads[0].user_id || n.reads[0].vendor_id}`);
    // }
  });

  // Filter out notifications that reference non-existent submissions
  const validNotifications = [];
  for (const notification of notifications) {
    let isValid = true;
    
    // Check if notification data contains a submissionId
    if (notification.data) {
      try {
        const data = JSON.parse(notification.data);
        if (data.submissionId) {
          // Verify that the submission still exists
          const submissionExists = await prisma.submission.findUnique({
            where: { id: data.submissionId },
            select: { id: true }
          });
          
          if (!submissionExists) {
            isValid = false;
            // Optionally clean up this orphaned notification
            console.log(`Found orphaned notification ${notification.id} for deleted submission ${data.submissionId}`);
          }
        }
      } catch (error) {
        // If data parsing fails, keep the notification (might not be submission-related)
        console.warn(`Failed to parse notification data for notification ${notification.id}:`, error);
      }
    }
    
    if (isValid) {
      validNotifications.push(notification);
    }
  }

  // Check if there are more notifications
  const hasMore = validNotifications.length > query.limit;
  const notificationsList = hasMore ? validNotifications.slice(0, -1) : validNotifications;
  const nextCursor = hasMore ? notificationsList[notificationsList.length - 1]?.id : null;

  // Format response
  const formattedNotifications: NotificationDto[] = notificationsList.map(notification => ({
    id: notification.id,
    scope: notification.scope,
    vendorId: notification.vendor_id,
    type: notification.type,
    title: notification.title,
    message: notification.message,
    data: notification.data,
    createdAt: notification.created_at.toISOString(),
    isRead: notification.reads.length > 0,
  }));

  console.log('✅ Formatted notifications count:', formattedNotifications.length);
  console.log('� Read status summary:');
  const readCount = formattedNotifications.filter(n => n.isRead).length;
  const unreadCount = formattedNotifications.filter(n => !n.isRead).length;
  console.log(`   Read: ${readCount}, Unread: ${unreadCount}`);
  console.log('�📤 Returning response with hasMore:', hasMore, 'nextCursor:', nextCursor);

  // Cache the result with shorter TTL to ensure read status freshness
  await Cache.setJSON(
    cacheKey,
    {
      notifications: formattedNotifications,
      hasMore,
      nextCursor,
    },
    { namespace: CacheNamespaces.NOTIFICATIONS, ttl: 30 } // Shorter TTL for read status freshness
  );

  return apiSuccess({
    data: formattedNotifications,
    pagination: {
      nextCursor,
      hasMore,
    }
  });
}

export const GET = withErrorHandling(getNotifications);
export const OPTIONS = handleOptions;


=== FILE: src/app/api/vendor/dashboard/stats/route.ts ===
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";

export async function GET() {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user || session.user.role !== "VENDOR") {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const userId = session.user.id;

    // Get submission statistics for current vendor
    const stats = await prisma.submission.groupBy({
      by: ['approval_status'],
      where: { user_id: userId },
      _count: {
        approval_status: true
      }
    });

    // Get total count
    const totalCount = await prisma.submission.count({
      where: { user_id: userId }
    });

    // Format statistics
    const vendorStats = {
      totalSubmissions: totalCount,
      pendingSubmissions: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,
      approvedSubmissions: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,
      rejectedSubmissions: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,
      draftSubmissions: 0, // Assuming no draft status in current schema
      totalApproved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,
      totalPending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,
      totalRejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0
    };

    return NextResponse.json(vendorStats);

  } catch (error) {
    console.error("Vendor dashboard stats error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/vendor/dashboard-stats/route.ts ===
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";

export async function GET() {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user || session.user.role !== "VENDOR") {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const userId = session.user.id;

    // Get statistics for current vendor
    const [totalApproved, totalPending, totalRejected] = await Promise.all([
      prisma.submission.count({
        where: {
          user_id: userId,
          approval_status: "APPROVED"
        }
      }),
      prisma.submission.count({
        where: {
          user_id: userId,
          approval_status: "PENDING"
        }
      }),
      prisma.submission.count({
        where: {
          user_id: userId,
          approval_status: "REJECTED"
        }
      })
    ]);

    return NextResponse.json({
      totalApproved,
      totalPending,
      totalRejected
    });

  } catch (error) {
    console.error("Vendor dashboard stats error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/vendor/latest-submissions/route.ts ===
import { NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";

export async function GET() {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user || session.user.role !== "VENDOR") {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const userId = session.user.id;

    // Get latest 5 submissions for current vendor
    const submissions = await prisma.submission.findMany({
      where: {
        user_id: userId
      },
      select: {
        id: true,
        job_description: true,
        work_location: true,
        approval_status: true,
        simlok_number: true,
        created_at: true,
        vendor_name: true,
        officer_name: true,
        based_on: true,
        working_hours: true,
        implementation: true,
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true
          }
        }
      },
      orderBy: {
        created_at: "desc"
      },
      take: 5
    });

    return NextResponse.json({
      submissions
    });

  } catch (error) {
    console.error("Vendor latest submissions error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/vendor/simloks/[id]/workers/route.ts ===
/**
 * GET /api/vendor/simloks/[id]/workers
 * Get workers for a vendor's own submission
 */

import { NextRequest } from 'next/server';
import { prisma } from '@/lib/singletons';
import { 
  withErrorHandling, 
  apiSuccess, 
  apiError,
  getAuthenticatedSession,
  handleOptions,
} from '@/lib/api-utils';

async function getVendorSubmissionWorkers(
  _req: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  const { id } = await params;
  
  // Check authentication
  const { session, error: authError } = await getAuthenticatedSession();
  if (authError) return authError;

  // Only vendors can access this endpoint
  if (session.user.role !== 'VENDOR') {
    return apiError('Access denied', 403);
  }

  // Check if submission belongs to this vendor
  const submission = await prisma.submission.findFirst({
    where: {
      id: id,
      user_id: session.user.id,
    },
  });

  if (!submission) {
    return apiError('Submission not found', 404);
  }

  // Get workers
  const workers = await prisma.workerList.findMany({
    where: {
      submission_id: id,
    },
    orderBy: {
      created_at: 'asc',
    },
  });

  return apiSuccess({ workers });
}

export const GET = withErrorHandling(getVendorSubmissionWorkers);
export const OPTIONS = handleOptions;

=== FILE: src/app/api/vendor/submissions/route.ts ===
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user || session.user.role !== "VENDOR") {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const userId = session.user.id;
    const { searchParams } = new URL(request.url);
    
    // Extract query parameters
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const sortBy = searchParams.get('sortBy') || 'created_at';
    const sortOrder = searchParams.get('sortOrder') || 'desc';
    const search = searchParams.get('search');
    const status = searchParams.get('status');

    // Build where clause
    const where: any = {
      user_id: userId
    };

    if (search) {
      where.OR = [
        { job_description: { contains: search } },
        { work_location: { contains: search } },
        { vendor_name: { contains: search } },
        { officer_name: { contains: search } },
        { simlok_number: { contains: search } }
      ];
    }

    if (status) {
      where.approval_status = status;
    }

    // Get total count for pagination
    const totalCount = await prisma.submission.count({ where });
    const totalPages = Math.ceil(totalCount / limit);
    const skip = (page - 1) * limit;

    // Get submissions without updated_at field
    const submissions = await prisma.submission.findMany({
      where,
      select: {
        id: true,
        job_description: true,
        work_location: true,
        approval_status: true,
        simlok_number: true,
        simlok_date: true,
        created_at: true,
        vendor_name: true,
        officer_name: true,
        based_on: true,
        working_hours: true,
        implementation: true,
        work_facilities: true,
        worker_names: true,
        content: true,
        notes: true,
        simja_number: true,
        simja_date: true,
        sika_number: true,
        sika_date: true,
        other_notes: true,
        sika_document_upload: true,
        simja_document_upload: true,
        qrcode: true,
        signer_position: true,
        signer_name: true,
        user: {
          select: {
            id: true,
            officer_name: true,
            email: true,
            vendor_name: true
          }
        },
        approved_by_user: {
          select: {
            id: true,
            officer_name: true,
            email: true
          }
        }
      },
      orderBy: {
        [sortBy]: sortOrder as 'asc' | 'desc'
      },
      skip,
      take: limit
    });

    // Get statistics
    const stats = await prisma.submission.groupBy({
      by: ['approval_status'],
      where: { user_id: userId },
      _count: {
        approval_status: true
      }
    });

    const statistics = {
      total: totalCount,
      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,
      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,
      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0
    };

    return NextResponse.json({
      submissions,
      pagination: {
        page,
        limit,
        total: totalCount,
        pages: totalPages
      },
      statistics
    });

  } catch (error) {
    console.error("Vendor submissions error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/vendor/submissions/stats/route.ts ===
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth/next";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/singletons";

export async function GET(_request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user || session.user.role !== "VENDOR") {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const userId = session.user.id;

    // Get statistics for all submissions (no filters)
    const totalCount = await prisma.submission.count({ 
      where: { user_id: userId } 
    });

    const stats = await prisma.submission.groupBy({
      by: ['approval_status'],
      where: { user_id: userId },
      _count: {
        approval_status: true
      }
    });

    const statistics = {
      total: totalCount,
      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,
      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,
      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0
    };

    return NextResponse.json({
      statistics
    });

  } catch (error) {
    console.error("Vendor statistics error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}


=== FILE: src/app/api/verifier/stats/route.ts ===
import { NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/prisma';

export async function GET() {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    if (session.user.role !== 'VERIFIER') {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    // Get today's date range
    const today = new Date();
    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);

    // Fetch stats in parallel
    const [
      totalScans,
      todayScans,
      totalSubmissions,
      approvedSubmissions,
      pendingSubmissions,
      rejectedSubmissions
    ] = await Promise.all([
      // Total scans by this verifier
      prisma.qrScan.count({
        where: {
          scanned_by: session.user.id
        }
      }),
      
      // Today's scans by this verifier
      prisma.qrScan.count({
        where: {
          scanned_by: session.user.id,
          scanned_at: {
            gte: todayStart,
            lt: todayEnd
          }
        }
      }),
      
      // Total submissions
      prisma.submission.count(),
      
      // Approved submissions
      prisma.submission.count({
        where: {
          approval_status: 'APPROVED'
        }
      }),
      
      // Pending submissions
      prisma.submission.count({
        where: {
          approval_status: 'PENDING'
        }
      }),
      
      // Rejected submissions
      prisma.submission.count({
        where: {
          approval_status: 'REJECTED'
        }
      })
    ]);

    const stats = {
      totalScans,
      todayScans,
      totalSubmissions,
      approvedSubmissions,
      pendingSubmissions,
      rejectedSubmissions
    };

    return NextResponse.json(stats);

  } catch (error) {
    console.error('Error fetching verifier stats:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

=== FILE: src/app/api/verifier/submissions/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { db } from '@/lib/db';

export async function GET(request: NextRequest) {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session || session.user.role !== 'VERIFIER') {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const url = new URL(request.url);
    const limit = parseInt(url.searchParams.get('limit') || '20');
    const offset = parseInt(url.searchParams.get('offset') || '0');
    const status = url.searchParams.get('status') || 'ALL';
    const dateRange = url.searchParams.get('dateRange') || 'ALL';
    const search = url.searchParams.get('search') || '';

    // Build where conditions
    const whereConditions: any = {};

    // Status filter
    if (status !== 'ALL') {
      whereConditions.approval_status = status;
    }

    // Date range filter
    if (dateRange !== 'ALL') {
      const now = new Date();
      let startDate: Date;
      
      switch (dateRange) {
        case 'TODAY':
          startDate = new Date(now);
          startDate.setHours(0, 0, 0, 0);
          whereConditions.created_at = {
            gte: startDate
          };
          break;
        case 'WEEK':
          startDate = new Date(now);
          startDate.setDate(now.getDate() - 7);
          whereConditions.created_at = {
            gte: startDate
          };
          break;
        case 'MONTH':
          startDate = new Date(now);
          startDate.setDate(now.getDate() - 30);
          whereConditions.created_at = {
            gte: startDate
          };
          break;
      }
    }

    // Search filter
    if (search.trim()) {
      whereConditions.OR = [
        {
          simlok_number: {
            contains: search
          }
        },
        {
          vendor_name: {
            contains: search
          }
        },
        {
          officer_name: {
            contains: search
          }
        },
        {
          job_description: {
            contains: search
          }
        },
        {
          work_location: {
            contains: search
          }
        }
      ];
    }

    // Fetch submissions with pagination
    const [submissions, totalCount] = await Promise.all([
      db.submission.findMany({
        where: whereConditions,
        take: limit,
        skip: offset,
        orderBy: [
          {
            approval_status: 'asc' // Show pending first
          },
          {
            created_at: 'desc'
          }
        ],
        select: {
          id: true,
          vendor_name: true,
          officer_name: true,
          job_description: true,
          work_location: true,
          implementation: true,
          approval_status: true,
          simlok_number: true,
          simlok_date: true,
          created_at: true
        }
      }),
      db.submission.count({
        where: whereConditions
      })
    ]);

    return NextResponse.json({
      submissions,
      pagination: {
        total: totalCount,
        limit,
        offset,
        hasMore: offset + limit < totalCount
      },
      filters: {
        status,
        dateRange,
        search
      }
    });

  } catch (error) {
    console.error('Error fetching submissions:', error);
    return NextResponse.json(
      { error: 'Failed to fetch submissions' },
      { status: 500 }
    );
  }
}


=== FILE: src/app/globals.css ===
@import "tailwindcss";
@import "react-datepicker/dist/react-datepicker.css";
@import "../styles/datepicker.css";
@import "../styles/auth.css";


@custom-variant dark (&:is(.dark *));

@theme {
  --font-*: initial;
  --font-outfit: Outfit, sans-serif;

  --breakpoint-*: initial;
  --breakpoint-2xsm: 375px;
  --breakpoint-xsm: 425px;
  --breakpoint-3xl: 2000px;
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;

  --text-title-2xl: 72px;
  --text-title-2xl--line-height: 90px;
  --text-title-xl: 60px;
  --text-title-xl--line-height: 72px;
  --text-title-lg: 48px;
  --text-title-lg--line-height: 60px;
  --text-title-md: 36px;
  --text-title-md--line-height: 44px;
  --text-title-sm: 30px;
  --text-title-sm--line-height: 38px;
  --text-theme-xl: 20px;
  --text-theme-xl--line-height: 30px;
  --text-theme-sm: 14px;
  --text-theme-sm--line-height: 20px;
  --text-theme-xs: 12px;
  --text-theme-xs--line-height: 18px;

  --color-current: currentColor;
  --color-transparent: transparent;
  --color-white: #ffffff;
  --color-black: #101828;

  --color-brand-25: #f2f7ff;
  --color-brand-50: #ecf3ff;
  --color-brand-100: #dde9ff;
  --color-brand-200: #c2d6ff;
  --color-brand-300: #9cb9ff;
  --color-brand-400: #7592ff;
  --color-brand-500: #465fff;
  --color-brand-600: #3641f5;
  --color-brand-700: #2a31d8;
  --color-brand-800: #252dae;
  --color-brand-900: #262e89;
  --color-brand-950: #161950;

  --color-blue-light-25: #f5fbff;
  --color-blue-light-50: #f0f9ff;
  --color-blue-light-100: #e0f2fe;
  --color-blue-light-200: #b9e6fe;
  --color-blue-light-300: #7cd4fd;
  --color-blue-light-400: #36bffa;
  --color-blue-light-500: #0ba5ec;
  --color-blue-light-600: #0086c9;
  --color-blue-light-700: #026aa2;
  --color-blue-light-800: #065986;
  --color-blue-light-900: #0b4a6f;
  --color-blue-light-950: #062c41;

  --color-gray-25: #fcfcfd;
  --color-gray-50: #f9fafb;
  --color-gray-100: #f2f4f7;
  --color-gray-200: #e4e7ec;
  --color-gray-300: #d0d5dd;
  --color-gray-400: #98a2b3;
  --color-gray-500: #667085;
  --color-gray-600: #475467;
  --color-gray-700: #344054;
  --color-gray-800: #1d2939;
  --color-gray-900: #101828;
  --color-gray-950: #0c111d;
  --color-gray-dark: #1a2231;

  --color-orange-25: #fffaf5;
  --color-orange-50: #fff6ed;
  --color-orange-100: #ffead5;
  --color-orange-200: #fddcab;
  --color-orange-300: #feb273;
  --color-orange-400: #fd853a;
  --color-orange-500: #fb6514;
  --color-orange-600: #ec4a0a;
  --color-orange-700: #c4320a;
  --color-orange-800: #9c2a10;
  --color-orange-900: #7e2410;
  --color-orange-950: #511c10;

  --color-success-25: #f6fef9;
  --color-success-50: #ecfdf3;
  --color-success-100: #d1fadf;
  --color-success-200: #a6f4c5;
  --color-success-300: #6ce9a6;
  --color-success-400: #32d583;
  --color-success-500: #12b76a;
  --color-success-600: #039855;
  --color-success-700: #027a48;
  --color-success-800: #05603a;
  --color-success-900: #054f31;
  --color-success-950: #053321;

  --color-error-25: #fffbfa;
  --color-error-50: #fef3f2;
  --color-error-100: #fee4e2;
  --color-error-200: #fecdca;
  --color-error-300: #fda29b;
  --color-error-400: #f97066;
  --color-error-500: #f04438;
  --color-error-600: #d92d20;
  --color-error-700: #b42318;
  --color-error-800: #912018;
  --color-error-900: #7a271a;
  --color-error-950: #55160c;

  --color-warning-25: #fffcf5;
  --color-warning-50: #fffaeb;
  --color-warning-100: #fef0c7;
  --color-warning-200: #fedf89;
  --color-warning-300: #fec84b;
  --color-warning-400: #fdb022;
  --color-warning-500: #f79009;
  --color-warning-600: #dc6803;
  --color-warning-700: #b54708;
  --color-warning-800: #93370d;
  --color-warning-900: #7a2e0e;
  --color-warning-950: #4e1d09;

  --color-theme-pink-500: #ee46bc;

  --color-theme-purple-500: #7a5af8;

  --shadow-theme-md:
    0px 4px 8px -2px rgba(16, 24, 40, 0.1),
    0px 2px 4px -2px rgba(16, 24, 40, 0.06);
  --shadow-theme-lg:
    0px 12px 16px -4px rgba(16, 24, 40, 0.08),
    0px 4px 6px -2px rgba(16, 24, 40, 0.03);
  --shadow-theme-sm:
    0px 1px 3px 0px rgba(16, 24, 40, 0.1),
    0px 1px 2px 0px rgba(16, 24, 40, 0.06);
  --shadow-theme-xs: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
  --shadow-theme-xl:
    0px 20px 24px -4px rgba(16, 24, 40, 0.08),
    0px 8px 8px -4px rgba(16, 24, 40, 0.03);
  --shadow-datepicker: -5px 0 0 #262d3c, 5px 0 0 #262d3c;
  --shadow-focus-ring: 0px 0px 0px 4px rgba(70, 95, 255, 0.12);
  --shadow-slider-navigation:
    0px 1px 2px 0px rgba(16, 24, 40, 0.1), 0px 1px 3px 0px rgba(16, 24, 40, 0.1);
  --shadow-tooltip:
    0px 4px 6px -2px rgba(16, 24, 40, 0.05),
    -8px 0px 20px 8px rgba(16, 24, 40, 0.05);

  --drop-shadow-4xl:
    0 35px 35px rgba(0, 0, 0, 0.25), 0 45px 65px rgba(0, 0, 0, 0.15);

  --z-index-1: 1;
  --z-index-9: 9;
  --z-index-99: 99;
  --z-index-999: 999;
  --z-index-9999: 9999;
  --z-index-99999: 99999;
  --z-index-999999: 999999;
}

/*
  The default border color has changed to `currentColor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentColor);
  }
  button:not(:disabled),
  [role="button"]:not(:disabled) {
    cursor: pointer;
  }
  body {
    @apply relative font-normal font-outfit z-1 bg-gray-50;
  }
}

@utility menu-item {
  @apply relative flex items-center w-full gap-3 px-3 py-2 font-medium rounded-lg text-theme-sm;
}

@utility menu-item-active {
  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;
}

@utility menu-item-inactive {
  @apply text-gray-700 hover:bg-gray-100 group-hover:text-gray-700 dark:text-gray-300 dark:hover:bg-white/5 dark:hover:text-gray-300;
}

@utility menu-item-icon {
  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400;
}

@utility menu-item-icon-active {
  @apply text-brand-500 dark:text-brand-400;
}

@utility menu-item-icon-inactive {
  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;
}

@utility menu-item-arrow {
  @apply relative;
}

@utility menu-item-arrow-active {
  @apply rotate-180 text-brand-500 dark:text-brand-400;
}

@utility menu-item-arrow-inactive {
  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;
}

@utility menu-dropdown-item {
  @apply relative flex items-center gap-3 rounded-lg px-3 py-2.5 text-theme-sm font-medium;
}

@utility menu-dropdown-item-active {
  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;
}

@utility menu-dropdown-item-inactive {
  @apply text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-white/5;
}

@utility menu-dropdown-badge {
  @apply block rounded-full px-2.5 py-0.5 text-xs font-medium uppercase text-brand-500 dark:text-brand-400;
}

@utility menu-dropdown-badge-active {
  @apply bg-brand-100 dark:bg-brand-500/20;
}

@utility menu-dropdown-badge-inactive {
  @apply bg-brand-50 group-hover:bg-brand-100 dark:bg-brand-500/15 dark:group-hover:bg-brand-500/20;
}

@utility no-scrollbar {
  /* Chrome, Safari and Opera */
  &::-webkit-scrollbar {
    display: none;
  }
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}

@utility custom-scrollbar {
  &::-webkit-scrollbar {
    @apply size-1.5;
  }

  &::-webkit-scrollbar-track {
    @apply rounded-full;
  }

  &::-webkit-scrollbar-thumb {
    @apply bg-gray-200 rounded-full dark:bg-gray-700;
  }
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: #344054;
}



@layer utilities {
  /* For Remove Date Icon */
  input[type="date"]::-webkit-inner-spin-button,
  input[type="time"]::-webkit-inner-spin-button,
  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="time"]::-webkit-calendar-picker-indicator {
    display: none;
    -webkit-appearance: none;
  }
}

/* third-party libraries CSS */
.apexcharts-legend-text {
  @apply !text-gray-700 dark:!text-gray-400;
}

.apexcharts-text {
  @apply !fill-gray-700 dark:!fill-gray-400;
}

.apexcharts-tooltip.apexcharts-theme-light {
  @apply gap-1 !rounded-lg !border-gray-200 p-3 !shadow-theme-sm dark:!border-gray-800 dark:!bg-gray-900;
}

.apexcharts-legend-text {
  @apply pl-5! !text-gray-700 dark:!text-gray-400;
}
.apexcharts-tooltip-series-group {
  @apply !p-0;
}
.apexcharts-tooltip-y-group {
  @apply !p-0;
}
.apexcharts-tooltip-title {
  @apply !mb-0 !border-b-0 !bg-transparent !p-0 !text-[10px] !leading-4 !text-gray-800 dark:!text-white/90;
}
.apexcharts-tooltip-text {
  @apply !text-theme-xs !text-gray-700 dark:!text-white/90;
}
.apexcharts-tooltip-text-y-value {
  @apply !font-medium;
}

.apexcharts-gridline {
  @apply !stroke-gray-100 dark:!stroke-gray-800;
}

.flatpickr-wrapper {
  @apply w-full;
}
.flatpickr-calendar {
  @apply mt-2 !bg-white !rounded-xl !p-5 !border !border-gray-200 dark:!border-gray-800 !text-gray-500 dark:!bg-gray-dark dark:!text-gray-400 dark:!shadow-theme-xl 2xsm:!w-auto;
}

.flatpickr-months .flatpickr-prev-month:hover svg,
.flatpickr-months .flatpickr-next-month:hover svg {
  @apply stroke-brand-500;
}
.flatpickr-calendar.arrowTop:before,
.flatpickr-calendar.arrowTop:after {
  @apply hidden;
}

.flatpickr-current-month {
  @apply !p-0;
}
.flatpickr-current-month .cur-month,
.flatpickr-current-month input.cur-year {
  @apply !h-auto !pt-0 !text-lg !font-medium !text-gray-800 dark:!text-white/90;
}

.flatpickr-prev-month,
.flatpickr-next-month {
  @apply !p-0;
}

.flatpickr-weekdays {
  @apply h-auto mt-6 mb-4 !bg-transparent;
}

.flatpickr-weekday {
  @apply !text-theme-sm !font-medium !text-gray-500 dark:!text-gray-400 !bg-transparent;
}

.flatpickr-day {
  @apply !flex !items-center !text-theme-sm !font-medium !text-gray-800 dark:!text-white/90 dark:hover:!border-gray-300 dark:hover:!bg-gray-900;
}
.flatpickr-day.nextMonthDay,
.flatpickr-day.prevMonthDay {
  @apply !text-gray-400;
}

.flatpickr-months > .flatpickr-month {
  background: none !important;
}
.flatpickr-month .flatpickr-current-month .flatpickr-monthDropdown-months {
  background: none !important;
  appearance: none;
  background-image: none !important;
  font-weight: 500;
}
.flatpickr-month
.flatpickr-current-month
.flatpickr-monthDropdown-months:focus {
  outline: none !important;
  border: 0 !important;
}
.flatpickr-months .flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month {
  @apply !top-7 dark:!fill-white dark:!text-white !bg-transparent;
}
.flatpickr-months .flatpickr-prev-month.flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month.flatpickr-prev-month {
  @apply !left-7;
}
.flatpickr-months .flatpickr-prev-month.flatpickr-next-month,
.flatpickr-months .flatpickr-next-month.flatpickr-next-month {
  @apply !right-7;
}
.flatpickr-days {
  @apply !border-0;
}
span.flatpickr-weekday,
.flatpickr-months .flatpickr-month {
  @apply dark:!fill-white dark:!text-white !bg-none;
}
.flatpickr-innerContainer {
  @apply !border-b-0;
}
.flatpickr-months .flatpickr-month {
  @apply !bg-none;
}
.flatpickr-day.inRange {
  box-shadow: -5px 0 0 #f9fafb, 5px 0 0 #f9fafb !important;
  @apply dark:!shadow-datepicker;
}
.flatpickr-day.inRange,
.flatpickr-day.prevMonthDay.inRange,
.flatpickr-day.nextMonthDay.inRange,
.flatpickr-day.today.inRange,
.flatpickr-day.prevMonthDay.today.inRange,
.flatpickr-day.nextMonthDay.today.inRange,
.flatpickr-day:hover,
.flatpickr-day.prevMonthDay:hover,
.flatpickr-day.nextMonthDay:hover,
.flatpickr-day:focus,
.flatpickr-day.prevMonthDay:focus,
.flatpickr-day.nextMonthDay:focus {
  @apply !border-gray-50 !bg-gray-50 dark:!border-0 dark:!border-white/5 dark:!bg-white/5;
}
.flatpickr-day.selected,
.flatpickr-day.startRange,
.flatpickr-day.selected,
.flatpickr-day.endRange {
  @apply !text-white dark:!text-white;
}
.flatpickr-day.selected,
.flatpickr-day.startRange,
.flatpickr-day.endRange,
.flatpickr-day.selected.inRange,
.flatpickr-day.startRange.inRange,
.flatpickr-day.endRange.inRange,
.flatpickr-day.selected:focus,
.flatpickr-day.startRange:focus,
.flatpickr-day.endRange:focus,
.flatpickr-day.selected:hover,
.flatpickr-day.startRange:hover,
.flatpickr-day.endRange:hover,
.flatpickr-day.selected.prevMonthDay,
.flatpickr-day.startRange.prevMonthDay,
.flatpickr-day.endRange.prevMonthDay,
.flatpickr-day.selected.nextMonthDay,
.flatpickr-day.startRange.nextMonthDay,
.flatpickr-day.endRange.nextMonthDay {
  background: #465fff;
  @apply !border-brand-500 !bg-brand-500 hover:!border-brand-50 hover:!bg-brand-500;
}
.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n + 1)),
.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n + 1)) {
  box-shadow: -10px 0 0 #465fff;
}

.flatpickr-months .flatpickr-prev-month svg,
.flatpickr-months .flatpickr-next-month svg,
.flatpickr-months .flatpickr-prev-month,
.flatpickr-months .flatpickr-next-month {
  @apply hover:!fill-none;
}
.flatpickr-months .flatpickr-prev-month:hover svg,
.flatpickr-months .flatpickr-next-month:hover svg {
  fill: none !important;
}

.flatpickr-calendar.static {
  @apply right-0;
}

.fc .fc-view-harness {
  @apply max-w-full overflow-x-auto custom-scrollbar;
}
.fc-dayGridMonth-view.fc-view.fc-daygrid {
  @apply min-w-[718px];
}
.fc .fc-scrollgrid-section > * {
  border-right-width: 0;
  border-bottom-width: 0;
}
.fc .fc-scrollgrid {
  border-left-width: 0;
}
.fc .fc-toolbar.fc-header-toolbar {
  @apply flex-col gap-4 px-6 pt-6 sm:flex-row;
}
.fc-button-group {
  @apply gap-2;
}
.fc-button-group .fc-button {
  @apply flex h-10 w-10 items-center justify-center !rounded-lg border border-gray-200 bg-transparent hover:border-gray-200 hover:bg-gray-50 focus:shadow-none active:!border-gray-200 active:!bg-transparent active:!shadow-none dark:border-gray-800 dark:hover:border-gray-800 dark:hover:bg-gray-900 dark:active:border-gray-800!;
}

.fc-button-group .fc-button.fc-prev-button:before {
  @apply inline-block mt-1;
  content: url("data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
}
.fc-button-group .fc-button.fc-next-button:before {
  @apply inline-block mt-1;
  content: url("data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
}
.dark .fc-button-group .fc-button.fc-prev-button:before {
  content: url("data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
}
.dark .fc-button-group .fc-button.fc-next-button:before {
  content: url("data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A");
}
.fc-button-group .fc-button .fc-icon {
  @apply hidden;
}
.fc-addEventButton-button {
  @apply !rounded-lg !border-0 !bg-brand-500 !px-4 !py-2.5 !text-sm !font-medium hover:!bg-brand-600 focus:!shadow-none;
}
.fc-toolbar-title {
  @apply !text-lg !font-medium text-gray-800 dark:text-white/90;
}
.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child {
  @apply rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900;
}
.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child .fc-button {
  @apply !h-auto !w-auto rounded-md !border-0 bg-transparent !px-5 !py-2 text-sm font-medium text-gray-500 hover:text-gray-700 focus:shadow-none! dark:text-gray-400;
}
.fc-header-toolbar.fc-toolbar
  .fc-toolbar-chunk:last-child
  .fc-button.fc-button-active {
  @apply text-gray-900 bg-white dark:bg-gray-800 dark:text-white;
}
.fc-theme-standard th {
  @apply !border-x-0 border-t !border-gray-200 bg-gray-50 !text-left dark:!border-gray-800 dark:bg-gray-900;
}
.fc-theme-standard td,
.fc-theme-standard .fc-scrollgrid {
  @apply !border-gray-200 dark:!border-gray-800;
}
.fc .fc-col-header-cell-cushion {
  @apply !px-5 !py-4 text-sm font-medium uppercase text-gray-400;
}
.fc .fc-daygrid-day.fc-day-today {
  @apply bg-transparent;
}
.fc .fc-daygrid-day {
  @apply p-2;
}
.fc .fc-daygrid-day.fc-day-today .fc-scrollgrid-sync-inner {
  @apply rounded-sm bg-gray-100 dark:bg-white/[0.03];
}
.fc .fc-daygrid-day-number {
  @apply !p-3 text-sm font-medium text-gray-700 dark:text-gray-400;
}
.fc .fc-daygrid-day-top {
  @apply !flex-row;
}
.fc .fc-day-other .fc-daygrid-day-top {
  opacity: 1;
}
.fc .fc-day-other .fc-daygrid-day-top .fc-daygrid-day-number {
  @apply text-gray-400 dark:text-white/30;
}
.event-fc-color {
  @apply rounded-lg py-2.5 pl-4 pr-3;
}
.event-fc-color .fc-event-title {
  @apply p-0 text-sm font-normal text-gray-700;
}
.fc-daygrid-event-dot {
  @apply w-1 h-5 ml-0 mr-3 border-none rounded-sm;
}
.fc-event {
  @apply focus:shadow-none;
}
.fc-daygrid-event.fc-event-start {
  @apply !ml-3;
}
.event-fc-color.fc-bg-success {
  @apply border-success-50 bg-success-50;
}
.event-fc-color.fc-bg-danger {
  @apply border-error-50 bg-error-50;
}
.event-fc-color.fc-bg-primary {
  @apply border-brand-50 bg-brand-50;
}
.event-fc-color.fc-bg-warning {
  @apply border-orange-50 bg-orange-50;
}
.event-fc-color.fc-bg-success .fc-daygrid-event-dot {
  @apply bg-success-500;
}
.event-fc-color.fc-bg-danger .fc-daygrid-event-dot {
  @apply bg-error-500;
}
.event-fc-color.fc-bg-primary .fc-daygrid-event-dot {
  @apply bg-brand-500;
}
.event-fc-color.fc-bg-warning .fc-daygrid-event-dot {
  @apply bg-orange-500;
}
.fc-direction-ltr .fc-timegrid-slot-label-frame {
  @apply px-3 py-1.5 text-left text-sm font-medium text-gray-500 dark:text-gray-400;
}
.fc .fc-timegrid-axis-cushion {
  @apply text-sm font-medium text-gray-500 dark:text-gray-400;
}
.custom-calendar .fc-h-event {
  background-color: transparent;
  border: none;
  color: black;
}
.fc.fc-media-screen {
  @apply min-h-screen;
}

.input-date-icon::-webkit-inner-spin-button,
.input-date-icon::-webkit-calendar-picker-indicator {
  opacity: 0;
  -webkit-appearance: none;
}

.stocks-slider-outer .swiper-button-next:after,
.stocks-slider-outer .swiper-button-prev:after {
  @apply hidden;
}

.stocks-slider-outer .swiper-button-next,
.stocks-slider-outer .swiper-button-prev {
  @apply !static mt-0 h-8 w-9 rounded-full border dark:hover:bg-white/[0.05] border-gray-200 !text-gray-700 transition hover:bg-gray-100 dark:border-white/[0.03] dark:bg-gray-800 dark:!text-gray-400  dark:hover:!text-white/90;
}

.stocks-slider-outer .swiper-button-next.swiper-button-disabled,
.stocks-slider-outer .swiper-button-prev.swiper-button-disabled {
  @apply bg-white opacity-50 dark:bg-gray-900;
}

.stocks-slider-outer .swiper-button-next svg,
.stocks-slider-outer .swiper-button-prev svg {
  @apply !h-auto !w-auto;
}

.swiper-button-prev svg,
.swiper-button-next svg {
  @apply !h-auto !w-auto;
}

.carouselTwo .swiper-button-next:after,
.carouselTwo .swiper-button-prev:after,
.carouselFour .swiper-button-next:after,
.carouselFour .swiper-button-prev:after {
  @apply hidden;
}
.carouselTwo .swiper-button-next.swiper-button-disabled,
.carouselTwo .swiper-button-prev.swiper-button-disabled,
.carouselFour .swiper-button-next.swiper-button-disabled,
.carouselFour .swiper-button-prev.swiper-button-disabled {
  @apply bg-white/60 !opacity-100;
}
.carouselTwo .swiper-button-next,
.carouselTwo .swiper-button-prev,
.carouselFour .swiper-button-next,
.carouselFour .swiper-button-prev {
  @apply h-10 w-10 rounded-full border-[0.5px] border-white/10 bg-white/90 !text-gray-700 shadow-slider-navigation backdrop-blur-[10px];
}

.carouselTwo .swiper-button-prev,
.carouselFour .swiper-button-prev {
  @apply !left-3 sm:!left-4;
}

.carouselTwo .swiper-button-next,
.carouselFour .swiper-button-next {
  @apply !right-3 sm:!right-4;
}

.carouselThree .swiper-pagination,
.carouselFour .swiper-pagination {
  @apply !bottom-3 !left-1/2 inline-flex !w-auto -translate-x-1/2 items-center gap-1.5 rounded-[40px] border-[0.5px] border-white/10 bg-white/60 px-2 py-1.5 shadow-slider-navigation backdrop-blur-[10px] sm:!bottom-5;
}

.carouselThree .swiper-pagination-bullet,
.carouselFour .swiper-pagination-bullet {
  @apply !m-0 h-2.5 w-2.5 bg-white opacity-100 shadow-theme-xs duration-200 ease-in-out;
}

.carouselThree .swiper-pagination-bullet-active,
.carouselFour .swiper-pagination-bullet-active {
  @apply w-6.5 rounded-xl;
}

.jvectormap-container {
  @apply !bg-gray-50 dark:!bg-gray-900;
}
.jvectormap-region.jvectormap-element {
  @apply !fill-gray-300 hover:!fill-brand-500 dark:!fill-gray-700 dark:hover:!fill-brand-500;
}
.jvectormap-marker.jvectormap-element {
  @apply !stroke-gray-200 dark:!stroke-gray-800;
}
.jvectormap-tip {
  @apply !bg-brand-500 !border-none !px-2 !py-1;
}
.jvectormap-zoomin,
.jvectormap-zoomout {
  @apply !hidden;
}

.form-check-input:checked ~ span {
  @apply border-[6px] border-brand-500 bg-brand-500 dark:border-brand-500;
}

.taskCheckbox:checked ~ .box span {
  @apply opacity-100 bg-brand-500;
}
.taskCheckbox:checked ~ p {
  @apply text-gray-400 line-through;
}
.taskCheckbox:checked ~ .box {
  @apply border-brand-500 bg-brand-500 dark:border-brand-500;
}

.task {
  transition: all 0.2s ease; /* Smooth transition for visual effects */
}

.task {
  border-radius: 0.75rem;
  box-shadow: 0 1px 3px 0 rgba(16, 24, 40, 0.1),
    0 1px 2px 0 rgba(16, 24, 40, 0.06);
  opacity: 0.8;
  cursor: grabbing; /* Changes the cursor to indicate dragging */
}

/* React PDF Styles - Force Light Theme for PDF Viewer */
.react-pdf__Document {
  @apply bg-white;
}

.react-pdf__Page {
  @apply bg-white border border-gray-200 shadow-sm;
}

.react-pdf__Page__canvas {
  @apply bg-white;
  /* Force white background to override any dark theme interference */
  background-color: white !important;
  color: black !important;
}

.react-pdf__Page__textContent {
  @apply bg-white;
  color: black !important;
}

.react-pdf__Page__annotations {
  @apply bg-white;
}

/* Ensure PDF viewer container always has white background */
.pdf-viewer-container {
  @apply bg-white;
  background-color: white !important;
  color: black !important;
}

/* Fallback for any PDF rendering issues */
.pdf-viewer-container * {
  color: black !important;
}


=== FILE: src/app/layout.tsx ===
// src/app/layout.tsx
import { Outfit } from "next/font/google";
import "./globals.css";
import AppProviders from "@/providers/AppProvider"; // provider tunggal

const outfit = Outfit({ subsets: ["latin"] });

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={outfit.className} suppressHydrationWarning={true}>
        <AppProviders>{children}</AppProviders>
        <div id="datepicker-portal"></div>
      </body>
    </html>
  );
}

=== FILE: src/app/page.tsx ===
// app/page.tsx
import { redirect } from "next/navigation";
import { getServerSession } from "next-auth";   // ✅ helper Next-Auth
import { authOptions } from "@/lib/auth";  // ✅ kita sudah punya

export default async function Home() {
  const session = await getServerSession(authOptions); // ✅
  if (!session) redirect("/login");

  const { role, verified_at } = session.user;
  
  // Check if user needs verification (except super admin)
  if (role !== "SUPER_ADMIN" && !verified_at) {
    redirect("/verification-pending");
  }

  // Redirect to appropriate dashboard based on role
  if (role === "SUPER_ADMIN") {
    redirect("/super-admin");
  } else if (role === "APPROVER") {
    redirect("/approver");
  } else if (role === "REVIEWER") {
    redirect("/reviewer");
  } else if (role === "VENDOR") {
    redirect("/vendor");
  } else if (role === "VERIFIER") {
    redirect("/verifier");
  }

  // Fallback redirect to dashboard
  redirect("/dashboard");
}

=== FILE: src/app/socket-provider.tsx ===
'use client';

import { createContext, useContext } from 'react';

interface SocketContextType {
  socket: null;
  isConnected: false;
}

const SocketContext = createContext<SocketContextType>({
  socket: null,
  isConnected: false,
});

export const useSocket = () => {
  const context = useContext(SocketContext);
  if (!context) {
    throw new Error('useSocket must be used within SocketProvider');
  }
  return context;
};

export function SocketProvider({ children }: { children: React.ReactNode }) {
  // Socket.IO has been replaced with Server-Sent Events (SSE)
  // This provider is kept for backwards compatibility but does nothing
  console.log('SocketProvider: Socket.IO disabled, using Server-Sent Events instead');

  return (
    <SocketContext.Provider value={{ socket: null, isConnected: false }}>
      {children}
    </SocketContext.Provider>
  );
}

=== FILE: src/components/approver/ApproverDashboard.tsx ===
'use client';

import { useState, useEffect, useCallback } from 'react';
import {
  EyeIcon,
  ClipboardDocumentListIcon,
  CheckCircleIcon,
  ChartBarIcon,
  ClockIcon
} from "@heroicons/react/24/outline";

import Button from '@/components/ui/button/Button';
import Alert from '@/components/ui/alert/Alert';
import { useSocket } from '@/components/common/RealtimeUpdates';
import StatsCardsLoader from '@/components/ui/StatsCardsLoader';
import TableLoader from '@/components/ui/TableLoader';
import ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';
import Link from 'next/link';

interface Submission {
  id: string;
  approval_status: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  review_note?: string;
  final_note?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  updated_at?: string;
  reviewed_at?: string | null;
  approved_at?: string | null;
  reviewed_by?: string | null;
  approved_by?: string | null;
  workers: Array<{
    id: string;
    worker_name: string;
    worker_photo: string | null;
  }>;
}

interface DashboardStats {
  total: number;
  pending_approval_meets: number;
  pending_approval_not_meets: number;
  approved: number;
  rejected: number;
}

export default function ApproverDashboard() {
  const [submissions, setSubmissions] = useState<Submission[]>([]);
  const [stats, setStats] = useState<DashboardStats>({
    total: 0,
    pending_approval_meets: 0,
    pending_approval_not_meets: 0,
    approved: 0,
    rejected: 0,
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const fetchDashboardData = useCallback(async () => {
    try {
      setLoading(true);
      
      // Fetch stats dan 10 submission terakhir untuk dashboard
      const response = await fetch('/api/approver/simloks?page=1&limit=10&sortBy=reviewed_at&sortOrder=desc');
      if (!response.ok) {
        throw new Error('Gagal mengambil data dashboard');
      }
      
      const data = await response.json();
      setSubmissions(data.submissions);
      setStats(data.statistics);
      setError(null);
    } catch (err) {
      console.error('Error fetching dashboard data:', err);
      setError('Gagal memuat data dashboard');
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchDashboardData();
  }, [fetchDashboardData]);

  // Socket untuk real-time updates
  const socket = useSocket();
  
  useEffect(() => {
    if (!socket) return;

    // Join approver room
    socket.emit('join', { role: 'APPROVER' });

    const handleNotificationNew = (notification: any) => {
      console.log('New notification received for approver:', notification);
      if (notification.type === 'reviewed_submission_approval') {
        fetchDashboardData();
      }
    };

    const handleStatsUpdate = (statsUpdate: any) => {
      console.log('Stats update received for approver:', statsUpdate);
      if (statsUpdate.scope === 'approver') {
        fetchDashboardData();
      }
    };

    const handleSubmissionReviewed = () => {
      console.log('Submission reviewed - updating approver dashboard');
      fetchDashboardData();
    };

    // Listen for new notifications (including reviewed submissions)
    socket.on('notification:new', handleNotificationNew);
    // Listen for stats updates
    socket.on('stats:update', handleStatsUpdate);
    // Listen for specific submission review events
    socket.on('submission:reviewed', handleSubmissionReviewed);

    return () => {
      socket.off('notification:new', handleNotificationNew);
      socket.off('stats:update', handleStatsUpdate);
      socket.off('submission:reviewed', handleSubmissionReviewed);
    };
  }, [socket, fetchDashboardData]);

  const handleViewDetail = (submissionId: string) => {
    setSelectedSubmission(submissionId);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
    setSelectedSubmission(null);
  };

  const handleApprovalSubmitted = () => {
    fetchDashboardData();
    handleCloseModal();
  };

  const getStatusBadge = (status: string, type: 'review' | 'final') => {
    const baseClasses = "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";
    
    if (type === 'review') {
      switch (status) {
        case 'PENDING_REVIEW':
          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;
        case 'MEETS_REQUIREMENTS':
          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;
        case 'NOT_MEETS_REQUIREMENTS':
          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;
        default:
          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;
      }
    } else {
      switch (status) {
        case 'PENDING_APPROVAL':
          return <span className={`${baseClasses} bg-amber-100 text-amber-800`}>Menunggu Persetujuan</span>;
        case 'APPROVED':
          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;
        case 'REJECTED':
          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;
        default:
          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;
      }
    }
  };

  if (loading) {
    return (
      <div className="space-y-6">
        <StatsCardsLoader count={4} />
        <div className="bg-white shadow rounded-lg overflow-hidden">
          <TableLoader rows={5} columns={4} />
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Error Alert */}
      {error && (
        <Alert variant="error" title="Error" message={error} className="mb-6" />
      )}

      {/* Statistics Cards - Dashboard Design */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Total Pengajuan</h3>
              <p className="text-2xl font-bold text-blue-600 mt-1">{stats.total}</p>
            </div>
            <div className="p-3 bg-blue-100 rounded-full">
              <ClipboardDocumentListIcon className="w-6 h-6 text-blue-600" />
            </div>
          </div>
        </div>
        
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Menunggu Persetujuan</h3>
              <p className="text-2xl font-bold text-amber-600 mt-1">
                {stats.pending_approval_meets + stats.pending_approval_not_meets}
              </p>
            </div>
            <div className="p-3 bg-amber-100 rounded-full">
              <ClockIcon className="w-6 h-6 text-amber-600" />
            </div>
          </div>
        </div>
        
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Disetujui</h3>
              <p className="text-2xl font-bold text-green-600 mt-1">{stats.approved}</p>
            </div>
            <div className="p-3 bg-green-100 rounded-full">
              <CheckCircleIcon className="w-6 h-6 text-green-600" />
            </div>
          </div>
        </div>
        
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Ditolak</h3>
              <p className="text-2xl font-bold text-red-600 mt-1">{stats.rejected}</p>
            </div>
            <div className="p-3 bg-red-100 rounded-full">
              <ChartBarIcon className="w-6 h-6 text-red-600" />
            </div>
          </div>
        </div>
      </div>

      {/* Recent Submissions */}
      <div className="bg-white rounded-xl border shadow-sm">
        <div className="px-6 py-4 border-b border-gray-200">
          <div className="flex flex-col sm:flex-row sm:items-center justify-between">
            <div>
              <h2 className="text-lg font-semibold text-gray-900">Pengajuan Terbaru</h2>
              <p className="text-sm text-gray-500 mt-1">10 pengajuan terakhir untuk persetujuan</p>
            </div>
            <Link 
              href="/approver/submissions"
              className="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors"
            >
              Lihat Semua Pengajuan
            </Link>
          </div>
        </div>
        
        {submissions.length === 0 ? (
          <div className="text-center py-12">
            <ClipboardDocumentListIcon className="mx-auto h-12 w-12 text-gray-400" />
            <h3 className="mt-2 text-sm font-medium text-gray-900">Tidak ada pengajuan</h3>
            <p className="mt-1 text-sm text-gray-500">Belum ada pengajuan yang perlu disetujui</p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Vendor
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Deskripsi Pekerjaan
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status Review
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status Persetujuan
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Tanggal
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Aksi
                  </th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {submissions.map((submission) => (
                  <tr key={submission.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4 whitespace-nowrap">
                      <div className="text-sm font-medium text-gray-900">
                        {submission.vendor_name}
                      </div>
                      <div className="text-sm text-gray-500">
                        {submission.officer_name}
                      </div>
                    </td>
                    <td className="px-6 py-4">
                      <div className="text-sm text-gray-900 max-w-xs truncate">
                        {submission.job_description}
                      </div>
                      <div className="text-sm text-gray-500">
                        {submission.work_location}
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      {getStatusBadge(submission.review_status, 'review')}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      {getStatusBadge(submission.final_status, 'final')}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      {new Date(submission.created_at).toLocaleDateString('id-ID')}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <Button
                        onClick={() => handleViewDetail(submission.id)}
                        variant="ghost"
                        size="sm"
                        className="text-blue-600 hover:text-blue-700"
                      >
                        <EyeIcon className="h-4 w-4 mr-1" />
                        Detail
                      </Button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Modal */}
      {selectedSubmission && (
        <ApproverSubmissionDetailModal
          submissionId={selectedSubmission}
          isOpen={isModalOpen}
          onClose={handleCloseModal}
          onApprovalSubmitted={handleApprovalSubmitted}
        />
      )}
    </div>
  );
}

=== FILE: src/components/approver/ApproverScanHistoryContent.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import {
  MagnifyingGlassIcon,
  FunnelIcon,
  QrCodeIcon,
  UserIcon,
  DocumentTextIcon,
  ClockIcon,
  EyeIcon,
  ChevronLeftIcon,
  ChevronRightIcon
} from '@heroicons/react/24/outline';
import { formatDistanceToNow, format } from 'date-fns';
import { id } from 'date-fns/locale';
import Button from '@/components/ui/button/Button';
import { Badge } from '@/components/ui/Badge';
import Alert from '@/components/ui/alert/Alert';
import DatePicker from '@/components/form/DatePicker';
import SimlokPdfModal from '@/components/common/SimlokPdfModal';

interface QrScan {
  id: string;
  submission_id: string;
  scanned_by: string;
  scanned_at: string;
  scanner_name?: string;
  scan_location?: string;
  notes?: string;
  submission: {
    id: string;
    simlok_number: string;
    vendor_name: string;
    job_description: string;
    review_status: string;
    final_status: string;
  };
  user: {
    id: string;
    full_name: string;
    email: string;
    role: string;
  };
}

interface FilterState {
  dateFrom: string;
  dateTo: string;
  verifier: string;
  submissionId: string;
}

export default function ApproverScanHistoryContent() {
  const [scans, setScans] = useState<QrScan[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string>('');
  const [filters, setFilters] = useState<FilterState>({
    dateFrom: '',
    dateTo: '',
    verifier: '',
    submissionId: ''
  });
  const [showFilters, setShowFilters] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);
  const [showPdfModal, setShowPdfModal] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');

  const pageSize = 15;

  const fetchScanHistory = async () => {
    try {
      setLoading(true);
      setError('');

      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: pageSize.toString(),
        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),
        ...(filters.dateTo && { dateTo: filters.dateTo }),
        ...(filters.verifier && { verifier: filters.verifier }),
        ...(filters.submissionId && { submissionId: filters.submissionId }),
        ...(searchTerm && { search: searchTerm })
      });

      const response = await fetch(`/api/scan-history?${params}`);
      
      if (!response.ok) {
        throw new Error('Failed to fetch scan history');
      }

      const data = await response.json();
      setScans(data.scans || []);
      setTotalPages(Math.ceil((data.total || 0) / pageSize));
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    const timer = setTimeout(() => {
      fetchScanHistory();
    }, 300);

    return () => clearTimeout(timer);
  }, [currentPage, searchTerm]);

  const handleFilterSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setCurrentPage(1);
    fetchScanHistory();
  };

  const resetFilters = () => {
    setFilters({
      dateFrom: '',
      dateTo: '',
      verifier: '',
      submissionId: ''
    });
    setSearchTerm('');
    setCurrentPage(1);
    fetchScanHistory();
  };

  const getStatusBadge = (status: string, type: 'review' | 'final') => {
    if (type === 'review') {
      switch (status) {
        case 'PENDING_REVIEW':
          return <Badge variant="warning">Menunggu Review</Badge>;
        case 'MEETS_REQUIREMENTS':
          return <Badge variant="success">Memenuhi Syarat</Badge>;
        case 'NOT_MEETS_REQUIREMENTS':
          return <Badge variant="destructive">Tidak Memenuhi Syarat</Badge>;
        default:
          return null;
      }
    } else {
      switch (status) {
        case 'PENDING_APPROVAL':
          return <Badge variant="warning">Menunggu Persetujuan</Badge>;
        case 'APPROVED':
          return <Badge variant="success">Disetujui</Badge>;
        case 'REJECTED':
          return <Badge variant="destructive">Ditolak</Badge>;
        default:
          return null;
      }
    }
  };

  return (
    <div className="space-y-6">
      {/* Header with Search and Filters */}
      <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
          <div className="flex items-center space-x-3">
            <div className="p-2 bg-green-100 rounded-lg">
              <QrCodeIcon className="h-6 w-6 text-green-600" />
            </div>
            <div>
              <h2 className="text-xl font-semibold text-gray-900">Manajemen Riwayat Scan</h2>
              <p className="text-sm text-gray-500">Pantau aktivitas scan QR code oleh verifikator</p>
            </div>
          </div>

          <div className="flex items-center space-x-3">
            <Button
              onClick={() => setShowFilters(!showFilters)}
              variant={showFilters ? 'secondary' : 'primary'}
              className="flex items-center space-x-2"
            >
              <FunnelIcon className="h-4 w-4" />
              <span>Filter</span>
            </Button>
          </div>
        </div>

        {/* Search Bar */}
        <div className="relative mb-4">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            type="text"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            placeholder="Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator..."
            className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500"
          />
        </div>

        {/* Advanced Filters */}
        {showFilters && (
          <div className="border-t border-gray-200 pt-4">
            <form onSubmit={handleFilterSubmit} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Dari
                  </label>
                  <DatePicker
                    value={filters.dateFrom}
                    onChange={(value) => setFilters(prev => ({ ...prev, dateFrom: value }))}
                    placeholder="Pilih tanggal dari"
                    className="w-full"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Sampai
                  </label>
                  <DatePicker
                    value={filters.dateTo}
                    onChange={(value) => setFilters(prev => ({ ...prev, dateTo: value }))}
                    placeholder="Pilih tanggal sampai"
                    className="w-full"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Nama Verifikator
                  </label>
                  <input
                    type="text"
                    value={filters.verifier}
                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}
                    placeholder="Filter berdasarkan nama verifikator..."
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Nomor Simlok
                  </label>
                  <input
                    type="text"
                    value={filters.submissionId}
                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}
                    placeholder="Filter berdasarkan nomor simlok..."
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500"
                  />
                </div>
              </div>

              <div className="flex items-center space-x-3">
                <Button type="submit" className="flex items-center space-x-2">
                  <MagnifyingGlassIcon className="h-4 w-4" />
                  <span>Terapkan Filter</span>
                </Button>
                
                <Button 
                  type="button"
                  variant="secondary"
                  onClick={resetFilters}
                >
                  Reset
                </Button>
              </div>
            </form>
          </div>
        )}
      </div>

      {/* Error Alert */}
      {error && (
        <Alert variant="error" title="Error" message={error} />
      )}

      {/* Scan History Table */}
      <div className="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-8">
            <div className="animate-pulse space-y-4">
              {[...Array(5)].map((_, i) => (
                <div key={i} className="flex items-center space-x-4">
                  <div className="w-12 h-12 bg-gray-200 rounded-lg"></div>
                  <div className="flex-1">
                    <div className="h-4 bg-gray-200 rounded w-1/4 mb-2"></div>
                    <div className="h-3 bg-gray-200 rounded w-1/2"></div>
                  </div>
                  <div className="w-20 h-8 bg-gray-200 rounded"></div>
                </div>
              ))}
            </div>
          </div>
        ) : scans.length === 0 ? (
          <div className="p-12 text-center">
            <QrCodeIcon className="h-16 w-16 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No scan history found</h3>
            <p className="text-gray-500">No QR code scans match your current filters.</p>
          </div>
        ) : (
          <>
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Pengajuan
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Verifikator
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Waktu Scan
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status
                    </th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Aksi
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {scans.map((scan) => (
                    <tr key={scan.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center">
                          <div className="p-2 bg-green-100 rounded-lg mr-3">
                            <DocumentTextIcon className="h-5 w-5 text-green-600" />
                          </div>
                          <div>
                            <div className="text-sm font-medium text-gray-900">
                              {scan.submission.simlok_number}
                            </div>
                            <div className="text-sm text-gray-500">
                              {scan.submission.vendor_name}
                            </div>
                            <div className="text-xs text-gray-400 truncate max-w-xs">
                              {scan.submission.job_description}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center">
                          <div className="p-1.5 bg-blue-100 rounded-full mr-3">
                            <UserIcon className="h-4 w-4 text-blue-600" />
                          </div>
                          <div>
                            <div className="text-sm font-medium text-gray-900">
                              {scan.user.full_name}
                            </div>
                            <div className="text-xs text-gray-500">
                              {scan.user.email}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center text-sm text-gray-900">
                          <ClockIcon className="h-4 w-4 text-gray-400 mr-2" />
                          <div>
                            <div className="font-medium">
                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}
                            </div>
                            <div className="text-xs text-gray-500">
                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="space-y-1">
                          {getStatusBadge(scan.submission.review_status, 'review')}
                          {getStatusBadge(scan.submission.final_status, 'final')}
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <Button
                          onClick={() => setSelectedScan(scan)}
                          variant="secondary"
                          size="sm"
                          className="flex items-center space-x-1"
                        >
                          <EyeIcon className="h-4 w-4" />
                          <span>Detail</span>
                        </Button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Pagination */}
            {totalPages > 1 && (
              <div className="bg-white px-4 py-3 border-t border-gray-200 sm:px-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center">
                    <p className="text-sm text-gray-700">
                      Menampilkan halaman <span className="font-medium">{currentPage}</span> dari{' '}
                      <span className="font-medium">{totalPages}</span>
                    </p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Button
                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                      disabled={currentPage === 1}
                      variant="secondary"
                      size="sm"
                      className="flex items-center space-x-1"
                    >
                      <ChevronLeftIcon className="h-4 w-4" />
                      <span>Sebelumnya</span>
                    </Button>
                    
                    <Button
                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                      disabled={currentPage === totalPages}
                      variant="secondary"
                      size="sm"
                      className="flex items-center space-x-1"
                    >
                      <span>Selanjutnya</span>
                      <ChevronRightIcon className="h-4 w-4" />
                    </Button>
                  </div>
                </div>
              </div>
            )}
          </>
        )}
      </div>

      {/* Detail Modal */}
      {selectedScan && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold text-gray-900">Informasi Detail Scan</h3>
                <button
                  onClick={() => setSelectedScan(null)}
                  className="text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <span className="sr-only">Close</span>
                  ✕
                </button>
              </div>
            </div>
            
            <div className="p-6 space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Informasi Pengajuan</h4>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-500">Nomor Simlok:</span>
                      <span className="font-medium">{selectedScan.submission.simlok_number}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-500">Perusahaan:</span>
                      <span className="font-medium">{selectedScan.submission.vendor_name}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-500">Deskripsi Pekerjaan:</span>
                      <span className="font-medium">{selectedScan.submission.job_description}</span>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-4">
                  <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Informasi Verifikator</h4>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-500">Nama:</span>
                      <span className="font-medium">{selectedScan.user.full_name}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-500">Email:</span>
                      <span className="font-medium">{selectedScan.user.email}</span>
                    </div>
                    
                  </div>
                </div>
              </div>
              
              <div className="space-y-4">
                <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Detail Scan</h4>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  <div className="flex justify-between">
                    <span className="text-gray-500">Waktu Scan:</span>
                    <span className="font-medium">
                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}
                    </span>
                  </div>
                  {selectedScan.scanner_name && (
                    <div className="flex justify-between">
                      <span className="text-gray-500">Scanner Name:</span>
                      <span className="font-medium">{selectedScan.scanner_name}</span>
                    </div>
                  )}
                  {selectedScan.scan_location && (
                    <div className="flex justify-between">
                      <span className="text-gray-500">Lokasi Scan:</span>
                      <span className="font-medium">{selectedScan.scan_location}</span>
                    </div>
                  )}
                </div>
              </div>
              
              {/* PDF Button */}
              <div className="flex justify-center pt-4 border-t border-gray-200">
                <Button
                  onClick={() => setShowPdfModal(true)}
                  className="bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2"
                >
                  <DocumentTextIcon className="w-5 h-5" />
                  <span>Lihat PDF SIMLOK</span>
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* SimlokPdfModal */}
      {selectedScan && (
        <SimlokPdfModal
          isOpen={showPdfModal}
          onClose={() => setShowPdfModal(false)}
          submissionId={selectedScan.submission.id}
          submissionName={selectedScan.submission.vendor_name}
          nomorSimlok={selectedScan.submission.simlok_number}
        />
      )}
    </div>
  );
}

=== FILE: src/components/approver/ApproverSubmissionDetailModal.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import {
  XMarkIcon,
  CheckCircleIcon,
  XCircleIcon,
  DocumentTextIcon,
  UserGroupIcon,
  ClipboardDocumentCheckIcon,
  QrCodeIcon,
  ClockIcon,
  BuildingOfficeIcon,
  BriefcaseIcon,
  DocumentIcon,
  CalendarIcon,
  EyeIcon,
  MapPinIcon
} from '@heroicons/react/24/outline';
import Button from '@/components/ui/button/Button';
import { Badge } from '@/components/ui/Badge';
import { useToast } from '@/hooks/useToast';
import { fileUrlHelper } from '@/lib/fileUrlHelper';
import SimlokPdfModal from '@/components/common/SimlokPdfModal';
import DetailSection from '@/components/common/DetailSection';
import InfoCard from '@/components/common/InfoCard';
import DocumentPreviewModal from '@/components/common/DocumentPreviewModal';

import DatePicker from '@/components/form/DatePicker';

interface SubmissionDetail {
  id: string;
  approval_status: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  vendor_name: string;
  vendor_phone?: string;
  based_on: string;
  officer_name: string;
  officer_email?: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  worker_count: number | null;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  implementation_start_date?: string | null;
  implementation_end_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  review_note?: string;
  reviewed_by_name?: string;
  reviewed_by_email?: string;
  final_note?: string;
  approved_by_name?: string;
  approved_by_email?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  reviewed_at?: string;
  approved_at?: string;
  signer_position?: string;
  signer_name?: string;
  worker_list: Array<{
    id: string;
    worker_name: string;
    worker_photo: string | null;
    created_at: string;
  }>;
}

interface QrScan {
  id: string;
  scanned_at: string;
  scanner_name?: string;
  scan_location?: string;
  notes?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    role: string;
  };
}

interface ScanHistory {
  scans: QrScan[];
  totalScans: number;
  lastScan?: QrScan;
  hasBeenScanned: boolean;
}

interface ApproverSubmissionDetailModalProps {
  isOpen: boolean;
  onClose: () => void;
  submissionId: string;
  onApprovalSubmitted: () => void;
}

const ApproverSubmissionDetailModal: React.FC<ApproverSubmissionDetailModalProps> = ({
  isOpen,
  onClose,
  submissionId,
  onApprovalSubmitted
}) => {
  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);
  const [loading, setLoading] = useState(false);
  const [saving, setSaving] = useState(false);
  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'approval'>('details');
  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);
  const [scanHistory, setScanHistory] = useState<ScanHistory | null>(null);
  const [loadingScanHistory, setLoadingScanHistory] = useState(false);
  const [previewModal, setPreviewModal] = useState<{
    isOpen: boolean;
    fileUrl: string;
    fileName: string;
  }>({
    isOpen: false,
    fileUrl: '',
    fileName: ''
  });
  const { showSuccess, showError } = useToast();

  // Function to generate auto SIMLOK number - mengikuti sistem admin yang sudah ada
  const generateSimlokNumber = async () => {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format

    try {
      // Call API untuk mendapatkan nomor terakhir (untuk demo, kita gunakan format sederhana)
      // Server akan handle logic yang sebenarnya saat approve
      
      // Fallback format client-side: auto-increment berdasarkan bulan/tahun saat ini
      // Format: sequential_number/MM/YYYY (contoh: 1/09/2025, 2/09/2025)
      const timestamp = Date.now();
      const fallbackNumber = timestamp % 1000; // Simple fallback
      return `${fallbackNumber}/${month}/${year}`;
    } catch (error) {
      // Fallback jika error
      const fallbackNumber = Math.floor(Math.random() * 1000) + 1;
      return `${fallbackNumber}/${month}/${year}`;
    }
  };

  // Function to get current date in YYYY-MM-DD format
  const getCurrentDate = () => {
    const now = new Date();
    return now.toISOString().split('T')[0];
  };

  // Format date for display
  const formatDate = (dateString: string | null) => {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return date.toLocaleDateString('id-ID', {
      day: '2-digit',
      month: 'long',
      year: 'numeric'
    });
  };

  // Handle file view
  const handleFileView = (fileUrl: string, fileName: string) => {
    if (fileUrl) {
      // Convert legacy URL to new format if needed
      const convertedUrl = fileUrlHelper.convertLegacyUrl(fileUrl, fileName);
      setPreviewModal({
        isOpen: true,
        fileUrl: convertedUrl,
        fileName
      });
    }
  };

  // Handle close preview
  const handleClosePreview = () => {
    setPreviewModal({
      isOpen: false,
      fileUrl: '',
      fileName: ''
    });
  };

  // Approval form state
  const [approvalData, setApprovalData] = useState({
    final_status: '' as 'APPROVED' | 'REJECTED' | '',
    simlok_number: '',
    simlok_date: ''
  });

  const fetchSubmissionDetail = async () => {
    if (!submissionId) return;
    
    try {
      setLoading(true);
      
      const response = await fetch(`/api/approver/simloks/${submissionId}`);
      if (!response.ok) {
        if (response.status === 404) {
          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');
          onClose();
          // Add delay before refreshing so user can see the error message
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          return;
        }
        throw new Error('Gagal mengambil detail pengajuan');
      }
      
      const data = await response.json();
      setSubmission(data.submission);
      
      // Initialize approval data
      setApprovalData({
        final_status: data.submission.final_status === 'PENDING_APPROVAL' ? '' : data.submission.final_status,
        simlok_number: data.submission.simlok_number || '',
        simlok_date: (data.submission.simlok_date 
          ? new Date(data.submission.simlok_date).toISOString().split('T')[0] 
          : '') as string
      });
      
      // Auto-fill SIMLOK data jika status APPROVED dan belum ada nomor SIMLOK
      if (data.submission.final_status === 'APPROVED' && !data.submission.simlok_number) {
        const simlokNumber = await generateSimlokNumber();
        setApprovalData(prev => ({
          ...prev,
          simlok_number: simlokNumber,
          simlok_date: getCurrentDate() as string
        }));
      }
      
    } catch (err) {
      console.error('Error fetching submission:', err);
      showError('Error', 'Gagal memuat detail pengajuan');
    } finally {
      setLoading(false);
    }
  };

  const fetchScanHistory = async () => {
    if (!submissionId) return;
    
    try {
      setLoadingScanHistory(true);
      const response = await fetch(`/api/submissions/${submissionId}/scans`);
      
      if (!response.ok) {
        throw new Error('Failed to fetch scan history');
      }

      const data: ScanHistory = await response.json();
      setScanHistory(data);
    } catch (err) {
      console.error('Error fetching scan history:', err);
      // Don't show error for scan history as it's not critical
    } finally {
      setLoadingScanHistory(false);
    }
  };

  useEffect(() => {
    if (isOpen && submissionId) {
      fetchSubmissionDetail();
      fetchScanHistory();
    }
  }, [isOpen, submissionId]);

  const handleViewPdf = () => {
    setIsPdfModalOpen(true);
  };

  const handleSubmitApproval = async () => {
    if (!approvalData.final_status) {
      showError('Error', 'Pilih status persetujuan terlebih dahulu');
      return;
    }

    if (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) {
      showError('Error', 'Nomor SIMLOK wajib diisi untuk approval');
      return;
    }

    try {
      setSaving(true);

      const response = await fetch(`/api/approver/simloks/${submissionId}/final`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          final_status: approvalData.final_status,
          simlok_number: approvalData.final_status === 'APPROVED' ? approvalData.simlok_number.trim() : undefined,
          simlok_date: approvalData.final_status === 'APPROVED' && approvalData.simlok_date ? approvalData.simlok_date : undefined,
        }),
      });

      if (!response.ok) {
        if (response.status === 404) {
          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');
          onClose();
          // Add delay before refreshing so user can see the error message
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          return;
        }
        const errorData = await response.json();
        throw new Error(errorData.error || 'Gagal mengirim persetujuan');
      }

      const data = await response.json();
      setSubmission(data.submission);
      showSuccess('Berhasil', `Pengajuan berhasil ${approvalData.final_status === 'APPROVED' ? 'disetujui' : 'ditolak'}`);
      onApprovalSubmitted();
      
    } catch (err: any) {
      console.error('Error submitting approval:', err);
      showError('Error', err.message || 'Gagal menyimpan persetujuan');
    } finally {
      setSaving(false);
    }
  };

  const canApprove = submission && submission.final_status === 'PENDING_APPROVAL';

  // Handle status change with auto-fill
  const handleStatusChange = async (status: 'APPROVED' | 'REJECTED') => {
    if (status === 'APPROVED') {
      // Auto-fill nomor SIMLOK dan tanggal jika belum ada
      const simlokNumber = await generateSimlokNumber();
      setApprovalData(prev => ({
        ...prev,
        final_status: status,
        simlok_number: prev.simlok_number || simlokNumber,
        simlok_date: prev.simlok_date || getCurrentDate() as string
      }));
    } else {
      // Reset SIMLOK fields jika status REJECTED
      setApprovalData(prev => ({
        ...prev,
        final_status: status,
        simlok_number: '',
        simlok_date: ''
      }));
    }
  };

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING_REVIEW':
        return <Badge variant="warning">Menunggu Review</Badge>;
      case 'MEETS_REQUIREMENTS':
        return <Badge variant="success">Memenuhi Syarat</Badge>;
      case 'NOT_MEETS_REQUIREMENTS':
        return <Badge variant="destructive">Tidak Memenuhi Syarat</Badge>;
      case 'PENDING_APPROVAL':
        return <Badge variant="warning">Menunggu Persetujuan</Badge>;
      case 'APPROVED':
        return <Badge variant="success">Disetujui</Badge>;
      case 'REJECTED':
        return <Badge variant="destructive">Ditolak</Badge>;
      default:
        return <Badge variant="default">{status}</Badge>;
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0">
          <div>
            <h2 className="text-xl font-semibold text-gray-900">Detail & Approval Pengajuan</h2>
            {submission && (
              <div className="text-sm text-gray-500 mt-1 space-y-1">
                <p>
                  <span className="font-medium">{submission.vendor_name}</span> - {submission.officer_name}
                </p>
                {submission.simlok_number && (
                  <p className="text-xs">
                    <span className="font-medium">No. SIMLOK:</span> {submission.simlok_number}
                    {submission.simlok_date && (
                      <span className="ml-2">• <span className="font-medium">Tanggal:</span> {new Date(submission.simlok_date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                    )}
                  </p>
                )}

                
                {/* Scan Status */}
                <div className="mt-2 pt-2 border-t border-gray-100">
                  {loadingScanHistory ? (
                    <div className="flex items-center text-xs text-gray-500">
                      <ClockIcon className="h-3 w-3 mr-1 animate-spin" />
                      Memuat status scan...
                    </div>
                  ) : scanHistory ? (
                    <div className="space-y-1">
                      {scanHistory.hasBeenScanned ? (
                        <div className="flex items-center text-xs text-green-600">
                          <QrCodeIcon className="h-3 w-3 mr-1" />
                          <span className="font-medium">SIMLOK telah discan</span>
                          <span className="ml-2">({scanHistory.totalScans}x)</span>
                        </div>
                      ) : (
                        <div className="flex items-center text-xs text-gray-500">
                          <QrCodeIcon className="h-3 w-3 mr-1" />
                          <span>SIMLOK belum discan</span>
                        </div>
                      )}
                      
                      {scanHistory.lastScan && (
                        <div className="space-y-1">
                          <div className="flex items-center text-xs text-gray-500">
                            <ClockIcon className="h-3 w-3 mr-1" />
                            <span>Terakhir discan: {new Date(scanHistory.lastScan.scanned_at).toLocaleDateString('id-ID', {
                              day: 'numeric',
                              month: 'short',
                              year: 'numeric',
                              hour: '2-digit',
                              minute: '2-digit'
                            })}</span>
                          </div>
                          {scanHistory.lastScan.scan_location && (
                            <div className="flex items-center text-xs text-gray-500">
                              <MapPinIcon className="h-3 w-3 mr-1" />
                              <span>Lokasi: {scanHistory.lastScan.scan_location}</span>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  ) : (
                    <div className="flex items-center text-xs text-gray-400">
                      <QrCodeIcon className="h-3 w-3 mr-1" />
                      <span>Status scan tidak tersedia</span>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
          <Button
            onClick={onClose}
            variant="ghost"
            size="sm"
            className="text-gray-400 hover:text-gray-600"
          >
            <XMarkIcon className="h-6 w-6" />
          </Button>
        </div>

        {/* Tabs */}
        <div className="border-b border-gray-200 flex-shrink-0">
          <nav className="flex space-x-8 px-6">
            <button
              onClick={() => setActiveTab('details')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'details'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700'
              }`}
            >
              <DocumentTextIcon className="h-5 w-5 inline mr-2" />
              Detail SIMLOK
            </button>
            <button
              onClick={() => setActiveTab('workers')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'workers'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700'
              }`}
            >
              <UserGroupIcon className="h-5 w-5 inline mr-2" />
              Data Pekerja
            </button>
            <button
              onClick={() => setActiveTab('approval')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${
                activeTab === 'approval'
                  ? 'border-blue-500 text-blue-600'
                  : 'border-transparent text-gray-500 hover:text-gray-700'
              }`}
            >
              <ClipboardDocumentCheckIcon className="h-5 w-5 inline mr-2" />
              Proses Approval
            </button>
          </nav>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {loading && (
            <div className="flex items-center justify-center py-12">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
          )}

          {submission && (
            <>
              {/* Details Tab */}
              {activeTab === 'details' && (
                <div className="space-y-6">
                  {/* Header dengan Status */}
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-medium text-gray-900">Detail SIMLOK</h3>
                    <div className="flex items-center space-x-3">
                      <span className="text-sm text-gray-500">Review:</span>
                      {getStatusBadge(submission.review_status)}
                      <span className="text-sm text-gray-500">Status:</span>
                      {getStatusBadge(submission.final_status)}
                    </div>
                  </div>

                  {/* Informasi Vendor - menggunakan DetailSection seperti admin */}
                  <DetailSection 
                    title="Informasi Vendor" 
                    icon={<BuildingOfficeIcon className="h-5 w-5 text-blue-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Nama Vendor"
                        value={submission.vendor_name}
                      />
                      <InfoCard
                        label="Nama Petugas"
                        value={submission.officer_name}
                      />
                      {/* <InfoCard
                        label="Email"
                        value={submission.officer_email || '-'}
                      /> */}
                      <InfoCard
                        label="Nomor Telepon Vendor"
                        value={submission.vendor_phone || '-'}
                      />
                      <InfoCard
                        label="Berdasarkan"
                        value={submission.based_on}
                        className="md:col-span-2"
                      />
                    </div>
                  </DetailSection>

                  {/* Informasi Dokumen - sama seperti admin */}
                  <DetailSection 
                    title="Informasi Dokumen" 
                    icon={<DocumentIcon className="h-5 w-5 text-orange-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      {submission.simja_number && (
                        <InfoCard
                          label="Nomor SIMJA"
                          value={submission.simja_number}
                        />
                      )}
                      {submission.simja_date && (
                        <InfoCard
                          label="Tanggal SIMJA"
                          value={formatDate(submission.simja_date)}
                        />
                      )}
                      {submission.sika_number && (
                        <InfoCard
                          label="Nomor SIKA"
                          value={submission.sika_number}
                        />
                      )}
                      {submission.sika_date && (
                        <InfoCard
                          label="Tanggal SIKA"
                          value={formatDate(submission.sika_date)}

                        />
                      )}
                      {/* Status dan Tanggal Pengajuan */}
                      <InfoCard
                        label="Tanggal Pengajuan"
                        value={formatDate(submission.created_at)}

                      />
                    </div>
                    <div className="grid grid-cols-1 mt-5 md:grid-cols-2 gap-4">
                      {/* Dokumen SIKA */}
                      {submission.sika_document_upload && (
                        <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                          <div className="flex items-center space-x-3">
                            <DocumentIcon className="h-6 w-6 text-red-500 flex-shrink-0" />
                            <div>
                              <p className="font-medium text-gray-900">Dokumen SIKA</p>
                              <p className="text-sm text-gray-500">File tersedia</p>
                            </div>
                          </div>
                          <button
                            onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}
                            className="flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
                          >
                            <EyeIcon className="w-4 h-4" />
                            <span>Lihat</span>
                          </button>
                        </div>
                      )}

                      {/* Dokumen SIMJA */}
                      {submission.simja_document_upload && (
                        <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                          <div className="flex items-center space-x-3">
                            <DocumentIcon className="h-6 w-6 text-blue-500 flex-shrink-0" />
                            <div>
                              <p className="font-medium text-gray-900">Dokumen SIMJA</p>
                              <p className="text-sm text-gray-500">File tersedia</p>
                            </div>
                          </div>
                          <button
                            onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}
                            className="flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
                          >
                            <EyeIcon className="w-4 h-4" />
                            <span>Lihat</span>
                          </button>
                        </div>
                      )}

                      {/* Message if no documents */}
                      {!submission.sika_document_upload && !submission.simja_document_upload && (
                        <div className="col-span-2 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                          <DocumentIcon className="h-12 w-12 text-gray-400 mx-auto mb-3" />
                          <h3 className="text-sm font-medium text-gray-900 mb-1">Tidak ada dokumen</h3>
                          <p className="text-sm text-gray-500">Belum ada dokumen yang diupload</p>
                        </div>
                      )}
                    </div>
                  </DetailSection>

                  {/* Detail Pekerjaan - sama seperti admin */}
                  <DetailSection 
                    title="Informasi Pekerjaan" 
                    icon={<BriefcaseIcon className="h-5 w-5 text-green-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Pekerjaan"
                        value={submission.job_description}
                      />
                      <InfoCard
                        label="Lokasi Kerja"
                        value={submission.work_location}
                      />
                      <InfoCard
                        label="Pelaksanaan"
                        value={submission.implementation || 'Belum diisi'}
                      />
                      <InfoCard
                        label="Jam Kerja"
                        value={submission.working_hours}
                      />
                      <InfoCard
                        label="Jumlah Pekerja"
                        value={`${submission.worker_count || 0} orang`}
                      />
                      <InfoCard
                        label="Sarana Kerja"
                        value={submission.work_facilities}
                      />
                    </div>
                  </DetailSection>

                  {/* Dokumen Pendukung */}
                  {/* <DetailSection title="Dokumen Pendukung" icon={<DocumentTextIcon className="h-5 w-5 text-blue-600" />}>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Nomor SIMJA"
                        value={submission.simja_number || '-'}
                      />
                      <InfoCard
                        label="Tanggal SIMJA"
                        value={submission.simja_date ? formatDate(submission.simja_date) : '-'}
                      />
                      <InfoCard
                        label="Nomor SIKA"
                        value={submission.sika_number || '-'}
                      />
                      <InfoCard
                        label="Tanggal SIKA"
                        value={submission.sika_date ? formatDate(submission.sika_date) : '-'}
                      />
                    </div>
                  </DetailSection> */}

                  {/* Jadwal Pelaksanaan */}
                  <DetailSection title="Jadwal Pelaksanaan" icon={<CalendarIcon className="h-5 w-5 text-blue-600" />}>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Tanggal Mulai Pelaksanaan"
                        value={submission.implementation_start_date ? formatDate(submission.implementation_start_date) : '-'}
                        
                      />
                      <InfoCard
                        label="Tanggal Selesai Pelaksanaan"
                        value={submission.implementation_end_date ? formatDate(submission.implementation_end_date) : '-'}
                        
                      />
                    </div>
                  </DetailSection>

                  {/* Dokumen Upload */}
                  

                  {/* Final Status Information */}
                  {submission.final_status !== 'PENDING_APPROVAL' && (
                    <DetailSection title="Status Pengajuan" icon={<CheckCircleIcon className="h-5 w-5 text-blue-600" />}>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <InfoCard
                          label="Status"
                          value={getStatusBadge(submission.final_status)}
                        />
                        {submission.simlok_number && (
                          <InfoCard
                            label="Nomor SIMLOK"
                            value={submission.simlok_number}
                          />
                        )}
                        {submission.simlok_date && (
                          <InfoCard
                            label="Tanggal SIMLOK"
                            value={formatDate(submission.simlok_date)}
                          />
                        )}
                        {submission.final_note && (
                          <InfoCard
                            label="Catatan"
                            value={submission.final_note}
                            className="md:col-span-2"
                          />
                        )}
                        {submission.approved_by_name && (
                          <InfoCard
                            label="Diproses oleh"
                            value={`${submission.approved_by_name}${submission.approved_at ? ` pada ${formatDate(submission.approved_at)}` : ''}`}
                            className="md:col-span-2"
                          />
                        )}
                      </div>
                    </DetailSection>
                  )}
                </div>
              )}

              {/* Workers Tab */}
              {activeTab === 'workers' && (
                <div className="space-y-6">
                  {/* Header dengan jumlah pekerja */}
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-medium text-gray-900">Data Pekerja</h3>
                    <div className="flex items-center space-x-3">
                      <span className="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">
                        Total: {submission.worker_count || 
                          (submission.worker_names ? submission.worker_names.split('\n').filter(name => name.trim()).length : submission.worker_list.length)
                        } pekerja
                      </span>
                      {/* <span className="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">
                        Foto: {submission.worker_list.length}
                      </span> */}
                    </div>
                  </div>

                  {submission.worker_list.length === 0 ? (
                    <div className="text-center py-16">
                      <UserGroupIcon className="mx-auto h-16 w-16 text-gray-400 mb-4" />
                      <h3 className="text-lg font-medium text-gray-900 mb-2">Belum ada foto pekerja</h3>
                      <p className="text-gray-500 max-w-md mx-auto">
                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.
                      </p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                      {submission.worker_list.map((worker) => (
                        <div
                          key={worker.id}
                          className="bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group"
                        >
                          {/* Photo Section */}
                          <div className="relative p-4 pb-2">
                            <div className="relative">
                              {worker.worker_photo ? (
                                <img
                                  src={worker.worker_photo ? fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`) : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo='}
                                  alt={`Foto ${worker.worker_name}`}
                                  className="w-full h-48 rounded-lg object-cover shadow-sm"
                                  onLoad={() => console.log('Approver tab - Image loaded successfully for:', worker.worker_name)}
                                  onError={(e) => {
                                    console.log('Approver tab - Image load error for worker:', worker.worker_name, 'URL:', worker.worker_photo);
                                    if (worker.worker_photo) {
                                      console.log('Approver tab - Processed URL:', fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`));
                                    }
                                    const target = e.target as HTMLImageElement;
                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';
                                  }}
                                />
                              ) : (
                                <div className="w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm">
                                  <div className="text-center text-gray-500">
                                    <svg className="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clipRule="evenodd" />
                                    </svg>
                                    <p className="text-sm">Tidak ada foto</p>
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Info Section */}
                          <div className="px-4 pb-4">
                            <h4 className="font-semibold text-gray-900 text-sm mb-1 truncate">
                              {worker.worker_name}
                            </h4>
                            
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* Approval Tab */}
              {activeTab === 'approval' && (
                <div className="space-y-6">
                  <h3 className="text-lg font-medium text-gray-900">Proses Approval Final</h3>
                  {/* Review Information */}
                  {submission.review_note && (
                    <div className="bg-blue-50 rounded-lg p-6">
                      <h4 className="text-base font-semibold text-gray-900 mb-4">Catatan Review</h4>
                      <p className="text-gray-700 whitespace-pre-line">{submission.review_note}</p>
                      {submission.reviewed_by_name && (
                        <p className="text-sm text-gray-500 mt-2">
                          Direview oleh: {submission.reviewed_by_name}
                          {submission.reviewed_at && (
                            <span> pada {new Date(submission.reviewed_at).toLocaleDateString('id-ID')}</span>
                          )}
                        </p>
                      )}
                    </div>
                  )}

                  {submission.final_status !== 'PENDING_APPROVAL' && (
                    <div className={`
                      rounded-xl p-6 mb-6 border-2
                      ${submission.final_status === 'APPROVED' 
                        ? 'bg-green-50 border-green-200' 
                        : 'bg-red-50 border-red-200'
                      }
                    `}>
                      <div className="flex items-start space-x-4">
                        <div className={`
                          flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center
                          ${submission.final_status === 'APPROVED' 
                            ? 'bg-green-100' 
                            : 'bg-red-100'
                          }
                        `}>
                          {submission.final_status === 'APPROVED' ? (
                            <CheckCircleIcon className="h-6 w-6 text-green-600" />
                          ) : (
                            <XCircleIcon className="h-6 w-6 text-red-600" />
                          )}
                        </div>
                        <div className="flex-1">
                          <h4 className={`
                            text-lg font-semibold mb-2
                            ${submission.final_status === 'APPROVED' 
                              ? 'text-green-900' 
                              : 'text-red-900'
                            }
                          `}>
                            {submission.final_status === 'APPROVED' ? 'Pengajuan Disetujui' : 'Pengajuan Ditolak'}
                          </h4>
                          <div className="space-y-2 text-sm">
                            <div className="flex items-center space-x-2">
                              <span className="font-medium text-gray-700">Status:</span>
                              {getStatusBadge(submission.final_status)}
                            </div>
                            {submission.final_note && (
                              <div>
                                <span className="font-medium text-gray-700">Catatan:</span>
                                <p className="mt-1 text-gray-600">{submission.final_note}</p>
                              </div>
                            )}
                            {submission.approved_by_name && (
                              <div className="pt-2 border-t border-gray-200">
                                <span className="font-medium text-gray-700">Diproses oleh:</span>
                                <p className="text-gray-600">
                                  {submission.approved_by_name} pada{' '}
                                  {new Date(submission.approved_at!).toLocaleDateString('id-ID', {
                                    weekday: 'long',
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                  })}
                                </p>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {canApprove && (
                    <div className="space-y-8">
                      {/* Status Selection Card */}
                      <div className="bg-gray-50 rounded-xl p-6 border border-gray-200">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                          <ClipboardDocumentCheckIcon className="h-5 w-5 text-blue-600 mr-2" />
                          Keputusan Persetujuan
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Approve Option */}
                          <label className={`
                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                            ${approvalData.final_status === 'APPROVED' 
                              ? 'border-green-500 bg-green-50 shadow-md' 
                              : 'border-gray-200 bg-white hover:border-green-300 hover:bg-green-50'
                            }
                          `}>
                            <input
                              type="radio"
                              name="final_status"
                              value="APPROVED"
                              checked={approvalData.final_status === 'APPROVED'}
                              onChange={(e) => {
                                handleStatusChange(e.target.value as 'APPROVED');
                              }}
                              className="sr-only"
                            />
                            <div className="flex items-center flex-1">
                              <div className={`
                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center
                                ${approvalData.final_status === 'APPROVED' 
                                  ? 'border-green-500 bg-green-500' 
                                  : 'border-gray-300'
                                }
                              `}>
                                {approvalData.final_status === 'APPROVED' && (
                                  <CheckCircleIcon className="h-3 w-3 text-white" />
                                )}
                              </div>
                              <div>
                                <div className="text-sm font-medium text-gray-900">Setujui Pengajuan</div>
                                <div className="text-xs text-gray-500">Pengajuan akan disetujui dan nomor SIMLOK dibuat</div>
                              </div>
                            </div>
                          </label>

                          {/* Reject Option */}
                          <label className={`
                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                            ${approvalData.final_status === 'REJECTED' 
                              ? 'border-red-500 bg-red-50 shadow-md' 
                              : 'border-gray-200 bg-white hover:border-red-300 hover:bg-red-50'
                            }
                          `}>
                            <input
                              type="radio"
                              name="final_status"
                              value="REJECTED"
                              checked={approvalData.final_status === 'REJECTED'}
                              onChange={(e) => {
                                handleStatusChange(e.target.value as 'REJECTED');
                              }}
                              className="sr-only"
                            />
                            <div className="flex items-center flex-1">
                              <div className={`
                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center
                                ${approvalData.final_status === 'REJECTED' 
                                  ? 'border-red-500 bg-red-500' 
                                  : 'border-gray-300'
                                }
                              `}>
                                {approvalData.final_status === 'REJECTED' && (
                                  <XCircleIcon className="h-3 w-3 text-white" />
                                )}
                              </div>
                              <div>
                                <div className="text-sm font-medium text-gray-900">Tolak Pengajuan</div>
                                <div className="text-xs text-gray-500">Pengajuan akan ditolak dengan alasan</div>
                              </div>
                            </div>
                          </label>
                        </div>
                      </div>

                      {approvalData.final_status === 'APPROVED' && (
                        <div className="bg-white border border-gray-200 rounded-xl p-6">
                          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <DocumentTextIcon className="h-5 w-5 text-blue-600 mr-2" />
                            Informasi SIMLOK
                          </h3>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">
                                Nomor SIMLOK
                                <span className="text-red-500 ml-1">*</span>
                              </label>
                              <div className="relative">
                                <input
                                  type="text"
                                  value={approvalData.simlok_number}
                                  onChange={(e) => setApprovalData({ ...approvalData, simlok_number: e.target.value })}
                                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm"
                                  placeholder="Dibuat otomatis"
                                  required
                                />
                                <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                  <CheckCircleIcon className="h-5 w-5 text-blue-500" />
                                </div>
                              </div>
                              <p className="text-xs text-gray-600 mt-2 flex items-center">
                                <span className="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                Nomor otomatis dibuat berdasarkan urutan bulanan
                              </p>
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">
                                Tanggal Penerbitan Simlok
                              </label>
                              <DatePicker
                                value={approvalData.simlok_date}
                                onChange={(value) => setApprovalData({ ...approvalData, simlok_date: value })}
                                placeholder="Pilih tanggal penerbitan SIMLOK"
                                className="w-full px-4 py-3 bg-white shadow-sm"
                              />
                              <p className="text-xs text-gray-600 mt-2 flex items-center">
                                <span className="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                Tanggal dapat disesuaikan sesuai kebutuhan
                              </p>
                            </div>
                          </div>
                        </div>
                      )}



                      {/* Submit Button */}
                      <div className="flex justify-end pt-4 border-t border-gray-200">
                        <Button
                          onClick={handleSubmitApproval}
                          disabled={
                            !approvalData.final_status || 
                            (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) ||
                            saving
                          }
                          className={`
                            px-8 py-3 rounded-lg font-medium transition-all duration-200 min-w-[160px]
                            ${approvalData.final_status === 'APPROVED'
                              ? 'bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl'
                              : approvalData.final_status === 'REJECTED'
                              ? 'bg-red-600 hover:bg-red-700 text-white shadow-lg hover:shadow-xl'
                              : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            }
                          `}
                        >
                          {saving ? (
                            <div className="flex items-center">
                              <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                              Memproses
                            </div>
                          ) : (
                            <div className="flex items-center">
                              {approvalData.final_status === 'APPROVED' ? (
                                <>
                                  <CheckCircleIcon className="h-5 w-5 mr-2" />
                                  Setujui Pengajuan
                                </>
                              ) : approvalData.final_status === 'REJECTED' ? (
                                <>
                                  <XCircleIcon className="h-5 w-5 mr-2" />
                                  Tolak Pengajuan
                                </>
                              ) : (
                                'Pilih Status'
                              )}
                            </div>
                          )}
                        </Button>
                      </div>
                    </div>
                  )}

                  {!canApprove && submission.final_status !== 'PENDING_APPROVAL' && (
                    <div className="bg-blue-50 border border-blue-200 rounded-xl p-6">
                      <div className="text-center">
                        <div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                          <ClipboardDocumentCheckIcon className="h-6 w-6 text-blue-600" />
                        </div>
                        <h3 className="text-lg font-medium text-blue-900 mb-2">Pengajuan Sudah Difinalisasi</h3>
                        <p className="text-sm text-blue-700">
                          Status persetujuan tidak dapat diubah karena pengajuan telah selesai diproses.
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </>
          )}
        </div>

        {/* Footer */}
        <div className="flex items-center justify-between p-6 border-t border-gray-200 flex-shrink-0 bg-white">
          <div className="flex items-center space-x-3">
            {/* Debug info untuk development */}
            {/* {submission && (
              <div className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                Status: {submission.final_status} | SIMLOK: {submission.simlok_number || 'Belum ada'}
              </div>
            )} */}
            
            {/* Tampilkan tombol PDF - approver bisa lihat di semua status */}
            {submission && (
              <Button onClick={handleViewPdf} variant="primary" size="sm">
                <DocumentTextIcon className="w-4 h-4 mr-2" />
                Lihat PDF
              </Button>
            )}
          </div>
          <Button onClick={onClose} variant="outline">
            Tutup
          </Button>
        </div>
      </div>

      {/* PDF Modal */}
      <SimlokPdfModal
        isOpen={isPdfModalOpen}
        onClose={() => setIsPdfModalOpen(false)}
        submissionId={submissionId}
        submissionName={submission?.vendor_name || ''}
        nomorSimlok={submission?.simlok_number || ''}
      />

      {/* Document Preview Modal */}
      <DocumentPreviewModal
        isOpen={previewModal.isOpen}
        onClose={handleClosePreview}
        fileUrl={previewModal.fileUrl}
        fileName={previewModal.fileName}
      />
    </div>
  );
};

export default ApproverSubmissionDetailModal;

=== FILE: src/components/approver/ApproverSubmissionsManagement.tsx ===
'use client';

import { useState, useEffect, useCallback } from 'react';
import {
  MagnifyingGlassIcon,
  ChevronUpIcon,
  ChevronDownIcon,
  ChevronUpDownIcon,
  EyeIcon,
  XMarkIcon,
  ClipboardDocumentListIcon,
  CheckCircleIcon,
  UserGroupIcon,
  DocumentCheckIcon,
  UserIcon,
} from "@heroicons/react/24/outline";

import Button from '@/components/ui/button/Button';
import { Badge } from '@/components/ui/Badge';
import Alert from '@/components/ui/alert/Alert';
import { useSocket } from '@/components/common/RealtimeUpdates';
import ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';

interface Submission {
  id: string;
  approval_status: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  review_note?: string;
  final_note?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  reviewed_at?: string;
  approved_at?: string;
  signer_position?: string;
  signer_name?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  reviewed_by_user?: {
    id: string;
    officer_name: string;
    email: string;
  };
  approved_by_final_user?: {
    id: string;
    officer_name: string;
    email: string;
  };
  worker_list: Array<{
    id: string;
    worker_name: string;
    worker_photo: string | null;
  }>;
}

interface SubmissionsResponse {
  submissions: Submission[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    pages: number;
  };
}

// Empty State Component
function EmptyState({ hasFilters, onClearFilters }: { hasFilters: boolean; onClearFilters: () => void }) {
  return (
    <div className="bg-white rounded-lg shadow-sm border border-gray-200">
      <div className="px-6 py-12 text-center">
        <div className="mx-auto h-24 w-24 text-gray-300 mb-6">
          <DocumentCheckIcon className="h-full w-full" />
        </div>
        
        {hasFilters ? (
          <>
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              Tidak ada data yang sesuai dengan filter
            </h3>
            <p className="text-gray-500 mb-6 max-w-md mx-auto">
              Tidak ditemukan pengajuan yang sesuai dengan kriteria pencarian atau filter yang Anda terapkan.
            </p>
            <Button
              onClick={onClearFilters}
              variant="outline"
              className="mx-auto"
            >
              <XMarkIcon className="h-4 w-4 mr-2" />
              Hapus Filter
            </Button>
          </>
        ) : (
          <>
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              Belum ada pengajuan untuk disetujui
            </h3>
            <p className="text-gray-500 mb-6 max-w-md mx-auto">
              Saat ini belum ada pengajuan Simlok yang telah direview dan memerlukan persetujuan final dari Anda.
            </p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <ClipboardDocumentListIcon className="h-8 w-8 text-blue-500 mx-auto mb-2" />
                <p className="text-sm font-medium text-blue-900">Vendor Submit</p>
                <p className="text-xs text-blue-600">Pengajuan masuk</p>
              </div>
              <div className="bg-yellow-50 p-4 rounded-lg text-center">
                <UserGroupIcon className="h-8 w-8 text-yellow-500 mx-auto mb-2" />
                <p className="text-sm font-medium text-yellow-900">Reviewer Check</p>
                <p className="text-xs text-yellow-600">Proses review</p>
              </div>
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <CheckCircleIcon className="h-8 w-8 text-green-500 mx-auto mb-2" />
                <p className="text-sm font-medium text-green-900">Approver Final</p>
                <p className="text-xs text-green-600">Menunggu Anda</p>
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );
}

// Loading State Component  
function LoadingState() {
  return (
    <div className="space-y-6">
      {/* Loading Filters */}
      <div className="bg-white p-6 rounded-lg shadow animate-pulse">
        <div className="flex flex-col sm:flex-row gap-4">
          <div className="flex-1 h-10 bg-gray-200 rounded"></div>
          <div className="sm:w-48 h-10 bg-gray-200 rounded"></div>
        </div>
      </div>
      
      {/* Loading Table */}
      <div className="bg-white shadow rounded-lg overflow-hidden">
        <div className="p-6">
          <div className="space-y-4">
            {[...Array(5)].map((_, i) => (
              <div key={i} className="flex items-center space-x-4">
                <div className="h-4 bg-gray-200 rounded w-24"></div>
                <div className="h-4 bg-gray-200 rounded w-32"></div>
                <div className="h-4 bg-gray-200 rounded w-48"></div>
                <div className="h-4 bg-gray-200 rounded w-20"></div>
                <div className="h-4 bg-gray-200 rounded w-20"></div>
                <div className="h-4 bg-gray-200 rounded w-24"></div>
                <div className="h-8 bg-gray-200 rounded w-16"></div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

export default function ApproverSubmissionsManagement() {
  const [submissions, setSubmissions] = useState<Submission[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);
  const [showDetailModal, setShowDetailModal] = useState(false);
  
  // Filters and pagination
  const [currentPage, setCurrentPage] = useState(1);
  const [searchTerm, setSearchTerm] = useState('');
  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');
  const [finalStatusFilter, setFinalStatusFilter] = useState<string>('');
  const [sortBy, setSortBy] = useState('reviewed_at');
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');

  const [pagination, setPagination] = useState({
    page: 1,
    limit: 10,
    total: 0,
    pages: 0,
  });

  // Socket connection
  const socket = useSocket();

  const fetchSubmissions = useCallback(async () => {
    try {
      setLoading(true);
      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: '10',
        sortBy,
        sortOrder,
      });

      if (searchTerm) params.append('search', searchTerm);
      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);
      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);

      const response = await fetch(`/api/approver/simloks?${params}`);
      if (!response.ok) {
        throw new Error('Gagal mengambil data pengajuan');
      }

      const data: SubmissionsResponse = await response.json();
      setSubmissions(data.submissions);
      setPagination(data.pagination);
    } catch (err) {
      console.error('Error fetching submissions:', err);
      setError('Gagal memuat data pengajuan');
    } finally {
      setLoading(false);
    }
  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);

  useEffect(() => {
    fetchSubmissions();
  }, [fetchSubmissions]);

  // Socket listeners for real-time updates
  useEffect(() => {
    if (!socket) return;

    // Join approver room
    socket.emit('join', { role: 'APPROVER' });

    const handleSubmissionUpdate = () => {
      console.log('Submission update received, refreshing approver submissions');
      fetchSubmissions();
    };

    socket.on('submission:reviewed', handleSubmissionUpdate);
    socket.on('submission:approved', handleSubmissionUpdate);
    socket.on('submission:rejected', handleSubmissionUpdate);

    return () => {
      socket.off('submission:reviewed', handleSubmissionUpdate);
      socket.off('submission:approved', handleSubmissionUpdate);
      socket.off('submission:rejected', handleSubmissionUpdate);
    };
  }, [socket, fetchSubmissions]);

  const handleSort = (field: string) => {
    if (sortBy === field) {
      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
    } else {
      setSortBy(field);
      setSortOrder('desc');
    }
    setCurrentPage(1);
  };

  const getSortIcon = (field: string) => {
    if (sortBy !== field) return <ChevronUpDownIcon className="h-4 w-4" />;
    return sortOrder === 'asc' 
      ? <ChevronUpIcon className="h-4 w-4" />
      : <ChevronDownIcon className="h-4 w-4" />;
  };

  const getReviewStatusBadge = (status: string) => {
    switch (status) {
      case 'MEETS_REQUIREMENTS':
        return <Badge variant="success">Memenuhi Syarat</Badge>;
      case 'NOT_MEETS_REQUIREMENTS':
        return <Badge variant="destructive">Tidak Memenuhi Syarat</Badge>;
      default:
        return <Badge variant="default">{status}</Badge>;
    }
  };

  const getFinalStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING_APPROVAL':
        return <Badge variant="warning">Menunggu Persetujuan</Badge>;
      case 'APPROVED':
        return <Badge variant="success">Disetujui</Badge>;
      case 'REJECTED':
        return <Badge variant="destructive">Ditolak</Badge>;
      default:
        return <Badge variant="default">{status}</Badge>;
    }
  };

  const handleViewDetails = (submission: Submission) => {
    setSelectedSubmission(submission);
    setShowDetailModal(true);
  };

  const clearFilters = () => {
    setSearchTerm('');
    setReviewStatusFilter('');
    setFinalStatusFilter('');
    setCurrentPage(1);
  };

  const handleCloseModal = () => {
    setShowDetailModal(false);
    setSelectedSubmission(null);
  };

  const handleApprovalSubmitted = () => {
    fetchSubmissions(); // Refresh data after approval
  };

  const hasFilters = searchTerm || reviewStatusFilter || finalStatusFilter;

  if (loading && submissions.length === 0) {
    return <LoadingState />;
  }

  return (
    <div className="space-y-6">
      {/* Header and Filters - Unified Design */}
      <div className="bg-white rounded-xl border shadow-sm p-6 space-y-4">
        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h1 className="text-xl md:text-2xl font-semibold text-gray-900">Persetujuan Pengajuan</h1>
            <p className="text-sm text-gray-500 mt-1">Kelola dan setujui pengajuan SIMLOK</p>
          </div>
        </div>

        {/* Toolbar - Search and Filters */}
        <div className="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
          <div className="relative w-full md:w-80">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
            </div>
            <input
              type="text"
              placeholder="Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas..."
              value={searchTerm}
              onChange={(e) => {
                setSearchTerm(e.target.value);
                setCurrentPage(1);
              }}
              className="pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            />
          </div>
          <div className="flex gap-2 md:w-auto">
            <select
              value={reviewStatusFilter}
              onChange={(e) => {
                setReviewStatusFilter(e.target.value);
                setCurrentPage(1);
              }}
              className="px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm"
            >
              <option value="">Semua Status Review</option>
              <option value="MEETS_REQUIREMENTS">Memenuhi Syarat</option>
              <option value="NOT_MEETS_REQUIREMENTS">Tidak Memenuhi Syarat</option>
            </select>
            <select
              value={finalStatusFilter}
              onChange={(e) => {
                setFinalStatusFilter(e.target.value);
                setCurrentPage(1);
              }}
              className="px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm"
            >
              <option value="">Semua Status Akhir</option>
              <option value="PENDING_APPROVAL">Menunggu Persetujuan</option>
              <option value="APPROVED">Disetujui</option>
              <option value="REJECTED">Ditolak</option>
            </select>
            {hasFilters && (
              <Button
                onClick={clearFilters}
                variant="outline"
                size="sm"
                className="text-gray-600 border-gray-300 hover:bg-gray-50"
              >
                <XMarkIcon className="h-4 w-4 mr-1" />
                Reset
              </Button>
            )}
          </div>
        </div>
      </div>

      {error && (
        <Alert variant="error" title="Error" message={error} />
      )}

      {/* Show empty state if no submissions */}
      {!loading && submissions.length === 0 ? (
        <EmptyState hasFilters={hasFilters ? true : false} onClearFilters={clearFilters} />
      ) : (
        <div>
          {/* Submissions Table - Unified Design */}
          <div className="bg-white rounded-xl border shadow-sm overflow-hidden">
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th 
                  className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors"
                  onClick={() => handleSort('reviewed_at')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Tanggal Review</span>
                    {getSortIcon('reviewed_at')}
                  </div>
                </th>
                <th 
                  className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors"
                  onClick={() => handleSort('vendor_name')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Vendor & PJ</span>
                    {getSortIcon('vendor_name')}
                  </div>
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Pekerjaan & Lokasi
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status Review
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status Final
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Reviewer
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Aksi
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {submissions.map((submission) => (
                <tr key={submission.id} className="hover:bg-gray-50 transition-colors">
                  <td className="px-4 py-3 whitespace-nowrap">
                    <div className="text-sm font-medium text-gray-900">
                      {submission.reviewed_at 
                        ? new Date(submission.reviewed_at).toLocaleDateString('id-ID', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric'
                          })
                        : '-'
                      }
                    </div>
                    {submission.reviewed_at && (
                      <div className="text-xs text-gray-500">
                        {new Date(submission.reviewed_at).toLocaleTimeString('id-ID', {
                          hour: '2-digit',
                          minute: '2-digit'
                        })}
                      </div>
                    )}
                  </td>
                  <td className="px-4 py-3">
                    <div className="max-w-44">
                      <div className="text-sm font-medium text-gray-900 truncate" title={submission.vendor_name}>
                        {submission.vendor_name}
                      </div>
                      <div className="flex items-center space-x-1 text-xs text-gray-500 mt-1">
                        <UserIcon className="h-3 w-3 flex-shrink-0" />
                        <span className="truncate" title={submission.officer_name}>{submission.officer_name}</span>
                      </div>
                    </div>
                  </td>
                  <td className="px-4 py-3">
                    <div className="max-w-52">
                      <div className="text-sm font-medium text-gray-900 truncate" title={submission.job_description}>
                        {submission.job_description}
                      </div>
                      <div className="text-xs text-gray-500 mt-1 truncate" title={submission.work_location}>
                         {submission.work_location}
                      </div>
                    </div>
                  </td>
                  <td className="px-4 py-3 whitespace-nowrap">
                    {getReviewStatusBadge(submission.review_status)}
                  </td>
                  <td className="px-4 py-3 whitespace-nowrap">
                    {getFinalStatusBadge(submission.final_status)}
                  </td>
                  <td className="px-4 py-3 whitespace-nowrap">
                    <div className="text-sm text-gray-900 max-w-28">
                      <span className="truncate block" title={submission.reviewed_by_user?.officer_name || '-'}>
                        {submission.reviewed_by_user?.officer_name || '-'}
                      </span>
                    </div>
                  </td>
                  <td className="px-4 py-3 whitespace-nowrap text-sm font-medium">
                    <Button
                      onClick={() => handleViewDetails(submission)}
                      size="sm"
                      variant={submission.final_status === 'PENDING_APPROVAL' ? 'primary' : 'outline'}
                      className="inline-flex items-center"
                    >
                      <EyeIcon className="h-4 w-4 mr-1" />
                      {submission.final_status === 'PENDING_APPROVAL' ? 'Setujui' : 'Lihat'}
                    </Button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>        {/* Enhanced Pagination */}
        {pagination.pages > 1 && (
          <div className="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200">
            <div className="flex-1 flex justify-between sm:hidden">
              <Button
                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                disabled={currentPage === 1}
                variant="outline"
                size="sm"
              >
                Sebelumnya
              </Button>
              <Button
                onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}
                disabled={currentPage === pagination.pages}
                variant="outline"
                size="sm"
              >
                Selanjutnya
              </Button>
            </div>
            <div className="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
              <div>
                <p className="text-sm text-gray-700">
                  Menampilkan{' '}
                  <span className="font-medium">
                    {(currentPage - 1) * pagination.limit + 1}
                  </span>{' '}
                  sampai{' '}
                  <span className="font-medium">
                    {Math.min(currentPage * pagination.limit, pagination.total)}
                  </span>{' '}
                  dari{' '}
                  <span className="font-medium">{pagination.total}</span> pengajuan
                </p>
              </div>
              <div>
                <nav className="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                  <Button
                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                    disabled={currentPage === 1}
                    variant="outline"
                    size="sm"
                    className="rounded-r-none"
                  >
                    Sebelumnya
                  </Button>
                  
                  {Array.from({ length: Math.min(5, pagination.pages) }, (_, i) => {
                    const pageNum = i + 1;
                    return (
                      <Button
                        key={pageNum}
                        onClick={() => setCurrentPage(pageNum)}
                        variant={currentPage === pageNum ? "primary" : "outline"}
                        size="sm"
                        className="rounded-none"
                      >
                        {pageNum}
                      </Button>
                    );
                  })}
                  
                  <Button
                    onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}
                    disabled={currentPage === pagination.pages}
                    variant="outline"
                    size="sm"
                    className="rounded-l-none"
                  >
                    Selanjutnya
                  </Button>
                </nav>
              </div>
            </div>
          </div>
        )}
        </div>
        </div>
      )}

      {/* New Detail Modal */}
      <ApproverSubmissionDetailModal
        isOpen={showDetailModal}
        onClose={handleCloseModal}
        submissionId={selectedSubmission?.id || ''}
        onApprovalSubmitted={handleApprovalSubmitted}
      />
    </div>
  );
}

=== FILE: src/components/auth/AuthRedirect.tsx ===
"use client";

import { useEffect } from "react";
import { useSession } from "next-auth/react";
import { useRouter } from "next/navigation";

export default function AuthRedirect({
  children,
}: {
  children: React.ReactNode;
}) {
  const { data: session, status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (status === "loading") return; // tunggu dulu

    if (session?.user?.role) {
      switch (session.user.role) {
        case "ADMIN":
          router.replace("/admin");
          break;
        case "VENDOR":
          router.replace("/vendor");
          break;
        case "VERIFIER":
          router.replace("/verifier");
          break;
        default:
          router.replace("/"); // fallback
      }
    }
  }, [session, status, router]);

  if (status === "loading") {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <p>Loading...</p>
      </div>
    );
  }

  // hanya render children kalau memang BELUM login
  return <>{!session ? children : null}</>;
}

=== FILE: src/components/auth/SignInForm.tsx ===
"use client";

// import Checkbox from "@/components/form/Checkbox";
import Input from "@/components/form/Input";
import Label from "@/components/form/Label";
import Button from "@/components/ui/button/Button";
import { EyeIcon, EyeSlashIcon } from "@heroicons/react/24/outline";
import Link from "next/link";
import Image from "next/image";
import type { FC } from "react";

interface Props {
  email: string;
  password: string;
  showPassword: boolean;
  error: string;
  setEmail: (v: string) => void;
  setPassword: (v: string) => void;
  setShow: (v: boolean) => void;
  handleSubmit: (e: React.FormEvent) => void;
}

const SignInForm: FC<Props> = ({
  email,
  password,
  showPassword,
  error,
  setEmail,
  setPassword,
  setShow,
  handleSubmit,
}) => (
  <div className="min-h-screen flex">
    {/* Left Section - Welcome & Branding */}
    <div className="hidden lg:flex lg:w-1/2 bg-blue-600 relative">
      <div className="flex flex-col justify-center items-center w-full text-white">
         <div className="text-center w-full" style={{ marginTop: '-10rem' }}>
          <div className="mb-15 flex w-full bg-white p-5 justify-center">
            <Image
              src="/assets/logo.svg"
              alt="Logo SIMLOK"
              width={200}
              height={90}
              className="object-contain drop-shadow-lg"
            />
          </div>
          
          {/* SIMLOK Title */}
          <h1 className="text-6xl font-bold mb-6 tracking-wide text-white">
            SIMLOK
          </h1>
          <p className="text-xl text-white font-light tracking-wide leading-relaxed">
            Sistem Informasi Manajemen Lokasi Kerja Pertamina
          </p>
        </div>
      </div>
    </div>

    {/* Right Section - Login Form */}
    <div className="w-full lg:w-1/2 flex flex-col justify-center p-6 lg:p-12 bg-white min-h-screen">
      <div className="w-full max-w-md mx-auto">
        {/* Mobile Logo */}
        <div className="lg:hidden flex justify-center mb-8">
          <Image
            src="/assets/logo.svg"
            alt="Logo SIMLOK"
            width={300}
            height={300}
            className="object-contain"
          />
        </div>

        <div className="w-full">
          <div className="mb-8">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">
              Masuk ke SIMLOK
            </h1>
            <p className="text-gray-600">
              Masukkan email dan password Anda
            </p>
          </div>

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
              <p className="text-sm text-red-800">{error}</p>
            </div>
          )}

          <form onSubmit={handleSubmit} className="space-y-6">
            <div>
              <Label className="text-gray-700 font-medium text-sm">
                Email <span className="text-red-500">*</span>
              </Label>
              <Input
                type="email"
                placeholder="masukkan@email.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                className="mt-2 h-12 px-4 text-base border-gray-300 focus:border-blue-500 focus:ring-blue-500 rounded-lg"
              />
            </div>

            <div>
              <Label className="text-gray-700 font-medium text-sm">
                Password <span className="text-red-500">*</span>
              </Label>
              <div className="relative mt-2">
                <Input
                  type={showPassword ? "text" : "password"}
                  placeholder="Masukkan password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  className="h-12 px-4 pr-12 text-base border-gray-300 focus:border-blue-500 focus:ring-blue-500 rounded-lg"
                />
                <button
                  type="button"
                  onClick={() => setShow(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                >
                  {showPassword ? (
                    <EyeSlashIcon className="w-5 h-5" />
                  ) : (
                    <EyeIcon className="w-5 h-5" />
                  )}
                </button>
              </div>
            </div>

            {/* <div className="flex items-center justify-between">
              <Checkbox
                checked={keepLoggedIn}
                onChange={setKeep}
                label="Tetap masuk"
              />
              <Link
                href="/reset-password"
                className="text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors"
              >
                Lupa password?
              </Link>
            </div> */}

            <Button 
              className="w-full h-12 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg" 
              type="submit"
            >
              Masuk
            </Button>
          </form>

          <div className="mt-6 pt-6 border-t border-gray-200">
            <p className="text-center text-gray-600 text-sm">
              Belum memiliki akun?{" "}
              <Link 
                href="/signup" 
                className="text-blue-600 hover:text-blue-800 font-medium"
              >
                Daftar sebagai Vendor
              </Link>
            </p>
          </div>
        </div>

        {/* Footer */}
        {/* <div className="mt-8 text-center text-xs text-gray-500">
          <p>© 2025 Pertamina. Seluruh hak cipta dilindungi.</p>
        </div> */}
      </div>
    </div>
  </div>
);

export default SignInForm;

=== FILE: src/components/auth/SignUpForm.tsx ===
"use client";

import Checkbox from "@/components/form/Checkbox";
import Label from "@/components/form/Label";
import Button from "@/components/ui/button/Button";
import Input from "@/components/form/Input";
import { EyeIcon, EyeSlashIcon } from "@heroicons/react/24/outline";
import Link from "next/link";
import Image from "next/image";
import type { FC } from "react";

interface Props {
  email: string;
  password: string;
  confirmPassword: string;
  nama_petugas: string;
  nama_vendor: string;
  alamat: string;
  no_telp: string;
  showPassword: boolean;
  showConfirmPassword: boolean;
  agreeToTerms: boolean;
  error: string;
  isLoading: boolean;
  setEmail: (v: string) => void;
  setPassword: (v: string) => void;
  setConfirmPassword: (v: string) => void;
  setNamaPetugas: (v: string) => void;
  setNamaVendor: (v: string) => void;
  setAlamat: (v: string) => void;
  setNoTelp: (v: string) => void;
  setShowPassword: (v: boolean) => void;
  setShowConfirmPassword: (v: boolean) => void;
  setAgree: (v: boolean) => void;
  handleSubmit: (e: React.FormEvent) => void;
}

const SignUpForm: FC<Props> = ({
  email,
  password,
  confirmPassword,
  nama_petugas,
  nama_vendor,
  alamat,
  no_telp,
  showPassword,
  showConfirmPassword,
  agreeToTerms,
  error,
  isLoading,
  setEmail,
  setPassword,
  setConfirmPassword,
  setNamaPetugas,
  setNamaVendor,
  setAlamat,
  setNoTelp,
  setShowPassword,
  setShowConfirmPassword,
  setAgree,
  handleSubmit,
}) => (
  <div className="min-h-screen flex">
    {/* Left Section - Welcome & Branding */}
    <div className="hidden lg:flex lg:w-1/2 bg-blue-600 relative">
      <div className="flex flex-col justify-center items-center w-full text-white">
         <div className="text-center w-full" style={{ marginTop: '-10rem' }}>
          <div className="mb-15 flex w-full bg-white p-5 justify-center">
            <Image
              src="/assets/logo.svg"
              alt="Logo SIMLOK"
              width={200}
              height={90}
              className="object-contain drop-shadow-lg"
            />
          </div>
          
          {/* SIMLOK Title */}
          <h1 className="text-6xl font-bold mb-6 tracking-wide text-white">
            SIMLOK
          </h1>
          <p className="text-xl text-white font-light tracking-wide leading-relaxed">
            Sistem Informasi Manajemen Lokasi Kerja Pertamina
          </p>
        </div>
      </div>
    </div>

    {/* Right Section - Sign Up Form */}
    <div className="w-full lg:w-1/2 flex flex-col bg-white h-screen overflow-y-auto">
      <div className="flex-1 flex flex-col justify-center p-4 lg:p-6">
        <div className="w-full max-w-lg mx-auto">
          <div className="lg:hidden flex justify-center mb-6">
            <Image
              src="/assets/logo.svg"
              alt="Logo SIMLOK"
              width={200}
              height={90}
              className="object-contain"
            />
          </div>

          <div className="w-full">
            <div className="mb-4">
              <h1 className="text-lg font-bold text-gray-900 mb-1">Daftar Akun Vendor</h1>
              <p className="text-gray-600 text-xs">
                Lengkapi formulir untuk mendaftar sebagai vendor SIMLOK
              </p>
            </div>

            {error && (
              <div className="mb-3 p-2 bg-red-50 border border-red-200 rounded-lg">
                <p className="text-xs text-red-800">{error}</p>
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-3">
              <div className="space-y-3">
                <h3 className="text-sm font-semibold text-gray-900">Informasi Petugas</h3>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      Nama Petugas <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="nama_petugas"
                      name="nama_petugas"
                      type="text"
                      value={nama_petugas}
                      onChange={(e) => setNamaPetugas(e.target.value)}
                      placeholder="Ahmad Budi"
                      required
                      disabled={isLoading}
                      className="mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500"
                    />
                  </div>

                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      Email <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="email"
                      name="email"
                      type="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      placeholder="email@perusahaan.com"
                      required
                      disabled={isLoading}
                      className="mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      No. Telepon <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="no_telp"
                      name="no_telp"
                      type="tel"
                      value={no_telp}
                      onChange={(e) => setNoTelp(e.target.value)}
                      placeholder="08123456789"
                      required
                      disabled={isLoading}
                      className="mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500"
                    />
                  </div>

                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      Nama Vendor <span className="text-red-500">*</span>
                    </Label>
                    <Input
                      id="nama_vendor"
                      name="nama_vendor"
                      type="text"
                      value={nama_vendor}
                      onChange={(e) => setNamaVendor(e.target.value)}
                      placeholder="PT. Nama Perusahaan"
                      required
                      disabled={isLoading}
                      className="mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500"
                    />
                  </div>
                </div>

                <div>
                  <Label className="text-gray-700 font-medium text-xs">
                    Alamat Perusahaan <span className="text-red-500">*</span>
                  </Label>
                  <textarea
                    value={alamat}
                    onChange={(e) => {
                      const value = e.target.value;
                      // Validasi alamat: hanya huruf, angka, spasi, koma, titik, tanda hubung
                      if (/^[a-zA-Z0-9\s,./-]*$/.test(value)) {
                        setAlamat(value);
                      }
                    }}
                    placeholder="Jalan, Nomor, Kelurahan, Kecamatan, Kota"
                    required
                    disabled={isLoading}
                    rows={2}
                    className="mt-1 w-full h-24 px-4 py-3 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed resize-none"
                  />
                </div>
              </div>

              <div className="space-y-3 pt-3 border-t border-gray-200">
                <h3 className="text-sm font-semibold text-gray-900">Keamanan Akun</h3>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      Password <span className="text-red-500">*</span>
                    </Label>
                    <div className="relative mt-1">
                      <input
                        type={showPassword ? "text" : "password"}
                        placeholder="Min 8 karakter"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        required
                        minLength={8}
                        disabled={isLoading}
                        className="w-full h-11 px-4 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed"
                      />
                      <button
                        type="button"
                        onClick={() => setShowPassword(!showPassword)}
                        className="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                      >
                        {showPassword ? (
                          <EyeSlashIcon className="w-3 h-3" />
                        ) : (
                          <EyeIcon className="w-3 h-3" />
                        )}
                      </button>
                    </div>
                  </div>

                  <div>
                    <Label className="text-gray-700 font-medium text-xs">
                      Konfirmasi <span className="text-red-500">*</span>
                    </Label>
                    <div className="relative mt-1">
                      <input
                        type={showConfirmPassword ? "text" : "password"}
                        placeholder="Ulangi password"
                        value={confirmPassword}
                        onChange={(e) => setConfirmPassword(e.target.value)}
                        required
                        minLength={8}
                        disabled={isLoading}
                        className="w-full h-11 px-4 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed"
                      />
                      <button
                        type="button"
                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                        className="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"
                      >
                        {showConfirmPassword ? (
                          <EyeSlashIcon className="w-3 h-3" />
                        ) : (
                          <EyeIcon className="w-3 h-3" />
                        )}
                      </button>
                    </div>
                  </div>
                </div>

                {password !== confirmPassword && confirmPassword && (
                  <p className="text-xs text-red-600 mt-1">
                    Password tidak sama
                  </p>
                )}
              </div>

              <div className="flex items-start gap-2 pt-3">
                <Checkbox
                  checked={agreeToTerms}
                  onChange={setAgree}
                  label=""
                  disabled={isLoading}
                />
                <span className="text-xs text-gray-700">
                  Saya menyetujui{" "}
                  <Link href="/terms" className="text-blue-600 hover:text-blue-800 underline">
                    Syarat dan Ketentuan
                  </Link>{" "}
                  serta{" "}
                  <Link href="/privacy" className="text-blue-600 hover:text-blue-800 underline">
                    Kebijakan Privasi
                  </Link>{" "}
                  yang berlaku. <span className="text-red-500">*</span>
                </span>
              </div>

              <Button 
                className="w-full h-9 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm disabled:opacity-50" 
                type="submit"
                disabled={isLoading || !agreeToTerms || password !== confirmPassword}
              >
                {isLoading ? (
                  <div className="flex items-center justify-center">
                    <div className="animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-1"></div>
                    Mendaftar...
                  </div>
                ) : (
                  "Daftar sebagai Vendor"
                )}
              </Button>
            </form>

            <div className="mt-4 pt-3 border-t border-gray-200">
              <p className="text-center text-gray-600 text-xs">
                Sudah memiliki akun?{" "}
                <Link 
                  href="/login" 
                  className="text-blue-600 hover:text-blue-800 font-medium"
                >
                  Masuk di sini
                </Link>
              </p>
            </div>
          </div>

          {/* <div className="mt-3 text-center text-xs text-gray-500">
            <p>© 2025 Pertamina. Seluruh hak cipta dilindungi.</p>
          </div> */}
        </div>
      </div>
    </div>
  </div>
);

export default SignUpForm;


=== FILE: src/components/common/DetailSection.tsx ===
'use client';

import { ReactNode } from 'react';
import { ChevronDownIcon, ChevronRightIcon } from '@heroicons/react/24/outline';
import { useState } from 'react';

interface DetailSectionProps {
  title: string;
  children: ReactNode;
  icon?: ReactNode;
  defaultOpen?: boolean;
  collapsible?: boolean;
  badge?: ReactNode;
  className?: string;
}

export default function DetailSection({
  title,
  children,
  icon,
  defaultOpen = true,
  collapsible = false,
  badge,
  className = ''
}: DetailSectionProps) {
  const [isOpen, setIsOpen] = useState(defaultOpen);

  return (
    <div className={`bg-white border border-gray-200 rounded-lg shadow-sm ${className}`}>
      <div 
        className={`flex items-center justify-between p-4 ${
          collapsible ? 'cursor-pointer hover:bg-gray-50' : ''
        } border-b border-gray-100`}
        onClick={collapsible ? () => setIsOpen(!isOpen) : undefined}
      >
        <div className="flex items-center space-x-3">
          {icon && <div className="flex-shrink-0">{icon}</div>}
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          {badge && <div className="flex-shrink-0">{badge}</div>}
        </div>
        
        {collapsible && (
          <div className="flex-shrink-0">
            {isOpen ? (
              <ChevronDownIcon className="h-5 w-5 text-gray-500" />
            ) : (
              <ChevronRightIcon className="h-5 w-5 text-gray-500" />
            )}
          </div>
        )}
      </div>
      
      {(!collapsible || isOpen) && (
        <div className="p-4">
          {children}
        </div>
      )}
    </div>
  );
}


=== FILE: src/components/common/DocumentPreviewModal.tsx ===
'use client';

import { useEffect, useState } from 'react';
import { XMarkIcon, ArrowTopRightOnSquareIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';
import LoadingSpinner from '../ui/LoadingSpinner';

interface DocumentPreviewModalProps {
  isOpen: boolean;
  onClose: () => void;
  fileUrl: string;
  fileName: string;
  fileType?: string;
}

export default function DocumentPreviewModal({ 
  isOpen, 
  onClose, 
  fileUrl, 
  fileName, 
  fileType 
}: DocumentPreviewModalProps) {
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Handle escape key press
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      // Prevent body scroll when modal is open
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  // Reset states when modal opens
  useEffect(() => {
    if (isOpen) {
      setLoading(true);
      setError(null);
    }
  }, [isOpen, fileUrl]);

  if (!isOpen) return null;

  // Determine file type from URL or provided type
  const determineFileType = (url: string, type?: string): string => {
    if (type) return type.toLowerCase();
    
    const extension = url.split('.').pop()?.toLowerCase() || '';
    
    if (['pdf'].includes(extension)) return 'pdf';
    if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension)) return 'image';
    if (['doc', 'docx'].includes(extension)) return 'document';
    
    return 'unknown';
  };

  const detectedFileType = determineFileType(fileUrl, fileType);

  const handleDownload = () => {
    const link = document.createElement('a');
    link.href = fileUrl;
    link.download = fileName;
    link.target = '_blank';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const handleOpenInNewTab = () => {
    window.open(fileUrl, '_blank');
  };

  const renderPreviewContent = () => {
    if (error) {
      return (
        <div className="flex-1 flex items-center justify-center">
          <div className="text-center">
            <div className="text-red-500 text-lg mb-2">!</div>
            <p className="text-gray-600">{error}</p>
            <button
              onClick={handleOpenInNewTab}
              className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
            >
              Buka di Tab Baru
            </button>
          </div>
        </div>
      );
    }

    switch (detectedFileType) {
      case 'pdf':
        return (
          <div className="flex-1 relative">
            {loading && (
              <div className="absolute inset-0 flex items-center justify-center bg-gray-50">
                <div className="text-center">
                  <LoadingSpinner size="lg" className="mx-auto mb-4" />
                  <p className="text-gray-600">Memuat dokumen...</p>
                </div>
              </div>
            )}
            <iframe
              src={fileUrl}
              className="w-full h-full border-0"
              title={fileName}
              onLoad={() => setLoading(false)}
              onError={() => {
                setLoading(false);
                setError('Gagal memuat dokumen PDF');
              }}
            />
          </div>
        );

      case 'image':
        return (
          <div className="flex-1 flex items-center justify-center p-4 bg-gray-50">
            {loading && (
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="text-center">
                  <LoadingSpinner size="lg" className="mx-auto mb-4" />
                  <p className="text-gray-600">Memuat gambar...</p>
                </div>
              </div>
            )}
            <img
              src={fileUrl}
              alt={fileName}
              className="max-w-full max-h-full object-contain"
              onLoad={() => setLoading(false)}
              onError={() => {
                setLoading(false);
                setError('Gagal memuat gambar');
              }}
            />
          </div>
        );

      case 'document':
        return (
          <div className="flex-1 flex items-center justify-center">
            <div className="text-center">
              <div className="text-6xl mb-4">📄</div>
              <p className="text-gray-600 mb-4">
                Dokumen Word tidak dapat ditampilkan langsung.
              </p>
              <div className="space-x-4">
                <button
                  onClick={handleDownload}
                  className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
                >
                  Download Dokumen
                </button>
                <button
                  onClick={handleOpenInNewTab}
                  className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                >
                  Buka di Tab Baru
                </button>
              </div>
            </div>
          </div>
        );

      default:
        return (
          <div className="flex-1 flex items-center justify-center">
            <div className="text-center">
              <div className="text-6xl mb-4">📎</div>
              <p className="text-gray-600 mb-4">
                File ini tidak dapat ditampilkan langsung.
              </p>
              <div className="space-x-4">
                <button
                  onClick={handleDownload}
                  className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
                >
                  Download File
                </button>
                <button
                  onClick={handleOpenInNewTab}
                  className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                >
                  Buka di Tab Baru
                </button>
              </div>
            </div>
          </div>
        );
    }
  };

  return (
    <div className="fixed inset-0 z-50 overflow-hidden">
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/50 transition-opacity"
        onClick={onClose}
      />
      
      {/* Modal */}
      <div className="flex min-h-full items-center justify-center p-2">
        <div className="relative bg-white rounded-lg shadow-xl w-full max-w-7xl h-[95vh] flex flex-col">
          
          {/* Header - Fixed */}
          <div className="bg-white flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0">
            <div className="flex items-center space-x-4">
              <h3 className="text-lg font-semibold text-gray-900 truncate max-w-md">
                {fileName}
              </h3>
              <span className="text-sm text-gray-500 capitalize">
                {detectedFileType}
              </span>
            </div>
            
            {/* Action buttons */}
            <div className="flex items-center space-x-2">
              <button
                onClick={handleDownload}
                className="p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100"
                title="Download"
              >
                <ArrowDownTrayIcon className="w-5 h-5" />
              </button>
              
              <button
                onClick={handleOpenInNewTab}
                className="p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100"
                title="Buka di Tab Baru"
              >
                <ArrowTopRightOnSquareIcon className="w-5 h-5" />
              </button>
              
              <button
                onClick={onClose}
                className="p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100"
                title="Tutup"
              >
                <XMarkIcon className="w-5 h-5" />
              </button>
            </div>
          </div>

          {/* Content - Scrollable */}
          <div className="bg-white flex-1 overflow-hidden flex flex-col">
            {renderPreviewContent()}
          </div>


        </div>
      </div>
    </div>
  );
}


=== FILE: src/components/common/InfoCard.tsx ===
'use client';

import { ReactNode } from 'react';

interface InfoCardProps {
  label: string;
  value: string | ReactNode;
  icon?: ReactNode;
  copyable?: boolean;
  className?: string;
  valueClassName?: string;
}

export default function InfoCard({
  label,
  value,
  icon,
  copyable = false,
  className = '',
  valueClassName = ''
}: InfoCardProps) {
  const handleCopy = async () => {
    if (copyable && typeof value === 'string') {
      try {
        await navigator.clipboard.writeText(value);
        // You could add a toast notification here
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    }
  };

  return (
    <div className={`space-y-1 ${className}`}>
      <div className="flex items-center space-x-2">
        {icon && <div className="flex-shrink-0">{icon}</div>}
        <label className="text-sm font-semibold text-gray-700">
          {label}
        </label>
      </div>
      
      <div className={`group relative ${copyable ? 'cursor-pointer' : ''}`} onClick={copyable ? handleCopy : undefined}>
        {typeof value === 'string' ? (
          <p className={`text-sm font-normal text-gray-900 ${copyable ? 'hover:text-blue-600' : ''} ${valueClassName}`}>
            {value || '-'}
          </p>
        ) : (
          <div className={valueClassName}>
            {value}
          </div>
        )}
        
        {copyable && typeof value === 'string' && value && (
          <span className="absolute top-0 left-full ml-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-500">
            Klik untuk copy
          </span>
        )}
      </div>
    </div>
  );
}


=== FILE: src/components/common/RealtimeUpdates.tsx ===
import { useEffect, useRef } from 'react';
import { io, Socket } from 'socket.io-client';

let socket: Socket | null = null;

// Temporarily disable Socket.IO until server is properly configured
const SOCKET_ENABLED = process.env.NODE_ENV === 'development' && false; // Disabled for now

export const initSocket = () => {
  if (!socket && SOCKET_ENABLED) {
    socket = io(process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3000', {
      path: '/api/socket',
      addTrailingSlash: false,
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionAttempts: 5,
      timeout: 20000,
      transports: ['websocket', 'polling'], // Fallback to polling if websocket fails
    });
  }
  return socket;
};

export const getSocket = () => socket;

export const useSocket = () => {
  const socketRef = useRef<Socket | null>(null);

  useEffect(() => {
    if (!SOCKET_ENABLED) {
      return;
    }

    if (!socketRef.current) {
      socketRef.current = initSocket();
    }

    const currentSocket = socketRef.current;
    if (!currentSocket) return;

    const handleConnect = () => {
      console.log('Connected to socket server');
    };

    const handleDisconnect = (reason: string) => {
      console.log('Disconnected from socket server:', reason);
    };

    const handleError = (error: any) => {
      console.error('Socket error:', error);
    };

    const handleConnectError = (error: any) => {
      console.error('Socket connection error:', error);
    };

    const handleReconnect = (attemptNumber: number) => {
      console.log('Socket reconnected after', attemptNumber, 'attempts');
    };

    const handleReconnectError = (error: any) => {
      console.error('Socket reconnection error:', error);
    };

    currentSocket.on('connect', handleConnect);
    currentSocket.on('disconnect', handleDisconnect);
    currentSocket.on('error', handleError);
    currentSocket.on('connect_error', handleConnectError);
    currentSocket.on('reconnect', handleReconnect);
    currentSocket.on('reconnect_error', handleReconnectError);

    return () => {
      if (!currentSocket) return;
      currentSocket.off('connect', handleConnect);
      currentSocket.off('disconnect', handleDisconnect);
      currentSocket.off('error', handleError);
      currentSocket.off('connect_error', handleConnectError);
      currentSocket.off('reconnect', handleReconnect);
      currentSocket.off('reconnect_error', handleReconnectError);
    };
  }, []);

  return SOCKET_ENABLED ? socketRef.current : null;
};


=== FILE: src/components/common/SimlokPdfModal.tsx ===
'use client';

import { useEffect, useMemo, useRef, useState } from 'react';
import { XMarkIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';
import LoadingSpinner from '../ui/LoadingSpinner';

interface SimlokPdfModalProps {
  isOpen: boolean;
  onClose: () => void;
  submissionId: string;
  submissionName: string;
  nomorSimlok?: string;
}

export default function SimlokPdfModal({
  isOpen,
  onClose,
  submissionId,
  submissionName,
  nomorSimlok,
}: SimlokPdfModalProps) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [pdfUrl, setPdfUrl] = useState<string | null>(null); // <-- ubah: null, bukan ""
  const objectUrlRef = useRef<string | null>(null); // untuk blob URL cleanup

  // Cleanup object URL ketika modal ditutup/unmount
  useEffect(() => {
    return () => {
      if (objectUrlRef.current) {
        URL.revokeObjectURL(objectUrlRef.current);
        objectUrlRef.current = null;
      }
    };
  }, []);

  // Esc key + body scroll lock
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose();
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  // Siapkan URL/pdf saat modal dibuka, cleanup saat ditutup
  useEffect(() => {
    let cancelled = false;

    async function prepare() {
      if (!isOpen || !submissionId) {
        // Reset state when modal is closed
        setPdfUrl(null);
        setError(null);
        setLoading(true);
        return;
      }

      setLoading(true);
      setError(null);

      // bersihkan object URL lama
      if (objectUrlRef.current) {
        URL.revokeObjectURL(objectUrlRef.current);
        objectUrlRef.current = null;
      }
      setPdfUrl(null);

      try {
        // Pakai timestamp supaya bypass cache dan clear server cache
        const t = Date.now();
        const apiUrl = `/api/submissions/${encodeURIComponent(
          submissionId
        )}?format=pdf&t=${t}&clearCache=true`;

        console.log('SimlokPdfModal: Requesting PDF from:', apiUrl);

        // Kalau endpoint protected, pakai credentials: 'include'
        // dan mode 'same-origin' (default) supaya cookie terkirim
        const res = await fetch(apiUrl, {
          method: 'GET',
          credentials: 'include',
          cache: 'no-store', // Force no caching
        });

        if (!res.ok) {
          // Try to get error details from response
          try {
            const errorData = await res.json();
            throw new Error(errorData.error || `Gagal memuat PDF (${res.status})`);
          } catch (jsonError) {
            throw new Error(`Gagal memuat PDF (${res.status})`);
          }
        }

        console.log('SimlokPdfModal: PDF response received successfully');

        // Gunakan blob -> object URL agar:
        // - lebih stabil di berbagai browser
        // - bisa di-print/download tanpa kebijakan CORS aneh
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        objectUrlRef.current = url;

        console.log('SimlokPdfModal: PDF blob URL created:', url);

        if (!cancelled) {
          setPdfUrl(url);
          setLoading(false);
          setError(null);
        }
      } catch (e: any) {
        console.error('SimlokPdfModal: Error loading PDF:', e);
        if (!cancelled) {
          setError(e?.message || 'Gagal memuat dokumen PDF SIMLOK.');
          setLoading(false);
        }
      }
    }

    prepare();

    return () => {
      cancelled = true;
    };
  }, [isOpen, submissionId]);

  // Generate filename (must be before early return to avoid hook order issues)
  const filename = useMemo(() => {
    if (nomorSimlok) return `SIMLOK_${nomorSimlok.replace(/[/\\]/g, '_')}.pdf`;
    return `SIMLOK_${submissionName.replace(/[/\\]/g, '_')}.pdf`;
  }, [nomorSimlok, submissionName]);

  if (!isOpen) return null;

  const handleDownload = async () => {
    try {
      setError(null);

      // Jika kita sudah punya blob URL, kita bisa fetch ulang BLOB-nya dari URL asli
      // atau langsung pakai fetch API lagi supaya dapat file fresh.
      // Lebih konsisten: refetch dari endpoint (agar bukan blob object sementara).
      const t = Date.now();
      const apiUrl = `/api/submissions/${encodeURIComponent(
        submissionId
      )}?format=pdf&t=${t}`;

      const res = await fetch(apiUrl, {
        method: 'GET',
        credentials: 'include',
      });
      if (!res.ok) throw new Error('Gagal mendownload PDF');

      const blob = await res.blob();
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      URL.revokeObjectURL(url);
    } catch (err) {
      console.error(err);
      setError('Gagal mendownload PDF SIMLOK');
    }
  };

  // Optional: print (bisa gunakan blob URL langsung)
  // const handlePrint = () => {
  //   if (!pdfUrl) return;
  //   const w = window.open(pdfUrl, '_blank');
  //   if (w) {
  //     w.addEventListener('load', () => w.print());
  //   }
  // };

  return (
    <div className="fixed inset-0 z-50 overflow-hidden">
      {/* Backdrop */}
      <div
        className="fixed inset-0 bg-black/60 transition-opacity backdrop-blur-sm"
        onClick={onClose}
      />

      {/* Modal */}
      <div className="flex min-h-full items-center justify-center p-2">
        <div className="relative bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[95vh] flex flex-col">
          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white flex items-center justify-between p-4 rounded-t-lg flex-shrink-0">
            <div className="flex items-center space-x-4">
              <div className="bg-white/20 rounded-lg p-2">
                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fillRule="evenodd"
                    d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                    clipRule="evenodd"
                  />
                </svg>
              </div>
              <div>
                <h3 className="text-lg font-semibold">Dokumen SIMLOK</h3>
                <p className="text-sm text-blue-100">
                  {nomorSimlok ? `No: ${nomorSimlok}` : submissionName}
                </p>
              </div>
            </div>

            <div className="flex items-center space-x-2">
              {/* <button
                onClick={handlePrint}
                disabled={Boolean(loading || error || !pdfUrl)}
                className="p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                title="Print PDF"
              >
                <PrinterIcon className="w-5 h-5" />
              </button> */}
              <button
                onClick={handleDownload}
                disabled={Boolean(loading || error)}
                className="p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                title="Download PDF"
              >
                <ArrowDownTrayIcon className="w-5 h-5" />
              </button>

              <div className="w-px h-6 bg-white/20 mx-2" />

              <button
                onClick={onClose}
                className="p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full"
                title="Tutup"
              >
                <XMarkIcon className="w-5 h-5" />
              </button>
            </div>
          </div>

          {/* Content */}
          <div className="flex-1 relative bg-gray-100">
            {/* Overlay loading */}
            {loading && (
              <div className="absolute inset-0 flex items-center justify-center bg-white/90 z-10">
                <div className="text-center">
                  <LoadingSpinner size="lg" className="mx-auto mb-4" />
                  <p className="text-gray-700 font-medium">Memuat dokumen SIMLOK...</p>
                  <p className="text-sm text-gray-500 mt-2">Mohon tunggu sebentar</p>
                </div>
              </div>
            )}

            {/* Error state */}
            {error && (
              <div className="absolute inset-0 flex items-center justify-center bg-gray-50">
                <div className="text-center p-8">
                  <div className="text-red-500 text-6xl mb-4">!</div>
                  <h3 className="text-lg font-medium text-gray-900 mb-2">Gagal Memuat PDF</h3>
                  <p className="text-gray-600 mb-4">{error}</p>
                  <div className="space-x-4">
                    <button
                      onClick={() => {
                        // trigger ulang effect dengan toggle isOpen sebentar
                        setError(null);
                        // force reload dengan ganti submissionId param waktu
                        // (cukup biarkan effect di atas jalan otomatis saat error==null + isOpen true)
                        const t = Date.now();
                        const apiUrl = `/api/submissions/${encodeURIComponent(
                          submissionId
                        )}?format=pdf&t=${t}`;
                        setLoading(true);
                        fetch(apiUrl, { credentials: 'include' })
                          .then(r => {
                            if (!r.ok) throw new Error('Gagal memuat ulang');
                            return r.blob();
                          })
                          .then(b => {
                            if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current);
                            const url = URL.createObjectURL(b);
                            objectUrlRef.current = url;
                            setPdfUrl(url);
                            setLoading(false);
                          })
                          .catch(e => {
                            setLoading(false);
                            setError(e?.message || 'Gagal memuat ulang dokumen');
                          });
                      }}
                      className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                    >
                      Coba Lagi
                    </button>
                    <button
                      onClick={onClose}
                      className="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors"
                    >
                      Tutup
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Hanya render iframe saat pdfUrl siap */}
            {!error && pdfUrl && pdfUrl.trim() !== '' && (
              <iframe
                key={pdfUrl} // re-mount saat URL berubah
                src={pdfUrl}
                className="w-full h-full border-0"
                title={`SIMLOK - ${submissionName}`}
                onLoad={() => {
                  // sebagian browser tidak memanggil ini untuk blob URL; tidak masalah
                  setLoading(false);
                }}
              />
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


=== FILE: src/components/common/WorkersList.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { 
  UserIcon, 
  PhotoIcon, 
  EyeIcon,
  CheckCircleIcon,
  XCircleIcon,
  XMarkIcon 
} from '@heroicons/react/24/outline';
import { fileUrlHelper } from '@/lib/fileUrlHelper';

interface Worker {
  id: string;
  worker_name: string;
  worker_photo: string | null;
  submission_id: string;
  created_at: string;
}

interface WorkersListProps {
  submissionId: string;
  fallbackWorkers?: string;
  layout?: 'grid' | 'list';
  showPhotos?: boolean;
  maxDisplayCount?: number;
  verificationMode?: boolean;
  className?: string;
  // Context for different API endpoints
  context?: 'vendor' | 'reviewer' | 'admin' | 'approver';
}

export default function WorkersList({ 
  submissionId, 
  fallbackWorkers = '', 
  layout = 'grid',
  showPhotos = true,
  maxDisplayCount = 6,
  verificationMode = false,
  className = '',
  context = 'vendor',
}: WorkersListProps) {
  const [workers, setWorkers] = useState<Worker[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [imageErrors, setImageErrors] = useState<Set<string>>(new Set());
  const [selectedImage, setSelectedImage] = useState<string | null>(null);
  const [showAll, setShowAll] = useState(false);

  useEffect(() => {
    const fetchWorkers = async () => {
      if (!submissionId) {
        setLoading(false);
        return;
      }

      try {
        // Choose the correct API endpoint based on context
        let apiUrl = '';
        switch (context) {
          case 'approver':
            apiUrl = `/api/approver/simloks/${submissionId}/workers`;
            break;
          case 'reviewer':
            apiUrl = `/api/reviewer/simloks/${submissionId}/workers`;
            break;
          case 'admin':
            apiUrl = `/api/admin/simloks/${submissionId}/workers`;
            break;
          case 'vendor':
          default:
            apiUrl = `/api/submissions/${submissionId}/workers`;
            break;
        }

        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error('Failed to fetch workers');
        }
        const data = await response.json();
        setWorkers(data.workers || []);
      } catch (err) {
        console.error('Error fetching workers:', err);
        setError(err instanceof Error ? err.message : 'Unknown error');
        
        // Fallback: parse fallback workers string
        if (fallbackWorkers) {
          const fallbackWorkersList = fallbackWorkers.split(',').map((name, index) => ({
            id: `fallback-${index}`,
            worker_name: name.trim(),
            worker_photo: null,
            submission_id: submissionId,
            created_at: new Date().toISOString(),
          }));
          setWorkers(fallbackWorkersList);
        }
      } finally {
        setLoading(false);
      }
    };

    fetchWorkers();
  }, [submissionId, fallbackWorkers, context]);

  const handleImageError = (workerId: string) => {
    setImageErrors(prev => new Set([...prev, workerId]));
  };

  const handleImageClick = (imageUrl: string) => {
    if (imageUrl) {
      setSelectedImage(imageUrl);
    }
  };

  const closeModal = () => {
    setSelectedImage(null);
  };

  if (loading) {
    return (
      <div className={`animate-pulse ${className}`}>
        <div className="flex items-center space-x-3 mb-3">
          <div className="h-4 bg-gray-200 rounded w-24"></div>
          <div className="h-4 bg-gray-200 rounded w-16"></div>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {[1, 2, 3].map((i) => (
            <div key={i} className="bg-gray-50 rounded-lg p-4">
              <div className="flex items-center space-x-3">
                <div className="h-12 w-12 bg-gray-200 rounded-full"></div>
                <div className="flex-1">
                  <div className="h-4 bg-gray-200 rounded mb-2"></div>
                  <div className="h-3 bg-gray-200 rounded w-3/4"></div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  if (error && workers.length === 0) {
    return (
      <div className={`text-center py-6 ${className}`}>
        <UserIcon className="h-12 w-12 text-gray-400 mx-auto mb-3" />
        <p className="text-gray-500">Gagal memuat data pekerja</p>
        <p className="text-sm text-gray-400 mt-1">{error}</p>
      </div>
    );
  }

  if (workers.length === 0) {
    return (
      <div className={`text-center py-6 ${className}`}>
        <UserIcon className="h-12 w-12 text-gray-400 mx-auto mb-3" />
        <p className="text-gray-500">Belum ada data pekerja</p>
      </div>
    );
  }

  const displayedWorkers = showAll || !maxDisplayCount ? workers : workers.slice(0, maxDisplayCount);
  const remainingCount = workers.length - (maxDisplayCount || 0);

  return (
    <div className={className}>
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center space-x-2">
          <span className="text-sm font-medium text-gray-700">
            Jumlah pekerja ({workers.length} orang)
          </span>
          {verificationMode && (
            <span className="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
              Mode Verifikasi
            </span>
          )}
        </div>
        
        {maxDisplayCount && workers.length > maxDisplayCount && (
          <button
            onClick={() => setShowAll(!showAll)}
            className="text-blue-600 hover:text-blue-700 text-sm font-medium"
          >
            {showAll ? 'Tampilkan Lebih Sedikit' : `Lihat Semua (+${remainingCount})`}
          </button>
        )}
      </div>

      {/* Workers Display */}
      {layout === 'grid' ? (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
          {displayedWorkers.map((worker) => (
            <div
              key={worker.id}
              className={`bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border ${
                verificationMode 
                  ? 'border-purple-200 hover:border-purple-300' 
                  : 'border-gray-100 hover:border-gray-200'
              }`}
            >
              {/* Photo Section - Large and prominent */}
              <div className="relative p-4 pb-2">
                {showPhotos && (
                  <div className="relative">
                    {worker.worker_photo && !imageErrors.has(worker.id) ? (
                      <img
                        src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}
                        alt={`Foto ${worker.worker_name}`}
                        className="w-full h-48 rounded-lg object-cover cursor-pointer hover:scale-105 transition-transform duration-200 shadow-sm"
                        onError={() => handleImageError(worker.id)}
                        onClick={() => handleImageClick(worker.worker_photo!)}
                        title="Klik untuk memperbesar"
                      />
                    ) : (
                      <div className="w-full h-48 rounded-lg bg-gray-100 flex flex-col items-center justify-center shadow-sm">
                        {worker.worker_photo ? (
                          <>
                            <PhotoIcon className="h-12 w-12 text-gray-400 mb-2" />
                            <span className="text-xs text-gray-500">Gagal memuat foto</span>
                          </>
                        ) : (
                          <>
                            <UserIcon className="h-12 w-12 text-gray-400 mb-2" />
                            <span className="text-xs text-gray-500">Tidak ada foto</span>
                          </>
                        )}
                      </div>
                    )}
                    
                    {/* Status indicator */}
                    <div className={`absolute top-2 right-2 w-3 h-3 rounded-full border-2 border-white ${
                      worker.worker_photo && !imageErrors.has(worker.id)
                        ? 'bg-green-500' 
                        : 'bg-orange-500'
                    }`}></div>
                    
                    {/* Verification badge */}
                    {verificationMode && (
                      <div className="absolute top-2 left-2 w-6 h-6 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center">
                        <EyeIcon className="h-3 w-3 text-white" />
                      </div>
                    )}
                  </div>
                )}
              </div>

              {/* Content Section - Name and details below photo */}
              <div className="p-4 pt-2">
                <h2 className="font-semibold text-gray-900 text-base mb-1">
                  {worker.worker_name}
                </h2>

                {/* Verification Actions */}
                {verificationMode && (
                  <div className="flex justify-center space-x-2 pt-3 border-t border-gray-100">
                    <button 
                      className="flex items-center justify-center w-8 h-8 text-green-600 hover:bg-green-50 rounded-full transition-colors"
                      title="Verifikasi Valid"
                    >
                      <CheckCircleIcon className="h-5 w-5" />
                    </button>
                    <button 
                      className="flex items-center justify-center w-8 h-8 text-red-600 hover:bg-red-50 rounded-full transition-colors"
                      title="Perlu Koreksi"
                    >
                      <XCircleIcon className="h-5 w-5" />
                    </button>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div className="space-y-4">
          {displayedWorkers.map((worker, index) => (
            <div
              key={worker.id}
              className={`flex items-center space-x-4 p-4 bg-white border rounded-xl hover:shadow-md transition-all duration-200 ${
                verificationMode 
                  ? 'border-purple-200 hover:border-purple-300' 
                  : 'border-gray-100 hover:border-gray-200'
              }`}
            >
              {/* Number */}
              <div className="flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                <span className="text-sm font-medium text-gray-600">
                  {index + 1}
                </span>
              </div>
              
              {/* Photo */}
              {showPhotos && (
                <div className="flex-shrink-0 relative">
                  {worker.worker_photo && !imageErrors.has(worker.id) ? (
                    <img
                      src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}
                      alt={`Foto ${worker.worker_name}`}
                      className="h-12 w-12 rounded-lg object-cover border-2 border-gray-200 cursor-pointer hover:border-blue-400 transition-colors shadow-sm"
                      onError={() => handleImageError(worker.id)}
                      onClick={() => handleImageClick(worker.worker_photo!)}
                      title="Klik untuk memperbesar"
                    />
                  ) : (
                    <div className="h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-gray-200">
                      {worker.worker_photo ? (
                        <PhotoIcon className="h-6 w-6 text-gray-400" />
                      ) : (
                        <UserIcon className="h-6 w-6 text-gray-400" />
                      )}
                    </div>
                  )}
                  
                  {/* Status indicator */}
                  <div className={`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${
                    worker.worker_photo && !imageErrors.has(worker.id)
                      ? 'bg-green-500' 
                      : 'bg-orange-500'
                  }`}></div>
                  
                  {verificationMode && (
                    <div className="absolute -top-1 -left-1 w-4 h-4 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center">
                      <EyeIcon className="h-2.5 w-2.5 text-white" />
                    </div>
                  )}
                </div>
              )}
              
              {/* Worker Info */}
              <div className="flex-1 min-w-0">
                <h3 className="text-base font-medium text-gray-900 truncate">
                  {worker.worker_name}
                </h3>
                <p className="text-sm text-gray-500">
                  Pekerja #{index + 1}
                </p>
              </div>
              
              {/* Status Badge */}
              <div className="flex-shrink-0">
                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  worker.worker_photo && !imageErrors.has(worker.id)
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-orange-100 text-orange-800'
                }`}>
                  <div className={`w-2 h-2 rounded-full mr-1.5 ${
                    worker.worker_photo && !imageErrors.has(worker.id)
                      ? 'bg-green-400' 
                      : 'bg-orange-400'
                  }`}></div>
                  {worker.worker_photo && !imageErrors.has(worker.id) 
                    ? 'Foto Tersedia' 
                    : 'Tanpa Foto'}
                </span>
              </div>

              {/* Verification Actions */}
              {verificationMode && (
                <div className="flex space-x-2 flex-shrink-0">
                  <button 
                    className="p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors"
                    title="Verifikasi Valid"
                  >
                    <CheckCircleIcon className="h-5 w-5" />
                  </button>
                  <button 
                    className="p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors"
                    title="Perlu Koreksi"
                  >
                    <XCircleIcon className="h-5 w-5" />
                  </button>
                </div>
              )}
            </div>
          ))}
        </div>
      )}

      {/* Photo Modal for worker photos */}
      {selectedImage && (
        <div className="fixed inset-0 z-50 overflow-y-auto">
          {/* Backdrop */}
          <div
            className="fixed inset-0 bg-black/75 transition-opacity"
            onClick={closeModal}
          />
          
          {/* Modal */}
          <div className="flex min-h-full items-center justify-center p-4">
            <div className="relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden">
              <button
                onClick={closeModal}
                className="absolute top-2 right-2 z-10 bg-white hover:bg-gray-100 rounded-full p-2 shadow-lg transition-colors"
              >
                <XMarkIcon className="h-6 w-6" />
              </button>
              <img
                src={selectedImage}
                alt="Preview"
                className="max-w-full max-h-[90vh] object-contain"
              />
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


=== FILE: src/components/dashboard/DashboardMainContent.tsx ===
"use client";

import { useSession } from "next-auth/react";
import { PlusIcon, ChartPieIcon, ClockIcon, ArrowTrendingUpIcon } from "@heroicons/react/24/outline";
import Card from "../ui/Card";
import { SectionTitle } from "../ui/SectionTitle";
import { Stat } from "../ui/Stat";
import { ActivityList } from "../ui/ActivityList";
import PageHeader from "../layout/PageHeader";

export default function DashboardMainContent() {
  const { data: session } = useSession();
  const role = session?.user.role ?? "VENDOR";

  const stats = [
    { label: "Products", value: 42, icon: ChartPieIcon },
    { label: "Orders", value: 128, icon: ClockIcon },
    { label: "Earnings", value: "$3,210", icon: ArrowTrendingUpIcon },
    { label: "Pending", value: "$450", icon: PlusIcon },
  ];

  const activities = [
    { id: 1, txt: "Order #1234 confirmed", time: "1 m ago" },
    { id: 2, txt: "Charlie left review", time: "1 h ago" },
  ];

  return (
    <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
      {/* Debug info - remove in production */}
      {/* {process.env.NODE_ENV === 'development' && (
        <div className="lg:col-span-3 mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <h3 className="font-semibold text-yellow-800">Debug Session Info:</h3>
          <pre className="text-sm text-yellow-700 mt-2">
            {JSON.stringify({
              userId: session?.user?.id,
              nama_petugas: session?.user?.nama_petugas,
              nama_vendor: session?.user?.nama_vendor,
              role: session?.user?.role,
              email: session?.user?.email,
              isVerified: session?.user?.verified_at ? true : false,
            }, null, 2)}
          </pre>
        </div>
      )} */}
      
      {/* Main column */}
      <div className="space-y-6 lg:col-span-2">
        {/* Header */}
        <PageHeader
          title={`Welcome back, ${session?.user.officer_name ?? session?.user.name ?? "User"}!`}
          subtitle={
            role === "VENDOR" && session?.user.vendor_name 
              ? `${session.user.vendor_name} - You are logged in as ${role.toLowerCase()}.`
              : `You are logged in as ${role.toLowerCase()}.`
          }
          cta={
            <div className="flex gap-2">
              {["Add Product", "View Orders", "Analytics", "Support"].map((a) => (
                <button
                  key={a}
                  className="rounded-full bg-white px-4 py-2 text-sm font-medium text-slate-800 shadow-sm transition hover:bg-slate-100 "
                >
                  {a}
                </button>
              ))}
            </div>
          }
        />

        {/* Stats */}
        <div className="grid grid-cols-2 gap-4 md:grid-cols-4">
          {stats.map((s, i) => (
            <Stat key={i} label={s.label} value={s.value} icon={s.icon as any} />
          ))}
        </div>

        {/* Simple placeholder for chart */}
        <Card className="p-6 bg-white border border-slate-200">
          <SectionTitle right={<ChartPieIcon className="h-5 w-5 text-slate-500" />}>
            Sales Trend
          </SectionTitle>
          <div className="mt-4 h-48 bg-gray-50 rounded-lg flex items-center justify-center">
            <div className="text-center">
              <ChartPieIcon className="h-12 w-12 text-gray-400 mx-auto mb-2" />
              <p className="text-gray-500">Chart will be displayed here</p>
            </div>
          </div>
        </Card>
      </div>

      {/* Sidebar column */}
      <div className="space-y-6">
        {/* Vendor Info - only show for VENDOR role */}
        {role === "VENDOR" && (
          <Card className="p-6 bg-white border border-slate-200">
            <SectionTitle>Informasi Vendor</SectionTitle>
            <div className="space-y-3 mt-4">
              <div>
                <span className="text-sm font-medium text-gray-500">Nama Vendor</span>
                <p className="text-sm text-gray-900 font-semibold">
                  {session?.user.vendor_name || "Belum diisi"}
                </p>
              </div>
              <div>
                <span className="text-sm font-medium text-gray-500">Nama Petugas</span>
                <p className="text-sm text-gray-900">
                  {session?.user.officer_name || session?.user.name || "Belum diisi"}
                </p>
              </div>
              <div>
                <span className="text-sm font-medium text-gray-500">Email</span>
                <p className="text-sm text-gray-900">
                  {session?.user.email || "Belum diisi"}
                </p>
              </div>
            </div>
          </Card>
        )}

        <Card className="p-6 bg-white border border-slate-200">
          <SectionTitle>Recent Activity</SectionTitle>
          <ActivityList items={activities} />
        </Card>

        <Card className="p-6 bg-white border border-slate-200">
          <SectionTitle>Quick Stats</SectionTitle>
          <div className="space-y-3">
            <div className="flex items-center justify-between">
              <span className="text-slate-700">Conversion</span>
              <span className="font-bold text-slate-900">12%</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-slate-700">Avg. Order</span>
              <span className="font-bold text-slate-900">$89</span>
            </div>
          </div>
        </Card>
      </div>
    </div>
  );
}


=== FILE: src/components/dashboard/VendorDashboard.tsx ===
"use client";

import { useSession } from "next-auth/react";
import { useState, useEffect, useCallback } from "react";
import Link from "next/link";
import { 
  ClockIcon,
  PlusIcon,
  CheckCircleIcon,
  XCircleIcon
} from "@heroicons/react/24/outline";
import Card from "../ui/Card";
import { Badge } from "../ui/Badge";
import Button from "../ui/button/Button";
import Alert from "../ui/alert/Alert";
import LoadingSpinner from "../ui/LoadingSpinner";
import ConfirmModal from "../ui/modal/ConfirmModal";
import SubmissionDetailModal from "../vendor/SubmissionDetailModal";
import { useStatsStore } from "@/store/useStatsStore";
import { useSubmissionStore } from "@/store/useSubmissionStore";
import { useSocket } from "@/components/common/RealtimeUpdates";

interface VendorSubmission {
  id: string;
  approval_status: string;
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  signer_position?: string;
  signer_name?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  approvedByUser?: {
    id: string;
    officer_name: string;
    email: string;
  };
}

export default function VendorDashboard() {
  const { data: session } = useSession();
  
  // Use Zustand stores for realtime data
  const { 
    vendorStats,
    loading: statsLoading,
    fetchVendorStats 
  } = useStatsStore();
  
  const { 
    submissions,
    loading: submissionsLoading,
    fetchVendorSubmissions 
  } = useSubmissionStore();
  
  // Initialize Socket.IO connection
  useSocket();

  // Modal state
  const [selectedSubmission, setSelectedSubmission] = useState<VendorSubmission | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  // Alert state
  const [alert, setAlert] = useState<{
    show: boolean;
    variant: 'success' | 'error' | 'warning' | 'info';
    title: string;
    message: string;
  }>({
    show: false,
    variant: 'info',
    title: '',
    message: ''
  });

  // Confirm modal state
  const [confirmModal, setConfirmModal] = useState<{
    show: boolean;
    title: string;
    message: string;
    onConfirm: () => void;
    isLoading: boolean;
  }>({
    show: false,
    title: '',
    message: '',
    onConfirm: () => {},
    isLoading: false
  });

  useEffect(() => {
    // Initialize data fetching
    if (session?.user?.id) {
      fetchVendorStats();
      fetchVendorSubmissions();
    }
  }, [session?.user?.id, fetchVendorStats, fetchVendorSubmissions]);

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: '2-digit',
      month: 'short',
      year: 'numeric'
    });
  };

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING': return <Badge variant="warning">Menunggu</Badge>;
      case 'APPROVED': return <Badge variant="success">Disetujui</Badge>;
      case 'REJECTED': return <Badge variant="destructive">Ditolak</Badge>;
      default: return <Badge>{status}</Badge>;
    }
  };

  const handleDelete = useCallback((id: string) => {
    setConfirmModal({
      show: true,
      title: 'Konfirmasi Hapus',
      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',
      onConfirm: () => performDelete(id),
      isLoading: false
    });
  }, []);

  const performDelete = async (id: string) => {
    try {
      setConfirmModal(prev => ({ ...prev, isLoading: true }));

      const response = await fetch(`/api/submissions/${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Gagal menghapus pengajuan');
      }

      // Close confirm modal
      setConfirmModal(prev => ({ ...prev, show: false, isLoading: false }));

      // Refresh data setelah berhasil menghapus
      await fetchVendorSubmissions();
      await fetchVendorStats();
      
      // Show success message
      setAlert({
        show: true,
        variant: 'success',
        title: 'Berhasil!',
        message: 'Pengajuan berhasil dihapus'
      });
      
      // Auto hide after 3 seconds
      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 3000);
    } catch (error) {
      setConfirmModal(prev => ({ ...prev, isLoading: false }));
      
      console.error('Error deleting submission:', error);
      setAlert({
        show: true,
        variant: 'error',
        title: 'Gagal Menghapus',
        message: error instanceof Error ? error.message : 'Gagal menghapus pengajuan'
      });
      
      // Auto hide after 5 seconds
      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 5000);
    }
  };

  const handleViewDetail = useCallback(async (submission: VendorSubmission) => {
    try {
      // Fetch full submission data from API
      const response = await fetch(`/api/submissions/${submission.id}`);
      if (response.ok) {
        const fullSubmissionData = await response.json();
        setSelectedSubmission(fullSubmissionData);
        setIsModalOpen(true);
      } else {
        console.error('Failed to fetch submission details');
        setAlert({
          show: true,
          variant: 'error',
          title: 'Error',
          message: 'Gagal memuat detail pengajuan'
        });
      }
    } catch (error) {
      console.error('Error fetching submission details:', error);
      setAlert({
        show: true,
        variant: 'error',
        title: 'Error',
        message: 'Terjadi kesalahan saat memuat detail pengajuan'
      });
    }
  }, []);

  const handleCloseModal = useCallback(() => {
    setIsModalOpen(false);
    setSelectedSubmission(null);
  }, []);

  return (
    <div className="space-y-8">
      {/* Alert Notification */}
      {alert.show && (
        <div className="fixed top-4 right-4 z-50 max-w-md">
          <Alert
            variant={alert.variant}
            title={alert.title}
            message={alert.message}
          />
        </div>
      )}

      {/* Header */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 className="text-2xl font-semibold text-gray-900">
              Selamat datang di dashboard vendor, {session?.user.officer_name ?? session?.user.name ?? "Vendor"}
            </h1>
            <p className="text-gray-600 mt-1">
              {session?.user.vendor_name && `${session.user.vendor_name} - `}
              Kelola pengajuan SIMLOK Anda
            </p>
          </div>
          <div className="mt-4 sm:mt-0">
            <Link href="/vendor/submissions/create">
              <Button variant="primary" size="md">
                <PlusIcon className="w-5 h-5 mr-2" />
                Buat pengajuan
              </Button>
            </Link>
          </div>
        </div>
      </div>

      {/* Statistics Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Total Disetujui</p>
              <p className="text-3xl font-bold text-green-600 mt-2">
                {statsLoading ? '...' : vendorStats?.totalApproved || 0}
              </p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <CheckCircleIcon className="w-6 h-6 text-green-600" />
            </div>
          </div>
        </Card>

        <Card className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Total Menunggu</p>
              <p className="text-3xl font-bold text-orange-600 mt-2">
                {statsLoading ? '...' : vendorStats?.totalPending || 0}
              </p>
            </div>
            <div className="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
              <ClockIcon className="w-6 h-6 text-orange-600" />
            </div>
          </div>
        </Card>

        <Card className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">Total Ditolak</p>
              <p className="text-3xl font-bold text-red-600 mt-2">
                {statsLoading ? '...' : vendorStats?.totalRejected || 0}
              </p>
            </div>
            <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
              <XCircleIcon className="w-6 h-6 text-red-600" />
            </div>
          </div>
        </Card>
      </div>

      {/* Recent Submissions Table */}
      <Card className="p-6">
        <div className="flex items-center justify-between mb-6">
          <h3 className="text-lg font-semibold text-gray-900">Pengajuan Terbaru</h3>
          <Link href="/vendor/submissions" className="text-sm text-blue-600 hover:text-blue-500">
            Lihat Semua
          </Link>
        </div>
        
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Pekerjaan
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Lokasi Kerja
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  No. SIMLOK
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Tanggal
                </th>
                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Aksi
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {submissionsLoading ? (
                <tr>
                  <td colSpan={6} className="px-4 py-8 text-center text-gray-500">
                    <div className="flex items-center justify-center">
                      <LoadingSpinner size="md" />
                      <span className="ml-2 text-gray-600">Memuat pengajuan...</span>
                    </div>
                  </td>
                </tr>
              ) : submissions.length === 0 ? (
                <tr>
                  <td colSpan={6} className="px-4 py-8 text-center text-gray-500">
                    <div className="text-center">
                      <ClockIcon className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                      <h3 className="text-sm font-medium text-gray-900">Belum ada pengajuan</h3>
                      <p className="text-sm text-gray-500 mt-1">
                        Mulai dengan membuat pengajuan SIMLOK pertama Anda
                      </p>
                      <Link href="/vendor/submissions/create" className="mt-4 inline-block">
                        <Button variant="primary" size="sm">
                          <PlusIcon className="w-4 h-4 mr-2" />
                          Buat Pengajuan Pertama
                        </Button>
                      </Link>
                    </div>
                  </td>
                </tr>
              ) : (
                submissions.slice(0, 5).map((submission: any) => (
                  <tr key={submission.id} className="hover:bg-gray-50">
                    <td className="px-4 py-4 text-sm text-gray-900">
                      <div className="max-w-xs truncate" title={submission.job_description}>
                        {submission.job_description}
                      </div>
                    </td>
                    <td className="px-4 py-4 text-sm text-gray-600">
                      <div className="max-w-xs truncate" title={submission.work_location}>
                        {submission.work_location}
                      </div>
                    </td>
                    <td className="px-4 py-4">
                      {getStatusBadge(submission.approval_status)}
                    </td>
                    <td className="px-4 py-4 text-sm text-gray-600">
                      {submission.simlok_number || '-'}
                    </td>
                    <td className="px-4 py-4 text-sm text-gray-500">
                      {formatDate(submission.created_at)}
                    </td>
                    <td className="px-4 py-4">
                      <div className="flex items-center space-x-2">
                        <Button
                          onClick={() => handleViewDetail(submission)}
                          variant="info"
                          size="sm"
                          title="Lihat Detail"
                        >
                          Lihat
                        </Button>
                        {submission.approval_status === 'PENDING' && (
                          <>
                            {/* <Link href={`/vendor/submissions/edit/${submission.id}`}>
                              <Button
                                variant="warning"
                                size="sm"
                                title="Ubah Pengajuan"
                                className="mr-2"
                              >
                                Ubah
                              </Button>
                            </Link> */}
                            <Button
                              onClick={() => handleDelete(submission.id)}
                              variant="destructive"
                              size="sm"
                              title="Hapus Pengajuan"
                            >
                              Hapus
                            </Button>
                          </>
                        )}
                        {submission.approval_status !== 'PENDING' && (
                          <span className="text-gray-400 text-xs">Tidak dapat diubah</span>
                        )}
                      </div>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>

        {/* Quick Actions Footer */}
        {/* {!loading && submissions.length > 0 && (
          <div className="mt-6 pt-4 border-t border-gray-200">
            <div className="flex flex-col sm:flex-row gap-3">
              <Link href="/vendor/submissions/create">
                <Button variant="primary" size="sm" className="w-full sm:w-auto">
                  <PlusIcon className="w-4 h-4 mr-2" />
                  Buat Pengajuan Baru
                </Button>
              </Link>
              <Link href="/vendor/submissions">
                <Button variant="outline" size="sm" className="w-full sm:w-auto">
                  Kelola Semua Pengajuan
                </Button>
              </Link>
            </div>
          </div>
        )} */}
      </Card>

      {/* Modal Detail */}
      {selectedSubmission && (
        <SubmissionDetailModal
          submission={selectedSubmission}
          isOpen={isModalOpen}
          onClose={handleCloseModal}
        />
      )}

      {/* Confirm Modal */}
      <ConfirmModal
        isOpen={confirmModal.show}
        onClose={() => setConfirmModal(prev => ({ ...prev, show: false }))}
        onConfirm={confirmModal.onConfirm}
        title={confirmModal.title}
        message={confirmModal.message}
        variant="danger"
        confirmText="Hapus"
        cancelText="Batal"
        isLoading={confirmModal.isLoading}
      />
    </div>
  );
}


=== FILE: src/components/dashboard/VerifierDashboard.tsx ===
'use client';

import { useState, useRef } from 'react';
import { useSession } from 'next-auth/react';
import { CameraIcon } from '@heroicons/react/24/outline';
import Button from '../ui/button/Button';
import CameraQRScanner from '../scanner/CameraQRScanner';
import ScanHistory from '../scanner/ScanHistory';

export default function VerifierDashboard() {
  const { data: session } = useSession();
  const [scannerOpen, setScannerOpen] = useState(false);
  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white shadow">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="py-6">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">
                  Dashboard Verifier
                </h1>
                <p className="mt-2 text-gray-600">
                  Selamat datang, {session?.user?.officer_name}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Quick Scan Actions */}
        <div className="mb-8">
          <div className="bg-white shadow rounded-lg p-6">
            <div className="text-center">
              <h2 className="text-2xl font-semibold text-gray-900 mb-4">
                Barcode & QR Code Scanner
              </h2>
              <p className="text-gray-600 mb-6">
                Scan barcode atau QR code SIMLOK untuk verifikasi. Scanner mendukung berbagai format: QR Code, Code 128, Code 39, EAN, UPC. Pastikan browser mengizinkan akses kamera.
              </p>
              
              <div className="flex justify-center space-x-4">
                <Button
                  onClick={() => {
                    console.log('Opening barcode scanner from verifier dashboard');
                    // Close any open detail modals from scan history
                    if (scanHistoryRef.current?.closeDetailModal) {
                      scanHistoryRef.current.closeDetailModal();
                    }
                    setScannerOpen(true);
                  }}
                  className="bg-blue-600 hover:bg-blue-700"
                  size="lg"
                >
                  <CameraIcon className="w-6 h-6 mr-2" />
                  Mulai Scan Barcode/QR Code
                </Button>
              </div>
            </div>
          </div>
        </div>

        {/* Scan History */}
        <div className="bg-white shadow rounded-lg">
          <div className="px-6 py-4 border-b border-gray-200">
            <h3 className="text-lg leading-6 font-medium text-gray-900">
              Riwayat Scan Barcode & QR Code
            </h3>
          </div>
          <ScanHistory 
            ref={scanHistoryRef}
            className="border-0 shadow-none bg-transparent" 
          />
        </div>
      </div>

      {/* Barcode & QR Code Scanner Modal */}
      <CameraQRScanner
        isOpen={scannerOpen}
        onClose={() => {
          console.log('Closing barcode scanner from verifier dashboard');
          setScannerOpen(false);
        }}
        onScan={(result: string) => {
          console.log('Barcode/QR Scanned in verifier:', result);
          // Scanner will handle the verification automatically
          // Just close the scanner after successful scan
          setScannerOpen(false);
        }}
        title="Scan Barcode/QR Code SIMLOK"
        description="Arahkan kamera ke barcode atau QR code SIMLOK untuk memverifikasi"
      />
    </div>
  );
}

=== FILE: src/components/form/Checkbox.tsx ===
import React from "react";

interface CheckboxProps {
  checked: boolean;
  onChange: (checked: boolean) => void;
  label?: string;
  className?: string;
  disabled?: boolean;
}

export default function Checkbox({ checked, onChange, label, className = "", disabled = false }: CheckboxProps) {
  return (
    <label className={`flex items-center ${disabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'} ${className}`}>
      <input
        type="checkbox"
        checked={checked}
        onChange={(e) => onChange(e.target.checked)}
        disabled={disabled}
        className="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed"
      />
      {label && <span className="ml-2 text-sm text-gray-700">{label}</span>}
    </label>
  );
}


=== FILE: src/components/form/DatePicker.tsx ===
'use client';

import React from 'react';
import ReactDatePicker from 'react-datepicker';

export interface DatePickerProps {
  id?: string;
  name?: string;
  value?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  required?: boolean;
  disabled?: boolean;
  className?: string;
  autoFocus?: boolean;
}

// DatePicker using react-datepicker for better reliability
export default function DatePicker({
  value,
  onChange,
  placeholder = 'Pilih tanggal',
  disabled = false,
  className = '',
  autoFocus = false
}: DatePickerProps) {
  // Convert string value to Date object
  const selectedDate = value ? new Date(value) : null;

  // Handle date change
  const handleChange = (date: Date | null) => {
    if (date && onChange) {
      // Format date to YYYY-MM-DD
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const formattedDate = `${year}-${month}-${day}`;
      onChange(formattedDate);
    } else if (!date && onChange) {
      onChange('');
    }
  };

  return (
    <div className="relative">
      <ReactDatePicker
        selected={selectedDate}
        onChange={handleChange}
        placeholderText={placeholder}
        disabled={disabled}
        autoFocus={autoFocus}
        dateFormat="dd/MM/yyyy"
        className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white ${className}`}
        calendarClassName="react-datepicker-calendar"
        popperClassName="react-datepicker-popper"
        popperPlacement="bottom-start"
        showPopperArrow={false}
        isClearable={false}
        todayButton="Hari ini"
        onKeyDown={(e) => {
          // Mencegah pengetikan manual kecuali untuk navigasi
          if (
            e.key !== 'Tab' && 
            e.key !== 'Enter' && 
            e.key !== 'Escape' && 
            e.key !== 'ArrowUp' && 
            e.key !== 'ArrowDown' && 
            e.key !== 'ArrowLeft' && 
            e.key !== 'ArrowRight'
          ) {
            e.preventDefault();
          }
        }}
        onFocus={(e) => {
          // Membuka datepicker saat input mendapat focus
          e.target.blur();
          e.target.focus();
        }}
      />
    </div>
  );
}



=== FILE: src/components/form/DateRangePicker.tsx ===
'use client';

import React, { useState, useCallback, useEffect } from 'react';
import { CalendarIcon, ArrowRightIcon } from '@heroicons/react/24/outline';

export interface DateRange {
  startDate: string;
  endDate: string;
}

export interface DateRangePickerProps {
  value?: DateRange;
  onChange?: (value: DateRange) => void;
  startLabel?: string;
  endLabel?: string;
  disabled?: boolean;
  className?: string;
  minDate?: string;
  maxDate?: string;
  required?: boolean;
  error?: string;
}

/**
 * Robust Date Range Picker with validation and auto-template generation
 */
export default function DateRangePicker({
  value = { startDate: '', endDate: '' },
  onChange,
  startLabel = 'Tanggal Mulai',
  endLabel = 'Tanggal Selesai',
  disabled = false,
  className = '',
  minDate,
  maxDate,
  required = false,
  error
}: DateRangePickerProps) {
  const [dateRange, setDateRange] = useState<DateRange>(value);
  const [errors, setErrors] = useState<{ start?: string; end?: string }>({});

  // Sync with external value
  useEffect(() => {
    setDateRange(value);
  }, [value]);

  // Validate date range
  const validateDateRange = useCallback((range: DateRange): { start?: string; end?: string } => {
    const errors: { start?: string; end?: string } = {};
    
    // Validate start date
    if (required && !range.startDate) {
      errors.start = 'Tanggal mulai wajib diisi';
    } else if (range.startDate) {
      const startDate = new Date(range.startDate);
      if (isNaN(startDate.getTime())) {
        errors.start = 'Format tanggal tidak valid';
      } else {
        // Check min date
        if (minDate && startDate < new Date(minDate)) {
          errors.start = `Tanggal tidak boleh sebelum ${new Date(minDate).toLocaleDateString('id-ID')}`;
        }
        // Check max date
        if (maxDate && startDate > new Date(maxDate)) {
          errors.start = `Tanggal tidak boleh setelah ${new Date(maxDate).toLocaleDateString('id-ID')}`;
        }
      }
    }

    // Validate end date
    if (required && !range.endDate) {
      errors.end = 'Tanggal selesai wajib diisi';
    } else if (range.endDate) {
      const endDate = new Date(range.endDate);
      if (isNaN(endDate.getTime())) {
        errors.end = 'Format tanggal tidak valid';
      } else {
        // Check min date
        if (minDate && endDate < new Date(minDate)) {
          errors.end = `Tanggal tidak boleh sebelum ${new Date(minDate).toLocaleDateString('id-ID')}`;
        }
        // Check max date
        if (maxDate && endDate > new Date(maxDate)) {
          errors.end = `Tanggal tidak boleh setelah ${new Date(maxDate).toLocaleDateString('id-ID')}`;
        }
        // Check if end date is after start date
        if (range.startDate && endDate < new Date(range.startDate)) {
          errors.end = 'Tanggal selesai harus setelah tanggal mulai';
        }
      }
    }

    return errors;
  }, [minDate, maxDate, required]);

  // Handle start date change
  const handleStartDateChange = useCallback((newStartDate: string) => {
    const newRange = { ...dateRange, startDate: newStartDate };
    setDateRange(newRange);
    
    const validationErrors = validateDateRange(newRange);
    setErrors(validationErrors);
    
    if (onChange && Object.keys(validationErrors).length === 0) {
      onChange(newRange);
    }
  }, [dateRange, onChange, validateDateRange]);

  // Handle end date change
  const handleEndDateChange = useCallback((newEndDate: string) => {
    const newRange = { ...dateRange, endDate: newEndDate };
    setDateRange(newRange);
    
    const validationErrors = validateDateRange(newRange);
    setErrors(validationErrors);
    
    if (onChange && Object.keys(validationErrors).length === 0) {
      onChange(newRange);
    }
  }, [dateRange, onChange, validateDateRange]);

  // Calculate duration
  const getDuration = useCallback((): number | null => {
    if (!dateRange.startDate || !dateRange.endDate) return null;
    
    try {
      const start = new Date(dateRange.startDate);
      const end = new Date(dateRange.endDate);
      
      if (isNaN(start.getTime()) || isNaN(end.getTime())) return null;
      
      const diffTime = end.getTime() - start.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both start and end dates
      
      return diffDays > 0 ? diffDays : null;
    } catch (error) {
      return null;
    }
  }, [dateRange]);

  // Format date for display
  const formatDateForDisplay = useCallback((dateStr: string): string => {
    if (!dateStr) return '';
    
    try {
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return '';
      
      return date.toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    } catch (error) {
      return '';
    }
  }, []);

  const duration = getDuration();
  const hasValidRange = dateRange.startDate && dateRange.endDate && Object.keys(errors).length === 0;

  return (
    <div className={className}>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {/* Start Date */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            {startLabel}
            {required && <span className="text-red-500 ml-1">*</span>}
          </label>
          <div className="relative">
            <input
              type="date"
              value={dateRange.startDate}
              onChange={(e) => handleStartDateChange(e.target.value)}
              disabled={disabled}
              min={minDate}
              max={maxDate}
              className={`
                w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                ${errors.start 
                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500' 
                  : 'border-gray-300 hover:border-gray-400'
                }
                ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}
              `}
            />
            <CalendarIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none" />
          </div>
          {errors.start && (
            <div className="mt-1 text-sm text-red-600 flex items-center">
              <svg className="h-4 w-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
              </svg>
              {errors.start}
            </div>
          )}
        </div>

        {/* End Date */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            {endLabel}
            {required && <span className="text-red-500 ml-1">*</span>}
          </label>
          <div className="relative">
            <input
              type="date"
              value={dateRange.endDate}
              onChange={(e) => handleEndDateChange(e.target.value)}
              disabled={disabled}
              min={dateRange.startDate || minDate}
              max={maxDate}
              className={`
                w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200
                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                ${errors.end 
                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500' 
                  : 'border-gray-300 hover:border-gray-400'
                }
                ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}
              `}
            />
            <CalendarIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none" />
          </div>
          {errors.end && (
            <div className="mt-1 text-sm text-red-600 flex items-center">
              <svg className="h-4 w-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
              </svg>
              {errors.end}
            </div>
          )}
        </div>
      </div>

      {/* Date Range Summary */}
      {hasValidRange && (
        <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <div className="flex items-center justify-between">
            <div className="flex items-center text-sm text-blue-800">
              <CalendarIcon className="h-4 w-4 mr-2" />
              <span className="font-medium">Periode Pelaksanaan:</span>
            </div>
            {duration && (
              <div className="text-sm font-medium text-blue-700 bg-blue-100 px-2 py-1 rounded">
                {duration} hari
              </div>
            )}
          </div>
          <div className="mt-2 text-sm text-blue-700">
            <div className="flex items-center">
              <span className="font-medium">{formatDateForDisplay(dateRange.startDate)}</span>
              <ArrowRightIcon className="h-4 w-4 mx-2 text-blue-500" />
              <span className="font-medium">{formatDateForDisplay(dateRange.endDate)}</span>
            </div>
          </div>
        </div>
      )}

      {/* Global Error */}
      {error && (
        <div className="mt-2 text-sm text-red-600 flex items-center">
          <svg className="h-4 w-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
          </svg>
          {error}
        </div>
      )}
    </div>
  );
}

=== FILE: src/components/form/EnhancedFileUpload.tsx ===
'use client';

import { useState, useRef } from 'react';
import { DocumentIcon, XMarkIcon, CloudArrowUpIcon, PhotoIcon } from '@heroicons/react/24/outline';
import { ImageCompressor } from '@/utils/image-compression';
import { useToast } from '@/hooks/useToast';

interface EnhancedFileUploadProps {
  id: string;
  name: string;
  value: string;
  onChange: (value: string) => void;
  onFileChange?: (file: File | null) => void;
  uploadType: 'worker-photo' | 'document' | 'other';
  multiple?: boolean;
  required?: boolean;
  disabled?: boolean;
  className?: string;
  label?: string;
  description?: string;
  workerName?: string; // For worker photos
}

export default function EnhancedFileUpload({
  id,
  name,
  value,
  onChange,
  onFileChange,
  uploadType,
  multiple = false,
  required = false,
  disabled = false,
  className,
  label,
  description,
  workerName
}: EnhancedFileUploadProps) {
  const [dragActive, setDragActive] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [uploadProgress, setUploadProgress] = useState(0);
  const [error, setError] = useState<string | null>(null);
  const [compressionInfo, setCompressionInfo] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const { showSuccess, showError } = useToast();

  // Get accept types based on upload type
  const getAcceptTypes = () => {
    switch (uploadType) {
      case 'worker-photo':
        return '.jpg,.jpeg,.png';
      case 'document':
        return '.pdf,.doc,.docx,.jpg,.jpeg,.png';
      default:
        return '.pdf,.doc,.docx,.jpg,.jpeg,.png';
    }
  };

  // Validate file based on type
  const validateFile = (file: File): { isValid: boolean; error?: string } => {
    switch (uploadType) {
      case 'worker-photo':
        return ImageCompressor.validateWorkerPhoto(file);
      case 'document':
        return ImageCompressor.validateDocumentFile(file);
      default:
        return { isValid: false, error: 'Tipe upload tidak valid' };
    }
  };

  // Upload file with compression for photos
  const uploadFile = async (file: File): Promise<string> => {
    let fileToUpload = file;
    
    // Compress worker photos
    if (uploadType === 'worker-photo') {
      try {
        const compressionResult = await ImageCompressor.compressWorkerPhoto(file, {
          maxWidth: 800,
          maxHeight: 600,
          quality: 0.85,
          maxSizeKB: 500
        });
        
        fileToUpload = compressionResult.file;
        
        // Show compression info
        // const compressionText = `Foto dikompres ${compressionResult.compressionRatio}% (${formatFileSize(compressionResult.originalSize)} → ${formatFileSize(compressionResult.compressedSize)})`;
        // setCompressionInfo(compressionText);
        // showSuccess('Kompresi Berhasil', compressionText);
        
      } catch (compressionError) {
        console.error('Compression error:', compressionError);
        // showError('Warning', 'Gagal mengompres foto, menggunakan file asli');
      }
    }

    // Prepare form data
    const formData = new FormData();
    formData.append('file', fileToUpload);
    
    // Add specific fields based on upload type
    if (uploadType === 'worker-photo' && workerName) {
      formData.append('workerName', workerName);
    }
    
    if (name) {
      formData.append('fieldName', name);
    }

    // Choose upload endpoint
    const uploadEndpoint = uploadType === 'worker-photo' 
      ? '/api/upload/worker-photo' 
      : '/api/upload';

    const response = await fetch(uploadEndpoint, {
      method: 'POST',
      body: formData,
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Upload failed');
    }

    const data = await response.json();
    return data.url;
  };

  const handleFileSelect = async (files: FileList | null) => {
    if (!files || files.length === 0) return;

    const file = files[0];
    if (!file) return;

    setError(null);
    setCompressionInfo(null);

    // Validate file
    const validation = validateFile(file);
    if (!validation.isValid) {
      setError(validation.error || 'File tidak valid');
      return;
    }

    try {
      setUploading(true);
      setUploadProgress(0);

      // Simulate progress for better UX
      const progressInterval = setInterval(() => {
        setUploadProgress(prev => Math.min(prev + 10, 90));
      }, 100);

      const fileUrl = await uploadFile(file);
      
      clearInterval(progressInterval);
      setUploadProgress(100);

      // Notify parent components
      if (onChange) {
        onChange(fileUrl);
      }
      if (onFileChange) {
        onFileChange(file);
      }

      // Show success message
      const fileType = uploadType === 'worker-photo' ? 'foto pekerja' : 'dokumen';
      showSuccess('Upload Berhasil', `${fileType} berhasil diunggah`);

    } catch (err: any) {
      setError(err.message || 'Gagal mengunggah file');
      showError('Upload Gagal', err.message || 'Gagal mengunggah file');
    } finally {
      setUploading(false);
      
      // Reset progress after delay
      setTimeout(() => {
        setUploadProgress(0);
      }, 1000);
    }
  };

  const handleDrag = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    if (e.type === 'dragenter' || e.type === 'dragover') {
      setDragActive(true);
    } else if (e.type === 'dragleave') {
      setDragActive(false);
    }
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);
    
    if (disabled) return;
    
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      handleFileSelect(e.dataTransfer.files);
    }
  };

  const handleRemove = () => {
    if (onChange) {
      onChange('');
    }
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
    setError(null);
    setCompressionInfo(null);
  };

  const getFileName = (): string => {
    if (!value) return '';
    return value.split('/').pop() || '';
  };

  const getFileIcon = () => {
    if (uploadType === 'worker-photo') {
      return <PhotoIcon className="mx-auto h-12 w-12 text-blue-500" />;
    }
    return <DocumentIcon className="mx-auto h-12 w-12 text-blue-500" />;
  };

  const getUploadText = () => {
    if (uploadType === 'worker-photo') {
      return {
        title: 'Upload Foto Pekerja',
        subtitle: 'Drag & drop foto atau klik untuk browse',
        formats: 'JPG, JPEG, PNG (max 10MB, akan dikompres otomatis)'
      };
    }
    return {
      title: 'Upload Dokumen',
      subtitle: 'Drag & drop file atau klik untuk browse',
      formats: 'PDF, DOC, DOCX, JPG, PNG (max 8MB)'
    };
  };

  const uploadText = getUploadText();

  return (
    <div className={`w-full ${className}`}>
      {label && (
        <label htmlFor={id} className="block text-sm font-medium text-gray-700 mb-2">
          {label}
          {required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}
      
      <div
        className={`
          relative border-2 border-dashed rounded-lg p-6 transition-colors
          ${dragActive 
            ? 'border-blue-400 bg-blue-50' 
            : error 
              ? 'border-red-300 bg-red-50'
              : 'border-gray-300 bg-gray-50'
          }
          ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-blue-400 hover:bg-blue-50'}
        `}
        onDragEnter={handleDrag}
        onDragLeave={handleDrag}
        onDragOver={handleDrag}
        onDrop={handleDrop}
        onClick={() => !disabled && fileInputRef.current?.click()}
      >
        <input
          ref={fileInputRef}
          id={id}
          name={name}
          type="file"
          className="hidden"
          accept={getAcceptTypes()}
          multiple={multiple}
          disabled={disabled}
          onChange={(e) => handleFileSelect(e.target.files)}
        />

        {uploading ? (
          <div className="text-center">
            <CloudArrowUpIcon className="mx-auto h-12 w-12 text-blue-500 animate-bounce" />
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">
                Mengunggah{uploadType === 'worker-photo' ? ' dan mengompres' : ''} file...
              </div>
              <div className="mt-2 w-full bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${uploadProgress}%` }}
                />
              </div>
              <div className="text-xs text-gray-500 mt-1">{uploadProgress}%</div>
            </div>
          </div>
        ) : value ? (
          <div className="text-center">
            {getFileIcon()}
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">{getFileName()}</div>
              {compressionInfo && (
                <div className="text-xs text-green-600 mt-1">{compressionInfo}</div>
              )}
              <button
                type="button"
                onClick={(e) => {
                  e.stopPropagation();
                  handleRemove();
                }}
                className="mt-2 inline-flex items-center px-3 py-1 border border-red-300 text-xs font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 transition-colors"
              >
                <XMarkIcon className="h-3 w-3 mr-1" />
                Hapus
              </button>
            </div>
          </div>
        ) : (
          <div className="text-center">
            {getFileIcon()}
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">{uploadText.title}</div>
              <div className="text-xs text-gray-500 mt-1">{uploadText.subtitle}</div>
              <div className="text-xs text-gray-400 mt-1">{uploadText.formats}</div>
            </div>
          </div>
        )}
      </div>

      {description && !error && (
        <p className="mt-2 text-sm text-gray-500">{description}</p>
      )}

      {error && (
        <p className="mt-2 text-sm text-red-600">{error}</p>
      )}
    </div>
  );
}

=== FILE: src/components/form/FileUpload.tsx ===
'use client';

import { useState, useRef } from 'react';
import { DocumentIcon, XMarkIcon, CloudArrowUpIcon } from '@heroicons/react/24/outline';

interface FileUploadProps {
  id?: string;
  name?: string;
  value?: string;
  onChange?: (url: string) => void;
  onFileChange?: (file: File | null) => void;
  accept?: string;
  multiple?: boolean;
  maxSize?: number; // in MB - default is now 8MB
  required?: boolean;
  disabled?: boolean;
  className?: string;
  label?: string;
  description?: string;
}

export default function FileUpload({
  id,
  name,
  value,
  onChange,
  onFileChange,
  accept = ".pdf,.doc,.docx,.jpg,.jpeg,.png",
  multiple = false,
  maxSize = 8, // 8MB default
  required = false,
  disabled = false,
  className,
  label,
  description
}: FileUploadProps) {
  const [dragActive, setDragActive] = useState(false);
  const [uploading, setUploading] = useState(false);
  const [uploadProgress, setUploadProgress] = useState(0);
  const [error, setError] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const validateFileInput = (file: File): string | null => {
    // Check file size first
    if (file.size > maxSize * 1024 * 1024) {
      return `Ukuran file terlalu besar. Maksimal ${maxSize}MB`;
    }

    // Check file type based on accept prop
    const acceptedTypes = accept.split(',').map(type => type.trim());
    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();
    
    const isValidType = acceptedTypes.some(type => {
      if (type.startsWith('.')) {
        return type === fileExtension;
      }
      return file.type.match(type);
    });

    if (!isValidType) {
      return `Tipe file tidak didukung. Tipe yang diizinkan: ${accept}`;
    }

    return null;
  };

  const uploadFile = async (file: File): Promise<string> => {
    const formData = new FormData();
    formData.append('file', file);
    
    // Add field name to help categorize the file
    if (name) {
      formData.append('fieldName', name);
    }

    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData,
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Upload failed');
    }

    const data = await response.json();
    return data.url;
  };

  const handleFileSelect = async (files: FileList | null) => {
    if (!files || files.length === 0) return;

    const file = files[0];
    if (!file) return;
    
    setError(null);

    // Validate file
    const validationError = validateFileInput(file);
    if (validationError) {
      setError(validationError);
      return;
    }

    try {
      setUploading(true);
      setUploadProgress(0);

      // Simulate progress for better UX
      const progressInterval = setInterval(() => {
        setUploadProgress(prev => Math.min(prev + 10, 90));
      }, 100);

      const fileUrl = await uploadFile(file);
      
      clearInterval(progressInterval);
      setUploadProgress(100);

      // Notify parent components
      if (onChange) {
        onChange(fileUrl);
      }
      if (onFileChange) {
        onFileChange(file);
      }

      setTimeout(() => {
        setUploading(false);
        setUploadProgress(0);
      }, 500);

    } catch (error) {
      setError(error instanceof Error ? error.message : 'Upload failed');
      setUploading(false);
      setUploadProgress(0);
    }
  };

  const handleDragEnter = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(true);
  };

  const handleDragLeave = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);

    if (disabled) return;

    const files = e.dataTransfer.files;
    handleFileSelect(files);
  };

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    handleFileSelect(e.target.files);
  };

  const handleClick = () => {
    if (disabled) return;
    fileInputRef.current?.click();
  };

  const removeFile = () => {
    if (onChange) {
      onChange('');
    }
    if (onFileChange) {
      onFileChange(null);
    }
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
    setError(null);
  };

  const getFileName = () => {
    if (value) {
      return value.split('/').pop() || 'Uploaded file';
    }
    return null;
  };

  return (
    <div className={`space-y-2 ${className || ''}`}>
      {label && (
        <label className="block text-sm font-medium text-gray-700">
          {label}
          {required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}

      {description && (
        <p className="text-sm text-gray-500">{description}</p>
      )}

      <div
        className={`relative border-2 border-dashed rounded-lg p-6 transition-colors ${
          dragActive 
            ? 'border-blue-400 bg-blue-50' 
            : disabled 
            ? 'border-gray-200 bg-gray-50' 
            : 'border-gray-300 hover:border-gray-400'
        } ${
          !disabled ? 'cursor-pointer' : 'cursor-not-allowed'
        }`}
        onDragEnter={handleDragEnter}
        onDragLeave={handleDragLeave}
        onDragOver={handleDragOver}
        onDrop={handleDrop}
        onClick={handleClick}
      >
        <input
          ref={fileInputRef}
          id={id}
          name={name}
          type="file"
          accept={accept}
          multiple={multiple}
          required={required}
          disabled={disabled}
          onChange={handleInputChange}
          className="hidden"
        />

        {uploading ? (
          <div className="text-center">
            <CloudArrowUpIcon className="mx-auto h-12 w-12 text-blue-500 animate-pulse" />
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">Uploading...</div>
              <div className="mt-2 w-full bg-gray-200 rounded-full h-2">
                <div 
                  className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${uploadProgress}%` }}
                />
              </div>
              <div className="text-xs text-gray-500 mt-1">{uploadProgress}%</div>
            </div>
          </div>
        ) : value ? (
          <div className="text-center">
            <DocumentIcon className="mx-auto h-12 w-12 text-green-500" />
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">{getFileName()}</div>
              <div className="text-xs text-gray-500 mt-1">File uploaded successfully</div>
              <button
                type="button"
                onClick={(e) => {
                  e.stopPropagation();
                  removeFile();
                }}
                className="mt-2 inline-flex items-center px-3 py-1 text-xs font-medium text-red-600 bg-red-50 rounded-md hover:bg-red-100"
              >
                <XMarkIcon className="h-4 w-4 mr-1" />
                Remove
              </button>
            </div>
          </div>
        ) : (
          <div className="text-center">
            <CloudArrowUpIcon className="mx-auto h-12 w-12 text-gray-400" />
            <div className="mt-4">
              <div className="text-sm font-medium text-gray-900">
                {dragActive ? 'Drop file here' : 'Click to upload or drag and drop'}
              </div>
              <div className="text-xs text-gray-500 mt-1">
                {accept} up to {maxSize}MB
              </div>
            </div>
          </div>
        )}
      </div>

      {error && (
        <div className="text-sm text-red-600 bg-red-50 border border-red-200 rounded-md p-2">
          {error}
        </div>
      )}
    </div>
  );
}


=== FILE: src/components/form/ImprovedDatePicker.tsx ===
'use client';

import React, { useState, useCallback, useRef, useEffect } from 'react';
import { CalendarIcon, XMarkIcon } from '@heroicons/react/24/outline';

export interface ImprovedDatePickerProps {
  id?: string;
  name?: string;
  value?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  required?: boolean;
  disabled?: boolean;
  className?: string;
  autoFocus?: boolean;
  minDate?: string;
  maxDate?: string;
  label?: string;
  error?: string;
  helperText?: string;
}

/**
 * Improved DatePicker component with better error handling and user experience
 */
export default function ImprovedDatePicker({
  id,
  name,
  value = '',
  onChange,
  placeholder = 'Pilih tanggal',
  required = false,
  disabled = false,
  className = '',
  autoFocus = false,
  minDate,
  maxDate,
  label,
  error,
  helperText
}: ImprovedDatePickerProps) {
  const [internalValue, setInternalValue] = useState(value);
  const [isFocused, setIsFocused] = useState(false);
  const [hasError, setHasError] = useState(false);
  const inputRef = useRef<HTMLInputElement>(null);

  // Sync internal value with external value
  useEffect(() => {
    setInternalValue(value);
  }, [value]);

  // Format date for display
  const formatDateForDisplay = useCallback((dateStr: string): string => {
    if (!dateStr) return '';
    
    try {
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return '';
      
      return date.toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    } catch (error) {
      console.warn('Date formatting error:', error);
      return '';
    }
  }, []);

  // Validate date
  const validateDate = useCallback((dateStr: string): boolean => {
    if (!dateStr) return !required;
    
    try {
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return false;
      
      // Check min date
      if (minDate) {
        const minDateObj = new Date(minDate);
        if (date < minDateObj) return false;
      }
      
      // Check max date
      if (maxDate) {
        const maxDateObj = new Date(maxDate);
        if (date > maxDateObj) return false;
      }
      
      return true;
    } catch (error) {
      return false;
    }
  }, [minDate, maxDate, required]);

  // Handle input change
  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    const newValue = e.target.value;
    setInternalValue(newValue);
    
    const isValid = validateDate(newValue);
    setHasError(!isValid);
    
    if (onChange) {
      onChange(newValue);
    }
  }, [onChange, validateDate]);

  // Handle clear button
  const handleClear = useCallback((e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();
    
    setInternalValue('');
    setHasError(false);
    
    if (onChange) {
      onChange('');
    }
    
    if (inputRef.current) {
      inputRef.current.focus();
    }
  }, [onChange]);

  // Handle focus
  const handleFocus = useCallback(() => {
    setIsFocused(true);
  }, []);

  // Handle blur
  const handleBlur = useCallback(() => {
    setIsFocused(false);
  }, []);

  const hasValue = internalValue && internalValue.length > 0;
  const showError = error || (hasError && hasValue);
  const displayValue = formatDateForDisplay(internalValue);

  return (
    <div className={`relative ${className}`}>
      {/* Label */}
      {label && (
        <label 
          htmlFor={id}
          className="block text-sm font-medium text-gray-700 mb-2"
        >
          {label}
          {required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}

      {/* Input Container */}
      <div className="relative">
        {/* Native Date Input */}
        <input
          ref={inputRef}
          id={id}
          name={name}
          type="date"
          value={internalValue}
          onChange={handleChange}
          onFocus={handleFocus}
          onBlur={handleBlur}
          placeholder={placeholder}
          required={required}
          disabled={disabled}
          autoFocus={autoFocus}
          min={minDate}
          max={maxDate}
          className={`
            w-full px-3 py-2 pr-12 border rounded-md transition-all duration-200
            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
            ${showError 
              ? 'border-red-300 focus:ring-red-500 focus:border-red-500' 
              : isFocused 
                ? 'border-blue-300' 
                : 'border-gray-300 hover:border-gray-400'
            }
            ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}
            ${hasValue ? 'text-gray-900' : 'text-gray-500'}
          `}
        />

        {/* Calendar Icon */}
        <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
          <CalendarIcon className={`h-4 w-4 ${showError ? 'text-red-400' : 'text-gray-400'}`} />
        </div>

        {/* Clear Button */}
        {hasValue && !disabled && (
          <button
            type="button"
            onClick={handleClear}
            className="absolute inset-y-0 right-8 flex items-center pr-1 hover:bg-gray-100 rounded-r-md transition-colors"
            tabIndex={-1}
          >
            <XMarkIcon className="h-4 w-4 text-gray-400 hover:text-gray-600" />
          </button>
        )}
      </div>

      {/* Display Value */}
      {displayValue && (
        <div className="mt-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md border">
          <span className="font-medium">Tanggal terpilih:</span> {displayValue}
        </div>
      )}

      {/* Error Message */}
      {showError && (
        <div className="mt-1 text-sm text-red-600 flex items-center">
          <svg className="h-4 w-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
          </svg>
          {error || 'Tanggal tidak valid'}
        </div>
      )}

      {/* Helper Text */}
      {helperText && !showError && (
        <div className="mt-1 text-sm text-gray-500">
          {helperText}
        </div>
      )}
    </div>
  );
}

=== FILE: src/components/form/Input.tsx ===
import React from "react";

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  className?: string;
}

export default function Input({ className = "", ...props }: InputProps) {
  return (
    <input
      className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 ${className}`}
      {...props}
    />
  );
}


=== FILE: src/components/form/Label.tsx ===
import React, { FC, ReactNode } from "react";
import { twMerge } from "tailwind-merge";

interface LabelProps {
  htmlFor?: string;
  children: ReactNode;
  className?: string;
}

const Label: FC<LabelProps> = ({ htmlFor, children, className }) => {
  return (
    <label
      htmlFor={htmlFor}
      className={twMerge(
        // Default classes that apply by default
        "mb-1.5 block text-sm font-medium text-gray-700",

        // User-defined className that can override the default margin
        className
      )}
    >
      {children}
    </label>
  );
};

export default Label;


=== FILE: src/components/form/TimePicker.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { ClockIcon, ChevronDownIcon } from '@heroicons/react/24/outline';

interface TimePickerProps {
  id?: string;
  name?: string;
  value?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  required?: boolean;
  disabled?: boolean;
  className?: string;
}

export default function TimePicker({
  id,
  name,
  value,
  onChange,
  placeholder = "Pilih waktu",
  required = false,
  disabled = false,
  className
}: TimePickerProps) {
  const [startTime, setStartTime] = useState('');
  const [endTime, setEndTime] = useState('');
  const [isOpen, setIsOpen] = useState(false);

  // Generate time options (00:00 to 23:00 with 1 hour intervals)
  const generateTimeOptions = () => {
    const times = [];
    for (let hour = 0; hour < 24; hour++) {
      const formattedHour = hour.toString().padStart(2, '0');
      times.push(`${formattedHour}:00`);
    }
    return times;
  };

  const timeOptions = generateTimeOptions();

  // Parse existing value if any
  useEffect(() => {
    if (value) {
      if (value.includes(' - ')) {
        const parts = value.split(' - ');
        if (parts.length >= 2 && parts[0] && parts[1]) {
          setStartTime(parts[0].trim());
          setEndTime(parts[1].replace(' WIB', '').trim());
        }
      } else if (value.includes(' s/d ')) {
        const parts = value.split(' s/d ');
        if (parts.length >= 2 && parts[0] && parts[1]) {
          setStartTime(parts[0].trim());
          setEndTime(parts[1].replace(' WIB', '').trim());
        }
      }
    }
  }, [value]);

  const handleStartTimeChange = (time: string) => {
    setStartTime(time);
  };

  const handleEndTimeChange = (time: string) => {
    setEndTime(time);
  };

  const handleApply = () => {
    if (startTime && endTime) {
      const timeRange = `${startTime} WIB - ${endTime} WIB`;
      if (onChange) {
        onChange(timeRange);
      }
      setIsOpen(false);
    }
  };

  const handleReset = () => {
    setStartTime('');
    setEndTime('');
    if (onChange) {
      onChange('');
    }
  };

  return (
    <div className="relative">
      <div 
        className={`w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 ${
          disabled ? 'bg-gray-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'
        } ${className || ''}`}
        onClick={() => !disabled && setIsOpen(!isOpen)}
      >
        <input
          id={id}
          name={name}
          type="text"
          value={value || ''}
          placeholder={placeholder}
          readOnly
          required={required}
          disabled={disabled}
          className="w-full bg-transparent outline-none cursor-pointer"
        />
        <ClockIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" />
      </div>

      {isOpen && !disabled && (
        <>
          {/* Overlay to close dropdown when clicking outside */}
          <div 
            className="fixed inset-0 z-40" 
            onClick={() => setIsOpen(false)}
          />
          
          {/* Dropdown content */}
          <div className="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-xl min-w-[350px]">
            <div className="p-4 space-y-4">
              <div className="text-sm font-medium text-gray-900 mb-3">
                Pilih Rentang Waktu Kerja
              </div>
              
              {/* Start Time Selection */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Waktu Mulai
                </label>
                <div className="relative">
                  <select
                    value={startTime}
                    onChange={(e) => handleStartTimeChange(e.target.value)}
                    className="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white"
                  >
                    <option value="">-- Pilih Waktu Mulai --</option>
                    {timeOptions.map((time) => (
                      <option key={`start-${time}`} value={time}>
                        {time}
                      </option>
                    ))}
                  </select>
                  <ChevronDownIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" />
                </div>
              </div>

              {/* End Time Selection */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Waktu Selesai
                </label>
                <div className="relative">
                  <select
                    value={endTime}
                    onChange={(e) => handleEndTimeChange(e.target.value)}
                    disabled={!startTime}
                    className={`w-full px-3 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 appearance-none bg-white ${
                      !startTime 
                        ? 'bg-gray-50 cursor-not-allowed text-gray-400'
                        : 'border-gray-300 focus:ring-blue-500 focus:border-blue-500'
                    }`}
                  >
                    <option value="">
                      {!startTime ? '-- Pilih waktu mulai terlebih dahulu --' : '-- Pilih Waktu Selesai --'}
                    </option>
                    {timeOptions.map((time) => (
                      <option key={`end-${time}`} value={time}>
                        {time}
                      </option>
                    ))}
                  </select>
                  <ChevronDownIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" />
                </div>
              </div>

              {/* Preview */}
              {startTime && endTime && (
                <div className="p-3 bg-blue-50 rounded-md border border-blue-200">
                  <div className="text-sm text-blue-800">
                    <strong>Preview:</strong> {startTime} - {endTime} WIB
                  </div>
                </div>
              )}

              {/* Action Buttons */}
              <div className="flex justify-between space-x-2 pt-2 border-t border-gray-200">
                <button
                  type="button"
                  onClick={handleReset}
                  className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50"
                >
                  Reset
                </button>
                <div className="flex space-x-2">
                  <button
                    type="button"
                    onClick={() => setIsOpen(false)}
                    className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50"
                  >
                    Batal
                  </button>
                  <button
                    type="button"
                    onClick={handleApply}
                    disabled={!startTime || !endTime}
                    className="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    Terapkan
                  </button>
                </div>
              </div>
            </div>
          </div>
        </>
      )}
    </div>
  );
}


=== FILE: src/components/form/input/InputField.tsx ===
"use client";
import React from "react";

interface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {
  error?: string;
}

const InputField: React.FC<InputFieldProps> = ({ error, ...props }) => {
  return (
    <div className="relative">
      <input
        {...props}
        className={`w-full rounded-lg border bg-white px-4 py-3 text-sm text-gray-800 outline-none transition focus:border-gray-900 ${
          error
            ? "border-red-500 focus:border-red-500"
            : "border-gray-300"
        }`}
      />
      {error && (
        <p className="mt-1 text-xs text-red-500">{error}</p>
      )}
    </div>
  );
};

export default InputField;

=== FILE: src/components/form/textarea/TextArea.tsx ===
import React, { forwardRef } from "react";
import { cn } from "@/lib/utils";

interface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  className?: string;
  error?: string;
}

const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(
  ({ className, error, ...props }, ref) => {
    return (
      <div>
        <textarea
          className={cn(
            "flex min-h-[100px] w-full rounded-md border bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50",
            error
              ? "border-red-500 focus:border-red-500 focus:ring-red-500"
              : "border-gray-300 focus:border-blue-500 focus:ring-blue-500",
            className
          )}
          ref={ref}
          {...props}
        />
        {error && (
          <p className="mt-1 text-sm text-red-500">
            {error}
          </p>
        )}
      </div>
    );
  }
);

TextArea.displayName = "TextArea";

export default TextArea;

=== FILE: src/components/layout/PageHeader.tsx ===
"use client";

export default function PageHeader({
  title,
  subtitle,
  cta,
}: {
  title: string;
  subtitle?: string;
  cta?: React.ReactNode;
}) {
  return (
    <div className="rounded-3xl bg-gradient-to-r from-blue-600 to-blue-800 p-8 text-white shadow-lg">
      <div className="flex flex-wrap items-center justify-between gap-3">
        <div>
          <h1 className="text-2xl font-bold md:text-3xl">{title}</h1>
          {subtitle && <p className="mt-2 text-blue-100 opacity-90">{subtitle}</p>}
        </div>
        {cta && <div className="flex-shrink-0">{cta}</div>}
      </div>
    </div>
  );
}

=== FILE: src/components/layout/SidebarLayout.tsx ===
"use client";

import { useState } from "react";
import { signOut, useSession } from "next-auth/react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import NotificationsBell from "@/components/notifications/NotificationsBell";

import {
  HomeIcon,
  UsersIcon,
  ClipboardDocumentListIcon,
  ClockIcon,
  QrCodeIcon,
  Bars3Icon,
  XMarkIcon,
} from "@heroicons/react/24/outline";

interface Props {
  children: React.ReactNode;
  title: string;
  titlePage?: string;
}

export default function SidebarLayout({ children, title, titlePage}: Props) {
  const { data: session } = useSession();
  const pathname = usePathname();
  const [sidebarOpen, setSidebarOpen] = useState(false); // Start with false for mobile-first

  const handleLinkClick = () => {
    // Close sidebar on mobile after clicking a link
    if (window.innerWidth < 768) {
      setSidebarOpen(false);
    }
  };

  // Define menu type
  type MenuItem = {
    label: string;
    href: string;
    icon: React.ComponentType<{ className?: string }>;
  };

  type MenuConfig = {
    SUPER_ADMIN: MenuItem[];
    REVIEWER: MenuItem[];
    APPROVER: MenuItem[];
    VENDOR: MenuItem[];
    VERIFIER: MenuItem[];
  };

  const menuConfig: MenuConfig = {
    SUPER_ADMIN: [
      { label: "Dashboard", href: "/super-admin", icon: HomeIcon },
      { label: "User Management", href: "/super-admin/users", icon: UsersIcon },
    ],
    REVIEWER: [
      { label: "Dashboard", href: "/reviewer", icon: HomeIcon },
      { label: "Review Pengajuan", href: "/reviewer/submissions", icon: ClipboardDocumentListIcon },
      { label: "Verifikasi User", href: "/reviewer/users", icon: UsersIcon },
      { label: "Scan History", href: "/reviewer/scan-history", icon: QrCodeIcon },
    ],
    APPROVER: [
      { label: "Dashboard", href: "/approver", icon: HomeIcon },
      { label: "Persetujuan", href: "/approver/submissions", icon: ClipboardDocumentListIcon },
      { label: "Scan History", href: "/approver/scan-history", icon: QrCodeIcon },
    ],
    VENDOR: [
      { label: "Dashboard", href: "/vendor", icon: HomeIcon },
      { label: "Submissions", href: "/vendor/submissions", icon: ClipboardDocumentListIcon },
    ],
    VERIFIER: [
      { label: "Dashboard", href: "/verifier", icon: HomeIcon },
      { label: "History", href: "/verifier/history", icon: ClockIcon },
    ],
  };

  const userRole = session?.user?.role as keyof MenuConfig | undefined;
  const menu = userRole ? menuConfig[userRole] : menuConfig.SUPER_ADMIN;

  return (
    <div className="flex h-screen bg-gray-50">
      {/* Mobile backdrop */}
      {sidebarOpen && (
        <div className="fixed inset-0 z-20 bg-black/30 md:hidden" onClick={() => setSidebarOpen(false)} />
      )}

      {/* Sidebar */}
      <aside
        className={`fixed inset-y-0 left-0 z-30 h-full flex-col border-r border-slate-200 bg-white shadow-sm transition-all duration-300 ease-in-out md:relative md:flex ${
          sidebarOpen ? "flex w-64" : "hidden md:flex md:w-20"
        }`}
      >
        {/* Header */}
        <div className="flex items-center justify-between border-b border-slate-200 px-4 py-4">
          {sidebarOpen && <h1 className="text-lg font-bold">{title}</h1>}
          <button
            onClick={() => setSidebarOpen(!sidebarOpen)}
            className={`rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${
              sidebarOpen ? "ml-auto md:ml-auto" : "mx-auto"
            }`}
            aria-label="Toggle sidebar"
          >
            {sidebarOpen ? <XMarkIcon className="h-6 w-6" /> : <Bars3Icon className="h-6 w-6" />}
          </button>
        </div>

        {/* Navigation */}
        <nav className="flex-1 space-y-2 px-2 py-6">
          {menu.map((item: MenuItem) => {
            const active = pathname === item.href;
            const Icon = item.icon;
            return (
              <Link
                key={item.href}
                href={item.href}
                onClick={handleLinkClick}
                title={item.label}
                className={`group relative flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium outline-none transition-colors hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${
                  active
                    ? "bg-blue-100 text-blue-700"
                    : "text-slate-700"
                } ${!sidebarOpen ? "justify-center" : ""}`}
              >
                <Icon className="h-5 w-5 flex-shrink-0" />
                {sidebarOpen && <span>{item.label}</span>}
              </Link>
            );
          })}
        </nav>

        {/* Profile & Logout */}
        <div className="border-t border-slate-200 p-4">
          <Link 
            href="/profile" 
            className={`mb-4 flex items-center gap-3 ${!sidebarOpen && "justify-center"} hover:bg-slate-100 p-2 rounded-md transition-colors`}
            onClick={handleLinkClick}
          >
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-slate-300 text-sm font-bold text-white">
              {session?.user.name?.charAt(0).toUpperCase()}
            </div>
            {sidebarOpen && (
              <div>
                <p className="truncate text-sm font-medium">{session?.user.name}</p>
              </div>
            )}
          </Link>
          <button
            onClick={() => signOut({ callbackUrl: "/" })}
            className={`w-full rounded-md bg-red-600 py-2 text-sm font-medium text-white outline-none transition hover:bg-red-700 focus-visible:ring-2 focus-visible:ring-red-500 ${
              !sidebarOpen ? "px-0 flex justify-center" : ""
            }`}
          >
            {sidebarOpen ? "Logout" : <span className="text-xs">⏻</span>}
          </button>
        </div>
      </aside>

      {/* Main wrapper */}
      <div className={`flex min-w-0 flex-1 flex-col transition-all duration-300 ${
        sidebarOpen ? "md:ml-0" : "md:ml-0"
      }`}>
        {/* Top bar */}
        <header className="flex items-center justify-between border-b border-slate-200 px-3 py-3 bg-white md:px-6">
          <button
            onClick={() => setSidebarOpen(true)}
            className="rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 md:hidden"
            aria-label="Open sidebar"
          >
            <Bars3Icon className="h-6 w-6" />
          </button>
          <div className="text-xl font-semibold">{titlePage}</div>
          {session?.user?.role !== "SUPER_ADMIN" && (
            <NotificationsBell />
          )}
        </header>

        {/* Content area */}
        <main className="min-h-0 flex-1 overflow-y-auto bg-gray-50 p-4 md:p-8 ">
          <div className="mx-auto w-full max-w-7xl">{children}</div>
        </main>
      </div>
    </div>
  );
}


=== FILE: src/components/notifications/NotificationsBell.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { BellIcon } from '@heroicons/react/24/outline';
import { useSession } from 'next-auth/react';
import { useNotificationsStore } from '../../store/notifications';
import { useRealTimeNotifications } from '../../hooks/useRealTimeNotifications';
import NotificationsPanel from './NotificationsPanel';

export default function NotificationsBell() {
  const { data: session } = useSession();
  const [isOpen, setIsOpen] = useState(false);
  const { 
    items: notifications,
    unreadCount,
    setItems,
    setUnreadCount,
    setCursor,
    setHasMore
  } = useNotificationsStore();

  // Enable real-time notifications via SSE
  const { isConnected } = useRealTimeNotifications();

  console.log('NotificationsBell - Current store state (v3-SSE):', { 
    notifications: notifications?.length, 
    unreadCount,
    isConnected
  });

  // Load initial notifications and unread count
  useEffect(() => {
    if (session?.user) {
      loadNotifications();
    }
  }, [session]);

  // Sync unread count with store items changes
  useEffect(() => {
    if (notifications.length > 0) {
      const calculatedUnreadCount = notifications.filter(n => !n.isRead).length;
      if (calculatedUnreadCount !== unreadCount) {
        setUnreadCount(calculatedUnreadCount);
      }
    }
  }, [notifications, unreadCount, setUnreadCount]);

  const loadNotifications = async () => {
    if (!session?.user) return;

    // Skip notifications for verifier role
    if (session.user.role === 'VERIFIER') {
      return;
    }

    try {
      // Determine scope based on user role
      let scope: string;
      if (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN') {
        scope = 'admin';
      } else if (session.user.role === 'REVIEWER') {
        scope = 'reviewer';
      } else if (session.user.role === 'APPROVER') {
        scope = 'approver';
      } else {
        scope = 'vendor';
      }

      const params = new URLSearchParams({
        scope,
        limit: '10'
      });

      // Add vendorId only for vendor scope
      if (scope === 'vendor' && session.user.id) {
        params.append('vendorId', session.user.id);
      }

      console.log('Loading notifications with params:', params.toString());
      console.log('Using endpoint: /api/v1/notifications (Build: 2025-09-06-v3)');

      const response = await fetch(`/api/v1/notifications?${params}`);
      if (response.ok) {
        const result = await response.json();
        console.log('Notifications loaded:', result);
        
        // Extract notifications from nested data structure
        const notifications = Array.isArray(result.data?.data) ? result.data.data : [];
        console.log('NotificationsBell - About to setItems with:', notifications);
        setItems(notifications);
        
        // Count unread notifications
        const unreadCount = notifications.filter((n: any) => !n.isRead).length;
        console.log('NotificationsBell - Setting unreadCount to:', unreadCount);
        console.log('NotificationsBell - All notifications:', notifications.map((n: any) => ({ id: n.id, isRead: n.isRead, title: n.title })));
        setUnreadCount(unreadCount);
        
        setCursor(result.data?.pagination?.nextCursor);
        setHasMore(result.data?.pagination?.hasMore || false);
      } else {
        console.error('Failed to load notifications:', response.status, response.statusText);
        const errorData = await response.json();
        console.error('Error details:', errorData);
      }
    } catch (error) {
      console.error('Error loading notifications:', error);
    }
  };

  if (!session?.user) {
    return null;
  }

  // Hide notification bell for verifiers as they don't receive notifications
  if (session.user.role === 'VERIFIER') {
    return null;
  }

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className={`relative p-2 rounded-lg transition-all duration-200 ${
          isOpen 
            ? 'bg-blue-50 text-blue-600' 
            : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
        }`}
        aria-label="Notifications"
      >
        <BellIcon className="h-6 w-6" />
        {unreadCount > 0 && (
          <span className="absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5">
            {unreadCount > 99 ? '99+' : unreadCount}
          </span>
        )}
      </button>

      {isOpen && (
        <NotificationsPanel 
          onClose={() => setIsOpen(false)}
        />
      )}
    </div>
  );
}


=== FILE: src/components/notifications/NotificationsPanel.tsx ===
import { useState, useEffect, useCallback } from 'react';
import { useSession } from 'next-auth/react';
import { 
  BellIcon, 
  XMarkIcon,
  CheckIcon,
  CheckCircleIcon,
  ClockIcon,
  UserPlusIcon,
  DocumentPlusIcon,
  ShieldCheckIcon,
  InboxIcon
} from '@heroicons/react/24/outline';
import Button from '../ui/button/Button';
import SubmissionDetailModal from '../vendor/SubmissionDetailModal';
import ApproverSubmissionDetailModal from '../approver/ApproverSubmissionDetailModal';
import ReviewerSubmissionDetailModal from '../reviewer/ImprovedReviewerSubmissionDetailModal';
import ReviewerUserVerificationModal from '../reviewer/ReviewerUserVerificationModal';
import { UserData } from '@/types/user';
import { useToast } from '@/hooks/useToast';

import { useNotificationsStore, type Notification } from '../../store/notifications';

interface NotificationsPanelProps {
  onClose: () => void;
}

export default function NotificationsPanel({
  onClose
}: NotificationsPanelProps) {
  const { data: session } = useSession();
  const { 
    items: notifications, 
    unreadCount, 
    markAsRead, 
    markAllAsRead 
  } = useNotificationsStore();
  const { showError, showWarning } = useToast();

  // Debug: log notifications data
  console.log('NotificationsPanel - notifications:', notifications);
  console.log('NotificationsPanel - notifications length:', notifications?.length);
  console.log('NotificationsPanel - unreadCount:', unreadCount);
  
  // Debug each notification
  if (notifications && notifications.length > 0) {
    notifications.slice(0, 3).forEach((notif, index) => {
      console.log(`Notification ${index}:`, {
        id: notif.id,
        type: notif.type,
        title: notif.title,
        message: notif.message,
        data: notif.data,
        isRead: notif.isRead,
        createdAt: notif.createdAt
      });
    });
  }
  
  const [selectedSubmission, setSelectedSubmission] = useState<any>(null);
  const [selectedSubmissionId, setSelectedSubmissionId] = useState<string | null>(null);
  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);
  
  // State for vendor verification modal
  const [selectedVendorUser, setSelectedVendorUser] = useState<UserData | null>(null);

  // Close panel when clicking outside
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        onClose();
      }
    };

    document.addEventListener('keydown', handleEscape);
    document.body.style.overflow = 'hidden';

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [onClose]);

  const handleViewDetail = async (notification: Notification) => {
    try {
      console.log('handleViewDetail called with notification:', notification);
      
      // Handle vendor notifications
      if (notification.type === 'user_registered' || notification.type === 'new_vendor' || notification.type === 'new_user_verification') {
        await handleVendorDetail(notification);
        return;
      }
      
      // Parse data dari notification untuk mendapatkan submission ID
      let submissionId = null;
      
      if (notification.data) {
        try {
          // Check if data is already an object or needs parsing
          const parsedData = typeof notification.data === 'string' 
            ? JSON.parse(notification.data) 
            : notification.data;
          submissionId = parsedData.submissionId || parsedData.submission_id;
          console.log('Extracted submissionId from data:', submissionId);
        } catch (e) {
          console.error('Error parsing notification data:', e);
          console.log('Raw notification.data:', notification.data);
        }
      }

      // Jika tidak ada submissionId, coba extract dari message atau title
      if (!submissionId) {
        // Cari pattern ID dalam message atau title
        const idPattern = /ID[:\s]+([a-zA-Z0-9]+)/i;
        const messageMatch = notification.message.match(idPattern);
        const titleMatch = notification.title.match(idPattern);
        
        submissionId = messageMatch?.[1] || titleMatch?.[1];
        console.log('Extracted submissionId from text:', submissionId);
      }

      if (!submissionId) {
        console.warn('No submission ID found in notification:', notification);
        return;
      }

      console.log('Fetching submission details for ID:', submissionId);

      // Determine API endpoint based on user role
      let apiEndpoint = `/api/submissions/${submissionId}`;
      if (session?.user?.role === 'APPROVER') {
        apiEndpoint = `/api/approver/simloks/${submissionId}`;
      } else if (session?.user?.role === 'REVIEWER') {
        apiEndpoint = `/api/reviewer/simloks/${submissionId}`;
      } else if (session?.user?.role === 'SUPER_ADMIN') {
        // Use submissions endpoint for super admin - admin endpoints no longer exist
        apiEndpoint = `/api/submissions/${submissionId}`;
      }

      // Fetch detail submission
      const response = await fetch(apiEndpoint);
      
      if (response.status === 404) {
        // Submission tidak ditemukan (mungkin sudah dihapus)
        console.warn('Submission not found:', submissionId);
        showWarning(
          'Pengajuan Tidak Ditemukan',
          'Pengajuan yang dirujuk dalam notifikasi ini sudah tidak tersedia atau telah dihapus.'
        );
        
        // Mark notification as read karena sudah dicoba akses
        if (!notification.isRead) {
          console.log('Marking notification as read (submission not found):', notification.id);
          await markAsRead(notification.id);
        }
        return;
      }
      
      if (!response.ok) {
        throw new Error(`Failed to fetch submission details: ${response.status}`);
      }

      const responseData = await response.json();
      console.log('Submission data fetched:', responseData);
      
      // Handle different response structures based on role
      const submissionData = responseData.submission || responseData;
      
      setSelectedSubmission(submissionData);
      setSelectedSubmissionId(submissionId);
      setIsDetailModalOpen(true);

      // Mark notification as read
      if (!notification.isRead) {
        console.log('Marking notification as read:', notification.id);
        await markAsRead(notification.id);
      }

    } catch (error) {
      console.error('Error viewing submission detail:', error);
      
      // Tampilkan pesan error yang user-friendly
      if (error instanceof Error) {
        if (error.message.includes('404')) {
          showWarning(
            'Pengajuan Tidak Ditemukan',
            'Pengajuan yang dirujuk dalam notifikasi ini sudah tidak tersedia atau telah dihapus.'
          );
        } else {
          showError(
            'Gagal Memuat Detail',
            'Terjadi kesalahan saat memuat detail pengajuan. Silakan coba lagi.'
          );
        }
      } else {
        showError(
          'Gagal Memuat Detail',
          'Terjadi kesalahan saat memuat detail pengajuan. Silakan coba lagi.'
        );
      }
    }
  };

  const handleVendorDetail = async (notification: Notification) => {
    try {
      console.log('handleVendorDetail called with notification:', notification);
      
      let vendorId = null;
      
      if (notification.data) {
        try {
          const parsedData = typeof notification.data === 'string' 
            ? JSON.parse(notification.data) 
            : notification.data;
          vendorId = parsedData.vendorId || parsedData.userId || parsedData.user_id;
          console.log('Extracted vendorId from data:', vendorId);
        } catch (e) {
          console.error('Error parsing notification data:', e);
          console.log('Raw notification.data:', notification.data);
        }
      }

      if (!vendorId) {
        console.warn('No vendor ID found in notification:', notification);
        return;
      }

      console.log('🔍 Fetching vendor data for ID:', vendorId);
      
      // Admin endpoints no longer exist - vendor user functionality disabled for now
      if (session?.user?.role === 'REVIEWER') {
        try {
          const response = await fetch(`/api/reviewer/users/${vendorId}`);
          
          if (response.status === 404) {
            console.warn('User not found:', vendorId);
            showWarning(
              'Data Vendor Tidak Ditemukan',
              'Data vendor yang dirujuk dalam notifikasi ini sudah tidak tersedia.'
            );
            return;
          }
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          console.log('✅ Vendor user data loaded:', data);
          setSelectedVendorUser(data.user);
        } catch (error) {
          console.error('❌ Error fetching vendor details:', error);
          showError('Error', 'Gagal memuat detail vendor');
        }
      } else {
        console.log('Vendor user functionality disabled for SUPER_ADMIN - admin endpoints removed');
        showWarning('Info', 'Fitur detail vendor tidak tersedia untuk role ini saat ini');
      }

      // Mark notification as read
      if (!notification.isRead) {
        console.log('Marking notification as read (vendor detail):', notification.id);
        await markAsRead(notification.id);
      }

    } catch (err) {
      console.error('❌ Error fetching vendor details:', err);
      
      // Tampilkan pesan error yang user-friendly
      if (err instanceof Error) {
        if (err.message.includes('404')) {
          showWarning(
            'Data Vendor Tidak Ditemukan',
            'Data vendor yang dirujuk dalam notifikasi ini sudah tidak tersedia.'
          );
        } else {
          showError(
            'Gagal Memuat Detail Vendor',
            'Gagal memuat detail vendor. Silakan coba lagi.'
          );
        }
      } else {
        showError(
          'Gagal Memuat Detail Vendor',
          'Gagal memuat detail vendor. Silakan coba lagi.'
        );
      }
    }
  };

  const handleCloseDetailModal = () => {
    setIsDetailModalOpen(false);
    setSelectedSubmission(null);
    setSelectedSubmissionId(null);
  };

  const formatTimeAgo = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);

    if (diffInSeconds < 60) {
      return 'Baru saja';
    } else if (diffInSeconds < 3600) {
      const minutes = Math.floor(diffInSeconds / 60);
      return `${minutes}m`;
    } else if (diffInSeconds < 86400) {
      const hours = Math.floor(diffInSeconds / 3600);
      return `${hours}j`;
    } else if (diffInSeconds < 604800) {
      const days = Math.floor(diffInSeconds / 86400);
      return `${days}h`;
    } else {
      return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'short'
      });
    }
  };

  const getNotificationIcon = (type: string) => {
    const iconClass = "w-5 h-5";
    switch (type) {
      case 'submission_approved':
        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;
      case 'submission_rejected':
        return <XMarkIcon className={`${iconClass} text-red-500`} />;
      case 'submission_pending':
        return <ClockIcon className={`${iconClass} text-amber-500`} />;
      case 'status_change':
        return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;
      case 'new_submission':
        return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;
      case 'user_registered':
      case 'new_vendor':
        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;
      default:
        return <BellIcon className={`${iconClass} text-gray-500`} />;
    }
  };

  const truncateText = (text: string, maxLength: number = 80) => {
    return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;
  };

  const getEnhancedMessage = useCallback((notification: Notification) => {
    const { type, message, title } = notification;
    
    // Create enhanced messages with clear status information
    switch (type) {
      case 'submission_approved':
        return {
          title: 'Pengajuan Disetujui',
          message: truncateText('Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.'),
          action: 'Lihat detail'
        };
      case 'submission_rejected':
        return {
          title: 'Pengajuan Ditolak',
          message: truncateText('Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.'),
          action: 'Lihat detail'
        };
      case 'submission_pending':
        return {
          title: 'Status Pending',
          message: truncateText('Pengajuan Simlok Anda sedang dalam proses review lebih lanjut.'),
          action: 'Lihat detail'
        };
      case 'status_change':
        // Use the server-provided title and message, but make status clear
        let enhancedTitle = title;
        let enhancedMessage = message;
        
        if (title.includes('Disetujui')) {
          enhancedTitle = 'Pengajuan Disetujui';
          enhancedMessage = 'Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.';
        } else if (title.includes('Ditolak')) {
          enhancedTitle = 'Pengajuan Ditolak';
          enhancedMessage = 'Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.';
        }
        
        return {
          title: truncateText(enhancedTitle, 50),
          message: truncateText(enhancedMessage),
          action: 'Lihat detail'
        };
      case 'new_submission':
        return {
          title: 'Pengajuan Baru Masuk',
          message: truncateText(message.replace('Pengajuan baru dari', 'Pengajuan Simlok baru dari')),
          action: 'Lihat detail'
        };
      case 'user_registered':
      case 'new_vendor':
      case 'new_user_verification':
        return {
          title: 'User Baru Perlu Verifikasi',
          message: truncateText(message.replace('User baru terdaftar', 'User baru mendaftar dan perlu verifikasi')),
          action: 'Lihat detail'
        };
      default:
        return {
          title: truncateText(title, 50),
          message: truncateText(message),
          action: 'Lihat detail'
        };
    }
  }, []);

  const hasSubmissionData = (notification: Notification) => {
    console.log('hasSubmissionData check for:', notification);
    
    // Check if this is a vendor notification
    if (notification.type === 'user_registered' || notification.type === 'new_vendor' || notification.type === 'new_user_verification') {
      return true;
    }
    
    // Check if notification contains submission data that can be viewed
    const hasSubmissionType = notification.type.includes('submission') || notification.type === 'status_change';
    
    let hasSubmissionId = false;
    if (notification.data) {
      if (typeof notification.data === 'string') {
        hasSubmissionId = notification.data.includes('submissionId');
      } else if (typeof notification.data === 'object') {
        hasSubmissionId = notification.data.submissionId || notification.data.submission_id;
      }
    }
    
    const hasIdInMessage = notification.message.includes('ID');
    const hasIdInTitle = notification.title.includes('ID');
    
    const result = hasSubmissionType || hasSubmissionId || hasIdInMessage || hasIdInTitle;
    
    console.log('hasSubmissionData result:', {
      notification: notification.id,
      type: notification.type,
      hasSubmissionType,
      hasSubmissionId,
      hasIdInMessage,
      hasIdInTitle,
      result
    });
    
    return result;
  };

  if (!notifications) return null;

  return (
    <>
      {/* Backdrop */}
      <div 
        className="fixed inset-0 z-40"
        onClick={onClose}
      />

      {/* Floating Panel */}
      <div 
        className="absolute right-0 top-12 w-[min(420px,90vw)] bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-[70vh] flex flex-col overflow-hidden"
        role="dialog"
        aria-label="Panel notifikasi"
      >
        
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0 bg-gray-50/50">
          <div className="flex items-center space-x-3">
            <div className="relative">
              <BellIcon className="w-5 h-5 text-gray-700" />
              {unreadCount > 0 && (
                <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">
                  <span className="text-[10px] font-semibold">{unreadCount > 9 ? '9+' : unreadCount}</span>
                </div>
              )}
            </div>
            <div>
              <h3 className="text-sm font-semibold text-gray-900">
                Notifikasi
              </h3>
              {unreadCount > 0 && (
                <p className="text-xs text-gray-500">
                  {unreadCount} belum dibaca
                </p>
              )}
            </div>
          </div>
          
          <div className="flex items-center space-x-2">
            {unreadCount > 0 && (
              <Button
                onClick={markAllAsRead}
                variant="outline"
                size="sm"
                className="text-xs px-3 py-1.5 hover:bg-blue-50 hover:border-blue-300 transition-colors"
              >
                <CheckIcon className="w-3 h-3 mr-1" />
                Tandai Semua
              </Button>
            )}
            <button
              onClick={onClose}
              className="p-1.5 hover:bg-gray-200:bg-gray-700 rounded-md transition-colors"
              aria-label="Tutup panel"
            >
              <XMarkIcon className="w-4 h-4 text-gray-500 hover:text-gray-700" />
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto" role="list" aria-label="Daftar notifikasi">
          {!notifications || notifications.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-12 px-6">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <InboxIcon className="w-8 h-8 text-gray-400" />
              </div>
              <h4 className="text-sm font-medium text-gray-900 mb-2">
                Tidak ada notifikasi
              </h4>
              <p className="text-xs text-gray-500 text-center leading-relaxed">
                Anda akan melihat notifikasi baru di sini ketika ada aktivitas
              </p>
            </div>
          ) : (
            <div className="divide-y divide-gray-100">
              {Array.isArray(notifications) && notifications.slice(0, 10).map((notification) => {
                const enhancedInfo = getEnhancedMessage(notification);
                const isUnread = !notification.isRead;
                const fullTimestamp = new Date(notification.createdAt).toLocaleString('id-ID');
                
                return (
                  <div
                    key={`notification-${notification.id}-${notification.createdAt}`}
                    role="listitem"
                    className={`group relative transition-all duration-200 hover:bg-gray-50:bg-gray-800/50 ${
                      isUnread 
                        ? 'bg-blue-50/50' 
                        : 'bg-white'
                    } ${
                      hasSubmissionData(notification) ? 'cursor-pointer' : ''
                    }`}
                    onClick={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                      if (hasSubmissionData(notification)) {
                        handleViewDetail(notification);
                      }
                    }}
                  >
                    {/* Unread indicator dot */}
                    {isUnread && (
                      <div className="absolute left-3 top-6 w-2 h-2 rounded-full bg-blue-600"></div>
                    )}
                    
                    <div className="p-3 pl-7">
                      <div className="flex items-start space-x-3">
                        {/* Icon */}
                        <div className="flex-shrink-0">
                          <div className="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center">
                            {getNotificationIcon(notification.type)}
                          </div>
                        </div>

                        {/* Content */}
                        <div className="flex-1 min-w-0">
                          {/* Header with time */}
                          <div className="flex items-start justify-between mb-1">
                            <h4 
                              className={`text-sm leading-tight ${
                                isUnread 
                                  ? 'font-semibold text-gray-900' 
                                  : 'font-medium text-gray-800'
                              }`}
                              style={{ lineClamp: 2, WebkitLineClamp: 2, display: '-webkit-box', WebkitBoxOrient: 'vertical', overflow: 'hidden' }}
                            >
                              {enhancedInfo.title}
                            </h4>
                            <span 
                              className="text-[11px] text-gray-500 whitespace-nowrap ml-2"
                              title={fullTimestamp}
                            >
                              {formatTimeAgo(notification.createdAt)}
                            </span>
                          </div>
                          
                          {/* Message */}
                          <p 
                            className="text-xs text-gray-600 leading-relaxed mb-2"
                            style={{ lineClamp: 2, WebkitLineClamp: 2, display: '-webkit-box', WebkitBoxOrient: 'vertical', overflow: 'hidden' }}
                          >
                            {enhancedInfo.message}
                          </p>

                          {/* Actions */}
                          <div className="flex items-center justify-between">
                            {hasSubmissionData(notification) && (
                              <button className="inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors">
                                {enhancedInfo.action}
                              </button>
                            )}
                            
                            {isUnread && (
                              <button
                                onClick={async (e) => {
                                  e.preventDefault();
                                  e.stopPropagation();
                                  await markAsRead(notification.id);
                                }}
                                className="inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50:bg-blue-900/20 transition-colors"
                                aria-label="Tandai sebagai dibaca"
                              >
                                <CheckIcon className="w-3 h-3 mr-1" />
                                Tandai dibaca
                              </button>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>

        {/* Footer */}
        {notifications.length > 0 && (
          <div className="border-t border-gray-200 p-3 flex-shrink-0 bg-gray-50/30">
            <div className="flex items-center justify-between text-xs">
              <span className="text-gray-500">
                {Math.min(notifications.length, 10)} dari {notifications.length}
              </span>
              {notifications.length && (
                <a
                  href="/dashboard/notifications"
                  className="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium hover:underline transition-colors"
                  onClick={onClose}
                >
                  Lihat semua →
                </a>
              )}
            </div>
          </div>
        )}
      </div>

      {/* Modal Detail Submission */}
      {selectedSubmission && selectedSubmissionId && (
        <>
          {session?.user?.role === 'APPROVER' && (
            <ApproverSubmissionDetailModal
              isOpen={isDetailModalOpen}
              onClose={handleCloseDetailModal}
              submissionId={selectedSubmissionId}
              onApprovalSubmitted={() => {
                // Refresh or handle approval completion
                handleCloseDetailModal();
              }}
            />
          )}
          
          {session?.user?.role === 'REVIEWER' && (
            <ReviewerSubmissionDetailModal
              isOpen={isDetailModalOpen}
              onClose={handleCloseDetailModal}
              submissionId={selectedSubmissionId}
              onReviewSubmitted={() => {
                // Refresh or handle review completion
                handleCloseDetailModal();
              }}
            />
          )}
          
          {session?.user?.role === 'SUPER_ADMIN' && (
            <SubmissionDetailModal
              submission={selectedSubmission}
              isOpen={isDetailModalOpen}
              onClose={handleCloseDetailModal}
            />
          )}
          
          {session?.user?.role === 'VENDOR' && (
            <SubmissionDetailModal
              submission={selectedSubmission}
              isOpen={isDetailModalOpen}
              onClose={handleCloseDetailModal}
            />
          )}
        </>
      )}

      {/* User Verification Modal for Vendor Details */}
      {selectedVendorUser && (
        <>
          {/* Show Reviewer User Verification Modal for REVIEWER role */}
          {session?.user?.role === 'REVIEWER' ? (
            <ReviewerUserVerificationModal
              isOpen={!!selectedVendorUser}
              onClose={() => {
                console.log('🚪 Closing reviewer user verification modal');
                setSelectedVendorUser(null);
              }}
              user={selectedVendorUser}
              onUserUpdate={(updatedUser: UserData) => {
                setSelectedVendorUser(updatedUser);
              }}
            />
          ) : (
            /* No admin modal available for SUPER_ADMIN roles - show basic info */
            <div>
              {/* Super Admin functionality not implemented yet */}
            </div>
          )}
        </>
      )}
    </>
  );
}


=== FILE: src/components/reviewer/ExportFilterModal.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import {
  XMarkIcon,
  ArrowDownTrayIcon,
  CalendarDaysIcon,
} from "@heroicons/react/24/outline";
import Button from '@/components/ui/button/Button';
import DatePicker from '@/components/form/DatePicker';

interface ExportFilterModalProps {
  isOpen: boolean;
  onClose: () => void;
  onExport: (filters: ExportFilters) => void;
  currentFilters: ExportFilters;
  exportLoading: boolean;
}

export interface ExportFilters {
  search: string;
  reviewStatus: string;
  finalStatus: string;
  startDate: string;
  endDate: string;
}

export default function ExportFilterModal({
  isOpen,
  onClose,
  onExport,
  currentFilters,
  exportLoading
}: ExportFilterModalProps) {
  const [startDate, setStartDate] = useState<string>('');
  const [endDate, setEndDate] = useState<string>('');

  // Reset dates when modal opens
  useEffect(() => {
    if (isOpen) {
      setStartDate('');
      setEndDate('');
    }
  }, [isOpen]);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    // Include current page filters but only use dates from modal
    onExport({
      search: currentFilters.search,
      reviewStatus: currentFilters.reviewStatus,
      finalStatus: currentFilters.finalStatus,
      startDate: startDate,
      endDate: endDate
    });
  };

  const handleReset = () => {
    setStartDate('');
    setEndDate('');
  };

  const hasDateFilter = startDate || endDate;

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-xl shadow-2xl w-full max-w-md">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div className="flex items-center space-x-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <ArrowDownTrayIcon className="h-5 w-5 text-green-600" />
            </div>
            <div>
              <h2 className="text-lg font-semibold text-gray-900">Export ke Excel</h2>
              <p className="text-sm text-gray-500">Pilih rentang tanggal untuk export</p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            disabled={exportLoading}
          >
            <XMarkIcon className="h-5 w-5 text-gray-500" />
          </button>
        </div>

        <form onSubmit={handleSubmit}>
          {/* Content */}
          <div className="p-6 space-y-4">
            {/* Date Range */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                <CalendarDaysIcon className="h-4 w-4 inline mr-1" />
                Filter Rentang Tanggal (Opsional)
              </label>
              <div className="space-y-3">
                <div>
                  <label className="block text-xs font-medium text-gray-600 mb-1">
                    Tanggal Mulai
                  </label>
                  <DatePicker
                    value={startDate}
                    onChange={(value) => setStartDate(value)}
                    placeholder="Pilih tanggal mulai"
                    className="border-gray-300 focus:ring-green-500 focus:border-green-500"
                  />
                </div>
                <div>
                  <label className="block text-xs font-medium text-gray-600 mb-1">
                    Tanggal Akhir
                  </label>
                  <DatePicker
                    value={endDate}
                    onChange={(value) => setEndDate(value)}
                    placeholder="Pilih tanggal akhir"
                    className="border-gray-300 focus:ring-green-500 focus:border-green-500"
                  />
                </div>
              </div>
              <p className="text-xs text-gray-500 mt-2">
                Kosongkan kedua field untuk export semua data
              </p>
            </div>

            {/* Info Summary */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
              <div className="text-sm text-blue-800">
                {hasDateFilter ? (
                  <div>
                    <div className="font-medium mb-1">Export dengan filter:</div>
                    <div>
                      📅 Tanggal: {
                        startDate && endDate 
                          ? `${new Date(startDate).toLocaleDateString('id-ID')} - ${new Date(endDate).toLocaleDateString('id-ID')}`
                          : startDate
                          ? `Dari ${new Date(startDate).toLocaleDateString('id-ID')}`
                          : `Sampai ${new Date(endDate).toLocaleDateString('id-ID')}`
                      }
                    </div>
                  </div>
                ) : (
                  <div>
                    <div className="font-medium">Export data SIMLOK ke Excel</div>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Footer */}
          <div className="p-6 border-t border-gray-200 bg-gray-50">
            <div className="flex gap-3 justify-end">
              {hasDateFilter && (
                <Button
                  type="button"
                  onClick={handleReset}
                  variant="outline"
                  size="sm"
                  disabled={exportLoading}
                  className="text-gray-600 border-gray-300 hover:bg-gray-50"
                >
                  Reset Tanggal
                </Button>
              )}
              <Button
                type="button"
                onClick={onClose}
                variant="outline"
                disabled={exportLoading}
              >
                Batal
              </Button>
              <Button
                type="submit"
                disabled={exportLoading}
                className="bg-green-600 hover:bg-green-700 text-white"
              >
                <ArrowDownTrayIcon className="h-4 w-4 mr-2" />
                {exportLoading ? 'Mengekspor...' : 'Export Excel'}
              </Button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}

=== FILE: src/components/reviewer/ImprovedReviewerSubmissionDetailModal.tsx ===
'use client';

import React, { useState, useEffect, useCallback, useMemo } from 'react';
import {
  XMarkIcon,
  CheckCircleIcon,
  XCircleIcon,
  DocumentTextIcon,
  UserGroupIcon,
  CalendarIcon,
  ArrowRightIcon,
  PencilIcon,
  TrashIcon,
  PlusIcon,
  BuildingOfficeIcon,
  UserIcon,
  BriefcaseIcon,
  DocumentIcon,
  EyeIcon
} from '@heroicons/react/24/outline';
import Button from '@/components/ui/button/Button';
import { useToast } from '@/hooks/useToast';
import DatePicker from '@/components/form/DatePicker';

import SimlokPdfModal from '@/components/common/SimlokPdfModal';
import DetailSection from '@/components/common/DetailSection';
import InfoCard from '@/components/common/InfoCard';
import DocumentPreviewModal from '@/components/common/DocumentPreviewModal';
import { fileUrlHelper } from '@/lib/fileUrlHelper';
import { useImplementationDates } from '@/hooks/useImplementationDates';

// Types
interface WorkerPhoto {
  id: string;
  worker_name: string;
  worker_photo: string;
  created_at: string;
}

interface SubmissionDetail {
  id: string;
  vendor_name: string;
  vendor_phone?: string;
  based_on: string;
  officer_name: string;
  officer_email?: string;
  job_description: string;
  work_location: string;
  implementation: string;
  working_hours: string;
  other_notes: string;
  work_facilities: string;
  worker_count: number | null;
  simja_number: string;
  simja_date: string | null;
  simja_document_upload?: string | null;
  sika_number: string;
  sika_date: string | null;
  sika_document_upload?: string | null;
  simlok_number: string | null;
  simlok_date: string | null;
  implementation_start_date: string | null;
  implementation_end_date: string | null;
  worker_names: string;
  content: string;
  notes: string;

  signer_position: string;
  signer_name: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  review_note: string;
  reviewed_by_name?: string;
  reviewed_by_email?: string;
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  final_note: string;
  approved_by_name?: string;
  approved_by_email?: string;
  created_at: string;
  reviewed_at: string;
  approved_at: string;
  worker_list: WorkerPhoto[];
}

// Date Range Component
interface DateRange {
  startDate: string;
  endDate: string;
}

interface ImprovedDateRangePickerProps {
  value: DateRange;
  onChange: (value: DateRange) => void;
  disabled?: boolean;
  className?: string;
}

const ImprovedDateRangePicker: React.FC<ImprovedDateRangePickerProps> = ({
  value,
  onChange,
  disabled = false,
  className = ''
}) => {
  const [localRange, setLocalRange] = useState<DateRange>(value);
  const [errors, setErrors] = useState<{ start?: string; end?: string }>({});

  // Sync with external value
  useEffect(() => {
    setLocalRange(value);
  }, [value]);

  // Validate date range
  const validateRange = useCallback((range: DateRange) => {
    const newErrors: { start?: string; end?: string } = {};

    if (range.startDate && range.endDate) {
      const startDate = new Date(range.startDate);
      const endDate = new Date(range.endDate);

      if (endDate < startDate) {
        newErrors.end = 'Tanggal selesai harus setelah tanggal mulai';
      }
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  }, []);

  // Handle start date change
  const handleStartChange = useCallback((startDate: string) => {
    const newRange = { ...localRange, startDate };
    setLocalRange(newRange);

    if (validateRange(newRange)) {
      onChange(newRange);
    }
  }, [localRange, onChange, validateRange]);

  // Handle end date change
  const handleEndChange = useCallback((endDate: string) => {
    const newRange = { ...localRange, endDate };
    setLocalRange(newRange);

    if (validateRange(newRange)) {
      onChange(newRange);
    }
  }, [localRange, onChange, validateRange]);

  // Calculate duration
  const getDuration = useCallback((): number | null => {
    if (!localRange.startDate || !localRange.endDate) return null;

    try {
      const start = new Date(localRange.startDate);
      const end = new Date(localRange.endDate);

      if (isNaN(start.getTime()) || isNaN(end.getTime())) return null;

      const diffTime = end.getTime() - start.getTime();
      return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
    } catch {
      return null;
    }
  }, [localRange]);

  const duration = getDuration();
  const hasValidRange = localRange.startDate && localRange.endDate && Object.keys(errors).length === 0;

  return (
    <div className={`relative ${className}`} style={{ overflow: 'visible' }}>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="relative" style={{ zIndex: 20 }}>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Tanggal Mulai Pelaksanaan
          </label>
          <DatePicker
            value={localRange.startDate}
            onChange={handleStartChange}
            disabled={disabled}
            placeholder="Pilih tanggal mulai"
            className="w-full relative"
          />
          {errors.start && (
            <div className="mt-1 text-sm text-red-600">{errors.start}</div>
          )}
        </div>

        <div className="relative" style={{ zIndex: 20 }}>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Tanggal Selesai Pelaksanaan
          </label>
          <DatePicker
            value={localRange.endDate}
            onChange={handleEndChange}
            disabled={disabled}
            placeholder="Pilih tanggal selesai"
            className="w-full relative"
          />
          {errors.end && (
            <div className="mt-1 text-sm text-red-600">{errors.end}</div>
          )}
        </div>
      </div>

      {hasValidRange && (
        <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <div className="flex items-center justify-between">
            <div className="flex items-center text-sm text-blue-800">
              <CalendarIcon className="h-4 w-4 mr-2" />
              <span className="font-medium">Periode Pelaksanaan:</span>
            </div>
            {duration && (
              <div className="text-sm font-medium text-blue-700 bg-blue-100 px-2 py-1 rounded">
                {duration} hari
              </div>
            )}
          </div>
          <div className="mt-2 text-sm text-blue-700">
            <div className="flex items-center">
              <span className="font-medium">
                {localRange.startDate ? new Date(localRange.startDate).toLocaleDateString('id-ID') : ''}
              </span>
              <ArrowRightIcon className="h-4 w-4 mx-2 text-blue-500" />
              <span className="font-medium">
                {localRange.endDate ? new Date(localRange.endDate).toLocaleDateString('id-ID') : ''}
              </span>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};



// Helper functions for status badges
const getReviewStatusBadge = (status: string) => {
  switch (status) {
    case 'PENDING_REVIEW':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200">
          <CalendarIcon className="w-3 h-3 mr-1" />
          Menunggu Review
        </span>
      );
    case 'MEETS_REQUIREMENTS':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200">
          <CheckCircleIcon className="w-3 h-3 mr-1" />
          Sesuai Persyaratan
        </span>
      );
    case 'NOT_MEETS_REQUIREMENTS':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200">
          <XCircleIcon className="w-3 h-3 mr-1" />
          Tidak Sesuai
        </span>
      );
    default:
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200">
          Status Tidak Diketahui
        </span>
      );
  }
};

const getFinalStatusBadge = (status: string) => {
  switch (status) {
    case 'PENDING_APPROVAL':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200">
          <CalendarIcon className="w-3 h-3 mr-1" />
          Menunggu Persetujuan
        </span>
      );
    case 'APPROVED':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200">
          <CheckCircleIcon className="w-3 h-3 mr-1" />
          Disetujui
        </span>
      );
    case 'REJECTED':
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200">
          <XCircleIcon className="w-3 h-3 mr-1" />
          Ditolak
        </span>
      );
    default:
      return (
        <span className="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200">
          Status Tidak Diketahui
        </span>
      );
  }
};

// Main Component Props
interface ReviewerSubmissionDetailModalProps {
  isOpen: boolean;
  onClose: () => void;
  submissionId: string;
  onReviewSubmitted: () => void;
}

const ImprovedReviewerSubmissionDetailModal: React.FC<ReviewerSubmissionDetailModalProps> = ({
  isOpen,
  onClose,
  submissionId,
  onReviewSubmitted,
}) => {
  // State management
  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);
  const [loading, setLoading] = useState(false);
  const [saving, setSaving] = useState(false);
  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'review'>('details');
  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);

  // Document preview modal state
  const [previewModal, setPreviewModal] = useState<{
    isOpen: boolean;
    fileUrl: string;
    fileName: string;
  }>({
    isOpen: false,
    fileUrl: '',
    fileName: ''
  });

  // Worker editing states
  const [isEditingWorkers, setIsEditingWorkers] = useState(false);
  const [editableWorkers, setEditableWorkers] = useState<WorkerPhoto[]>([]);
  const [workersToDelete, setWorkersToDelete] = useState<string[]>([]);
  const [editableWorkerCount, setEditableWorkerCount] = useState(0);
  const [workerCountInput, setWorkerCountInput] = useState('0');
  const [savingWorkers, setSavingWorkers] = useState(false);

  // Form states


  const [reviewData, setReviewData] = useState({
    review_status: '' as 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS' | '',
    review_note: '',
    final_note: ''
  });

  const [approvalForm, setApprovalForm] = useState({
    content: '',
    pelaksanaan: '',
    jabatan_signer: 'Sr Officer Security III',
    nama_signer: 'Julianto Santoso'
  });

  const { showSuccess, showError } = useToast();

  // Helper function to format date for Indonesian locale
  const formatDate = useCallback((dateStr: string | Date) => {
    if (!dateStr) return '';
    try {
      const date = new Date(dateStr);
      return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    } catch {
      return '';
    }
  }, []);

  // Handle file preview
  const handleFileView = useCallback((fileUrl: string, fileName: string) => {
    if (fileUrl) {
      // Convert legacy URL to new format if needed
      const convertedUrl = fileUrlHelper.convertLegacyUrl(fileUrl, fileName);
      setPreviewModal({
        isOpen: true,
        fileUrl: convertedUrl,
        fileName
      });
    }
  }, []);

  // Close file preview modal
  const handleClosePreview = useCallback(() => {
    setPreviewModal({
      isOpen: false,
      fileUrl: '',
      fileName: ''
    });
  }, []);

  // Use the improved implementation dates hook with stable dependencies
  const implementationDatesHook = useImplementationDates({
    simjaNumber: submission?.simja_number ?? '',
    simjaDate: submission?.simja_date ?? '',
    sikaNumber: submission?.sika_number ?? '',
    sikaDate: submission?.sika_date ?? '',
    signerPosition: approvalForm.jabatan_signer ?? 'Sr Officer Security III'
  });

  // Auto-fill pelaksanaan when implementation dates are set with correct template
  useEffect(() => {
    if (implementationDatesHook.dates.startDate && implementationDatesHook.dates.endDate) {
      const pelaksanaanTemplate = `Terhitung mulai tanggal ${formatDate(implementationDatesHook.dates.startDate)} sampai ${formatDate(implementationDatesHook.dates.endDate)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;

      setApprovalForm(prev => ({
        ...prev,
        pelaksanaan: pelaksanaanTemplate
      }));
    }
  }, [implementationDatesHook.dates.startDate, implementationDatesHook.dates.endDate, formatDate]);



  // Initialize editable workers when submission changes
  useEffect(() => {
    if (submission?.worker_list) {
      setEditableWorkers([...submission.worker_list]);
      setWorkersToDelete([]);
      const count = submission.worker_count || submission.worker_list.length;
      setEditableWorkerCount(count);
      setWorkerCountInput(count.toString());
    }
  }, [submission?.worker_list, submission?.worker_count]);



  // Sync input with worker count changes
  useEffect(() => {
    if (!isEditingWorkers) {
      setWorkerCountInput(editableWorkerCount.toString());
    }
  }, [editableWorkerCount, isEditingWorkers]);

  // Auto-sync worker count when workers are added/removed during editing
  useEffect(() => {
    if (isEditingWorkers) {
      // Only auto-sync when workers are actually added or removed
      // Don't force input changes when user manually changes count
      // This allows user to freely edit the input without interference
    }
  }, [editableWorkers.length, isEditingWorkers]);

  // Fetch submission details
  const fetchSubmissionDetail = useCallback(async () => {
    if (!submissionId || !isOpen) return;

    console.log('[Modal] Fetching submission detail for:', submissionId);

    try {
      setLoading(true);

      // Add abort controller to prevent multiple simultaneous requests
      const controller = new AbortController();

      const response = await fetch(`/api/reviewer/simloks/${submissionId}`, {
        signal: controller.signal
      });

      if (!response.ok) {
        if (response.status === 404) {
          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');
          onClose();
          // Add delay before refreshing so user can see the error message
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          return;
        }
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      const data = await response.json();
      const sub = data.submission;
      setSubmission(sub);

      setReviewData({
        review_status: sub.review_status === 'PENDING_REVIEW' ? '' : sub.review_status,
        review_note: sub.review_note || '',
        final_note: sub.final_note || ''
      });

      setApprovalForm({
        content: sub.content || 'Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.',
        pelaksanaan: sub.implementation || '',
        jabatan_signer: sub.signer_position || 'Sr Officer Security III',
        nama_signer: sub.signer_name || 'Julianto Santoso'
      });

    } catch (err: any) {
      console.error('Error fetching submission:', err);
      if (err.name !== 'AbortError') {
        showError('Error', err.message || 'Gagal memuat detail pengajuan');
      }
    } finally {
      setLoading(false);
    }
  }, [submissionId, isOpen, showError]);

  // Fetch scan history
  const fetchScanHistory = useCallback(async () => {
    if (!submissionId || !isOpen) return;

    console.log('[Modal] Fetching scan history for:', submissionId);

    try {
      const controller = new AbortController();

      const response = await fetch(`/api/submissions/${submissionId}/scans`, {
        signal: controller.signal
      });

      if (response.ok) {
        await response.json();
        // Scan history loaded successfully
      } else if (response.status !== 404) {
        console.warn('Failed to fetch scan history:', response.statusText);
      }
    } catch (err: any) {
      if (err.name !== 'AbortError') {
        console.error('Error fetching scan history:', err);
      }
    }
  }, [submissionId, isOpen]);

  // Handle review submission
  const handleSubmitReview = useCallback(async () => {
    if (!reviewData.review_status) {
      showError('Error', 'Pilih status review terlebih dahulu');
      return;
    }

    if (!reviewData.review_note.trim()) {
      showError('Error', 'Catatan review wajib diisi');
      return;
    }

    if (!reviewData.final_note.trim()) {
      showError('Error', 'Catatan untuk vendor wajib diisi');
      return;
    }

    try {
      setSaving(true);

      // 1. Save implementation dates and template data
      const updatePayload = {
        implementation_start_date: implementationDatesHook.dates.startDate,
        implementation_end_date: implementationDatesHook.dates.endDate,
        implementation: approvalForm.pelaksanaan,
        content: approvalForm.content,
        signer_position: approvalForm.jabatan_signer,
        signer_name: approvalForm.nama_signer,
        // Preserve SIMJA and SIKA dates to prevent them from being lost
        simja_number: submission?.simja_number,
        simja_date: submission?.simja_date,
        sika_number: submission?.sika_number,
        sika_date: submission?.sika_date,
        // Preserve worker count to prevent it from being reset
        worker_count: editableWorkerCount
      };

      const saveResponse = await fetch(`/api/reviewer/simloks/${submissionId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatePayload),
      });

      if (!saveResponse.ok) {
        if (saveResponse.status === 404) {
          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');
          onClose();
          // Add delay before refreshing so user can see the error message
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          return;
        }
        throw new Error('Gagal menyimpan template approval');
      }

      // 2. Submit review
      const reviewResponse = await fetch(`/api/reviewer/simloks/${submissionId}/review`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(reviewData),
      });

      if (!reviewResponse.ok) {
        if (reviewResponse.status === 404) {
          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');
          onClose();
          // Add delay before refreshing so user can see the error message
          setTimeout(() => {
            window.location.reload();
          }, 2000);
          return;
        }
        const errorData = await reviewResponse.json();
        throw new Error(errorData.error || 'Gagal mengirim review');
      }

      const data = await reviewResponse.json();
      setSubmission(data.submission);
      showSuccess('Berhasil', 'Review berhasil dikirim dan template approval tersimpan');
      onReviewSubmitted();

    } catch (err: any) {
      console.error('Error submitting review:', err);
      showError('Error', err.message || 'Gagal mengirim review');
    } finally {
      setSaving(false);
    }
  }, [
    submissionId,
    reviewData,
    implementationDatesHook.dates.startDate,
    implementationDatesHook.dates.endDate,
    implementationDatesHook.template.pelaksanaan,
    implementationDatesHook.template.lainLain,
    approvalForm,
    showSuccess,
    showError,
    onReviewSubmitted
  ]);

  // Effects with debouncing to prevent duplicate calls
  useEffect(() => {
    if (!isOpen || !submissionId) {
      return;
    }

    // Reset states when opening
    setActiveTab('details');
    setLoading(true);

    // Debounce the fetch calls
    const timeoutId = setTimeout(() => {
      fetchSubmissionDetail();
      fetchScanHistory();
    }, 100);

    return () => {
      clearTimeout(timeoutId);
    };
  }, [isOpen, submissionId]); // Removed function dependencies to prevent infinite loops

  // Initialize dates when submission data is loaded
  useEffect(() => {
    if (submission?.implementation_start_date && submission?.implementation_end_date) {
      implementationDatesHook.updateDates({
        startDate: new Date(submission.implementation_start_date).toISOString().split('T')[0] || '',
        endDate: new Date(submission.implementation_end_date).toISOString().split('T')[0] || ''
      });
    }
  }, [submission?.implementation_start_date, submission?.implementation_end_date]);

  useEffect(() => {
    if (!isOpen) {
      // Cleanup with delay to prevent rendering issues
      const timeoutId = setTimeout(() => {
        setSubmission(null);
        setLoading(false);
        setSaving(false);
        setIsPdfModalOpen(false);
        setActiveTab('details');
        setReviewData({
          review_status: '',
          review_note: '',
          final_note: ''
        });
        setApprovalForm({
          content: '',
          pelaksanaan: '',
          jabatan_signer: 'Sr Officer Security III',
          nama_signer: 'Julianto Santoso'
        });
        implementationDatesHook.reset();
      }, 50);

      return () => clearTimeout(timeoutId);
    }

    return undefined;
  }, [isOpen]);

  // Worker management functions
  const addWorker = () => {
    const newWorker: WorkerPhoto = {
      id: `temp_${Date.now()}`,
      worker_name: '',
      worker_photo: '',
      created_at: new Date().toISOString(),
    };
    setEditableWorkers(prev => [...prev, newWorker]);
  };

  const removeWorker = (workerId: string) => {
    // If it's a new temp worker, remove it immediately
    if (workerId.startsWith('temp_')) {
      setEditableWorkers(prev => prev.filter(w => w.id !== workerId));
    } else {
      // For existing workers, mark for deletion and hide from UI
      setWorkersToDelete(prev => [...prev, workerId]);
      setEditableWorkers(prev => prev.filter(w => w.id !== workerId));
    }
  };

  const updateWorkerName = (workerId: string, name: string) => {
    setEditableWorkers(prev =>
      prev.map(w => w.id === workerId ? { ...w, worker_name: name } : w)
    );
  };

  const updateWorkerPhoto = async (workerId: string, file: File) => {
    try {
      const formData = new FormData();
      formData.append('photo', file);

      const response = await fetch(`/api/reviewer/worker-photos/${workerId}`, {
        method: 'POST',
        body: formData,
      });

      if (response.ok) {
        const { photo_url } = await response.json();
        setEditableWorkers(prev =>
          prev.map(w => w.id === workerId ? { ...w, worker_photo: photo_url } : w)
        );
        showSuccess('Berhasil', 'Photo berhasil diunggah');
      } else {
        showError('Error', 'Gagal mengunggah photo');
      }
    } catch (error) {
      showError('Error', 'Terjadi kesalahan saat mengunggah photo');
    }
  };

  const saveWorkerChanges = async () => {
    // Validate worker count before saving
    if (editableWorkerCount === 0) {
      showError('Error', 'Harap mengisikan jumlah pekerja yang valid (minimal 1 orang)');
      return;
    }

    try {
      setSavingWorkers(true);

      // First, delete workers that were marked for deletion
      if (workersToDelete.length > 0) {
        for (const workerId of workersToDelete) {
          try {
            await fetch(`/api/reviewer/simloks/${submission?.id}/workers/${workerId}`, {
              method: 'DELETE',
            });
          } catch (error) {
            console.warn(`Failed to delete worker ${workerId}:`, error);
          }
        }
      }

      // Then update the worker list
      const response = await fetch(`/api/reviewer/simloks/${submission?.id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          worker_list: editableWorkers,
          worker_count: editableWorkerCount
        }),
      });

      if (response.ok) {
        await response.json();

        // Update local submission state to reflect deleted workers
        if (submission) {
          const filteredWorkers = submission.worker_list.filter(w => !workersToDelete.includes(w.id));
          setSubmission({
            ...submission,
            worker_list: [...filteredWorkers, ...editableWorkers.filter(w => w.id.startsWith('temp_'))],
            worker_count: editableWorkerCount
          });
        }

        // Clear workers to delete
        setWorkersToDelete([]);
        setIsEditingWorkers(false);
        showSuccess('Berhasil', 'Data pekerja berhasil diperbarui');
      } else {
        showError('Error', 'Gagal memperbarui data pekerja');
      }
    } catch (error) {
      showError('Error', 'Terjadi kesalahan saat memperbarui data pekerja');
    } finally {
      setSavingWorkers(false);
    }
  };

  const cancelWorkerEditing = () => {
    if (submission?.worker_list) {
      setEditableWorkers([...submission.worker_list]);
      const count = submission.worker_count || submission.worker_list.length;
      setEditableWorkerCount(count);
      setWorkerCountInput(count.toString());
    }
    setWorkersToDelete([]);
    setIsEditingWorkers(false);
  };

  // Helper functions
  const canEdit = useMemo(() => {
    return submission && submission.final_status === 'PENDING_APPROVAL';
  }, [submission?.final_status]);

  // Prevent rendering if not open or no submissionId
  if (!isOpen || !submissionId) return null;

  return (
    <div
      className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      onClick={(e) => {
        // Close modal when clicking backdrop
        if (e.target === e.currentTarget) {
          onClose();
        }
      }}
    >
      <div
        className="bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="flex items-center justify-between  p-6 border-b border-gray-200 flex-shrink-0">
          <div>
            <h2 className="text-xl font-semibold text-gray-900">Detail & Review Pengajuan</h2>
            {submission && (
              <div className="text-sm text-gray-500 mt-1 space-y-1">
                <p>
                  <span className="font-medium">{submission.vendor_name}</span> - {submission.officer_name}
                </p>
                {submission.simlok_number && (
                  <p className="text-xs">
                    <span className="font-medium">No. SIMLOK:</span> {submission.simlok_number}
                  </p>
                )}
              </div>
            )}
          </div>
          <Button onClick={onClose} variant="ghost" size="sm">
            <XMarkIcon className="h-6 w-6" />
          </Button>
        </div>

        {/* Tabs */}
        <div className="border-b border-gray-200 flex-shrink-0">
          <nav className="flex space-x-8 px-6">
            <button
              onClick={() => setActiveTab('details')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'details'
                ? 'border-blue-500 text-blue-600'
                : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
            >
              <DocumentTextIcon className="h-5 w-5 inline mr-2" />
              Detail SIMLOK
            </button>
            <button
              onClick={() => setActiveTab('workers')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'workers'
                ? 'border-blue-500 text-blue-600'
                : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
            >
              <UserGroupIcon className="h-5 w-5 inline mr-2" />
              Data Pekerja
            </button>
            <button
              onClick={() => setActiveTab('review')}
              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'review'
                ? 'border-blue-500 text-blue-600'
                : 'border-transparent text-gray-500 hover:text-gray-700'
                }`}
            >
              <CheckCircleIcon className="h-5 w-5 inline mr-2" />
              Review
            </button>
          </nav>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-6">
          {loading && (
            <div className="flex items-center justify-center py-12">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
          )}

          {submission && (
            <>
              {/* Review Tab */}
              {activeTab === 'review' && (
                <div className="space-y-8">
                  {/* Review Form */}
                  <div className="bg-white rounded-2xl gap-4 space-y-4 p-6 border border-gray-200 shadow-sm">
                    <div className="flex items-center justify-between mb-4 ">
                      <h3 className="text-lg font-bold text-gray-900">Review Pengajuan SIMLOK</h3>
                      {submission.review_status !== 'PENDING_REVIEW' && (
                        <span className="text-sm px-3 py-1 rounded-full bg-blue-100 text-blue-800 font-medium">
                          Sudah Direview
                        </span>
                      )}
                    </div>



                    {/* Implementation Dates */}
                    <div className="bg-white border border-gray-200 rounded-lg shadow-sm p-6 relative">
                      <h4 className="text-base font-medium text-gray-900 mb-4">Jadwal Pelaksanaan</h4>
                      <div style={{ overflow: 'visible', position: 'relative', zIndex: 10 }}>
                        <ImprovedDateRangePicker
                          value={implementationDatesHook.dates}
                          onChange={implementationDatesHook.updateDates}
                          disabled={submission.final_status !== 'PENDING_APPROVAL'}
                          className="mb-4"
                        />
                      </div>

                      {/* Generated Templates Preview */}
                      {implementationDatesHook.template.pelaksanaan && (
                        <div className="mt-6">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              Template Pelaksanaan (Auto-generated)
                            </label>
                            <div className="p-3 bg-gray-50 border rounded-lg text-sm">
                              {implementationDatesHook.template.pelaksanaan}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Pelaksanaan Input Fields */}
                      {implementationDatesHook.template.pelaksanaan && (
                        <div className="mt-6 space-y-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              5. Pelaksanaan
                            </label>
                            <textarea
                              value={approvalForm.pelaksanaan}
                              onChange={(e) => setApprovalForm(prev => ({ ...prev, pelaksanaan: e.target.value }))}
                              className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                                }`}
                              rows={3}
                              placeholder="Terhitung mulai tanggal..."
                              readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                            />
                          </div>

                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              6. Jam Kerja
                            </label>
                            <input
                              type="text"
                              value={submission?.working_hours || '08:00 WIB - 17:00 WIB'}
                              readOnly
                              className="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"
                            />
                            <p className="text-xs text-gray-500 mt-1">
                              Jam kerja diambil dari data vendor (tidak dapat diubah di tahap review)
                            </p>
                          </div>

                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              7. Lain-lain (Preview Template)
                            </label>
                            <div className="w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-sm">
                              <div className="text-gray-700 whitespace-pre-line">
                                {(() => {
                                  let template = "Izin diberikan berdasarkan:";

                                  // SIMJA section
                                  if (submission.simja_number && submission.simja_date) {
                                    template += `\n• Simja Ast Man Facility Management\n  ${submission.simja_number} Tgl. ${formatDate(submission.simja_date)}`;
                                  }

                                  // SIKA section  
                                  if (submission.sika_number && submission.sika_date) {
                                    template += `\n• SIKA Pekerjaan Dingin\n  ${submission.sika_number} Tgl. ${formatDate(submission.sika_date)}`;
                                  }

                                  // Head of Security section - akan diisi saat approval dengan tanggal SIMLOK
                                  template += `\n  Diterima Sr Officer Security III\n  [Tanggal SIMLOK - akan diisi saat approval]`;

                                  return template;
                                })()}
                              </div>
                            </div>
                            <p className="text-xs text-gray-500 mt-2">
                              ℹ️ Template ini akan di-generate otomatis oleh approver saat approval berdasarkan data SIMJA, SIKA dan tanggal SIMLOK. Reviewer tidak perlu mengisi field ini.
                            </p>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* Signer Information */}
                    <div className="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
                      <h4 className="text-base font-medium text-gray-900 mb-4">Data Penandatangan</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Jabatan</label>
                          <input
                            type="text"
                            value={approvalForm.jabatan_signer}
                            onChange={(e) => setApprovalForm(prev => ({ ...prev, jabatan_signer: e.target.value }))}
                            className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                              }`}
                            readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                          <input
                            type="text"
                            value={approvalForm.nama_signer}
                            onChange={(e) => setApprovalForm(prev => ({ ...prev, nama_signer: e.target.value }))}
                            className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                              }`}
                            readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                          />
                        </div>
                      </div>
                    </div>

                    {/* Content Field - Isi Surat Izin Masuk Lokasi */}
                    <div className="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
                      <h4 className="text-base font-medium text-gray-900 mb-4">Content - Isi Surat Izin Masuk Lokasi</h4>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Content
                          <span className="text-xs text-gray-500 ml-1">(Isi surat izin masuk lokasi)</span>
                        </label>
                        <textarea
                          value={approvalForm.content}
                          onChange={(e) => setApprovalForm(prev => ({ ...prev, content: e.target.value }))}
                          rows={4}
                          className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                            }`}
                          placeholder="Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis."
                          readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                        />
                        <p className="text-xs text-gray-500 mt-2">
                          Isi ketentuan dan syarat-syarat untuk surat izin masuk lokasi
                        </p>
                      </div>
                    </div>

                  </div>
                  <div className="space-y-4 bg-white rounded-2xl gap-4 p-6 border border-gray-200 shadow-sm">
                    <div>
                      <label className="block text-sm font-semibold text-gray-800 mb-2">
                        Catatan untuk Approver <span className="text-red-500">*</span>
                      </label>
                      <textarea
                        value={reviewData.review_note}
                        onChange={(e) => setReviewData({ ...reviewData, review_note: e.target.value })}
                        rows={4}
                        className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                          }`}
                        placeholder="Berikan penjelasan detail mengenai hasil review..."
                        readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-800 mb-2">
                        Catatan untuk Vendor <span className="text-red-500">*</span>
                      </label>
                      <textarea
                        value={reviewData.final_note}
                        onChange={(e) => setReviewData({ ...reviewData, final_note: e.target.value })}
                        rows={4}
                        className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''
                          }`}
                        placeholder="Berikan keterangan yang akan ditampilkan kepada vendor..."
                        readOnly={submission.final_status !== 'PENDING_APPROVAL'}
                        required
                      />
                      <p className="text-xs text-gray-500 mt-2">
                        Catatan ini akan ditampilkan kepada vendor setelah pengajuan disetujui/ditolak
                      </p>
                    </div>
                  </div>
                  {/* Review Decision */}
                  <div className="bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-8 border border-gray-200">
                    <h3 className="text-xl font-bold text-gray-900 mb-6 text-center">Keputusan Review</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <label className={`relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all ${reviewData.review_status === 'MEETS_REQUIREMENTS'
                        ? 'border-green-500 bg-green-50'
                        : 'border-gray-200 bg-white hover:border-green-300'
                        }`}>
                        <input
                          type="radio"
                          name="review_status"
                          value="MEETS_REQUIREMENTS"
                          checked={reviewData.review_status === 'MEETS_REQUIREMENTS'}
                          onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}
                          className="sr-only"
                          disabled={submission.final_status !== 'PENDING_APPROVAL'}
                        />
                        <div className="flex items-center">
                          <CheckCircleIcon className="h-5 w-5 mr-3 text-green-500" />
                          <div>
                            <div className="font-medium">Memenuhi Syarat</div>
                            <div className="text-sm text-gray-500">Sesuai persyaratan</div>
                          </div>
                        </div>
                      </label>

                      <label className={`relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all ${reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'
                        ? 'border-red-500 bg-red-50'
                        : 'border-gray-200 bg-white hover:border-red-300'
                        }`}>
                        <input
                          type="radio"
                          name="review_status"
                          value="NOT_MEETS_REQUIREMENTS"
                          checked={reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'}
                          onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}
                          className="sr-only"
                          disabled={submission.final_status !== 'PENDING_APPROVAL'}
                        />
                        <div className="flex items-center">
                          <XCircleIcon className="h-5 w-5 mr-3 text-red-500" />
                          <div>
                            <div className="font-medium">Tidak Memenuhi Syarat</div>
                            <div className="text-sm text-gray-500">Perlu perbaikan</div>
                          </div>
                        </div>
                      </label>
                    </div>

                    {/* Submit Button - Available while final status is PENDING_APPROVAL */}
                    {submission.final_status === 'PENDING_APPROVAL' && (
                      <div className="mt-6">
                        <Button
                          onClick={handleSubmitReview}
                          variant="primary"
                          disabled={!reviewData.review_status || !reviewData.review_note.trim() || !reviewData.final_note.trim() || saving}
                          className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 font-bold py-4 text-base"
                        >
                          {saving ? (
                            <div className="flex items-center justify-center">
                              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                              <span>
                                {submission.review_status === 'PENDING_REVIEW'
                                  ? 'Mengirim Review...'
                                  : 'Memperbarui Review...'}
                              </span>
                            </div>
                          ) : (
                            <span>
                              {submission.review_status === 'PENDING_REVIEW'
                                ? 'Submit Review'
                                : 'Update Review'}
                            </span>
                          )}
                        </Button>
                      </div>
                    )}

                    {/* Review Status Info - Show when already reviewed and can still edit */}
                    {submission.review_status !== 'PENDING_REVIEW' && submission.final_status === 'PENDING_APPROVAL' && (
                      <div className="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div className="text-center">
                          <div className="text-sm text-blue-700 mb-2 flex items-center justify-center">
                            <span className="mr-2">Status saat ini:</span>
                            {getReviewStatusBadge(submission.review_status)}
                          </div>
                          <p className="text-sm text-blue-600">
                            Anda dapat mengubah review ini karena belum disetujui/ditolak oleh approver
                          </p>
                        </div>
                      </div>
                    )}

                    {/* Final Review Status - Show when review is locked */}
                    {submission.final_status !== 'PENDING_APPROVAL' && (
                      <div className="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <div className="text-center">
                          <div className="text-sm text-gray-600 mb-2">
                            {getReviewStatusBadge(submission.review_status)}
                          </div>
                          <div className="text-sm text-gray-600 mb-2">
                            Status Akhir: {getFinalStatusBadge(submission.final_status)}
                          </div>
                          <p className="text-sm text-gray-500">
                            Review telah selesai pada {submission.reviewed_at ? new Date(submission.reviewed_at).toLocaleDateString('id-ID', {
                              day: 'numeric',
                              month: 'long',
                              year: 'numeric',
                              hour: '2-digit',
                              minute: '2-digit'
                            }) : '-'}
                          </p>
                          {submission.reviewed_by_name && (
                            <p className="text-xs text-gray-400 mt-1">
                              Direview oleh: {submission.reviewed_by_name}
                            </p>
                          )}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Details Tab */}
              {activeTab === 'details' && (
                <div className="space-y-6">
                  {/* Header dengan Status dan Review */}
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-medium text-gray-900">Detail SIMLOK</h3>
                    <div className="flex items-center space-x-3">
                      <span className="text-sm text-gray-500">Review:</span>
                      {getReviewStatusBadge(submission.review_status)}
                      <span className="text-sm text-gray-500">Status:</span>
                      {getFinalStatusBadge(submission.final_status)}
                    </div>
                  </div>

                  {/* Informasi Vendor - menggunakan DetailSection seperti admin */}
                  <DetailSection
                    title="Informasi Vendor"
                    icon={<BuildingOfficeIcon className="h-5 w-5 text-blue-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Nama Vendor"
                        value={submission.vendor_name}
                      />
                      <InfoCard
                        label="Nama Petugas"
                        value={submission.officer_name}
                        icon={<UserIcon className="h-4 w-4 text-gray-500" />}
                      />
                      {/* <InfoCard
                        label="Email"
                        value={submission.officer_email || '-'}
                      /> */}
                      <InfoCard
                        label="Nomor Telepon Vendor"
                        value={submission.vendor_phone || '-'}
                      />
                      <InfoCard
                        label="Berdasarkan"
                        value={submission.based_on}
                      />
                    </div>
                  </DetailSection>

                  {/* Informasi Dokumen - sama seperti admin */}
                  <DetailSection
                    title="Informasi Dokumen"
                    icon={<DocumentIcon className="h-5 w-5 text-orange-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      {submission.simja_number && (
                        <InfoCard
                          label="Nomor SIMJA"
                          value={submission.simja_number}
                        />
                      )}
                      {submission.simja_date && (
                        <InfoCard
                          label="Tanggal SIMJA"
                          value={formatDate(submission.simja_date)}

                        />
                      )}
                      {submission.sika_number && (
                        <InfoCard
                          label="Nomor SIKA"
                          value={submission.sika_number}
                        />
                      )}
                      {submission.sika_date && (
                        <InfoCard
                          label="Tanggal SIKA"
                          value={formatDate(submission.sika_date)}

                        />
                      )}
                      {/* Status dan Tanggal Pengajuan */}

                    </div>

                    <div className="grid grid-cols-1 mt-5 md:grid-cols-2 gap-4">
                      {/* Dokumen SIKA */}
                      {submission.sika_document_upload && (
                        <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                          <div className="flex items-center space-x-3">
                            <DocumentIcon className="h-6 w-6 text-red-500 flex-shrink-0" />
                            <div>
                              <p className="font-medium text-gray-900">Dokumen SIKA</p>
                              <p className="text-sm text-gray-500">File tersedia</p>
                            </div>
                          </div>
                          <button
                            onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}
                            className="flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
                          >
                            <EyeIcon className="w-4 h-4" />
                            <span>Lihat</span>
                          </button>
                        </div>
                      )}

                      {/* Dokumen SIMJA */}
                      {submission.simja_document_upload && (
                        <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                          <div className="flex items-center space-x-3">
                            <DocumentIcon className="h-6 w-6 text-blue-500 flex-shrink-0" />
                            <div>
                              <p className="font-medium text-gray-900">Dokumen SIMJA</p>
                              <p className="text-sm text-gray-500">File tersedia</p>
                            </div>
                          </div>
                          <button
                            onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}
                            className="flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
                          >
                            <EyeIcon className="w-4 h-4" />
                            <span>Lihat</span>
                          </button>
                        </div>
                      )}

                      {/* Message if no documents */}
                      {!submission.sika_document_upload && !submission.simja_document_upload && (
                        <div className="col-span-2 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                          <DocumentIcon className="h-12 w-12 text-gray-400 mx-auto mb-3" />
                          <h3 className="text-sm font-medium text-gray-900 mb-1">Tidak ada dokumen</h3>
                          <p className="text-sm text-gray-500">Belum ada dokumen yang diupload</p>
                        </div>
                      )}
                    </div>
                  </DetailSection>

                  {/* Detail Pekerjaan - sama seperti admin */}
                  <DetailSection
                    title="Informasi Pekerjaan"
                    icon={<BriefcaseIcon className="h-5 w-5 text-green-500" />}
                  >
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <InfoCard
                        label="Pekerjaan"
                        value={submission.job_description}
                      />
                      <InfoCard
                        label="Lokasi Kerja"
                        value={submission.work_location}
                      />
                      <InfoCard
                        label="Pelaksanaan"
                        value={submission.implementation || 'Belum diisi'}
                      />
                      <InfoCard
                        label="Jam Kerja"
                        value={submission.working_hours}
                      />
                      <InfoCard
                        label="Jumlah Pekerja"
                        value={`${submission.worker_count || 0} orang`}
                      />
                      <InfoCard
                        label="Sarana Kerja"
                        value={submission.work_facilities}
                      />
                    </div>

                  </DetailSection>

                </div>
              )}

              {/* Workers Tab */}
              {activeTab === 'workers' && (
                <div className="space-y-6">
                  {/* Header dengan jumlah pekerja */}
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-medium text-gray-900">Data Pekerja</h3>
                    <div className="flex items-center space-x-3">
                      {canEdit && (
                        isEditingWorkers ? (
                          <div className="flex gap-2">
                            <Button
                              onClick={cancelWorkerEditing}
                              variant="outline"
                              size="sm"
                            >
                              Batal
                            </Button>
                            <Button
                              onClick={saveWorkerChanges}
                              variant="primary"
                              size="sm"
                              disabled={savingWorkers}
                            >
                              {savingWorkers ? 'Menyimpan...' : 'Simpan'}
                            </Button>
                          </div>
                        ) : (
                          <Button
                            onClick={() => setIsEditingWorkers(true)}
                            variant="primary"
                            size="sm"
                          >
                            <PencilIcon className="w-4 h-4 mr-2" />
                            Edit Pekerja
                          </Button>
                        )
                      )}

                      {/* Badge Total selalu tampil */}
                      <span className="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">
                        Total: {isEditingWorkers ? editableWorkerCount : (submission.worker_count ||
                          (submission.worker_names ? submission.worker_names.split('\n').filter(name => name.trim()).length : submission.worker_list.length)
                        )} pekerja
                      </span>
                    </div>
                  </div>

                  {/* Worker Count Configuration - Vendor Style */}
                  {isEditingWorkers && (
                    <div className="space-y-4 mb-6">
                      <div>
                        <label htmlFor="jumlah_pekerja" className="mb-1.5 block text-sm font-medium text-gray-700">
                          Jumlah Pekerja
                        </label>
                        <input
                          id="jumlah_pekerja"
                          name="jumlah_pekerja"
                          type="text"
                          value={workerCountInput}
                          onChange={(e) => {
                            const inputValue = e.target.value;

                            // Allow completely empty input (show placeholder)
                            if (inputValue === '') {
                              setWorkerCountInput('');
                              setEditableWorkerCount(0);
                              return;
                            }

                            // Only allow numeric input - remove any non-numeric characters
                            const cleanValue = inputValue.replace(/\D/g, '');

                            // If after cleaning there's nothing left, make it empty
                            if (cleanValue === '') {
                              setWorkerCountInput('');
                              setEditableWorkerCount(0);
                              return;
                            }

                            const numValue = parseInt(cleanValue, 10);
                            if (!isNaN(numValue) && numValue >= 0 && numValue <= 9999) {
                              setWorkerCountInput(cleanValue);
                              setEditableWorkerCount(numValue);
                            }
                          }}
                          onKeyDown={(e) => {
                            // Allow all navigation and editing keys
                            const allowedKeys = [
                              'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',
                              'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
                              'Home', 'End', 'PageUp', 'PageDown'
                            ];

                            if (allowedKeys.includes(e.key)) {
                              return; // Allow these keys
                            }

                            // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X, Ctrl+Z
                            if (e.ctrlKey && ['a', 'c', 'v', 'x', 'z'].includes(e.key.toLowerCase())) {
                              return;
                            }

                            // Only allow numeric keys (0-9)
                            if (!/[0-9]/.test(e.key)) {
                              e.preventDefault();
                            }
                          }}
                          onBlur={() => {
                            // Only auto-correct to 1 if user actually wants to save with empty value
                            // During editing, allow empty state to show placeholder
                            if (workerCountInput === '') {
                              // Keep it empty to show placeholder, don't force a value
                              setEditableWorkerCount(0);
                            }
                          }}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Masukkan jumlah pekerja"
                        />
                        <p className="text-sm text-gray-500 mt-1">
                          Jumlah total pekerja yang akan bekerja di lokasi ini
                        </p>
                      </div>

                      <div className="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg w-full">
                        <div className="font-medium mb-1">Info:</div>
                        <div>Pekerja yang diinput foto: {editableWorkers.length}</div>
                        <div>Jumlah pekerja: {editableWorkerCount || 0}</div>
                        {editableWorkerCount > 0 && editableWorkers.length !== editableWorkerCount && (
                          <div className="text-orange-600 mt-1">
                            Jumlah tidak sesuai dengan daftar pekerja
                          </div>
                        )}
                        {editableWorkerCount > 0 && editableWorkers.length === editableWorkerCount && (
                          <div className="text-green-600 mt-1">
                            Jumlah sesuai dengan daftar pekerja
                          </div>
                        )}
                        {editableWorkerCount === 0 && (
                          <div className="text-red-600 mt-1">
                            Harap mengisikan jumlah pekerja (minimal 1 orang)
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {submission.worker_list.length === 0 ? (
                    <div className="text-center py-16">
                      <UserGroupIcon className="mx-auto h-16 w-16 text-gray-400 mb-4" />
                      <h3 className="text-lg font-medium text-gray-900 mb-2">Belum ada foto pekerja</h3>
                      <p className="text-gray-500 max-w-md mx-auto">
                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.
                      </p>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                      {(isEditingWorkers ? editableWorkers : submission.worker_list).map((worker, workerIndex) => (
                        <div
                          key={`worker-${workerIndex}-${worker.worker_name}`}
                          className="bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group"
                        >
                          {/* Photo Section */}
                          <div className="relative p-4 pb-2">
                            <div className="relative">
                              {worker.worker_photo ? (
                                <img
                                  src={worker.worker_photo}
                                  alt={`Foto ${worker.worker_name}`}
                                  className="w-full h-48 rounded-lg object-cover shadow-sm"
                                  onError={(e) => {
                                    const target = e.target as HTMLImageElement;
                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';
                                  }}
                                />
                              ) : (
                                <div className="w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm">
                                  <div className="text-center text-gray-500">
                                    <svg className="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20">
                                      <path fillRule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clipRule="evenodd" />
                                    </svg>
                                    <p className="text-sm">Tidak ada foto</p>
                                  </div>
                                </div>
                              )}
                              {isEditingWorkers && (
                                <div className="absolute top-2 right-2 flex gap-1">
                                  <label className="cursor-pointer bg-blue-500 text-white p-1.5 rounded-full hover:bg-blue-600 transition-colors">
                                    <input
                                      type="file"
                                      accept="image/*"
                                      className="hidden"
                                      onChange={(e) => {
                                        const file = e.target.files?.[0];
                                        if (file) {
                                          updateWorkerPhoto(worker.id, file);
                                        }
                                      }}
                                    />
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                  </label>
                                  <button
                                    onClick={() => removeWorker(worker.id)}
                                    className="bg-red-500 text-white p-1.5 rounded-full hover:bg-red-600 transition-colors"
                                  >
                                    <TrashIcon className="w-4 h-4" />
                                  </button>
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Info Section */}
                          <div className="px-4 pb-4">
                            {isEditingWorkers ? (
                              <input
                                type="text"
                                value={worker.worker_name}
                                onChange={(e) => updateWorkerName(worker.id, e.target.value)}
                                className="w-full font-semibold text-gray-900 text-sm mb-1 border border-gray-300 rounded px-2 py-1 focus:border-blue-500 focus:outline-none"
                                placeholder="Nama pekerja"
                              />
                            ) : (
                              <h4 className="font-semibold text-gray-900 text-sm mb-1 truncate">
                                {worker.worker_name}
                              </h4>
                            )}
                          </div>
                        </div>
                      ))}
                      {isEditingWorkers && (
                        <div className="bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors">
                          <button
                            onClick={addWorker}
                            className="w-full h-64 flex flex-col items-center justify-center text-gray-500 hover:text-gray-700 transition-colors"
                          >
                            <PlusIcon className="w-12 h-12 mb-2" />
                            <span className="text-sm font-medium">Tambah Pekerja</span>
                          </button>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              )}
            </>
          )}
        </div>

        {/* Footer */}
        <div className="flex items-center justify-between p-6 border-t border-gray-200 bg-white">
          <div>
            {submission?.review_status !== 'PENDING_REVIEW' && !isEditingWorkers && (
              <Button onClick={() => setIsPdfModalOpen(true)} variant="primary" size="sm">
                <DocumentTextIcon className="w-4 h-4 mr-2" />
                Lihat Preview PDF SIMLOK
              </Button>
            )}
          </div>
          <Button onClick={onClose} variant="outline">
            Tutup
          </Button>
        </div>
      </div>

      {/* PDF Modal */}
      <SimlokPdfModal
        isOpen={isPdfModalOpen}
        onClose={() => setIsPdfModalOpen(false)}
        submissionId={submissionId}
        submissionName={submission?.vendor_name || ''}
        nomorSimlok={submission?.simlok_number || ''}
      />

      {/* Document Preview Modal */}
      <DocumentPreviewModal
        isOpen={previewModal.isOpen}
        onClose={handleClosePreview}
        fileUrl={previewModal.fileUrl}
        fileName={previewModal.fileName}
      />
    </div>
  );
};

export default ImprovedReviewerSubmissionDetailModal;

=== FILE: src/components/reviewer/ReviewerDashboard.tsx ===
'use client';

import { useState, useEffect, useCallback } from 'react';
import {
  ClipboardDocumentListIcon,
  ClockIcon,
  CheckCircleIcon,
  ExclamationTriangleIcon,
  EyeIcon
} from '@heroicons/react/24/outline';

import Button from '@/components/ui/button/Button';
import Alert from '@/components/ui/alert/Alert';
import { useSocket } from '@/components/common/RealtimeUpdates';
import PageLoader from '@/components/ui/PageLoader';
import ReviewerSubmissionDetailModal from './ImprovedReviewerSubmissionDetailModal';
import Link from 'next/link';

interface Submission {
  id: string;
  approval_status: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  review_note?: string;
  final_note?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  reviewed_at?: string;
  approved_at?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  reviewed_by_user?: {
    id: string;
    officer_name: string;
    email: string;
  };
  approved_by_final_user?: {
    id: string;
    officer_name: string;
    email: string;
  };
  worker_list: Array<{
    id: string;
    worker_name: string;
    worker_photo: string | null;
  }>;
}

interface StatsData {
  pendingReview: number;
  meetsRequirements: number;
  notMeetsRequirements: number;
  total: number;
  pendingUserVerifications?: number;
  totalVerifiedUsers?: number;
}

const ReviewerDashboard = () => {
  const [submissions, setSubmissions] = useState<Submission[]>([]);
  const [stats, setStats] = useState<StatsData>({ 
    pendingReview: 0, 
    meetsRequirements: 0, 
    notMeetsRequirements: 0, 
    total: 0,
    pendingUserVerifications: 0,
    totalVerifiedUsers: 0
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  
  // Modal state
  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const fetchDashboardData = useCallback(async () => {
    try {
      setLoading(true);
      
      // Fetch stats dan 10 submission terakhir untuk dashboard
      const response = await fetch('/api/reviewer/simloks?page=1&limit=10&sortBy=created_at&sortOrder=desc');
      if (!response.ok) {
        throw new Error('Gagal mengambil data dashboard');
      }
      
      const data = await response.json();
      setSubmissions(data.submissions || []);
      setStats(data.stats || { pendingReview: 0, meetsRequirements: 0, notMeetsRequirements: 0, total: 0 });
      setError(null);
    } catch (err) {
      console.error('Error fetching dashboard data:', err);
      setError('Gagal memuat data dashboard');
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchDashboardData();
  }, [fetchDashboardData]);

  // Socket untuk real-time updates
  const socket = useSocket();
  
  useEffect(() => {
    if (!socket) return;

    // Join reviewer room
    socket.emit('join', { role: 'REVIEWER' });

    const handleNotificationNew = (notification: any) => {
      console.log('New notification received for reviewer:', notification);
      if (notification.type === 'new_submission_review') {
        fetchDashboardData();
      }
    };

    const handleStatsUpdate = (statsUpdate: any) => {
      console.log('Stats update received for reviewer:', statsUpdate);
      if (statsUpdate.scope === 'reviewer') {
        fetchDashboardData();
      }
    };

    const handleSubmissionCreated = () => {
      console.log('New submission created - updating reviewer dashboard');
      fetchDashboardData();
    };

    // Listen for new notifications (including new submissions to review)
    socket.on('notification:new', handleNotificationNew);
    // Listen for stats updates
    socket.on('stats:update', handleStatsUpdate);
    // Listen for new submission events
    socket.on('submission:created', handleSubmissionCreated);

    return () => {
      socket.off('notification:new', handleNotificationNew);
      socket.off('stats:update', handleStatsUpdate);
      socket.off('submission:created', handleSubmissionCreated);
    };
  }, [socket, fetchDashboardData]);

  const handleViewDetail = (submissionId: string) => {
    setSelectedSubmission(submissionId);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
    setSelectedSubmission(null);
  };

  const handleReviewSubmitted = () => {
    fetchDashboardData();
    handleCloseModal();
  };

  const getStatusBadge = (status: string, type: 'review' | 'final') => {
    const baseClasses = "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";
    
    if (type === 'review') {
      switch (status) {
        case 'PENDING_REVIEW':
          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;
        case 'MEETS_REQUIREMENTS':
          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;
        case 'NOT_MEETS_REQUIREMENTS':
          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;
        default:
          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;
      }
    } else {
      switch (status) {
        case 'PENDING_APPROVAL':
          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Persetujuan</span>;
        case 'APPROVED':
          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;
        case 'REJECTED':
          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;
        default:
          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;
      }
    }
  };

  if (loading) {
    return <PageLoader message="Memuat dashboard reviewer..." />;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        {error && (
          <Alert variant="error" title="Error" message={error} className="mb-6" />
        )}

        {/* Statistics Cards - Updated Design */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">Total Pengajuan</h3>
                <p className="text-2xl font-bold text-blue-600 mt-1">{stats?.total || 0}</p>
              </div>
              <div className="p-3 bg-blue-100 rounded-full">
                <ClipboardDocumentListIcon className="w-6 h-6 text-blue-600" />
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">Menunggu Review</h3>
                <p className="text-2xl font-bold text-amber-600 mt-1">{stats?.pendingReview || 0}</p>
              </div>
              <div className="p-3 bg-amber-100 rounded-full">
                <ClockIcon className="w-6 h-6 text-amber-600" />
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">Memenuhi Syarat</h3>
                <p className="text-2xl font-bold text-green-600 mt-1">{stats?.meetsRequirements || 0}</p>
              </div>
              <div className="p-3 bg-green-100 rounded-full">
                <CheckCircleIcon className="w-6 h-6 text-green-600" />
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">Tidak Memenuhi Syarat</h3>
                <p className="text-2xl font-bold text-red-600 mt-1">{stats?.notMeetsRequirements || 0}</p>
              </div>
              <div className="p-3 bg-red-100 rounded-full">
                <ExclamationTriangleIcon className="w-6 h-6 text-red-600" />
              </div>
            </div>
          </div>
        </div>

        {/* User Verification Stats */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">User Perlu Verifikasi</h3>
                <p className="text-2xl font-bold text-purple-600 mt-1">{stats?.pendingUserVerifications || 0}</p>
              </div>
              <div className="p-3 bg-purple-100 rounded-full">
                <svg className="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                </svg>
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-xl border shadow-sm p-6">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-sm font-medium text-gray-500">User Terverifikasi</h3>
                <p className="text-2xl font-bold text-indigo-600 mt-1">{stats?.totalVerifiedUsers || 0}</p>
              </div>
              <div className="p-3 bg-indigo-100 rounded-full">
                <svg className="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        {/* Recent Submissions */}
        <div className="bg-white shadow rounded-lg">
          <div className="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
            <h2 className="text-lg font-medium text-gray-900 flex items-center">
              <ClipboardDocumentListIcon className="w-5 h-5 mr-2 text-blue-600" />
              10 Pengajuan Terakhir
            </h2>
            <Link href="/reviewer/submissions">
              <Button variant="outline" size="sm">
                Lihat Semua Pengajuan
              </Button>
            </Link>
          </div>

          {submissions.length === 0 ? (
            <div className="text-center py-12">
              <ClipboardDocumentListIcon className="mx-auto h-12 w-12 text-gray-400" />
              <h3 className="mt-2 text-sm font-medium text-gray-900">Belum ada pengajuan</h3>
              <p className="mt-1 text-sm text-gray-500">Pengajuan yang perlu direview akan muncul di sini</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Vendor & Petugas
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Lokasi Kerja
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status Review
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status Akhir
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Tanggal Dibuat
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Aksi
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {submissions.map((submission) => (
                    <tr key={submission.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4">
                        <div>
                          <div className="text-sm font-medium text-gray-900">{submission.vendor_name}</div>
                          <div className="text-sm text-gray-500">{submission.user.officer_name}</div>
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="text-sm text-gray-900">{submission.work_location}</div>
                      </td>
                      <td className="px-6 py-4">
                        {getStatusBadge(submission.review_status, 'review')}
                      </td>
                      <td className="px-6 py-4">
                        {getStatusBadge(submission.final_status, 'final')}
                      </td>
                      <td className="px-6 py-4 text-sm text-gray-500">
                        {new Date(submission.created_at).toLocaleDateString('id-ID')}
                      </td>
                      <td className="px-6 py-4">
                        <Button
                          onClick={() => handleViewDetail(submission.id)}
                          variant="ghost"
                          size="sm"
                          className="text-blue-600 hover:text-blue-900"
                        >
                          <EyeIcon className="w-4 h-4 mr-1" />
                          Detail
                        </Button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      </div>

      {/* Modal */}
      {selectedSubmission && (
        <ReviewerSubmissionDetailModal
          key={selectedSubmission}
          isOpen={isModalOpen}
          onClose={handleCloseModal}
          submissionId={selectedSubmission}
          onReviewSubmitted={handleReviewSubmitted}
        />
      )}
    </div>
  );
};

export default ReviewerDashboard;

=== FILE: src/components/reviewer/ReviewerScanHistoryContent.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import {
  MagnifyingGlassIcon,
  FunnelIcon,
  QrCodeIcon,
  UserIcon,
  DocumentTextIcon,
  ClockIcon,
  EyeIcon,
  ChevronLeftIcon,
  ChevronRightIcon
} from '@heroicons/react/24/outline';
import { formatDistanceToNow, format } from 'date-fns';
import { id } from 'date-fns/locale';
import Button from '@/components/ui/button/Button';
import { Badge } from '@/components/ui/Badge';
import Alert from '@/components/ui/alert/Alert';
import DatePicker from '@/components/form/DatePicker';
import SimlokPdfModal from '@/components/common/SimlokPdfModal';

interface QrScan {
  id: string;
  submission_id: string;
  scanned_by: string;
  scanned_at: string;
  scanner_name?: string;
  scan_location?: string;
  notes?: string;
  submission: {
    id: string;
    simlok_number: string;
    vendor_name: string;
    job_description: string;
    review_status: string;
    final_status: string;
  };
  user: {
    id: string;
    full_name: string;
    email: string;
    role: string;
  };
}

interface FilterState {
  dateFrom: string;
  dateTo: string;
  verifier: string;
  submissionId: string;
}

export default function ReviewerScanHistoryContent() {
  const [scans, setScans] = useState<QrScan[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string>('');
  const [filters, setFilters] = useState<FilterState>({
    dateFrom: '',
    dateTo: '',
    verifier: '',
    submissionId: ''
  });
  const [showFilters, setShowFilters] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);
  const [showPdfModal, setShowPdfModal] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');

  const pageSize = 15;

  const fetchScanHistory = async () => {
    try {
      setLoading(true);
      setError('');

      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: pageSize.toString(),
        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),
        ...(filters.dateTo && { dateTo: filters.dateTo }),
        ...(filters.verifier && { verifier: filters.verifier }),
        ...(filters.submissionId && { submissionId: filters.submissionId }),
        ...(searchTerm && { search: searchTerm })
      });

      const response = await fetch(`/api/scan-history?${params}`);
      
      if (!response.ok) {
        throw new Error('Failed to fetch scan history');
      }

      const data = await response.json();
      setScans(data.scans || []);
      setTotalPages(Math.ceil((data.total || 0) / pageSize));
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    const timer = setTimeout(() => {
      fetchScanHistory();
    }, 300);

    return () => clearTimeout(timer);
  }, [currentPage, searchTerm]);

  const handleFilterSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setCurrentPage(1);
    fetchScanHistory();
  };

  const resetFilters = () => {
    setFilters({
      dateFrom: '',
      dateTo: '',
      verifier: '',
      submissionId: ''
    });
    setSearchTerm('');
    setCurrentPage(1);
    fetchScanHistory();
  };

  const getStatusBadge = (status: string, type: 'review' | 'final') => {
    if (type === 'review') {
      switch (status) {
        case 'PENDING_REVIEW':
          return <Badge variant="warning">Menunggu Review</Badge>;
        case 'MEETS_REQUIREMENTS':
          return <Badge variant="success">Memenuhi Syarat</Badge>;
        case 'NOT_MEETS_REQUIREMENTS':
          return <Badge variant="destructive">Tidak Memenuhi Syarat</Badge>;
        default:
          return null;
      }
    } else {
      switch (status) {
        case 'PENDING_APPROVAL':
          return <Badge variant="warning">Menunggu Persetujuan</Badge>;
        case 'APPROVED':
          return <Badge variant="success">Disetujui</Badge>;
        case 'REJECTED':
          return <Badge variant="destructive">Ditolak</Badge>;
        default:
          return null;
      }
    }
  };

  return (
    <div className="space-y-6">
      {/* Header with Search and Filters */}
      <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
          <div className="flex items-center space-x-3">
            <div className="p-2 bg-blue-100 rounded-lg">
              <QrCodeIcon className="h-6 w-6 text-blue-600" />
            </div>
            <div>
              <h2 className="text-xl font-semibold text-gray-900">Manajemen Riwayat Scan</h2>
              <p className="text-sm text-gray-500">Pantau aktivitas scan QR code oleh verifikator</p>
            </div>
          </div>

          <div className="flex items-center space-x-3">
            <Button
              onClick={() => setShowFilters(!showFilters)}
              variant={showFilters ? 'secondary' : 'primary'}
              className="flex items-center space-x-2"
            >
              <FunnelIcon className="h-4 w-4" />
              <span>Filter</span>
            </Button>
          </div>
        </div>

        {/* Search Bar */}
        <div className="relative mb-4">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            type="text"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            placeholder="Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator..."
            className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        {/* Advanced Filters */}
        {showFilters && (
          <div className="border-t border-gray-200 pt-4">
            <form onSubmit={handleFilterSubmit} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Dari
                  </label>
                  <DatePicker
                    value={filters.dateFrom}
                    onChange={(value) => setFilters(prev => ({ ...prev, dateFrom: value }))}
                    placeholder="Pilih tanggal dari"
                    className="w-full"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Sampai
                  </label>
                  <DatePicker
                    value={filters.dateTo}
                    onChange={(value) => setFilters(prev => ({ ...prev, dateTo: value }))}
                    placeholder="Pilih tanggal sampai"
                    className="w-full"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Nama Verifikator
                  </label>
                  <input
                    type="text"
                    value={filters.verifier}
                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}
                    placeholder="Filter berdasarkan nama verifikator..."
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Nomor Simlok
                  </label>
                  <input
                    type="text"
                    value={filters.submissionId}
                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}
                    placeholder="Filter berdasarkan nomor simlok..."
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
              </div>

              <div className="flex items-center space-x-3">
                <Button type="submit" className="flex items-center space-x-2">
                  <MagnifyingGlassIcon className="h-4 w-4" />
                  <span>Terapkan Filter</span>
                </Button>
                
                <Button 
                  type="button"
                  variant="secondary"
                  onClick={resetFilters}
                >
                  Reset
                </Button>
              </div>
            </form>
          </div>
        )}
      </div>

      {/* Error Alert */}
      {error && (
        <Alert variant="error" title="Error" message={error} />
      )}

      {/* Scan History Table */}
      <div className="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-8">
            <div className="animate-pulse space-y-4">
              {[...Array(5)].map((_, i) => (
                <div key={i} className="flex items-center space-x-4">
                  <div className="w-12 h-12 bg-gray-200 rounded-lg"></div>
                  <div className="flex-1">
                    <div className="h-4 bg-gray-200 rounded w-1/4 mb-2"></div>
                    <div className="h-3 bg-gray-200 rounded w-1/2"></div>
                  </div>
                  <div className="w-20 h-8 bg-gray-200 rounded"></div>
                </div>
              ))}
            </div>
          </div>
        ) : scans.length === 0 ? (
          <div className="p-12 text-center">
            <QrCodeIcon className="h-16 w-16 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No scan history found</h3>
            <p className="text-gray-500">No QR code scans match your current filters.</p>
          </div>
        ) : (
          <>
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Pengajuan
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Verifikator
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Waktu Scan
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status
                    </th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Aksi
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {scans.map((scan) => (
                    <tr key={scan.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center">
                          <div className="p-2 bg-blue-100 rounded-lg mr-3">
                            <DocumentTextIcon className="h-5 w-5 text-blue-600" />
                          </div>
                          <div>
                            <div className="text-sm font-medium text-gray-900">
                              {scan.submission.simlok_number}
                            </div>
                            <div className="text-sm text-gray-500">
                              {scan.submission.vendor_name}
                            </div>
                            <div className="text-xs text-gray-400 truncate max-w-xs">
                              {scan.submission.job_description}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center">
                          <div className="p-1.5 bg-green-100 rounded-full mr-3">
                            <UserIcon className="h-4 w-4 text-green-600" />
                          </div>
                          <div>
                            <div className="text-sm font-medium text-gray-900">
                              {scan.user.full_name}
                            </div>
                            <div className="text-xs text-gray-500">
                              {scan.user.email}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center text-sm text-gray-900">
                          <ClockIcon className="h-4 w-4 text-gray-400 mr-2" />
                          <div>
                            <div className="font-medium">
                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}
                            </div>
                            <div className="text-xs text-gray-500">
                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}
                            </div>
                          </div>
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="space-y-1">
                          {getStatusBadge(scan.submission.review_status, 'review')}
                          {getStatusBadge(scan.submission.final_status, 'final')}
                        </div>
                      </td>
                      
                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <Button
                          onClick={() => setSelectedScan(scan)}
                          variant="secondary"
                          size="sm"
                          className="flex items-center space-x-1"
                        >
                          <EyeIcon className="h-4 w-4" />
                          <span>Detail</span>
                        </Button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Pagination */}
            {totalPages > 1 && (
              <div className="bg-white px-4 py-3 border-t border-gray-200 sm:px-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center">
                    <p className="text-sm text-gray-700">
                      Menampilkan halaman <span className="font-medium">{currentPage}</span> dari{' '}
                      <span className="font-medium">{totalPages}</span>
                    </p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Button
                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                      disabled={currentPage === 1}
                      variant="secondary"
                      size="sm"
                      className="flex items-center space-x-1"
                    >
                      <ChevronLeftIcon className="h-4 w-4" />
                      <span>Sebelumnya</span>
                    </Button>
                    
                    <Button
                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                      disabled={currentPage === totalPages}
                      variant="secondary"
                      size="sm"
                      className="flex items-center space-x-1"
                    >
                      <span>Selanjutnya</span>
                      <ChevronRightIcon className="h-4 w-4" />
                    </Button>
                  </div>
                </div>
              </div>
            )}
          </>
        )}
      </div>

      {/* Detail Modal */}
      {selectedScan && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold text-gray-900">Informasi Detail Scan</h3>
                <button
                  onClick={() => setSelectedScan(null)}
                  className="text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <span className="sr-only">Close</span>
                  ✕
                </button>
              </div>
            </div>
            
            <div className="p-6 space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Informasi Pengajuan</h4>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-500">Nomor Simlok:</span>
                      <span className="font-medium">{selectedScan.submission.simlok_number}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-500">Perusahaan:</span>
                      <span className="font-medium">{selectedScan.submission.vendor_name}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-500">Deskripsi Pekerjaan:</span>
                      <span className="font-medium">{selectedScan.submission.job_description}</span>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-4">
                  <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Informasi Verifikator</h4>
                  <div className="space-y-2 text-sm">
                     {selectedScan.scanner_name && (
                    <div className="flex justify-between">
                      <span className="text-gray-500">Scanner Name:</span>
                      <span className="font-medium">{selectedScan.scanner_name}</span>
                    </div>
                  )}
                  {selectedScan.scan_location && (
                    <div className="flex justify-between">
                      <span className="text-gray-500">Lokasi Scan:</span>
                      <span className="font-medium">{selectedScan.scan_location}</span>
                    </div>
                  )}
                    <div className="flex justify-between">
                      <span className="text-gray-500">Email:</span>
                      <span className="font-medium">{selectedScan.user.email}</span>
                    </div>
                    
                  </div>
                </div>
              </div>
              
              <div className="space-y-4">
                <h4 className="text-sm font-semibold text-gray-700 border-b pb-2">Detail Scan</h4>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  <div className="flex justify-between">
                    <span className="text-gray-500">Waktu Scan:</span>
                    <span className="font-medium">
                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}
                    </span>
                  </div>
                 
                </div>
              </div>
              
              {/* PDF Button */}
              <div className="flex justify-center pt-4 border-t border-gray-200">
                <Button
                  onClick={() => setShowPdfModal(true)}
                  className="bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2"
                >
                  <DocumentTextIcon className="w-5 h-5" />
                  <span>Lihat PDF SIMLOK</span>
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* SimlokPdfModal */}
      {selectedScan && (
        <SimlokPdfModal
          isOpen={showPdfModal}
          onClose={() => setShowPdfModal(false)}
          submissionId={selectedScan.submission.id}
          submissionName={selectedScan.submission.vendor_name}
          nomorSimlok={selectedScan.submission.simlok_number}
        />
      )}
    </div>
  );
}

=== FILE: src/components/reviewer/ReviewerSubmissionsManagement.tsx ===
'use client';

import React, { useState, useEffect, useCallback } from 'react';
import {
  MagnifyingGlassIcon,
  ChevronUpIcon,
  ChevronDownIcon,
  ChevronUpDownIcon,
  PencilIcon,
  UserIcon,
  ClipboardDocumentListIcon,
  ArrowDownTrayIcon,
} from "@heroicons/react/24/outline";

import Button from '@/components/ui/button/Button';
import { Badge } from '@/components/ui/Badge';
import Alert from '@/components/ui/alert/Alert';
import ReviewerSubmissionDetailModal from './ImprovedReviewerSubmissionDetailModal';
import ExportFilterModal, { ExportFilters } from './ExportFilterModal';
import { useSocket } from '@/components/common/RealtimeUpdates';

interface Submission {
  id: string; // Keep for internal operations
  approval_status: string;
  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';
  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  review_note?: string;
  final_note?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  reviewed_at?: string;
  approved_at?: string;
  signer_position?: string;
  signer_name?: string;
  scan_count: number;
  last_scanned_at?: string | null;
  user: {
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  reviewed_by_user?: {
    officer_name: string;
    email: string;
  };
  worker_list: Array<{
    worker_name: string;
    worker_photo: string | null;
  }>;
}

interface SubmissionsResponse {
  submissions: Submission[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    pages: number;
  };
}

export default function ReviewerSubmissionsManagement() {
  const [submissions, setSubmissions] = useState<Submission[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);
  const [showDetailModal, setShowDetailModal] = useState(false);
  const [exportLoading, setExportLoading] = useState(false);
  const [showExportModal, setShowExportModal] = useState(false);
  
  // Filters and pagination
  const [currentPage, setCurrentPage] = useState(1);
  const [searchTerm, setSearchTerm] = useState('');
  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');
  const [finalStatusFilter, setFinalStatusFilter] = useState<string>(''); // Default to show all statuses
  const [sortBy, setSortBy] = useState('created_at');
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');

  const [pagination, setPagination] = useState({
    page: 1,
    limit: 10,
    total: 0,
    pages: 0,
  });

  // Socket connection
  const socket = useSocket();

  const fetchSubmissions = useCallback(async () => {
    try {
      setLoading(true);
      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: '10',
        sortBy,
        sortOrder,
      });

      if (searchTerm) params.append('search', searchTerm);
      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);
      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);

      const response = await fetch(`/api/reviewer/simloks?${params}`);
      if (!response.ok) {
        throw new Error('Gagal mengambil data pengajuan');
      }

      const data: SubmissionsResponse = await response.json();
      setSubmissions(data.submissions);
      setPagination(data.pagination);
    } catch (err) {
      console.error('Error fetching submissions:', err);
      setError('Gagal memuat data pengajuan');
    } finally {
      setLoading(false);
    }
  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);

  useEffect(() => {
    fetchSubmissions();
  }, [fetchSubmissions]);

  // Socket listeners for real-time updates
  useEffect(() => {
    if (!socket) return;

    // Join reviewer room
    socket.emit('join', { role: 'REVIEWER' });

    const handleSubmissionUpdate = () => {
      console.log('Submission update received, refreshing reviewer submissions');
      fetchSubmissions();
    };

    socket.on('submission:created', handleSubmissionUpdate);
    socket.on('submission:reviewed', handleSubmissionUpdate);
    socket.on('submission:approved', handleSubmissionUpdate);
    socket.on('submission:rejected', handleSubmissionUpdate);

    return () => {
      socket.off('submission:created', handleSubmissionUpdate);
      socket.off('submission:reviewed', handleSubmissionUpdate);
      socket.off('submission:approved', handleSubmissionUpdate);
      socket.off('submission:rejected', handleSubmissionUpdate);
    };
  }, [socket, fetchSubmissions]);

  const handleSort = (field: string) => {
    if (sortBy === field) {
      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
    } else {
      setSortBy(field);
      setSortOrder('desc');
    }
    setCurrentPage(1);
  };

  const getSortIcon = (field: string) => {
    if (sortBy !== field) return <ChevronUpDownIcon className="h-4 w-4" />;
    return sortOrder === 'asc' 
      ? <ChevronUpIcon className="h-4 w-4" />
      : <ChevronDownIcon className="h-4 w-4" />;
  };

  const getReviewStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING_REVIEW':
        return <Badge variant="warning">Menunggu Review</Badge>;
      case 'MEETS_REQUIREMENTS':
        return <Badge variant="success">Memenuhi Syarat</Badge>;
      case 'NOT_MEETS_REQUIREMENTS':
        return <Badge variant="destructive">Tidak Memenuhi Syarat</Badge>;
      default:
        return <Badge variant="default">{status}</Badge>;
    }
  };

  const getFinalStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING_APPROVAL':
        return <Badge variant="warning">Menunggu Persetujuan</Badge>;
      case 'APPROVED':
        return <Badge variant="success">Disetujui</Badge>;
      case 'REJECTED':
        return <Badge variant="destructive">Ditolak</Badge>;
      default:
        return <Badge variant="default">{status}</Badge>;
    }
  };

  const handleViewDetails = (submission: Submission) => {
    setSelectedSubmission(submission);
    setShowDetailModal(true);
  };

  const handleExportToExcel = async (filters: ExportFilters) => {
    try {
      setExportLoading(true);
      
      // Build query parameters with filters from modal
      const params = new URLSearchParams();
      if (filters.search) params.append('search', filters.search);
      if (filters.reviewStatus) params.append('reviewStatus', filters.reviewStatus);
      if (filters.finalStatus) params.append('finalStatus', filters.finalStatus);
      if (filters.startDate) params.append('startDate', filters.startDate);
      if (filters.endDate) params.append('endDate', filters.endDate);

      const response = await fetch(`/api/reviewer/simloks/export?${params}`);
      
      if (!response.ok) {
        throw new Error('Gagal mengekspor data');
      }

      // Get the filename from response headers
      const contentDisposition = response.headers.get('Content-Disposition');
      let filename = 'Data_Pengajuan_SIMLOK.xlsx';
      if (contentDisposition) {
        const filenameMatch = contentDisposition.match(/filename="(.+)"/);
        if (filenameMatch && filenameMatch[1]) {
          filename = filenameMatch[1];
        }
      }

      // Create blob and download
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      window.URL.revokeObjectURL(url);

      // Close modal after successful export
      setShowExportModal(false);

    } catch (error) {
      console.error('Error exporting to Excel:', error);
      setError('Gagal mengekspor data ke Excel');
    } finally {
      setExportLoading(false);
    }
  };

  if (loading && submissions.length === 0) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header and Filters - Unified Design */}
      <div className="bg-white rounded-xl border shadow-sm p-6 space-y-4">
        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h1 className="text-xl md:text-2xl font-semibold text-gray-900">Review Pengajuan</h1>
            <p className="text-sm text-gray-500 mt-1">Kelola dan review pengajuan SIMLOK</p>
          </div>
          <div className="flex gap-2">
            <Button
              onClick={() => setShowExportModal(true)}
              disabled={exportLoading}
              variant="outline"
              size="sm"
              className="text-green-600 border-green-600 hover:bg-green-50"
            >
              <ArrowDownTrayIcon className="h-4 w-4 mr-2" />
              Export Excel
            </Button>
          </div>
        </div>

        {/* Toolbar - Search and Filters */}
        <div className="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
          <div className="relative w-full md:w-80">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
            </div>
            <input
              type="text"
              placeholder="Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas..."
              value={searchTerm}
              onChange={(e) => {
                setSearchTerm(e.target.value);
                setCurrentPage(1);
              }}
              className="pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            />
          </div>
          <div className="flex gap-2 md:w-auto">
            <select
              value={reviewStatusFilter}
              onChange={(e) => {
                setReviewStatusFilter(e.target.value);
                setCurrentPage(1);
              }}
              className="px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm"
            >
              <option value="">Semua Status Review</option>
              <option value="PENDING_REVIEW">Menunggu Review</option>
              <option value="MEETS_REQUIREMENTS">Memenuhi Syarat</option>
              <option value="NOT_MEETS_REQUIREMENTS">Tidak Memenuhi Syarat</option>
            </select>
            <select
              value={finalStatusFilter}
              onChange={(e) => {
                setFinalStatusFilter(e.target.value);
                setCurrentPage(1);
              }}
              className="px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm"
            >
              <option value="">Semua Status Akhir</option>
              <option value="PENDING_APPROVAL">Menunggu Persetujuan</option>
              <option value="APPROVED">Disetujui</option>
              <option value="REJECTED">Ditolak</option>
            </select>
          </div>
        </div>
      </div>

      {error && (
        <Alert variant="error" title="Error" message={error} />
      )}

      {/* Submissions Table - Unified Design */}
      <div className="bg-white rounded-xl border shadow-sm overflow-hidden">
        {submissions.length === 0 ? (
          <div className="text-center py-16">
            <ClipboardDocumentListIcon className="mx-auto h-16 w-16 text-gray-400 mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">Tidak ada pengajuan</h3>
            <p className="text-gray-500 max-w-md mx-auto">
              {searchTerm || reviewStatusFilter || finalStatusFilter 
                ? 'Tidak ada pengajuan yang sesuai dengan filter yang dipilih.'
                : 'Belum ada pengajuan yang tersedia untuk di-review.'
              }
            </p>
          </div>
        ) : (
          <>
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th 
                      className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                      onClick={() => handleSort('created_at')}
                    >
                      <div className="flex items-center space-x-1">
                        <span>Tanggal</span>
                        {getSortIcon('created_at')}
                      </div>
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Vendor & Penanggung Jawab
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Pekerjaan & Lokasi
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status Review
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status Final
                    </th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Status Scan
                    </th>
                    <th className="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Aksi
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {submissions.map((submission, index) => (
                    <tr key={`submission-${index}-${submission.created_at}`} className="hover:bg-gray-50 transition-colors">
                      <td className="px-4 py-3 whitespace-nowrap">
                        <div className="text-sm font-medium text-gray-900">
                          {new Date(submission.created_at).toLocaleDateString('id-ID', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric'
                          })}
                        </div>
                        <div className="text-xs text-gray-500">
                          {new Date(submission.created_at).toLocaleTimeString('id-ID', {
                            hour: '2-digit',
                            minute: '2-digit'
                          })}
                        </div>
                      </td>
                      <td className="px-4 py-3">
                        <div className="max-w-48">
                          <div className="font-medium text-sm text-gray-900 truncate" title={submission.vendor_name}>
                            {submission.vendor_name}
                          </div>
                          <div className="flex items-center space-x-1 text-xs text-gray-500 mt-1">
                            <UserIcon className="h-3 w-3 flex-shrink-0" />
                            <span className="truncate" title={submission.officer_name}>{submission.officer_name}</span>
                          </div>
                        </div>
                      </td>
                      <td className="px-4 py-3">
                        <div className="max-w-64">
                          <div className="text-sm text-gray-900 font-medium truncate" title={submission.job_description}>
                            {submission.job_description}
                          </div>
                          <div className="text-xs text-gray-500 mt-1 truncate" title={submission.work_location}>
                             {submission.work_location}
                          </div>
                        </div>
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {getReviewStatusBadge(submission.review_status)}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {getFinalStatusBadge(submission.final_status)}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {submission.final_status === 'APPROVED' ? (
                          <div className="text-sm">
                            {submission.scan_count > 0 ? (
                              <div>
                                <Badge variant="success">
                                  Sudah discan ({submission.scan_count}x)
                                </Badge>
                                {submission.last_scanned_at && (
                                  <div className="text-xs text-gray-500 mt-1">
                                    Terakhir: {new Date(submission.last_scanned_at).toLocaleDateString('id-ID', {
                                      day: '2-digit',
                                      month: 'short',
                                      hour: '2-digit',
                                      minute: '2-digit'
                                    })}
                                  </div>
                                )}
                              </div>
                            ) : (
                              <Badge variant="warning">Belum discan</Badge>
                            )}
                          </div>
                        ) : (
                          <span className="text-xs text-gray-400">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap text-center">
                        <Button
                          onClick={() => handleViewDetails(submission)}
                          size="sm"
                          variant="outline"
                          className="text-blue-600 border-blue-600 hover:bg-blue-50"
                        >
                          <PencilIcon className="h-4 w-4 mr-1" />
                          {submission.final_status === 'PENDING_APPROVAL' ? 'Review' : 'Lihat'}
                        </Button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Pagination */}
            {pagination.pages > 1 && (
              <div className="px-4 py-3 border-t border-gray-200 bg-gray-50">
                <div className="flex items-center justify-between">
                  <div className="text-sm text-gray-700">
                    Menampilkan {((currentPage - 1) * pagination.limit) + 1} sampai{' '}
                    {Math.min(currentPage * pagination.limit, pagination.total)} dari{' '}
                    {pagination.total} pengajuan
                  </div>
                  <div className="flex space-x-1">
                    <Button
                      onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
                      disabled={currentPage === 1}
                      variant="outline"
                      size="sm"
                    >
                      Sebelumnya
                    </Button>
                    {Array.from({ length: pagination.pages }, (_, i) => i + 1)
                      .filter(page => {
                        const distance = Math.abs(page - currentPage);
                        return distance === 0 || distance === 1 || page === 1 || page === pagination.pages;
                      })
                      .map((page, index, array) => (
                        <React.Fragment key={page}>
                          {index > 0 && array[index - 1] !== page - 1 && (
                            <span className="px-3 py-1 text-gray-500">...</span>
                          )}
                          <Button
                            onClick={() => setCurrentPage(page)}
                            variant={currentPage === page ? "primary" : "outline"}
                            size="sm"
                            className={currentPage === page ? "bg-blue-600 text-white" : ""}
                          >
                            {page}
                          </Button>
                        </React.Fragment>
                      ))}
                    <Button
                      onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}
                      disabled={currentPage === pagination.pages}
                      variant="outline"
                      size="sm"
                    >
                      Selanjutnya
                    </Button>
                  </div>
                </div>
              </div>
            )}
          </>
        )}
      </div>

      {/* Export Filter Modal */}
      <ExportFilterModal
        isOpen={showExportModal}
        onClose={() => setShowExportModal(false)}
        onExport={handleExportToExcel}
        currentFilters={{
          search: searchTerm,
          reviewStatus: reviewStatusFilter,
          finalStatus: finalStatusFilter,
          startDate: '',
          endDate: ''
        }}
        exportLoading={exportLoading}
      />

      {/* Detail Modal */}
      {showDetailModal && selectedSubmission && (
        <ReviewerSubmissionDetailModal
          key={selectedSubmission.id}
          isOpen={showDetailModal}
          onClose={() => {
            setShowDetailModal(false);
            setSelectedSubmission(null);
          }}
          submissionId={selectedSubmission.id}
          onReviewSubmitted={() => {
            fetchSubmissions();
          }}
        />
      )}
    </div>
  );
}

=== FILE: src/components/reviewer/ReviewerUserVerificationModal.tsx ===
'use client';

import React, { useState } from 'react';
import Button from '@/components/ui/button/Button';
import Card from '@/components/ui/Card';
import { UserData } from '@/types/user';
import { useToast } from '@/hooks/useToast';
import { 
  XMarkIcon, 
  CheckCircleIcon, 
  XCircleIcon,
  ExclamationTriangleIcon,
  UserIcon,
  EnvelopeIcon,
  BuildingOfficeIcon,
  PhoneIcon,
  MapPinIcon,
  ClockIcon,
  ShieldCheckIcon,
  IdentificationIcon
} from '@heroicons/react/24/outline';

interface ReviewerUserVerificationModalProps {
  user: UserData | null;
  isOpen: boolean;
  onClose: () => void;
  onUserUpdate?: (updatedUser: UserData) => void;
}

export default function ReviewerUserVerificationModal({
  user,
  isOpen,
  onClose,
  onUserUpdate
}: ReviewerUserVerificationModalProps) {
  const [processing, setProcessing] = useState<string | null>(null);
  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);
  const [currentUser, setCurrentUser] = useState<UserData | null>(user);
  const { showSuccess, showError } = useToast();

  // Update local user state when prop changes
  React.useEffect(() => {
    setCurrentUser(user);
  }, [user]);

  if (!isOpen || !currentUser) return null;

  const formatDate = (dateString: string | Date | null | undefined) => {
    if (!dateString) return 'N/A';
    
    try {
      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;
      if (isNaN(date.getTime())) return 'N/A';
      
      return date.toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch (error) {
      console.error('Error formatting date:', error);
      return 'N/A';
    }
  };

  const handleVerifyUser = async (action: 'approve' | 'reject') => {
    if (!currentUser) return;
    
    setProcessing(currentUser.id);
    
    try {
      const response = await fetch(`/api/reviewer/users/${currentUser.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          status: action === 'approve' ? 'VERIFY' : 'REJECT'
        })
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to update user verification');
      }

      const result = await response.json();
      
      if (action === 'approve' && result.user) {
        // Update local state immediately
        setCurrentUser(result.user);
        onUserUpdate?.(result.user);
        showSuccess('Berhasil', 'User berhasil diverifikasi');
      } else if (action === 'reject' && result.user) {
        // Update local state for rejection
        setCurrentUser(result.user);
        onUserUpdate?.(result.user);
        showSuccess('Berhasil', 'User berhasil ditolak');
      }

      setShowConfirmModal(null);
      
    } catch (error) {
      console.error('Error updating user verification:', error);
      showError('Error', error instanceof Error ? error.message : 'Failed to update user verification');
    } finally {
      setProcessing(null);
    }
  };

  const handleModalClose = () => {
    setShowConfirmModal(null);
    onClose();
  };

  const isVerified = currentUser.verification_status === 'VERIFIED';
  const isRejected = currentUser.verification_status === 'REJECTED';
  const isPending = currentUser.verification_status === 'PENDING' || !currentUser.verification_status;

  return (
    <>
      <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div className="max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden">
          <Card className="shadow-2xl">
            {/* Header */}
            <div className="flex items-center justify-between p-6 border-b border-gray-200">
              <div className="flex items-center">
                <div className="w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4">
                  <UserIcon className="w-6 h-6 text-brand-600" />
                </div>
                <div>
                  <h2 className="text-xl font-semibold text-gray-900">
                    Detail User
                  </h2>
                  <p className="text-sm text-gray-500">
                    Informasi lengkap dan status verifikasi
                  </p>
                </div>
              </div>
              <Button
                onClick={handleModalClose}
                variant="ghost"
                size="sm"
                className="p-2"
              >
                <XMarkIcon className="w-5 h-5 text-gray-500" />
              </Button>
            </div>

            {/* Content */}
            <div className="p-6 max-h-[calc(90vh-200px)] overflow-y-auto">
              <div className="space-y-8">
                {/* Status Section */}
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${
                      isVerified 
                        ? 'bg-green-100 text-green-800' 
                        : isRejected
                        ? 'bg-red-100 text-red-800'
                        : 'bg-warning-100 text-warning-800'
                    }`}>
                      {isVerified ? (
                        <CheckCircleIcon className="w-4 h-4" />
                      ) : isRejected ? (
                        <XCircleIcon className="w-4 h-4" />
                      ) : (
                        <ClockIcon className="w-4 h-4" />
                      )}
                      {isVerified ? 'Terverifikasi' : isRejected ? 'Ditolak' : 'Menunggu Verifikasi'}
                    </div>
                    <div className={`px-3 py-1 rounded-full text-sm font-medium ${
                      currentUser.role === 'VENDOR' 
                        ? 'bg-blue-100 text-blue-800' 
                        : currentUser.role === 'VERIFIER'
                        ? 'bg-purple-100 text-purple-800'
                        : 'bg-gray-100 text-gray-800'
                    }`}>
                      <IdentificationIcon className="w-4 h-4 inline mr-1" />
                      {currentUser.role}
                    </div>
                  </div>
                </div>

                {/* User Info Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  {/* Personal Information */}
                  <Card className="bg-gray-50">
                    <div className="p-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                        <UserIcon className="w-5 h-5 mr-2 text-gray-500" />
                        Informasi Personal
                      </h3>
                      
                      <div className="space-y-4">
                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <UserIcon className="w-5 h-5 text-blue-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Nama Petugas</p>
                            <p className="text-base font-medium text-gray-900 break-words">
                              {currentUser.officer_name}
                            </p>
                          </div>
                        </div>

                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <EnvelopeIcon className="w-5 h-5 text-green-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Email</p>
                            <p className="text-base font-medium text-gray-900 break-words">
                              {currentUser.email}
                            </p>
                          </div>
                        </div>

                        {currentUser.phone_number && (
                          <div className="flex items-start">
                            <div className="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                              <PhoneIcon className="w-5 h-5 text-orange-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                              <p className="text-sm font-medium text-gray-500">No. Telepon</p>
                              <p className="text-base font-medium text-gray-900">
                                {currentUser.phone_number}
                              </p>
                            </div>
                          </div>
                        )}

                        {currentUser.address && (
                          <div className="flex items-start">
                            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                              <MapPinIcon className="w-5 h-5 text-purple-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                              <p className="text-sm font-medium text-gray-500">Alamat</p>
                              <p className="text-base font-medium text-gray-900 break-words">
                                {currentUser.address}
                              </p>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </Card>

                  {/* System Information */}
                  <Card className="bg-gray-50">
                    <div className="p-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                        <ShieldCheckIcon className="w-5 h-5 mr-2 text-gray-500" />
                        Informasi Sistem
                      </h3>

                      <div className="space-y-4">
                        {currentUser.vendor_name && (
                          <div className="flex items-start">
                            <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                              <BuildingOfficeIcon className="w-5 h-5 text-indigo-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                              <p className="text-sm font-medium text-gray-500">Nama Vendor</p>
                              <p className="text-base font-medium text-gray-900 break-words">
                                {currentUser.vendor_name}
                              </p>
                            </div>
                          </div>
                        )}

                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <ClockIcon className="w-5 h-5 text-gray-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Tanggal Daftar</p>
                            <p className="text-base font-medium text-gray-900">
                              {formatDate(currentUser.created_at)}
                            </p>
                          </div>
                        </div>

                        {isVerified && currentUser.verified_at && (
                          <div className="flex items-start">
                            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                              <ShieldCheckIcon className="w-5 h-5 text-green-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                              <p className="text-sm font-medium text-gray-500">Diverifikasi Pada</p>
                              <p className="text-base font-medium text-gray-900">
                                {formatDate(currentUser.verified_at)}
                              </p>
                              {currentUser.verified_by && (
                                <p className="text-sm text-gray-600 mt-1">
                                  
                                </p>
                              )}
                            </div>
                          </div>
                        )}

                        {isRejected && currentUser.rejected_at && (
                          <div className="flex items-start">
                            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                              <XCircleIcon className="w-5 h-5 text-red-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                              <p className="text-sm font-medium text-gray-500">Ditolak Pada</p>
                              <p className="text-base font-medium text-gray-900">
                                {formatDate(currentUser.rejected_at)}
                              </p>
                              
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </Card>
                </div>

                {/* Actions for Pending Users */}
                {isPending && (
                  <Card className="bg-gradient-to-r from-blue-50 to-indigo-50">
                    <div className="p-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <CheckCircleIcon className="w-5 h-5 mr-2 text-blue-600" />
                        Tindakan Verifikasi
                      </h3>
                      <p className="text-sm text-gray-600 mb-4">
                        Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, 
                        sedangkan penolakan akan mengubah status user menjadi ditolak.
                      </p>

                      <div className="flex flex-col sm:flex-row gap-4">
                        <Button
                          onClick={() => setShowConfirmModal('approve')}
                          disabled={processing === currentUser.id}
                          variant="primary"
                          size="md"
                          className="flex-1"
                        >
                          <CheckCircleIcon className="w-5 h-5 mr-2" />
                          Setujui User
                        </Button>
                        <Button
                          onClick={() => setShowConfirmModal('reject')}
                          disabled={processing === currentUser.id}
                          variant="destructive"
                          size="md"
                          className="flex-1"
                        >
                          <XCircleIcon className="w-5 h-5 mr-2" />
                          Tolak User
                        </Button>
                      </div>
                    </div>
                  </Card>
                )}

                {/* Verification Status Info */}
                {isVerified && (
                  <Card className="bg-gradient-to-r from-green-50 to-emerald-50">
                    <div className="p-6">
                      <div className="flex items-start">
                        <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                          <CheckCircleIcon className="w-6 h-6 text-green-600" />
                        </div>
                        <div>
                          <h4 className="text-lg font-semibold text-green-900 mb-2">
                            User Sudah Terverifikasi
                          </h4>
                          <p className="text-green-700">
                            User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan 
                            memiliki akses penuh ke fitur yang tersedia.
                          </p>
                        </div>
                      </div>
                    </div>
                  </Card>
                )}

                {/* Rejection Status Info */}
                {isRejected && (
                  <Card className="bg-gradient-to-r from-red-50 to-pink-50">
                    <div className="p-6">
                      <div className="flex items-start">
                        <div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                          <XCircleIcon className="w-6 h-6 text-red-600" />
                        </div>
                        <div>
                          <h4 className="text-lg font-semibold text-red-900 mb-2">
                            User Telah Ditolak
                          </h4>
                          <p className="text-red-700">
                            User ini telah ditolak dan tidak dapat mengakses sistem. User tidak dapat login dan 
                            perlu menghubungi administrator untuk informasi lebih lanjut.
                          </p>
                        </div>
                      </div>
                    </div>
                  </Card>
                )}
              </div>
            </div>

            {/* Footer */}
            <div className="flex justify-end p-6 border-t border-gray-200">
              <Button onClick={handleModalClose} variant="outline" size="md">
                Tutup
              </Button>
            </div>
          </Card>
        </div>
      </div>

      {/* Confirmation Modal */}
      {showConfirmModal && currentUser && (
        <ConfirmationModal
          isOpen={!!showConfirmModal}
          onClose={() => setShowConfirmModal(null)}
          user={currentUser}
          action={showConfirmModal}
          isProcessing={processing === currentUser.id}
          onConfirm={() => handleVerifyUser(showConfirmModal)}
        />
      )}
    </>
  );
}

// Modal Konfirmasi
interface ConfirmationModalProps {
  isOpen: boolean;
  onClose: () => void;
  user: UserData;
  action: 'approve' | 'reject';
  isProcessing: boolean;
  onConfirm: () => void;
}

function ConfirmationModal({ isOpen, onClose, user, action, isProcessing, onConfirm }: ConfirmationModalProps) {
  if (!isOpen) return null;

  const isApprove = action === 'approve';

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[60]">
      <Card className="max-w-md w-full mx-4">
        <div className="p-6">
          <div className="flex items-center mb-4">
            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
              isApprove ? 'bg-green-100' : 'bg-red-100'
            }`}>
              {isApprove ? (
                <CheckCircleIcon className="w-6 h-6 text-green-600" />
              ) : (
                <XCircleIcon className="w-6 h-6 text-red-600" />
              )}
            </div>
            <div className="ml-4">
              <h3 className="text-lg font-semibold text-gray-900">
                Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}
              </h3>
            </div>
          </div>

          <p className="text-gray-600 mb-6">
            Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}
            <strong className="text-gray-900">{user.officer_name}</strong>?
          </p>

          {!isApprove && (
            <div className="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
              <div className="flex items-start">
                <ExclamationTriangleIcon className="w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0" />
                <div className="text-sm">
                  <p className="font-medium text-red-800 mb-1">Peringatan!</p>
                  <p className="text-red-700">
                    Status user akan diubah menjadi ditolak dan tidak dapat login lagi.
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="flex justify-end space-x-3">
            <Button
              onClick={onClose}
              variant="outline"
              size="sm"
              disabled={isProcessing}
            >
              Batal
            </Button>
            <Button
              onClick={onConfirm}
              disabled={isProcessing}
              variant={isApprove ? "primary" : "destructive"}
              size="sm"
            >
              {isProcessing ? (
                <span className="flex items-center">
                  <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                  Memproses...
                </span>
              ) : (
                `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`
              )}
            </Button>
          </div>
        </div>
      </Card>
    </div>
  );
}

=== FILE: src/components/reviewer/UserVerificationManagement.tsx ===
'use client';

import React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';
import Button from '@/components/ui/button/Button';
import Card from '@/components/ui/Card';
import { useToast } from '@/hooks/useToast';
import { 
  MagnifyingGlassIcon,
  ChevronUpIcon,
  ChevronDownIcon,
  ChevronUpDownIcon,
  XMarkIcon, 
  CheckCircleIcon, 
  XCircleIcon,
  ExclamationTriangleIcon,
  UserIcon,
  EnvelopeIcon,
  BuildingOfficeIcon,
  PhoneIcon,
  MapPinIcon,
  ClockIcon,
  ShieldCheckIcon,
  IdentificationIcon
} from '@heroicons/react/24/outline';

interface User {
  id: string;
  email: string;
  officer_name: string;
  vendor_name: string;
  address?: string;
  phone_number?: string;
  profile_photo?: string;
  created_at: string;
  verified_at?: string;
  verified_by?: string;
  verification_status?: 'PENDING' | 'VERIFIED' | 'REJECTED';
  rejected_at?: string;
  rejected_by?: string;
  rejection_reason?: string;
  role: string;
}

interface Stats {
  totalPending: number;
  totalVerified: number;
  totalRejected: number;
  totalUsers: number;
  todayRegistrations: number;
}

interface UserVerificationManagementProps {
  className?: string;
  refreshTrigger?: number;
}

type SortField = keyof User;
type SortOrder = "asc" | "desc";

// Custom hook untuk debounced value
function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

export default function UserVerificationManagement({ className = '', refreshTrigger = 0 }: UserVerificationManagementProps) {
  const { showSuccess, showError } = useToast();
  const [users, setUsers] = useState<User[]>([]);
  const [stats, setStats] = useState<Stats>({
    totalPending: 0,
    totalVerified: 0,
    totalRejected: 0,
    totalUsers: 0,
    todayRegistrations: 0
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [processing, setProcessing] = useState<string | null>(null);
  
  // Pagination
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [totalUsers, setTotalUsers] = useState(0);
  const [limit] = useState(10);
  
  // Search & Filter
  const [searchTerm, setSearchTerm] = useState("");
  const [statusFilter, setStatusFilter] = useState<"all" | "pending" | "verified" | "rejected">("all");
  
  // Sorting
  const [sortField, setSortField] = useState<SortField>("created_at");
  const [sortOrder, setSortOrder] = useState<SortOrder>("desc");

  // Modal states
  const [selectedUser, setSelectedUser] = useState<User | null>(null);
  const [showVerificationModal, setShowVerificationModal] = useState(false);
  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);
  const [verificationNote, setVerificationNote] = useState('');

  // Ref untuk search input
  const searchInputRef = useRef<HTMLInputElement>(null);
  const [isInputFocused, setIsInputFocused] = useState(false);

  // Debounced search term
  const debouncedSearchTerm = useDebounce(searchTerm, 500);

  // Socket.IO has been replaced with Server-Sent Events

  const fetchUsers = useCallback(async () => {
    try {
      setLoading(true);
      setError("");
      
      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: limit.toString(),
        sortBy: sortField,
        sortOrder: sortOrder,
      });

      if (debouncedSearchTerm) {
        params.append("search", debouncedSearchTerm);
      }
      
      if (statusFilter !== "all") {
        params.append("status", statusFilter);
      }

      const response = await fetch(`/api/reviewer/users?${params.toString()}`);
      
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "Gagal mengambil data user");
      }

      const data = await response.json();
      setUsers(data.users);
      setStats(data.stats);
      setTotalPages(data.pagination.totalPages);
      setTotalUsers(data.pagination.total || 0);
    } catch (err) {
      setError(err instanceof Error ? err.message : "Terjadi kesalahan");
      console.error('Error fetching users:', err);
    } finally {
      setLoading(false);
    }
  }, [currentPage, debouncedSearchTerm, statusFilter, sortField, sortOrder, limit]);

  useEffect(() => {
    fetchUsers();
  }, [fetchUsers, refreshTrigger]);

  // Socket.IO functionality removed - using Server-Sent Events instead

  // Reset ke halaman 1 saat search term berubah
  useEffect(() => {
    setCurrentPage(1);
  }, [debouncedSearchTerm, statusFilter, sortField, sortOrder]);

  // Kembalikan fokus ke search input setelah data reload
  useEffect(() => {
    if (!loading && isInputFocused && searchInputRef.current) {
      searchInputRef.current.focus();
    }
  }, [loading, isInputFocused]);

  const handleSort = useCallback((field: SortField) => {
    if (sortField === field) {
      setSortOrder(sortOrder === "asc" ? "desc" : "asc");
    } else {
      setSortField(field);
      setSortOrder("asc");
    }
  }, [sortField, sortOrder]);

  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchTerm(e.target.value);
    setIsInputFocused(true);
  }, []);

  const resetFilters = useCallback(() => {
    setSearchTerm("");
    setStatusFilter("all");
    setCurrentPage(1);
    setSortField("created_at");
    setSortOrder("desc");
  }, []);

  const getSortIcon = useCallback((field: SortField) => {
    if (sortField !== field) {
      return <ChevronUpDownIcon className="w-4 h-4 text-gray-400" />;
    }
    return sortOrder === "asc" 
      ? <ChevronUpIcon className="w-4 h-4 text-blue-500" />
      : <ChevronDownIcon className="w-4 h-4 text-blue-500" />;
  }, [sortField, sortOrder]);

  const formatDate = useCallback((dateString: string | Date | null | undefined) => {
    if (!dateString) return 'N/A';
    
    try {
      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;
      if (isNaN(date.getTime())) return 'N/A';
      
      return date.toLocaleDateString("id-ID", {
        year: "numeric",
        month: "short", 
        day: "numeric"
      });
    } catch (error) {
      console.error('Error formatting date:', error);
      return 'N/A';
    }
  }, []);



  const getRoleBadge = useCallback((role: string) => {
    const colors: Record<string, string> = {
      VENDOR: "bg-green-100 text-green-800",
      VERIFIER: "bg-blue-100 text-blue-800",
      REVIEWER: "bg-yellow-100 text-yellow-800",
      APPROVER: "bg-orange-100 text-orange-800",
      ADMIN: "bg-purple-100 text-purple-800",
      SUPER_ADMIN: "bg-red-100 text-red-800"
    };
    
    return (
      <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[role] || 'bg-gray-100 text-gray-800'}`}>
        {role}
      </span>
    );
  }, []);

  const getVerificationStatus = useCallback((user: User) => {
    switch (user.verification_status) {
      case 'VERIFIED':
        return (
          <span className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
            Terverifikasi
          </span>
        );
      case 'REJECTED':
        return (
          <span className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
            Ditolak
          </span>
        );
      case 'PENDING':
      default:
        return (
          <span className="px-2 py-1 text-xs font-medium rounded-full bg-warning-100 text-warning-800">
            Menunggu Verifikasi
          </span>
        );
    }
  }, []);

  const paginationInfo = useMemo(() => ({
    currentPage,
    totalPages,
    totalUsers,
    limit,
    startItem: ((currentPage - 1) * limit) + 1,
    endItem: Math.min(currentPage * limit, totalUsers)
  }), [currentPage, totalPages, totalUsers, limit]);

  const handleVerifyUser = async (action: 'approve' | 'reject') => {
    if (!selectedUser) return;
    
    setProcessing(selectedUser.id);
    
    try {
      const response = await fetch(`/api/reviewer/users/${selectedUser.id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          status: action === 'approve' ? 'VERIFY' : 'REJECT',
          note: verificationNote.trim() || undefined
        })
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to update user verification');
      }

      await fetchUsers();
      setShowConfirmModal(null);
      setShowVerificationModal(false);
      setSelectedUser(null);
      setVerificationNote('');
      
      showSuccess('Berhasil', action === 'approve' ? 'User berhasil diverifikasi' : 'User berhasil ditolak');
      
    } catch (error) {
      console.error('Error updating user verification:', error);
      showError('Error', error instanceof Error ? error.message : 'Failed to update user verification');
    } finally {
      setProcessing(null);
    }
  };

  const handleViewUser = (user: User) => {
    setSelectedUser(user);
    setVerificationNote('');
    setShowVerificationModal(true);
  };

  const handleModalClose = () => {
    setShowVerificationModal(false);
    setShowConfirmModal(null);
    setSelectedUser(null);
    setVerificationNote('');
  };

  // Memoize tabel content untuk hanya reload bagian ini
  const tableContent = useMemo(() => {
    if (error) {
      return (
        <div className="text-center py-12">
          <div className="bg-red-50 border border-red-200 rounded-md p-4">
            <div className="text-red-800">{error}</div>
            <Button 
              onClick={fetchUsers}
              variant="destructive"
              size="sm"
              className="mt-2"
            >
              Coba Lagi
            </Button>
          </div>
        </div>
      );
    }

    if (users.length === 0 && !loading) {
      return (
        <div className="text-center py-12">
          <div className="text-gray-500">Tidak ada user yang ditemukan</div>
        </div>
      );
    }

    return (
      <div className="bg-white shadow rounded-lg overflow-hidden">
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th 
                  onClick={() => handleSort("officer_name")}
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none"
                >
                  <div className="flex items-center space-x-1">
                    <span>Nama Petugas</span>
                    {getSortIcon("officer_name")}
                  </div>
                </th>
                <th 
                  onClick={() => handleSort("email")}
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none"
                >
                  <div className="flex items-center space-x-1">
                    <span>Email</span>
                    {getSortIcon("email")}
                  </div>
                </th>
                <th 
                  onClick={() => handleSort("role")}
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none"
                >
                  <div className="flex items-center space-x-1">
                    <span>Role</span>
                    {getSortIcon("role")}
                  </div>
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Vendor/Kontak
                </th>
                <th 
                  onClick={() => handleSort("created_at")}
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none"
                >
                  <div className="flex items-center space-x-1">
                    <span>Tgl Dibuat</span>
                    {getSortIcon("created_at")}
                  </div>
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Aksi
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {users.map((user) => (
                <tr key={user.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm font-medium text-gray-900">{user.officer_name}</div>
                    {user.address && (
                      <div className="text-sm text-gray-500 truncate max-w-xs">{user.address}</div>
                    )}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm text-gray-900">{user.email}</div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    {getRoleBadge(user.role)}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm text-gray-900">
                      {user.vendor_name || "-"}
                    </div>
                    {user.phone_number && (
                      <div className="text-sm text-gray-500">{user.phone_number}</div>
                    )}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm text-gray-900">{formatDate(user.created_at)}</div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    {getVerificationStatus(user)}
                    
                    {user.verification_status === 'REJECTED' && user.rejected_by && (
                      <div className="text-xs text-gray-500 mt-1">
                      </div>
                    )}
                    
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <div className="flex items-center justify-end space-x-2">
                      <Button
                        onClick={() => handleViewUser(user)}
                        variant="info"
                        size="sm"
                        className="px-3 py-1.5"
                      >
                        Lihat
                      </Button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        
        {loading && (
          <div className="flex justify-center items-center h-32">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
          </div>
        )}
      </div>
    );
  }, [users, loading, error, handleSort, getSortIcon, formatDate, getRoleBadge, getVerificationStatus, handleViewUser, fetchUsers]);

  if (loading && users.length === 0) {
    return (
      <div className={`space-y-6 ${className}`}>
        <div className="animate-pulse">
          <div className="h-4 bg-gray-200 rounded w-1/4 mb-4"></div>
          <div className="space-y-3">
            {[...Array(5)].map((_, i) => (
              <div key={i} className="h-16 bg-gray-200 rounded"></div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className={`space-y-6 ${className}`}>
      {/* Statistics Cards - Dashboard Design */}
      <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Menunggu Verifikasi</h3>
              <p className="text-2xl font-bold text-amber-600 mt-1">{stats.totalPending}</p>
            </div>
            <div className="p-3 bg-amber-100 rounded-full">
              <ClockIcon className="w-6 h-6 text-amber-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Terverifikasi</h3>
              <p className="text-2xl font-bold text-green-600 mt-1">{stats.totalVerified}</p>
            </div>
            <div className="p-3 bg-green-100 rounded-full">
              <CheckCircleIcon className="w-6 h-6 text-green-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Ditolak</h3>
              <p className="text-2xl font-bold text-red-600 mt-1">{stats.totalRejected}</p>
            </div>
            <div className="p-3 bg-red-100 rounded-full">
              <XCircleIcon className="w-6 h-6 text-red-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Total User</h3>
              <p className="text-2xl font-bold text-blue-600 mt-1">{stats.totalUsers}</p>
            </div>
            <div className="p-3 bg-blue-100 rounded-full">
              <UserIcon className="w-6 h-6 text-blue-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Registrasi Hari Ini</h3>
              <p className="text-2xl font-bold text-purple-600 mt-1">{stats.todayRegistrations}</p>
            </div>
            <div className="p-3 bg-purple-100 rounded-full">
              <UserIcon className="w-6 h-6 text-purple-600" />
            </div>
          </div>
        </div>
      </div>

      {/* Search dan Filter */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="relative flex-1">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            ref={searchInputRef}
            type="text"
            placeholder="Cari nama, email, vendor, atau nomor telepon..."
            value={searchTerm}
            onChange={handleSearchChange}
            onBlur={() => setIsInputFocused(false)}
            onFocus={() => setIsInputFocused(true)}
            className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        <select
          value={statusFilter}
          onChange={(e) => {
            const newValue = e.target.value as "all" | "pending" | "verified" | "rejected";
            setStatusFilter(newValue);
            setCurrentPage(1);
          }}
          className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="all">Semua Status</option>
          <option value="pending">Belum Verifikasi</option>
          <option value="verified">Sudah Verifikasi</option>
          <option value="rejected">Ditolak</option>
        </select>
        
        <Button
          onClick={resetFilters}
          variant="outline"
          size="sm"
          className="px-3 py-2"
        >
          Reset Filter
        </Button>
      </div>

      {/* Tabel dengan loading overlay */}
      <div className="relative">
        {tableContent}
      </div>

      {/* Pagination */}
      {totalPages > 1 && (
        <div className="flex items-center justify-between">
          <div className="text-sm text-gray-700">
            Menampilkan {paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.totalUsers} user
          </div>
          
          <div className="flex items-center space-x-2">
            <button
              onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
              disabled={currentPage === 1}
              className="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Sebelumnya
            </button>
            
            <div className="flex items-center space-x-1">
              {[...Array(totalPages)].map((_, index) => {
                const page = index + 1;
                if (
                  page === 1 ||
                  page === totalPages ||
                  (page >= currentPage - 1 && page <= currentPage + 1)
                ) {
                  return (
                    <button
                      key={page}
                      onClick={() => setCurrentPage(page)}
                      className={`px-3 py-2 border text-sm font-medium rounded-md ${
                        currentPage === page
                          ? "bg-blue-500 border-blue-500 text-white"
                          : "border-gray-300 text-gray-700 bg-white hover:bg-gray-50"
                      }`}
                    >
                      {page}
                    </button>
                  );
                } else if (
                  page === currentPage - 2 ||
                  page === currentPage + 2
                ) {
                  return <span key={page} className="text-gray-500">...</span>;
                }
                return null;
              })}
            </div>
            
            <button
              onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
              disabled={currentPage === totalPages}
              className="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Selanjutnya
            </button>
          </div>
        </div>
      )}

      {/* User Verification Modal */}
      {showVerificationModal && selectedUser && (
        <UserVerificationModal
          isOpen={showVerificationModal}
          onClose={handleModalClose}
          user={selectedUser}
          isProcessing={processing === selectedUser.id}
          onApprove={() => setShowConfirmModal('approve')}
          onReject={() => setShowConfirmModal('reject')}
        />
      )}

      {/* Confirmation Modal */}
      {showConfirmModal && selectedUser && (
        <ConfirmationModal
          isOpen={!!showConfirmModal}
          onClose={() => setShowConfirmModal(null)}
          user={selectedUser}
          action={showConfirmModal}
          isProcessing={processing === selectedUser.id}
          onConfirm={() => handleVerifyUser(showConfirmModal)}
        />
      )}
    </div>
  );
}

// Modal Komponen untuk Verifikasi User (mirip dengan admin)
interface UserVerificationModalProps {
  user: User;
  isOpen: boolean;
  onClose: () => void;
  isProcessing: boolean;
  onApprove: () => void;
  onReject: () => void;
}

function UserVerificationModal({
  user,
  isOpen,
  onClose,
  isProcessing,
  onApprove,
  onReject
}: UserVerificationModalProps) {
  if (!isOpen || !user) return null;

  const formatDate = (dateString: string | Date | null | undefined) => {
    if (!dateString) return 'N/A';
    
    try {
      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;
      if (isNaN(date.getTime())) return 'N/A';
      
      return date.toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch (error) {
      console.error('Error formatting date:', error);
      return 'N/A';
    }
  };

  const isVerified = !!user.verified_at;

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
      <div className="max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden">
        <Card className="shadow-2xl">
          {/* Header */}
          <div className="flex items-center justify-between p-6 border-b border-gray-200">
            <div className="flex items-center">
              <div className="w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4">
                <UserIcon className="w-6 h-6 text-brand-600" />
              </div>
              <div>
                <h2 className="text-xl font-semibold text-gray-900">
                  Detail User
                </h2>
                <p className="text-sm text-gray-500">
                  Informasi lengkap dan status verifikasi
                </p>
              </div>
            </div>
            <Button
              onClick={onClose}
              variant="ghost"
              size="sm"
              className="p-2"
            >
              <XMarkIcon className="w-5 h-5 text-gray-500" />
            </Button>
          </div>

          {/* Content */}
          <div className="p-6 max-h-[calc(90vh-200px)] overflow-y-auto">
            <div className="space-y-8">
              {/* Status Section */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${
                    isVerified 
                      ? 'bg-green-100 text-green-800' 
                      : 'bg-warning-100 text-warning-800'
                  }`}>
                    {isVerified ? (
                      <CheckCircleIcon className="w-4 h-4" />
                    ) : (
                      <ClockIcon className="w-4 h-4" />
                    )}
                    {isVerified ? 'Terverifikasi' : 'Menunggu Verifikasi'}
                  </div>
                  <div className={`px-3 py-1 rounded-full text-sm font-medium ${
                    user.role === 'VENDOR' 
                      ? 'bg-blue-100 text-blue-800' 
                      : user.role === 'VERIFIER'
                      ? 'bg-purple-100 text-purple-800'
                      : 'bg-gray-100 text-gray-800'
                  }`}>
                    <IdentificationIcon className="w-4 h-4 inline mr-1" />
                    {user.role}
                  </div>
                </div>
              </div>

              {/* User Info Grid */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                {/* Personal Information */}
                <Card className="bg-gray-50">
                  <div className="p-6">
                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                      <UserIcon className="w-5 h-5 mr-2 text-gray-500" />
                      Informasi Personal
                    </h3>
                    
                    <div className="space-y-4">
                      <div className="flex items-start">
                        <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                          <UserIcon className="w-5 h-5 text-blue-600" />
                        </div>
                        <div className="min-w-0 flex-1">
                          <p className="text-sm font-medium text-gray-500">Nama Petugas</p>
                          <p className="text-base font-medium text-gray-900 break-words">
                            {user.officer_name}
                          </p>
                        </div>
                      </div>

                      <div className="flex items-start">
                        <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                          <EnvelopeIcon className="w-5 h-5 text-green-600" />
                        </div>
                        <div className="min-w-0 flex-1">
                          <p className="text-sm font-medium text-gray-500">Email</p>
                          <p className="text-base font-medium text-gray-900 break-words">
                            {user.email}
                          </p>
                        </div>
                      </div>

                      {user.phone_number && (
                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <PhoneIcon className="w-5 h-5 text-orange-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">No. Telepon</p>
                            <p className="text-base font-medium text-gray-900">
                              {user.phone_number}
                            </p>
                          </div>
                        </div>
                      )}

                      {user.address && (
                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <MapPinIcon className="w-5 h-5 text-purple-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Alamat</p>
                            <p className="text-base font-medium text-gray-900 break-words">
                              {user.address}
                            </p>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </Card>

                {/* System Information */}
                <Card className="bg-gray-50">
                  <div className="p-6">
                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                      <ShieldCheckIcon className="w-5 h-5 mr-2 text-gray-500" />
                      Informasi Sistem
                    </h3>

                    <div className="space-y-4">
                      {user.vendor_name && (
                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <BuildingOfficeIcon className="w-5 h-5 text-indigo-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Nama Vendor</p>
                            <p className="text-base font-medium text-gray-900 break-words">
                              {user.vendor_name}
                            </p>
                          </div>
                        </div>
                      )}

                      <div className="flex items-start">
                        <div className="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                          <ClockIcon className="w-5 h-5 text-gray-600" />
                        </div>
                        <div className="min-w-0 flex-1">
                          <p className="text-sm font-medium text-gray-500">Tanggal Daftar</p>
                          <p className="text-base font-medium text-gray-900">
                            {formatDate(user.created_at)}
                          </p>
                        </div>
                      </div>

                      {isVerified && user.verified_at && (
                        <div className="flex items-start">
                          <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                            <ShieldCheckIcon className="w-5 h-5 text-green-600" />
                          </div>
                          <div className="min-w-0 flex-1">
                            <p className="text-sm font-medium text-gray-500">Diverifikasi Pada</p>
                            <p className="text-base font-medium text-gray-900">
                              {formatDate(user.verified_at)}
                            </p>
                            
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </Card>
              </div>

              {/* Actions for Unverified Users */}
              {!isVerified && (
                <Card className="bg-gradient-to-r from-blue-50 to-indigo-50">
                  <div className="p-6">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                      <CheckCircleIcon className="w-5 h-5 mr-2 text-blue-600" />
                      Tindakan Verifikasi
                    </h3>
                    <p className="text-sm text-gray-600 mb-4">
                      Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, 
                      sedangkan penolakan akan menghapus user dari sistem.
                    </p>


                    <div className="flex flex-col sm:flex-row gap-4">
                      <Button
                        onClick={onApprove}
                        disabled={isProcessing}
                        variant="primary"
                        size="md"
                        className="flex-1"
                      >
                        <CheckCircleIcon className="w-5 h-5 mr-2" />
                        Setujui User
                      </Button>
                      <Button
                        onClick={onReject}
                        disabled={isProcessing}
                        variant="destructive"
                        size="md"
                        className="flex-1"
                      >
                        <XCircleIcon className="w-5 h-5 mr-2" />
                        Tolak User
                      </Button>
                    </div>
                  </div>
                </Card>
              )}

              {/* Verification Status Info */}
              {isVerified && (
                <Card className="bg-gradient-to-r from-green-50 to-emerald-50">
                  <div className="p-6">
                    <div className="flex items-start">
                      <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                        <CheckCircleIcon className="w-6 h-6 text-green-600" />
                      </div>
                      <div>
                        <h4 className="text-lg font-semibold text-green-900 mb-2">
                          User Sudah Terverifikasi
                        </h4>
                        <p className="text-green-700">
                          User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan 
                          memiliki akses penuh ke fitur yang tersedia.
                        </p>
                      </div>
                    </div>
                  </div>
                </Card>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex justify-end p-6 border-t border-gray-200">
            <Button onClick={onClose} variant="outline" size="md">
              Tutup
            </Button>
          </div>
        </Card>
      </div>
    </div>
  );
}

// Modal Konfirmasi
interface ConfirmationModalProps {
  isOpen: boolean;
  onClose: () => void;
  user: User;
  action: 'approve' | 'reject';
  isProcessing: boolean;
  onConfirm: () => void;
}

function ConfirmationModal({ isOpen, onClose, user, action, isProcessing, onConfirm }: ConfirmationModalProps) {
  if (!isOpen) return null;

  const isApprove = action === 'approve';

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[60]">
      <Card className="max-w-md w-full mx-4">
        <div className="p-6">
          <div className="flex items-center mb-4">
            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
              isApprove ? 'bg-green-100' : 'bg-red-100'
            }`}>
              {isApprove ? (
                <CheckCircleIcon className="w-6 h-6 text-green-600" />
              ) : (
                <XCircleIcon className="w-6 h-6 text-red-600" />
              )}
            </div>
            <div className="ml-4">
              <h3 className="text-lg font-semibold text-gray-900">
                Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}
              </h3>
            </div>
          </div>

          <p className="text-gray-600 mb-6">
            Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}
            <strong className="text-gray-900">{user.officer_name}</strong>?
          </p>

          {!isApprove && (
            <div className="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
              <div className="flex items-start">
                <ExclamationTriangleIcon className="w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0" />
                <div className="text-sm">
                  <p className="font-medium text-red-800 mb-1">Peringatan!</p>
                  <p className="text-red-700">
                    User akan dihapus dari sistem dan tidak dapat login lagi.
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="flex justify-end space-x-3">
            <Button
              onClick={onClose}
              variant="outline"
              size="sm"
              disabled={isProcessing}
            >
              Batal
            </Button>
            <Button
              onClick={onConfirm}
              disabled={isProcessing}
              variant={isApprove ? "primary" : "destructive"}
              size="sm"
            >
              {isProcessing ? (
                <span className="flex items-center">
                  <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"></div>
                  Memproses...
                </span>
              ) : (
                `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`
              )}
            </Button>
          </div>
        </div>
      </Card>
    </div>
  );
}

=== FILE: src/components/scanner/CameraQRScanner.tsx ===
'use client';

import { useState, useEffect, useRef, useCallback } from 'react';
import { BrowserMultiFormatReader } from '@zxing/browser';
import { NotFoundException } from '@zxing/library';
import {
  XMarkIcon,
  CameraIcon,
  StopIcon
} from '@heroicons/react/24/outline';
import Button from '@/components/ui/button/Button';
import { Modal } from '@/components/ui/modal';
import ScanModal from './ScanModal';

interface ScanResult {
  success: boolean;
  data?: any;
  error?: string;
  message?: string;
  scanned_at?: string;
  scanned_by?: string;
  scan_id?: string;
}

interface CameraQRScannerProps {
  isOpen: boolean;
  onClose: () => void;
  onScan?: (result: string) => void;
  title?: string;
  description?: string;
}

export default function CameraQRScanner({ isOpen, onClose, onScan, title = "Scan Barcode/QR Code SIMLOK", description }: CameraQRScannerProps) {
  const [isScanning, setIsScanning] = useState(false);
  const [scanResult, setScanResult] = useState<ScanResult | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const videoRef = useRef<HTMLVideoElement>(null);
  const codeReaderRef = useRef<BrowserMultiFormatReader | null>(null);
  const streamRef = useRef<MediaStream | null>(null);
  const scanningRef = useRef<boolean>(false); // Track if scanning is active
  const scanIdRef = useRef<number>(0); // Unique ID for each scan session

  const resetScannerState = useCallback(() => {
    console.log('=== RESETTING SCANNER STATE ===');
    setScanResult(null);
    setIsModalOpen(false);
    setError(null);
    scanningRef.current = false;
    // Don't reset scanIdRef here as we want it to keep incrementing
  }, []);

  useEffect(() => {
    if (isOpen) {
      console.log('=== SCANNER OPENED ===');
      // Reset previous scan results when opening scanner
      resetScannerState();
      initializeScanner();
    } else {
      console.log('=== SCANNER CLOSED ===');
      stopScanner();
    }

    return () => {
      console.log('=== SCANNER CLEANUP ===');
      stopScanner();
    };
  }, [isOpen, resetScannerState]);

  const initializeScanner = async () => {
    try {
      console.log('=== INITIALIZING SCANNER ===');
      setError(null);
      setScanResult(null); // Clear any previous scan results
      setIsModalOpen(false); // Ensure modal is closed
      scanningRef.current = false; // Reset scanning state
      
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error('Camera not supported in this browser');
      }

      const stream = await navigator.mediaDevices.getUserMedia({
        video: { 
          facingMode: 'environment',
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      });

      if (videoRef.current) {
        videoRef.current.srcObject = stream;
        streamRef.current = stream;
        console.log('Video stream attached');
      }

      codeReaderRef.current = new BrowserMultiFormatReader();
      console.log('BrowserMultiFormatReader initialized');
      
      setIsScanning(true);
      startScanning();
    } catch (err) {
      console.error('Failed to initialize scanner:', err);
      setError(err instanceof Error ? err.message : 'Failed to access camera');
    }
  };

  const startScanning = async () => {
    if (!videoRef.current) {
      console.error('Video element not available');
      return;
    }

    try {
      // Increment scan ID for this session
      scanIdRef.current += 1;
      const currentScanId = scanIdRef.current;
      
      console.log(`=== STARTING SCAN PROCESS (ID: ${currentScanId}) ===`);
      
      // Reset any previous scan result before starting new scan
      setScanResult(null);
      setIsModalOpen(false);
      
      // Always create a fresh code reader instance to avoid state issues
      if (codeReaderRef.current) {
        codeReaderRef.current = null;
      }
      codeReaderRef.current = new BrowserMultiFormatReader();
      console.log('Fresh BrowserMultiFormatReader created');
      
      scanningRef.current = true; // Mark scanning as active
      
      codeReaderRef.current.decodeFromVideoDevice(
        undefined,
        videoRef.current,
        (result, error) => {
          // Check if this is still the current scan session
          if (scanIdRef.current !== currentScanId) {
            console.log(`Ignoring result from old scan session (${currentScanId} vs ${scanIdRef.current})`);
            return;
          }
          
          // Check if scanning is still active before processing
          if (!scanningRef.current) {
            console.log('Scanning stopped, ignoring result');
            return;
          }

          if (result) {
            console.log(`=== SCAN SUCCESS (ID: ${currentScanId}) ===`);
            console.log('Scanned text:', result.getText());
            scanningRef.current = false; // Stop scanning immediately
            handleScanSuccess(result.getText());
          }
          
          if (error && !(error instanceof NotFoundException)) {
            console.log('Scan error (non-critical):', error.message);
          }
        }
      );
    } catch (err) {
      console.error('Error during scanning:', err);
      setError('Scanning failed');
      scanningRef.current = false;
    }
  };

  const handleScanSuccess = async (scannedText: string) => {
    console.log('=== PROCESSING SCAN RESULT ===');
    console.log('Scanned text:', scannedText);
    
    try {
      // Stop all scanning activity immediately
      setIsScanning(false);
      scanningRef.current = false;

      const response = await fetch('/api/qr/verify', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          qrData: scannedText,
          scanner_type: 'barcode_scanner'
        }),
      });

      console.log('API response status:', response.status);
      const result = await response.json();
      console.log('API response data:', result);
      console.log('API response data.data:', result.data);
      console.log('API response data.data.submission:', result.data?.submission);

      setScanResult(result);
      
      // Call onScan callback if provided
      if (onScan) {
        onScan(scannedText);
      }
      
      console.log('=== SETTING MODAL STATE ===');
      console.log('result.success:', result.success);
      console.log('About to set modal open to true');
      setIsModalOpen(true);
      console.log('Modal state should be open now');
      
    } catch (error) {
      console.error('Error verifying QR:', error);
      const errorResult = {
        success: false,
        error: 'Failed to verify barcode/QR code'
      };
      setScanResult(errorResult);
      setIsModalOpen(true);
    }
  };

  const stopCamera = () => {
    console.log('=== STOPPING CAMERA ===');
    if (streamRef.current) {
      streamRef.current.getTracks().forEach(track => {
        track.stop();
        console.log('Camera track stopped');
      });
      streamRef.current = null;
    }
  };

  const stopScanner = () => {
    console.log('=== STOPPING SCANNER ===');
    setIsScanning(false);
    scanningRef.current = false; // Stop scanning process
    
    if (codeReaderRef.current) {
      try {
        // Create a new instance to completely reset the scanner
        codeReaderRef.current = null;
        console.log('Code reader cleared');
      } catch (error) {
        console.log('Error clearing code reader:', error);
      }
    }
    
    stopCamera();
  };

  const handleClose = () => {
    console.log('=== CLOSING SCANNER ===');
    stopScanner();
    setScanResult(null);
    setError(null);
    onClose();
  };

  const handleModalClose = () => {
    console.log('=== CLOSING RESULT MODAL ===');
    setIsModalOpen(false);
    setScanResult(null);
    setError(null);
    
    // Restart scanning after modal closes if scanner is still open
    if (isOpen && videoRef.current) {
      console.log('=== RESTARTING SCANNER AFTER MODAL CLOSE ===');
      // Add delay to ensure state is properly reset and avoid race conditions
      setTimeout(() => {
        setIsScanning(true);
        scanningRef.current = false; // Reset scanning state
        startScanning();
      }, 300); // Increased delay for more stability
    }
  };

  console.log('=== RENDER STATE ===');
  console.log('isOpen:', isOpen);
  console.log('isScanning:', isScanning);
  console.log('scanResult:', scanResult);
  console.log('isModalOpen:', isModalOpen);

  return (
    <>
      <Modal isOpen={isOpen} onClose={handleClose}>
        <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div className="p-6">
            <h2 className="text-xl font-semibold mb-4">
              {title}
            </h2>
            {description && (
              <p className="text-gray-600 mb-4">
                {description}
              </p>
            )}
            
            <div className="space-y-4">
              {error && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                  <p className="text-red-700">{error}</p>
                </div>
              )}

              <div className="relative bg-black rounded-lg overflow-hidden">
                <video
                  ref={videoRef}
                  autoPlay
                  playsInline
                  muted
                  className="w-full h-80 object-cover"
                />
                
                {isScanning && (
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="border-2 border-green-500 w-64 h-64 rounded-lg animate-pulse">
                      <div className="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-green-500"></div>
                      <div className="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-green-500"></div>
                      <div className="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-green-500"></div>
                      <div className="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-green-500"></div>
                    </div>
                  </div>
                )}
              </div>

              <div className="flex justify-between items-center">
                <p className="text-sm text-gray-600">
                  {isScanning ? 'Scanning for barcode/QR code...' : 'Camera ready'}
                </p>
                
                <div className="flex gap-2">
                  {!isScanning ? (
                    <Button onClick={initializeScanner} startIcon={<CameraIcon className="h-4 w-4" />}>
                      Start Scanning
                    </Button>
                  ) : (
                    <Button onClick={stopScanner} variant="outline" startIcon={<StopIcon className="h-4 w-4" />}>
                      Stop Scanning
                    </Button>
                  )}
                  
                  <Button onClick={handleClose} variant="outline" startIcon={<XMarkIcon className="h-4 w-4" />}>
                    Close
                  </Button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </Modal>

      {scanResult && (
        <ScanModal
          isOpen={isModalOpen}
          onClose={handleModalClose}
          result={scanResult}
        />
      )}
    </>
  );
}

=== FILE: src/components/scanner/QrScanErrorModal.tsx ===
'use client';

import React from 'react';
import { X, XCircle, AlertTriangle, RefreshCw } from 'lucide-react';

interface QrScanErrorModalProps {
  isOpen: boolean;
  onClose: () => void;
  error: string;
  message?: string | undefined;
  errorType?: 'invalid' | 'expired' | 'network' | 'unknown';
  onRetry?: () => void;
}

const QrScanErrorModal: React.FC<QrScanErrorModalProps> = ({
  isOpen,
  onClose,
  error: errorMessage,
  message,
  errorType = 'unknown',
  onRetry
}) => {
  if (!isOpen) return null;

  const getErrorIcon = () => {
    switch (errorType) {
      case 'invalid':
        return <XCircle className="h-12 w-12 text-red-500" />;
      case 'expired':
        return <AlertTriangle className="h-12 w-12 text-orange-500" />;
      case 'network':
        return <AlertTriangle className="h-12 w-12 text-yellow-500" />;
      default:
        return <XCircle className="h-12 w-12 text-red-500" />;
    }
  };

  const getErrorTitle = () => {
    switch (errorType) {
      case 'invalid':
        return 'QR Code Tidak Valid';
      case 'expired':
        return 'QR Code Kedaluwarsa';
      case 'network':
        return 'Masalah Koneksi';
      default:
        return 'Scan Gagal';
    }
  };

  const getErrorDescription = () => {
    switch (errorType) {
      case 'invalid':
        return 'QR Code yang dipindai tidak valid atau bukan QR Code SIMLOK.';
      case 'expired':
        return 'QR Code yang dipindai sudah kedaluwarsa. Silakan minta QR Code baru.';
      case 'network':
        return 'Terjadi masalah koneksi saat memverifikasi QR Code.';
      default:
        return 'Terjadi kesalahan saat memindai QR Code.';
    }
  };

  const getHeaderColor = () => {
    switch (errorType) {
      case 'expired':
        return 'bg-orange-50 border-orange-200';
      case 'network':
        return 'bg-yellow-50 border-yellow-200';
      default:
        return 'bg-red-50 border-red-200';
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
        {/* Header */}
        <div className={`flex items-center justify-between p-4 border-b ${getHeaderColor()}`}>
          <div className="flex items-center space-x-2">
            {getErrorIcon()}
            <h2 className="text-lg font-semibold text-gray-800">{getErrorTitle()}</h2>
          </div>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 transition-colors"
          >
            <X className="h-6 w-6" />
          </button>
        </div>

        {/* Content */}
        <div className="p-6 space-y-4">
          {/* Error Description */}
          <div className="text-center">
            <p className="text-gray-600 mb-2">{message || getErrorDescription()}</p>
            {errorMessage && (
              <div className="bg-gray-50 border border-gray-200 rounded-lg p-3 mt-3">
                <p className="text-sm text-gray-700 font-mono">{errorMessage}</p>
              </div>
            )}
          </div>

          {/* Solutions/Tips */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 className="font-medium text-blue-800 mb-2">Tips:</h4>
            <ul className="text-sm text-blue-700 space-y-1">
              {errorType === 'invalid' && (
                <>
                  <li>• Pastikan QR Code adalah QR Code SIMLOK yang valid</li>
                  <li>• Pastikan QR Code tidak rusak atau terpotong</li>
                  <li>• Coba posisikan QR Code lebih dekat ke kamera</li>
                </>
              )}
              {errorType === 'expired' && (
                <>
                  <li>• Minta QR Code baru dari sistem</li>
                  <li>• Pastikan permohonan masih dalam periode yang valid</li>
                </>
              )}
              {errorType === 'network' && (
                <>
                  <li>• Periksa koneksi internet</li>
                  <li>• Coba lagi dalam beberapa saat</li>
                </>
              )}
              {errorType === 'unknown' && (
                <>
                  <li>• Coba scan ulang QR Code</li>
                  <li>• Pastikan kamera dapat membaca QR Code dengan jelas</li>
                </>
              )}
            </ul>
          </div>
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-gray-200 bg-gray-50 space-y-2">
          {onRetry && (
            <button
              onClick={onRetry}
              className="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2"
            >
              <RefreshCw className="h-4 w-4" />
              <span>Coba Scan Lagi</span>
            </button>
          )}
          <button
            onClick={onClose}
            className="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>
  );
};

export default QrScanErrorModal;


=== FILE: src/components/scanner/QrScanResultModal.tsx ===
'use client';

import React from 'react';
import { X, CheckCircle, User, Calendar, MapPin, QrCode } from 'lucide-react';

interface Submission {
  id: string;
  number: string;
  title: string;
  task: string;
  workers?: { name: string }[];
  vendor?: { name: string };
  location?: string;
  implementation_start_date?: string | null;
  implementation_end_date?: string | null;
  status: string;
}

interface ScanResult {
  success: boolean;
  data?: any;
  error?: string;
  message?: string;
}

interface QrScanResultModalProps {
  isOpen: boolean;
  onClose: () => void;
  result: ScanResult;
  submission?: Submission | null;
  scanTime?: Date;
  scannedBy?: string;
  onScanAnother: () => void;
}

const QrScanResultModal: React.FC<QrScanResultModalProps> = ({
  isOpen,
  onClose,
  result,
  submission,
  scanTime,
  scannedBy,
  onScanAnother
}) => {
  // Extract submission from result if not provided directly
  const submissionData = submission || result.data?.submission;
  
  if (!isOpen || !result.success || !submissionData) return null;

  const formatDate = (dateString: string | null) => {
    if (!dateString) return 'Tidak ditentukan';
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    });
  };

  const getStatusColor = (status: string) => {
    switch (status.toLowerCase()) {
      case 'completed':
        return 'text-green-600 bg-green-100';
      case 'in_progress':
        return 'text-blue-600 bg-blue-100';
      case 'pending':
        return 'text-yellow-600 bg-yellow-100';
      default:
        return 'text-gray-600 bg-gray-100';
    }
  };

  const getStatusText = (status: string) => {
    switch (status.toLowerCase()) {
      case 'completed':
        return 'Selesai';
      case 'in_progress':
        return 'Sedang Berlangsung';
      case 'pending':
        return 'Menunggu';
      default:
        return status;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-green-50">
          <div className="flex items-center space-x-2">
            <CheckCircle className="h-6 w-6 text-green-600" />
            <h2 className="text-lg font-semibold text-green-800">QR Code Valid</h2>
          </div>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 transition-colors"
          >
            <X className="h-6 w-6" />
          </button>
        </div>

        {/* Content */}
        <div className="p-4 space-y-4">
          {/* Scan Information */}
          <div className="bg-green-50 border border-green-200 rounded-lg p-3">
            <h4 className="font-medium text-green-800 mb-2">Informasi Scan</h4>
            <div className="space-y-1 text-sm">
              {scanTime && (
                <div className="flex justify-between">
                  <span className="text-green-700">Waktu Scan:</span>
                  <span className="text-green-800 font-medium">{scanTime.toLocaleString('id-ID')}</span>
                </div>
              )}
              {scannedBy && (
                <div className="flex justify-between">
                  <span className="text-green-700">Dipindai oleh:</span>
                  <span className="text-green-800 font-medium">{scannedBy}</span>
                </div>
              )}
              {/* {scanId && (
                <div className="flex justify-between">
                  <span className="text-green-700">ID Scan:</span>
                  <span className="text-green-800 font-mono text-xs">{scanId}</span>
                </div>
              )} */}
            </div>
          </div>

          {/* Submission Number */}
          <div className="text-center">
            <div className="text-sm text-gray-600">Nomor Permohonan</div>
            <div className="text-xl font-bold text-gray-900">{submissionData.number}</div>
          </div>

          {/* Status */}
          <div className="flex justify-center">
            <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(submissionData.status)}`}>
              {getStatusText(submissionData.status)}
            </span>
          </div>

          {/* Title */}
          <div>
            <div className="text-sm font-medium text-gray-700 mb-1">Judul Pekerjaan</div>
            <div className="text-gray-900">{submissionData.title}</div>
          </div>

          {/* Task */}
          <div>
            <div className="text-sm font-medium text-gray-700 mb-1">Uraian Pekerjaan</div>
            <div className="text-gray-900 text-sm">{submissionData.task}</div>
          </div>

          {/* Vendor */}
          {submissionData.vendor && (
            <div className="flex items-start space-x-2">
              <User className="h-4 w-4 text-gray-500 mt-1" />
              <div>
                <div className="text-sm font-medium text-gray-700">Vendor</div>
                <div className="text-gray-900">{submissionData.vendor.name}</div>
              </div>
            </div>
          )}

          {/* Location */}
          {submissionData.location && (
            <div className="flex items-start space-x-2">
              <MapPin className="h-4 w-4 text-gray-500 mt-1" />
              <div>
                <div className="text-sm font-medium text-gray-700">Lokasi</div>
                <div className="text-gray-900">{submissionData.location}</div>
              </div>
            </div>
          )}

          {/* Implementation Period */}
          <div className="flex items-start space-x-2">
            <Calendar className="h-4 w-4 text-gray-500 mt-1" />
            <div>
              <div className="text-sm font-medium text-gray-700">Periode Pelaksanaan</div>
              <div className="text-gray-900 text-sm">
                {formatDate(submissionData.implementation_start_date || null)} - {formatDate(submissionData.implementation_end_date || null)}
              </div>
            </div>
          </div>

          {/* Workers */}
          {submissionData.workers && submissionData.workers.length > 0 && (
            <div>
              <div className="text-sm font-medium text-gray-700 mb-1">Pekerja</div>
              <div className="space-y-1">
                {submissionData.workers.map((worker: any, index: number) => (
                  <div key={index} className="text-sm text-gray-900 bg-gray-50 px-2 py-1 rounded">
                    {worker.name}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="p-4 border-t border-gray-200 bg-gray-50 space-y-2">
          {onScanAnother && (
            <button
              onClick={() => {
                onScanAnother();
                onClose();
              }}
              className="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2"
            >
              <QrCode className="h-4 w-4" />
              <span>Scan QR Code Lain</span>
            </button>
          )}
          <button
            onClick={onClose}
            className="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>
  );
};

export default QrScanResultModal;


=== FILE: src/components/scanner/ScanHistory.tsx ===
'use client';

import { useState, useEffect, forwardRef, useImperativeHandle } from 'react';
import { useSession } from 'next-auth/react';
import { 
  QrCodeIcon, 
  EyeIcon, 
  ClockIcon, 
  UserIcon,
  BuildingOfficeIcon,
  DocumentIcon,
  MapPinIcon,
  ChevronLeftIcon,
  ChevronRightIcon
} from '@heroicons/react/24/outline';
import Alert from '@/components/ui/alert/Alert';
import Button from '@/components/ui/button/Button';
import LoadingSpinner from '@/components/ui/LoadingSpinner';

interface ScanHistoryItem {
  id: string;
  scanned_at: string;
  scanner_name?: string;
  scan_location?: string;
  notes?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    role: string;
  };
  submission: {
    id: string;
    simlok_number: string;
    vendor_name: string;
    officer_name: string;
    job_description: string;
    work_location: string;
    approval_status: string;
  };
}

interface Pagination {
  total: number;
  limit: number;
  offset: number;
  hasMore: boolean;
}

interface ScanHistoryProps {
  submissionId?: string; // If provided, show scans for specific submission only
  className?: string;
}

interface ScanHistoryRef {
  closeDetailModal: () => void;
}

const ScanHistory = forwardRef<ScanHistoryRef, ScanHistoryProps>(function ScanHistory({ submissionId, className = '' }, ref) {
  const { data: session } = useSession();
  const [scans, setScans] = useState<ScanHistoryItem[]>([]);
  const [pagination, setPagination] = useState<Pagination>({
    total: 0,
    limit: 20,
    offset: 0,
    hasMore: false
  });
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedScan, setSelectedScan] = useState<ScanHistoryItem | null>(null);

  // Expose methods to parent component via ref
  useImperativeHandle(ref, () => ({
    closeDetailModal: () => {
      setSelectedScan(null);
    }
  }));

  // Fetch scan history
  const fetchScanHistory = async (offset = 0) => {
    try {
      setIsLoading(true);
      setError(null);

      const params = new URLSearchParams({
        limit: pagination.limit.toString(),
        offset: offset.toString(),
      });

      if (submissionId) {
        params.append('submission_id', submissionId);
      }

      const response = await fetch(`/api/qr/verify?${params}`);
      const data = await response.json();

      if (response.ok) {
        setScans(data.scans);
        setPagination(data.pagination);
      } else {
        setError(data.error || 'Failed to fetch scan history');
      }
    } catch (err) {
      console.error('Error fetching scan history:', err);
      setError('Network error while fetching scan history');
    } finally {
      setIsLoading(false);
    }
  };

  // Load data on mount
  useEffect(() => {
    fetchScanHistory();
  }, [submissionId]);

  // Format date for display
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return {
      date: date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'long',
        year: 'numeric'
      }),
      time: date.toLocaleTimeString('id-ID', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      })
    };
  };

  // Get role badge color
  const getRoleBadge = (role: string) => {
    const roleConfig = {
      ADMIN: { label: 'Admin', className: 'bg-purple-100 text-purple-800' },
      VERIFIER: { label: 'Verifier', className: 'bg-blue-100 text-blue-800' },
      VENDOR: { label: 'Vendor', className: 'bg-green-100 text-green-800' }
    };
    
    const config = roleConfig[role as keyof typeof roleConfig] || { 
      label: role, 
      className: 'bg-gray-100 text-gray-800' 
    };
    
    return (
      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${config.className}`}>
        {config.label}
      </span>
    );
  };

  // Handle pagination
  const handlePrevious = () => {
    const newOffset = Math.max(0, pagination.offset - pagination.limit);
    fetchScanHistory(newOffset);
  };

  const handleNext = () => {
    const newOffset = pagination.offset + pagination.limit;
    fetchScanHistory(newOffset);
  };

  if (!session) {
    return (
      <Alert
        variant="error"
        title="Akses Ditolak"
        message="Anda harus login untuk melihat history scan"
      />
    );
  }

  return (
    <div className={`scan-history ${className}`}>
      <div className="bg-white rounded-lg shadow-lg">
        {/* Header */}
        <div className="px-6 py-4 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <div className="flex items-center">
              <ClockIcon className="h-6 w-6 text-blue-500 mr-3" />
              <div>
                <h2 className="text-xl font-semibold text-gray-900">
                  {submissionId ? 'History Scan Submission' : 'History Scan QR Code'}
                </h2>
                <p className="text-sm text-gray-500">
                  {pagination.total} total scan records
                </p>
              </div>
            </div>
            
            <Button
              onClick={() => fetchScanHistory(pagination.offset)}
              variant="secondary"
              size="sm"
            >
              Refresh
            </Button>
          </div>
        </div>

        {/* Content */}
        <div className="p-6">
          {/* Error State */}
          {error && (
            <Alert
              variant="error"
              title="Error"
              message={error}
              className="mb-4"
            />
          )}

          {/* Loading State */}
          {isLoading && (
            <div className="flex items-center justify-center py-12">
              <LoadingSpinner size="lg" className="mr-3" />
              <span className="text-gray-600">Memuat riwayat scan...</span>
            </div>
          )}

          {/* Empty State */}
          {!isLoading && scans.length === 0 && !error && (
            <div className="text-center py-12">
              <QrCodeIcon className="h-12 w-12 text-gray-400 mx-auto mb-3" />
              <h3 className="text-lg font-medium text-gray-900 mb-1">
                Belum Ada Scan
              </h3>
              <p className="text-gray-500">
                {submissionId 
                  ? 'Submission ini belum pernah di-scan'
                  : 'Belum ada QR code yang di-scan'
                }
              </p>
            </div>
          )}

          {/* Scan History List */}
          {!isLoading && scans.length > 0 && (
            <div className="space-y-4">
              {scans.map((scan) => {
                const dateTime = formatDate(scan.scanned_at);
                
                return (
                  <div
                    key={scan.id}
                    className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex-1 space-y-3">
                        {/* Scan Info */}
                        <div className="flex items-center space-x-4">
                          <div className="flex items-center text-sm text-gray-600">
                            <ClockIcon className="h-4 w-4 mr-1" />
                            <span className="font-medium">{dateTime.date}</span>
                            <span className="mx-2">•</span>
                            <span>{dateTime.time}</span>
                          </div>
                          
                          <div className="flex items-center text-sm">
                            <UserIcon className="h-4 w-4 text-gray-400 mr-1" />
                            <span className="font-medium text-gray-700">
                              {scan.scanner_name || scan.user.officer_name}
                            </span>
                            <span className="ml-2">
                              {getRoleBadge(scan.user.role)}
                            </span>
                          </div>
                        </div>

                        {/* Submission Info */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                          <div className="flex items-center">
                            <DocumentIcon className="h-4 w-4 text-blue-400 mr-2" />
                            <div>
                              <span className="text-gray-600">SIMLOK:</span>
                              <span className="ml-1 font-semibold text-blue-600">
                                {scan.submission.simlok_number}
                              </span>
                            </div>
                          </div>
                          
                          <div className="flex items-center">
                            <BuildingOfficeIcon className="h-4 w-4 text-green-400 mr-2" />
                            <div>
                              <span className="text-gray-600">Vendor:</span>
                              <span className="ml-1 font-medium">
                                {scan.submission.vendor_name}
                              </span>
                            </div>
                          </div>
                          
                          <div className="flex items-center">
                            <UserIcon className="h-4 w-4 text-purple-400 mr-2" />
                            <div>
                              <span className="text-gray-600">Petugas:</span>
                              <span className="ml-1 font-medium">
                                {scan.submission.officer_name}
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Job Description */}
                        <div className="text-sm">
                          <span className="text-gray-600">Pekerjaan:</span>
                          <span className="ml-1">{scan.submission.job_description}</span>
                        </div>

                        {/* Location */}
                        <div className="text-sm">
                          <span className="text-gray-600">Lokasi:</span>
                          <span className="ml-1">{scan.submission.work_location}</span>
                        </div>

                        {/* Scan Location */}
                        {scan.scan_location && (
                          <div className="flex items-center text-sm">
                            <MapPinIcon className="h-4 w-4 text-orange-400 mr-2" />
                            <div>
                              <span className="text-gray-600">Lokasi Scan:</span>
                              <span className="ml-1 font-medium text-orange-600">{scan.scan_location}</span>
                            </div>
                          </div>
                        )}

                        {/* Notes */}
                        {scan.notes && (
                          <div className="text-sm bg-blue-50 p-3 rounded-md border-l-4 border-blue-200">
                            <span className="text-blue-700 font-medium">Catatan:</span>
                            <span className="ml-1 text-blue-600">{scan.notes}</span>
                          </div>
                        )}
                      </div>

                      {/* Actions */}
                      <div className="flex-shrink-0 ml-4">
                        <Button
                          onClick={() => setSelectedScan(scan)}
                          variant="secondary"
                          size="sm"
                        >
                          <EyeIcon className="h-4 w-4 mr-1" />
                          Detail
                        </Button>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          {/* Pagination */}
          {!isLoading && scans.length > 0 && (
            <div className="flex items-center justify-between mt-6 pt-4 border-t border-gray-200">
              <div className="text-sm text-gray-600">
                Showing {pagination.offset + 1} to {Math.min(pagination.offset + pagination.limit, pagination.total)} of {pagination.total} scans
              </div>
              
              <div className="flex space-x-2">
                <Button
                  onClick={handlePrevious}
                  disabled={pagination.offset === 0}
                  variant="secondary"
                  size="sm"
                >
                  <ChevronLeftIcon className="h-4 w-4 mr-1" />
                  Previous
                </Button>
                
                <Button
                  onClick={handleNext}
                  disabled={!pagination.hasMore}
                  variant="secondary"
                  size="sm"
                >
                  Next
                  <ChevronRightIcon className="h-4 w-4 ml-1" />
                </Button>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Detail Modal */}
      {selectedScan && (
        <div className="fixed inset-0 z-50 overflow-y-auto">
          <div className="flex min-h-full items-center justify-center p-4">
            <div 
              className="fixed inset-0 bg-black/30 transition-opacity"
              onClick={() => setSelectedScan(null)}
            />
            
            <div className="relative bg-white rounded-lg shadow-xl max-w-2xl w-full">
              <div className="p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">
                  Detail Scan QR Code
                </h3>
                
                <div className="space-y-4">
                  {/* Scan Details */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <span className="block text-sm font-medium text-gray-600">Waktu Scan</span>
                      <span className="text-gray-900">
                        {formatDate(selectedScan.scanned_at).date} - {formatDate(selectedScan.scanned_at).time}
                      </span>
                    </div>
                    
                    <div>
                      <span className="block text-sm font-medium text-gray-600">Di-scan Oleh</span>
                      <div className="flex items-center space-x-2">
                        <span className="text-gray-900">
                          {selectedScan.scanner_name || selectedScan.user.officer_name}
                        </span>
                        {getRoleBadge(selectedScan.user.role)}
                      </div>
                    </div>
                  </div>

                  {/* Submission Details */}
                  <div className="pt-4 border-t border-gray-200">
                    <h4 className="font-medium text-gray-900 mb-3">Submission Details</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                      <div>
                        <span className="block font-medium text-gray-600">SIMLOK Number</span>
                        <span className="text-blue-600 font-semibold">
                          {selectedScan.submission.simlok_number}
                        </span>
                      </div>
                      
                      <div>
                        <span className="block font-medium text-gray-600">Vendor</span>
                        <span className="text-gray-900">{selectedScan.submission.vendor_name}</span>
                      </div>
                      
                      <div>
                        <span className="block font-medium text-gray-600">Officer</span>
                        <span className="text-gray-900">{selectedScan.submission.officer_name}</span>
                      </div>
                      
                      <div>
                        <span className="block font-medium text-gray-600">Status</span>
                        <span className="text-gray-900">{selectedScan.submission.approval_status}</span>
                      </div>
                      
                      <div className="md:col-span-2">
                        <span className="block font-medium text-gray-600">Job Description</span>
                        <span className="text-gray-900">{selectedScan.submission.job_description}</span>
                      </div>
                      
                      <div className="md:col-span-2">
                        <span className="block font-medium text-gray-600">Work Location</span>
                        <span className="text-gray-900">{selectedScan.submission.work_location}</span>
                      </div>
                    </div>
                  </div>

                  {/* Scan Location */}
                  {selectedScan.scan_location && (
                    <div className="pt-4 border-t border-gray-200">
                      <div className="flex items-center">
                        <MapPinIcon className="h-5 w-5 text-orange-500 mr-2" />
                        <span className="block font-medium text-gray-600 mb-2">Scan Location</span>
                      </div>
                      <div className="bg-orange-50 p-3 rounded-md text-sm text-orange-700 border-l-4 border-orange-200">
                        {selectedScan.scan_location}
                      </div>
                    </div>
                  )}

                  {/* Notes */}
                  {selectedScan.notes && (
                    <div className="pt-4 border-t border-gray-200">
                      <span className="block font-medium text-gray-600 mb-2">Notes</span>
                      <div className="bg-gray-50 p-3 rounded-md text-sm text-gray-700">
                        {selectedScan.notes}
                      </div>
                    </div>
                  )}
                </div>

                {/* Close Button */}
                <div className="mt-6 flex justify-end">
                  <Button
                    onClick={() => setSelectedScan(null)}
                    variant="secondary"
                  >
                    Close
                  </Button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
});

export default ScanHistory;


=== FILE: src/components/scanner/ScanModal.tsx ===
'use client';

import React from 'react';
import { XMarkIcon } from '@heroicons/react/24/outline';
import { CheckCircleIcon, XCircleIcon } from '@heroicons/react/24/solid';
import Button from '@/components/ui/button/Button';

interface ScanResult {
  success: boolean;
  data?: any;
  error?: string;
  message?: string;
  scanned_at?: string;
  scanned_by?: string;
  scan_id?: string;
  previousScan?: {
    scanDate: string | Date;
    scanId: string;
    scannerName: string;
  };
}

interface ScanModalProps {
  isOpen: boolean;
  onClose: () => void;
  result: ScanResult;
}

const ScanModal: React.FC<ScanModalProps> = ({
  isOpen,
  onClose,
  result
}) => {
  if (!isOpen) return null;

  // Debug logging
  console.log('=== SCAN MODAL DEBUG ===');
  console.log('result:', result);
  console.log('result.data:', result.data);
  console.log('result.data?.submission:', result.data?.submission);

  const submission = result.data?.submission;

  return (
    <div 
      className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 md:p-8"
      onClick={onClose}
    >
      <div 
        className="bg-white  rounded-lg  shadow-xl h-full w-full md:h-auto md:max-w-2xl md:min-w-[600px] md:max-h-[80vh] flex flex-col"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="p-4 md:p-6 h-full flex flex-col overflow-hidden">
          {/* Header */}
          <div className="flex items-center justify-between mb-4 shrink-0">
            <h2 className="text-xl font-semibold">
              {result.success ? 'Scan Berhasil' : 'Scan Gagal'}
            </h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600 p-1"
            >
              <XMarkIcon className="h-6 w-6" />
            </button>
          </div>

          {/* Scrollable Content */}
          <div className="flex-1 overflow-y-auto">
            {/* Status Icon & Message */}
            <div className="text-center mb-6">
              {result.success ? (
                <CheckCircleIcon className="h-16 w-16 text-green-500 mx-auto mb-3" />
              ) : (
                <XCircleIcon className="h-16 w-16 text-red-500 mx-auto mb-3" />
              )}
              
              <p className="text-lg font-medium mb-2">
                {result.success ? 'Barcode/QR Code Valid' : 
                 result.error === 'duplicate_scan_same_day' ? 'Sudah Discan Hari Ini' :
                 result.error === 'already_scanned_by_other' ? 'Sudah Discan Verifikator Lain' :
                 result.error === 'duplicate_scan' ? 'QR Code Sudah Pernah Discan' :
                 'Barcode/QR Code Tidak Valid'}
              </p>
              
              {result.message && (
                <p className="text-gray-600 text-sm md:text-base">{result.message}</p>
              )}
              
              {/* Show previous scan info for all duplicate error types */}
              {(result.error === 'duplicate_scan_same_day' || 
                result.error === 'already_scanned_by_other' || 
                result.error === 'duplicate_scan') && result.previousScan && (
                <div className="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200 text-left max-w-md mx-auto">
                  <h4 className="text-sm font-medium text-yellow-800 mb-2">Informasi Scan Sebelumnya:</h4>
                  <div className="text-xs text-yellow-700 space-y-1">
                    <p><span className="font-medium">Verifikator:</span> {result.previousScan.scannerName}</p>
                    <p><span className="font-medium">Waktu:</span> {new Date(result.previousScan.scanDate).toLocaleDateString('id-ID', {
                      day: '2-digit',
                      month: '2-digit',
                      year: 'numeric',
                      hour: '2-digit',
                      minute: '2-digit',
                    })}</p>
                  </div>
                </div>
              )}
              
              {result.error && !['duplicate_scan', 'duplicate_scan_same_day', 'already_scanned_by_other'].includes(result.error) && (
                <p className="text-red-600 text-sm md:text-base">{result.error}</p>
              )}
            </div>

            {/* Submission Details */}
            {result.success && submission && (
              <div className="bg-gray-50 rounded-lg p-4 md:p-6 mb-6">
                <h3 className="font-semibold mb-4 text-lg">Detail SIMLOK</h3>
                <div className="space-y-4 md:space-y-3">
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <span className="text-sm text-gray-600">Nomor SIMLOK:</span>
                      <p className="font-medium">{submission.number || '-'}</p>
                    </div>
                    <div>
                      <span className="text-sm text-gray-600">Status:</span>
                      <p className="font-medium capitalize">
                        {submission.status === 'approved' ? 'Disetujui' : 
                         submission.status === 'pending' ? 'Menunggu' : 
                         submission.status === 'rejected' ? 'Ditolak' : 
                         submission.status}
                      </p>
                    </div>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Vendor:</span>
                    <p className="font-medium">{submission.vendor?.name || '-'}</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Pekerjaan:</span>
                    <p className="font-medium">{submission.title || submission.task || '-'}</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Lokasi:</span>
                    <p className="font-medium">{submission.location || '-'}</p>
                  </div>
                  {submission.workers && submission.workers.length > 0 && (
                    <div>
                      <span className="text-sm text-gray-600">Pekerja:</span>
                      <div className="mt-1">
                        {submission.workers.map((worker: any, index: number) => (
                          <p key={index} className="font-medium text-sm">
                            • {worker.name}
                          </p>
                        ))}
                      </div>
                    </div>
                  )}
                  {(submission.implementation_start_date || submission.implementation_end_date) && (
                    <div>
                      <span className="text-sm text-gray-600">Periode Pelaksanaan:</span>
                      <p className="font-medium">
                        {submission.implementation_start_date ? 
                          new Date(submission.implementation_start_date).toLocaleDateString('id-ID') : 
                          '-'} 
                        {submission.implementation_end_date && 
                          ` s/d ${new Date(submission.implementation_end_date).toLocaleDateString('id-ID')}`}
                      </p>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Scan Information */}
            {/* {result.success && (result.scanned_at || result.scanned_by) && (
              <div className="bg-blue-50 rounded-lg p-4 mb-6">
                <h3 className="font-semibold mb-3 text-blue-900">Informasi Scan</h3>
                <div className="space-y-2">
                  {result.scanned_by && (
                    <div>
                      <span className="text-sm text-blue-700">Discan oleh:</span>
                      <p className="font-medium text-blue-900">{result.scanned_by}</p>
                    </div>
                  )}
                  {result.scanned_at && (
                    <div>
                      <span className="text-sm text-blue-700">Waktu scan:</span>
                      <p className="font-medium text-blue-900">
                        {new Date(result.scanned_at).toLocaleString('id-ID')}
                      </p>
                    </div>
                  )}
                  {result.scan_id && (
                    <div>
                      <span className="text-sm text-blue-700">ID Scan:</span>
                      <p className="font-medium text-blue-900 font-mono text-sm">{result.scan_id}</p>
                    </div>
                  )}
                </div>
              </div>
            )} */}
            
            {/* Extra padding for better scrolling on mobile */}
            <div className="pb-4 md:pb-6"></div>
          </div>

          {/* Actions - Fixed at bottom */}
          <div className="flex gap-3 shrink-0 pt-4 md:pt-6 border-t border-gray-200 md:px-2">
            <Button 
              onClick={onClose}
              variant={result.success ? "primary" : "outline"}
              className="flex-1 md:py-3 md:text-base md:font-medium"
            >
              {result.success ? 'Selesai' : 'Tutup'}
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ScanModal;

=== FILE: src/components/security/RoleGate.tsx ===
"use client";

import { useSession } from "next-auth/react";
import { useRouter } from "next/navigation";
import { useEffect } from "react";

interface Props {
  allowedRoles: ("SUPER_ADMIN" | "VENDOR" | "VERIFIER" | "REVIEWER" | "APPROVER")[];
  children: React.ReactNode;
}

export default function RoleGate({ allowedRoles, children }: Props) {
  const { data: session, status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (status === "loading") return;
    if (!session) router.replace("/login");
    else if (!allowedRoles.includes(session.user.role)) router.replace("/"); // Redirect to home if role is not allowed
  }, [session, status, allowedRoles, router]);

  if (status === "loading") return <p className="p-8">Loading…</p>;
  if (!session || !allowedRoles.includes(session.user.role)) return null;

  return <>{children}</>;
}

=== FILE: src/components/security/SessionExpiryHandler.tsx ===
"use client";

import { useSession } from "next-auth/react";
import { useEffect, useRef, useState } from "react";
import { useRouter } from "next/navigation";
import { JWT_CONFIG, getTimeUntilExpiry, formatExpiryTime } from "@/utils/jwt-config";
import ConfirmModal from "../ui/modal/ConfirmModal";

interface SessionExpiryHandlerProps {
  children: React.ReactNode;
}

export default function SessionExpiryHandler({ children }: SessionExpiryHandlerProps) {
  const { data: session, status, update } = useSession();
  const router = useRouter();
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);
  const refreshIntervalRef = useRef<NodeJS.Timeout | null>(null);
  
  const [showSessionWarning, setShowSessionWarning] = useState(false);
  const [showSessionExpired, setShowSessionExpired] = useState(false);

  useEffect(() => {
    // Clear existing timeout
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }

    if (status === "authenticated" && session) {
      // Calculate time until session expires
      const now = Date.now() / 1000;
      const expiresAt = session.expires ? new Date(session.expires).getTime() / 1000 : now + JWT_CONFIG.SESSION_MAX_AGE;
      const timeUntilExpiry = getTimeUntilExpiry(expiresAt) * 1000; // Convert to milliseconds

      console.log('Session expires at:', new Date(expiresAt * 1000));
      console.log('Time until expiry:', formatExpiryTime(timeUntilExpiry / 1000));

      if (timeUntilExpiry > 0) {
        // Set timeout to show warning before expiry
        const warningTime = Math.max(0, timeUntilExpiry - (JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000));
        
        timeoutRef.current = setTimeout(async () => {
          setShowSessionWarning(true);
        }, warningTime);
      } else {
        // Session already expired
        console.log('Session already expired');
        router.push("/login");
      }
    }

    // Cleanup timeout on unmount
    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, [session, status, router, update]);

  // Auto-refresh session periodically (but not on visibility change)
  useEffect(() => {
    // Clear existing interval
    if (refreshIntervalRef.current) {
      clearInterval(refreshIntervalRef.current);
    }

    // Auto-refresh based on configured interval (only when authenticated)
    if (status === "authenticated") {
      refreshIntervalRef.current = setInterval(async () => {
        try {
          const response = await fetch("/api/auth/session");
          if (!response.ok) {
            console.log('Session validation failed, redirecting to login');
            setShowSessionExpired(true);
          }
        } catch (error) {
          console.error('Session validation error:', error);
          setShowSessionExpired(true);
        }
      }, JWT_CONFIG.AUTO_REFRESH_INTERVAL * 60 * 1000); // Convert minutes to milliseconds
    }

    return () => {
      if (refreshIntervalRef.current) {
        clearInterval(refreshIntervalRef.current);
      }
    };
  }, [status, router]);

  const handleExtendSession = async () => {
    try {
      await update();
      setShowSessionWarning(false);
      console.log('Session refreshed successfully');
    } catch (error) {
      console.error('Failed to refresh session:', error);
      setShowSessionExpired(true);
    }
  };

  const handleSessionExpiry = () => {
    setShowSessionWarning(false);
    setTimeout(() => {
      setShowSessionExpired(true);
    }, JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000);
  };

  const handleGoToLogin = () => {
    setShowSessionExpired(false);
    router.push("/login");
  };

  return (
    <>
      {children}
      
      <ConfirmModal
        isOpen={showSessionWarning}
        title="Session Warning"
        message={`Your session will expire in ${JWT_CONFIG.WARNING_BEFORE_EXPIRY} minutes. Would you like to extend your session?`}
        onConfirm={handleExtendSession}
        onClose={handleSessionExpiry}
        confirmText="Extend Session"
        cancelText="Let it expire"
      />

      <ConfirmModal
        isOpen={showSessionExpired}
        title="Session Expired"
        message="Your session has expired. Please log in again."
        onConfirm={handleGoToLogin}
        onClose={handleGoToLogin}
        confirmText="Go to Login"
        showCancel={false}
      />
    </>
  );
}


=== FILE: src/components/security/VerificationGuard.tsx ===
'use client';

import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';

interface VerificationGuardProps {
  children: React.ReactNode;
}

export default function VerificationGuard({ children }: VerificationGuardProps) {
  const { data: session, status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (status === 'loading') return; // Still loading

    if (!session) {
      router.push('/login');
      return;
    }

    // Check if user account has been rejected
    if (session.user.verification_status === 'REJECTED') {
      console.log('VerificationGuard - User account rejected, redirecting...');
      router.push('/verification-rejected');
      return;
    }

    // Check if user is verified (admin always allowed)
    if (session.user.role !== 'ADMIN' && !session.user.verified_at) {
      console.log('VerificationGuard - User not verified, redirecting...');
      router.push('/verification-pending');
      return;
    }
  }, [session, status, router]);

  // Show loading while checking
  if (status === 'loading') {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  // Don't render if not authenticated
  if (!session) {
    return null;
  }

  // Don't render if account is rejected
  if (session.user.verification_status === 'REJECTED') {
    return null;
  }

  // Don't render if not verified (except admin)
  if (session.user.role !== 'ADMIN' && !session.user.verified_at) {
    return null;
  }

  return <>{children}</>;
}


=== FILE: src/components/submissions/SubmissionForm.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useSession } from 'next-auth/react';
import Card from '@/components/ui/Card';
import Button from '@/components/ui/button/Button';
import Input from '@/components/form/Input';
import Label from '@/components/form/Label';
import DatePicker from '@/components/form/DatePicker';
import TimePicker from '@/components/form/TimePicker';
import EnhancedFileUpload from '@/components/form/EnhancedFileUpload';
import Alert from "../ui/alert/Alert";
import { useToast } from '@/hooks/useToast';
import { SubmissionData } from '@/types/submission';

// Define Worker interface for dynamic inputs
interface Worker {
  id: string;
  worker_name: string;
  worker_photo: string;
}

export default function SubmissionForm() {
  const router = useRouter();
  const { showSuccess, showError } = useToast();
  const [isLoading, setIsLoading] = useState(false);
  const [alert, setAlert] = useState<{ variant: 'success' | 'error' | 'warning' | 'info', title: string, message: string } | null>(null);

  const { data: session } = useSession();

  // State for dynamic workers
  const [workers, setWorkers] = useState<Worker[]>([
    { id: '1', worker_name: '', worker_photo: '' }
  ]);

  // Auto-fill form data when session is available
  useEffect(() => {
    if (session?.user) {
      console.log('Session user data:', session.user); // Debug log
      setFormData(prev => ({
        ...prev,
        vendor_name: session.user.vendor_name || prev.vendor_name || '',
        officer_name: session.user.officer_name || prev.officer_name || '',
      }));
    }
  }, [session]);

  
  const [formData, setFormData] = useState<SubmissionData>({
    vendor_name: '',
    based_on: '',
    officer_name: '',
    job_description: '',
    work_location: '',
    working_hours: '',
    work_facilities: '',
    worker_count: 0,
    simja_number: '',
    simja_date: '',
    sika_number: '',
    sika_date: '',
    worker_names: '',
    sika_document_upload: '',
    simja_document_upload: '',
  });

  // Handle file upload from FileUpload component
  const handleFileUpload = (fieldName: string) => (url: string) => {
    setFormData(prev => ({
      ...prev,
      [fieldName]: url
    }));
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value, type } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'number' ? (value === '' ? 0 : Number(value)) : value
    }));
  };

  const handleDateChange = (name: string) => (value: string) => {
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleTimeChange = (value: string) => {
    setFormData(prev => ({
      ...prev,
      working_hours: value
    }));
  };

  // Functions for managing dynamic workers
  const addWorker = () => {
    const newWorker: Worker = {
      id: Date.now().toString(),
      worker_name: '',
      worker_photo: ''
    };
    setWorkers(prev => [...prev, newWorker]);
  };

  const removeWorker = (id: string) => {
    if (workers.length > 1) {
      setWorkers(prev => prev.filter(worker => worker.id !== id));
    }
  };

  const updateWorkerName = (id: string, nama: string) => {
    setWorkers(prev => prev.map(worker =>
      worker.id === id ? { ...worker, worker_name: nama } : worker
    ));
  };

  const updateWorkerPhoto = (id: string, foto: string) => {
    setWorkers(prev => prev.map(worker =>
      worker.id === id ? { ...worker, worker_photo: foto } : worker
    ));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      // Validate workers
      const validWorkers = workers.filter(worker => worker.worker_name.trim() !== '');
      if (validWorkers.length === 0) {
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: 'Minimal harus ada satu pekerja yang diisi'
        });
        setIsLoading(false);
        return;
      }

      // Check if all workers have photos
      const workersWithoutPhoto = validWorkers.filter(worker => !worker.worker_photo.trim());
      if (workersWithoutPhoto.length > 0) {
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: 'Semua pekerja harus memiliki foto. Silakan upload foto untuk semua pekerja.'
        });
        setIsLoading(false);
        return;
      }

      // Format worker names for database
      const workerNames = validWorkers.map(worker => worker.worker_name.trim()).join('\n');

      // Prepare submission data
      const formattedData = {
        ...formData,
        worker_names: workerNames,
        workers: validWorkers // Include workers data for API processing
      };

      const response = await fetch('/api/submissions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formattedData),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to create submission');
      }

      // Show success toast and redirect
      showSuccess('Berhasil!', 'Pengajuan SIMLOK berhasil dibuat!');
      router.push('/vendor/submissions');
    } catch (error) {
      console.error('Error creating submission:', error);
      const errorMessage = error instanceof Error ? error.message : 'Failed to create submission. Please try again.';
      showError('Error!', errorMessage);
      setAlert({
        variant: 'error',
        title: 'Error!',
        message: errorMessage
      });
      setTimeout(() => setAlert(null), 5000);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-6">
      {/* Debug info - remove in production */}
      {/* {process.env.NODE_ENV === 'development' && (
        <div className="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <h3 className="font-semibold text-yellow-800">Debug Session Info:</h3>
          <pre className="text-sm text-yellow-700 mt-2">
            {JSON.stringify({
              userId: session?.user?.id,
              nama_petugas: session?.user?.nama_petugas,
              nama_vendor: session?.user?.nama_vendor,
              role: session?.user?.role,
              email: session?.user?.email
            }, null, 2)}
          </pre>
        </div>
      )} */}
      
      <Card>
        <div className="p-6">
          {/* <h1 className="text-2xl font-bold mb-6">Buat Pengajuan Baru</h1> */}
          
          <form onSubmit={handleSubmit} className="space-y-8">
            {/* Informasi Vendor */}
            <div className="p-6 rounded-lg">
              <h2 className="text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2">Informasi Vendor</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <Label htmlFor="vendor_name">Nama Vendor</Label>
                  <Input
                    id="vendor_name"
                    name="vendor_name"
                    type="text"
                    value={session?.user?.vendor_name || formData.vendor_name || ''}
                    onChange={handleChange}
                    required
                    disabled={!!session?.user?.vendor_name}
                    placeholder="Masukkan nama vendor"
                    className={session?.user?.vendor_name ? "cursor-not-allowed bg-gray-50" : ""}
                  />
                </div>

                <div>
                  <Label htmlFor="officer_name">Nama Petugas</Label>
                  <Input
                    id="officer_name"
                    name="officer_name"
                    type="text"
                    value={formData.officer_name || ''}
                    onChange={handleChange}
                    required
                    placeholder="Nama petugas yang bertanggung jawab"
                  />
                </div>

                <div className="md:col-span-2">
                  <Label htmlFor="based_on">Berdasarkan</Label>
                  <Input
                    id="based_on"
                    name="based_on"
                    type="text"
                    value={formData.based_on}
                    onChange={handleChange}
                    required
                    placeholder="Contoh: Surat Izin Kerja No. 123/2024"
                  />
                </div>

                {/* Document Numbers */}
                <div>
                  <Label htmlFor="simja_number">Nomor SIMJA</Label>
                  <Input
                    id="simja_number"
                    name="simja_number"
                    type="text"
                    value={formData.simja_number || ''}
                    onChange={handleChange}
                    required
                    placeholder="Contoh: SIMJA/2024/001"
                  />
                </div>

                <div>
                  <Label htmlFor="sika_number">Nomor SIKA</Label>
                  <Input
                    id="sika_number"
                    name="sika_number"
                    type="text"
                    value={formData.sika_number || ''}
                    onChange={handleChange}
                    required
                    placeholder="Contoh: SIKA/2024/001"
                  />
                </div>

                <div>
                  <Label htmlFor="simja_date">Tanggal SIMJA</Label>
                  <DatePicker
                    id="simja_date"
                    name="simja_date"
                    value={formData.simja_date || ''}
                    onChange={handleDateChange('simja_date')}
                    placeholder="Pilih tanggal SIMJA"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="sika_date">Tanggal SIKA</Label>
                  <DatePicker
                    id="sika_date"
                    name="sika_date"
                    value={formData.sika_date || ''}
                    onChange={handleDateChange('sika_date')}
                    placeholder="Pilih tanggal SIKA"
                    required
                  />
                </div>

                {/* File Upload Areas */}
                <div className="space-y-2">
                  <Label htmlFor="simja_document_upload">UPLOAD DOKUMEN SIMJA</Label>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <EnhancedFileUpload
                      id="simja_document_upload"
                      name="simja_document_upload"
                      value={formData.simja_document_upload || ''}
                      onChange={handleFileUpload('simja_document_upload')}
                      uploadType="document"
                      label=""
                      description="Upload dokumen SIMJA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB"
                      required
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="sika_document_upload">UPLOAD DOKUMEN SIKA</Label>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <EnhancedFileUpload
                      id="sika_document_upload"
                      name="sika_document_upload"
                      value={formData.sika_document_upload || ''}
                      onChange={handleFileUpload('sika_document_upload')}
                      uploadType="document"
                      required
                      label=""
                      description="Upload dokumen SIKA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB"
                    />
                  </div>
                </div>
              </div>
            </div>

            {/* Informasi Pekerjaan */}
            <div className="p-6 rounded-lg">
              <h2 className="text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2">Informasi Pekerjaan</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                     <Label htmlFor="job_description">Pekerjaan</Label>
                  <Input
                    id="job_description"
                    name="job_description"
                    type="text"
                    value={formData.job_description}
                    onChange={handleChange}
                    required
                    placeholder="Contoh: Instalasi dan pemeliharaan peralatan"
                  />
                </div>

                <div>
                     <Label htmlFor="work_location">Lokasi Kerja</Label>
                  <Input
                    id="work_location"
                    name="work_location"
                    type="text"
                    value={formData.work_location}
                    onChange={handleChange}
                    required
                    placeholder="Contoh: Area Produksi Unit 1, Kilang Cilacap"
                  />
                </div>

                <div>
                  <Label htmlFor="working_hours">Jam kerja</Label>
                  <TimePicker
                    id="working_hours"
                    name="working_hours"
                    value={formData.working_hours}
                    onChange={handleTimeChange}
                    required
                    placeholder="Pilih jam kerja"
                  />
                </div>

                <div>
                  <Label htmlFor="work_facilities">Sarana kerja</Label>
                  <Input
                    id="work_facilities"
                    name="work_facilities"
                    value={formData.work_facilities}
                    onChange={handleChange}
                    placeholder="Contoh: Toolkit lengkap, APD standar, crane mobile"
                    required
                  />
                </div>
              </div>
            </div>



            {/* Daftar nama pekerja */}
            <div className="p-6 rounded-lg">
              <div className="flex justify-between items-center mb-6 border-b border-gray-300 ">
                <div className='flex justify-between'>
                  <h2 className="text-lg font-semibold text-gray-900 pb-2">Daftar Nama Pekerja</h2>
                  {/* <p className="text-sm text-gray-500 mt-2">Total: {workers.length} pekerja</p> */}
                </div>
               
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                  <Label htmlFor="worker_count">Jumlah Pekerja</Label>
                  <Input
                    id="worker_count"
                    name="worker_count"
                    type="number"
                    min="1"
                    max="100"
                    value={formData.worker_count || ''}
                    onChange={handleChange}
                    placeholder="Masukkan jumlah pekerja"
                    required
                  />
                  <p className="text-sm text-gray-500 mt-1">
                    Jumlah total pekerja yang akan bekerja di lokasi ini
                  </p>
                </div>
                <div className="flex items-end">
                  <div className="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                    <div className="font-medium mb-1">Info:</div>
                    <div>Pekerja yang diinput: {workers.length}</div>
                    <div>Jumlah pekerja: {formData.worker_count || 0}</div>
                    {formData.worker_count && workers.length !== Number(formData.worker_count) && (
                      <div className="text-orange-600 mt-1">
                        ⚠️ Jumlah tidak sesuai dengan daftar pekerja
                      </div>
                    )}
                  </div>
                </div>
              </div>
              {/* Workers Grid */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {workers.map((worker, _index) => (
                  <div key={worker.id} className="bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-3">
                      <div className="flex items-center gap-2">
                        {/* <div className="bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium">
                          {index + 1}
                        </div>
                        <span className="text-sm font-medium text-gray-700">Pekerja {index + 1}</span> */}
                      </div>
                      {workers.length > 1 && (
                        <Button
                          type="button"
                          onClick={() => removeWorker(worker.id)}
                          variant="outline"
                          className="text-red-500 hover:bg-red-50 border-red-200 w-8 h-8 p-0 rounded-full"
                          title="Hapus pekerja"
                        >
                          ✕
                        </Button>
                      )}
                    </div>
                    
                    {/* Photo Preview */}
                    <div className="mb-4">

                      <div className="relative">
                        {worker.worker_photo ? (
                          <div className="relative group">
                            <img 
                              src={worker.worker_photo} 
                              alt={`Foto ${worker.worker_name || 'pekerja'}`}
                              className="w-full h-50 object-cover rounded-lg border-2 border-gray-300"
                            />
                            <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center">
                              <Button
                                type="button"
                                variant="outline"
                                onClick={() => document.getElementById(`worker_photo_${worker.id}`)?.click()}
                                className="bg-white text-gray-800 hover:bg-gray-100 text-xs px-3 py-1"
                              >
                                Ganti Foto
                              </Button>
                            </div>
                            <button
                              type="button"
                              onClick={() => updateWorkerPhoto(worker.id, '')}
                              className="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600"
                              title="Hapus foto"
                            >
                              ✕
                            </button>
                          </div>
                        ) : (
                          <div className="w-full h-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center bg-gray-50">
                            <EnhancedFileUpload
                              id={`worker_photo_${worker.id}`}
                              name={`worker_photo_${worker.id}`}
                              value={worker.worker_photo}
                              onChange={(url) => updateWorkerPhoto(worker.id, url)}
                              uploadType="worker-photo"
                              workerName={worker.worker_name || `Pekerja ${worker.id}`}
                              required={false}
                            />
                          </div>
                        )}
                      </div>
                    </div>
                    
                    {/* Name Input */}
                    <div>
                      <Input
                        id={`worker_name_${worker.id}`}
                        name={`worker_name_${worker.id}`}
                        type="text"
                        value={worker.worker_name}
                        onChange={(e) => updateWorkerName(worker.id, e.target.value)}
                        required
                        placeholder="Masukkan nama lengkap"
                      />
                    </div>
                    
                    {/* Status Indicator */}
                    <div className="mt-3 flex items-center gap-2">
                      <div className={`w-2 h-2 rounded-full ${
                        worker.worker_name.trim() && worker.worker_photo.trim()
                          ? 'bg-green-400' 
                          : 'bg-red-400'
                      }`}></div>
                      <span className={`text-xs ${
                        worker.worker_name.trim() && worker.worker_photo.trim()
                          ? 'text-green-600' 
                          : 'text-red-600'
                      }`}>
                        {worker.worker_name.trim() && worker.worker_photo.trim()
                          ? 'Lengkap' 
                          : worker.worker_name.trim() 
                            ? 'Perlu foto' 
                            : 'Belum lengkap'}
                      </span>
                    </div>
                  </div>
                ))}
                
                {/* Add New Worker Card */}
                <div 
                  onClick={addWorker}
                  className="border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex flex-col items-center justify-center min-h-[280px] text-gray-500 hover:text-blue-600"
                >
                  <div className="text-4xl mb-2">➕</div>
                  <p className="text-sm font-medium">Tambah Pekerja Baru</p>
                  <p className="text-xs mt-1">Klik untuk menambah</p>
                </div>
              </div>
            
            </div>

            <div className="flex justify-end space-x-4">
              <Button
                type="button"
                variant="outline"
                onClick={() => router.back()}
              >
                Batal
              </Button>
              <Button
                type="submit"
                disabled={isLoading}
              >
                {isLoading ? 'Menyimpan...' : 'Buat Pengajuan'}
              </Button>
            </div>
          </form>
        </div>
      </Card>

      {/* Alert */}
      {alert && (
        <Alert
          variant={alert.variant}
          title={alert.title}
          message={alert.message}
        />
      )}
    </div>
  );
}


=== FILE: src/components/ui/ActivityList.tsx ===
"use client";
export function ActivityList({
  items,
}: {
  items: { id: number; txt: string; time: string }[];
}) {
  return (
    <ul className="space-y-3">
      {items.map((act) => (
        <li key={act.id} className="text-sm">
          <p className="text-slate-900">{act.txt}</p>
          <p className="text-xs text-slate-500">{act.time}</p>
        </li>
      ))}
    </ul>
  );
}

=== FILE: src/components/ui/Badge.tsx ===
"use client";

interface BadgeProps {
  children: React.ReactNode;
  variant?: "default" | "success" | "warning" | "destructive";
}

export function Badge({ children, variant = "default" }: BadgeProps) {
  const variantClasses = {
    default: "border-slate-200 bg-slate-50 text-slate-700",
    success: "border-emerald-200 bg-emerald-50 text-emerald-700",
    warning: "border-amber-200 bg-amber-50 text-amber-700",
    destructive: "border-red-200 bg-red-50 text-red-700",
  };

  // Force red styling with inline styles for destructive variant
  const inlineStyle = variant === 'destructive' ? {
    borderColor: '#ef4444 !important',
    backgroundColor: '#ef4444 !important',
    color: '#ffffff !important',
    fontWeight: '600'
  } : {};

  return (
    <span 
      className={`inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium ${variantClasses[variant]}`}
      style={inlineStyle}
    >
      {children}
    </span>
  );
}

=== FILE: src/components/ui/Card.tsx ===
"use client";
import type { ReactNode } from "react";

export default function Card({
  children,
  className = "",
}: {
  children: ReactNode;
  className?: string;
}) {
  return (
    <div
      className={`rounded-2xl border border-slate-200/70 bg-white shadow-sm ${className}`}
    >
      {children}
    </div>
  );
}

=== FILE: src/components/ui/LoadingSpinner.tsx ===
'use client';

interface LoadingSpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

export default function LoadingSpinner({ size = 'md', className = '' }: LoadingSpinnerProps) {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6',
    lg: 'w-8 h-8'
  };

  return (
    <div
      className={`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${sizeClasses[size]} ${className}`}
      role="status"
      aria-label="Loading"
    >
      <span className="sr-only">Loading...</span>
    </div>
  );
}


=== FILE: src/components/ui/PageLoader.tsx ===
'use client';

import LoadingSpinner from './LoadingSpinner';

interface PageLoaderProps {
  message?: string;
  size?: 'sm' | 'md' | 'lg';
  fullScreen?: boolean;
  className?: string;
}

export default function PageLoader({ 
  message = "Memuat...", 
  size = 'lg',
  fullScreen = true,
  className = ''
}: PageLoaderProps) {
  const containerClass = fullScreen 
    ? "min-h-screen bg-gray-50 flex items-center justify-center"
    : "flex items-center justify-center py-12";

  return (
    <div className={`${containerClass} ${className}`}>
      <div className="text-center">
        <LoadingSpinner size={size} />
        <p className="text-gray-600 mt-3 text-sm font-medium">{message}</p>
      </div>
    </div>
  );
}

=== FILE: src/components/ui/SectionTitle.tsx ===
"use client";
import type { ReactNode } from "react";

export function SectionTitle({ children, right }: { children: ReactNode; right?: ReactNode }) {
  return (
    <div className="mb-4 flex items-center justify-between gap-3">
      <h2 className="text-lg font-semibold text-slate-900">{children}</h2>
      {right}
    </div>
  );
}

=== FILE: src/components/ui/Stat.tsx ===
"use client";
import type { ComponentType } from "react";

export function Stat({
  label,
  value,
  icon: Icon,
}: {
  label: string;
  value: string | number;
  icon?: ComponentType<{ className?: string }>;
}) {
  return (
    <div className="rounded-2xl border border-sky-200/50 bg-sky-50/60 p-5 shadow-sm">
      <div className="flex items-start justify-between">
        <p className="text-sm text-slate-600">{label}</p>
        {Icon && <Icon className="h-5 w-5 text-slate-400" />}
      </div>
      <p className="mt-1 text-2xl font-bold text-slate-900">{value}</p>
    </div>
  );
}

=== FILE: src/components/ui/StatsCardsLoader.tsx ===
'use client';

interface StatsCardsLoaderProps {
  count?: number;
}

export default function StatsCardsLoader({ count = 4 }: StatsCardsLoaderProps) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      {Array.from({ length: count }).map((_, i) => (
        <div key={i} className="bg-white p-6 rounded-xl border shadow-sm animate-pulse">
          <div className="flex items-center justify-between">
            <div className="space-y-3">
              <div className="h-4 bg-gray-200 rounded w-24"></div>
              <div className="h-8 bg-gray-200 rounded w-16"></div>
            </div>
            <div className="w-12 h-12 bg-gray-200 rounded-full"></div>
          </div>
        </div>
      ))}
    </div>
  );
}

=== FILE: src/components/ui/TableLoader.tsx ===
'use client';

interface TableLoaderProps {
  rows?: number;
  columns?: number;
  showHeader?: boolean;
}

export default function TableLoader({ 
  rows = 5, 
  columns = 4,
  showHeader = true 
}: TableLoaderProps) {
  return (
    <div className="animate-pulse">
      {/* Header skeleton */}
      {showHeader && (
        <div className="bg-gray-50 p-4 border-b">
          <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>
            {Array.from({ length: columns }).map((_, i) => (
              <div key={i} className="h-4 bg-gray-200 rounded w-3/4"></div>
            ))}
          </div>
        </div>
      )}
      
      {/* Rows skeleton */}
      <div className="divide-y divide-gray-200">
        {Array.from({ length: rows }).map((_, i) => (
          <div key={i} className="p-4">
            <div className="grid gap-4 items-center" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>
              {Array.from({ length: columns }).map((_, j) => (
                <div key={j} className="space-y-2">
                  <div className="h-4 bg-gray-200 rounded w-full"></div>
                  {j === 0 && <div className="h-3 bg-gray-200 rounded w-2/3"></div>}
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

=== FILE: src/components/ui/alert/Alert.tsx ===
import Link from "next/link";
import React from "react";

interface AlertProps {
  variant: "success" | "error" | "warning" | "info"; // Alert type
  title: string; // Title of the alert
  message: string; // Message of the alert
  showLink?: boolean; // Whether to show the "Learn More" link
  linkHref?: string; // Link URL
  linkText?: string; // Link text
  className?: string; // Additional CSS classes
}

const Alert: React.FC<AlertProps> = ({
  variant,
  title,
  message,
  showLink = false,
  linkHref = "#",
  linkText = "Learn more",
  className = "",
}) => {
  // Tailwind classes for each variant
  const variantClasses = {
    success: {
      container:
        "border-success-500 bg-success-50",
      icon: "text-success-500",
    },
    error: {
      container:
        "border-error-500 bg-error-50",
      icon: "text-error-500",
    },
    warning: {
      container:
        "border-warning-500 bg-warning-50",
      icon: "text-warning-500",
    },
    info: {
      container:
        "border-blue-light-500 bg-blue-light-50",
      icon: "text-blue-light-500",
    },
  };

  // Icon for each variant
  const icons = {
    success: (
      <svg
        className="fill-current"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M3.70186 12.0001C3.70186 7.41711 7.41711 3.70186 12.0001 3.70186C16.5831 3.70186 20.2984 7.41711 20.2984 12.0001C20.2984 16.5831 16.5831 20.2984 12.0001 20.2984C7.41711 20.2984 3.70186 16.5831 3.70186 12.0001ZM12.0001 1.90186C6.423 1.90186 1.90186 6.423 1.90186 12.0001C1.90186 17.5772 6.423 22.0984 12.0001 22.0984C17.5772 22.0984 22.0984 17.5772 22.0984 12.0001C22.0984 6.423 17.5772 1.90186 12.0001 1.90186ZM15.6197 10.7395C15.9712 10.388 15.9712 9.81819 15.6197 9.46672C15.2683 9.11525 14.6984 9.11525 14.347 9.46672L11.1894 12.6243L9.6533 11.0883C9.30183 10.7368 8.73198 10.7368 8.38051 11.0883C8.02904 11.4397 8.02904 12.0096 8.38051 12.3611L10.553 14.5335C10.7217 14.7023 10.9507 14.7971 11.1894 14.7971C11.428 14.7971 11.657 14.7023 11.8257 14.5335L15.6197 10.7395Z"
        />
      </svg>
    ),
    error: (
      <svg
        className="fill-current"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M20.3499 12.0004C20.3499 16.612 16.6115 20.3504 11.9999 20.3504C7.38832 20.3504 3.6499 16.612 3.6499 12.0004C3.6499 7.38881 7.38833 3.65039 11.9999 3.65039C16.6115 3.65039 20.3499 7.38881 20.3499 12.0004ZM11.9999 22.1504C17.6056 22.1504 22.1499 17.6061 22.1499 12.0004C22.1499 6.3947 17.6056 1.85039 11.9999 1.85039C6.39421 1.85039 1.8499 6.3947 1.8499 12.0004C1.8499 17.6061 6.39421 22.1504 11.9999 22.1504ZM13.0008 16.4753C13.0008 15.923 12.5531 15.4753 12.0008 15.4753L11.9998 15.4753C11.4475 15.4753 10.9998 15.923 10.9998 16.4753C10.9998 17.0276 11.4475 17.4753 11.9998 17.4753L12.0008 17.4753C12.5531 17.4753 13.0008 17.0276 13.0008 16.4753ZM11.9998 6.62898C12.414 6.62898 12.7498 6.96476 12.7498 7.37898L12.7498 13.0555C12.7498 13.4697 12.414 13.8055 11.9998 13.8055C11.5856 13.8055 11.2498 13.4697 11.2498 13.0555L11.2498 7.37898C11.2498 6.96476 11.5856 6.62898 11.9998 6.62898Z"
          fill="#F04438"
        />
      </svg>
    ),
    warning: (
      <svg
        className="fill-current"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M3.6501 12.0001C3.6501 7.38852 7.38852 3.6501 12.0001 3.6501C16.6117 3.6501 20.3501 7.38852 20.3501 12.0001C20.3501 16.6117 16.6117 20.3501 12.0001 20.3501C7.38852 20.3501 3.6501 16.6117 3.6501 12.0001ZM12.0001 1.8501C6.39441 1.8501 1.8501 6.39441 1.8501 12.0001C1.8501 17.6058 6.39441 22.1501 12.0001 22.1501C17.6058 22.1501 22.1501 17.6058 22.1501 12.0001C22.1501 6.39441 17.6058 1.8501 12.0001 1.8501ZM10.9992 7.52517C10.9992 8.07746 11.4469 8.52517 11.9992 8.52517H12.0002C12.5525 8.52517 13.0002 8.07746 13.0002 7.52517C13.0002 6.97289 12.5525 6.52517 12.0002 6.52517H11.9992C11.4469 6.52517 10.9992 6.97289 10.9992 7.52517ZM12.0002 17.3715C11.586 17.3715 11.2502 17.0357 11.2502 16.6215V10.945C11.2502 10.5308 11.586 10.195 12.0002 10.195C12.4144 10.195 12.7502 10.5308 12.7502 10.945V16.6215C12.7502 17.0357 12.4144 17.3715 12.0002 17.3715Z"
          fill=""
        />
      </svg>
    ),
    info: (
      <svg
        className="fill-current"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M3.6501 11.9996C3.6501 7.38803 7.38852 3.64961 12.0001 3.64961C16.6117 3.64961 20.3501 7.38803 20.3501 11.9996C20.3501 16.6112 16.6117 20.3496 12.0001 20.3496C7.38852 20.3496 3.6501 16.6112 3.6501 11.9996ZM12.0001 1.84961C6.39441 1.84961 1.8501 6.39392 1.8501 11.9996C1.8501 17.6053 6.39441 22.1496 12.0001 22.1496C17.6058 22.1496 22.1501 17.6053 22.1501 11.9996C22.1501 6.39392 17.6058 1.84961 12.0001 1.84961ZM10.9992 7.52468C10.9992 8.07697 11.4469 8.52468 11.9992 8.52468H12.0002C12.5525 8.52468 13.0002 8.07697 13.0002 7.52468C13.0002 6.9724 12.5525 6.52468 12.0002 6.52468H11.9992C11.4469 6.52468 10.9992 6.9724 10.9992 7.52468ZM12.0002 17.371C11.586 17.371 11.2502 17.0352 11.2502 16.621V10.9445C11.2502 10.5303 11.586 10.1945 12.0002 10.1945C12.4144 10.1945 12.7502 10.5303 12.7502 10.9445V16.621C12.7502 17.0352 12.4144 17.371 12.0002 17.371Z"
          fill=""
        />
      </svg>
    ),
  };

  return (
    <div
      className={`rounded-xl border p-4 ${variantClasses[variant].container} ${className}`}
    >
      <div className="flex items-start gap-3">
        <div className={`-mt-0.5 ${variantClasses[variant].icon}`}>
          {icons[variant]}
        </div>

        <div className="flex-1">
          <h4 className="mb-1 text-sm font-semibold text-gray-800">
            {title}
          </h4>

          <p className="text-sm text-gray-500">{message}</p>

          {showLink && (
            <Link
              href={linkHref}
              className="inline-block mt-3 text-sm font-medium text-gray-500 underline"
            >
              {linkText}
            </Link>
          )}
        </div>
      </div>
    </div>
  );
};

export default Alert;


=== FILE: src/components/ui/button/Button.tsx ===
import React, { ReactNode } from "react";

interface ButtonProps {
  children: ReactNode; // Button text or content
  size?: "sm" | "md" | "lg"; // Button size
  variant?: "primary" | "secondary" | "outline" | "ghost" | "destructive" | "success" | "warning" | "info"; // Button variant
  startIcon?: ReactNode; // Icon before the text
  endIcon?: ReactNode; // Icon after the text
  onClick?: ((e?: any) => void) | (() => void); // Click handler
  disabled?: boolean; // Disabled state
  className?: string; // Additional classes
  type?: "button" | "submit" | "reset"; // Button type
  title?: string; // Tooltip text
}

const Button: React.FC<ButtonProps> = ({
  children,
  size = "md",
  variant = "primary",
  startIcon,
  endIcon,
  onClick,
  className = "",
  disabled = false,
  type = "button",
  title,
}) => {
  // Size Classes
  const sizeClasses = {
    sm: "px-3 py-2 text-sm",
    md: "px-4 py-2 text-sm",
    lg: "px-6 py-3 text-base",
  };

  // Variant Classes - sesuai referensi warna yang diberikan
  const variantClasses = {
    primary:
      "bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300",
    secondary:
      "bg-gray-500 text-white shadow-sm hover:bg-gray-600 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-300",
    outline:
      "bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-100 disabled:text-gray-400",
    ghost:
      "bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:text-gray-400",
    destructive:
      "bg-red-600 text-white shadow-sm hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:bg-red-300",
    success:
      "bg-emerald-500 text-white shadow-sm hover:bg-emerald-600 focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 disabled:bg-emerald-300",
    warning:
      "bg-amber-500 text-white shadow-sm hover:bg-amber-600 focus:ring-2 focus:ring-amber-400 focus:ring-offset-2 disabled:bg-amber-300",
    info:
      "bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300",
  };

  return (
    <button
      type={type}
      title={title}
      className={`inline-flex items-center justify-center font-medium gap-2 rounded-md transition-colors duration-200 focus:outline-none ${
        sizeClasses[size]
      } ${variantClasses[variant]} ${
        disabled ? "cursor-not-allowed opacity-50" : ""
      } ${className}`}
      onClick={onClick}
      disabled={disabled}
    >
      {startIcon && <span className="flex items-center">{startIcon}</span>}
      {children}
      {endIcon && <span className="flex items-center">{endIcon}</span>}
    </button>
  );
};

export default Button;


=== FILE: src/components/ui/modal/ConfirmModal.tsx ===
'use client';

import { XMarkIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';
import Button from '../button/Button';
import LoadingSpinner from '../LoadingSpinner';

interface ConfirmModalProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  title: string;
  message: string;
  confirmText?: string;
  cancelText?: string;
  showCancel?: boolean;
  variant?: 'danger' | 'warning' | 'info';
  isLoading?: boolean;
}

export default function ConfirmModal({
  isOpen,
  onClose,
  onConfirm,
  title,
  message,
  confirmText = 'Konfirmasi',
  cancelText = 'Batal',
  showCancel = true,
  variant = 'danger',
  isLoading = false
}: ConfirmModalProps) {
  if (!isOpen) return null;

  const variantConfig = {
    danger: {
      icon: 'text-red-600',
      button: 'bg-red-600 hover:bg-red-700 border-red-600'
    },
    warning: {
      icon: 'text-amber-500',
      button: 'bg-amber-500 hover:bg-amber-600 border-amber-500'
    },
    info: {
      icon: 'text-blue-600',
      button: 'bg-blue-600 hover:bg-blue-700 border-blue-600'
    }
  };

  const config = variantConfig[variant];

  return (
    <div className="fixed inset-0 z-50 overflow-y-auto">
      {/* Backdrop */}
      <div
        className="fixed inset-0 bg-black/30 transition-opacity"
        onClick={onClose}
      />

      {/* Modal */}
      <div className="flex min-h-full items-center justify-center p-4">
        <div className="relative bg-white rounded-lg shadow-xl max-w-md w-full">
          {/* Header */}
          <div className="flex items-start justify-between p-6 border-b border-gray-200">
            <div className="flex items-center">
              <ExclamationTriangleIcon className={`w-6 h-6 ${config.icon} mr-2`} />
              <h3 className="text-lg font-medium text-gray-900">{title}</h3>
            </div>
            {showCancel && (
              <button
                onClick={onClose}
                disabled={isLoading}
                className="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 disabled:opacity-50"
              >
                <XMarkIcon className="h-5 w-5" />
              </button>
            )}
          </div>

          {/* Content */}
          <div className="p-6">
            <p className="text-sm text-gray-600 mb-6">{message}</p>

            {/* Buttons */}
            <div className="flex justify-end space-x-3">
              {showCancel && (
                <Button
                  type="button"
                  onClick={onClose}
                  disabled={isLoading}
                  variant="outline"
                >
                  {cancelText}
                </Button>
              )}
              <Button
                type="button"
                onClick={onConfirm}
                disabled={isLoading}
                className={`text-white ${config.button} focus:ring-2 focus:ring-offset-2`}
              >
                {isLoading ? (
                  <div className="flex items-center">
                    <LoadingSpinner size="sm" className="mr-2" />
                    Loading...
                  </div>
                ) : (
                  confirmText
                )}
              </Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}


=== FILE: src/components/ui/modal.tsx ===
"use client";
import React from "react";
import { cn } from "@/lib/utils";

type ModalProps = {
  children: React.ReactNode;
  isOpen: boolean;
  onClose: () => void;
  className?: string;
};

export const Modal: React.FC<ModalProps> = ({
  children,
  isOpen,
  onClose,
  className,
}) => {
  if (!isOpen) return null;

  return (
    <>
      <div
        className="fixed inset-0 z-[99] bg-black/50 backdrop-blur-sm"
        onClick={onClose}
      />
      <div
        className={cn(
          "fixed left-1/2 top-1/2 z-[999] -translate-x-1/2 -translate-y-1/2",
          className
        )}
      >
        {children}
      </div>
    </>
  );
};

=== FILE: src/components/ui/toast/Toast.tsx ===
'use client';

import { useEffect, useState } from 'react';
import { XMarkIcon, CheckCircleIcon, ExclamationCircleIcon, InformationCircleIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';

export interface ToastProps {
  id: string;
  variant: 'success' | 'error' | 'warning' | 'info';
  title: string;
  message: string;
  duration?: number;
  onClose: (id: string) => void;
}

export default function Toast({ 
  id, 
  variant, 
  title, 
  message, 
  duration = 5000, 
  onClose 
}: ToastProps) {
  const [isVisible, setIsVisible] = useState(false);
  const [isExiting, setIsExiting] = useState(false);

  useEffect(() => {
    // Show animation
    setIsVisible(true);

    // Auto-hide timer
    const timer = setTimeout(() => {
      handleClose();
    }, duration);

    return () => clearTimeout(timer);
  }, [duration]);

  const handleClose = () => {
    setIsExiting(true);
    setTimeout(() => {
      onClose(id);
    }, 300); // Wait for exit animation
  };

  const variantConfig = {
    success: {
      bgColor: 'bg-emerald-50 border-emerald-200',
      iconColor: 'text-emerald-500',
      titleColor: 'text-emerald-800',
      messageColor: 'text-emerald-700',
      icon: CheckCircleIcon
    },
    error: {
      bgColor: 'bg-red-50 border-red-200',
      iconColor: 'text-red-500',
      titleColor: 'text-red-800',
      messageColor: 'text-red-700',
      icon: ExclamationCircleIcon
    },
    warning: {
      bgColor: 'bg-amber-50 border-amber-200',
      iconColor: 'text-amber-500',
      titleColor: 'text-amber-800',
      messageColor: 'text-amber-700',
      icon: ExclamationTriangleIcon
    },
    info: {
      bgColor: 'bg-blue-50 border-blue-200',
      iconColor: 'text-blue-500',
      titleColor: 'text-blue-800',
      messageColor: 'text-blue-700',
      icon: InformationCircleIcon
    }
  };

  const config = variantConfig[variant];
  const IconComponent = config.icon;

  return (
    <div
      className={`
        pointer-events-auto w-full overflow-hidden rounded-lg border shadow-lg
        ${config.bgColor}
        transform transition-all duration-300 ease-in-out
        ${isVisible && !isExiting 
          ? 'translate-x-0 opacity-100' 
          : 'translate-x-full opacity-0'
        }
      `}
      style={{ minWidth: '320px', maxWidth: '400px' }}
    >
      <div className="p-4">
        <div className="flex items-start">
          <div className="flex-shrink-0">
            <IconComponent className={`h-6 w-6 ${config.iconColor}`} />
          </div>
          <div className="ml-3 flex-1 min-w-0">
            <p className={`text-sm font-medium ${config.titleColor} break-words`}>
              {title}
            </p>
            <p className={`mt-1 text-sm ${config.messageColor} break-words`}>
              {message}
            </p>
          </div>
          <div className="ml-4 flex flex-shrink-0">
            <button
              type="button"
              className={`
                inline-flex rounded-md p-1.5 transition-colors duration-200
                ${config.iconColor} hover:bg-black/5 focus:outline-none focus:ring-2 focus:ring-offset-2
              `}
              onClick={handleClose}
            >
              <span className="sr-only">Dismiss</span>
              <XMarkIcon className="h-5 w-5" />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}


=== FILE: src/components/ui/toast/ToastContainer.tsx ===
'use client';

import { useState, useCallback } from 'react';
import Toast from './Toast';

interface ToastData {
  id: string;
  variant: 'success' | 'error' | 'warning' | 'info';
  title: string;
  message: string;
  duration?: number;
}

export interface ToastContextType {
  addToast: (toast: Omit<ToastData, 'id'>) => void;
  removeToast: (id: string) => void;
}

export default function ToastContainer() {
  const [toasts, setToasts] = useState<ToastData[]>([]);

  const removeToast = useCallback((id: string) => {
    setToasts(prev => prev.filter(toast => toast.id !== id));
  }, []);

  const addToast = useCallback((toast: Omit<ToastData, 'id'>) => {
    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
    setToasts(prev => [...prev, { ...toast, id }]);
  }, []);

  // Expose methods globally for easy access
  if (typeof window !== 'undefined') {
    (window as any).showToast = addToast;
  }

  return (
    <div
      className="fixed top-4 right-4 z-[9999] flex flex-col space-y-2 pointer-events-none max-w-sm w-full"
      style={{ zIndex: 9999 }}
    >
      {toasts.map((toast) => (
        <Toast
          key={toast.id}
          id={toast.id}
          variant={toast.variant}
          title={toast.title}
          message={toast.message}
          duration={toast.duration || 5000}
          onClose={removeToast}
        />
      ))}
    </div>
  );
}


=== FILE: src/components/user-profile/ChangePasswordCard.tsx ===
"use client";
import React, { useState } from "react";
import { useModal } from "@/hooks/useModal";
import { Modal } from "@/components/ui/modal";
import Button from "@/components/ui/button/Button";
import Input from "@/components/form/input/InputField";
import Label from "@/components/form/Label";
import { useToast } from "@/hooks/useToast";

export default function ChangePasswordCard() {
  const { isOpen, openModal, closeModal } = useModal();
  const { showSuccess, showError } = useToast();
  const [passwords, setPasswords] = useState({
    currentPassword: "",
    newPassword: "",
    confirmPassword: "",
  });
  const [errors, setErrors] = useState({
    currentPassword: "",
    newPassword: "",
    confirmPassword: "",
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setPasswords((prev) => ({
      ...prev,
      [name]: value,
    }));
    // Clear error when user starts typing
    setErrors((prev) => ({
      ...prev,
      [name]: "",
    }));
  };

  const validatePasswords = () => {
    let isValid = true;
    const newErrors = {
      currentPassword: "",
      newPassword: "",
      confirmPassword: "",
    };

    if (!passwords.currentPassword) {
      newErrors.currentPassword = "Password saat ini wajib diisi";
      isValid = false;
    }

    if (!passwords.newPassword) {
      newErrors.newPassword = "Password baru wajib diisi";
      isValid = false;
    } else if (passwords.newPassword.length < 8) {
      newErrors.newPassword = "Password minimal 8 karakter";
      isValid = false;
    }

    if (!passwords.confirmPassword) {
      newErrors.confirmPassword = "Silakan konfirmasi password baru Anda";
      isValid = false;
    } else if (passwords.newPassword !== passwords.confirmPassword) {
      newErrors.confirmPassword = "Password tidak cocok";
      isValid = false;
    }

    setErrors(newErrors);
    return isValid;
  };

  const handleSave = async () => {
    if (validatePasswords()) {
      try {
        const response = await fetch("/api/user/change-password", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            currentPassword: passwords.currentPassword,
            newPassword: passwords.newPassword,
          }),
        });

        if (!response.ok) {
          const error = await response.text();
          throw new Error(error);
        }

        // Reset form and close modal on success
        closeModal();
        setPasswords({
          currentPassword: "",
          newPassword: "",
          confirmPassword: "",
        });
        
        // Show success message
        showSuccess('Berhasil', 'Password berhasil diubah');
        closeModal();
      } catch (error) {
        console.error("Error changing password:", error);
        showError('Error', error instanceof Error ? error.message : "Gagal mengubah password");
        setErrors((prev) => ({
          ...prev,
          currentPassword: error instanceof Error ? error.message : "Gagal mengubah password",
        }));
      }
    }
  };

  return (
    <div className="p-5 border border-gray-200 rounded-2xl lg:p-6">
      <div className="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
        <div>
          <h4 className="text-lg font-semibold text-gray-800 lg:mb-2">
            Pengaturan Password
          </h4>
          <p className="text-sm text-gray-500">
            Ubah password Anda untuk menjaga keamanan akun
          </p>
        </div>

        <button
          onClick={openModal}
          className="flex w-full items-center justify-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-xs hover:bg-gray-50 hover:text-gray-800 lg:inline-flex lg:w-auto"
        >
          Ubah Password
        </button>
      </div>

      <Modal isOpen={isOpen} onClose={closeModal} className="max-w-[500px] m-4">
        <div className="no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 lg:p-8">
          <div className="pr-14">
            <h4 className="mb-2 text-2xl font-semibold text-gray-800">
              Ubah Password
            </h4>
            <p className="mb-6 text-sm text-gray-500">
              Silakan masukkan password saat ini dan pilih password baru.
            </p>
          </div>
          <form className="flex flex-col gap-5">
            <div>
              <Label>Password Saat Ini</Label>
              <Input
                type="password"
                name="currentPassword"
                value={passwords.currentPassword}
                onChange={handleChange}
                error={errors.currentPassword}
              />
            </div>

            <div>
              <Label>Password Baru</Label>
              <Input
                type="password"
                name="newPassword"
                value={passwords.newPassword}
                onChange={handleChange}
                error={errors.newPassword}
              />
            </div>

            <div>
              <Label>Konfirmasi Password Baru</Label>
              <Input
                type="password"
                name="confirmPassword"
                value={passwords.confirmPassword}
                onChange={handleChange}
                error={errors.confirmPassword}
              />
            </div>

            <div className="flex items-center gap-3 mt-6 lg:justify-end">
              <Button size="sm" variant="outline" onClick={closeModal}>
                Batal
              </Button>
              <Button size="sm" onClick={handleSave}>
                Perbarui Password
              </Button>
            </div>
          </form>
        </div>
      </Modal>
    </div>
  );
}

=== FILE: src/components/user-profile/UserAddressCard.tsx ===
"use client";
import React from "react";
import { useModal } from "../../hooks/useModal";
import { Modal } from "../ui/modal";
import Button from "../ui/button/Button";
import Input from "../form/input/InputField";
import Label from "../form/Label";

export default function UserAddressCard() {
  const { isOpen, openModal, closeModal } = useModal();
  const handleSave = () => {
    // Handle save logic here
    console.log("Saving changes...");
    closeModal();
  };
  return (
    <>
      <div className="p-5 border border-gray-200 rounded-2xl lg:p-6">
        <div className="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
          <div>
            <h4 className="text-lg font-semibold text-gray-800 lg:mb-6">
              Address
            </h4>

            <div className="grid grid-cols-1 gap-4 lg:grid-cols-2 lg:gap-7 2xl:gap-x-32">
              <div>
                <p className="mb-2 text-xs leading-normal text-gray-500">
                  Country
                </p>
                <p className="text-sm font-medium text-gray-800">
                  United States
                </p>
              </div>

              <div>
                <p className="mb-2 text-xs leading-normal text-gray-500">
                  City/State
                </p>
                <p className="text-sm font-medium text-gray-800">
                  Phoenix, Arizona, United States.
                </p>
              </div>

              <div>
                <p className="mb-2 text-xs leading-normal text-gray-500">
                  Postal Code
                </p>
                <p className="text-sm font-medium text-gray-800">
                  ERT 2489
                </p>
              </div>

              <div>
                <p className="mb-2 text-xs leading-normal text-gray-500">
                  TAX ID
                </p>
                <p className="text-sm font-medium text-gray-800">
                  AS4568384
                </p>
              </div>
            </div>
          </div>

          <button
            onClick={openModal}
            className="flex w-full items-center justify-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 lg:inline-flex lg:w-auto"
          >
            <svg
              className="fill-current"
              width="18"
              height="18"
              viewBox="0 0 18 18"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M15.0911 2.78206C14.2125 1.90338 12.7878 1.90338 11.9092 2.78206L4.57524 10.116C4.26682 10.4244 4.0547 10.8158 3.96468 11.2426L3.31231 14.3352C3.25997 14.5833 3.33653 14.841 3.51583 15.0203C3.69512 15.1996 3.95286 15.2761 4.20096 15.2238L7.29355 14.5714C7.72031 14.4814 8.11172 14.2693 8.42013 13.9609L15.7541 6.62695C16.6327 5.74827 16.6327 4.32365 15.7541 3.44497L15.0911 2.78206ZM12.9698 3.84272C13.2627 3.54982 13.7376 3.54982 14.0305 3.84272L14.6934 4.50563C14.9863 4.79852 14.9863 5.2734 14.6934 5.56629L14.044 6.21573L12.3204 4.49215L12.9698 3.84272ZM11.2597 5.55281L5.6359 11.1766C5.53309 11.2794 5.46238 11.4099 5.43238 11.5522L5.01758 13.5185L6.98394 13.1037C7.1262 13.0737 7.25666 13.003 7.35947 12.9002L12.9833 7.27639L11.2597 5.55281Z"
                fill=""
              />
            </svg>
            Edit
          </button>
        </div>
      </div>
      <Modal isOpen={isOpen} onClose={closeModal} className="max-w-[700px] m-4">
        <div className="relative w-full p-4 overflow-y-auto bg-white no-scrollbar rounded-3xl lg:p-11">
          <div className="px-2 pr-14">
            <h4 className="mb-2 text-2xl font-semibold text-gray-800">
              Edit Address
            </h4>
            <p className="mb-6 text-sm text-gray-500 lg:mb-7">
              Update your details to keep your profile up-to-date.
            </p>
          </div>
          <form className="flex flex-col">
            <div className="px-2 overflow-y-auto custom-scrollbar">
              <div className="grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2">
                <div>
                  <Label>Country</Label>
                  <Input type="text" defaultValue="United States" />
                </div>

                <div>
                  <Label>City/State</Label>
                  <Input type="text" defaultValue="Arizona, United States." />
                </div>

                <div>
                  <Label>Postal Code</Label>
                  <Input type="text" defaultValue="ERT 2489" />
                </div>

                <div>
                  <Label>TAX ID</Label>
                  <Input type="text" defaultValue="AS4568384" />
                </div>
              </div>
            </div>
            <div className="flex items-center gap-3 px-2 mt-6 lg:justify-end">
              <Button size="sm" variant="outline" onClick={closeModal}>
                Close
              </Button>
              <Button size="sm" onClick={handleSave}>
                Save Changes
              </Button>
            </div>
          </form>
        </div>
      </Modal>
    </>
  );
}


=== FILE: src/components/user-profile/UserInfoCard.tsx ===
"use client";
import React, { useState } from "react";

import Input from "../form/Input";
import TextArea from "../form/textarea/TextArea";
import { useRouter } from "next/navigation";
import { useToast } from "@/hooks/useToast";

interface UserInfoCardProps {
  user: {
    id: string;
    email: string;
    officer_name: string;
    vendor_name: string | null;
    phone_number: string | null;
    address: string | null;
    role: string;
  }
}

export default function UserInfoCard({ user }: UserInfoCardProps) {
  const router = useRouter();
  const { showSuccess, showError } = useToast();
  const [isEditing, setIsEditing] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [errors, setErrors] = useState({
    officer_name: "",
    vendor_name: "",
    phone_number: "",
    address: "",
    email: ""
  });
  const [formData, setFormData] = useState({
    officer_name: user.officer_name,
    vendor_name: user.vendor_name || "",
    phone_number: user.phone_number || "",
    address: user.address || "",
    email: user.email
  });

  const validateForm = () => {
    // Validasi berdasarkan role
    if (user.role === 'VENDOR') {
      // Untuk vendor, hanya validasi vendor_name yang wajib
      return formData.vendor_name.trim();
    } else {
      // Untuk role lain (VERIFIER, ADMIN, etc), validasi semua field kecuali vendor_name
      return formData.officer_name.trim() && 
             formData.email.trim() && 
             formData.phone_number.trim() && 
             formData.address.trim();
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    
    // Validasi alamat: hanya huruf, angka, spasi, koma, titik, tanda hubung
    if (name === 'address') {
      if (/^[a-zA-Z0-9\s,./-]*$/.test(value)) {
        setFormData(prev => ({
          ...prev,
          [name]: value
        }));
      }
    } else {
      setFormData(prev => ({
        ...prev,
        [name]: value
      }));
    }
    
    // Clear error when user starts typing
    if (errors[name as keyof typeof errors]) {
      setErrors(prev => ({
        ...prev,
        [name]: ""
      }));
    }
  };

  const handleSave = async () => {
    if (!validateForm()) {
      return;
    }
    
    try {
      setIsLoading(true);
      const response = await fetch("/api/users/profile", {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(formData),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message || "Gagal memperbarui profil");
      }

      showSuccess("Berhasil", "Profil berhasil diperbarui");
      setIsEditing(false);
      router.refresh();
    } catch (error) {
      console.error("Error updating profile:", error);
      showError("Error", "Gagal memperbarui profil");
    } finally {
      setIsLoading(false);
    }
  };
  return (
    <div className="p-5 border border-gray-200 rounded-2xl lg:p-6">
      <div className="flex flex-col gap-6">
        <div className="flex items-center justify-between">
          <h4 className="text-lg font-semibold text-gray-800">
            Informasi Pribadi
          </h4>

          {!isEditing ? (
            <button
              onClick={() => setIsEditing(true)}
              className="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"
            >
              <svg
                className="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                />
              </svg>
              Ubah
            </button>
          ) : (
            <div className="flex gap-2">
              <button
                onClick={() => {
                  setFormData({
                    officer_name: user.officer_name,
                    vendor_name: user.vendor_name || "",
                    phone_number: user.phone_number || "",
                    address: user.address || "",
                    email: user.email
                  });
                  setIsEditing(false);
                }}
                className="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"
              >
                Batal
              </button>
              <button
                onClick={handleSave}
                disabled={isLoading}
                className="inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 disabled:opacity-50"
              >
                {isLoading ? "Menyimpan..." : "Simpan Perubahan"}
              </button>
            </div>
          )}
        </div>

        <div className="grid grid-cols-1 gap-6 lg:grid-cols-2">
          {/* Nama Petugas - Hide for VENDOR role */}
          {user.role !== 'VENDOR' && (
            <div>
              <p className="text-sm font-medium text-gray-500">Nama Petugas</p>
              {isEditing ? (
                <Input 
                  id="officer_name"
                  name="officer_name"
                  type="text"
                  value={formData.officer_name}
                  onChange={handleChange}
                  placeholder="Masukkan nama petugas"
                  required
                  className="mt-1"
                />
              ) : (
                <p className="mt-1 text-base text-gray-900">{user.officer_name}</p>
              )}
            </div>
          )}

          {/* Email - Hide for VENDOR role */}
          {user.role !== 'VENDOR' && (
            <div>
              <p className="text-sm font-medium text-gray-500">Email</p>
              {isEditing ? (
                <Input 
                  id="email"
                  name="email"
                  type="email"
                  value={formData.email}
                  onChange={handleChange}
                  placeholder="email@perusahaan.com"
                  required
                  className="mt-1"
                />
              ) : (
                <p className="mt-1 text-base text-gray-900">{user.email}</p>
              )}
            </div>
          )}

          {/* Nomor Telepon - Hide for VENDOR role */}
          {user.role !== 'VENDOR' && (
            <div>
              <p className="text-sm font-medium text-gray-500">Nomor Telepon</p>
              {isEditing ? (
                <Input 
                  id="phone_number"
                  name="phone_number"
                  type="tel"
                  value={formData.phone_number}
                  onChange={handleChange}
                  placeholder="08123456789"
                  required
                  className="mt-1"
                />
              ) : (
                <p className="mt-1 text-base text-gray-900">{user.phone_number || "-"}</p>
              )}
            </div>
          )}

          {/* Nama Vendor - Show for VENDOR role only */}
          {user.role === "VENDOR" && (
            <div className="lg:col-span-2">
              <p className="text-sm font-medium text-gray-500">Nama Vendor</p>
              {isEditing ? (
                <Input 
                  id="vendor_name"
                  name="vendor_name"
                  type="text"
                  value={formData.vendor_name}
                  onChange={handleChange}
                  placeholder="PT. Nama Perusahaan"
                  required
                  className="mt-1"
                />
              ) : (
                <p className="mt-1 text-base text-gray-900">{user.vendor_name || "-"}</p>
              )}
            </div>
          )}


          {/* Alamat - Hide for VENDOR role */}
          {user.role !== 'VENDOR' && (
            <div className="lg:col-span-2">
              <p className="text-sm font-medium text-gray-500">Alamat</p>
              {isEditing ? (
                <TextArea
                  name="address"
                  value={formData.address}
                  onChange={handleChange}
                  className="mt-1"
                  rows={3}
                  error={errors.address}
                />
              ) : (
                <p className="mt-1 text-base text-gray-900 whitespace-pre-line">{user.address || "-"}</p>
              )}
            </div>
          )}

        </div>
      </div>


    </div>
  );
}


=== FILE: src/components/vendor/EditSubmissionForm.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useSession } from 'next-auth/react';
import Card from '@/components/ui/Card';
import Button from '@/components/ui/button/Button';
import Input from '@/components/form/Input';
import Label from '@/components/form/Label';
import DatePicker from '@/components/form/DatePicker';
import TimePicker from '@/components/form/TimePicker';
import FileUpload from '@/components/form/FileUpload';
import Alert from '@/components/ui/alert/Alert';
import LoadingSpinner from '@/components/ui/LoadingSpinner';
import { useToast } from '@/hooks/useToast';

// Define Worker interface for dynamic inputs
interface Worker {
  id: string;
  nama_pekerja: string;
  foto_pekerja: string;
}

interface Submission {
  id: string;
  approval_status: string;
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string | null;
  work_facilities: string;
  worker_count?: number | null;
  simja_number?: string | null;
  simja_date?: Date | null;
  sika_number?: string | null;
  sika_date?: Date | null;
  worker_names: string;
  content: string | null;
  sika_document_upload?: string | null;
  simja_document_upload?: string | null;
}

interface EditSubmissionFormProps {
  submissionId: string;
}

export default function EditSubmissionForm({ submissionId }: EditSubmissionFormProps) {
  const router = useRouter();
  const { data: session, status: _status } = useSession();
  const { showSuccess, showError } = useToast();
  const [isLoading, setIsLoading] = useState(false);
  const [isInitialLoading, setIsInitialLoading] = useState(true);
  const [alert, setAlert] = useState<{ variant: 'success' | 'error' | 'warning' | 'info', title: string, message: string } | null>(null);
  const [submission, setSubmission] = useState<Submission | null>(null);
  
  // State for dynamic workers
  const [workers, setWorkers] = useState<Worker[]>([
    { id: '1', nama_pekerja: '', foto_pekerja: '' }
  ]);
  
  // Load submission data
  useEffect(() => {
    const fetchSubmission = async () => {
      setIsInitialLoading(true);
      try {
        const response = await fetch(`/api/submissions/${submissionId}`);
        if (response.ok) {
          const data = await response.json();
          setSubmission(data);
          
          // Also fetch workers data
          const workersResponse = await fetch(`/api/submissions/${submissionId}/workers`);
          if (workersResponse.ok) {
            const workersData = await workersResponse.json();
            if (workersData.workers && workersData.workers.length > 0) {
              setWorkers(workersData.workers.map((worker: any) => ({
                id: worker.id,
                nama_pekerja: worker.worker_name || worker.nama_pekerja || '',
                foto_pekerja: worker.worker_photo || worker.foto_pekerja || ''
              })));
            }
          }
        } else {
          setAlert({
            variant: 'error',
            title: 'Error!',
            message: 'Gagal memuat data pengajuan'
          });
        }
      } catch (error) {
        console.error('Error fetching submission:', error);
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: 'Gagal memuat data pengajuan'
        });
      } finally {
        setIsInitialLoading(false);
      }
    };
    
    if (submissionId) {
      fetchSubmission();
    }
  }, [submissionId]);

  const [formData, setFormData] = useState({
    nama_vendor: '',
    berdasarkan: '',
    nama_petugas: '',
    pekerjaan: '',
    lokasi_kerja: '',
    pelaksanaan: '',
    jam_kerja: '',
    lain_lain: '',
    sarana_kerja: '',
    jumlah_pekerja: 0,
    nomor_simja: '',
    tanggal_simja: '',
    nomor_sika: '',
    tanggal_sika: '',
    nama_pekerja: '',
    content: '',
    upload_doc_sika: '',
    upload_doc_simja: '',
  });

  // Update form data when submission is loaded
  useEffect(() => {
    if (submission) {
      setFormData({
        nama_vendor: submission.vendor_name || '',
        berdasarkan: submission.based_on || '',
        nama_petugas: submission.officer_name || '',
        pekerjaan: submission.job_description || '',
        lokasi_kerja: submission.work_location || '',
        pelaksanaan: submission.implementation || '',
        jam_kerja: submission.working_hours || '',
        lain_lain: submission.other_notes || '',
        sarana_kerja: submission.work_facilities || '',
        jumlah_pekerja: submission.worker_count || 0,
        nomor_simja: submission.simja_number || '',
        tanggal_simja: submission.simja_date ? (() => {
          const date = new Date(submission.simja_date);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        })() : '',
        nomor_sika: submission.sika_number || '',
        tanggal_sika: submission.sika_date ? (() => {
          const date = new Date(submission.sika_date);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        })() : '',
        nama_pekerja: submission.worker_names || '',
        content: submission.content || '',
        upload_doc_sika: submission.sika_document_upload || '',
        upload_doc_simja: submission.simja_document_upload || '',
      });
    }
  }, [submission]);
  
  // Auto-fill form data when session is available (for readonly fields)
  useEffect(() => {
    if (session?.user && submission) {
      setFormData(prev => ({
        ...prev,
        // Keep vendor name readonly for vendors - use session data if available
        nama_vendor: session.user.vendor_name || submission.vendor_name || prev.nama_vendor || '',
      }));
    }
  }, [session, submission]);

  // Handle file upload from FileUpload component
  const handleFileUpload = (fieldName: string) => (url: string) => {
    setFormData(prev => ({
      ...prev,
      [fieldName]: url
    }));
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value, type } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'number' ? (value === '' ? 0 : Number(value)) : value
    }));
  };

  const handleDateChange = (name: string) => (value: string) => {
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleTimeChange = (value: string) => {
    setFormData(prev => ({
      ...prev,
      jam_kerja: value
    }));
  };

  // Functions for managing dynamic workers
  const addWorker = () => {
    const newWorker: Worker = {
      id: Date.now().toString(),
      nama_pekerja: '',
      foto_pekerja: ''
    };
    setWorkers(prev => [...prev, newWorker]);
  };

  const removeWorker = (id: string) => {
    if (workers.length > 1) {
      setWorkers(prev => prev.filter(worker => worker.id !== id));
    }
  };

  const updateWorkerName = (id: string, nama: string) => {
    setWorkers(prev => prev.map(worker =>
      worker.id === id ? { ...worker, nama_pekerja: nama } : worker
    ));
  };

  const updateWorkerPhoto = (id: string, foto: string) => {
    setWorkers(prev => prev.map(worker =>
      worker.id === id ? { ...worker, foto_pekerja: foto } : worker
    ));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Check if submission is loaded
    if (!submission) {
      setAlert({
        variant: 'error',
        title: 'Error!',
        message: 'Data pengajuan belum dimuat'
      });
      return;
    }
    
    // Check if submission is still editable
    if (submission.approval_status !== 'PENDING') {
      setAlert({
        variant: 'warning',
        title: 'Peringatan!',
        message: 'Tidak dapat mengubah pengajuan yang sudah diproses oleh admin.'
      });
      return;
    }
    
    // Client-side validation
    const requiredFields = [
      'nama_vendor', 'berdasarkan', 'nama_petugas', 'pekerjaan', 
      'lokasi_kerja', 'jam_kerja', 'sarana_kerja', 'nama_pekerja'
    ];

    for (const field of requiredFields) {
      const value = formData[field as keyof typeof formData];
      if (!value || (typeof value === 'string' && value.trim() === '')) {
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: `Field ${field} harus diisi!`
        });
        return;
      }
    }
    
    setIsLoading(true);

    try {
      // Validate workers
      const validWorkers = workers.filter(worker => worker.nama_pekerja.trim() !== '');
      if (validWorkers.length === 0) {
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: 'Minimal harus ada satu pekerja yang diisi'
        });
        setIsLoading(false);
        return;
      }

      // Check if all workers have photos
      const workersWithoutPhoto = validWorkers.filter(worker => !worker.foto_pekerja.trim());
      if (workersWithoutPhoto.length > 0) {
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: 'Semua pekerja harus memiliki foto. Silakan upload foto untuk semua pekerja.'
        });
        setIsLoading(false);
        return;
      }

      // Format worker names for database
      const workerNames = validWorkers.map(worker => worker.nama_pekerja.trim()).join('\n');

      // Prepare submission data - transform Indonesian field names to English for API
      const formattedData = {
        vendor_name: formData.nama_vendor,
        based_on: formData.berdasarkan,
        officer_name: formData.nama_petugas,
        job_description: formData.pekerjaan,
        work_location: formData.lokasi_kerja,
        implementation: formData.pelaksanaan,
        working_hours: formData.jam_kerja,
        other_notes: formData.lain_lain,
        work_facilities: formData.sarana_kerja,
        worker_count: formData.jumlah_pekerja,
        simja_number: formData.nomor_simja,
        simja_date: formData.tanggal_simja ? new Date(formData.tanggal_simja) : null,
        sika_number: formData.nomor_sika,
        sika_date: formData.tanggal_sika ? new Date(formData.tanggal_sika) : null,
        worker_names: workerNames,
        content: formData.content,
        sika_document_upload: formData.upload_doc_sika,
        simja_document_upload: formData.upload_doc_simja,
        workers: validWorkers.map(worker => ({
          worker_name: worker.nama_pekerja.trim(),
          worker_photo: worker.foto_pekerja
        }))
      };

      console.log('Sending update request:', {
        url: `/api/submissions/${submission.id}`,
        method: 'PUT',
        data: formattedData
      });

      const response = await fetch(`/api/submissions/${submission.id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formattedData),
      });

      console.log('Response status:', response.status);
      console.log('Response headers:', Object.fromEntries(response.headers.entries()));

      if (!response.ok) {
        const errorText = await response.text();
        console.error('Error response:', errorText);
        
        let errorMessage;
        try {
          const errorJson = JSON.parse(errorText);
          errorMessage = errorJson.error || errorJson.message || 'Gagal menyimpan perubahan';
        } catch {
          errorMessage = `HTTP ${response.status}: ${response.statusText}`;
        }
        
        setAlert({
          variant: 'error',
          title: 'Error!',
          message: `Error: ${errorMessage}`
        });
        showError('Gagal Menyimpan', errorMessage);
        return;
      }

      const result = await response.json();
      console.log('Update successful:', result);
      
      // Show success toast and redirect immediately
      showSuccess('Berhasil!', 'Perubahan berhasil disimpan!');
      
      // Redirect immediately without delay
      router.push('/vendor/submissions');
    } catch (error) {
      console.error('Network/unexpected error:', error);
      
      let errorMessage = 'Terjadi kesalahan tidak terduga';
      if (error instanceof Error) {
        errorMessage = error.message;
      }
      
      setAlert({
        variant: 'error',
        title: 'Error!',
        message: `Gagal menyimpan perubahan: ${errorMessage}`
      });
      showError('Error!', `Gagal menyimpan perubahan: ${errorMessage}`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-6">
      {isInitialLoading ? (
        <Card>
          <div className="p-6 text-center">
            <LoadingSpinner size="lg" className="mx-auto mb-4" />
            <p className="text-gray-600">Memuat data pengajuan...</p>
          </div>
        </Card>
      ) : !submission ? (
        <Card>
          <div className="p-6 text-center">
            <p className="text-red-600">Data pengajuan tidak ditemukan</p>
          </div>
        </Card>
      ) : (
        <Card>
          <div className="p-6">
            <div className="flex justify-between items-center mb-6">
              <div className="text-sm text-gray-500">
                Status: <span className={`font-medium ${
                  submission.approval_status === 'PENDING' ? 'text-yellow-600' :
                  submission.approval_status === 'APPROVED' ? 'text-green-600' :
                  'text-red-600'
                }`}>{
                  submission.approval_status === 'PENDING' ? 'Menunggu Review' :
                  submission.approval_status === 'APPROVED' ? 'Disetujui' :
                  submission.approval_status === 'REJECTED' ? 'Ditolak' :
                  submission.approval_status
                }</span>
              </div>
            </div>
            
            {submission.approval_status !== 'PENDING' && (
              <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p className="text-yellow-800 text-sm">
                  <span className="font-medium">Peringatan:</span> Pengajuan ini sudah diproses oleh admin dan tidak dapat diubah.
                  Anda hanya dapat melihat detailnya saja.
                </p>
              </div>
            )}
            
            <form onSubmit={handleSubmit} className="space-y-8">
              <fieldset disabled={submission.approval_status !== 'PENDING'} className={submission.approval_status !== 'PENDING' ? 'opacity-60' : ''}>
            
            {/* Informasi Vendor */}
            <div className="p-6 rounded-lg">
              <h2 className="text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2">Informasi Vendor</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <Label htmlFor="nama_vendor">Nama vendor</Label>
                  <Input
                    id="nama_vendor"
                    name="nama_vendor"
                    value={session?.user?.vendor_name || formData.nama_vendor || ''}
                    onChange={handleChange}
                    type="text"
                    required
                    disabled={!!session?.user?.vendor_name}
                    placeholder="PT. Nama Perusahaan"
                    className={session?.user?.vendor_name ? "cursor-not-allowed" : ""}
                  />
                </div>

                <div>
                  <Label htmlFor="nama_petugas">Nama petugas</Label>
                  <Input
                    id="nama_petugas"
                    name="nama_petugas"
                    value={formData.nama_petugas}
                    onChange={handleChange}
                    type="text"
                    required
                    placeholder="Nama petugas yang bertanggung jawab"
                  />
                </div>

                <div className="md:col-span-2">
                  <Label htmlFor="berdasarkan">Berdasarkan</Label>
                  <Input
                    id="berdasarkan"
                    name="berdasarkan"
                    value={formData.berdasarkan}
                    onChange={handleChange}
                    type='text'
                    required
                  />
                </div>

                {/* Document Numbers */}
                <div>
                  <Label htmlFor="nomor_simja">Nomor SIMJA</Label>
                  <Input
                    id="nomor_simja"
                    name="nomor_simja"
                    value={formData.nomor_simja}
                    onChange={handleChange}
                    placeholder="Contoh: SIMJA/2024/001"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="nomor_sika">Nomor SIKA</Label>
                  <Input
                    id="nomor_sika"
                    name="nomor_sika"
                    value={formData.nomor_sika}
                    onChange={handleChange}
                    placeholder="Contoh: SIKA/2024/001"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="tanggal_simja">Tanggal SIMJA</Label>
                  <DatePicker
                    id="tanggal_simja"
                    name="tanggal_simja"
                    value={formData.tanggal_simja}
                    onChange={handleDateChange('tanggal_simja')}
                    placeholder="Pilih tanggal SIMJA"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="tanggal_sika">Tanggal SIKA</Label>
                  <DatePicker
                    id="tanggal_sika"
                    name="tanggal_sika"
                    value={formData.tanggal_sika}
                    onChange={handleDateChange('tanggal_sika')}
                    placeholder="Pilih tanggal SIKA"
                    required
                  />
                </div>

                {/* File Upload Areas */}
                <div className="space-y-2">
                  <Label htmlFor="upload_doc_simja">UPLOAD DOKUMEN SIMJA</Label>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <FileUpload
                      id="upload_doc_simja"
                      name="upload_doc_simja"
                      label=""
                      description="Upload dokumen SIMJA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB"
                      value={formData.upload_doc_simja}
                      onChange={handleFileUpload('upload_doc_simja')}
                      accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                      maxSize={8}
                      required={false}
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="upload_doc_sika">UPLOAD DOKUMEN SIKA</Label>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                    <FileUpload
                      id="upload_doc_sika"
                      name="upload_doc_sika"
                      label=""
                      description="Upload dokumen SIKA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB"
                      value={formData.upload_doc_sika}
                      onChange={handleFileUpload('upload_doc_sika')}
                      accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                      maxSize={8}
                      required={false}
                    />
                  </div>
                </div>
              </div>
            </div>

            {/* Informasi Pekerjaan */}
            <div className="p-6 rounded-lg">
              <h2 className="text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2">Informasi Pekerjaan</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <Label htmlFor="pekerjaan">Pekerjaan</Label>
                  <Input
                    id="pekerjaan"
                    name="pekerjaan"
                    value={formData.pekerjaan}
                    onChange={handleChange}
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="lokasi_kerja">Lokasi kerja</Label>
                  <Input
                    id="lokasi_kerja"
                    name="lokasi_kerja"
                    value={formData.lokasi_kerja}
                    onChange={handleChange}
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="jam_kerja">Jam kerja</Label>
                  <TimePicker
                    id="jam_kerja"
                    name="jam_kerja"
                    value={formData.jam_kerja}
                    onChange={handleTimeChange}
                    required
                    placeholder="Pilih jam kerja"
                  />
                </div>

                <div>
                  <Label htmlFor="sarana_kerja">Sarana kerja</Label>
                  <Input
                    id="sarana_kerja"
                    name="sarana_kerja"
                    value={formData.sarana_kerja}
                    onChange={handleChange}
                    placeholder="Contoh: Toolkit lengkap, APD standar, crane mobile"
                    required
                  />
                </div>

                <div>
                  <Label htmlFor="jumlah_pekerja">Jumlah Pekerja</Label>
                  <Input
                    id="jumlah_pekerja"
                    name="jumlah_pekerja"
                    type="number"
                    min="1"
                    max="100"
                    value={formData.jumlah_pekerja || ''}
                    onChange={handleChange}
                    placeholder="Masukkan jumlah pekerja"
                    required
                  />
                  <p className="text-sm text-gray-500 mt-1">
                    Jumlah total pekerja yang akan bekerja di lokasi ini
                  </p>
                </div>

                <div className="flex items-end">
                  <div className="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg w-full">
                    <div className="font-medium mb-1">Info:</div>
                    <div>Pekerja yang diinput: {workers.length}</div>
                    <div>Jumlah pekerja: {formData.jumlah_pekerja || 0}</div>
                    {formData.jumlah_pekerja && workers.length !== Number(formData.jumlah_pekerja) && (
                      <div className="text-orange-600 mt-1">
                        ⚠️ Jumlah tidak sesuai dengan daftar pekerja
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>

            {/* Daftar nama pekerja */}
            <div className="p-6 rounded-lg">
              <div className="flex justify-between items-center mb-6 border-b border-gray-300 ">
                <div className='flex justify-between'>
                  <h2 className="text-lg font-semibold text-gray-900 pb-2">Daftar Nama Pekerja</h2>
                  <p className="text-sm text-gray-500 mt-2">Total: {workers.length} pekerja</p>
                </div>
               
              </div>
              
              {/* Workers Grid */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {workers.map((worker, _index) => (
                  <div key={worker.id} className="bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-3">
                      <div className="flex items-center gap-2">
                        {/* <div className="bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium">
                          {index + 1}
                        </div>
                        <span className="text-sm font-medium text-gray-700">Pekerja {index + 1}</span> */}
                      </div>
                      {workers.length > 1 && (
                        <Button
                          type="button"
                          onClick={() => removeWorker(worker.id)}
                          variant="outline"
                          className="text-red-500 hover:bg-red-50 border-red-200 w-8 h-8 p-0 rounded-full"
                          title="Hapus pekerja"
                          disabled={submission.approval_status !== 'PENDING'}
                        >
                          ✕
                        </Button>
                      )}
                    </div>
                    
                    {/* Photo Preview */}
                    <div className="mb-4">

                      <div className="relative">
                        {worker.foto_pekerja ? (
                          <div className="relative group">
                            <img 
                              src={worker.foto_pekerja} 
                              alt={`Foto ${worker.nama_pekerja || 'pekerja'}`}
                              className="w-full h-50 object-cover rounded-lg border-2 border-gray-300"
                            />
                            <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center">
                              <Button
                                type="button"
                                variant="outline"
                                onClick={() => document.getElementById(`foto_pekerja_${worker.id}`)?.click()}
                                className="bg-white text-gray-800 hover:bg-gray-100 text-xs px-3 py-1"
                                disabled={submission.approval_status !== 'PENDING'}
                              >
                                Ganti Foto
                              </Button>
                            </div>
                            <button
                              type="button"
                              onClick={() => updateWorkerPhoto(worker.id, '')}
                              className="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600"
                              title="Hapus foto"
                              disabled={submission.approval_status !== 'PENDING'}
                            >
                              ✕
                            </button>
                          </div>
                        ) : (
                          <div 
                            onClick={() => submission.approval_status === 'PENDING' && document.getElementById(`foto_pekerja_${worker.id}`)?.click()}
                            className={`w-full h-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center transition-all duration-200 bg-gray-50 ${
                              submission.approval_status === 'PENDING' 
                                ? 'cursor-pointer hover:border-blue-400 hover:bg-blue-50' 
                                : 'cursor-not-allowed opacity-60'
                            }`}
                          >
                           
                            <p className="text-sm font-medium text-gray-600">Upload Foto Pekerja</p>
                            <p className="text-xs text-gray-500 mt-1">Klik atau drag & drop foto</p>
   
                          </div>
                        )}
                        <FileUpload
                          id={`foto_pekerja_${worker.id}`}
                          name={`foto_pekerja_${worker.id}`}
                          label=""
                          description=""
                          value={worker.foto_pekerja}
                          onChange={(url) => updateWorkerPhoto(worker.id, url)}
                          accept=".jpg,.jpeg,.png"
                          maxSize={8}
                          required={false}
                          className="sr-only"
                        />
                      </div>
                    </div>
                    
                    {/* Name Input */}
                    <div>
                      <Label htmlFor={`nama_pekerja_${worker.id}`} className="text-sm font-medium text-gray-700">
                        Nama Lengkap
                      </Label>
                      <Input
                        id={`nama_pekerja_${worker.id}`}
                        name={`nama_pekerja_${worker.id}`}
                        value={worker.nama_pekerja}
                        onChange={(e) => updateWorkerName(worker.id, e.target.value)}
                        type="text"
                        placeholder="Masukkan nama lengkap"
                        required
                        className="mt-1"
                      />
                    </div>
                    
                    {/* Status Indicator */}
                    <div className="mt-3 flex items-center gap-2">
                      <div className={`w-2 h-2 rounded-full ${
                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()
                          ? 'bg-green-400' 
                          : 'bg-red-400'
                      }`}></div>
                      <span className={`text-xs ${
                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()
                          ? 'text-green-600' 
                          : 'text-red-600'
                      }`}>
                        {worker.nama_pekerja.trim() && worker.foto_pekerja.trim()
                          ? 'Lengkap' 
                          : worker.nama_pekerja.trim() 
                            ? 'Perlu foto' 
                            : 'Belum lengkap'}
                      </span>
                    </div>
                  </div>
                ))}
                
                {/* Add New Worker Card */}
                {submission.approval_status === 'PENDING' && (
                  <div 
                    onClick={addWorker}
                    className="border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex flex-col items-center justify-center min-h-[280px] text-gray-500 hover:text-blue-600"
                  >
                    <div className="text-4xl mb-2">➕</div>
                    <p className="text-sm font-medium">Tambah Pekerja Baru</p>
                    <p className="text-xs mt-1">Klik untuk menambah</p>
                  </div>
                )}
              </div>
              
           
             
            </div>

            </fieldset>

            <div className="flex justify-end space-x-4 pt-6 border-t">
              <Button
                type="button"
                variant="outline"
                onClick={() => router.back()}
                disabled={isLoading}
              >
                Batal
              </Button>
              {submission.approval_status === 'PENDING' && (
                <Button
                  type="submit"
                  disabled={isLoading}
                >
                  {isLoading ? 'Menyimpan...' : 'Simpan Perubahan'}
                </Button>
              )}
            </div>
          </form>

          {/* Alert */}
          {alert && (
            <Alert
              variant={alert.variant}
              title={alert.title}
              message={alert.message}
            />
          )}
        </div>
      </Card>
      )}
    </div>
  );
}


=== FILE: src/components/vendor/SubmissionDetailModal.tsx ===
'use client';

import { useEffect, useState } from 'react';
import { 
  XMarkIcon, 
  EyeIcon, 
  DocumentIcon, 
  BuildingOfficeIcon,
  UserIcon,
  BriefcaseIcon,
  CalendarIcon,
  CheckCircleIcon,
  XCircleIcon,
  ClockIcon as PendingIcon
} from '@heroicons/react/24/outline';
import { fileUrlHelper } from '@/lib/fileUrlHelper';
import DocumentPreviewModal from '@/components/common/DocumentPreviewModal';
import SimlokPdfModal from '@/components/common/SimlokPdfModal';
import WorkersList from '@/components/common/WorkersList';
import DetailSection from '@/components/common/DetailSection';
import InfoCard from '@/components/common/InfoCard';
import Button from '@/components/ui/button/Button';

interface Submission {
  id: string;
  approval_status: string;
  review_status?: string;
  review_note?: string;
  final_note?: string;
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  signer_position?: string;
  signer_name?: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  approvedByUser?: {
    id: string;
    officer_name: string;
    email: string;
  };
}

interface SubmissionDetailModalProps {
  submission: Submission | null;
  isOpen: boolean;
  onClose: () => void;
}

export default function SubmissionDetailModal({
  submission,
  isOpen,
  onClose
}: SubmissionDetailModalProps) {
  const [showDebug, setShowDebug] = useState(false);
  const [isDocumentModalOpen, setIsDocumentModalOpen] = useState(false);
  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);
  const [selectedDocument, setSelectedDocument] = useState<{
    url: string;
    title: string;
  } | null>(null);

  useEffect(() => {
    // Handle escape key to close modal
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      // Prevent body scroll when modal is open
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  if (!isOpen || !submission) return null;

  const formatDate = (dateString: string | Date) => {
    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;
    return date.toLocaleDateString('id-ID', {
      day: '2-digit',
      month: 'long',
      year: 'numeric'
    });
  };

  const getStatusBadge = (status: string) => {
    const baseClasses = "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";
    
    switch (status) {
      case 'PENDING':
        return (
          <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>
            Menunggu
          </span>
        );
      case 'APPROVED':
        return (
          <span className={`${baseClasses} bg-green-100 text-green-800`}>
            Disetujui
          </span>
        );
      case 'REJECTED':
        return (
          <span className={`${baseClasses} bg-red-100 text-red-800`}>
            Ditolak
          </span>
        );
      default:
        return (
          <span className={`${baseClasses} bg-gray-100 text-gray-800`}>
            {status}
          </span>
        );
    }
  };

  const handleFileView = (url: string, title: string) => {
    setSelectedDocument({ url: fileUrlHelper.convertLegacyUrl(url), title });
    setIsDocumentModalOpen(true);
  };

  const handleDownloadPdf = () => {
    setIsPdfModalOpen(true);
  };

  return (
    <div className="fixed inset-0 z-50 overflow-y-auto">
      {/* Backdrop */}
      <div
        className="fixed inset-0 bg-black/30 transition-opacity"
        onClick={onClose}
      />

      {/* Modal */}
      <div className="flex min-h-full items-center justify-center p-4">
        <div className="relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col">
          {/* Header */}
          <div className="flex items-center justify-between border-b border-gray-200 p-6 flex-shrink-0">
            <div className="flex items-center space-x-3">

              <div>
                <h2 className="text-2xl font-bold text-gray-900">Detail Pengajuan SIMLOK</h2>
                <p className="text-sm text-gray-500 mt-1">
                  Dibuat pada {formatDate(submission.created_at)}
                </p>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              {getStatusBadge(submission.approval_status)}
              <button
                onClick={onClose}
                className="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <XMarkIcon className="h-6 w-6" />
              </button>
            </div>
          </div>

          {/* Content */}
          <div className="flex-1 overflow-y-auto p-6">
            <div className="space-y-8">
              {/* Debug Section - Development Only */}
              {process.env.NODE_ENV === 'development' && (
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                  <button
                    onClick={() => setShowDebug(!showDebug)}
                    className="text-sm font-medium text-yellow-800 hover:text-yellow-900"
                  >
                    {showDebug ? 'Hide' : 'Show'} Debug Info
                  </button>
                  {showDebug && (
                    <div className="mt-3">
                      <h4 className="font-bold mb-2">Debug Info:</h4>
                      <pre className="text-xs bg-yellow-50 p-3 rounded border overflow-auto max-h-40">
                        {JSON.stringify({
                          id: submission.id,
                          vendor_name: submission.vendor_name,
                          officer_name: submission.officer_name,
                          user: submission.user,
                          based_on: submission.based_on,
                          job_description: submission.job_description,
                          work_location: submission.work_location,
                          implementation: submission.implementation,
                          working_hours: submission.working_hours,
                          work_facilities: submission.work_facilities,
                          other_notes: submission.other_notes,
                          content: submission.content
                        }, null, 2)}
                      </pre>
                    </div>
                  )}
                </div>
              )}

              {/* Informasi Vendor */}
              <DetailSection 
                title="Informasi Vendor" 
                icon={<BuildingOfficeIcon className="h-5 w-5 text-blue-500" />}
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <InfoCard
                    label="Nama Vendor"
                    value={submission.vendor_name || '-'}
                  />
                  <InfoCard
                    label="Nama Petugas"
                    value={submission.officer_name || '-'}
                    icon={<UserIcon className="h-4 w-4 text-gray-500" />}
                  />
                  <InfoCard
                    label="Email"
                    value={submission.user?.email || '-'}
                  />
                  <InfoCard
                    label="Berdasarkan"
                    value={submission.based_on || '-'}
                  />
                </div>
              </DetailSection>

                {/* Informasi Dokumen */}
              <DetailSection 
                title="Informasi Dokumen" 
                icon={<DocumentIcon className="h-5 w-5 text-orange-500" />}
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {submission.simja_number && (
                    <InfoCard
                      label="Nomor SIMJA"
                      value={submission.simja_number}
                    />
                  )}
                  {submission.simja_date && (
                    <InfoCard
                      label="Tanggal SIMJA"
                      value={formatDate(submission.simja_date)}
                      icon={<CalendarIcon className="h-4 w-4 text-gray-500" />}
                    />
                  )}
                  {submission.sika_number && (
                    <InfoCard
                      label="Nomor SIKA"
                      value={submission.sika_number}
                    />
                  )}
                  {submission.sika_date && (
                    <InfoCard
                      label="Tanggal SIKA"
                      value={formatDate(submission.sika_date)}
                      icon={<CalendarIcon className="h-4 w-4 text-gray-500" />}
                    />
                  )}
                  {submission.approval_status === 'APPROVED' && submission.simlok_number && (
                    <InfoCard
                      label="Nomor SIMLOK"
                      value={submission.simlok_number}
                    />
                  )}
                  {submission.approval_status === 'APPROVED' && submission.simlok_date && (
                    <InfoCard
                      label="Tanggal SIMLOK"
                      value={formatDate(submission.simlok_date)}
                      icon={<CalendarIcon className="h-4 w-4 text-gray-500" />}
                    />
                  )}
                </div>
              </DetailSection>

              {/* Informasi Pekerjaan */}
              <DetailSection 
                title="Informasi Pekerjaan" 
                icon={<BriefcaseIcon className="h-5 w-5 text-green-500" />}
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <InfoCard
                    label="Pekerjaan"
                    value={submission.job_description || '-'}
                  />
                  <InfoCard
                    label="Lokasi Kerja"
                    value={submission.work_location || '-'}
                  />
                  <InfoCard
                    label="Pelaksanaan"
                    value={submission.implementation || 'Akan diisi oleh admin saat approval'}
                  />
                  <InfoCard
                    label="Jam Kerja"
                    value={submission.working_hours || '-'}
                  />
                  <InfoCard
                    label="Sarana Kerja"
                    value={submission.work_facilities || '-'}
                    className="md:col-span-2"
                  />
                </div>

                {/* {submission.other_notes && (
                  <div className="mt-6 pt-6 border-t border-gray-200">
                    <InfoCard
                      label="Lain-lain"
                      value={
                        <div className="whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md">
                          {submission.other_notes}
                        </div>
                      }
                    />
                  </div>
                )} */}
              </DetailSection>

              {/* Daftar Pekerja */}
              <DetailSection 
                title="Daftar Pekerja" 
                icon={<UserIcon className="h-5 w-5 text-purple-500" />}
              >
                {submission.worker_names ? (
                  <WorkersList
                    submissionId={submission.id}
                    fallbackWorkers={submission.worker_names}
                    layout="grid"
                    showPhotos={true}
                    maxDisplayCount={6}
                  />
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    <UserIcon className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                    <p>Belum ada data pekerja</p>
                  </div>
                )}
              </DetailSection>

              {/* Upload Dokumen */}
              <DetailSection 
                title="Dokumen Upload" 
                icon={<DocumentIcon className="h-5 w-5 text-red-500" />}
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {submission.sika_document_upload && (
                    <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                      <div className="flex items-center space-x-3">
                        <DocumentIcon className="h-6 w-6 text-red-500 flex-shrink-0" />
                        <div>
                          <p className="font-medium text-gray-900">Dokumen SIKA</p>
                          <p className="text-sm text-gray-500">File tersedia</p>
                        </div>
                      </div>
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}
                        className="flex items-center space-x-2"
                      >
                        <EyeIcon className="w-4 h-4" />
                        <span>Lihat</span>
                      </Button>
                    </div>
                  )}
                  
                  {submission.simja_document_upload && (
                    <div className="flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50">
                      <div className="flex items-center space-x-3">
                        <DocumentIcon className="h-6 w-6 text-blue-500 flex-shrink-0" />
                        <div>
                          <p className="font-medium text-gray-900">Dokumen SIMJA</p>
                          <p className="text-sm text-gray-500">File tersedia</p>
                        </div>
                      </div>
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}
                        className="flex items-center space-x-2"
                      >
                        <EyeIcon className="w-4 h-4" />
                        <span>Lihat</span>
                      </Button>
                    </div>
                  )}
                  
                  {!submission.sika_document_upload && !submission.simja_document_upload && (
                    <div className="col-span-2 text-center py-8 text-gray-500">
                      <DocumentIcon className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                      <p>Belum ada dokumen yang diupload</p>
                    </div>
                  )}
                </div>
              </DetailSection>

              {/* Informasi Penanda Tangan */}
              {/* {(submission.signer_position || submission.signer_name) && (
                <DetailSection 
                  title="Informasi Penanda Tangan" 
                  icon={<UserIcon className="h-5 w-5 text-indigo-500" />}
                >
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <InfoCard
                      label="Jabatan Penanda Tangan"
                      value={submission.signer_position || '-'}
                    />
                    <InfoCard
                      label="Nama Penanda Tangan"
                      value={submission.signer_name || '-'}
                    />
                  </div>
                </DetailSection>
              )} */}

              {/* Status & Approval */}
              <DetailSection 
                title="Status Pengajuan" 
                icon={
                  submission.approval_status === 'APPROVED' ? (
                    <CheckCircleIcon className="h-5 w-5 text-green-500" />
                  ) : submission.approval_status === 'REJECTED' ? (
                    <XCircleIcon className="h-5 w-5 text-red-500" />
                  ) : (
                    <PendingIcon className="h-5 w-5 text-orange-500" />
                  )
                }
                
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <InfoCard
                    label="Status"
                    value={getStatusBadge(submission.approval_status)}
                  />
                  {submission.approvedByUser && (
                    <InfoCard
                      label="Disetujui oleh"
                      value={submission.approvedByUser.officer_name}
                    />
                  )}

                  {submission.notes && (
                    <InfoCard
                      label="Keterangan"
                      value={
                        <div className="whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md">
                          {submission.notes}
                        </div>
                      }
                    />
                  )}

                  {/* Review Notes from Reviewer - Show if exists */}
                  {submission.review_note && (
                    <div className="md:col-span-2 bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <div className="flex items-start">
                        <DocumentIcon className="h-5 w-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" />
                        <div className="flex-1">
                          <h4 className="text-sm font-medium text-blue-800 mb-2">Catatan Review</h4>
                          <p className="text-sm text-blue-700 whitespace-pre-line">
                            {submission.review_note}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Final Notes for Vendor - Show if exists and submission is finalized */}
                  {submission.final_note && (submission.approval_status === 'APPROVED' || submission.approval_status === 'REJECTED') && (
                    <div className={`md:col-span-2 border rounded-lg p-4 ${
                      submission.approval_status === 'APPROVED' 
                        ? 'bg-green-50 border-green-200' 
                        : 'bg-red-50 border-red-200'
                    }`}>
                      <div className="flex items-start">
                        <DocumentIcon className={`h-5 w-5 mr-3 mt-0.5 flex-shrink-0 ${
                          submission.approval_status === 'APPROVED' 
                            ? 'text-green-500' 
                            : 'text-red-500'
                        }`} />
                        <div className="flex-1">
                          <h4 className={`text-sm font-medium mb-2 ${
                            submission.approval_status === 'APPROVED' 
                              ? 'text-green-800' 
                              : 'text-red-800'
                          }`}>
                            Keterangan dari Reviewer
                          </h4>
                          <p className={`text-sm whitespace-pre-line ${
                            submission.approval_status === 'APPROVED' 
                              ? 'text-green-700' 
                              : 'text-red-700'
                          }`}>
                            {submission.final_note}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Status-specific information */}
                  {submission.approval_status === 'PENDING' && (
                    <div className="md:col-span-2 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                      <div className="flex items-center">
                        <PendingIcon className="h-5 w-5 text-yellow-500 mr-3" />
                        <div>
                          <h4 className="text-sm font-medium text-yellow-800">Menunggu Review</h4>
                          <p className="text-sm text-yellow-700 mt-1">
                            Pengajuan Anda sedang dalam proses review oleh admin.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {submission.approval_status === 'APPROVED' && (
                    <div className="md:col-span-2 bg-green-50 border border-green-200 rounded-lg p-4">
                      <div className="flex items-center">
                        <CheckCircleIcon className="h-5 w-5 text-green-500 mr-3" />
                        <div>
                          <h4 className="text-sm font-medium text-green-800">Pengajuan Disetujui</h4>
                          <p className="text-sm text-green-700 mt-1">
                            Selamat! Pengajuan SIMLOK Anda telah disetujui.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {submission.approval_status === 'REJECTED' && (
                    <div className="md:col-span-2 bg-red-50 border border-red-200 rounded-lg p-4">
                      <div className="flex items-center">
                        <XCircleIcon className="h-5 w-5 text-red-500 mr-3" />
                        <div>
                          <h4 className="text-sm font-medium text-red-800">Pengajuan Ditolak</h4>
                          <p className="text-sm text-red-700 mt-1">
                            Pengajuan SIMLOK Anda tidak dapat disetujui. Silakan hubungi admin untuk informasi lebih lanjut.
                          </p>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </DetailSection>
            </div>

            {/* Footer Actions */}
            <div className="flex items-center justify-between border-t border-gray-200 pt-6 mt-8">
              <div className="flex items-center space-x-3 justify-between w-full">
                {submission.approval_status === 'APPROVED' && submission.simlok_number && (
                  <Button
                    variant="primary"
                    size="sm"
                    onClick={handleDownloadPdf}
                  >
                    <DocumentIcon className="w-4 h-4 mr-2" />
                    Lihat PDF
                  </Button>
                )}
                
                <Button
                  variant="outline"
                  size="sm"
                  onClick={onClose}
                >
                  Tutup
                </Button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Document Preview Modal */}
      <DocumentPreviewModal
        isOpen={isDocumentModalOpen}
        onClose={() => setIsDocumentModalOpen(false)}
        fileUrl={selectedDocument?.url || ''}
        fileName={selectedDocument?.title || ''}
      />

      {/* PDF Download Modal */}
      <SimlokPdfModal
        isOpen={isPdfModalOpen}
        onClose={() => setIsPdfModalOpen(false)}
        submissionId={submission?.id || ''}
        submissionName={submission?.vendor_name || ''}
        nomorSimlok={submission?.simlok_number || ''}
      />
    </div>
  );
}


=== FILE: src/components/vendor/VendorSubmissionsContent.tsx ===
'use client';

import { useState, useEffect, useCallback, useMemo, useRef } from 'react';
import Link from 'next/link';
import { 
  MagnifyingGlassIcon,
  ChevronUpIcon,
  ChevronDownIcon,
  ChevronUpDownIcon,
  PlusIcon
} from "@heroicons/react/24/outline";
import SubmissionDetailModal from './SubmissionDetailModal';
import Button from '../ui/button/Button';
import { useToast } from '@/hooks/useToast';
import ConfirmModal from '../ui/modal/ConfirmModal';
import { useSubmissionStore } from '@/store/useSubmissionStore';
import TableLoader from '../ui/TableLoader';
import { useSocket } from '@/components/common/RealtimeUpdates';

interface Submission {
  id: string;
  approval_status: string;
  vendor_name: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;
  other_notes?: string;
  work_facilities: string;
  simja_number?: string;
  simja_date?: string | null;
  sika_number?: string;
  sika_date?: string | null;
  simlok_number?: string;
  simlok_date?: string | null;
  worker_names: string;
  content: string;
  notes?: string;
  sika_document_upload?: string;
  simja_document_upload?: string;
  qrcode?: string;
  created_at: string;
  user: {
    id: string;
    officer_name: string;
    email: string;
    vendor_name: string;
  };
  approvedByUser?: {
    id: string;
    officer_name: string;
    email: string;
  };
}

// Types already defined in the store

// Custom hook untuk debounced value
function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

export default function VendorSubmissionsContent() {
  const { showSuccess, showError } = useToast();
  
  // Use Zustand store for realtime submissions data
  const { 
    submissions,
    loading,
    searchTerm,
    sortField,
    sortOrder,
    currentPage,
    totalPages,
    allSubmissionsStats,
    filteredTotal,
    fetchVendorSubmissions,
    fetchVendorStats,
    setSearchTerm,
    setSortField,
    setSortOrder,
    setCurrentPage
  } = useSubmissionStore();
  
  // Initialize Socket.IO connection
  useSocket();
  
  const [error] = useState("");
  
  // Status filter (local state)
  const [statusFilter, setStatusFilter] = useState("");
  const [limit] = useState(10);

  // Modal state
  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  
  // Confirm modal state
  const [confirmModal, setConfirmModal] = useState<{
    isOpen: boolean;
    title: string;
    message: string;
    onConfirm: () => void;
  }>({
    isOpen: false,
    title: '',
    message: '',
    onConfirm: () => {}
  });

  // Ref untuk search input
  const searchInputRef = useRef<HTMLInputElement>(null);
  const [isInputFocused, setIsInputFocused] = useState(false);

  // Debounced search term
  const debouncedSearchTerm = useDebounce(searchTerm, 500);

  // Fetch statistics once when component mounts
  useEffect(() => {
    fetchVendorStats();
  }, [fetchVendorStats]);

  // Fetch submissions when filters change
  useEffect(() => {
    const params = {
      page: currentPage,
      limit,
      search: debouncedSearchTerm,
      sortBy: sortField,
      sortOrder,
      ...(statusFilter && { status: statusFilter }),
    };
    
    fetchVendorSubmissions(params);
  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions]);

  // Kembalikan fokus ke search input setelah data reload
  useEffect(() => {
    if (!loading && isInputFocused && searchInputRef.current) {
      searchInputRef.current.focus();
    }
  }, [loading, isInputFocused]);

  // Reset ke halaman 1 saat search term berubah
  useEffect(() => {
    setCurrentPage(1);
  }, [debouncedSearchTerm, statusFilter]);

  const handleSort = useCallback((field: string) => {
    if (field === sortField) {
      setSortOrder(sortOrder === "asc" ? "desc" : "asc");
    } else {
      setSortField(field);
      setSortOrder("desc");
    }
    setCurrentPage(1);
  }, [sortField, sortOrder, setSortField, setSortOrder, setCurrentPage]);

  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchTerm(e.target.value);
    setIsInputFocused(true);
  }, []);

  const handleStatusFilterChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {
    setStatusFilter(e.target.value);
  }, []);

  const handleDelete = useCallback((id: string) => {
    setConfirmModal({
      isOpen: true,
      title: 'Konfirmasi Hapus',
      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',
      onConfirm: () => performDelete(id)
    });
  }, []);

  const performDelete = useCallback(async (id: string) => {
    try {
      setConfirmModal(prev => ({ ...prev, isOpen: false }));
      
      const response = await fetch(`/api/submissions/${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Gagal menghapus pengajuan');
      }

      // Refresh data setelah berhasil menghapus
      const params = {
        page: currentPage,
        limit,
        search: debouncedSearchTerm,
        sortBy: sortField,
        sortOrder,
        ...(statusFilter && { status: statusFilter }),
      };
      
      await fetchVendorSubmissions(params);
      
      showSuccess('Berhasil!', 'Pengajuan berhasil dihapus');
    } catch (error: any) {
      console.error('Error deleting submission:', error);
      showError('Error!', error.message || 'Gagal menghapus pengajuan');
    }
  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions, showSuccess, showError]);

  const handleViewDetail = useCallback((submission: Submission) => {
    setSelectedSubmission(submission);
    setIsModalOpen(true);
  }, []);

  const handleCloseModal = useCallback(() => {
    setIsModalOpen(false);
    setSelectedSubmission(null);
  }, []);

  const paginationInfo = useMemo(() => ({
    currentPage,
    totalPages,
    filteredTotal,
    limit,
    startItem: ((currentPage - 1) * limit) + 1,
    endItem: Math.min(currentPage * limit, filteredTotal)
  }), [currentPage, totalPages, filteredTotal, limit]);

  const getSortIcon = useCallback((field: string) => {
    if (sortField !== field) {
      return <ChevronUpDownIcon className="w-4 h-4 text-gray-400" />;
    }
    return sortOrder === "asc" 
      ? <ChevronUpIcon className="w-4 h-4 text-blue-500" />
      : <ChevronDownIcon className="w-4 h-4 text-blue-500" />;
  }, [sortField, sortOrder]);

  const formatDate = useCallback((dateString: string) => {
    return new Date(dateString).toLocaleDateString("id-ID", {
      year: "numeric",
      month: "short", 
      day: "numeric"
    });
  }, []);

  const getStatusBadge = useCallback((status: string) => {
    const statusConfig = {
      'PENDING': { label: "Menunggu", className: "bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full" },
      'APPROVED': { label: "Disetujui", className: "bg-green-100 text-green-700 px-2 py-0.5 rounded-full" },
      'REJECTED': { label: "Ditolak", className: "bg-red-100 text-red-700 px-2 py-0.5 rounded-full" }
    };

    const config = statusConfig[status as keyof typeof statusConfig] || { 
      label: status, 
      className: 'bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full' 
    };
    
    return (
      <span className={`text-xs font-semibold ${config.className}`}>
        {config.label}
      </span>
    );
  }, []);

  // Function to format nama_pekerja for table display
  const formatNamaPekerjaPreview = useCallback((names: string, maxDisplay: number = 2): string => {
    if (!names) return '';
    const namesList = names
      .split(/[\n,]+/)
      .map(name => name.trim())
      .filter(name => name.length > 0);
    
    if (namesList.length <= maxDisplay) {
      return namesList.join(', ');
    }
    
    return `${namesList.slice(0, maxDisplay).join(', ')} +${namesList.length - maxDisplay} lainnya`;
  }, []);



  return (
    <div className="max-w-7xl mx-auto px-3 md:px-6 space-y-6">
      {/* Statistics Cards */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div className="bg-white rounded-xl border shadow-sm p-4">
          <h3 className="text-sm font-medium text-gray-500">Total</h3>
          <p className="text-2xl font-bold text-blue-600 mt-1">{allSubmissionsStats?.total || 0}</p>
        </div>
        <div className="bg-white rounded-xl border shadow-sm p-4">
          <h3 className="text-sm font-medium text-gray-500">Menunggu</h3>
          <p className="text-2xl font-bold text-yellow-600 mt-1">
            {allSubmissionsStats?.pending || 0}
          </p>
        </div>
        <div className="bg-white rounded-xl border shadow-sm p-4">
          <h3 className="text-sm font-medium text-gray-500">Disetujui</h3>
          <p className="text-2xl font-bold text-green-600 mt-1">
            {allSubmissionsStats?.approved || 0}
          </p>
        </div>
        <div className="bg-white rounded-xl border shadow-sm p-4">
          <h3 className="text-sm font-medium text-gray-500">Ditolak</h3>
          <p className="text-2xl font-bold text-red-600 mt-1">
            {allSubmissionsStats?.rejected || 0}
          </p>
        </div>
      </div>

      {/* Header */}
       <div className="bg-white rounded-xl border shadow-sm p-6 space-y-4">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h1 className="text-xl md:text-2xl font-semibold text-gray-900">Pengajuan Saya</h1>
          {/* <p className="text-sm text-gray-500 mt-1">Daftar Pengajuan SIMLOK ({paginationInfo.totalSubmissions || 0} pengajuan)</p> */}
        </div>
        
        <Link href="/vendor/submissions/create">
          <Button 
            variant="primary"
            size="md"
            startIcon={<PlusIcon className="w-4 h-4" />}
            className="whitespace-nowrap"
          >
            Buat Pengajuan Baru
          </Button>
        </Link>
      </div>

      {/* Toolbar - Search and Filters */}
      <div className="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
        <div className="relative w-full md:w-80">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            ref={searchInputRef}
            type="text"
            placeholder="Cari pekerjaan atau petugas…"
            value={searchTerm}
            onChange={handleSearchChange}
            onBlur={() => setIsInputFocused(false)}
            onFocus={() => setIsInputFocused(true)}
            className="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
          />
        </div>
        
        <select
          value={statusFilter}
          onChange={handleStatusFilterChange}
          className="w-44 px-3 py-2.5 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
        >
          <option value="">Semua</option>
          <option value="APPROVED">Disetujui</option>
          <option value="REJECTED">Ditolak</option>
          <option value="PENDING">Menunggu</option>
        </select>
      </div>
      </div>

      {/* Content */}
      {error ? (
        <div className="overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
            <svg className="w-8 h-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 className="text-lg font-medium text-gray-900 mb-2">Gagal memuat data pengajuan</h3>
          <p className="text-gray-500 mb-4">Periksa koneksi atau coba ulang</p>
          <button 
            onClick={() => {
              const params = {
                page: currentPage,
                limit,
                search: debouncedSearchTerm,
                sortBy: sortField,
                sortOrder,
                ...(statusFilter && { status: statusFilter }),
              };
              fetchVendorSubmissions(params);
            }}
            className="inline-flex items-center px-4 py-2 border border-transparent rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors"
          >
            Coba Lagi
          </button>
        </div>
      ) : submissions.length === 0 && !loading ? (
        <div className="overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
            <svg className="w-8 h-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2h16a2 2 0 002-2v-5m0 0V9a2 2 0 00-2-2H6a2 2 0 00-2 2v4" />
            </svg>
          </div>
          <h3 className="text-lg font-medium text-gray-900 mb-2">Belum ada pengajuan</h3>
          <p className="text-gray-500 mb-6">Buat pengajuan baru untuk memulai</p>
          <Link href="/vendor/submissions/create">
            <Button 
              variant="primary"
              size="md"
              startIcon={<PlusIcon className="w-4 h-4" />}
            >
              Buat Pengajuan Baru
            </Button>
          </Link>
        </div>
      ) : (
        <div className="overflow-x-auto rounded-xl border bg-white shadow-sm">
          {loading ? (
            <TableLoader rows={5} columns={5} showHeader={true} />
          ) : (
            <>
              {/* Desktop Table View */}
              <div className="hidden md:block">
                <table className="min-w-full table-fixed">
                  <colgroup>
                    <col className="w-[28%]" />
                    <col className="w-[18%]" />
                    <col className="w-[22%]" />
                    <col className="w-[12%]" />
                    <col className="w-[10%]" />
                    <col className="w-[10%]" />
                  </colgroup>
                  <thead>
                    <tr className="bg-gray-50/50 border-b border-gray-200">
                      <th 
                        onClick={() => handleSort("job_description")}
                        className="p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors"
                      >
                        <div className="flex items-center space-x-1">
                          <span>Pekerjaan & Petugas</span>
                          {getSortIcon("job_description")}
                        </div>
                      </th>
                      <th className="p-3 text-left text-sm font-semibold text-gray-900">
                        Sarana Kerja
                      </th>
                      <th className="p-3 text-left text-sm font-semibold text-gray-900">
                        Lokasi & Waktu
                      </th>
                      <th 
                        onClick={() => handleSort("approval_status")}
                        className="p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors"
                      >
                        <div className="flex items-center space-x-1">
                          <span>Status</span>
                          {getSortIcon("approval_status")}
                        </div>
                      </th>
                      <th 
                        onClick={() => handleSort("created_at")}
                        className="p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors"
                      >
                        <div className="flex items-center space-x-1">
                          <span>Tanggal</span>
                          {getSortIcon("created_at")}
                        </div>
                      </th>
                      <th className="p-3 text-left text-sm font-semibold text-gray-900">
                        Aksi
                      </th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {submissions.map((submission: any) => (
                      <tr 
                        key={submission.id} 
                        className="hover:bg-gray-50/50 transition-colors cursor-pointer"
                        onClick={() => handleViewDetail(submission)}
                      >
                        <td className="p-3 align-top">
                          <div className="text-sm font-medium text-gray-900 break-words leading-snug">
                            {submission.job_description}
                          </div>
                          <div className="text-xs text-gray-500 mt-1 font-medium">{submission.officer_name}</div>
                          {/* <div className="text-xs text-gray-500 mt-1" title={submission.worker_names}>
                            Pekerja: {formatNamaPekerjaPreview(submission.worker_names, 3)}
                          </div> */}
                        </td>
                        <td className="p-3 align-top">
                          <div className="text-sm text-gray-800 break-words leading-snug">
                            {submission.work_facilities}
                          </div>
                          {/* {submission.other_notes && (
                            <div className="text-xs text-gray-600 mt-1 break-words leading-relaxed">
                              <span className="font-medium">Catatan:</span> {submission.other_notes}
                            </div>
                          )} */}
                        </td>
                        <td className="p-3 align-top">
                          <div className="text-sm text-gray-800 leading-snug">
                            <div className="font-medium break-words">{submission.work_location}</div>
                            {/* {submission.implementation && (
                              <div className="text-xs text-gray-600 mt-1 break-words">
                                <span className="font-medium">Pelaksanaan:</span> {submission.implementation}
                              </div>
                            )} */}
                            {submission.working_hours && (
                              <div className="text-xs text-gray-600 mt-1">
                                <span className="font-medium">Jam:</span> {submission.working_hours}
                              </div>
                            )}
                          </div>
                        </td>
                        <td className="p-3 align-top">
                          <div className="space-y-1">
                            {getStatusBadge(submission.approval_status)}
                          </div>
                        </td>
                        <td className="p-3 align-top">
                          <div className="text-xs text-gray-500">{formatDate(submission.created_at)}</div>

                        </td>
                        <td className="p-3 align-top">
                          <div className="flex items-start gap-1" onClick={(e) => e.stopPropagation()}>
                            <Button
                              onClick={() => handleViewDetail(submission)}
                              variant="info"
                              size="sm"
                              title="Lihat detail submission"
                              className="text-xs "
                            >
                              Lihat
                            </Button>
                            {submission.approval_status === 'PENDING' && (
                              <>
                                {/* <Link href={`/vendor/submissions/edit/${submission.id}`} className="w-full">
                                  <Button
                                    variant="warning"
                                    size="sm"
                                    title="Edit submission"
                                    className="text-xs w-full"
                                  >
                                    Edit
                                  </Button>
                                </Link> */}
                                <Button 
                                  onClick={() => handleDelete(submission.id)} 
                                  variant="destructive" 
                                  size="sm"
                                  title="Hapus submission ini"
                                  className="text-xs w-full"
                                >
                                  Hapus
                                </Button>
                              </>
                            )}
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Mobile Card View */}
              <div className="md:hidden divide-y divide-gray-200">
                {submissions.map((submission: any) => (
                  <div 
                    key={submission.id}
                    className="p-4 hover:bg-gray-50/50 transition-colors cursor-pointer"
                    onClick={() => handleViewDetail(submission)}
                  >
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <h3 className="font-medium text-gray-900 break-words leading-snug">{submission.job_description}</h3>
                        <p className="text-sm text-gray-500 font-medium">{submission.officer_name}</p>
                      </div>
                      {getStatusBadge(submission.approval_status)}
                    </div>
                    
                    <div className="space-y-3">
                      <div>
                        <p className="text-xs text-gray-500 mb-1">
                          <span className="font-medium">Pekerja:</span> {formatNamaPekerjaPreview(submission.worker_names, 3)}
                        </p>
                        <p className="text-sm text-gray-800 break-words leading-snug">
                          <span className="font-medium">Sarana:</span> {submission.work_facilities}
                        </p>
                      </div>
                      
                      <div>
                        <p className="text-sm text-gray-800 break-words leading-snug">
                          <span className="font-medium">Lokasi:</span> {submission.work_location}
                        </p>
                        {submission.implementation && (
                          <p className="text-xs text-gray-600 mt-1 break-words">
                            <span className="font-medium">Pelaksanaan:</span> {submission.implementation}
                          </p>
                        )}
                        {submission.working_hours && (
                          <p className="text-xs text-gray-600 mt-1">
                            <span className="font-medium">Jam Kerja:</span> {submission.working_hours}
                          </p>
                        )}
                      </div>

                      {(submission.other_notes || submission.notes) && (
                        <div className="bg-gray-50 rounded-lg p-2">
                          {submission.other_notes && (
                            <p className="text-xs text-gray-600 break-words leading-relaxed">
                              <span className="font-medium">Catatan Lain:</span> {submission.other_notes}
                            </p>
                          )}
                          {submission.notes && (
                            <p className="text-xs text-gray-600 break-words leading-relaxed mt-1">
                              <span className="font-medium">Catatan Admin:</span> {submission.notes}
                            </p>
                          )}
                        </div>
                      )}
                      
                      <div className="flex justify-between items-center text-xs text-gray-500">
                        <span>{formatDate(submission.created_at)}</span>
                        <div className="text-right">
                          {submission.simlok_number && (
                            <div>SIMLOK: {submission.simlok_number}</div>
                          )}
                          {submission.sika_number && (
                            <div>SIKA: {submission.sika_number}</div>
                          )}
                        </div>
                      </div>
                      
                      <div className="flex items-center space-x-2 pt-2" onClick={(e) => e.stopPropagation()}>
                        <Button
                          onClick={() => handleViewDetail(submission)}
                          variant="info"
                          size="sm"
                          className="text-xs flex-1"
                        >
                          Lihat Detail
                        </Button>
                        {submission.approval_status === 'PENDING' && (
                          <>
                            <Link href={`/vendor/submissions/edit/${submission.id}`}>
                              <Button
                                variant="warning"
                                size="sm"
                                className="text-xs"
                              >
                                Edit
                              </Button>
                            </Link>
                            <Button 
                              onClick={() => handleDelete(submission.id)} 
                              variant="destructive" 
                              size="sm"
                              className="text-xs"
                            >
                              Hapus
                            </Button>
                          </>
                        )}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}

          {/* Footer with Pagination */}
          {totalPages > 1 && !loading && (
            <div className="flex items-center justify-between text-sm text-gray-500 p-3 border-t">
              <span>{paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.filteredTotal}</span>
              
              <div className="flex items-center space-x-1">
                <button
                  onClick={() => setCurrentPage((prev: number) => Math.max(prev - 1, 1))}
                  disabled={currentPage === 1}
                  className="px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  ←
                </button>
                
                {[...Array(totalPages)].map((_, index) => {
                  const page = index + 1;
                  if (
                    page === 1 ||
                    page === totalPages ||
                    (page >= currentPage - 1 && page <= currentPage + 1)
                  ) {
                    return (
                      <button
                        key={page}
                        onClick={() => setCurrentPage(page)}
                        className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${
                          currentPage === page
                            ? "bg-blue-600 text-white"
                            : "border border-gray-300 text-gray-700 bg-white hover:bg-gray-50"
                        }`}
                      >
                        {page}
                      </button>
                    );
                  } else if (
                    page === currentPage - 2 ||
                    page === currentPage + 2
                  ) {
                    return <span key={page} className="text-gray-400 px-1">…</span>;
                  }
                  return null;
                })}
                
                <button
                  onClick={() => setCurrentPage((prev: number) => Math.min(prev + 1, totalPages))}
                  disabled={currentPage === totalPages}
                  className="px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  →
                </button>
              </div>
            </div>
          )}
        </div>
      )}

      {/* Modal Detail */}
      <SubmissionDetailModal
        submission={selectedSubmission}
        isOpen={isModalOpen}
        onClose={handleCloseModal}
      />

      {/* Confirm Modal */}
      <ConfirmModal
        isOpen={confirmModal.isOpen}
        title={confirmModal.title}
        message={confirmModal.message}
        onConfirm={confirmModal.onConfirm}
        onClose={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))}
        variant="danger"
      />
    </div>
  );
}


=== FILE: src/components/verifier/ResponsiveVerifierDashboard.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { 
  EyeIcon,
  ClipboardDocumentListIcon,
  CheckCircleIcon,
  XCircleIcon,
  ClockIcon,
  QrCodeIcon,
  ChartBarIcon,
  CalendarDaysIcon,
  FunnelIcon
} from '@heroicons/react/24/outline';
import { useToast } from '@/hooks/useToast';
import Button from '../ui/button/Button';
import LoadingSpinner from '../ui/LoadingSpinner';
import CameraQRScanner from '../scanner/CameraQRScanner';

interface DashboardStats {
  total: number;
  pending: number;
  approved: number;
  rejected: number;
  today: number;
  thisWeek: number;
  thisMonth: number;
}

interface RecentSubmission {
  id: string;
  vendor_name: string;
  simlok_number?: string;
  approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';
  created_at: string;
  job_description: string;
}

export default function ResponsiveVerifierDashboard() {
  const { showError } = useToast();
  
  const [stats, setStats] = useState<DashboardStats>({
    total: 0,
    pending: 0,
    approved: 0,
    rejected: 0,
    today: 0,
    thisWeek: 0,
    thisMonth: 0
  });
  
  const [recentSubmissions, setRecentSubmissions] = useState<RecentSubmission[]>([]);
  const [loading, setLoading] = useState(true);
  const [scannerOpen, setScannerOpen] = useState(false);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    setLoading(true);
    try {
      const [statsResponse, submissionsResponse] = await Promise.all([
        fetch('/api/verifier/stats'),
        fetch('/api/verifier/submissions?limit=5&status=ALL')
      ]);

      if (statsResponse.ok) {
        const statsData = await statsResponse.json();
        setStats(statsData);
      }

      if (submissionsResponse.ok) {
        const submissionsData = await submissionsResponse.json();
        setRecentSubmissions(submissionsData.submissions || []);
      }
    } catch (error) {
      console.error('Error fetching dashboard data:', error);
      showError('Error', 'Gagal memuat data dashboard');
    } finally {
      setLoading(false);
    }
  };

  const handleScanResult = async (scannedData: string) => {
    try {
      setScannerOpen(false);
      
      let submissionId = scannedData;
      
      if (scannedData.startsWith('{')) {
        const qrData = JSON.parse(scannedData);
        submissionId = qrData.id || qrData.submissionId;
      }
      
      if (submissionId) {
        window.location.href = `/verifier/submissions/${submissionId}`;
      }
    } catch (error) {
      console.error('Error processing scan result:', error);
      showError('Error', 'QR Code tidak valid');
    }
  };

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING':
        return (
          <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
            <ClockIcon className="w-3 h-3 mr-1" />
            Pending
          </span>
        );
      case 'APPROVED':
        return (
          <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            <CheckCircleIcon className="w-3 h-3 mr-1" />
            Approved
          </span>
        );
      case 'REJECTED':
        return (
          <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
            <XCircleIcon className="w-3 h-3 mr-1" />
            Rejected
          </span>
        );
      default:
        return null;
    }
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'short',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <LoadingSpinner size="lg" />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Welcome Header */}
      <div className="bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 className="text-2xl font-bold mb-2">Dashboard Verifier</h1>
            <p className="text-blue-100">
              Kelola dan verifikasi pengajuan SIMLOK dengan mudah
            </p>
          </div>
          
          <div className="mt-4 sm:mt-0 flex flex-col sm:flex-row gap-3">
            <Button
              onClick={() => setScannerOpen(true)}
              className="bg-white text-blue-600 hover:bg-gray-100 w-full sm:w-auto"
            >
              <QrCodeIcon className="w-4 h-4 mr-2" />
              <span className="sm:hidden">Scan QR Code</span>
              <span className="hidden sm:inline">Scan QR</span>
            </Button>
            
            <Button
              onClick={() => window.location.href = '/verifier/submissions'}
              className="bg-blue-500 hover:bg-blue-400 border-blue-400 w-full sm:w-auto"
            >
              <ClipboardDocumentListIcon className="w-4 h-4 mr-2" />
              <span className="sm:hidden">Lihat Semua SIMLOK</span>
              <span className="hidden sm:inline">Semua SIMLOK</span>
            </Button>
          </div>
        </div>
      </div>

      {/* Statistics Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        {/* Total Submissions */}
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Total Submission</h3>
              <p className="text-2xl font-bold text-blue-600 mt-1">{stats.total}</p>
            </div>
            <div className="p-3 bg-blue-100 rounded-full">
              <ClipboardDocumentListIcon className="w-6 h-6 text-blue-600" />
            </div>
          </div>
        </div>

        {/* Pending */}
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Menunggu</h3>
              <p className="text-2xl font-bold text-amber-600 mt-1">{stats.pending}</p>
            </div>
            <div className="p-3 bg-amber-100 rounded-full">
              <ClockIcon className="w-6 h-6 text-amber-600" />
            </div>
          </div>
        </div>

        {/* Approved */}
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Disetujui</h3>
              <p className="text-2xl font-bold text-green-600 mt-1">{stats.approved}</p>
            </div>
            <div className="p-3 bg-green-100 rounded-full">
              <CheckCircleIcon className="w-6 h-6 text-green-600" />
            </div>
          </div>
        </div>

        {/* Rejected */}
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Ditolak</h3>
              <p className="text-2xl font-bold text-red-600 mt-1">{stats.rejected}</p>
            </div>
            <div className="p-3 bg-red-100 rounded-full">
              <XCircleIcon className="w-6 h-6 text-red-600" />
            </div>
          </div>
        </div>
      </div>

      {/* Quick Stats - Period Based */}
      <div className="bg-white rounded-lg shadow border border-gray-200">
        <div className="px-4 py-5 sm:p-6">
          <h3 className="text-lg font-medium text-gray-900 mb-4 flex items-center">
            <ChartBarIcon className="w-5 h-5 mr-2 text-gray-400" />
            Statistik Periode
          </h3>
          
          <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <div className="text-2xl font-bold text-blue-600 mb-1">
                {stats.today}
              </div>
              <div className="text-sm text-gray-600">Hari Ini</div>
            </div>
            
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <div className="text-2xl font-bold text-blue-600 mb-1">
                {stats.thisWeek}
              </div>
              <div className="text-sm text-gray-600">Minggu Ini</div>
            </div>
            
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <div className="text-2xl font-bold text-blue-600 mb-1">
                {stats.thisMonth}
              </div>
              <div className="text-sm text-gray-600">Bulan Ini</div>
            </div>
          </div>
        </div>
      </div>

      {/* Recent Submissions */}
      <div className="bg-white rounded-lg shadow border border-gray-200">
        <div className="px-4 py-5 sm:p-6">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
            <h3 className="text-lg font-medium text-gray-900 mb-2 sm:mb-0 flex items-center">
              <CalendarDaysIcon className="w-5 h-5 mr-2 text-gray-400" />
              Submissions Terbaru
            </h3>
            <Button
              onClick={() => window.location.href = '/verifier/submissions'}
              variant="outline"
              size="sm"
              className="w-full sm:w-auto"
            >
              <FunnelIcon className="w-4 h-4 mr-2" />
              Lihat Semua
            </Button>
          </div>

          {recentSubmissions.length === 0 ? (
            <div className="text-center py-8">
              <ClipboardDocumentListIcon className="mx-auto h-12 w-12 text-gray-400" />
              <h3 className="mt-2 text-sm font-medium text-gray-900">
                Belum ada submissions
              </h3>
              <p className="mt-1 text-sm text-gray-500">
                Submissions baru akan muncul di sini.
              </p>
            </div>
          ) : (
            <div className="space-y-3">
              {recentSubmissions.map((submission) => (
                <div
                  key={submission.id}
                  className="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center space-x-3 mb-2 sm:mb-0">
                      <div className="flex-shrink-0">
                        {getStatusBadge(submission.approval_status)}
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="text-sm font-medium text-gray-900 truncate">
                          {submission.simlok_number || 'Belum ada nomor'}
                        </p>
                        <p className="text-sm text-gray-500 truncate">
                          {submission.vendor_name}
                        </p>
                      </div>
                    </div>
                    
                    <div className="sm:hidden mt-2">
                      <p className="text-xs text-gray-500 line-clamp-2">
                        {submission.job_description}
                      </p>
                      <p className="text-xs text-gray-400 mt-1">
                        {formatDate(submission.created_at)}
                      </p>
                    </div>
                  </div>

                  <div className="hidden sm:block text-right mr-4">
                    <p className="text-sm text-gray-500 max-w-xs truncate">
                      {submission.job_description}
                    </p>
                    <p className="text-xs text-gray-400">
                      {formatDate(submission.created_at)}
                    </p>
                  </div>

                  <div className="mt-3 sm:mt-0 sm:ml-4">
                    <Button
                      onClick={() => window.location.href = `/verifier/submissions/${submission.id}`}
                      variant="outline"
                      size="sm"
                      className="w-full sm:w-auto"
                    >
                      <EyeIcon className="w-4 h-4 mr-1" />
                      <span className="sm:hidden">Lihat Detail</span>
                      <span className="hidden sm:inline">Detail</span>
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* QR Code Scanner */}
      {scannerOpen && (
        <CameraQRScanner
          isOpen={scannerOpen}
          onClose={() => setScannerOpen(false)}
          onScan={handleScanResult}
          title="Scan QR Code SIMLOK"
          description="Arahkan kamera ke QR code SIMLOK untuk memverifikasi"
        />
      )}
    </div>
  );
}

=== FILE: src/components/verifier/VerifierDashboard.tsx ===
'use client';

import { useState, useEffect, useRef } from 'react';
import { 
  EyeIcon,
  CheckCircleIcon,
  XCircleIcon,
  ClockIcon,
  QrCodeIcon,
  MapPinIcon,
  BuildingOfficeIcon,
  UserIcon,
  ArrowRightIcon,
  DocumentTextIcon,
  UsersIcon,
  BriefcaseIcon,
  CalendarDaysIcon,
  XMarkIcon,
  DocumentCheckIcon,
  CameraIcon
} from '@heroicons/react/24/outline';
import { format } from 'date-fns';
import { id } from 'date-fns/locale';
import { useToast } from '@/hooks/useToast';
import Button from '../ui/button/Button';
import LoadingSpinner from '../ui/LoadingSpinner';
import CameraQRScanner from '../scanner/CameraQRScanner';

interface SubmissionData {
  id: string;
  vendor_name: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation: string;
  approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';
  simlok_number?: string;
  simlok_date?: string;
  created_at: string;
  working_hours?: string;
  worker_count?: number;
  implementation_start_date?: string;
  implementation_end_date?: string;
  simja_number?: string;
  sika_number?: string;
}

interface QrScan {
  id: string;
  submission_id: string;
  scanned_by: string;
  scanned_at: string;
  scanner_name: string;
  scan_location?: string;
  notes?: string;
  submission: {
    id: string;
    simlok_number?: string;
    vendor_name: string;
    officer_name: string;
    job_description: string;
    work_location: string;
    approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';
    working_hours?: string;
    implementation?: string;
    simja_number?: string;
    sika_number?: string;
    worker_count?: number;
    implementation_start_date?: string;
    implementation_end_date?: string;
    created_at?: string;
  };
}

export default function VerifierDashboard() {
  const { showError } = useToast();
  
  const [recentScans, setRecentScans] = useState<QrScan[]>([]);
  const [stats, setStats] = useState({
    totalScans: 0,
    todayScans: 0,
    totalSubmissions: 0,
    approvedSubmissions: 0
  });
  const [loading, setLoading] = useState(true);
  const [selectedSubmission, setSelectedSubmission] = useState<SubmissionData | null>(null);
  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);
  const [scannerOpen, setScannerOpen] = useState(false);
  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    setLoading(true);
    try {
      // Fetch stats, recent submissions, and recent scans in parallel
      const [submissionsRes, scansRes, statsRes] = await Promise.all([
        fetch('/api/verifier/submissions?limit=5&offset=0&status=ALL&dateRange=ALL&search='),
        fetch('/api/qr/verify?limit=5&offset=0&search='),
        fetch('/api/verifier/stats')
      ]);

      if (submissionsRes.ok) {
        await submissionsRes.json();
        // Data submissions tersimpan tapi tidak ditampilkan di dashboard
      }

      if (scansRes.ok) {
        const scanData = await scansRes.json();
        setRecentScans(scanData.scans || []);
      }

      if (statsRes.ok) {
        const statsData = await statsRes.json();
        setStats(statsData);
      }
    } catch (error) {
      console.error('Error fetching dashboard data:', error);
      showError('Error', 'Gagal memuat data dashboard');
    } finally {
      setLoading(false);
    }
  };

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
            <ClockIcon className="w-3 h-3 mr-1" />
            Pending
          </span>
        );
      case 'APPROVED':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            <CheckCircleIcon className="w-3 h-3 mr-1" />
            Approved
          </span>
        );
      case 'REJECTED':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
            <XCircleIcon className="w-3 h-3 mr-1" />
            Rejected
          </span>
        );
      default:
        return null;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center py-12">
        <LoadingSpinner size="lg" />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Total Scan QR</h3>
              <p className="text-2xl font-bold text-blue-600 mt-1">{stats.totalScans}</p>
            </div>
            <div className="p-3 bg-blue-100 rounded-full">
              <QrCodeIcon className="w-6 h-6 text-blue-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Scan Hari Ini</h3>
              <p className="text-2xl font-bold text-green-600 mt-1">{stats.todayScans}</p>
            </div>
            <div className="p-3 bg-green-100 rounded-full">
              <CalendarDaysIcon className="w-6 h-6 text-green-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Total Submission</h3>
              <p className="text-2xl font-bold text-purple-600 mt-1">{stats.totalSubmissions}</p>
            </div>
            <div className="p-3 bg-purple-100 rounded-full">
              <DocumentTextIcon className="w-6 h-6 text-purple-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl border shadow-sm p-6">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-sm font-medium text-gray-500">Disetujui</h3>
              <p className="text-2xl font-bold text-amber-600 mt-1">{stats.approvedSubmissions}</p>
            </div>
            <div className="p-3 bg-amber-100 rounded-full">
              <DocumentCheckIcon className="w-6 h-6 text-amber-600" />
            </div>
          </div>
        </div>
      </div>

      {/* Quick Scan Actions */}
      <div className="bg-white shadow rounded-lg p-6">
        <div className="text-center">
          <h2 className="text-xl font-semibold text-gray-900 mb-4">
            Barcode & QR Code Scanner
          </h2>
          <p className="text-gray-600 mb-6">
            Scan barcode atau QR code SIMLOK untuk verifikasi. Scanner mendukung berbagai format: QR Code, Code 128, Code 39, EAN, UPC. Pastikan browser mengizinkan akses kamera.
          </p>
          
          <div className="flex justify-center">
            <Button
              onClick={() => {
                console.log('Opening barcode scanner from verifier dashboard');
                // Close any open detail modals from scan history
                if (scanHistoryRef.current?.closeDetailModal) {
                  scanHistoryRef.current.closeDetailModal();
                }
                setScannerOpen(true);
              }}
              className="bg-blue-600 hover:bg-blue-700"
              size="lg"
            >
              <CameraIcon className="w-6 h-6 mr-2" />
              Mulai Scan Barcode/QR Code
            </Button>
          </div>
        </div>
      </div>

      {/* Recent Scans */}
      <div className="bg-white shadow rounded-lg">
        <div className="px-6 py-4 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <div>
              <h3 className="text-lg font-medium text-gray-900">Scan QR Terbaru</h3>
              <p className="text-sm text-gray-500">5 scan terakhir yang telah dilakukan</p>
            </div>
            <Button
              onClick={() => window.location.href = '/verifier/history'}
              variant="outline"
              size="sm"
            >
              Lihat Semua
              <ArrowRightIcon className="w-4 h-4 ml-2" />
            </Button>
          </div>
        </div>
        
        {recentScans.length === 0 ? (
          <div className="text-center py-12">
            <QrCodeIcon className="mx-auto h-12 w-12 text-gray-400" />
            <h3 className="mt-2 text-sm font-medium text-gray-900">
              Belum ada scan
            </h3>
            <p className="mt-1 text-sm text-gray-500">
              Belum ada QR code yang di-scan hari ini.
            </p>
          </div>
        ) : (
          <div className="divide-y divide-gray-200">
            {recentScans.map((scan) => (
              <div key={scan.id} className="p-4 hover:bg-gray-50 transition-colors">
                <div className="flex items-center justify-between">
                  <div className="flex-1">
                    <div className="flex items-center space-x-3">
                      <div className="p-2 bg-blue-100 rounded-lg">
                        <QrCodeIcon className="w-5 h-5 text-blue-600" />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center space-x-2">
                          <p className="text-sm font-medium text-gray-900">
                            {scan.submission.simlok_number || 'Belum ada nomor'}
                          </p>
                          {getStatusBadge(scan.submission.approval_status)}
                        </div>
                        <p className="text-xs text-gray-500 mt-1">
                          {scan.submission.vendor_name} • {scan.submission.officer_name}
                        </p>
                        <div className="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                          <span className="flex items-center">
                            <CalendarDaysIcon className="w-3 h-3 mr-1" />
                            {format(new Date(scan.scanned_at), 'dd MMM yyyy HH:mm', { locale: id })}
                          </span>
                          {scan.scan_location && (
                            <span className="flex items-center">
                              <MapPinIcon className="w-3 h-3 mr-1" />
                              {scan.scan_location}
                            </span>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                  <Button
                    onClick={() => setSelectedScan(scan)}
                    variant="outline"
                    size="sm"
                  >
                    <EyeIcon className="w-4 h-4 mr-1" />
                    Detail
                  </Button>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
      
      {/* Enhanced Scan Detail Modal */}
      {selectedScan && (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200">
          <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300">
            {/* Modal Header */}
            <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className="p-2 bg-white/20 rounded-lg">
                    <QrCodeIcon className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold">Detail Scan QR Code</h3>
                    <p className="text-blue-100 text-sm">
                      {selectedScan.submission.simlok_number || 'Informasi Pengajuan'}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedScan(null)}
                  className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                >
                  <XMarkIcon className="w-6 h-6 text-white" />
                </button>
              </div>
            </div>

            {/* Modal Content */}
            <div className="p-6 overflow-y-auto max-h-[calc(90vh-100px)]">
              {/* Status Banner */}
              <div className="mb-6">
                {selectedScan.submission.approval_status === 'PENDING' && (
                  <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <ClockIcon className="w-5 h-5 text-yellow-600 mr-2" />
                      <span className="font-semibold text-yellow-800">Status: Menunggu Persetujuan</span>
                    </div>
                  </div>
                )}
                {selectedScan.submission.approval_status === 'APPROVED' && (
                  <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <CheckCircleIcon className="w-5 h-5 text-green-600 mr-2" />
                      <span className="font-semibold text-green-800">Status: Telah Disetujui</span>
                    </div>
                  </div>
                )}
                {selectedScan.submission.approval_status === 'REJECTED' && (
                  <div className="bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <XCircleIcon className="w-5 h-5 text-red-600 mr-2" />
                      <span className="font-semibold text-red-800">Status: Ditolak</span>
                    </div>
                  </div>
                )}
              </div>

              {/* Main Content Grid */}
              <div className="space-y-6">
                {/* Submission Information */}
                <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200">
                  <div className="flex items-center mb-6">
                    <div className="p-3 bg-blue-100 rounded-xl mr-4">
                      <DocumentTextIcon className="w-6 h-6 text-blue-600" />
                    </div>
                    <div>
                      <h4 className="text-xl font-bold text-gray-800">Informasi Pengajuan</h4>
                      <p className="text-sm text-gray-500">Detail lengkap pengajuan SIMLOK</p>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {/* Left Column */}
                    <div className="space-y-4">
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <QrCodeIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Nomor SIMLOK</span>
                        </div>
                        <p className="text-lg font-bold text-gray-900">
                          {selectedScan.submission.simlok_number || 'Belum ada nomor'}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <BuildingOfficeIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Perusahaan</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.submission.vendor_name}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <UserIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Petugas PIC</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.submission.officer_name}
                        </p>
                      </div>

                      {selectedScan.submission.worker_count && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <UsersIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Jumlah Pekerja</span>
                          </div>
                          <p className="text-lg font-bold text-gray-900">
                            {selectedScan.submission.worker_count} orang
                          </p>
                        </div>
                      )}
                    </div>

                    {/* Right Column */}
                    <div className="space-y-4">
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <BriefcaseIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Deskripsi Pekerjaan</span>
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed">
                          {selectedScan.submission.job_description}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <MapPinIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Lokasi Kerja</span>
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed">
                          {selectedScan.submission.work_location}
                        </p>
                      </div>

                      {selectedScan.submission.working_hours && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <ClockIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Jam Kerja</span>
                          </div>
                          <p className="text-sm text-gray-700">
                            {selectedScan.submission.working_hours}
                          </p>
                        </div>
                      )}

                      {(selectedScan.submission.implementation_start_date || selectedScan.submission.implementation_end_date) && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <CalendarDaysIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Periode Pelaksanaan</span>
                          </div>
                          <p className="text-sm text-gray-700">
                            {selectedScan.submission.implementation_start_date && 
                              format(new Date(selectedScan.submission.implementation_start_date), 'dd MMM yyyy', { locale: id })}
                            {selectedScan.submission.implementation_start_date && selectedScan.submission.implementation_end_date && ' - '}
                            {selectedScan.submission.implementation_end_date && 
                              format(new Date(selectedScan.submission.implementation_end_date), 'dd MMM yyyy', { locale: id })}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Document Numbers */}
                  {(selectedScan.submission.simja_number || selectedScan.submission.sika_number) && (
                    <div className="mt-6 pt-4 border-t border-gray-200">
                      <h5 className="text-sm font-semibold text-gray-700 mb-3">Nomor Dokumen Pendukung</h5>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {selectedScan.submission.simja_number && (
                          <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                            <span className="text-xs font-medium text-blue-600">SIMJA</span>
                            <p className="text-sm font-semibold text-blue-900 mt-1">
                              {selectedScan.submission.simja_number}
                            </p>
                          </div>
                        )}
                        {selectedScan.submission.sika_number && (
                          <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                            <span className="text-xs font-medium text-green-600">SIKA</span>
                            <p className="text-sm font-semibold text-green-900 mt-1">
                              {selectedScan.submission.sika_number}
                            </p>
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>

                {/* Scan Information */}
                <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                  <div className="flex items-center mb-6">
                    <div className="p-3 bg-blue-100 rounded-xl mr-4">
                      <QrCodeIcon className="w-6 h-6 text-blue-600" />
                    </div>
                    <div>
                      <h4 className="text-xl font-bold text-gray-800">Detail Scan QR Code</h4>
                      <p className="text-sm text-gray-500">Informasi verifikasi dan validasi</p>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div className="bg-white rounded-lg p-4 border border-blue-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <CalendarDaysIcon className="w-4 h-4 text-blue-600" />
                        <span className="text-sm font-medium text-gray-600">Tanggal Scan</span>
                      </div>
                      <p className="text-lg font-bold text-gray-900">
                        {format(new Date(selectedScan.scanned_at), 'dd MMMM yyyy', { locale: id })}
                      </p>
                      <p className="text-sm text-gray-600">
                        {format(new Date(selectedScan.scanned_at), "HH:mm:ss 'WIB'", { locale: id })}
                      </p>
                    </div>
                    
                    <div className="bg-white rounded-lg p-4 border border-blue-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <MapPinIcon className="w-4 h-4 text-blue-600" />
                        <span className="text-sm font-medium text-gray-600">Lokasi Scan</span>
                      </div>
                      <p className="text-sm font-semibold text-gray-900">
                        {selectedScan.scan_location || 'Lokasi tidak diketahui'}
                      </p>
                    </div>

                    {selectedScan.scanner_name && (
                      <div className="bg-white rounded-lg p-4 border border-blue-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <UserIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Scanner</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.scanner_name}
                        </p>
                      </div>
                    )}
                  </div>

                  {/* <div className="mt-4 bg-white rounded-lg p-4 border border-blue-200">
                    <div className="flex items-center space-x-2 mb-2">
                      <CheckCircleIcon className="w-4 h-4 text-blue-600" />
                      <span className="text-sm font-medium text-gray-600">ID Scan</span>
                    </div>
                    <p className="text-xs font-mono text-gray-600 bg-gray-100 px-3 py-2 rounded-lg">
                      {selectedScan.id}
                    </p>
                  </div> */}
                </div>
              </div>

              {/* Action Buttons */}
              <div className="mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200">
                <Button
                  variant="secondary"
                  onClick={() => setSelectedScan(null)}
                  className="px-6"
                >
                  Tutup
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Enhanced Submission Detail Modal */}
      {selectedSubmission && (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200">
          <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300">
            {/* Modal Header */}
            <div className="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className="p-2 bg-white/20 rounded-lg">
                    <DocumentTextIcon className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold">Detail Submission</h3>
                    <p className="text-purple-100 text-sm">
                      {selectedSubmission.simlok_number || 'Informasi Pengajuan'}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedSubmission(null)}
                  className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                >
                  <XMarkIcon className="w-6 h-6 text-white" />
                </button>
              </div>
            </div>

            {/* Modal Content */}
            <div className="p-6 overflow-y-auto max-h-[calc(90vh-100px)]">
              {/* Status Banner */}
              <div className="mb-6">
                {selectedSubmission.approval_status === 'PENDING' && (
                  <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <ClockIcon className="w-5 h-5 text-yellow-600 mr-2" />
                      <span className="font-semibold text-yellow-800">Status: Menunggu Persetujuan</span>
                    </div>
                  </div>
                )}
                {selectedSubmission.approval_status === 'APPROVED' && (
                  <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <CheckCircleIcon className="w-5 h-5 text-green-600 mr-2" />
                      <span className="font-semibold text-green-800">Status: Telah Disetujui</span>
                    </div>
                  </div>
                )}
                {selectedSubmission.approval_status === 'REJECTED' && (
                  <div className="bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <XCircleIcon className="w-5 h-5 text-red-600 mr-2" />
                      <span className="font-semibold text-red-800">Status: Ditolak</span>
                    </div>
                  </div>
                )}
              </div>

              {/* Submission Information */}
              <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200">
                <div className="flex items-center mb-6">
                  <div className="p-3 bg-purple-100 rounded-xl mr-4">
                    <DocumentTextIcon className="w-6 h-6 text-purple-600" />
                  </div>
                  <div>
                    <h4 className="text-xl font-bold text-gray-800">Informasi Pengajuan SIMLOK</h4>
                    <p className="text-sm text-gray-500">Detail lengkap pengajuan submission</p>
                  </div>
                </div>
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Left Column */}
                  <div className="space-y-4">
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <QrCodeIcon className="w-4 h-4 text-purple-600" />
                        <span className="text-sm font-medium text-gray-600">Nomor SIMLOK</span>
                      </div>
                      <p className="text-lg font-bold text-gray-900">
                        {selectedSubmission.simlok_number || 'Belum ada nomor'}
                      </p>
                    </div>
                    
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <BuildingOfficeIcon className="w-4 h-4 text-purple-600" />
                        <span className="text-sm font-medium text-gray-600">Perusahaan</span>
                      </div>
                      <p className="text-sm font-semibold text-gray-900">
                        {selectedSubmission.vendor_name}
                      </p>
                    </div>
                    
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <UserIcon className="w-4 h-4 text-purple-600" />
                        <span className="text-sm font-medium text-gray-600">Petugas PIC</span>
                      </div>
                      <p className="text-sm font-semibold text-gray-900">
                        {selectedSubmission.officer_name}
                      </p>
                    </div>

                    {selectedSubmission.worker_count && (
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <UsersIcon className="w-4 h-4 text-purple-600" />
                          <span className="text-sm font-medium text-gray-600">Jumlah Pekerja</span>
                        </div>
                        <p className="text-lg font-bold text-gray-900">
                          {selectedSubmission.worker_count} orang
                        </p>
                      </div>
                    )}
                  </div>

                  {/* Right Column */}
                  <div className="space-y-4">
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <BriefcaseIcon className="w-4 h-4 text-purple-600" />
                        <span className="text-sm font-medium text-gray-600">Deskripsi Pekerjaan</span>
                      </div>
                      <p className="text-sm text-gray-700 leading-relaxed">
                        {selectedSubmission.job_description}
                      </p>
                    </div>
                    
                    <div className="bg-white rounded-lg p-4 border border-gray-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <MapPinIcon className="w-4 h-4 text-purple-600" />
                        <span className="text-sm font-medium text-gray-600">Lokasi Kerja</span>
                      </div>
                      <p className="text-sm text-gray-700 leading-relaxed">
                        {selectedSubmission.work_location}
                      </p>
                    </div>

                    {selectedSubmission.working_hours && (
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <ClockIcon className="w-4 h-4 text-purple-600" />
                          <span className="text-sm font-medium text-gray-600">Jam Kerja</span>
                        </div>
                        <p className="text-sm text-gray-700">
                          {selectedSubmission.working_hours}
                        </p>
                      </div>
                    )}

                    {(selectedSubmission.implementation_start_date || selectedSubmission.implementation_end_date) && (
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <CalendarDaysIcon className="w-4 h-4 text-purple-600" />
                          <span className="text-sm font-medium text-gray-600">Periode Pelaksanaan</span>
                        </div>
                        <p className="text-sm text-gray-700">
                          {selectedSubmission.implementation_start_date && 
                            format(new Date(selectedSubmission.implementation_start_date), 'dd MMM yyyy', { locale: id })}
                          {selectedSubmission.implementation_start_date && selectedSubmission.implementation_end_date && ' - '}
                          {selectedSubmission.implementation_end_date && 
                            format(new Date(selectedSubmission.implementation_end_date), 'dd MMM yyyy', { locale: id })}
                        </p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Document Numbers */}
                {(selectedSubmission.simja_number || selectedSubmission.sika_number) && (
                  <div className="mt-6 pt-4 border-t border-gray-200">
                    <h5 className="text-sm font-semibold text-gray-700 mb-3">Nomor Dokumen Pendukung</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {selectedSubmission.simja_number && (
                        <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                          <span className="text-xs font-medium text-blue-600">SIMJA</span>
                          <p className="text-sm font-semibold text-blue-900 mt-1">
                            {selectedSubmission.simja_number}
                          </p>
                        </div>
                      )}
                      {selectedSubmission.sika_number && (
                        <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                          <span className="text-xs font-medium text-green-600">SIKA</span>
                          <p className="text-sm font-semibold text-green-900 mt-1">
                            {selectedSubmission.sika_number}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>

              {/* Action Buttons */}
              <div className="mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200">
                <Button
                  variant="secondary"
                  onClick={() => setSelectedSubmission(null)}
                  className="px-6"
                >
                  Tutup
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Barcode & QR Code Scanner Modal */}
      <CameraQRScanner
        isOpen={scannerOpen}
        onClose={() => {
          console.log('Closing barcode scanner from verifier dashboard');
          setScannerOpen(false);
        }}
        onScan={(result: string) => {
          console.log('Barcode/QR Scanned in verifier:', result);
          // Scanner will handle the verification automatically
          // Just close the scanner after successful scan
          setScannerOpen(false);
        }}
        title="Scan Barcode/QR Code SIMLOK"
        description="Arahkan kamera ke barcode atau QR code SIMLOK untuk memverifikasi"
      />
    </div>
  );
}

=== FILE: src/components/verifier/VerifierScanHistory.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { 
  CalendarDaysIcon,
  EyeIcon,
  MagnifyingGlassIcon,
  QrCodeIcon,
  ClockIcon,
  MapPinIcon,
  BuildingOfficeIcon,
  UserIcon,
  CheckCircleIcon,
  XCircleIcon,
  FunnelIcon,
  XMarkIcon,
  DocumentTextIcon,
  UsersIcon,
  BriefcaseIcon
} from '@heroicons/react/24/outline';
import { format } from 'date-fns';
import { id } from 'date-fns/locale';
import { useToast } from '@/hooks/useToast';
import Button from '../ui/button/Button';
import LoadingSpinner from '../ui/LoadingSpinner';

interface QrScan {
  id: string;
  submission_id: string;
  scanned_by: string;
  scanned_at: string;
  scanner_name: string;
  scan_location?: string;
  notes?: string;
  submission: {
    id: string;
    simlok_number?: string;
    vendor_name: string;
    officer_name: string;
    job_description: string;
    work_location: string;
    approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';
    working_hours?: string;
    implementation?: string;
    simja_number?: string;
    sika_number?: string;
    worker_count?: number;
    implementation_start_date?: string;
    implementation_end_date?: string;
    created_at?: string;
    review_status?: 'PENDING' | 'APPROVED' | 'REJECTED';
    final_status?: 'PENDING' | 'APPROVED' | 'REJECTED';
  };
}

export default function VerifierScanHistory() {
  const { showError } = useToast();
  
  const [scans, setScans] = useState<QrScan[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [showFilters, setShowFilters] = useState(false);
  const [filters, setFilters] = useState({
    status: '',
    dateFrom: '',
    dateTo: '',
    location: ''
  });
  const [pagination, setPagination] = useState({
    total: 0,
    limit: 20,
    offset: 0,
    hasMore: true
  });
  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);

  useEffect(() => {
    fetchScanHistory();
  }, [pagination.offset, searchTerm, filters]);

  const fetchScanHistory = async () => {
    setLoading(true);
    try {
      const params = new URLSearchParams({
        limit: pagination.limit.toString(),
        offset: pagination.offset.toString(),
        search: searchTerm
      });

      // Add filters to params
      if (filters.status) params.append('status', filters.status);
      if (filters.dateFrom) params.append('dateFrom', filters.dateFrom);
      if (filters.dateTo) params.append('dateTo', filters.dateTo);
      if (filters.location) params.append('location', filters.location);

      const response = await fetch(`/api/qr/verify?${params}`);
      if (response.ok) {
        const data = await response.json();
        setScans(data.scans || []);
        setPagination(prev => ({
          ...prev,
          total: data.pagination?.total || 0,
          hasMore: data.pagination?.hasMore || false
        }));
      } else {
        showError('Error', 'Gagal memuat riwayat scan');
      }
    } catch (error) {
      console.error('Error fetching scan history:', error);
      showError('Error', 'Gagal memuat riwayat scan');
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = (value: string) => {
    setSearchTerm(value);
    setPagination(prev => ({ ...prev, offset: 0 }));
  };

  const handleFilterChange = (key: string, value: string) => {
    setFilters(prev => ({ ...prev, [key]: value }));
    setPagination(prev => ({ ...prev, offset: 0 }));
  };

  const clearFilters = () => {
    setFilters({
      status: '',
      dateFrom: '',
      dateTo: '',
      location: ''
    });
    setPagination(prev => ({ ...prev, offset: 0 }));
  };

  const hasActiveFilters = Object.values(filters).some(value => value !== '');

  const loadMore = () => {
    setPagination(prev => ({
      ...prev,
      offset: prev.offset + prev.limit
    }));
  };

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'PENDING':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
            <ClockIcon className="w-3 h-3 mr-1" />
            Pending
          </span>
        );
      case 'APPROVED':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            <CheckCircleIcon className="w-3 h-3 mr-1" />
            Approved
          </span>
        );
      case 'REJECTED':
        return (
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
            <XCircleIcon className="w-3 h-3 mr-1" />
            Rejected
          </span>
        );
      default:
        return null;
    }
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'long',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const formatDateShort = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('id-ID', {
      day: 'numeric',
      month: 'short',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  return (
    <div className="space-y-6">
      {/* Header Section */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl font-semibold text-gray-900">Riwayat Scan QR</h1>
          <p className="text-sm text-gray-600 mt-1">
            Daftar SIMLOK yang telah Anda scan
          </p>
        </div>
        
        <div className="flex items-center text-sm text-gray-500">
          <CalendarDaysIcon className="w-4 h-4 mr-2" />
          Total: {pagination.total} scan
        </div>
      </div>

      {/* Search and Filter Section */}
      <div className="bg-white shadow rounded-lg">
        <div className="p-4 space-y-4">
          {/* Search Bar */}
          <div className="relative">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <MagnifyingGlassIcon className="h-5 w-5 text-gray-400" />
            </div>
            <input
              type="text"
              value={searchTerm}
              onChange={(e) => handleSearch(e.target.value)}
              className="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Cari nomor SIMLOK, vendor, atau lokasi scan..."
            />
          </div>

          {/* Filter Toggle Button */}
          <div className="flex items-center justify-between">
            <Button
              onClick={() => setShowFilters(!showFilters)}
              variant="outline"
              size="sm"
              className={showFilters ? 'bg-blue-50 text-blue-700 border-blue-200' : ''}
            >
              <FunnelIcon className="w-4 h-4 mr-2" />
              Filter
              {hasActiveFilters && (
                <span className="ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full">
                  {Object.values(filters).filter(v => v !== '').length}
                </span>
              )}
            </Button>

            {hasActiveFilters && (
              <Button
                onClick={clearFilters}
                variant="ghost"
                size="sm"
                className="text-gray-500 hover:text-gray-700"
              >
                <XMarkIcon className="w-4 h-4 mr-1" />
                Clear
              </Button>
            )}
          </div>

          {/* Filter Panel */}
          {showFilters && (
            <div className="border-t pt-4 space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                {/* Status Filter */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Status
                  </label>
                  <select
                    value={filters.status}
                    onChange={(e) => handleFilterChange('status', e.target.value)}
                    className="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                  >
                    <option value="">Semua Status</option>
                    <option value="PENDING">Pending</option>
                    <option value="APPROVED">Approved</option>
                    <option value="REJECTED">Rejected</option>
                  </select>
                </div>

                {/* Date From Filter */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Dari
                  </label>
                  <input
                    type="date"
                    value={filters.dateFrom}
                    onChange={(e) => handleFilterChange('dateFrom', e.target.value)}
                    className="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                  />
                </div>

                {/* Date To Filter */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Tanggal Sampai
                  </label>
                  <input
                    type="date"
                    value={filters.dateTo}
                    onChange={(e) => handleFilterChange('dateTo', e.target.value)}
                    className="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                  />
                </div>

                {/* Location Filter */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Lokasi Scan
                  </label>
                  <input
                    type="text"
                    value={filters.location}
                    onChange={(e) => handleFilterChange('location', e.target.value)}
                    placeholder="Lokasi scan..."
                    className="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                  />
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Scan History List */}
      <div className="bg-white shadow rounded-lg">
        {loading && pagination.offset === 0 ? (
          <div className="flex items-center justify-center py-12">
            <LoadingSpinner size="lg" />
          </div>
        ) : scans.length === 0 ? (
          <div className="text-center py-12">
            <QrCodeIcon className="mx-auto h-12 w-12 text-gray-400" />
            <h3 className="mt-2 text-sm font-medium text-gray-900">
              Belum ada riwayat scan
            </h3>
            <p className="mt-1 text-sm text-gray-500">
              {searchTerm ? 'Tidak ada hasil yang sesuai dengan pencarian.' : 'Anda belum melakukan scan QR code SIMLOK.'}
            </p>
          </div>
        ) : (
          <>
            {/* Mobile Card Layout */}
            <div className="block lg:hidden">
              <div className="divide-y divide-gray-200">
                {scans.map((scan) => (
                  <div key={scan.id} className="p-4 hover:bg-gray-50 transition-colors">
                    {/* Header with Status and Date */}
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center space-x-2">
                        {getStatusBadge(scan.submission.approval_status)}
                      </div>
                      <div className="text-xs text-gray-500">
                        {formatDateShort(scan.scanned_at)}
                      </div>
                    </div>

                    {/* SIMLOK Number */}
                    <div className="mb-3">
                      <div className="text-sm font-medium text-gray-900 flex items-center">
                        <QrCodeIcon className="w-4 h-4 mr-2 text-blue-500" />
                        {scan.submission.simlok_number || 'Belum ada nomor'}
                      </div>
                    </div>

                    {/* Vendor Info */}
                    <div className="mb-3">
                      <div className="text-sm font-medium text-gray-900 mb-1 flex items-center">
                        <BuildingOfficeIcon className="w-4 h-4 mr-2 text-gray-400" />
                        {scan.submission.vendor_name}
                      </div>
                      <div className="text-xs text-gray-500 flex items-center ml-6">
                        <UserIcon className="w-3 h-3 mr-1" />
                        {scan.submission.officer_name}
                      </div>
                    </div>

                    {/* Scan Location */}
                    {scan.scan_location && (
                      <div className="mb-3">
                        <div className="text-xs text-gray-500 flex items-center">
                          <MapPinIcon className="w-3 h-3 mr-1" />
                          Discan di: {scan.scan_location}
                        </div>
                      </div>
                    )}

                    {/* Action Button */}
                    <div className="flex justify-end">
                      <Button
                        onClick={() => setSelectedScan(scan)}
                        variant="outline"
                        size="sm"
                        className="w-full sm:w-auto"
                      >
                        <EyeIcon className="w-4 h-4 mr-2" />
                        Lihat Detail
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Desktop Table Layout */}
            <div className="hidden lg:block">
              <div className="overflow-hidden  md:rounded-lg">
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200" style={{tableLayout: 'fixed', width: '100%'}}>
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '150px'}}>
                          SIMLOK
                        </th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '200px'}}>
                          Vendor
                        </th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '180px'}}>
                          Lokasi Scan
                        </th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '120px'}}>
                          Status
                        </th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '150px'}}>
                          Waktu Scan
                        </th>
                        <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider" style={{width: '80px'}}>
                          Aksi
                        </th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {scans.map((scan) => (
                        <tr key={scan.id} className="hover:bg-gray-50">
                          <td className="px-4 py-4 text-sm" style={{width: '150px'}}>
                            <div className="font-medium text-gray-900 truncate" title={scan.submission.simlok_number || 'Belum ada nomor'}>
                              {scan.submission.simlok_number || 'Belum ada nomor'}
                            </div>
                          </td>
                          <td className="px-4 py-4 text-sm" style={{width: '200px'}}>
                            <div>
                              <div className="font-medium text-gray-900 truncate" title={scan.submission.vendor_name}>
                                {scan.submission.vendor_name}
                              </div>
                              <div className="text-gray-500 truncate" title={scan.submission.officer_name}>
                                {scan.submission.officer_name}
                              </div>
                            </div>
                          </td>
                          <td className="px-4 py-4 text-sm" style={{width: '180px'}}>
                            <div className="text-gray-900 truncate" title={scan.scan_location || 'Tidak diketahui'}>
                              {scan.scan_location || 'Tidak diketahui'}
                            </div>
                          </td>
                          <td className="px-4 py-4 whitespace-nowrap" style={{width: '120px'}}>
                            {getStatusBadge(scan.submission.approval_status)}
                          </td>
                          <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-500" style={{width: '150px'}}>
                            {formatDate(scan.scanned_at)}
                          </td>
                          <td className="px-4 py-4 whitespace-nowrap text-right text-sm font-medium" style={{width: '80px'}}>
                            <Button
                              onClick={() => setSelectedScan(scan)}
                              variant="outline"
                              size="sm"
                            >
                              <EyeIcon className="w-4 h-4" />
                            </Button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </>
        )}

        {/* Load More */}
        {pagination.hasMore && scans.length > 0 && (
          <div className="px-4 py-4 border-t border-gray-200">
            <Button
              onClick={loadMore}
              disabled={loading}
              variant="outline"
              className="w-full"
            >
              {loading ? (
                <div className="flex items-center justify-center">
                  <LoadingSpinner size="sm" className="mr-2" />
                  Memuat...
                </div>
              ) : (
                'Muat Lebih Banyak'
              )}
            </Button>
          </div>
        )}
      </div>

      {/* Enhanced Detail Modal */}
      {selectedScan && (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200">
          <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300">
            {/* Modal Header */}
            <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className="p-2 bg-white/20 rounded-lg">
                    <QrCodeIcon className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <h3 className="text-xl font-bold">Detail Scan QR Code</h3>
                    <p className="text-blue-100 text-sm">
                      {selectedScan.submission.simlok_number || 'Informasi Pengajuan'}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedScan(null)}
                  className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                >
                  <XMarkIcon className="w-6 h-6 text-white" />
                </button>
              </div>
            </div>

            {/* Modal Content */}
            <div className="p-6 overflow-y-auto max-h-[calc(90vh-100px)]">
              {/* Status Banner */}
              <div className="mb-6">
                {selectedScan.submission.approval_status === 'PENDING' && (
                  <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <ClockIcon className="w-5 h-5 text-yellow-600 mr-2" />
                      <span className="font-semibold text-yellow-800">Status: Menunggu Persetujuan</span>
                    </div>
                  </div>
                )}
                {selectedScan.submission.approval_status === 'APPROVED' && (
                  <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <CheckCircleIcon className="w-5 h-5 text-green-600 mr-2" />
                      <span className="font-semibold text-green-800">Status: Telah Disetujui</span>
                    </div>
                  </div>
                )}
                {selectedScan.submission.approval_status === 'REJECTED' && (
                  <div className="bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg">
                    <div className="flex items-center">
                      <XCircleIcon className="w-5 h-5 text-red-600 mr-2" />
                      <span className="font-semibold text-red-800">Status: Ditolak</span>
                    </div>
                  </div>
                )}
              </div>

              {/* Main Content Grid */}
              <div className="space-y-6">
                {/* Submission Information */}
                <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200">
                  <div className="flex items-center mb-6">
                    <div className="p-3 bg-blue-100 rounded-xl mr-4">
                      <DocumentTextIcon className="w-6 h-6 text-blue-600" />
                    </div>
                    <div>
                      <h4 className="text-xl font-bold text-gray-800">Informasi Pengajuan</h4>
                      <p className="text-sm text-gray-500">Detail lengkap pengajuan SIMLOK</p>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {/* Left Column */}
                    <div className="space-y-4">
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <QrCodeIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Nomor SIMLOK</span>
                        </div>
                        <p className="text-lg font-bold text-gray-900">
                          {selectedScan.submission.simlok_number || 'Belum ada nomor'}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <BuildingOfficeIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Perusahaan</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.submission.vendor_name}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <UserIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Petugas PIC</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.submission.officer_name}
                        </p>
                      </div>

                      {selectedScan.submission.worker_count && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <UsersIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Jumlah Pekerja</span>
                          </div>
                          <p className="text-lg font-bold text-gray-900">
                            {selectedScan.submission.worker_count} orang
                          </p>
                        </div>
                      )}
                    </div>

                    {/* Right Column */}
                    <div className="space-y-4">
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <BriefcaseIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Deskripsi Pekerjaan</span>
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed">
                          {selectedScan.submission.job_description}
                        </p>
                      </div>
                      
                      <div className="bg-white rounded-lg p-4 border border-gray-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <MapPinIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Lokasi Kerja</span>
                        </div>
                        <p className="text-sm text-gray-700 leading-relaxed">
                          {selectedScan.submission.work_location}
                        </p>
                      </div>

                      {selectedScan.submission.working_hours && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <ClockIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Jam Kerja</span>
                          </div>
                          <p className="text-sm text-gray-700">
                            {selectedScan.submission.working_hours}
                          </p>
                        </div>
                      )}

                      {(selectedScan.submission.implementation_start_date || selectedScan.submission.implementation_end_date) && (
                        <div className="bg-white rounded-lg p-4 border border-gray-200">
                          <div className="flex items-center space-x-2 mb-2">
                            <CalendarDaysIcon className="w-4 h-4 text-blue-600" />
                            <span className="text-sm font-medium text-gray-600">Periode Pelaksanaan</span>
                          </div>
                          <p className="text-sm text-gray-700">
                            {selectedScan.submission.implementation_start_date && 
                              format(new Date(selectedScan.submission.implementation_start_date), 'dd MMM yyyy', { locale: id })}
                            {selectedScan.submission.implementation_start_date && selectedScan.submission.implementation_end_date && ' - '}
                            {selectedScan.submission.implementation_end_date && 
                              format(new Date(selectedScan.submission.implementation_end_date), 'dd MMM yyyy', { locale: id })}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Document Numbers */}
                  {(selectedScan.submission.simja_number || selectedScan.submission.sika_number) && (
                    <div className="mt-6 pt-4 border-t border-gray-200">
                      <h5 className="text-sm font-semibold text-gray-700 mb-3">Nomor Dokumen Pendukung</h5>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {selectedScan.submission.simja_number && (
                          <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                            <span className="text-xs font-medium text-blue-600">SIMJA</span>
                            <p className="text-sm font-semibold text-blue-900 mt-1">
                              {selectedScan.submission.simja_number}
                            </p>
                          </div>
                        )}
                        {selectedScan.submission.sika_number && (
                          <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                            <span className="text-xs font-medium text-green-600">SIKA</span>
                            <p className="text-sm font-semibold text-green-900 mt-1">
                              {selectedScan.submission.sika_number}
                            </p>
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>

                {/* Scan Information */}
                <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                  <div className="flex items-center mb-6">
                    <div className="p-3 bg-blue-100 rounded-xl mr-4">
                      <QrCodeIcon className="w-6 h-6 text-blue-600" />
                    </div>
                    <div>
                      <h4 className="text-xl font-bold text-gray-800">Detail Scan QR Code</h4>
                      <p className="text-sm text-gray-500">Informasi verifikasi dan validasi</p>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div className="bg-white rounded-lg p-4 border border-blue-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <CalendarDaysIcon className="w-4 h-4 text-blue-600" />
                        <span className="text-sm font-medium text-gray-600">Tanggal Scan</span>
                      </div>
                      <p className="text-lg font-bold text-gray-900">
                        {format(new Date(selectedScan.scanned_at), 'dd MMMM yyyy', { locale: id })}
                      </p>
                      <p className="text-sm text-gray-600">
                        {format(new Date(selectedScan.scanned_at), "HH:mm:ss 'WIB'", { locale: id })}
                      </p>
                    </div>
                    
                    <div className="bg-white rounded-lg p-4 border border-blue-200">
                      <div className="flex items-center space-x-2 mb-2">
                        <MapPinIcon className="w-4 h-4 text-blue-600" />
                        <span className="text-sm font-medium text-gray-600">Lokasi Scan</span>
                      </div>
                      <p className="text-sm font-semibold text-gray-900">
                        {selectedScan.scan_location || 'Lokasi tidak diketahui'}
                      </p>
                    </div>

                    {selectedScan.scanner_name && (
                      <div className="bg-white rounded-lg p-4 border border-blue-200">
                        <div className="flex items-center space-x-2 mb-2">
                          <UserIcon className="w-4 h-4 text-blue-600" />
                          <span className="text-sm font-medium text-gray-600">Scanner</span>
                        </div>
                        <p className="text-sm font-semibold text-gray-900">
                          {selectedScan.scanner_name}
                        </p>
                      </div>
                    )}
                  </div>

                  {/* <div className="mt-4 bg-white rounded-lg p-4 border border-blue-200">
                    <div className="flex items-center space-x-2 mb-2">
                      <CheckCircleIcon className="w-4 h-4 text-blue-600" />
                      <span className="text-sm font-medium text-gray-600">ID Scan</span>
                    </div>
                    <p className="text-xs font-mono text-gray-600 bg-gray-100 px-3 py-2 rounded-lg">
                      {selectedScan.id}
                    </p>
                  </div> */}
                </div>
              </div>

              {/* Action Buttons */}
              <div className="mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200">
                <Button
                  variant="secondary"
                  onClick={() => setSelectedScan(null)}
                  className="px-6"
                >
                  Tutup
                </Button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

=== FILE: src/context/ThemeContext.tsx ===
"use client";

import type React from "react";
import { createContext, useState, useContext, useEffect } from "react";

type Theme = "light" | "dark";

type ThemeContextType = {
  theme: Theme;
  toggleTheme: () => void;
};

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const [theme, setTheme] = useState<Theme>("light");
  const [isInitialized, setIsInitialized] = useState(false);

  useEffect(() => {
    // This code will only run on the client side
    const savedTheme = localStorage.getItem("theme") as Theme | null;
    const initialTheme = savedTheme || "light"; // Default to light theme

    setTheme(initialTheme);
    setIsInitialized(true);
  }, []);

  useEffect(() => {
    if (isInitialized) {
      localStorage.setItem("theme", theme);
      if (theme === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    }
  }, [theme, isInitialized]);

  const toggleTheme = () => {
    setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
  };

  // Prevent hydration mismatch by not rendering until client-side
  if (!isInitialized) {
    return (
      <ThemeContext.Provider value={{ theme: "light", toggleTheme }}>
        {children}
      </ThemeContext.Provider>
    );
  }

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
};


=== FILE: src/hooks/useImplementationDates.ts ===
import { useState, useCallback, useMemo } from 'react';

export interface ImplementationDates {
  startDate: string;
  endDate: string;
}

export interface ImplementationTemplate {
  pelaksanaan: string;
  lainLain: string;
}

export interface UseImplementationDatesOptions {
  simjaNumber?: string | undefined;
  simjaDate?: string | undefined;
  sikaNumber?: string | undefined;
  sikaDate?: string | undefined;
  signerPosition?: string;
  initialDates?: ImplementationDates;
}

export interface UseImplementationDatesReturn {
  dates: ImplementationDates;
  template: ImplementationTemplate;
  errors: {
    startDate?: string;
    endDate?: string;
  };
  isValid: boolean;
  duration: number | null;
  updateStartDate: (date: string) => void;
  updateEndDate: (date: string) => void;
  updateDates: (dates: ImplementationDates) => void;
  getData: () => { startDate: string; endDate: string; pelaksanaan: string };
  reset: () => void;
}

/**
 * Custom hook untuk mengelola tanggal pelaksanaan dan generate template otomatis
 * Hook ini menangani semua logic terkait tanggal pelaksanaan dengan clean separation of concerns
 */
export function useImplementationDates({
  simjaNumber = '',
  simjaDate = '',
  sikaNumber = '',
  sikaDate = '',
  signerPosition = 'Sr Officer Security III',
  initialDates = { startDate: '', endDate: '' }
}: UseImplementationDatesOptions = {}): UseImplementationDatesReturn {
  
  const [dates, setDates] = useState<ImplementationDates>(initialDates);

  // Validate individual date
  const validateDate = useCallback((dateStr: string): string | undefined => {
    if (!dateStr) return undefined;
    
    try {
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) {
        return 'Format tanggal tidak valid';
      }
      
      // Check if date is in the past (optional validation)
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      if (date < today) {
        return 'Tanggal tidak boleh di masa lalu';
      }
      
      return undefined;
    } catch (error) {
      return 'Format tanggal tidak valid';
    }
  }, []);

  // Validate date range
  const errors = useMemo(() => {
    const result: { startDate?: string; endDate?: string } = {};
    
    // Validate start date
    const startError = validateDate(dates.startDate);
    if (startError) {
      result.startDate = startError;
    }
    
    // Validate end date
    const endError = validateDate(dates.endDate);
    if (endError) {
      result.endDate = endError;
    }
    
    // Validate range if both dates are valid
    if (!startError && !endError && dates.startDate && dates.endDate) {
      const startDate = new Date(dates.startDate);
      const endDate = new Date(dates.endDate);
      
      if (endDate < startDate) {
        result.endDate = 'Tanggal selesai harus setelah tanggal mulai';
      }
      
      // Check if range is reasonable (not more than 1 year)
      const diffTime = endDate.getTime() - startDate.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays > 365) {
        result.endDate = 'Periode pelaksanaan tidak boleh lebih dari 1 tahun';
      }
    }
    
    return result;
  }, [dates, validateDate]);

  // Check if dates are valid
  const isValid = useMemo(() => {
    return dates.startDate !== '' && 
           dates.endDate !== '' && 
           Object.keys(errors).length === 0;
  }, [dates, errors]);

  // Calculate duration in days
  const duration = useMemo((): number | null => {
    if (!dates.startDate || !dates.endDate || !isValid) {
      return null;
    }
    
    try {
      const startDate = new Date(dates.startDate);
      const endDate = new Date(dates.endDate);
      
      const diffTime = endDate.getTime() - startDate.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both dates
      
      return diffDays > 0 ? diffDays : null;
    } catch (error) {
      return null;
    }
  }, [dates, isValid]);

  // Format date for Indonesian locale
  const formatDateIndonesian = useCallback((dateStr: string): string => {
    if (!dateStr) return '[tanggal]';
    
    try {
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return '[tanggal]';
      
      return date.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
    } catch (error) {
      return '[tanggal]';
    }
  }, []);

  // Generate pelaksanaan template
  const pelaksanaanTemplate = useMemo((): string => {
    if (!dates.startDate || !dates.endDate || !isValid) {
      return '';
    }
    
    const startDateFormatted = formatDateIndonesian(dates.startDate);
    const endDateFormatted = formatDateIndonesian(dates.endDate);
    
    return `Terhitung mulai tanggal ${startDateFormatted} sampai ${endDateFormatted}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;
  }, [dates, isValid, formatDateIndonesian]);

  // Generate lain-lain template
  const lainLainTemplate = useMemo((): string => {
    if (!dates.startDate || !dates.endDate || !isValid) {
      return '';
    }

    const templateParts: string[] = [];
    
    // Header
    templateParts.push('Izin diberikan berdasarkan :');
    
    // SIMJA section
    if (simjaNumber && simjaDate) {
      const simjaDateFormatted = formatDateIndonesian(simjaDate);
      templateParts.push(
        '• <strong>SIMJA</strong> Ast. Man. Facility Management',
        `  <strong>No. ${simjaNumber}</strong> <strong>Tanggal ${simjaDateFormatted}</strong>`
      );
    } else {
      templateParts.push(
        '• <strong>SIMJA</strong> Ast. Man. Facility Management',
        '  <strong>No. [nomor]</strong> <strong>Tanggal [tanggal]</strong>'
      );
    }
    
    // SIKA section
    if (sikaNumber && sikaDate) {
      const sikaDateFormatted = formatDateIndonesian(sikaDate);
      templateParts.push(
        '• <strong>SIKA</strong> Pekerjaan Dingin',
        `  <strong>No.${sikaNumber}</strong> <strong>Tgl. ${sikaDateFormatted}</strong>`
      );
    } else {
      templateParts.push(
        '• <strong>SIKA</strong> Pekerjaan Dingin',
        '  <strong>No.[nomor]</strong> <strong>Tgl. [tanggal]</strong>'
      );
    }
    
    // Security approval section
    const todayStr = new Date().toISOString().split('T')[0] || '';
    const today = formatDateIndonesian(todayStr);
    templateParts.push(
      '',
      `Diterima ${signerPosition}`,
      `<strong>${today}</strong>`
    );
    
    return templateParts.join('\n');
  }, [dates, isValid, simjaNumber, simjaDate, sikaNumber, sikaDate, signerPosition, formatDateIndonesian]);

  // Template object
  const template = useMemo((): ImplementationTemplate => ({
    pelaksanaan: pelaksanaanTemplate,
    lainLain: lainLainTemplate
  }), [pelaksanaanTemplate, lainLainTemplate]);

  // Update handlers
  const updateStartDate = useCallback((date: string) => {
    setDates(prev => ({ ...prev, startDate: date }));
  }, []);

  const updateEndDate = useCallback((date: string) => {
    setDates(prev => ({ ...prev, endDate: date }));
  }, []);

  const updateDates = useCallback((newDates: ImplementationDates) => {
    setDates(newDates);
  }, []);

  const reset = useCallback(() => {
    setDates({ startDate: '', endDate: '' });
  }, []);

  const getData = useCallback(() => ({
    startDate: dates.startDate,
    endDate: dates.endDate,
    pelaksanaan: template.pelaksanaan
  }), [dates, template.pelaksanaan]);

  return {
    dates,
    template,
    errors,
    isValid,
    duration,
    updateStartDate,
    updateEndDate,
    updateDates,
    getData,
    reset
  };
}

=== FILE: src/hooks/useModal.ts ===
import { useState } from 'react';

export const useModal = () => {
  const [isOpen, setIsOpen] = useState(false);

  const openModal = () => setIsOpen(true);
  const closeModal = () => setIsOpen(false);

  return {
    isOpen,
    openModal,
    closeModal,
  };
};

=== FILE: src/hooks/useRealTimeNotifications.ts ===
import { useEffect, useRef } from 'react';
import { useSession } from 'next-auth/react';
import { useNotificationsStore } from '@/store/notifications';

interface SSEMessage {
  type: string;
  data?: any;
  message?: string;
  timestamp?: string;
}

export function useRealTimeNotifications() {
  const { data: session } = useSession();
  const eventSourceRef = useRef<EventSource | null>(null);
  const { addItem, setUnreadCount, removeNotifications } = useNotificationsStore();

  useEffect(() => {
    if (!session?.user) {
      // Clean up EventSource if user logs out
      if (eventSourceRef.current) {
        eventSourceRef.current.close();
        eventSourceRef.current = null;
      }
      return;
    }

    // Skip real-time notifications for verifiers
    if (session.user.role === 'VERIFIER') {
      return;
    }

    // Don't create multiple connections
    if (eventSourceRef.current) {
      return;
    }

    // Determine scope based on user role
    let scope: string;
    if (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN') {
      scope = 'admin';
    } else if (session.user.role === 'REVIEWER') {
      scope = 'reviewer';
    } else if (session.user.role === 'APPROVER') {
      scope = 'approver';
    } else {
      scope = 'vendor';
    }

    const params = new URLSearchParams({ scope });
    
    if (scope === 'vendor' && session.user.id) {
      params.append('vendorId', session.user.id);
    }

    console.log('Establishing SSE connection for notifications...');
    
    const eventSource = new EventSource(`/api/notifications/stream?${params.toString()}`);
    eventSourceRef.current = eventSource;

    eventSource.onopen = () => {
      console.log('SSE connection opened');
    };

    eventSource.onmessage = (event) => {
      try {
        const message: SSEMessage = JSON.parse(event.data);
        console.log('SSE message received:', message);

        switch (message.type) {
          case 'connected':
            console.log('Real-time notifications connected:', message.message);
            break;

          case 'notification:new':
            if (message.data) {
              console.log('New notification via SSE:', message.data);
              
              // Add notification to store with proper data
              addItem({
                id: message.data.id,
                type: message.data.type || 'notification', // Use actual notification type
                title: message.data.title,
                message: message.data.message,
                data: message.data.data || null, // Preserve the data field from server
                createdAt: message.data.createdAt,
                isRead: false
              });
            }
            break;

          case 'notification:unread_count':
            if (message.data?.unreadCount !== undefined) {
              console.log('Unread count update via SSE:', message.data.unreadCount);
              setUnreadCount(message.data.unreadCount);
            }
            break;

          case 'notification:removed':
            if (message.data?.submissionId) {
              console.log('Notification removal via SSE for submission:', message.data.submissionId);
              removeNotifications(message.data.submissionId);
            }
            break;

          case 'stats:update':
            console.log('Stats update via SSE:', message.data);
            // You can emit this to stats store if needed
            break;

          case 'heartbeat':
            // Keep-alive message, no action needed
            break;

          default:
            console.log('Unknown SSE message type:', message.type);
        }
      } catch (error) {
        console.error('Error parsing SSE message:', error);
      }
    };

    eventSource.onerror = (error) => {
      console.error('SSE connection error:', error);
      
      // Automatic reconnection will be handled by the browser
      // but we can add custom logic here if needed
      
      if (eventSource.readyState === EventSource.CLOSED) {
        console.log('SSE connection closed');
        eventSourceRef.current = null;
      }
    };

    // Cleanup on unmount
    return () => {
      if (eventSourceRef.current) {
        console.log('Closing SSE connection');
        eventSourceRef.current.close();
        eventSourceRef.current = null;
      }
    };
  }, [session, addItem, setUnreadCount, removeNotifications]);

  return {
    isConnected: typeof window !== 'undefined' && eventSourceRef.current?.readyState === EventSource.OPEN,
    eventSource: eventSourceRef.current
  };
}


=== FILE: src/hooks/useRobustTemplateGenerator.ts ===


=== FILE: src/hooks/useToast.ts ===
'use client';

interface ToastOptions {
  variant: 'success' | 'error' | 'warning' | 'info';
  title: string;
  message: string;
  duration?: number;
}

declare global {
  interface Window {
    showToast?: (toast: ToastOptions) => void;
  }
}

export function useToast() {
  const showToast = (toast: ToastOptions) => {
    if (typeof window !== 'undefined' && window.showToast) {
      window.showToast(toast);
    }
  };

  const showSuccess = (title: string, message: string, duration?: number) => {
    showToast({ variant: 'success', title, message, duration: duration || 5000 });
  };

  const showError = (title: string, message: string, duration?: number) => {
    showToast({ variant: 'error', title, message, duration: duration || 5000 });
  };

  const showWarning = (title: string, message: string, duration?: number) => {
    showToast({ variant: 'warning', title, message, duration: duration || 5000 });
  };

  const showInfo = (title: string, message: string, duration?: number) => {
    showToast({ variant: 'info', title, message, duration: duration || 5000 });
  };

  return {
    showToast,
    showSuccess,
    showError,
    showWarning,
    showInfo
  };
}


=== FILE: src/lib/api-utils.ts ===
/**
 * Common utilities for API route handlers
 */

import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { ZodError, ZodSchema } from 'zod';
import type { ApiError, ApiSuccess } from '@/shared/dto';

/**
 * Standard API response helpers
 */
export function apiError(
  message: string, 
  status: number = 400, 
  code?: string
): NextResponse<ApiError> {
  return NextResponse.json(
    {
      error: 'API Error',
      message,
      ...(code && { code }),
    },
    { status }
  );
}

export function apiSuccess<T = any>(
  data?: T, 
  message?: string,
  status: number = 200
): NextResponse<ApiSuccess> {
  return NextResponse.json(
    {
      success: true,
      ...(data !== undefined && { data }),
      ...(message && { message }),
    },
    { status }
  );
}

/**
 * Validate request body with Zod schema
 */
export async function validateRequestBody<T>(
  request: NextRequest,
  schema: ZodSchema<T>
): Promise<{ data: T; error?: never } | { data?: never; error: string }> {
  try {
    const body = await request.json();
    const data = schema.parse(body);
    return { data };
  } catch (error) {
    if (error instanceof ZodError) {
      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);
      return { error: `Validation failed: ${messages.join(', ')}` };
    }
    return { error: 'Invalid JSON body' };
  }
}

/**
 * Validate query parameters with Zod schema
 */
export function validateQueryParams<T>(
  request: NextRequest,
  schema: ZodSchema<T>
): { data: T; error?: never } | { data?: never; error: string } {
  try {
    const searchParams = request.nextUrl.searchParams;
    const params = Object.fromEntries(searchParams.entries());
    const data = schema.parse(params);
    return { data };
  } catch (error) {
    if (error instanceof ZodError) {
      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);
      return { error: `Validation failed: ${messages.join(', ')}` };
    }
    return { error: 'Invalid query parameters' };
  }
}

/**
 * Get authenticated session with role checking
 */
export async function getAuthenticatedSession(
  allowedRoles?: string[]
): Promise<
  | { session: any; error?: never }
  | { session?: never; error: NextResponse }
> {
  try {
    const session = await getServerSession(authOptions);
    
    if (!session?.user) {
      return { error: apiError('Authentication required', 401) };
    }

    if (allowedRoles && !allowedRoles.includes(session.user.role)) {
      return { error: apiError('Insufficient permissions', 403) };
    }

    return { session };
  } catch (error) {
    console.error('Auth error:', error);
    return { error: apiError('Authentication failed', 401) };
  }
}

/**
 * Safe async route handler wrapper
 */
export function withErrorHandling<T extends any[]>(
  handler: (...args: T) => Promise<NextResponse>
) {
  return async (...args: T): Promise<NextResponse> => {
    try {
      return await handler(...args);
    } catch (error) {
      console.error('API route error:', error);
      
      if (error instanceof Error) {
        return apiError(error.message, 500);
      }
      
      return apiError('Internal server error', 500);
    }
  };
}

/**
 * CORS headers for API routes
 */
export function addCorsHeaders(response: NextResponse): NextResponse {
  response.headers.set('Access-Control-Allow-Origin', process.env.NEXTAUTH_URL || '*');
  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
  response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  response.headers.set('Access-Control-Max-Age', '86400');
  return response;
}

/**
 * Handle OPTIONS requests for CORS
 */
export function handleOptions(): NextResponse {
  const response = new NextResponse(null, { status: 200 });
  return addCorsHeaders(response);
}


=== FILE: src/lib/auth.ts ===
// app/lib/auth.ts
import Credentials from "next-auth/providers/credentials";
import { prisma } from "./singletons";
import bcrypt from "bcryptjs";
import type { NextAuthOptions } from "next-auth";
import { JWT_CONFIG } from "@/utils/jwt-config";

export const authOptions: NextAuthOptions = {
  secret: process.env.NEXTAUTH_SECRET || 'fallback-secret-for-development',
  debug: process.env.NODE_ENV === 'development',
  logger: {
    error(code, metadata) {
      if (code === 'JWT_SESSION_ERROR') {
        console.log('JWT Session Error - clearing invalid token');
        // Don't log the full error in production
        return;
      }
      console.error('NextAuth Error:', code, metadata);
    },
    warn(code) {
      console.warn('NextAuth Warning:', code);
    },
  },
  providers: [
    Credentials({
      credentials: { email: {}, password: {} },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) return null;

        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        });
        if (!user || !user.password) return null;

        // Check if user verification status is REJECTED
        if (user.verification_status === 'REJECTED') {
          throw new Error('ACCOUNT_REJECTED');
        }

        const ok = await bcrypt.compare(credentials.password, user.password);
        if (!ok) return null;

        console.log('Auth authorize - returning user:', { 
          id: user.id, 
          email: user.email, 
          role: user.role 
        }); // Debug log

        // return the minimal shape Next-Auth expects
        return {
          id: user.id,
          role: user.role,
          name: user.officer_name,
          email: user.email || null,
          officer_name: user.officer_name,
          vendor_name: user.vendor_name,
          verified_at: user.verified_at,
          verification_status: user.verification_status,
          created_at: user.created_at,
        };
      },
    }),
  ],
  session: { 
    strategy: "jwt",
    // Session expires after configured time (default: 6 hours)
    maxAge: JWT_CONFIG.SESSION_MAX_AGE,
    // Update age extends session by this amount each time user is active
    updateAge: JWT_CONFIG.SESSION_UPDATE_AGE,
  },
  jwt: {
    // JWT expires after configured time (default: 6 hours)
    maxAge: JWT_CONFIG.JWT_EXPIRE_TIME,
  },
  callbacks: {
    async jwt({ token, user }) {
      try {
        // Check if token is expired
        const now = Date.now() / 1000; // Current time in seconds
      
      // user only exists on first sign-in, but we need to refresh verification status
      if (user) {
        token.id = user.id;
        token.role = user.role;
        token.officer_name = user.officer_name;
        token.vendor_name = user.vendor_name || null;
        token.verified_at = user.verified_at || null;
        token.verification_status = user.verification_status || 'PENDING';
        if (user.created_at) {
          token.created_at = user.created_at;
        }
        // Set issued at time and expiry using configured values
        token.iat = now;
        token.exp = now + JWT_CONFIG.JWT_EXPIRE_TIME;
        console.log('JWT callback - storing user.id:', user.id);
        console.log('JWT callback - token expires at:', new Date((now + JWT_CONFIG.JWT_EXPIRE_TIME) * 1000));
      } else if (token.id) {
        // Check if token is expired
        if (token.exp && typeof token.exp === 'number') {
          const now = Date.now() / 1000;
          if (now >= token.exp) {
            console.log('JWT callback - token expired, clearing session');
            return {}; // Return empty object to clear token
          }
        }
        
        // Refresh user data from database to get latest verification status
        try {
          const latestUser = await prisma.user.findUnique({
            where: { id: token.id as string },
            select: { verified_at: true, role: true, verification_status: true }
          });
          
          if (latestUser) {
            token.verified_at = latestUser.verified_at;
            token.verification_status = latestUser.verification_status || 'PENDING';
            console.log('JWT callback - refreshed verified_at:', latestUser.verified_at);
            console.log('JWT callback - refreshed verification_status:', latestUser.verification_status);
          }
        } catch (error) {
          console.error('Error refreshing user verification status:', error);
        }
      }
      return token;
      } catch (error) {
        console.error('JWT callback error:', error);
        // Return empty token on error to force re-authentication
        return {};
      }
    },
    async session({ session, token }) {
      if (token) {
        session.user.id   = token.id as string; // Use the stored user.id instead of token.sub
        session.user.role = token.role as import("@prisma/client").User_role;
        session.user.officer_name = token.officer_name as string;
        session.user.vendor_name = token.vendor_name as string | null;
        session.user.verified_at = token.verified_at as Date | null;
        session.user.verification_status = token.verification_status as import("@prisma/client").VerificationStatus;
        session.user.created_at = token.created_at as Date;
        console.log('Session callback - session.user.id:', session.user.id); // Debug log
      }
      return session;
    },
  },
  events: {
    async signIn({ user }) {
      console.log(`User ${user.email} signed in at ${new Date()}`);
    },
    async signOut() {
      console.log(`User signed out at ${new Date()}`);
    },
    async session({ token }) {
      // Called whenever a session is checked
      if (token.exp && typeof token.exp === 'number') {
        const now = Date.now() / 1000;
        if (now >= token.exp) {
          console.log('Session expired, will be cleared');
        }
      }
    }
  },
  pages: { signIn: "/login" },
};

=== FILE: src/lib/cache.ts ===
/**
 * Redis Cache Helper with namespacing and TTL support
 */

import { redisPub as redis } from './singletons';

const CACHE_PREFIX = 'app:v1';

interface CacheOptions {
  ttl?: number; // TTL in seconds
  namespace?: string;
}

export class Cache {
  private static getKey(key: string, namespace?: string): string {
    const ns = namespace ? `:${namespace}` : '';
    return `${CACHE_PREFIX}${ns}:${key}`;
  }

  /**
   * Get JSON value from cache
   */
  static async getJSON<T = any>(key: string, options: CacheOptions = {}): Promise<T | null> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      const value = await redis.get(fullKey);
      return value ? JSON.parse(value) : null;
    } catch (error) {
      console.warn('Cache.getJSON error:', error);
      return null;
    }
  }

  /**
   * Set JSON value in cache with optional TTL
   */
  static async setJSON(
    key: string, 
    value: any, 
    options: CacheOptions = {}
  ): Promise<boolean> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      const serialized = JSON.stringify(value);
      
      if (options.ttl) {
        await redis.setex(fullKey, options.ttl, serialized);
      } else {
        await redis.set(fullKey, serialized);
      }
      
      return true;
    } catch (error) {
      console.warn('Cache.setJSON error:', error);
      return false;
    }
  }

  /**
   * Get string value from cache
   */
  static async get(key: string, options: CacheOptions = {}): Promise<string | null> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      return await redis.get(fullKey);
    } catch (error) {
      console.warn('Cache.get error:', error);
      return null;
    }
  }

  /**
   * Set string value in cache with optional TTL
   */
  static async set(
    key: string, 
    value: string, 
    options: CacheOptions = {}
  ): Promise<boolean> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      
      if (options.ttl) {
        await redis.setex(fullKey, options.ttl, value);
      } else {
        await redis.set(fullKey, value);
      }
      
      return true;
    } catch (error) {
      console.warn('Cache.set error:', error);
      return false;
    }
  }

  /**
   * Delete a key from cache
   */
  static async del(key: string, options: CacheOptions = {}): Promise<boolean> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      await redis.del(fullKey);
      return true;
    } catch (error) {
      console.warn('Cache.del error:', error);
      return false;
    }
  }

  /**
   * Invalidate cache by prefix pattern
   */
  static async invalidateByPrefix(prefix: string, namespace?: string): Promise<number> {
    try {
      const pattern = this.getKey(`${prefix}*`, namespace);
      const keys = await redis.keys(pattern);
      
      if (keys.length === 0) return 0;
      
      await redis.del(...keys);
      return keys.length;
    } catch (error) {
      console.warn('Cache.invalidateByPrefix error:', error);
      return 0;
    }
  }

  /**
   * Check if key exists
   */
  static async exists(key: string, options: CacheOptions = {}): Promise<boolean> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      const result = await redis.exists(fullKey);
      return result === 1;
    } catch (error) {
      console.warn('Cache.exists error:', error);
      return false;
    }
  }

  /**
   * Increment a numeric value
   */
  static async incr(key: string, options: CacheOptions = {}): Promise<number> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      const result = await redis.incr(fullKey);
      
      // Set TTL if specified and this is a new key
      if (options.ttl && result === 1) {
        await redis.expire(fullKey, options.ttl);
      }
      
      return result;
    } catch (error) {
      console.warn('Cache.incr error:', error);
      return 0;
    }
  }

  /**
   * Set TTL for existing key
   */
  static async expire(key: string, ttl: number, options: CacheOptions = {}): Promise<boolean> {
    try {
      const fullKey = this.getKey(key, options.namespace);
      const result = await redis.expire(fullKey, ttl);
      return result === 1;
    } catch (error) {
      console.warn('Cache.expire error:', error);
      return false;
    }
  }
}

// Predefined namespaces for different features
export const CacheNamespaces = {
  STATS: 'stats',
  NOTIFICATIONS: 'notifications',
  SUBMISSIONS: 'submissions',
  VENDORS: 'vendors',
  AUTH: 'auth',
} as const;

// Common TTL values (in seconds)
export const CacheTTL = {
  SHORT: 60,      // 1 minute
  MEDIUM: 300,    // 5 minutes
  LONG: 900,      // 15 minutes
  HOUR: 3600,     // 1 hour
  DAY: 86400,     // 24 hours
} as const;


=== FILE: src/lib/db.ts ===
import { PrismaClient } from '@prisma/client';

import { config } from '@/lib/env';

/**
 * Global variable for Prisma client to prevent multiple instances in development
 */
declare global {
  var __prisma: PrismaClient | undefined;
}

/**
 * Database client configuration
 */
const createPrismaClient = () =>
  new PrismaClient({
    log: config.isDevelopment ? ['query', 'error', 'warn'] : ['error'],
    datasources: {
      db: {
        url: config.database.url,
      },
    },
  });

/**
 * Prisma client instance
 * Uses global variable in development to prevent multiple instances during hot reload
 */
export const db = globalThis.__prisma ?? createPrismaClient();

if (config.isDevelopment) {
  globalThis.__prisma = db;
}

/**
 * Database connection utilities
 */
export const dbUtils = {
  /**
   * Test database connection
   */
  async testConnection(): Promise<boolean> {
    try {
      await db.$queryRaw`SELECT 1`;
      return true;
    } catch (error) {
      console.error('Database connection failed:', error);
      return false;
    }
  },

  /**
   * Gracefully disconnect from database
   */
  async disconnect(): Promise<void> {
    await db.$disconnect();
  },

  /**
   * Execute database transaction
   */
  async transaction<T>(
    fn: (prisma: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use' | '$extends'>) => Promise<T>
  ): Promise<T> {
    try {
      return await db.$transaction(fn);
    } catch (error) {
      console.error('Transaction error:', error);
      throw new DatabaseError(
        'Transaction failed',
        error instanceof Error ? error.message : 'Unknown error'
      );
    }
  },
} as const;

/**
 * Type helpers for Prisma
 */
export type DbTransaction = Parameters<Parameters<typeof db.$transaction>[0]>[0];

/**
 * Database error handling
 */
export class DatabaseError extends Error {
  constructor(
    message: string,
    public code?: string,
    public meta?: unknown
  ) {
    super(message);
    this.name = 'DatabaseError';
  }
}

/**
 * Handle Prisma errors and convert to user-friendly messages
 */
export function handleDatabaseError(error: unknown): never {
  if (error instanceof Error) {
    // Prisma specific errors
    if ('code' in error) {
      const prismaError = error as { code: string; meta?: unknown };
      
      switch (prismaError.code) {
        case 'P2002':
          throw new DatabaseError('A record with this information already exists', prismaError.code, prismaError.meta);
        case 'P2025':
          throw new DatabaseError('Record not found', prismaError.code, prismaError.meta);
        case 'P2003':
          throw new DatabaseError('Invalid reference to related record', prismaError.code, prismaError.meta);
        default:
          throw new DatabaseError('Database operation failed', prismaError.code, prismaError.meta);
      }
    }
    
    throw new DatabaseError(error.message);
  }
  
  throw new DatabaseError('Unknown database error occurred');
}


=== FILE: src/lib/env.ts ===
import { z } from 'zod';

/**
 * Environment variables validation schema
 * Ensures all required environment variables are present and valid
 */
const envSchema = z.object({
  // Database
  DATABASE_URL: z.string().url('DATABASE_URL must be a valid URL'),

  // NextAuth
  NEXTAUTH_URL: z.string().url('NEXTAUTH_URL must be a valid URL'),
  NEXTAUTH_SECRET: z.string().min(32, 'NEXTAUTH_SECRET must be at least 32 characters'),

  // Node Environment
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),

  // Optional: File uploads
  UPLOAD_DIR: z.string().default('public/uploads'),
  MAX_FILE_SIZE: z.string().default('5242880').transform(val => parseInt(val, 10)), // 5MB

  // Optional: External services
  SMTP_HOST: z.string().optional(),
  SMTP_PORT: z.string().transform(val => parseInt(val, 10)).optional(),
  SMTP_USER: z.string().optional(),
  SMTP_PASS: z.string().optional(),
});

/**
 * Validated environment variables
 * Use this instead of process.env directly for type safety
 */
export const env = envSchema.parse(process.env);

/**
 * Environment-specific configurations
 */
export const config = {
  isDevelopment: env.NODE_ENV === 'development',
  isProduction: env.NODE_ENV === 'production',
  isTest: env.NODE_ENV === 'test',
  
  // Database
  database: {
    url: env.DATABASE_URL,
  },

  // Authentication
  auth: {
    url: env.NEXTAUTH_URL,
    secret: env.NEXTAUTH_SECRET,
  },

  // File uploads
  uploads: {
    dir: env.UPLOAD_DIR,
    maxFileSize: env.MAX_FILE_SIZE,
    allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'application/pdf'],
  },

  // API
  api: {
    baseUrl: env.NEXTAUTH_URL,
    timeout: 30000, // 30 seconds
  },

  // UI
  ui: {
    toastDuration: 5000,
    modalAnimationDuration: 200,
  },
} as const;

export type Config = typeof config;


=== FILE: src/lib/exportToExcel.ts ===
import * as XLSX from 'xlsx';

interface WorkerData {
  id: string;
  namaLengkap: string;
  foto: string;
  nik: string;
  tempatLahir: string;
  tanggalLahir: string;
  jenisKelamin: string;
  agama: string;
  statusPerkawinan: string;
  alamat: string;
  noTelepon: string;
  email: string;
  pendidikanTerakhir: string;
  jabatan: string;
  pengalaman: string;
  keahlianKhusus: string;
  sertifikasi: string;
  catatan: string;
}

interface SubmissionData {
  id: string;
  nomorSurat: string;
  perihal: string;
  tujuan: string;
  tempatPelaksanaan: string;
  tanggalMulai: string;
  tanggalSelesai: string;
  statusApproval: string;
  vendorName: string;
  vendorCompany: string;
  vendorEmail: string;
  vendorPhone: string;
  submittedAt: string;
  approvedAt: string;
  totalWorkers: number;
  daftarPekerja: WorkerData[];
  dokumenSika: string;
  dokumenSimja: string;
  catatan: string;
  signerName: string;
  signerTitle: string;
  // Additional fields from current schema
  jamKerja: string;
  saranaKerja: string;
  pelaksanaan: string;
  lainLain: string;
  nomorSimja: string;
  tanggalSimja: string;
  nomorSika: string;
  tanggalSika: string;
  nomorSimlok: string;
  tanggalSimlok: string;
  namaPerkerjaText: string;
  content: string;
  qrcode: string;
  approvedBy: string;
}

interface ExportOptions {
  filename?: string;
  sheetName?: string;
  dateFrom?: string;
  dateTo?: string;
}

export const exportSubmissionsToExcel = (data: SubmissionData[], options: ExportOptions = {}) => {
  try {
    const {
      filename = `submissions_export_${new Date().toISOString().split('T')[0]}.xlsx`,
      sheetName = 'Submissions Data',
      dateFrom,
      dateTo
    } = options;

    // Filter data by date if provided
    let filteredData = data;
    if (dateFrom || dateTo) {
      filteredData = data.filter(item => {
        const itemDate = new Date(item.submittedAt);
        const fromDate = dateFrom ? new Date(dateFrom) : null;
        const toDate = dateTo ? new Date(dateTo) : null;

        if (fromDate && toDate) {
          // Set time to cover full day range
          fromDate.setHours(0, 0, 0, 0);
          toDate.setHours(23, 59, 59, 999);
          return itemDate >= fromDate && itemDate <= toDate;
        } else if (fromDate) {
          fromDate.setHours(0, 0, 0, 0);
          return itemDate >= fromDate;
        } else if (toDate) {
          toDate.setHours(23, 59, 59, 999);
          return itemDate <= toDate;
        }
        return true;
      });
    }

    // Transform submissions data for Excel export
    const submissionsData = filteredData.map((item, index) => ({
      'No': index + 1,
      'Nomor SIMLOK': item.nomorSimlok || '-',
      'Tanggal SIMLOK': item.tanggalSimlok || '-',
      'ID Submission': item.id,
      'Nomor Surat/Berdasarkan': item.nomorSurat,
      'Perihal/Pekerjaan': item.perihal,
      'Tujuan/Lokasi Kerja': item.tujuan,
      'Tempat Pelaksanaan': item.tempatPelaksanaan,
      'Pelaksanaan': item.pelaksanaan || '-',
      'Jam Kerja': item.jamKerja,
      'Sarana Kerja': item.saranaKerja,
      'Lain-lain': item.lainLain || '-',
      'Status Approval': item.statusApproval,
      'Nama Vendor/Petugas': item.vendorName,
      'Perusahaan Vendor': item.vendorCompany || '-',
      'Email Vendor': item.vendorEmail,
      'Telepon Vendor': item.vendorPhone || '-',
      'Tanggal Submit': item.submittedAt,
      'Approved By': item.approvedBy || '-',
      'Total Pekerja': item.totalWorkers,
      'Nomor SIMJA': item.nomorSimja || '-',
      'Tanggal SIMJA': item.tanggalSimja || '-',
      'Nomor SIKA': item.nomorSika || '-',
      'Tanggal SIKA': item.tanggalSika || '-',
      'Dokumen SIKA': item.dokumenSika || '-',
      'Dokumen SIMJA': item.dokumenSimja || '-',
      'Catatan': item.catatan || '-',
      'Nama Penandatangan': item.signerName || '-',
      'Jabatan Penandatangan': item.signerTitle || '-',
      'QR Code': item.qrcode || '-',
      'Daftar Pekerja': formatWorkerNames(item.namaPerkerjaText) || '-'
    }));

    // Create workbook
    const wb = XLSX.utils.book_new();

    // Add submissions sheet
    const submissionsWs = XLSX.utils.json_to_sheet(submissionsData);
    
    // Set column widths for submissions
    const submissionsColWidths = [
      { wch: 5 },   // No
      { wch: 15 },  // Nomor SIMLOK
      { wch: 15 },  // Tanggal SIMLOK
      { wch: 20 },  // ID Submission
      { wch: 25 },  // Nomor Surat/Berdasarkan
      { wch: 40 },  // Perihal/Pekerjaan
      { wch: 25 },  // Tujuan/Lokasi Kerja
      { wch: 25 },  // Tempat Pelaksanaan
      { wch: 30 },  // Pelaksanaan
      { wch: 15 },  // Jam Kerja
      { wch: 30 },  // Sarana Kerja
      { wch: 30 },  // Lain-lain
      { wch: 15 },  // Status Approval
      { wch: 25 },  // Nama Vendor/Petugas
      { wch: 25 },  // Perusahaan Vendor
      { wch: 25 },  // Email Vendor
      { wch: 15 },  // Telepon Vendor
      { wch: 15 },  // Tanggal Submit
      { wch: 20 },  // Approved By
      { wch: 12 },  // Total Pekerja
      { wch: 15 },  // Nomor SIMJA
      { wch: 15 },  // Tanggal SIMJA
      { wch: 15 },  // Nomor SIKA
      { wch: 15 },  // Tanggal SIKA
      { wch: 20 },  // Dokumen SIKA
      { wch: 20 },  // Dokumen SIMJA
      { wch: 30 },  // Catatan
      { wch: 25 },  // Nama Penandatangan
      { wch: 25 },  // Jabatan Penandatangan
      { wch: 15 },  // QR Code
      { wch: 50 }   // Daftar Pekerja
    ];
    submissionsWs['!cols'] = submissionsColWidths;
    
    XLSX.utils.book_append_sheet(wb, submissionsWs, sheetName);

    // Add workers detail sheet if there's worker data
    const allWorkers: any[] = [];
    filteredData.forEach((submission, _submissionIndex) => {
      submission.daftarPekerja.forEach((worker, _workerIndex) => {
        allWorkers.push({
          'No': allWorkers.length + 1,
          'ID Submission': submission.id,
          'Nomor Surat': submission.nomorSurat,
          'Vendor': submission.vendorName,
          'Nama Lengkap': worker.namaLengkap,
          'Foto Pekerja': worker.foto || '-',
          // Note: Most detailed worker fields are not available in current schema
        //   'NIK': worker.nik || '-',
        //   'Tempat Lahir': worker.tempatLahir || '-',
        //   'Tanggal Lahir': worker.tanggalLahir || '-',
        //   'Jenis Kelamin': worker.jenisKelamin || '-',
        //   'Agama': worker.agama || '-',
        //   'Status Perkawinan': worker.statusPerkawinan || '-',
        //   'Alamat': worker.alamat || '-',
        //   'No Telepon': worker.noTelepon || '-',
        //   'Email': worker.email || '-',
        //   'Pendidikan Terakhir': worker.pendidikanTerakhir || '-',
        //   'Jabatan': worker.jabatan || '-',
        //   'Pengalaman': worker.pengalaman || '-',
        //   'Keahlian Khusus': worker.keahlianKhusus || '-',
        //   'Sertifikasi': worker.sertifikasi || '-',
        //   'Catatan': worker.catatan || '-'
        });
      });
    });

    if (allWorkers.length > 0) {
      const workersWs = XLSX.utils.json_to_sheet(allWorkers);
      
      // Set column widths for workers
      const workersColWidths = [
        { wch: 5 },   // No
        { wch: 20 },  // ID Submission
        { wch: 20 },  // Nomor Surat
        { wch: 25 },  // Vendor
        { wch: 25 },  // Nama Lengkap
        { wch: 20 },  // Foto Pekerja
        { wch: 20 },  // NIK
        { wch: 15 },  // Tempat Lahir
        { wch: 12 },  // Tanggal Lahir
        { wch: 12 },  // Jenis Kelamin
        { wch: 10 },  // Agama
        { wch: 15 },  // Status Perkawinan
        { wch: 40 },  // Alamat
        { wch: 15 },  // No Telepon
        { wch: 25 },  // Email
        { wch: 20 },  // Pendidikan Terakhir
        { wch: 20 },  // Jabatan
        { wch: 30 },  // Pengalaman
        { wch: 30 },  // Keahlian Khusus
        { wch: 30 },  // Sertifikasi
        { wch: 30 }   // Catatan
      ];
      workersWs['!cols'] = workersColWidths;
      
      XLSX.utils.book_append_sheet(wb, workersWs, 'Workers Detail');
    }

    // Add summary sheet
    const summaryData = [
      ['LAPORAN EXPORT SUBMISSIONS'],
      [''],
      ['Filter Tanggal:', dateFrom && dateTo ? `${formatDate(dateFrom)} - ${formatDate(dateTo)}` : 
        dateFrom ? `Dari: ${formatDate(dateFrom)}` : 
        dateTo ? `Sampai: ${formatDate(dateTo)}` : 'Semua Data'],
      ['Total Submissions:', filteredData.length],
      ['Total Pekerja:', allWorkers.length],
      ['Export Time:', new Date().toLocaleString('id-ID')],
      [''],
      ['Status Summary:'],
      ['APPROVED:', filteredData.filter(item => item.statusApproval === 'APPROVED').length],
      ['PENDING:', filteredData.filter(item => item.statusApproval === 'PENDING').length],
      ['REJECTED:', filteredData.filter(item => item.statusApproval === 'REJECTED').length]
    ];
    
    const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
    XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');

    // Write file
    XLSX.writeFile(wb, filename);

    return {
      success: true,
      message: `Data berhasil diexport ke ${filename}`,
      totalData: filteredData.length
    };

  } catch (error) {
    console.error('Error exporting to Excel:', error);
    return {
      success: false,
      message: 'Gagal mengexport data ke Excel',
      error: error instanceof Error ? error.message : 'Unknown error'
    };
  }
};

// Helper function to format date
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('id-ID', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
};

// Helper function to format worker names with bullet points
const formatWorkerNames = (namaPerkerjaText: string): string => {
  if (!namaPerkerjaText) return '';
  
  const names = namaPerkerjaText
    .split(/[\n,]+/)
    .map(name => name.trim())
    .filter(name => name.length > 0);
  
  if (names.length === 0) return '';
  
  return names.map(name => `- ${name}`).join('\n');
};

=== FILE: src/lib/fileManager.ts ===
import { join } from 'path';
import { mkdir, rename, unlink, readdir, stat } from 'fs/promises';
import { existsSync } from 'fs';
import crypto from 'crypto';

export interface FileInfo {
  originalName: string;
  newName: string;
  path: string;
  url: string;
  size: number;
  type: string;
  category: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';
}

export class FileManager {
  private baseUploadDir: string;

  constructor() {
    this.baseUploadDir = join(process.cwd(), 'public', 'uploads');
  }

  /**
   * Get organized folder structure for user files
   */
  private getUserFolderStructure(userId: string) {
    const userBaseDir = join(this.baseUploadDir, userId);
    return {
      base: userBaseDir,
      sika: join(userBaseDir, 'dokumen-sika'),
      simja: join(userBaseDir, 'dokumen-simja'),
      idCard: join(userBaseDir, 'id-card'),
      other: join(userBaseDir, 'lainnya'),
      workerPhoto: join(userBaseDir, 'foto-pekerja')
    };
  }

  /**
   * Determine file category based on field name or file content
   */
  private getFileCategory(fieldName?: string, fileName?: string): 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo' {
    if (fieldName) {
      if (fieldName.includes('sika')) return 'sika';
      if (fieldName.includes('simja')) return 'simja';
      if (fieldName.includes('worker') || fieldName.includes('pekerja')) return 'worker-photo';
    }
    
    if (fileName) {
      const lowerName = fileName.toLowerCase();
      if (lowerName.includes('sika')) return 'sika';
      if (lowerName.includes('simja')) return 'simja';
      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';
      if (lowerName.includes('worker') || lowerName.includes('pekerja') || lowerName.includes('foto')) return 'worker-photo';
    }
    
    return 'other';
  }

  /**
   * Generate a clean, descriptive filename
   */
  private generateFileName(originalName: string, category: string, _userId: string): string {
    const timestamp = Date.now();
    const randomString = crypto.randomBytes(4).toString('hex');
    const extension = originalName.split('.').pop()?.toLowerCase() || '';
    
    // Clean original name
    const cleanOriginalName = originalName
      .replace(/\.[^/.]+$/, '') // Remove extension
      .replace(/[^a-zA-Z0-9\-_]/g, '_') // Replace special chars
      .substring(0, 30); // Limit length

    // Create descriptive name based on category
    const categoryPrefix = {
      sika: 'SIKA',
      simja: 'SIMJA', 
      other: 'Doc',
      'worker-photo': 'Worker'
    }[category] || 'Doc';

    return `${categoryPrefix}_${timestamp}_${randomString}_${cleanOriginalName}.${extension}`;
  }

  /**
   * Create all necessary directories
   */
  private async createDirectories(userId: string): Promise<void> {
    const folders = this.getUserFolderStructure(userId);
    
    for (const folder of Object.values(folders)) {
      if (!existsSync(folder)) {
        await mkdir(folder, { recursive: true });
      }
    }
  }

  /**
   * Save worker photo with worker's name as filename
   */
  async saveWorkerPhoto(
    fileBuffer: Buffer,
    originalName: string,
    userId: string,
    workerName: string
  ): Promise<FileInfo> {
    // Clean worker name for filename
    const cleanWorkerName = workerName
      .replace(/[^a-zA-Z0-9\-_\s]/g, '') // Remove special chars except space
      .replace(/\s+/g, '_') // Replace spaces with underscore
      .substring(0, 50); // Limit length

    // Get file extension
    const extension = originalName.split('.').pop()?.toLowerCase() || 'jpg';
    
    // Generate filename with worker name
    const timestamp = Date.now();
    const newFileName = `${cleanWorkerName}_${timestamp}.${extension}`;
    
    // Create directories
    await this.createDirectories(userId);
    
    // Get worker photo folder
    const folders = this.getUserFolderStructure(userId);
    const targetFolder = folders.workerPhoto;

    // Save file
    const filePath = join(targetFolder, newFileName);
    const { writeFile } = await import('fs/promises');
    await writeFile(filePath, fileBuffer);

    // Get file stats
    const stats = await stat(filePath);

    return {
      originalName,
      newName: newFileName,
      path: filePath,
      url: `/api/files/${userId}/worker-photo/${newFileName}`,
      size: stats.size,
      type: this.getFileType(originalName),
      category: 'worker-photo'
    };
  }

  /**
   * Save uploaded file with proper organization
   */
  async saveFile(
    fileBuffer: Buffer,
    originalName: string,
    userId: string,
    fieldName?: string
  ): Promise<FileInfo> {
    // Determine category and generate filename
    const category = this.getFileCategory(fieldName, originalName);
    const newFileName = this.generateFileName(originalName, category, userId);
    
    // Create directories
    await this.createDirectories(userId);
    
    // Get target folder
    const folders = this.getUserFolderStructure(userId);
    const targetFolder = {
      sika: folders.sika,
      simja: folders.simja,
      id_card: folders.idCard,
      other: folders.other,
      'worker-photo': folders.workerPhoto
    }[category];

    if (!targetFolder) {
      throw new Error(`Invalid category: ${category}`);
    }

    // Save file
    const filePath = join(targetFolder, newFileName);
    const { writeFile } = await import('fs/promises');
    await writeFile(filePath, fileBuffer);

    // Get file stats
    const stats = await stat(filePath);

    return {
      originalName,
      newName: newFileName,
      path: filePath,
      url: `/api/files/${userId}/${category}/${newFileName}`,
      size: stats.size,
      type: this.getFileType(originalName),
      category
    };
  }

  /**
   * Rename existing file
   */
  async renameFile(
    userId: string,
    oldFileName: string,
    newName: string,
    category?: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'
  ): Promise<FileInfo | null> {
    try {
      const folders = this.getUserFolderStructure(userId);
      
      // Find the file in any category folder
      let currentFilePath: string | null = null;
      let currentCategory: string | null = null;

      for (const [cat, folder] of Object.entries({
        sika: folders.sika,
        simja: folders.simja,
        id_card: folders.idCard,
        other: folders.other,
        'worker-photo': folders.workerPhoto
      })) {
        const testPath = join(folder, oldFileName);
        if (existsSync(testPath)) {
          currentFilePath = testPath;
          currentCategory = cat;
          break;
        }
      }

      if (!currentFilePath || !currentCategory) {
        throw new Error('File not found');
      }

      // Determine new category (use provided or keep current)
      const targetCategory = category || currentCategory as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';
      
      // Generate new filename
      const extension = oldFileName.split('.').pop()?.toLowerCase() || '';
      const cleanNewName = newName.replace(/[^a-zA-Z0-9\-_]/g, '_');
      const timestamp = Date.now();
      const randomString = crypto.randomBytes(4).toString('hex');
      
      const newFileName = `${targetCategory.toUpperCase()}_${timestamp}_${randomString}_${cleanNewName}.${extension}`;
      
      // Get target folder
      const targetFolder = {
        sika: folders.sika,
        simja: folders.simja,
        id_card: folders.idCard,
        other: folders.other,
        'worker-photo': folders.workerPhoto
      }[targetCategory];

      if (!targetFolder) {
        throw new Error(`Invalid target category: ${targetCategory}`);
      }

      const newFilePath = join(targetFolder, newFileName);

      // Rename/move file
      await rename(currentFilePath, newFilePath);

      // Get file stats
      const stats = await stat(newFilePath);

      return {
        originalName: oldFileName,
        newName: newFileName,
        path: newFilePath,
        url: `/api/files/${userId}/${targetCategory}/${newFileName}`,
        size: stats.size,
        type: this.getFileType(newFileName),
        category: targetCategory
      };

    } catch (error) {
      console.error('Error renaming file:', error);
      return null;
    }
  }

  /**
   * Delete file
   */
  async deleteFile(userId: string, fileName: string): Promise<boolean> {
    try {
      const folders = this.getUserFolderStructure(userId);
      
      // Find and delete the file from any category folder
      for (const folder of Object.values({
        sika: folders.sika,
        simja: folders.simja,
        id_card: folders.idCard,
        other: folders.other,
        'worker-photo': folders.workerPhoto
      })) {
        const filePath = join(folder, fileName);
        if (existsSync(filePath)) {
          await unlink(filePath);
          return true;
        }
      }
      
      return false;
    } catch (error) {
      console.error('Error deleting file:', error);
      return false;
    }
  }

  /**
   * List all files for a user
   */
  async listUserFiles(userId: string): Promise<{ [category: string]: FileInfo[] }> {
    const folders = this.getUserFolderStructure(userId);
    const result: { [category: string]: FileInfo[] } = {
      sika: [],
      simja: [],
      id_card: [],
      other: [],
      'worker-photo': []
    };

    for (const [category, folder] of Object.entries({
      sika: folders.sika,
      simja: folders.simja,
      id_card: folders.idCard,
      other: folders.other,
      'worker-photo': folders.workerPhoto
    })) {
      try {
        if (existsSync(folder)) {
          const files = await readdir(folder);
          
          for (const fileName of files) {
            const filePath = join(folder, fileName);
            const stats = await stat(filePath);
            
            if (result[category]) {
              result[category].push({
                originalName: fileName,
                newName: fileName,
                path: filePath,
                url: `/api/files/${userId}/${category}/${fileName}`,
                size: stats.size,
                type: this.getFileType(fileName),
                category: category as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'
              });
            }
          }
        }
      } catch (error) {
        console.error(`Error reading folder ${category}:`, error);
      }
    }

    return result;
  }

  /**
   * Get file type from filename
   */
  private getFileType(filename: string): string {
    const extension = filename.split('.').pop()?.toLowerCase();
    
    const types: { [key: string]: string } = {
      pdf: 'application/pdf',
      doc: 'application/msword',
      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      jpg: 'image/jpeg',
      jpeg: 'image/jpeg',
      png: 'image/png',
      gif: 'image/gif'
    };

    return types[extension || ''] || 'application/octet-stream';
  }

  /**
   * Move existing files to organized structure (migration utility)
   */
  async migrateExistingFiles(userId: string): Promise<{ moved: number; errors: string[] }> {
    const oldUserDir = join(this.baseUploadDir, userId);
    const errors: string[] = [];
    let moved = 0;

    if (!existsSync(oldUserDir)) {
      return { moved: 0, errors: ['User directory not found'] };
    }

    try {
      // Create new organized structure
      await this.createDirectories(userId);
      
      // Read files from old structure
      const files = await readdir(oldUserDir);
      
      for (const fileName of files) {
        const oldPath = join(oldUserDir, fileName);
        const stats = await stat(oldPath);
        
        // Skip if it's a directory (already organized)
        if (stats.isDirectory()) continue;
        
        try {
          // Determine category from filename
          const category = this.getFileCategory(undefined, fileName);
          
          // Get target folder
          const folders = this.getUserFolderStructure(userId);
          const targetFolder = {
            sika: folders.sika,
            simja: folders.simja,
            id_card: folders.idCard,
            other: folders.other,
            'worker-photo': folders.workerPhoto
          }[category];

          if (!targetFolder) {
            errors.push(`Invalid category ${category} for file ${fileName}`);
            continue;
          }

          // Generate new organized filename
          const newFileName = this.generateFileName(fileName, category, userId);
          const newPath = join(targetFolder, newFileName);

          // Move file
          await rename(oldPath, newPath);
          moved++;
          
        } catch (error) {
          errors.push(`Failed to move ${fileName}: ${error}`);
        }
      }

    } catch (error) {
      errors.push(`Migration error: ${error}`);
    }

    return { moved, errors };
  }
}

// Export singleton instance
export const fileManager = new FileManager();


=== FILE: src/lib/fileUrlHelper.ts ===
/**
 * File URL utilities for handling legacy and new file URL formats
 */

export class FileUrlHelper {
  /**
   * Convert legacy file URL to new categorized format
   * Legacy: /api/files/userId/filename
   * New: /api/files/userId/category/filename
   */
  static convertLegacyUrl(url: string, fieldName?: string): string {
    if (!url) return url;

    // Check if it's already in new format (has category)
    const urlParts = url.split('/');
    if (urlParts.length >= 6) {
      return url; // Already in new format
    }

    // Extract userId and filename from legacy format
    const userId = urlParts[3];
    const filename = urlParts[4];

    if (!userId || !filename) {
      return url; // Invalid URL, return as is
    }

    // Determine category from field name or filename
    const category = this.getCategoryFromField(fieldName, filename);

    return `/api/files/${userId}/${category}/${filename}`;
  }

  /**
   * Determine file category from field name or filename
   */
  static getCategoryFromField(fieldName?: string, filename?: string): string {
    if (fieldName) {
      if (fieldName.includes('sika')) return 'sika';
      if (fieldName.includes('simja')) return 'simja';
    }
    
    if (filename) {
      const lowerName = filename.toLowerCase();
      if (lowerName.includes('sika')) return 'sika';
      if (lowerName.includes('simja')) return 'simja';
      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';
    }
    
    return 'other';
  }

  /**
   * Get display filename from full filename
   */
  static getDisplayFilename(filename: string): string {
    if (!filename) return '';
    
    // Remove timestamp and random string prefix if present
    // Format: CATEGORY_timestamp_random_originalname.ext
    const parts = filename.split('_');
    if (parts.length >= 4 && parts[0]?.match(/^(SIKA|SIMJA|DOC)$/i)) {
      // Remove first 3 parts (category, timestamp, random)
      return parts.slice(3).join('_');
    }
    
    return filename;
  }

  /**
   * Get file extension from filename
   */
  static getFileExtension(filename: string): string {
    return filename.split('.').pop()?.toLowerCase() || '';
  }

  /**
   * Check if file is an image
   */
  static isImage(filename: string): boolean {
    const extension = this.getFileExtension(filename);
    return ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);
  }

  /**
   * Check if file is a PDF
   */
  static isPDF(filename: string): boolean {
    const extension = this.getFileExtension(filename);
    return extension === 'pdf';
  }

  /**
   * Check if file is a document
   */
  static isDocument(filename: string): boolean {
    const extension = this.getFileExtension(filename);
    return ['doc', 'docx', 'pdf', 'txt', 'rtf'].includes(extension);
  }

  /**
   * Get MIME type from filename
   */
  static getMimeType(filename: string): string {
    const extension = this.getFileExtension(filename);
    
    const mimeTypes: { [key: string]: string } = {
      pdf: 'application/pdf',
      doc: 'application/msword',
      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      jpg: 'image/jpeg',
      jpeg: 'image/jpeg',
      png: 'image/png',
      gif: 'image/gif',
      webp: 'image/webp',
      txt: 'text/plain',
      rtf: 'application/rtf'
    };

    return mimeTypes[extension] || 'application/octet-stream';
  }

  /**
   * Format file size in human readable format
   */
  static formatFileSize(bytes: number): string {
    if (bytes === 0) return '0 B';
    
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
  }

  /**
   * Generate download filename for better user experience
   */
  static generateDownloadFilename(originalUrl: string, category: string, customName?: string): string {
    if (customName) {
      return customName;
    }

    const filename = originalUrl.split('/').pop() || 'download';
    const extension = this.getFileExtension(filename);
    
    const categoryNames = {
      sika: 'Dokumen_SIKA',
      simja: 'Dokumen_SIMJA',
      id_card: 'ID_Card',
      other: 'Dokumen'
    };

    const prefix = categoryNames[category as keyof typeof categoryNames] || 'Dokumen';
    const timestamp = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
    
    return `${prefix}_${timestamp}.${extension}`;
  }
}

// Export for easier imports
export const fileUrlHelper = FileUrlHelper;


=== FILE: src/lib/notificationCleanup.ts ===
import { PrismaClient } from '@prisma/client';
import { notifyNotificationsRemoved } from '@/server/events';

const prisma = new PrismaClient();

/**
 * Clean up notifications that reference deleted submissions
 * This function is used to maintain data integrity
 */
export async function cleanupOrphanedNotifications() {
  try {
    console.log('🧹 Starting cleanup of orphaned notifications...');
    
    // Find all notifications that reference submissions
    const submissionNotifications = await prisma.notification.findMany({
      where: {
        OR: [
          { data: { contains: 'submissionId' } },
          { data: { contains: 'submission_id' } },
          { message: { contains: 'ID' } },
          { title: { contains: 'ID' } }
        ]
      }
    });
    
    const orphanedNotifications = [];
    
    // Check each notification
    for (const notif of submissionNotifications) {
      let submissionId = null;
      
      // Extract submission ID from data field
      if (notif.data) {
        try {
          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;
          submissionId = data.submissionId || data.submission_id;
        } catch (e) {
          // ignore parsing errors
        }
      }
      
      // Extract from message/title if not found in data
      if (!submissionId) {
        const idPattern = /ID[:\s]+([a-zA-Z0-9]+)/i;
        const messageMatch = notif.message.match(idPattern);
        const titleMatch = notif.title.match(idPattern);
        submissionId = messageMatch?.[1] || titleMatch?.[1];
      }
      
      if (submissionId) {
        // Check if submission exists
        const submission = await prisma.submission.findUnique({
          where: { id: submissionId }
        });
        
        if (!submission) {
          orphanedNotifications.push({
            notification: notif,
            submissionId: submissionId
          });
        }
      }
    }
    
    if (orphanedNotifications.length > 0) {
      console.log(`Found ${orphanedNotifications.length} orphaned notifications to clean up`);
      
      // Delete orphaned notifications
      for (const item of orphanedNotifications) {
        // First delete NotificationRead records
        await prisma.notificationRead.deleteMany({
          where: { notification_id: item.notification.id }
        });
        
        // Then delete the notification
        await prisma.notification.delete({
          where: { id: item.notification.id }
        });
        
        console.log(`✅ Deleted orphaned notification ${item.notification.id} (${item.notification.type})`);
      }
      
      console.log(`✅ Successfully cleaned up ${orphanedNotifications.length} orphaned notifications`);
      return orphanedNotifications.length;
    } else {
      console.log('✅ No orphaned notifications found');
      return 0;
    }
    
  } catch (error) {
    console.error('❌ Error during notification cleanup:', error);
    throw error;
  }
}

/**
 * Clean up notifications specifically for a deleted submission
 * This is called when a submission is deleted
 */
export async function cleanupSubmissionNotifications(submissionId: string) {
  try {
    console.log(`🧹 Cleaning up notifications for deleted submission: ${submissionId}`);
    
    // Find notifications that reference this specific submission
    const notificationsToDelete = await prisma.notification.findMany({
      where: {
        OR: [
          { data: { contains: submissionId } },
          { message: { contains: submissionId } },
          { title: { contains: submissionId } }
        ]
      }
    });
    
    console.log(`Found ${notificationsToDelete.length} notifications to delete for submission ${submissionId}`);
    
    // Delete NotificationRead records first (due to foreign key constraints)
    for (const notification of notificationsToDelete) {
      await prisma.notificationRead.deleteMany({
        where: { notification_id: notification.id }
      });
    }
    
    // Delete the notifications
    const deleteResult = await prisma.notification.deleteMany({
      where: {
        OR: [
          { data: { contains: submissionId } },
          { message: { contains: submissionId } },
          { title: { contains: submissionId } }
        ]
      }
    });
    
    console.log(`✅ Deleted ${deleteResult.count} notifications for submission ${submissionId}`);
    
    // Broadcast notification removal to all clients
    await notifyNotificationsRemoved(submissionId);
    
    return deleteResult.count;
    
  } catch (error) {
    console.error(`❌ Error cleaning notifications for submission ${submissionId}:`, error);
    throw error;
  }
}


=== FILE: src/lib/parseNumber.ts ===
export function numberToBahasa(n: number): string {
    if (n === 0) return "Nol";

    const satuan = [
        "",
        "Satu",
        "Dua",
        "Tiga",
        "Empat",
        "Lima",
        "Enam",
        "Tujuh",
        "Delapan",
        "Sembilan",
        "Sepuluh",
        "Sebelas",
    ];

    function toWords(x: number): string {
        let str = "";
        if (x < 12) {
            str = satuan[x] ?? "";
        } else if (x < 20) {
            str = toWords(x - 10) + " Belas";
        } else if (x < 100) {
            str = toWords(Math.floor(x / 10)) + " Puluh " + toWords(x % 10);
        } else if (x < 200) {
            str = "Seratus " + toWords(x - 100);
        } else if (x < 1000) {
            str = toWords(Math.floor(x / 100)) + " Ratus " + toWords(x % 100);
        } else if (x < 2000) {
            str = "Seribu " + toWords(x - 1000);
        } else if (x < 1_000_000) {
            str = toWords(Math.floor(x / 1000)) + " Ribu " + toWords(x % 1000);
        } else if (x < 1_000_000_000) {
            str = toWords(Math.floor(x / 1_000_000)) + " Juta " + toWords(x % 1_000_000);
        } else if (x < 1_000_000_000_000) {
            str = toWords(Math.floor(x / 1_000_000_000)) + " Miliar " + toWords(x % 1_000_000_000);
        } else if (x < 1_000_000_000_000_000) {
            str = toWords(Math.floor(x / 1_000_000_000_000)) + " Triliun " + toWords(x % 1_000_000_000_000);
        }
        return str.trim();
    }

    return toWords(n).replace(/\s+/g, " ").trim();
}

=== FILE: src/lib/prisma.ts ===
/**
 * Legacy Prisma Client - Deprecated
 * Use prisma from @/lib/singletons instead
 */

export { prisma } from './singletons';


=== FILE: src/lib/qr-security.ts ===
import crypto from 'crypto';

// Salt untuk hashing - harus disimpan secure
const QR_SALT = process.env.QR_SECURITY_SALT || 'default-salt-change-in-production';

export interface QrPayload {
  id: string;
  start_date: string | null;
  end_date: string | null;
  timestamp: number;
}

export interface SimpleQrData {
  i: string;           // submission ID (shortened key)
  e: number;          // Expiration timestamp (shortened key)
  s: string;          // Short signature for verification (shortened key)
}

/**
 * Generate simple QR code data with minimal information
 */
export function generateSimpleQrData(submission: {
  id: string;
  implementation_start_date?: string | Date | null;
  implementation_end_date?: string | Date | null;
}): SimpleQrData {
  // Use only submission ID and expiration
  const expiration = Date.now() + (24 * 60 * 60 * 1000); // 24 hours from now
  
  // Create a signature using only essential data
  const signatureData = `${submission.id}|${expiration}|${QR_SALT}`;
  const fullHash = crypto.createHash('sha256').update(signatureData).digest('hex');
  
  // Use first 32 characters of hash for improved security
  const signature = fullHash.substring(0, 32);

  return {
    i: submission.id,    // shortened key names for smaller JSON
    e: expiration,
    s: signature
  };
}

/**
 * Verify simple QR data
 */
export function verifySimpleQrData(qrData: SimpleQrData): boolean {
  try {
    // Check expiration
    if (Date.now() > qrData.e) {
      console.error('QR code has expired');
      return false;
    }

    // Verify signature
    const signatureData = `${qrData.i}|${qrData.e}|${QR_SALT}`;
    const expectedHash = crypto.createHash('sha256').update(signatureData).digest('hex');
    const expectedSignature = expectedHash.substring(0, 32);

    if (expectedSignature !== qrData.s) {
      console.error('QR signature verification failed');
      return false;
    }

    return true;
  } catch (error) {
    console.error('QR verification failed:', error);
    return false;
  }
}

/**
 * Generate QR code string that can be encoded to QR image (ULTRA SIMPLIFIED)
 */
export function generateQrString(submission: {
  id: string;
  implementation_start_date?: string | Date | null;
  implementation_end_date?: string | Date | null;
}): string {
  const qrData = generateSimpleQrData(submission);
  
  // Create extremely compact QR string - no JSON, direct concatenation
  // Format: SL:submissionId:expiration:signature
  return `SL:${qrData.i}:${qrData.e}:${qrData.s}`;
}

/**
 * Parse QR string and verify it (ULTRA SIMPLIFIED)
 */
export function parseQrString(qrString: string): QrPayload | null {
  try {
    // Check if it's just a submission ID (legacy format or manual QR)
    if (!qrString.includes(':') && !qrString.includes('|')) {
      // This might be a raw submission ID - attempt to handle gracefully
      if (qrString.length > 20 && qrString.match(/^[a-zA-Z0-9]+$/)) {
        console.warn('QR code appears to be a raw submission ID (unsecure format):', qrString);
        // Return a basic payload with just the ID for backward compatibility
        return {
          id: qrString,
          start_date: null,
          end_date: null,
          timestamp: Date.now() // Current time as timestamp
        };
      }
    }
    
    // Handle old base64 format for backward compatibility
    if (qrString.includes('|')) {
      const parts = qrString.split('|');
      
      if (parts.length !== 2 || parts[0] !== 'SL') {
        console.error('Invalid QR format. Expected "SL|base64data", got:', qrString);
        throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');
      }

      const base64Part = parts[1];
      if (!base64Part) {
        throw new Error('Missing QR data');
      }

      // Decode base64 data
      const dataString = Buffer.from(base64Part, 'base64').toString('utf8');
      const qrData: any = JSON.parse(dataString);
      
      // Handle old format with full keys
      const normalizedData: SimpleQrData = {
        i: qrData.id || qrData.i,
        e: qrData.exp || qrData.e, 
        s: qrData.sig || qrData.s
      };
      
      if (!normalizedData.i || !normalizedData.e || !normalizedData.s) {
        throw new Error('Invalid QR data structure');
      }

      // Verify the QR data
      if (!verifySimpleQrData(normalizedData)) {
        throw new Error('QR verification failed');
      }

      // Convert to QrPayload format for compatibility
      const payload: QrPayload = {
        id: normalizedData.i,
        start_date: null,
        end_date: null,
        timestamp: normalizedData.e - (24 * 60 * 60 * 1000)
      };

      return payload;
    }
    
    // Handle new colon-separated format: SL:submissionId:expiration:signature
    const parts = qrString.split(':');
    
    if (parts.length !== 4 || parts[0] !== 'SL') {
      console.error('Invalid QR format. Expected "SL:id:exp:sig", got:', qrString);
      throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');
    }

    const [, submissionId, expirationStr, signature] = parts;
    
    if (!submissionId || !expirationStr || !signature) {
      throw new Error('Missing QR data components');
    }

    const expiration = parseInt(expirationStr, 10);
    if (isNaN(expiration)) {
      throw new Error('Invalid expiration timestamp');
    }

    const qrData: SimpleQrData = {
      i: submissionId,
      e: expiration,
      s: signature
    };

    // Verify the QR data
    if (!verifySimpleQrData(qrData)) {
      throw new Error('QR verification failed');
    }

    // Convert to QrPayload format for compatibility
    const payload: QrPayload = {
      id: qrData.i,
      start_date: null, // We don't store dates in simple QR anymore
      end_date: null,
      timestamp: qrData.e - (24 * 60 * 60 * 1000) // Calculate original timestamp
    };

    return payload;
  } catch (error) {
    console.error('QR parsing failed:', error);
    return null;
  }
}

/**
 * Check if a QR payload is valid for the current date
 */
export function isQrValidForDate(payload: QrPayload, checkDate: Date = new Date()): boolean {
  const startDate = payload.start_date ? new Date(payload.start_date) : null;
  const endDate = payload.end_date ? new Date(payload.end_date) : null;

  // If no implementation dates are set, QR is considered valid
  if (!startDate && !endDate) {
    return true;
  }

  // Check if current date is within implementation period
  const now = checkDate.getTime();
  
  if (startDate && now < startDate.getTime()) {
    return false; // Too early
  }
  
  if (endDate && now > endDate.getTime()) {
    return false; // Too late
  }

  return true;
}


=== FILE: src/lib/redis.ts ===
import Redis from 'ioredis';

declare global {
  var __redis_pub: Redis | undefined;
  var __redis_sub: Redis | undefined;
}

let pubClient: Redis;
let subClient: Redis;

if (process.env.NODE_ENV === 'production') {
  pubClient = new Redis(process.env.REDIS_URL!);
  subClient = new Redis(process.env.REDIS_URL!);
} else {
  // In development, use globalThis to persist connections across hot reloads
  if (!globalThis.__redis_pub) {
    globalThis.__redis_pub = new Redis(process.env.REDIS_URL!);
  }
  if (!globalThis.__redis_sub) {
    globalThis.__redis_sub = new Redis(process.env.REDIS_URL!);
  }
  
  pubClient = globalThis.__redis_pub;
  subClient = globalThis.__redis_sub;
}

// Error handling
pubClient.on('error', (err) => {
  console.error('Redis pub client error:', err);
});

subClient.on('error', (err) => {
  console.error('Redis sub client error:', err);
});

pubClient.on('connect', () => {
  console.log('Redis pub client connected');
});

subClient.on('connect', () => {
  console.log('Redis sub client connected');
});

export { pubClient, subClient };


=== FILE: src/lib/singletons.ts ===
/**
 * Singletons for Prisma, Redis, and Socket.IO Server
 * Safe for Hot Module Replacement in development
 */

import { PrismaClient } from '@prisma/client';
import Redis from 'ioredis';
import { Server as SocketIOServer } from 'socket.io';
import { createAdapter } from '@socket.io/redis-adapter';

declare global {
  var __prisma: PrismaClient | undefined;
  var __redis_pub: Redis | undefined;
  var __redis_sub: Redis | undefined;
  var __socket_io: SocketIOServer | undefined;
}

/**
 * Prisma Singleton
 */
export const prisma = globalThis.__prisma ?? new PrismaClient({
  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],
});

if (process.env.NODE_ENV !== 'production') {
  globalThis.__prisma = prisma;
}

/**
 * Redis Clients Singleton
 */
function createRedisClient(prefix = ''): Redis {
  const redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';
  
  const client = new Redis(redisUrl, {
    lazyConnect: true,
    enableReadyCheck: false,
    maxRetriesPerRequest: null,
    ...(prefix && { keyPrefix: `${prefix}:` }),
  });

  client.on('error', (err) => {
    console.warn(`Redis client error (${prefix || 'default'}):`, err.message);
  });

  client.on('connect', () => {
    console.log(`Redis client connected (${prefix || 'default'})`);
  });

  return client;
}

export const redisPub = globalThis.__redis_pub ?? createRedisClient('pub');
export const redisSub = globalThis.__redis_sub ?? createRedisClient('sub');

if (process.env.NODE_ENV !== 'production') {
  globalThis.__redis_pub = redisPub;
  globalThis.__redis_sub = redisSub;
}

/**
 * Socket.IO Server Singleton
 * Will be initialized when HTTP server is available
 */
export function getSocketIO(): SocketIOServer | null {
  return globalThis.__socket_io || null;
}

export function setSocketIO(io: SocketIOServer): void {
  globalThis.__socket_io = io;
}

/**
 * Initialize Socket.IO with Redis adapter
 */
export function initializeSocketIO(httpServer: any): SocketIOServer {
  if (globalThis.__socket_io) {
    return globalThis.__socket_io;
  }

  const io = new SocketIOServer(httpServer, {
    path: '/api/socket',
    addTrailingSlash: false,
    cors: {
      origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',
      methods: ['GET', 'POST'],
    },
    transports: ['websocket', 'polling'],
  });

  // Setup Redis adapter
  try {
    io.adapter(createAdapter(redisPub, redisSub));
    console.log('Socket.IO Redis adapter initialized');
  } catch (error) {
    console.warn('Socket.IO Redis adapter failed, using memory adapter:', error);
  }

  setSocketIO(io);
  return io;
}


=== FILE: src/lib/utils.ts ===
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

/**
 * Utility function to merge Tailwind CSS classes
 * Handles conflicts and ensures proper class precedence
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

/**
 * Format date to Indonesian locale
 */
export function formatDate(
  date: Date | string | null,
  options: Intl.DateTimeFormatOptions = {}
): string {
  if (!date) return '-';
  
  const dateObject = typeof date === 'string' ? new Date(date) : date;
  
  const defaultOptions: Intl.DateTimeFormatOptions = {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    ...options,
  };
  
  return dateObject.toLocaleDateString('id-ID', defaultOptions);
}

/**
 * Format date to ISO string for input fields
 */
export function formatDateForInput(date: Date | string | null): string {
  if (!date) return '';
  
  const dateObject = typeof date === 'string' ? new Date(date) : date;
  return dateObject.toISOString().split('T')[0]!;
}

/**
 * Format currency to Indonesian Rupiah
 */
export function formatCurrency(amount: number): string {
  return new Intl.NumberFormat('id-ID', {
    style: 'currency',
    currency: 'IDR',
    minimumFractionDigits: 0,
  }).format(amount);
}

/**
 * Format file size in human readable format
 */
export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 Bytes';
  
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
}

/**
 * Capitalize first letter of each word
 */
export function capitalize(str: string): string {
  return str.replace(/\w\S*/g, txt => 
    txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
  );
}

/**
 * API response helpers for server actions and services
 */
export const actionResponse = {
  success: <T>(data: T, message?: string) => ({
    success: true as const,
    data,
    message,
    error: null,
  }),
  
  error: (message: string, error?: any) => {
    console.error('Action Error:', message, error);
    return {
      success: false as const,
      data: null,
      message,
      error: error instanceof Error ? error.message : String(error),
    };
  },
};

export const serviceResponse = {
  success: <T>(data: T, message?: string) => ({
    success: true as const,
    data,
    message,
    error: null,
  }),
  
  error: (message: string, error?: any) => {
    console.error('Service Error:', message, error);
    return {
      success: false as const,
      data: null,
      message,
      error: error instanceof Error ? error.message : String(error),
    };
  },
};

/**
 * Generate a random string of specified length
 */
export function generateRandomString(length: number = 8): string {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let result = '';
  for (let i = 0; i < length; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
}

/**
 * Debounce function to limit function calls
 */
export function debounce<T extends (...args: unknown[]) => unknown>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void {
  let timeout: NodeJS.Timeout;
  
  return (...args: Parameters<T>) => {
    clearTimeout(timeout);
    timeout = setTimeout(() => func(...args), wait);
  };
}

/**
 * Deep clone an object
 */
export function deepClone<T>(obj: T): T {
  if (obj === null || typeof obj !== 'object') return obj;
  if (obj instanceof Date) return new Date(obj.getTime()) as unknown as T;
  if (obj instanceof Array) return obj.map(item => deepClone(item)) as unknown as T;
  if (typeof obj === 'object') {
    const cloned = {} as T;
    for (const key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        cloned[key] = deepClone(obj[key]);
      }
    }
    return cloned;
  }
  return obj;
}

/**
 * Sleep function for async operations
 */
export function sleep(ms: number): Promise<void> {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * Safe JSON parse with fallback
 */
export function safeJsonParse<T>(json: string, fallback: T): T {
  try {
    return JSON.parse(json) as T;
  } catch {
    return fallback;
  }
}

/**
 * Check if value is empty (null, undefined, empty string, empty array, empty object)
 */
export function isEmpty(value: unknown): boolean {
  if (value === null || value === undefined) return true;
  if (typeof value === 'string') return value.trim().length === 0;
  if (Array.isArray(value)) return value.length === 0;
  if (typeof value === 'object') return Object.keys(value).length === 0;
  return false;
}

/**
 * Create URL with query parameters
 */
export function createUrl(baseUrl: string, params: Record<string, string | number | boolean | null | undefined>): string {
  const url = new URL(baseUrl, typeof window !== 'undefined' ? window.location.origin : 'http://localhost:3000');
  
  Object.entries(params).forEach(([key, value]) => {
    if (value !== null && value !== undefined) {
      url.searchParams.set(key, String(value));
    }
  });
  
  return url.toString();
}

/**
 * Extract initials from full name
 */
export function getInitials(name: string, maxLength: number = 2): string {
  return name
    .split(' ')
    .map(word => word.charAt(0).toUpperCase())
    .slice(0, maxLength)
    .join('');
}


=== FILE: src/middleware/SessionValidation.ts ===
/**
 * Session Validation Middleware
 * Auto-logout when session ID doesn't exist in database
 */

import { NextRequest, NextResponse } from 'next/server';
import { getToken } from 'next-auth/jwt';
import { prisma } from '@/lib/prisma';

interface SessionValidationResult {
  isValid: boolean;
  userId?: string;
  sessionExpired?: boolean;
  shouldLogout?: boolean;
  reason?: string;
}

export class SessionValidationService {
  private static readonly EXCLUDED_PATHS = [
    '/api/auth',
    '/api/health',
    '/login',
    '/register',
    '/_next',
    '/favicon.ico',
  ];

  /**
   * Validate session against database
   */
  static async validateSession(request: NextRequest): Promise<SessionValidationResult> {
    try {
      // Get token from NextAuth
      const token = await getToken({ 
        req: request,
        secret: process.env.NEXTAUTH_SECRET || 'fallback-secret'
      });

      if (!token || !token.sub) {
        return {
          isValid: false,
          shouldLogout: true,
          reason: 'No valid token found',
        };
      }

      const userId = token.sub;

      // Check if user exists in database
      const user = await prisma.user.findUnique({
        where: { id: userId },
        select: {
          id: true,
          isActive: true,
          verified_at: true,
          lastActiveAt: true,
          sessionExpiry: true,
        },
      });

      if (!user) {
        return {
          isValid: false,
          shouldLogout: true,
          reason: 'User not found in database',
        };
      }

      if (!user.isActive) {
        return {
          isValid: false,
          shouldLogout: true,
          reason: 'User account is deactivated',
        };
      }

      if (!user.verified_at) {
        return {
          isValid: false,
          shouldLogout: true,
          reason: 'User account is not verified',
        };
      }

      // Check session expiry if set
      if (user.sessionExpiry && new Date() > user.sessionExpiry) {
        return {
          isValid: false,
          shouldLogout: true,
          sessionExpired: true,
          reason: 'Session has expired',
        };
      }

      // Update last active timestamp
      await prisma.user.update({
        where: { id: userId },
        data: { lastActiveAt: new Date() },
      });

      return {
        isValid: true,
        userId: userId,
      };

    } catch (error) {
      console.error('Session validation error:', error);
      return {
        isValid: false,
        shouldLogout: true,
        reason: 'Session validation failed',
      };
    }
  }

  /**
   * Check if path should be excluded from session validation
   */
  static shouldExcludePath(pathname: string): boolean {
    return this.EXCLUDED_PATHS.some(path => pathname.startsWith(path));
  }

  /**
   * Create logout response with proper cleanup
   */
  static createLogoutResponse(request: NextRequest, reason?: string): NextResponse {
    const response = NextResponse.redirect(new URL('/login', request.url));
    
    // Clear NextAuth cookies
    response.cookies.delete('next-auth.session-token');
    response.cookies.delete('__Secure-next-auth.session-token');
    response.cookies.delete('next-auth.csrf-token');
    response.cookies.delete('__Host-next-auth.csrf-token');
    response.cookies.delete('next-auth.callback-url');
    response.cookies.delete('__Secure-next-auth.callback-url');

    // Add logout reason as query parameter
    if (reason) {
      const url = new URL('/login', request.url);
      url.searchParams.set('logout_reason', encodeURIComponent(reason));
      return NextResponse.redirect(url);
    }

    return response;
  }

  /**
   * Middleware function for automatic session validation
   */
  static async middleware(request: NextRequest): Promise<NextResponse> {
    const { pathname } = request.nextUrl;

    // Skip validation for excluded paths
    if (this.shouldExcludePath(pathname)) {
      return NextResponse.next();
    }

    // Validate session
    const validation = await this.validateSession(request);

    if (!validation.isValid && validation.shouldLogout) {
      console.log(`Auto-logout triggered: ${validation.reason}`);
      return this.createLogoutResponse(request, validation.reason);
    }

    // Add user ID to request headers for downstream use
    if (validation.userId) {
      const requestHeaders = new Headers(request.headers);
      requestHeaders.set('x-user-id', validation.userId);
      
      return NextResponse.next({
        request: {
          headers: requestHeaders,
        },
      });
    }

    return NextResponse.next();
  }

  /**
   * Force logout user by clearing their session
   */
  static async forceLogout(userId: string, reason: string = 'Admin action'): Promise<void> {
    try {
      
      // Update user session expiry to force logout
      await prisma.user.update({
        where: { id: userId },
        data: {
          sessionExpiry: new Date(), // Set to current time to expire immediately
        },
      });

      console.log(`Force logout applied to user ${userId}: ${reason}`);
    } catch (error) {
      console.error('Force logout error:', error);
      throw error;
    }
  }

  /**
   * Extend user session
   */
  static async extendSession(
    userId: string, 
    extensionMinutes: number = 60
  ): Promise<void> {
    try {
      const newExpiry = new Date(Date.now() + extensionMinutes * 60 * 1000);
      
      await prisma.user.update({
        where: { id: userId },
        data: {
          sessionExpiry: newExpiry,
        },
      });

      console.log(`Session extended for user ${userId} until ${newExpiry.toISOString()}`);
    } catch (error) {
      console.error('Session extension error:', error);
      throw error;
    }
  }

  /**
   * Check if session is about to expire (within warning threshold)
   */
  static async checkSessionExpiry(userId: string): Promise<{
    isExpiring: boolean;
    minutesRemaining?: number;
    expiryTime?: Date;
  }> {
    try {
      const user = await prisma.user.findUnique({
        where: { id: userId },
        select: { sessionExpiry: true },
      });

      if (!user?.sessionExpiry) {
        return { isExpiring: false };
      }

      const now = new Date();
      const expiry = user.sessionExpiry;
      const minutesRemaining = Math.floor((expiry.getTime() - now.getTime()) / (60 * 1000));

      // Warn if session expires within 10 minutes
      const isExpiring = minutesRemaining <= 10 && minutesRemaining > 0;

      return {
        isExpiring,
        minutesRemaining: Math.max(0, minutesRemaining),
        expiryTime: expiry,
      };
    } catch (error) {
      console.error('Session expiry check error:', error);
      return { isExpiring: false };
    }
  }

  /**
   * Get active sessions count for admin dashboard
   */
  static async getActiveSessionsCount(): Promise<number> {
    try {
      const fifteenMinutesAgo = new Date(Date.now() - 15 * 60 * 1000);
      
      const count = await prisma.user.count({
        where: {
          isActive: true,
          lastActiveAt: {
            gte: fifteenMinutesAgo,
          },
        },
      });

      return count;
    } catch (error) {
      console.error('Active sessions count error:', error);
      return 0;
    }
  }
}

/**
 * API Route helper for session validation
 */
export async function validateApiSession(request: NextRequest): Promise<{
  isValid: boolean;
  userId?: string;
  error?: string;
}> {
  const validation = await SessionValidationService.validateSession(request);
  
  if (!validation.isValid) {
    return {
      isValid: false,
      error: validation.reason || 'Session invalid',
    };
  }

  return {
    isValid: true,
    userId: validation.userId!,
  };
}

/**
 * HOC for protecting API routes with session validation
 */
export function withSessionValidation(
  handler: (request: NextRequest, context: any) => Promise<NextResponse>
) {
  return async (request: NextRequest, context: any): Promise<NextResponse> => {
    const validation = await validateApiSession(request);
    
    if (!validation.isValid) {
      return NextResponse.json(
        { 
          error: 'Session invalid', 
          message: validation.error,
          shouldLogout: true 
        },
        { status: 401 }
      );
    }

    // Add user ID to request for handler use
    const requestHeaders = new Headers(request.headers);
    requestHeaders.set('x-user-id', validation.userId!);
    
    const enhancedRequest = new NextRequest(request.url, {
      ...request,
      headers: requestHeaders,
    });

    return handler(enhancedRequest, context);
  };
}

=== FILE: src/providers/AppProvider.tsx ===
"use client";

import { SessionProvider } from "next-auth/react";
import { ThemeProvider } from "@/context/ThemeContext";
import SessionExpiryHandler from "@/components/security/SessionExpiryHandler";
import ToastContainer from "@/components/ui/toast/ToastContainer";
import { SocketProvider } from "@/app/socket-provider";
import { ReactNode } from "react";

export default function AppProviders({ children }: { children: ReactNode }) {
  return (
    <SessionProvider>
      <ThemeProvider>
        <SocketProvider>
          <SessionExpiryHandler>
            {children}
            <ToastContainer />
          </SessionExpiryHandler>
        </SocketProvider>
      </ThemeProvider>
    </SessionProvider>
  );
}

=== FILE: src/server/events.ts ===
import { prisma } from '@/lib/singletons';
import { eventsPublisher } from './eventsPublisher';
import { notificationsPublisher } from './notificationsPublisher';
import type {
  AdminNewSubmissionEvent,
  AdminNewVendorEvent,
  VendorSubmissionStatusChangedEvent,
  NotificationNewEvent
} from '../shared/events';// Helper to count unread notifications
async function getUnreadCount(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId?: string): Promise<number> {
  if (scope === 'admin') {
    return await prisma.notification.count({
      where: {
        scope: 'admin',
        reads: {
          none: {}
        }
      }
    });
  } else if (scope === 'reviewer') {
    return await prisma.notification.count({
      where: {
        scope: 'reviewer',
        reads: {
          none: {}
        }
      }
    });
  } else if (scope === 'approver') {
    return await prisma.notification.count({
      where: {
        scope: 'approver',
        reads: {
          none: {}
        }
      }
    });
  } else if (scope === 'vendor' && vendorId) {
    return await prisma.notification.count({
      where: {
        scope: 'vendor',
        vendor_id: vendorId,
        reads: {
          none: {
            vendor_id: vendorId
          }
        }
      }
    });
  }
  
  return 0;
}

export async function notifyAdminNewSubmission(submissionId: string) {
  try {
    // Get submission details
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId },
      include: { user: true }
    });

    if (!submission) {
      throw new Error('Submission not found');
    }

    // Create notification record
    const notification = await prisma.notification.create({
      data: {
        scope: 'admin',
        type: 'new_submission',
        title: 'Pengajuan Simlok Baru',
        message: `Pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name}`,
        data: JSON.stringify({
          submissionId,
          vendorName: submission.vendor_name,
          officerName: submission.officer_name
        })
      }
    });

    // Emit events
    const submissionEvent: AdminNewSubmissionEvent = {
      submissionId,
      createdAt: submission.created_at.toISOString()
    };

    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'admin',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.adminNewSubmission(submissionEvent);
    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Update unread count
    const unreadCount = await getUnreadCount('admin');
    const unreadCountEvent = {
      scope: 'admin' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update stats
    const totalPending = await prisma.submission.count({
      where: { approval_status: 'PENDING' }
    });

    eventsPublisher.statsUpdate({
      scope: 'admin',
      changes: {
        pendingSubmissions: totalPending,
        totalSubmissions: await prisma.submission.count()
      }
    });

    // Also notify reviewers about new submission
    await notifyReviewerNewSubmission(submissionId);

    // Emit submission created event to reviewers
    eventsPublisher.submissionCreated({
      submissionId,
      vendorName: submission.vendor_name,
      officerName: submission.officer_name,
      createdAt: submission.created_at.toISOString()
    });

  } catch (error) {
    console.error('Error notifying admin new submission:', error);
  }
}

export async function notifyAdminNewVendor(vendorId: string) {
  try {
    // Get vendor details
    const vendor = await prisma.user.findUnique({
      where: { id: vendorId }
    });

    if (!vendor) {
      throw new Error('Vendor not found');
    }

    // Create notification record
    const notification = await prisma.notification.create({
      data: {
        scope: 'admin',
        type: 'new_vendor',
        title: 'Pendaftaran Vendor Baru',
        message: `Vendor baru mendaftar: ${vendor.vendor_name || vendor.officer_name}`,
        data: JSON.stringify({
          vendorId,
          vendorName: vendor.vendor_name,
          officerName: vendor.officer_name,
          email: vendor.email
        })
      }
    });

    // Emit events
    const vendorEvent: AdminNewVendorEvent = {
      vendorId,
      createdAt: vendor.created_at.toISOString()
    };

    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'admin',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.adminNewVendor(vendorEvent);
    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Update unread count
    const unreadCount = await getUnreadCount('admin');
    const unreadCountEvent = {
      scope: 'admin' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update stats
    const totalVendors = await prisma.user.count({
      where: { role: 'VENDOR' }
    });

    eventsPublisher.statsUpdate({
      scope: 'admin',
      changes: {
        totalVendors
      }
    });

  } catch (error) {
    console.error('Error notifying admin new vendor:', error);
  }
}

export async function notifyVendorStatusChange(
  vendorId: string, 
  submissionId: string, 
  status: 'PENDING' | 'APPROVED' | 'REJECTED'
) {
  try {
    // Get submission details
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId }
    });

    if (!submission) {
      throw new Error('Submission not found');
    }

    const statusText = {
      PENDING: 'Menunggu Persetujuan',
      APPROVED: 'Disetujui',
      REJECTED: 'Ditolak'
    }[status];

    // Truncate job description if too long
    // const truncateText = (text: string, maxLength: number = 50) => {
    //   return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;
    // };

    // const truncatedJobDescription = truncateText(submission.job_description);

    // Create more informative title and message with submission ID
    const title = status === 'APPROVED' 
      ? `Pengajuan Disetujui` 
      : status === 'REJECTED' 
        ? `Pengajuan Ditolak`
        : `Pengajuan ${statusText}`;

    const message = status === 'APPROVED'
      ? `Selamat! Pengajuan Simlok Anda telah disetujui.`
      : status === 'REJECTED'
        ? `Pengajuan Simlok Anda ditolak. Silakan periksa keterangan pada pengajuan.`
        : `Status pengajuan Simlok Anda berubah menjadi ${statusText.toLowerCase()}.`;

    // Create notification record
    const notification = await prisma.notification.create({
      data: {
        scope: 'vendor',
        vendor_id: vendorId,
        type: 'status_change',
        title: title,
        message: message,
        data: JSON.stringify({
          submissionId,
          status,
          jobDescription: submission.job_description
        })
      }
    });

    // Emit events
    const statusEvent: VendorSubmissionStatusChangedEvent = {
      submissionId,
      status,
      updatedAt: new Date().toISOString()
    };

    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'vendor',
      vendorId,
      createdAt: notification.created_at.toISOString()
    };

  eventsPublisher.vendorSubmissionStatusChanged(vendorId, statusEvent);
  eventsPublisher.notificationNew(notificationEvent);
  
  // Emit specific submission finalized event
  eventsPublisher.submissionFinalized(vendorId, {
    submissionId,
    finalStatus: status,
    finalizedBy: 'Approver', // You might want to pass actual approver name
    finalizedAt: new Date().toISOString()
  });
  
  // Publish to real-time subscribers via Redis
  await notificationsPublisher.publishNotification(notificationEvent);

  // Update unread count
  const unreadCount = await getUnreadCount('vendor', vendorId);
  const unreadCountEvent = {
    scope: 'vendor' as const,
    vendorId,
    unreadCount: unreadCount,
    count: unreadCount
  };
  eventsPublisher.notificationUnreadCount(unreadCountEvent);
  await notificationsPublisher.publishUnreadCount(unreadCountEvent);    // Update vendor stats
    const vendorSubmissions = await prisma.submission.findMany({
      where: { user_id: vendorId }
    });

    const stats = {
      totalSubmissions: vendorSubmissions.length,
      pendingSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'PENDING').length,
      approvedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'APPROVED').length,
      rejectedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'REJECTED').length
    };

    eventsPublisher.statsUpdate({
      scope: 'vendor',
      vendorId,
      changes: stats
    });

  } catch (error) {
    console.error('Error notifying vendor status change:', error);
  }
}

export async function notifyNotificationsRemoved(submissionId: string) {
  try {
    console.log(`Broadcasting notification removal for submission: ${submissionId}`);

    // Create event for notification removal
    const notificationRemovalEvent = {
      submissionId,
      timestamp: new Date().toISOString()
    };

    // Emit to Socket.io clients
    eventsPublisher.notificationRemoved(notificationRemovalEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotificationRemoval(notificationRemovalEvent);

    console.log(`✅ Broadcasted notification removal for submission: ${submissionId}`);

  } catch (error) {
    console.error('Error broadcasting notification removal:', error);
  }
}

export async function notifyReviewerNewUser(userId: string) {
  try {
    // Get user details
    const user = await prisma.user.findUnique({
      where: { id: userId }
    });

    if (!user) {
      throw new Error('User not found');
    }

    // Create notification record for reviewers
    const notification = await prisma.notification.create({
      data: {
        scope: 'reviewer',
        type: 'new_user_verification',
        title: 'User Baru Perlu Verifikasi',
        message: `User baru ${user.vendor_name || user.officer_name} perlu diverifikasi`,
        data: JSON.stringify({
          userId,
          vendorName: user.vendor_name,
          officerName: user.officer_name,
          email: user.email,
          phoneNumber: user.phone_number,
          registrationDate: user.created_at.toISOString()
        })
      }
    });

    // Create notification event
    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'reviewer',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Emit specific user verification event
    eventsPublisher.userVerificationNeeded({
      userId,
      vendorName: user.vendor_name || '',
      officerName: user.officer_name,
      email: user.email,
      createdAt: user.created_at.toISOString()
    });

    // Update unread count for reviewers
    const unreadCount = await getUnreadCount('reviewer');
    const unreadCountEvent = {
      scope: 'reviewer' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update reviewer stats
    const totalPendingUsers = await prisma.user.count({
      where: { 
        verified_at: null,
        role: 'VENDOR' // Only vendor users need verification
      }
    });

    eventsPublisher.statsUpdate({
      scope: 'reviewer',
      changes: {
        pendingUserVerifications: totalPendingUsers
      }
    });

    console.log(`✅ Notified reviewers about new user: ${userId}`);

  } catch (error) {
    console.error('Error notifying reviewer new user:', error);
  }
}

export async function notifyReviewerNewSubmission(submissionId: string) {
  try {
    // Get submission details
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId },
      include: { user: true }
    });

    if (!submission) {
      throw new Error('Submission not found');
    }

    // Create notification record for reviewers
    const notification = await prisma.notification.create({
      data: {
        scope: 'reviewer',
        type: 'new_submission_review',
        title: 'Pengajuan Simlok Baru untuk Review',
        message: `Ada pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name} yang perlu direview`,
        data: JSON.stringify({
          submissionId,
          vendorName: submission.vendor_name,
          officerName: submission.officer_name,
          jobDescription: submission.job_description
        })
      }
    });

    // Create notification event
    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'reviewer',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Update unread count for reviewers
    const unreadCount = await getUnreadCount('reviewer');
    const unreadCountEvent = {
      scope: 'reviewer' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update reviewer stats
    const totalPendingReview = await prisma.submission.count({
      where: { review_status: 'PENDING_REVIEW' }
    });

    eventsPublisher.statsUpdate({
      scope: 'reviewer',
      changes: {
        pendingReview: totalPendingReview,
        totalSubmissions: await prisma.submission.count()
      }
    });

    console.log(`✅ Notified reviewers about new submission: ${submissionId}`);

  } catch (error) {
    console.error('Error notifying reviewer new submission:', error);
  }
}

export async function notifyApproverReviewedSubmission(submissionId: string) {
  try {
    // Get submission details
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId },
      include: { 
        user: true,
        reviewed_by_user: {
          select: {
            officer_name: true
          }
        }
      }
    });

    if (!submission) {
      throw new Error('Submission not found');
    }

    // Determine notification message and type based on review status
    let notificationMessage: string;
    let notificationType: string;
    let notificationTitle: string;
    
    if (submission.review_status === 'MEETS_REQUIREMENTS') {
      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan perlu persetujuan final`;
      notificationType = 'reviewed_submission_approval';
      notificationTitle = 'Pengajuan Simlok Perlu Persetujuan';
    } else {
      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan tidak memenuhi syarat`;
      notificationType = 'reviewed_submission_rejection';
      notificationTitle = 'Pengajuan Simlok Sudah Direview';
    }

    // Create notification record for approvers (for both meets and doesn't meet requirements)
    const notification = await prisma.notification.create({
      data: {
        scope: 'approver',
        type: notificationType,
        title: notificationTitle,
        message: notificationMessage,
        data: JSON.stringify({
          submissionId,
          vendorName: submission.vendor_name,
          officerName: submission.officer_name,
          jobDescription: submission.job_description,
          reviewedBy: submission.reviewed_by_user?.officer_name,
          reviewStatus: submission.review_status,
          reviewNote: submission.review_note
        })
      }
    });

    // Create notification event
    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'approver',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Emit specific submission reviewed event
    eventsPublisher.submissionReviewed({
      submissionId,
      reviewStatus: submission.review_status,
      reviewedBy: submission.reviewed_by_user?.officer_name || 'Unknown',
      reviewedAt: new Date().toISOString()
    });

    // Update unread count for approvers
    const unreadCount = await getUnreadCount('approver');
    const unreadCountEvent = {
      scope: 'approver' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update approver stats
    const totalPendingFinal = await prisma.submission.count({
      where: { 
        review_status: 'MEETS_REQUIREMENTS',
        final_status: 'PENDING_APPROVAL'
      }
    });

    eventsPublisher.statsUpdate({
      scope: 'approver',
      changes: {
        pendingFinalApproval: totalPendingFinal,
        totalReviewedSubmissions: await prisma.submission.count({
          where: { review_status: { not: 'PENDING_REVIEW' } }
        })
      }
    });

    console.log(`✅ Notified approvers about reviewed submission: ${submissionId}`);

  } catch (error) {
    console.error('Error notifying approver reviewed submission:', error);
  }
}

export async function notifyUserVerificationResult(
  userId: string, 
  verificationStatus: 'VERIFY' | 'REJECT',
  note?: string
) {
  try {
    // Get user details
    const user = await prisma.user.findUnique({
      where: { id: userId }
    });

    if (!user) {
      throw new Error('User not found');
    }

    const title = verificationStatus === 'VERIFY' 
      ? 'Akun Anda Telah Diverifikasi' 
      : 'Verifikasi Akun Ditolak';
      
    const message = verificationStatus === 'VERIFY'
      ? 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.'
      : `Maaf, akun vendor Anda tidak dapat diverifikasi. ${note || 'Silakan hubungi admin untuk informasi lebih lanjut.'}`;

    // Create notification event
    const notificationEvent: NotificationNewEvent = {
      id: `temp_${Date.now()}`, // Will be replaced when notification is created
      type: verificationStatus === 'VERIFY' ? 'user_verified' : 'user_rejected',
      title: title,
      message: message,
      data: JSON.stringify({
        userId,
        verificationStatus,
        note
      }),
      scope: 'vendor',
      vendorId: userId,
      createdAt: new Date().toISOString()
    };

    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Emit specific user verification result event
    eventsPublisher.userVerificationResult(userId, {
      userId,
      status: verificationStatus,
      verifiedAt: new Date().toISOString(),
      note: note || ''
    });

    // Update unread count for the specific vendor
    const unreadCount = await getUnreadCount('vendor', userId);
    const unreadCountEvent = {
      scope: 'vendor' as const,
      vendorId: userId,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update vendor stats
    const totalPendingUsers = await prisma.user.count({
      where: { 
        verified_at: null,
        role: 'VENDOR'
      }
    });

    // Update reviewer stats  
    eventsPublisher.statsUpdate({
      scope: 'reviewer',
      changes: {
        pendingUserVerifications: totalPendingUsers
      }
    });

    console.log(`✅ Notified user about verification result: ${userId} - ${verificationStatus}`);

  } catch (error) {
    console.error('Error notifying user verification result:', error);
  }
}

// notifyReviewerFinalDecision function removed - reviewers no longer need notification when submissions are approved/rejected

export async function notifyReviewerSubmissionApproved(submissionId: string) {
  try {
    // Get submission details
    const submission = await prisma.submission.findUnique({
      where: { id: submissionId },
      include: { 
        user: true,
        approved_by_final_user: true
      }
    });

    if (!submission) {
      throw new Error('Submission not found');
    }

    // Only notify if submission is approved
    if (submission.final_status !== 'APPROVED') {
      return;
    }

    const notificationTitle = 'Pengajuan Simlok Disetujui';
    const notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} telah disetujui oleh Approver`;

    // Create notification record for reviewers
    const notification = await prisma.notification.create({
      data: {
        scope: 'reviewer',
        type: 'submission_approved',
        title: notificationTitle,
        message: notificationMessage,
        data: JSON.stringify({
          submissionId,
          vendorName: submission.vendor_name,
          officerName: submission.officer_name,
          jobDescription: submission.job_description,
          approvedBy: submission.approved_by_final_user?.officer_name,
          finalStatus: submission.final_status,
          simlokNumber: submission.simlok_number,
          approvedAt: submission.approved_at
        })
      }
    });

    // Create notification event
    const notificationEvent: NotificationNewEvent = {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data,
      scope: 'reviewer',
      createdAt: notification.created_at.toISOString()
    };

    eventsPublisher.notificationNew(notificationEvent);
    
    // Publish to real-time subscribers via Redis
    await notificationsPublisher.publishNotification(notificationEvent);

    // Update unread count for reviewers
    const unreadCount = await getUnreadCount('reviewer');
    const unreadCountEvent = {
      scope: 'reviewer' as const,
      unreadCount: unreadCount,
      count: unreadCount
    };
    eventsPublisher.notificationUnreadCount(unreadCountEvent);
    await notificationsPublisher.publishUnreadCount(unreadCountEvent);

    // Update reviewer stats
    const totalApproved = await prisma.submission.count({
      where: { final_status: 'APPROVED' }
    });

    eventsPublisher.statsUpdate({
      scope: 'reviewer',
      changes: {
        approvedSubmissions: totalApproved,
        totalSubmissions: await prisma.submission.count()
      }
    });

    console.log(`✅ Notified reviewers about approved submission: ${submissionId}`);

  } catch (error) {
    console.error('Error notifying reviewers about approved submission:', error);
  }
}


=== FILE: src/server/eventsPublisher.ts ===
/**
 * Events Publisher Service
 * Handles all business event emissions to Socket.IO rooms
 */

import { getSocketIO } from '@/lib/singletons';
import { EVENT_NAMES, ROOMS } from '@/shared/events';
import type {
  AdminNewSubmissionEvent,
  AdminNewVendorEvent,
  VendorSubmissionStatusChangedEvent,
  NotificationNewEvent,
  NotificationUnreadCountEvent,
  StatsUpdateEvent,
} from '@/shared/events';

class EventsPublisher {
  private io = getSocketIO();

  /**
   * Get Socket.IO instance (refreshed each call for HMR safety)
   */
  private getIO() {
    if (!this.io) {
      this.io = getSocketIO();
    }
    return this.io;
  }

  /**
   * Emit event to admin room
   */
  private emitToAdmin(event: string, payload: any) {
    const io = this.getIO();
    if (io) {
      io.to(ROOMS.ADMIN).emit(event, payload);
      console.log(`[Events] Emitted ${event} to admin room:`, payload);
    } else {
      console.warn(`[Events] Socket.IO not available for event: ${event}`);
    }
  }

  /**
   * Emit event to reviewer room
   */
  private emitToReviewer(event: string, payload: any) {
    const io = this.getIO();
    if (io) {
      io.to(ROOMS.REVIEWER).emit(event, payload);
      console.log(`[Events] Emitted ${event} to reviewer room:`, payload);
    } else {
      console.warn(`[Events] Socket.IO not available for event: ${event}`);
    }
  }

  /**
   * Emit event to approver room
   */
  private emitToApprover(event: string, payload: any) {
    const io = this.getIO();
    if (io) {
      io.to(ROOMS.APPROVER).emit(event, payload);
      console.log(`[Events] Emitted ${event} to approver room:`, payload);
    } else {
      console.warn(`[Events] Socket.IO not available for event: ${event}`);
    }
  }

  /**
   * Emit event to specific vendor room
   */
  private emitToVendor(vendorId: string, event: string, payload: any) {
    const io = this.getIO();
    if (io) {
      io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);
      console.log(`[Events] Emitted ${event} to vendor ${vendorId}:`, payload);
    } else {
      console.warn(`[Events] Socket.IO not available for event: ${event}`);
    }
  }

  /**
   * Emit new submission event to admin
   */
  adminNewSubmission(payload: AdminNewSubmissionEvent) {
    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);
  }

  /**
   * Emit new vendor registration to admin
   */
  adminNewVendor(payload: AdminNewVendorEvent) {
    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);
  }

  /**
   * Emit submission status change to specific vendor
   */
  vendorSubmissionStatusChanged(vendorId: string, payload: VendorSubmissionStatusChangedEvent) {
    this.emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);
  }

  /**
   * Emit new notification
   */
  notificationNew(payload: NotificationNewEvent) {
    if (payload.scope === 'admin') {
      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);
    } else if (payload.scope === 'reviewer') {
      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);
    } else if (payload.scope === 'approver') {
      this.emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);
    } else if (payload.scope === 'vendor' && payload.vendorId) {
      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);
    }
  }

  /**
   * Emit unread notification count update
   */
  notificationUnreadCount(payload: NotificationUnreadCountEvent) {
    if (payload.scope === 'admin') {
      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
    } else if (payload.scope === 'reviewer') {
      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
    } else if (payload.scope === 'approver') {
      this.emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
    } else if (payload.scope === 'vendor' && payload.vendorId) {
      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
    }
  }

  /**
   * Emit stats update
   */
  statsUpdate(payload: StatsUpdateEvent) {
    if (payload.scope === 'admin') {
      this.emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);
    } else if (payload.scope === 'reviewer') {
      this.emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);
    } else if (payload.scope === 'approver') {
      this.emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);
    } else if (payload.scope === 'vendor' && payload.vendorId) {
      this.emitToVendor(payload.vendorId, EVENT_NAMES.STATS_UPDATE, payload);
    }
  }

  /**
   * Emit notification removal (broadcast to all clients)
   */
  notificationRemoved(payload: { submissionId: string; timestamp: string }) {
    this.broadcast(EVENT_NAMES.NOTIFICATION_REMOVED, payload);
  }

  /**
   * Emit submission reviewed event to approvers
   */
  submissionReviewed(payload: { submissionId: string; reviewStatus: string; reviewedBy: string; reviewedAt: string }) {
    this.emitToApprover('submission:reviewed', payload);
  }

  /**
   * Emit submission created event to reviewers
   */
  submissionCreated(payload: { submissionId: string; vendorName: string; officerName: string; createdAt: string }) {
    this.emitToReviewer('submission:created', payload);
  }

  /**
   * Emit submission finalized event to vendor
   */
  submissionFinalized(vendorId: string, payload: { submissionId: string; finalStatus: string; finalizedBy: string; finalizedAt: string }) {
    this.emitToVendor(vendorId, 'submission:finalized', payload);
  }

  /**
   * Emit user verification needed event to reviewers
   */
  userVerificationNeeded(payload: { userId: string; vendorName: string; officerName: string; email: string; createdAt: string }) {
    this.emitToReviewer('user:verification-needed', payload);
  }

  /**
   * Emit user verification result event to specific vendor
   */
  userVerificationResult(vendorId: string, payload: { userId: string; status: string; verifiedAt: string; note: string }) {
    this.emitToVendor(vendorId, 'user:verification-result', payload);
  }

  /**
   * Emit to all connected clients (use sparingly)
   */
  broadcast(event: string, payload: any) {
    const io = this.getIO();
    if (io) {
      io.emit(event, payload);
      console.log(`[Events] Broadcasted ${event}:`, payload);
    } else {
      console.warn(`[Events] Socket.IO not available for broadcast: ${event}`);
    }
  }
}

// Export singleton instance
export const eventsPublisher = new EventsPublisher();


=== FILE: src/server/notificationsPublisher.ts ===
/**
 * Real-time Notifications Publisher using Redis
 * Publishes notifications to Redis channels for Server-Sent Events
 */

import { redisPub } from '@/lib/singletons';
import type { NotificationNewEvent, NotificationUnreadCountEvent } from '@/shared/events';

export class NotificationsPublisher {
  /**
   * Publish new notification to real-time subscribers
   */
  async publishNotification(notification: NotificationNewEvent) {
    try {
      let channelName: string;
      
      switch (notification.scope) {
        case 'admin':
          channelName = 'notifications:admin';
          break;
        case 'reviewer':
          channelName = 'notifications:reviewer';
          break;
        case 'approver':
          channelName = 'notifications:approver';
          break;
        case 'vendor':
          channelName = `notifications:vendor:${notification.vendorId}`;
          break;
        default:
          throw new Error(`Unknown notification scope: ${notification.scope}`);
      }
      
      const message = JSON.stringify({
        type: 'notification:new',
        data: notification
      });

      await redisPub.publish(channelName, message);
      console.log(`📡 Published notification to ${channelName}:`, notification.title);
    } catch (error) {
      console.error('❌ Error publishing notification:', error);
    }
  }

  /**
   * Publish unread count update to real-time subscribers
   */
  async publishUnreadCount(update: NotificationUnreadCountEvent) {
    try {
      let channelName: string;
      
      switch (update.scope) {
        case 'admin':
          channelName = 'notifications:admin';
          break;
        case 'reviewer':
          channelName = 'notifications:reviewer';
          break;
        case 'approver':
          channelName = 'notifications:approver';
          break;
        case 'vendor':
          channelName = `notifications:vendor:${update.vendorId}`;
          break;
        default:
          throw new Error(`Unknown notification scope: ${update.scope}`);
      }
      
      const message = JSON.stringify({
        type: 'notification:unread_count',
        data: update
      });

      await redisPub.publish(channelName, message);
      console.log(`📊 Published unread count to ${channelName}:`, update.unreadCount);
    } catch (error) {
      console.error('❌ Error publishing unread count:', error);
    }
  }

  /**
   * Publish stats update to real-time subscribers
   */
  async publishStatsUpdate(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, changes: Record<string, any>) {
    try {
      let channelName: string;
      
      switch (scope) {
        case 'admin':
          channelName = 'notifications:admin';
          break;
        case 'reviewer':
          channelName = 'notifications:reviewer';
          break;
        case 'approver':
          channelName = 'notifications:approver';
          break;
        case 'vendor':
          channelName = `notifications:vendor:${vendorId}`;
          break;
        default:
          throw new Error(`Unknown stats scope: ${scope}`);
      }
      
      const message = JSON.stringify({
        type: 'stats:update',
        data: { scope, vendorId, changes }
      });

      await redisPub.publish(channelName, message);
      console.log(`📈 Published stats update to ${channelName}:`, changes);
    } catch (error) {
      console.error('❌ Error publishing stats update:', error);
    }
  }

  /**
   * Publish notification removal to all subscribers
   */
  async publishNotificationRemoval(removal: { submissionId: string; timestamp: string }) {
    try {
      // Publish to both admin and vendor channels since notifications can affect both
      const channels = ['notifications:admin'];
      
      // Also publish to all vendor channels (we could make this more specific later)
      // For now, we'll just publish to admin and let clients handle filtering
      
      const message = JSON.stringify({
        type: 'notification:removed',
        data: removal
      });

      for (const channelName of channels) {
        await redisPub.publish(channelName, message);
      }
      
      // Also publish to a general notification channel that all clients can subscribe to
      await redisPub.publish('notifications:all', message);
      
      console.log(`🗑️ Published notification removal for submission ${removal.submissionId}`);
    } catch (error) {
      console.error('❌ Error publishing notification removal:', error);
    }
  }
}

// Export singleton instance
export const notificationsPublisher = new NotificationsPublisher();


=== FILE: src/server/socket.ts ===
import { Server } from 'socket.io';
import { createAdapter } from '@socket.io/redis-adapter';
import { pubClient, subClient } from '../lib/redis';
import { EVENT_NAMES, ROOMS } from '../shared/events';
import type { 
  AdminNewSubmissionEvent,
  AdminNewVendorEvent,
  VendorSubmissionStatusChangedEvent,
  NotificationNewEvent,
  NotificationUnreadCountEvent,
  StatsUpdateEvent
} from '../shared/events';

declare global {
  var __socket_io: Server | undefined;
}

let io: Server;

// Use global Socket.IO instance from custom server or create new one
if (typeof globalThis !== 'undefined' && (globalThis as any).__socket_io) {
  io = (globalThis as any).__socket_io;
} else {
  // Fallback for development or API routes
  if (process.env.NODE_ENV === 'production') {
    io = new Server({
      cors: {
        origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',
        methods: ['GET', 'POST'],
      },
    });
  } else {
    if (!globalThis.__socket_io) {
      globalThis.__socket_io = new Server({
        cors: {
          origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',
          methods: ['GET', 'POST'],
        },
      });
    }
    io = globalThis.__socket_io;
  }

  // Set up Redis adapter only if not already set
  if (!io.adapter || io.adapter.constructor.name === 'Adapter') {
    try {
      io.adapter(createAdapter(pubClient, subClient));
      console.log('Redis adapter attached to Socket.IO');
    } catch (error) {
      console.error('Failed to attach Redis adapter:', error);
    }
  }
}

// Connection handler
io.on('connection', (socket) => {
  console.log('Client connected:', socket.id);

  // Join rooms based on user role and vendor ID
  socket.on('join', (data: { role: string; vendorId?: string }) => {
    try {
      const { role, vendorId } = data;
      
      if (role === 'ADMIN') {
        socket.join(ROOMS.ADMIN);
        console.log(`Socket ${socket.id} joined admin room`);
      } else if (role === 'REVIEWER') {
        socket.join(ROOMS.REVIEWER);
        console.log(`Socket ${socket.id} joined reviewer room`);
      } else if (role === 'APPROVER') {
        socket.join(ROOMS.APPROVER);
        console.log(`Socket ${socket.id} joined approver room`);
      } else if (role === 'VENDOR' && vendorId) {
        socket.join(ROOMS.VENDOR(vendorId));
        console.log(`Socket ${socket.id} joined vendor room: ${vendorId}`);
      }
    } catch (error) {
      console.error('Error joining room:', error);
    }
  });

  socket.on('disconnect', () => {
    console.log('Client disconnected:', socket.id);
  });
});

// Helper functions for emitting events
export const emitToAdmin = (event: string, payload: any) => {
  io.to(ROOMS.ADMIN).emit(event, payload);
};

export const emitToReviewer = (event: string, payload: any) => {
  io.to(ROOMS.REVIEWER).emit(event, payload);
};

export const emitToApprover = (event: string, payload: any) => {
  io.to(ROOMS.APPROVER).emit(event, payload);
};

export const emitToVendor = (vendorId: string, event: string, payload: any) => {
  io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);
};

export const emitBroadcast = (event: string, payload: any) => {
  io.emit(event, payload);
};

// Typed emit functions
export const emitAdminNewSubmission = (payload: AdminNewSubmissionEvent) => {
  emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);
};

export const emitAdminNewVendor = (payload: AdminNewVendorEvent) => {
  emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);
};

export const emitVendorSubmissionStatusChanged = (vendorId: string, payload: VendorSubmissionStatusChangedEvent) => {
  emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);
};

export const emitNotificationNew = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationNewEvent) => {
  if (scope === 'admin') {
    emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);
  } else if (scope === 'reviewer') {
    emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);
  } else if (scope === 'approver') {
    emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);
  } else if (scope === 'vendor' && vendorId) {
    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);
  }
};

export const emitNotificationUnreadCount = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationUnreadCountEvent) => {
  if (scope === 'admin') {
    emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
  } else if (scope === 'reviewer') {
    emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
  } else if (scope === 'approver') {
    emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
  } else if (scope === 'vendor' && vendorId) {
    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);
  }
};

export const emitStatsUpdate = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: StatsUpdateEvent) => {
  if (scope === 'admin') {
    emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);
  } else if (scope === 'reviewer') {
    emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);
  } else if (scope === 'approver') {
    emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);
  } else if (scope === 'vendor' && vendorId) {
    emitToVendor(vendorId, EVENT_NAMES.STATS_UPDATE, payload);
  }
};

export { io };


=== FILE: src/services/FileCompressionService.ts ===
/**
 * File Compression Service
 * Handles file compression with configurable quality and size limits
 */

import sharp from 'sharp';
import { writeFile, readFile } from 'fs/promises';

interface CompressionOptions {
  maxSizeBytes: number;
  quality: number;
  format?: 'jpeg' | 'png' | 'webp';
  maxWidth?: number;
  maxHeight?: number;
  outputDir?: string;
}

interface CompressionResult {
  success: boolean;
  originalSize: number;
  compressedSize: number;
  compressionRatio: number;
  filePath: string;
  outputPath?: string;
  error?: string;
}

export class FileCompressionService {
  private static readonly DEFAULT_QUALITY = 60;
  private static readonly DEFAULT_MAX_SIZE = 2 * 1024 * 1024; // 2MB
  private static readonly DEFAULT_MAX_WIDTH = 2048;
  private static readonly DEFAULT_MAX_HEIGHT = 2048;

  /**
   * Compress an image file with specified options
   */
  static async compressImage(
    inputPath: string,
    options: Partial<CompressionOptions> = {}
  ): Promise<CompressionResult> {
    const config: CompressionOptions = {
      maxSizeBytes: options.maxSizeBytes || this.DEFAULT_MAX_SIZE,
      quality: options.quality || this.DEFAULT_QUALITY,
      format: options.format || 'jpeg',
      maxWidth: options.maxWidth || this.DEFAULT_MAX_WIDTH,
      maxHeight: options.maxHeight || this.DEFAULT_MAX_HEIGHT,
      outputDir: options.outputDir || '',
    };

    try {
      // Read original file
      const originalBuffer = await readFile(inputPath);
      const originalSize = originalBuffer.length;

      // If already within size limits, return as is
      if (originalSize <= config.maxSizeBytes) {
        return {
          success: true,
          originalSize,
          compressedSize: originalSize,
          compressionRatio: 1.0,
          filePath: inputPath,
          outputPath: inputPath,
        };
      }

      // Get metadata
      const metadata = await sharp(originalBuffer).metadata();
      
      // Determine output format
      const outputFormat = config.format || this.getOutputFormat(metadata.format);
      
      // Calculate resize dimensions if needed
      const { width, height } = this.calculateDimensions(
        metadata.width || 0,
        metadata.height || 0,
        config.maxWidth!,
        config.maxHeight!
      );

      // Start with initial quality
      let currentQuality = config.quality;
      let compressedBuffer: Buffer;
      let iterations = 0;
      const maxIterations = 5;

      do {
        // Apply compression
        let sharpInstance = sharp(originalBuffer)
          .resize(width, height, { 
            fit: 'inside',
            withoutEnlargement: true 
          });

        // Apply format-specific compression
        switch (outputFormat) {
          case 'jpeg':
            sharpInstance = sharpInstance.jpeg({ 
              quality: currentQuality,
              progressive: true,
              mozjpeg: true
            });
            break;
          case 'png':
            sharpInstance = sharpInstance.png({ 
              quality: currentQuality,
              compressionLevel: 9,
              progressive: true
            });
            break;
          case 'webp':
            sharpInstance = sharpInstance.webp({ 
              quality: currentQuality,
              effort: 6
            });
            break;
        }

        compressedBuffer = await sharpInstance.toBuffer();

        // Check if size is acceptable
        if (compressedBuffer.length <= config.maxSizeBytes || currentQuality <= 20) {
          break;
        }

        // Reduce quality for next iteration
        currentQuality = Math.max(20, currentQuality - 10);
        iterations++;

      } while (iterations < maxIterations);

      // Generate output path
      const outputPath = this.generateOutputPath(inputPath, outputFormat, config.outputDir);

      // Save compressed file
      await writeFile(outputPath, compressedBuffer);

      const compressionRatio = compressedBuffer.length / originalSize;

      console.log(`✅ Image compressed: ${this.formatFileSize(originalSize)} -> ${this.formatFileSize(compressedBuffer.length)} (${Math.round((1 - compressionRatio) * 100)}% reduction)`);

      return {
        success: true,
        originalSize,
        compressedSize: compressedBuffer.length,
        compressionRatio,
        filePath: inputPath,
        outputPath,
      };

    } catch (error) {
      console.error('Compression error:', error);
      return {
        success: false,
        originalSize: 0,
        compressedSize: 0,
        compressionRatio: 0,
        filePath: inputPath,
        error: error instanceof Error ? error.message : 'Unknown compression error',
      };
    }
  }

  /**
   * Compress a PDF file (placeholder - requires pdf-lib or similar)
   */
  static async compressPDF(
    inputPath: string,
    options: Partial<CompressionOptions> = {}
  ): Promise<CompressionResult> {
    try {
      const originalBuffer = await readFile(inputPath);
      const originalSize = originalBuffer.length;

      // For now, just return the original if within limits
      if (originalSize <= (options.maxSizeBytes || this.DEFAULT_MAX_SIZE)) {
        return {
          success: true,
          originalSize,
          compressedSize: originalSize,
          compressionRatio: 1.0,
          filePath: inputPath,
          outputPath: inputPath,
        };
      }

      // PDF compression would require additional libraries
      console.warn('PDF compression not implemented yet');
      return {
        success: false,
        originalSize,
        compressedSize: originalSize,
        compressionRatio: 1.0,
        filePath: inputPath,
        error: 'PDF compression not implemented',
      };

    } catch (error) {
      return {
        success: false,
        originalSize: 0,
        compressedSize: 0,
        compressionRatio: 0,
        filePath: inputPath,
        error: error instanceof Error ? error.message : 'PDF compression failed',
      };
    }
  }

  /**
   * Check if file type can be compressed
   */
  static canCompress(mimeType: string): boolean {
    const compressibleTypes = [
      'image/jpeg',
      'image/jpg', 
      'image/png',
      'image/webp',
      'application/pdf'
    ];
    return compressibleTypes.includes(mimeType);
  }

  /**
   * Generic file compression method
   */
  static async compressFile(
    inputPath: string,
    options: Partial<CompressionOptions> = {}
  ): Promise<CompressionResult> {
    // Detect file type from extension
    const ext = inputPath.toLowerCase().split('.').pop();
    
    if (['jpg', 'jpeg', 'png', 'webp'].includes(ext || '')) {
      return this.compressImage(inputPath, options);
    } else if (ext === 'pdf') {
      return this.compressPDF(inputPath, options);
    } else {
      return {
        success: false,
        originalSize: 0,
        compressedSize: 0,
        compressionRatio: 0,
        filePath: inputPath,
        error: `Unsupported file type: ${ext}`,
      };
    }
  }

  /**
   * Calculate optimal dimensions while maintaining aspect ratio
   */
  private static calculateDimensions(
    originalWidth: number,
    originalHeight: number,
    maxWidth: number,
    maxHeight: number
  ): { width: number; height: number } {
    if (originalWidth <= maxWidth && originalHeight <= maxHeight) {
      return { width: originalWidth, height: originalHeight };
    }

    const widthRatio = maxWidth / originalWidth;
    const heightRatio = maxHeight / originalHeight;
    const ratio = Math.min(widthRatio, heightRatio);

    return {
      width: Math.round(originalWidth * ratio),
      height: Math.round(originalHeight * ratio),
    };
  }

  /**
   * Get appropriate output format based on input
   */
  private static getOutputFormat(inputFormat?: string): 'jpeg' | 'png' | 'webp' {
    switch (inputFormat?.toLowerCase()) {
      case 'png':
        return 'png';
      case 'webp':
        return 'webp';
      default:
        return 'jpeg';
    }
  }

  /**
   * Generate output file path
   */
  private static generateOutputPath(
    inputPath: string,
    format: string,
    outputDir?: string
  ): string {
    const pathParts = inputPath.split('/');
    const fileName = pathParts.pop() || 'compressed';
    const nameWithoutExt = fileName.split('.')[0];
    const timestamp = Date.now();
    
    const outputFileName = `${nameWithoutExt}_compressed_${timestamp}.${format}`;
    
    if (outputDir) {
      return `${outputDir}/${outputFileName}`;
    }
    
    pathParts.push(outputFileName);
    return pathParts.join('/');
  }

  /**
   * Format file size for human display
   */
  static formatFileSize(bytes: number): string {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
}

=== FILE: src/services/FileValidationService.ts ===
/**
 * File Validation Service
 * Comprehensive file type validation with security checks
 */

import { readFile } from 'fs/promises';

interface FileValidationResult {
  isValid: boolean;
  mimeType: string;
  actualExtension: string;
  size: number;
  error?: string;
  securityChecks: {
    hasValidSignature: boolean;
    isSafeExtension: boolean;
    hasNoMaliciousContent: boolean;
  };
}

interface ValidationOptions {
  allowedTypes: string[];
  allowedExtensions: string[];
  maxSize: number;
  checkMagicBytes: boolean;
  scanForMalware: boolean;
}

export class FileValidationService {
  // File signatures (magic bytes) for validation
  private static readonly FILE_SIGNATURES = {
    'image/jpeg': [
      [0xFF, 0xD8, 0xFF],
    ],
    'image/png': [
      [0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A],
    ],
    'application/pdf': [
      [0x25, 0x50, 0x44, 0x46], // %PDF
    ],
    'application/msword': [
      [0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1], // .doc
    ],
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': [
      [0x50, 0x4B, 0x03, 0x04], // .docx (ZIP-based)
      [0x50, 0x4B, 0x05, 0x06], // .docx (empty ZIP)
      [0x50, 0x4B, 0x07, 0x08], // .docx (spanned ZIP)
    ],
  };

  // Allowed file types for SIMLOK system
  private static readonly DEFAULT_ALLOWED_TYPES = [
    'image/jpeg',
    'image/jpg', 
    'image/png',
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  ];

  private static readonly DEFAULT_ALLOWED_EXTENSIONS = [
    '.jpg',
    '.jpeg',
    '.png', 
    '.pdf',
    '.doc',
    '.docx',
  ];

  // Dangerous file extensions that should never be allowed
  private static readonly DANGEROUS_EXTENSIONS = [
    '.exe', '.bat', '.cmd', '.com', '.pif', '.scr', '.vbs', '.js',
    '.jar', '.app', '.deb', '.pkg', '.dmg', '.rpm', '.msi',
    '.sh', '.bash', '.zsh', '.fish', '.ps1', '.psm1',
  ];

  // Malicious patterns to check for
  private static readonly MALICIOUS_PATTERNS = [
    /javascript:/gi,
    /vbscript:/gi,
    /onload=/gi,
    /onerror=/gi,
    /<script[^>]*>/gi,
    /<iframe[^>]*>/gi,
    /eval\(/gi,
    /document\.write/gi,
  ];

  /**
   * Comprehensive file validation
   */
  static async validateFile(
    filePath: string,
    originalName: string,
    options: Partial<ValidationOptions> = {}
  ): Promise<FileValidationResult> {
    const config: ValidationOptions = {
      allowedTypes: options.allowedTypes || this.DEFAULT_ALLOWED_TYPES,
      allowedExtensions: options.allowedExtensions || this.DEFAULT_ALLOWED_EXTENSIONS,
      maxSize: options.maxSize || 10 * 1024 * 1024, // 10MB default
      checkMagicBytes: options.checkMagicBytes ?? true,
      scanForMalware: options.scanForMalware ?? true,
    };

    try {
      const fileBuffer = await readFile(filePath);
      const fileSize = fileBuffer.length;
      
      // Extract extension from original filename
      const extension = this.getFileExtension(originalName);
      
      // Basic size validation
      if (fileSize > config.maxSize) {
        return {
          isValid: false,
          mimeType: '',
          actualExtension: extension,
          size: fileSize,
          error: `File size ${this.formatFileSize(fileSize)} exceeds maximum allowed size ${this.formatFileSize(config.maxSize)}`,
          securityChecks: {
            hasValidSignature: false,
            isSafeExtension: false,
            hasNoMaliciousContent: false,
          },
        };
      }

      // Check for dangerous extensions
      if (this.DANGEROUS_EXTENSIONS.includes(extension.toLowerCase())) {
        return {
          isValid: false,
          mimeType: '',
          actualExtension: extension,
          size: fileSize,
          error: `File extension '${extension}' is not allowed for security reasons`,
          securityChecks: {
            hasValidSignature: false,
            isSafeExtension: false,
            hasNoMaliciousContent: false,
          },
        };
      }

      // Extension validation
      const isSafeExtension = config.allowedExtensions.includes(extension.toLowerCase());
      if (!isSafeExtension) {
        return {
          isValid: false,
          mimeType: '',
          actualExtension: extension,
          size: fileSize,
          error: `File extension '${extension}' is not allowed. Allowed extensions: ${config.allowedExtensions.join(', ')}`,
          securityChecks: {
            hasValidSignature: false,
            isSafeExtension: false,
            hasNoMaliciousContent: false,
          },
        };
      }

      // Detect actual MIME type from file signature
      const actualMimeType = this.detectMimeType(fileBuffer);
      
      // Magic bytes validation
      let hasValidSignature = true;
      if (config.checkMagicBytes && actualMimeType) {
        hasValidSignature = this.validateFileSignature(fileBuffer, actualMimeType);
        if (!hasValidSignature) {
          return {
            isValid: false,
            mimeType: actualMimeType,
            actualExtension: extension,
            size: fileSize,
            error: 'File signature does not match file extension (possible file tampering)',
            securityChecks: {
              hasValidSignature: false,
              isSafeExtension: isSafeExtension,
              hasNoMaliciousContent: false,
            },
          };
        }
      }

      // MIME type validation
      const mimeType = actualMimeType || this.getMimeTypeFromExtension(extension);
      if (!config.allowedTypes.includes(mimeType)) {
        return {
          isValid: false,
          mimeType,
          actualExtension: extension,
          size: fileSize,
          error: `File type '${mimeType}' is not allowed. Allowed types: ${config.allowedTypes.join(', ')}`,
          securityChecks: {
            hasValidSignature,
            isSafeExtension,
            hasNoMaliciousContent: false,
          },
        };
      }

      // Malware/malicious content scan
      let hasNoMaliciousContent = true;
      if (config.scanForMalware) {
        hasNoMaliciousContent = this.scanForMaliciousContent(fileBuffer);
        if (!hasNoMaliciousContent) {
          return {
            isValid: false,
            mimeType,
            actualExtension: extension,
            size: fileSize,
            error: 'File contains potentially malicious content',
            securityChecks: {
              hasValidSignature,
              isSafeExtension,
              hasNoMaliciousContent: false,
            },
          };
        }
      }

      return {
        isValid: true,
        mimeType,
        actualExtension: extension,
        size: fileSize,
        securityChecks: {
          hasValidSignature,
          isSafeExtension,
          hasNoMaliciousContent,
        },
      };

    } catch (error) {
      return {
        isValid: false,
        mimeType: '',
        actualExtension: '',
        size: 0,
        error: error instanceof Error ? error.message : 'File validation failed',
        securityChecks: {
          hasValidSignature: false,
          isSafeExtension: false,
          hasNoMaliciousContent: false,
        },
      };
    }
  }

  /**
   * Detect MIME type from file signature (magic bytes)
   */
  private static detectMimeType(buffer: Buffer): string {
    for (const [mimeType, signatures] of Object.entries(this.FILE_SIGNATURES)) {
      for (const signature of signatures) {
        if (this.checkSignature(buffer, signature)) {
          return mimeType;
        }
      }
    }
    return '';
  }

  /**
   * Check if buffer starts with given signature
   */
  private static checkSignature(buffer: Buffer, signature: number[]): boolean {
    if (buffer.length < signature.length) return false;
    
    for (let i = 0; i < signature.length; i++) {
      if (buffer[i] !== signature[i]) return false;
    }
    return true;
  }

  /**
   * Validate file signature against expected MIME type
   */
  private static validateFileSignature(buffer: Buffer, mimeType: string): boolean {
    const signatures = this.FILE_SIGNATURES[mimeType as keyof typeof this.FILE_SIGNATURES];
    if (!signatures) return true; // Allow if no signature defined
    
    return signatures.some(signature => this.checkSignature(buffer, signature));
  }

  /**
   * Get file extension from filename
   */
  private static getFileExtension(filename: string): string {
    const lastDot = filename.lastIndexOf('.');
    return lastDot !== -1 ? filename.substring(lastDot).toLowerCase() : '';
  }

  /**
   * Get MIME type from file extension
   */
  private static getMimeTypeFromExtension(extension: string): string {
    const mimeMap: Record<string, string> = {
      '.jpg': 'image/jpeg',
      '.jpeg': 'image/jpeg',
      '.png': 'image/png',
      '.pdf': 'application/pdf',
      '.doc': 'application/msword',
      '.docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    };
    
    return mimeMap[extension.toLowerCase()] || 'application/octet-stream';
  }

  /**
   * Scan for malicious content patterns
   */
  private static scanForMaliciousContent(buffer: Buffer): boolean {
    const content = buffer.toString('utf8', 0, Math.min(buffer.length, 8192)); // Check first 8KB
    
    return !this.MALICIOUS_PATTERNS.some(pattern => pattern.test(content));
  }

  /**
   * Format file size for display
   */
  private static formatFileSize(bytes: number): string {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  /**
   * Validate specific file types for SIMLOK categories
   */
  static validateSIMLOKFile(
    filePath: string,
    originalName: string,
    category: 'sika' | 'simja' | 'id_card' | 'other'
  ): Promise<FileValidationResult> {
    let allowedTypes: string[];
    let allowedExtensions: string[];

    switch (category) {
      case 'id_card':
        // ID Card should be images only
        allowedTypes = ['image/jpeg', 'image/png'];
        allowedExtensions = ['.jpg', '.jpeg', '.png'];
        break;
        
      case 'sika':
      case 'simja':
        // Documents can be images or PDFs
        allowedTypes = [
          'image/jpeg',
          'image/png', 
          'application/pdf',
          'application/msword',
          'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        ];
        allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'];
        break;
        
      default:
        allowedTypes = this.DEFAULT_ALLOWED_TYPES;
        allowedExtensions = this.DEFAULT_ALLOWED_EXTENSIONS;
    }

    return this.validateFile(filePath, originalName, {
      allowedTypes,
      allowedExtensions,
      maxSize: 10 * 1024 * 1024, // 10MB
      checkMagicBytes: true,
      scanForMalware: true,
    });
  }
}

=== FILE: src/shared/dto.ts ===
/**
 * Shared DTOs and validation schemas for API routes
 */

import { z } from 'zod';

// Common response schemas
export const ApiErrorSchema = z.object({
  error: z.string(),
  message: z.string(),
  code: z.string().optional(),
});

export const ApiSuccessSchema = z.object({
  success: z.boolean(),
  data: z.any().optional(),
  message: z.string().optional(),
});

// Pagination schemas
export const PaginationQuerySchema = z.object({
  cursor: z.string().optional().nullable(),
  limit: z.coerce.number().int().positive().max(100).default(10),
});

export const PaginatedResponseSchema = z.object({
  data: z.array(z.any()),
  pagination: z.object({
    nextCursor: z.string().nullable(),
    hasMore: z.boolean(),
    total: z.number().optional(),
  }),
});

// Notification schemas
export const NotificationsQuerySchema = z.object({
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional().nullable(),
}).merge(PaginationQuerySchema);

export const NotificationSchema = z.object({
  id: z.string(),
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().nullable(),
  type: z.string(),
  title: z.string(),
  message: z.string(),
  data: z.string().nullable(),
  createdAt: z.string(),
  isRead: z.boolean(),
});

export const MarkAsReadSchema = z.object({
  notificationId: z.string(),
});

export const MarkAllAsReadSchema = z.object({
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional().nullable(),
});

// Submission schemas
export const SubmissionStatusSchema = z.enum(['PENDING', 'APPROVED', 'REJECTED']);

export const CreateSubmissionSchema = z.object({
  vendor_name: z.string().min(1),
  based_on: z.string().min(1),
  officer_name: z.string().min(1),
  job_description: z.string().min(1),
  work_location: z.string().min(1),
  implementation: z.string().optional(),
  working_hours: z.string().min(1),
  other_notes: z.string().optional(),
  work_facilities: z.string().min(1),
  worker_names: z.string().min(1),
  content: z.string().optional(),
  notes: z.string().optional(),
  signer_position: z.string().optional(),
  signer_name: z.string().optional(),
});

export const UpdateSubmissionStatusSchema = z.object({
  status: SubmissionStatusSchema,
  notes: z.string().optional(),
});

// User/Vendor schemas
export const CreateVendorSchema = z.object({
  officer_name: z.string().min(1),
  email: z.string().email(),
  password: z.string().min(6),
  vendor_name: z.string().min(1),
  address: z.string().optional(),
  phone_number: z.string().optional(),
});

export const UpdateVendorStatusSchema = z.object({
  verified: z.boolean(),
});

// Stats schemas
export const StatsQuerySchema = z.object({
  scope: z.enum(['admin', 'vendor']),
  vendorId: z.string().optional().nullable(),
  range: z.enum(['day', 'week', 'month', 'year']).default('month'),
});

// Type exports
export type ApiError = z.infer<typeof ApiErrorSchema>;
export type ApiSuccess = z.infer<typeof ApiSuccessSchema>;
export type PaginationQuery = z.infer<typeof PaginationQuerySchema>;
export type PaginatedResponse = z.infer<typeof PaginatedResponseSchema>;
export type NotificationsQuery = z.infer<typeof NotificationsQuerySchema>;
export type NotificationDto = z.infer<typeof NotificationSchema>;
export type CreateSubmissionDto = z.infer<typeof CreateSubmissionSchema>;
export type UpdateSubmissionStatusDto = z.infer<typeof UpdateSubmissionStatusSchema>;
export type CreateVendorDto = z.infer<typeof CreateVendorSchema>;
export type StatsQuery = z.infer<typeof StatsQuerySchema>;


=== FILE: src/shared/events.ts ===
import { z } from 'zod';

// Event schemas
export const AdminNewSubmissionEvent = z.object({
  submissionId: z.string(),
  createdAt: z.string(),
});

export const AdminNewVendorEvent = z.object({
  vendorId: z.string(),
  createdAt: z.string(),
});

export const VendorSubmissionStatusChangedEvent = z.object({
  submissionId: z.string(),
  status: z.enum(['PENDING', 'APPROVED', 'REJECTED']),
  updatedAt: z.string(),
});

export const NotificationNewEvent = z.object({
  id: z.string(),
  type: z.string(),
  title: z.string(),
  message: z.string(),
  data: z.string().nullable().optional(),
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional(),
  createdAt: z.string(),
});

export const NotificationUnreadCountEvent = z.object({
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional(),
  unreadCount: z.number(),
  count: z.number(), // Legacy field for backward compatibility
});

export const GetNotificationsSchema = z.object({
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional().nullable(),
  cursor: z.string().optional().nullable(),
  limit: z.number().int().positive().max(100).default(10).optional(),
});

export const StatsUpdateEvent = z.object({
  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),
  vendorId: z.string().optional(),
  changes: z.record(z.string(), z.union([z.number(), z.string()])),
});

export const NotificationRemovedEvent = z.object({
  submissionId: z.string(),
  timestamp: z.string(),
});

// Event types
export type AdminNewSubmissionEvent = z.infer<typeof AdminNewSubmissionEvent>;
export type AdminNewVendorEvent = z.infer<typeof AdminNewVendorEvent>;
export type VendorSubmissionStatusChangedEvent = z.infer<typeof VendorSubmissionStatusChangedEvent>;
export type NotificationNewEvent = z.infer<typeof NotificationNewEvent>;
export type NotificationUnreadCountEvent = z.infer<typeof NotificationUnreadCountEvent>;
export type StatsUpdateEvent = z.infer<typeof StatsUpdateEvent>;
export type NotificationRemovedEvent = z.infer<typeof NotificationRemovedEvent>;

// Event names
export const EVENT_NAMES = {
  ADMIN_NEW_SUBMISSION: 'admin:new_submission',
  ADMIN_NEW_VENDOR: 'admin:new_vendor',
  VENDOR_SUBMISSION_STATUS_CHANGED: 'vendor:submission_status_changed',
  NOTIFICATION_NEW: 'notification:new',
  NOTIFICATION_UNREAD_COUNT: 'notification:unread_count',
  NOTIFICATION_REMOVED: 'notification:removed',
  STATS_UPDATE: 'stats:update',
} as const;

// Room names
export const ROOM_MAPPING = {
  SUPER_ADMIN: 'admin',
  REVIEWER: 'reviewer',
  APPROVER: 'approver',
  VENDOR: 'vendor',
  VERIFIER: 'admin', // verifiers use admin room
} as const;

// Socket.IO room names
export const ROOMS = {
  ADMIN: 'admin',
  REVIEWER: 'reviewer', 
  APPROVER: 'approver',
  VENDOR: (vendorId: string) => `vendor:${vendorId}`,
} as const;


=== FILE: src/store/lists.ts ===
import { create } from 'zustand';

export interface SubmissionListItem {
  id: string;
  vendor_name: string;
  officer_name: string;
  job_description: string;
  approval_status: string;
  created_at: string;
  work_location: string;
}

export interface VendorListItem {
  id: string;
  vendor_name: string;
  officer_name: string;
  email: string;
  created_at: string;
  verified_at: string | null;
}

interface ListsState {
  submissions: SubmissionListItem[];
  vendors: VendorListItem[];
  submissionsLoading: boolean;
  vendorsLoading: boolean;
}

interface ListsActions {
  setSubmissions: (submissions: SubmissionListItem[]) => void;
  addSubmission: (submission: SubmissionListItem) => void;
  updateSubmission: (id: string, updates: Partial<SubmissionListItem>) => void;
  setVendors: (vendors: VendorListItem[]) => void;
  addVendor: (vendor: VendorListItem) => void;
  updateVendor: (id: string, updates: Partial<VendorListItem>) => void;
  setSubmissionsLoading: (loading: boolean) => void;
  setVendorsLoading: (loading: boolean) => void;
  reset: () => void;
}

export type ListsStore = ListsState & ListsActions;

const initialState: ListsState = {
  submissions: [],
  vendors: [],
  submissionsLoading: false,
  vendorsLoading: false,
};

export const useListsStore = create<ListsStore>((set) => ({
  ...initialState,

  setSubmissions: (submissions) => set({ submissions }),

  addSubmission: (submission) => set((state) => ({
    submissions: [submission, ...state.submissions],
  })),

  updateSubmission: (id, updates) => set((state) => ({
    submissions: state.submissions.map(item => 
      item.id === id ? { ...item, ...updates } : item
    ),
  })),

  setVendors: (vendors) => set({ vendors }),

  addVendor: (vendor) => set((state) => ({
    vendors: [vendor, ...state.vendors],
  })),

  updateVendor: (id, updates) => set((state) => ({
    vendors: state.vendors.map(item => 
      item.id === id ? { ...item, ...updates } : item
    ),
  })),

  setSubmissionsLoading: (loading) => set({ submissionsLoading: loading }),

  setVendorsLoading: (loading) => set({ vendorsLoading: loading }),

  reset: () => set(initialState),
}));


=== FILE: src/store/notifications.ts ===
import { create } from 'zustand';

export interface Notification {
  id: string;
  type: string;
  title: string;
  message: string;
  data?: any;
  createdAt: string;
  isRead: boolean;
}

interface NotificationsState {
  items: Notification[];
  unreadCount: number;
  loading: boolean;
  hasMore: boolean;
  cursor: string | null;
}

interface NotificationsActions {
  setItems: (items: Notification[]) => void;
  addItem: (item: Notification) => void;
  removeNotifications: (submissionId: string) => void;
  setUnreadCount: (count: number) => void;
  markAsRead: (id: string) => Promise<void>;
  markAllAsRead: (scope?: string, vendorId?: string) => Promise<void>;
  setLoading: (loading: boolean) => void;
  setHasMore: (hasMore: boolean) => void;
  setCursor: (cursor: string | null) => void;
  reset: () => void;
}

export type NotificationsStore = NotificationsState & NotificationsActions;

const initialState: NotificationsState = {
  items: [],
  unreadCount: 0,
  loading: false,
  hasMore: true,
  cursor: null,
};

export const useNotificationsStore = create<NotificationsStore>((set) => ({
  ...initialState,

  setItems: (items) => set({ items }),

  addItem: (item) => set((state) => ({
    items: [item, ...state.items],
    unreadCount: item.isRead ? state.unreadCount : state.unreadCount + 1,
  })),

  removeNotifications: (submissionId) => set((state) => {
    // Filter out notifications that reference the deleted submission
    const filteredItems = state.items.filter(item => {
      // Check if notification data contains the submission ID
      if (item.data) {
        try {
          const data = typeof item.data === 'string' ? JSON.parse(item.data) : item.data;
          if (data.submissionId === submissionId || data.submission_id === submissionId) {
            return false; // Remove this notification
          }
        } catch (e) {
          // If parsing fails, check message/title
        }
      }
      
      // Check message and title for submission ID
      const hasIdInMessage = item.message.includes(submissionId);
      const hasIdInTitle = item.title.includes(submissionId);
      
      return !hasIdInMessage && !hasIdInTitle; // Keep if ID not found
    });
    
    // Calculate how many unread notifications were removed
    const removedUnreadCount = state.items.filter(item => {
      if (item.isRead) return false; // Skip already read notifications
      
      // Check if this notification references the deleted submission
      if (item.data) {
        try {
          const data = typeof item.data === 'string' ? JSON.parse(item.data) : item.data;
          if (data.submissionId === submissionId || data.submission_id === submissionId) {
            return true; // This unread notification will be removed
          }
        } catch (e) {
          // If parsing fails, check message/title
        }
      }
      
      const hasIdInMessage = item.message.includes(submissionId);
      const hasIdInTitle = item.title.includes(submissionId);
      
      return hasIdInMessage || hasIdInTitle; // Count if ID found
    }).length;
    
    console.log(`Removing ${state.items.length - filteredItems.length} notifications for submission ${submissionId}`);
    console.log(`Reducing unread count by ${removedUnreadCount}`);
    
    return {
      items: filteredItems,
      unreadCount: Math.max(0, state.unreadCount - removedUnreadCount),
    };
  }),

  setUnreadCount: (count) => set({ unreadCount: count }),

  markAsRead: async (id) => {
    // Update local state optimistically
    set((state) => ({
      items: state.items.map(item => 
        item.id === id ? { ...item, isRead: true } : item
      ),
      unreadCount: Math.max(0, state.unreadCount - 1),
    }));

    // Make API call to update server
    try {
      const response = await fetch(`/api/v1/notifications/${id}/read`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (response.ok) {
        const result = await response.json();
        // Update unread count from server response
        if (result.data?.unreadCount !== undefined) {
          set({ unreadCount: result.data.unreadCount });
        }
        console.log('✅ Notification marked as read on server:', id);
      } else {
        console.error('❌ Failed to mark notification as read on server:', response.statusText);
        // Revert optimistic update on failure
        set((state) => ({
          items: state.items.map(item => 
            item.id === id ? { ...item, isRead: false } : item
          ),
          unreadCount: state.unreadCount + 1,
        }));
      }
    } catch (error) {
      console.error('💥 Error marking notification as read:', error);
      // Revert optimistic update on error
      set((state) => ({
        items: state.items.map(item => 
          item.id === id ? { ...item, isRead: false } : item
        ),
        unreadCount: state.unreadCount + 1,
      }));
    }
  },

  markAllAsRead: async (scope?: string, vendorId?: string) => {
    // Update local state optimistically
    set((state) => ({
      items: state.items.map(item => ({ ...item, isRead: true })),
      unreadCount: 0,
    }));

    // Make API call to update server
    try {
      const response = await fetch('/api/v1/notifications/read-all', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          scope,
          vendorId,
        }),
      });

      if (response.ok) {
        await response.json(); // Consume response
        console.log('✅ All notifications marked as read on server');
        // Ensure unread count is 0
        set({ unreadCount: 0 });
      } else {
        console.error('❌ Failed to mark all notifications as read on server:', response.statusText);
      }
    } catch (error) {
      console.error('💥 Error marking all notifications as read:', error);
    }
  },

  setLoading: (loading) => set({ loading }),

  setHasMore: (hasMore) => set({ hasMore }),

  setCursor: (cursor) => set({ cursor }),

  reset: () => set(initialState),
}));


=== FILE: src/store/stats.ts ===
import { create } from 'zustand';

interface StatsState {
  // Admin stats
  totalSubmissions: number;
  pendingSubmissions: number;
  approvedSubmissions: number;
  rejectedSubmissions: number;
  totalVendors: number;
  
  // Vendor stats
  vendorTotalSubmissions: number;
  vendorPendingSubmissions: number;
  vendorApprovedSubmissions: number;
  vendorRejectedSubmissions: number;
  
  loading: boolean;
}

interface StatsActions {
  updateStats: (changes: Record<string, number | string>) => void;
  setLoading: (loading: boolean) => void;
  reset: () => void;
}

export type StatsStore = StatsState & StatsActions;

const initialState: StatsState = {
  totalSubmissions: 0,
  pendingSubmissions: 0,
  approvedSubmissions: 0,
  rejectedSubmissions: 0,
  totalVendors: 0,
  vendorTotalSubmissions: 0,
  vendorPendingSubmissions: 0,
  vendorApprovedSubmissions: 0,
  vendorRejectedSubmissions: 0,
  loading: false,
};

export const useStatsStore = create<StatsStore>((set) => ({
  ...initialState,

  updateStats: (changes) => set((state) => {
    const newState = { ...state };
    
    Object.entries(changes).forEach(([key, value]) => {
      if (typeof value === 'number' && key in newState) {
        (newState as any)[key] = value;
      }
    });
    
    return newState;
  }),

  setLoading: (loading) => set({ loading }),

  reset: () => set(initialState),
}));


=== FILE: src/store/useStatsStore.ts ===
import { create } from 'zustand';

interface AdminStats {
  totalSubmissions: number;
  pendingSubmissions: number;
  approvedSubmissions: number;
  rejectedSubmissions: number;
  totalUsers: number;
  pendingUsers: number;
  totalVendors: number;
  totalVerifiers: number;
  pendingVerificationVendors: number;
  pendingVerificationSubmissions: number;
}

interface VendorStats {
  totalSubmissions: number;
  pendingSubmissions: number;
  approvedSubmissions: number;
  rejectedSubmissions: number;
  draftSubmissions: number;
  totalApproved: number;
  totalPending: number;
  totalRejected: number;
}

interface StatsStore {
  adminStats: AdminStats | null;
  vendorStats: VendorStats | null;
  loading: boolean;
  error: string | null;
  
  // Actions
  setAdminStats: (stats: AdminStats) => void;
  setVendorStats: (stats: VendorStats) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  fetchAdminStats: () => Promise<void>;
  fetchVendorStats: () => Promise<void>;
}

export const useStatsStore = create<StatsStore>((set) => ({
  adminStats: null,
  vendorStats: null,
  loading: false,
  error: null,

  setAdminStats: (stats) => set({ adminStats: stats }),
  setVendorStats: (stats) => set({ vendorStats: stats }),
  setLoading: (loading) => set({ loading }),
  setError: (error) => set({ error }),

  fetchAdminStats: async () => {
    try {
      set({ loading: true, error: null });
      const response = await fetch('/api/admin/dashboard/stats');
      if (!response.ok) {
        throw new Error('Failed to fetch admin stats');
      }
      const stats = await response.json();
      set({ adminStats: stats, loading: false });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch stats',
        loading: false 
      });
    }
  },

  fetchVendorStats: async () => {
    try {
      set({ loading: true, error: null });
      const response = await fetch('/api/vendor/dashboard/stats');
      if (!response.ok) {
        throw new Error('Failed to fetch vendor stats');
      }
      const stats = await response.json();
      set({ vendorStats: stats, loading: false });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch stats',
        loading: false 
      });
    }
  },
}));


=== FILE: src/store/useSubmissionStore.ts ===
import { create } from 'zustand';

interface Submission {
  id: string;
  title: string;
  status: string;
  vendor_id: string;
  created_at: string;
  updated_at: string;
  vendor?: {
    company_name: string;
  };
  [key: string]: any;
}

interface SubmissionStore {
  submissions: Submission[];
  loading: boolean;
  error: string | null;
  statistics: {
    total: number;
    pending: number;
    approved: number;
    rejected: number;
  } | null;
  allSubmissionsStats: {
    total: number;
    pending: number;
    approved: number;
    rejected: number;
  } | null;
  filteredTotal: number;
  
  // Search and filters
  searchTerm: string;
  sortField: string;
  sortOrder: string;
  currentPage: number;
  totalPages: number;
  
  // Actions
  setSubmissions: (submissions: Submission[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setSearchTerm: (term: string) => void;
  setSortField: (field: string) => void;
  setSortOrder: (order: string) => void;
  setCurrentPage: (page: number | ((prev: number) => number)) => void;
  setTotalPages: (pages: number) => void;
  setStatistics: (stats: any) => void;
  setAllSubmissionsStats: (stats: any) => void;
  
  // Fetch functions
  fetchSubmissions: (params?: any) => Promise<void>;
  fetchVendorSubmissions: (params?: any) => Promise<void>;
  fetchVendorStats: () => Promise<void>;
  fetchAdminStats: () => Promise<void>;
  fetchLatestSubmissions: () => Promise<void>;
  
  // CRUD operations
  updateSubmissionStatus: (id: string, status: string) => Promise<void>;
  deleteSubmission: (id: string) => Promise<void>;
}

export const useSubmissionStore = create<SubmissionStore>((set, get) => ({
  submissions: [],
  loading: false,
  error: null,
  statistics: null,
  allSubmissionsStats: null,
  filteredTotal: 0,
  
  searchTerm: '',
  sortField: 'created_at',
  sortOrder: 'desc',
  currentPage: 1,
  totalPages: 1,
  
  setSubmissions: (submissions) => set({ submissions }),
  setLoading: (loading) => set({ loading }),
  setError: (error) => set({ error }),
  setSearchTerm: (searchTerm) => set({ searchTerm }),
  setSortField: (sortField) => set({ sortField }),
  setSortOrder: (sortOrder) => set({ sortOrder }),
  setCurrentPage: (currentPage) => {
    if (typeof currentPage === 'function') {
      set((state) => ({ currentPage: currentPage(state.currentPage) }));
    } else {
      set({ currentPage });
    }
  },
  setTotalPages: (totalPages) => set({ totalPages }),
  setStatistics: (statistics) => set({ statistics }),
  setAllSubmissionsStats: (allSubmissionsStats) => set({ allSubmissionsStats }),
  
  fetchSubmissions: async (params = {}) => {
    try {
      set({ loading: true, error: null });
      
      const searchParams = new URLSearchParams({
        page: params.page?.toString() || '1',
        limit: params.limit?.toString() || '10',
        sortBy: params.sortBy || 'created_at',
        sortOrder: params.sortOrder || 'desc',
        ...(params.search && { search: params.search }),
        ...(params.status && { status: params.status }),
      });
      
      const response = await fetch(`/api/admin/submissions?${searchParams}`);
      if (!response.ok) {
        throw new Error('Failed to fetch submissions');
      }
      
      const data = await response.json();
      console.log('Admin submissions API response:', data); // Debug log
      set({ 
        submissions: data.submissions || [],
        totalPages: data.pagination?.pages || 1,
        filteredTotal: data.pagination?.total || 0,
        loading: false 
      });
    } catch (error) {
      console.error('Error fetching submissions:', error); // Debug log
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch submissions',
        loading: false 
      });
    }
  },

  fetchAdminStats: async () => {
    try {
      // Fetch statistics without any filters
      const response = await fetch('/api/admin/submissions/stats');
      if (!response.ok) {
        throw new Error('Failed to fetch admin stats');
      }
      
      const data = await response.json();
      set({ 
        allSubmissionsStats: data.statistics || null
      });
    } catch (error) {
      console.error('Error fetching admin stats:', error);
    }
  },
  
  fetchVendorSubmissions: async (params = {}) => {
    try {
      set({ loading: true, error: null });
      
      const searchParams = new URLSearchParams({
        page: params.page?.toString() || '1',
        limit: params.limit?.toString() || '10',
        sortBy: params.sortBy || 'created_at',
        sortOrder: params.sortOrder || 'desc',
        ...(params.search && { search: params.search }),
        ...(params.status && { status: params.status }),
      });
      
      const response = await fetch(`/api/vendor/submissions?${searchParams}`);
      if (!response.ok) {
        throw new Error('Failed to fetch vendor submissions');
      }
      
      const data = await response.json();
      set({ 
        submissions: data.submissions || [],
        totalPages: data.pagination?.pages || 1,
        filteredTotal: data.pagination?.total || 0,
        loading: false 
      });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch submissions',
        loading: false 
      });
    }
  },

  fetchVendorStats: async () => {
    try {
      // Fetch statistics without any filters
      const response = await fetch('/api/vendor/submissions/stats');
      if (!response.ok) {
        throw new Error('Failed to fetch vendor stats');
      }
      
      const data = await response.json();
      set({ 
        allSubmissionsStats: data.statistics || null
      });
    } catch (error) {
      console.error('Error fetching vendor stats:', error);
    }
  },
  
  fetchLatestSubmissions: async () => {
    try {
      set({ loading: true, error: null });
      
      const response = await fetch('/api/admin/dashboard/recent-submissions');
      if (!response.ok) {
        throw new Error('Failed to fetch latest submissions');
      }
      
      const data = await response.json();
      set({ 
        submissions: data.submissions || [],
        loading: false 
      });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch submissions',
        loading: false 
      });
    }
  },
  
  updateSubmissionStatus: async (id: string, status: string) => {
    try {
      const response = await fetch(`/api/submissions/${id}/status`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ status }),
      });
      
      if (!response.ok) {
        throw new Error('Failed to update submission status');
      }
      
      // Update local state
      const submissions = get().submissions.map(sub => 
        sub.id === id ? { ...sub, status } : sub
      );
      set({ submissions });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to update submission'
      });
      throw error;
    }
  },
  
  deleteSubmission: async (id: string) => {
    try {
      const response = await fetch(`/api/submissions/${id}`, {
        method: 'DELETE',
      });
      
      if (!response.ok) {
        throw new Error('Failed to delete submission');
      }
      
      // Remove from local state
      const submissions = get().submissions.filter(sub => sub.id !== id);
      set({ submissions });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to delete submission'
      });
      throw error;
    }
  },
}));


=== FILE: src/store/useUserStore.ts ===
import { create } from 'zustand';

interface User {
  id: string;
  email: string;
  name: string;
  role: string;
  company_name?: string;
  status: string;
  created_at: string;
  updated_at: string;
  [key: string]: any;
}

interface UserStore {
  users: User[];
  pendingUsers: User[];
  loading: boolean;
  error: string | null;
  
  // Search and filters
  searchTerm: string;
  roleFilter: string;
  statusFilter: string;
  currentPage: number;
  totalPages: number;
  
  // Actions
  setUsers: (users: User[]) => void;
  setPendingUsers: (users: User[]) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setSearchTerm: (term: string) => void;
  setRoleFilter: (role: string) => void;
  setStatusFilter: (status: string) => void;
  setCurrentPage: (page: number) => void;
  setTotalPages: (pages: number) => void;
  
  // Fetch functions
  fetchUsers: (params?: any) => Promise<void>;
  fetchPendingUsers: () => Promise<void>;
  
  // CRUD operations
  approveUser: (id: string) => Promise<void>;
  rejectUser: (id: string) => Promise<void>;
  updateUser: (id: string, data: Partial<User>) => Promise<void>;
  deleteUser: (id: string) => Promise<void>;
}

export const useUserStore = create<UserStore>((set, get) => ({
  users: [],
  pendingUsers: [],
  loading: false,
  error: null,
  
  searchTerm: '',
  roleFilter: '',
  statusFilter: '',
  currentPage: 1,
  totalPages: 1,
  
  setUsers: (users) => set({ users }),
  setPendingUsers: (pendingUsers) => set({ pendingUsers }),
  setLoading: (loading) => set({ loading }),
  setError: (error) => set({ error }),
  setSearchTerm: (searchTerm) => set({ searchTerm }),
  setRoleFilter: (roleFilter) => set({ roleFilter }),
  setStatusFilter: (statusFilter) => set({ statusFilter }),
  setCurrentPage: (currentPage) => set({ currentPage }),
  setTotalPages: (totalPages) => set({ totalPages }),
  
  fetchUsers: async (params = {}) => {
    try {
      set({ loading: true, error: null });
      
      const searchParams = new URLSearchParams({
        page: params.page?.toString() || '1',
        limit: params.limit?.toString() || '10',
        ...(params.search && { search: params.search }),
        ...(params.role && { role: params.role }),
        ...(params.status && { status: params.status }),
      });
      
      const response = await fetch(`/api/admin/users?${searchParams}`);
      if (!response.ok) {
        throw new Error('Failed to fetch users');
      }
      
      const data = await response.json();
      set({ 
        users: data.users || [],
        totalPages: data.pagination?.pages || 1,
        loading: false 
      });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch users',
        loading: false 
      });
    }
  },
  
  fetchPendingUsers: async () => {
    try {
      set({ loading: true, error: null });
      
      const response = await fetch('/api/admin/users/pending');
      if (!response.ok) {
        throw new Error('Failed to fetch pending users');
      }
      
      const data = await response.json();
      set({ 
        pendingUsers: data.users || [],
        loading: false 
      });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to fetch pending users',
        loading: false 
      });
    }
  },
  
  approveUser: async (id: string) => {
    try {
      const response = await fetch(`/api/admin/users/${id}/approve`, {
        method: 'POST',
      });
      
      if (!response.ok) {
        throw new Error('Failed to approve user');
      }
      
      // Remove from pending users
      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);
      set({ pendingUsers });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to approve user'
      });
      throw error;
    }
  },
  
  rejectUser: async (id: string) => {
    try {
      const response = await fetch(`/api/admin/users/${id}/reject`, {
        method: 'POST',
      });
      
      if (!response.ok) {
        throw new Error('Failed to reject user');
      }
      
      // Remove from pending users
      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);
      set({ pendingUsers });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to reject user'
      });
      throw error;
    }
  },
  
  updateUser: async (id: string, data: Partial<User>) => {
    try {
      const response = await fetch(`/api/admin/users/${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });
      
      if (!response.ok) {
        throw new Error('Failed to update user');
      }
      
      // Update local state
      const users = get().users.map(user => 
        user.id === id ? { ...user, ...data } : user
      );
      set({ users });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to update user'
      });
      throw error;
    }
  },
  
  deleteUser: async (id: string) => {
    try {
      const response = await fetch(`/api/admin/users/${id}`, {
        method: 'DELETE',
      });
      
      if (!response.ok) {
        throw new Error('Failed to delete user');
      }
      
      // Remove from local state
      const users = get().users.filter(user => user.id !== id);
      set({ users });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to delete user'
      });
      throw error;
    }
  },
}));


=== FILE: src/styles/auth.css ===
/* Auth Forms Custom Styles */

/* Enhanced mobile responsiveness */
@media (max-width: 1024px) {
  .auth-container {
    min-height: 100vh;
    padding: 1rem;
  }
  
  .auth-form {
    max-width: 100%;
    margin: 0;
    border-radius: 1rem;
  }
}

@media (max-width: 768px) {
  .auth-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .auth-input {
    height: 3rem;
    font-size: 1rem;
  }
  
  .auth-button {
    height: 3rem;
    font-size: 1rem;
  }
}

/* Simple transitions - no bounce */
.auth-input:focus {
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
}

.auth-button:hover:not(:disabled) {
  background-color: #1d4ed8;
}

/* Loading animation enhancement */
.spinner-border {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  vertical-align: text-bottom;
  border: 2px solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spinner 0.75s linear infinite;
}

@keyframes spinner {
  to {
    transform: rotate(360deg);
  }
}

/* Simple background - no animation */
.bg-pattern {
  background: transparent;
}

/* Form field enhancements */
.form-field-wrapper {
  position: relative;
  display: flex;
  flex-direction: column;
}

.form-field-wrapper label {
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
}

.form-field-wrapper input:focus + label,
.form-field-wrapper input:not(:placeholder-shown) + label {
  transform: translateY(-0.5rem);
  font-size: 0.875rem;
  color: #3B82F6;
}

/* Enhanced error styling */
.error-message {
  background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
  border-left: 4px solid #EF4444;
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 1.5rem;
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Logo styling - no animation */
.logo-animation {
  transition: opacity 0.3s ease;
}

=== FILE: src/styles/datepicker.css ===
/* Custom DatePicker Styles */
#datepicker-portal {
  z-index: 9999;
  position: relative;
}

.react-datepicker-wrapper {
  width: 100%;
}

.react-datepicker__input-container {
  width: 100%;
}

.react-datepicker-popper {
  z-index: 9999 !important;
  position: fixed !important;
}

.react-datepicker-calendar {
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  font-family: inherit;
  background: white;
  z-index: 9999;
}

/* Ensure datepicker appears above modal overlays */
.react-datepicker__tab-loop {
  z-index: 9999 !important;
  position: relative;
}

/* Fix for modal overflow issues */
.fixed.inset-0.z-50.overflow-y-auto:has(.react-datepicker-popper) {
  overflow: visible !important;
}

/* Alternative approach - ensure datepicker container is not clipped */
.react-datepicker__tab-loop__div {
  position: static !important;
}

/* Ensure proper layering in modals */
.react-datepicker__month-container {
  z-index: 9999;
}

/* Portal-specific styles */
.react-datepicker__portal {
  z-index: 9999 !important;
  position: fixed !important;
}

.react-datepicker__portal .react-datepicker {
  z-index: 9999 !important;
  position: relative !important;
}

.react-datepicker__header {
  background-color: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
  border-radius: 0.5rem 0.5rem 0 0;
  padding: 0.75rem;
}

.react-datepicker__current-month {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.5rem;
}

.react-datepicker__day-names {
  margin-bottom: 0.25rem;
}

.react-datepicker__day-name {
  color: #6b7280;
  font-size: 0.75rem;
  font-weight: 500;
  width: 2rem;
  line-height: 2rem;
}

.react-datepicker__month {
  margin: 0.5rem;
}

.react-datepicker__day {
  color: #374151;
  font-size: 0.875rem;
  width: 2rem;
  line-height: 2rem;
  border-radius: 0.375rem;
  transition: all 0.15s ease-in-out;
}

.react-datepicker__day:hover {
  background-color: #eff6ff;
  color: #2563eb;
}

.react-datepicker__day--selected {
  background-color: #2563eb;
  color: white;
}

.react-datepicker__day--selected:hover {
  background-color: #1d4ed8;
}

.react-datepicker__day--keyboard-selected {
  background-color: #dbeafe;
  color: #2563eb;
}

.react-datepicker__day--today {
  background-color: #fef3c7;
  color: #92400e;
  font-weight: 600;
}

.react-datepicker__day--disabled {
  color: #d1d5db;
  cursor: not-allowed;
}

.react-datepicker__day--disabled:hover {
  background-color: transparent;
  color: #d1d5db;
}

.react-datepicker__day--outside-month {
  color: #d1d5db;
}

.react-datepicker__navigation {
  background: none;
  border: none;
  top: 0.75rem;
  width: 2rem;
  height: 2rem;
  border-radius: 0.375rem;
  transition: background-color 0.15s ease-in-out;
}

.react-datepicker__navigation:hover {
  background-color: #f3f4f6;
}

.react-datepicker__navigation--previous {
  left: 0.75rem;
}

.react-datepicker__navigation--next {
  right: 0.75rem;
}

.react-datepicker__navigation-icon::before {
  border-color: #6b7280;
  border-width: 2px 2px 0 0;
  width: 0.5rem;
  height: 0.5rem;
}

.react-datepicker__today-button {
  background-color: #f9fafb;
  border-top: 1px solid #e5e7eb;
  border-radius: 0 0 0.5rem 0.5rem;
  color: #2563eb;
  font-size: 0.875rem;
  padding: 0.5rem;
  cursor: pointer;
  transition: background-color 0.15s ease-in-out;
}

.react-datepicker__today-button:hover {
  background-color: #f3f4f6;
}

/* Time picker styles */
.react-datepicker__time-container {
  border-left: 1px solid #e5e7eb;
}

.react-datepicker__time {
  background: white;
  border-radius: 0 0.5rem 0.5rem 0;
}

.react-datepicker__time-box {
  width: 85px;
}

.react-datepicker__time-list {
  height: 200px !important;
}

.react-datepicker__time-list-item {
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
  transition: background-color 0.15s ease-in-out;
}

.react-datepicker__time-list-item:hover {
  background-color: #eff6ff;
  color: #2563eb;
}

.react-datepicker__time-list-item--selected {
  background-color: #2563eb;
  color: white;
}

.react-datepicker__time-list-item--selected:hover {
  background-color: #1d4ed8;
}


=== FILE: src/types/next.auth.d.ts ===
import NextAuth, { DefaultSession, DefaultUser } from "next-auth";
import { Role, VerificationStatus } from "@prisma/client";

declare module "next-auth" {
  interface Session {
    user: {
      id: string;
      role: Role;
      officer_name: string;
      vendor_name?: string | null;
      verified_at?: Date | null;
      verification_status?: VerificationStatus;
      created_at?: Date;
    } & DefaultSession["user"];
    accessToken?: string;
  }

  interface User extends DefaultUser {
    role: Role;
    officer_name: string;
    vendor_name?: string | null;
    verified_at?: Date | null;
    verification_status?: VerificationStatus;
    created_at?: Date;
  }
}

declare module "next-auth/jwt" {
  interface JWT {
    id?: string;
    role?: Role;
    officer_name?: string;
    vendor_name?: string | null;
    verified_at?: Date | null;
    verification_status?: VerificationStatus;
    created_at?: Date;
    accessToken?: string;
  }
}


=== FILE: src/types/submission.ts ===
export interface SubmissionData {
  vendor_name: string;
  vendor_phone?: string;
  based_on: string;
  officer_name: string;
  job_description: string;
  work_location: string;
  implementation?: string; // akan diisi oleh admin saat approve
  working_hours: string;
  other_notes?: string; // akan diisi oleh admin saat approve
  work_facilities: string;
  worker_count?: number; // jumlah pekerja
  simja_number?: string;
  simja_date?: string;
  sika_number?: string;
  sika_date?: string;
  worker_names: string;
  content?: string; // akan diisi oleh admin saat approve
  sika_document_upload?: string;
  simja_document_upload?: string;
}

export interface SubmissionApprovalData {
  approval_status: 'APPROVED' | 'REJECTED';
  notes?: string;
  simlok_number?: string;
  simlok_date?: string;
  implementation_start_date?: string;
  implementation_end_date?: string;
}

export interface WorkerList {
  id: string;
  worker_name: string;
  worker_photo?: string | null;
  submission_id: string;
  created_at: Date;
}

export type SubmissionStatus = 'PENDING' | 'APPROVED' | 'REJECTED';


=== FILE: src/types/user.ts ===
import { User_role as Role, VerificationStatus } from "@prisma/client";

export interface UserData {
  id: string;
  officer_name: string;
  email: string;
  role: Role;
  address?: string | null;
  phone_number?: string | null;
  vendor_name?: string | null;
  created_at: string | Date;
  verified_at?: string | Date | null;
  verified_by?: string | null;
  verification_status?: VerificationStatus;
  rejected_at?: string | Date | null;
  rejected_by?: string | null;
  rejection_reason?: string | null;
  profile_photo?: string | null;
}


=== FILE: src/utils/file-validation.ts ===
/**
 * File validation utilities for consistent file size and type validation across the application
 */

// File size constants
export const FILE_SIZE_LIMITS = {
  DEFAULT: 8, // 8MB default limit
  IMAGE: 8,   // 8MB for images
  DOCUMENT: 8, // 8MB for documents
} as const;

// Allowed file types and extensions
export const ALLOWED_FILE_TYPES = {
  DOCUMENTS: [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  ],
  IMAGES: [
    'image/jpeg',
    'image/jpg', 
    'image/png',
    'image/gif'
  ],
  ALL: [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'image/jpeg',
    'image/jpg', 
    'image/png',
    'image/gif'
  ]
} as const;

export const ALLOWED_FILE_EXTENSIONS = {
  DOCUMENTS: ['.pdf', '.doc', '.docx'],
  IMAGES: ['.jpg', '.jpeg', '.png', '.gif'],
  ALL: ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif']
} as const;

export interface FileValidationOptions {
  maxSizeMB?: number;
  allowedTypes?: readonly string[];
  allowedExtensions?: readonly string[];
}

export interface FileValidationResult {
  isValid: boolean;
  error?: string;
  size?: number;
  type?: string;
  extension?: string;
}

/**
 * Validates file size, type, and extension
 */
export function validateFile(
  file: File, 
  options: FileValidationOptions = {}
): FileValidationResult {
  const {
    maxSizeMB = FILE_SIZE_LIMITS.DEFAULT,
    allowedTypes = ALLOWED_FILE_TYPES.ALL,
    allowedExtensions = ALLOWED_FILE_EXTENSIONS.ALL
  } = options;

  // Check file size (convert MB to bytes)
  const maxSizeBytes = maxSizeMB * 1024 * 1024;
  if (file.size > maxSizeBytes) {
    return {
      isValid: false,
      error: `Ukuran file terlalu besar. Maksimal ${maxSizeMB}MB`,
      size: file.size
    };
  }

  // Check file type
  if (!allowedTypes.includes(file.type as any)) {
    return {
      isValid: false,
      error: `Tipe file tidak didukung. Tipe yang diizinkan: ${allowedExtensions.join(', ')}`,
      type: file.type
    };
  }

  // Check file extension
  const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();
  if (!allowedExtensions.includes(fileExtension as any)) {
    return {
      isValid: false,
      error: `Ekstensi file tidak didukung. Ekstensi yang diizinkan: ${allowedExtensions.join(', ')}`,
      extension: fileExtension
    };
  }

  return {
    isValid: true,
    size: file.size,
    type: file.type,
    extension: fileExtension
  };
}

/**
 * Validates file for document uploads (PDF, DOC, DOCX)
 */
export function validateDocumentFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.DOCUMENT): FileValidationResult {
  return validateFile(file, {
    maxSizeMB,
    allowedTypes: [...ALLOWED_FILE_TYPES.DOCUMENTS],
    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.DOCUMENTS]
  });
}

/**
 * Validates file for image uploads (JPG, JPEG, PNG, GIF)
 */
export function validateImageFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {
  return validateFile(file, {
    maxSizeMB,
    allowedTypes: [...ALLOWED_FILE_TYPES.IMAGES],
    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.IMAGES]
  });
}

/**
 * Validates file for worker photo uploads (JPG, JPEG, PNG only)
 */
export function validateWorkerPhotoFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {
  return validateFile(file, {
    maxSizeMB,
    allowedTypes: ['image/jpeg', 'image/jpg', 'image/png'],
    allowedExtensions: ['.jpg', '.jpeg', '.png']
  });
}

/**
 * Format file size in human readable format
 */
export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 Bytes';

  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));

  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/**
 * Convert MB to bytes
 */
export function mbToBytes(mb: number): number {
  return mb * 1024 * 1024;
}

/**
 * Convert bytes to MB
 */
export function bytesToMB(bytes: number): number {
  return bytes / (1024 * 1024);
}

=== FILE: src/utils/image-compression.ts ===
/**
 * Image Compression Utility
 * Kompres gambar untuk foto pekerja dengan tetap mempertahankan kualitas visual
 */

interface CompressionOptions {
  maxWidth?: number;
  maxHeight?: number;
  quality?: number;
  outputFormat?: 'jpeg' | 'webp' | 'png';
  maxSizeKB?: number;
}

interface CompressionResult {
  file: File;
  originalSize: number;
  compressedSize: number;
  compressionRatio: number;
  format: string;
}

export class ImageCompressor {
  /**
   * Compress image file for worker photos
   */
  static async compressWorkerPhoto(
    file: File, 
    options: CompressionOptions = {}
  ): Promise<CompressionResult> {
    const defaultOptions: CompressionOptions = {
      maxWidth: 800,
      maxHeight: 600,
      quality: 0.85, // 85% quality untuk menjaga ketajaman
      outputFormat: 'jpeg',
      maxSizeKB: 500 // Max 500KB untuk foto pekerja
    };

    const config = { ...defaultOptions, ...options };
    const originalSize = file.size;

    // Create canvas untuk kompresi
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    if (!ctx) throw new Error('Canvas context not available');

    // Load image
    const img = await this.loadImage(file);

    // Calculate new dimensions
    const { width, height } = this.calculateDimensions(
      img.width, 
      img.height, 
      config.maxWidth!, 
      config.maxHeight!
    );

    // Set canvas size
    canvas.width = width;
    canvas.height = height;

    // Enable image smoothing untuk kualitas yang lebih baik
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';

    // Draw and compress
    ctx.drawImage(img, 0, 0, width, height);

    // Convert to blob dengan kualitas yang disesuaikan
    let quality = config.quality!;
    let compressedBlob: Blob;

    do {
      compressedBlob = await new Promise<Blob>((resolve) => {
        canvas.toBlob(
          (blob) => resolve(blob!),
          `image/${config.outputFormat}`,
          quality
        );
      });

      // Jika masih terlalu besar, kurangi kualitas
      if (compressedBlob.size > config.maxSizeKB! * 1024 && quality > 0.3) {
        quality -= 0.1;
      } else {
        break;
      }
    } while (quality > 0.3);

    // Create new file
    const compressedFile = new File(
      [compressedBlob], 
      this.generateFileName(file.name, config.outputFormat!),
      { type: `image/${config.outputFormat}` }
    );

    return {
      file: compressedFile,
      originalSize,
      compressedSize: compressedFile.size,
      compressionRatio: Math.round((1 - compressedFile.size / originalSize) * 100),
      format: config.outputFormat!
    };
  }

  /**
   * Load image from file
   */
  private static loadImage(file: File): Promise<HTMLImageElement> {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = URL.createObjectURL(file);
    });
  }

  /**
   * Calculate optimal dimensions maintaining aspect ratio
   */
  private static calculateDimensions(
    originalWidth: number,
    originalHeight: number,
    maxWidth: number,
    maxHeight: number
  ): { width: number; height: number } {
    let { width, height } = { width: originalWidth, height: originalHeight };

    if (width > maxWidth) {
      height = (height * maxWidth) / width;
      width = maxWidth;
    }

    if (height > maxHeight) {
      width = (width * maxHeight) / height;
      height = maxHeight;
    }

    return { width: Math.round(width), height: Math.round(height) };
  }

  /**
   * Generate filename with new extension
   */
  private static generateFileName(originalName: string, format: string): string {
    const nameWithoutExt = originalName.replace(/\.[^/.]+$/, '');
    return `${nameWithoutExt}_compressed.${format}`;
  }

  /**
   * Validate if file is a valid image for worker photo
   */
  static validateWorkerPhoto(file: File): { isValid: boolean; error?: string } {
    // Check file type
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
    if (!allowedTypes.includes(file.type)) {
      return {
        isValid: false,
        error: 'Hanya file gambar (JPG, JPEG, PNG) yang diperbolehkan untuk foto pekerja'
      };
    }

    // Check file size (max 10MB before compression)
    const maxSize = 10 * 1024 * 1024; // 10MB
    if (file.size > maxSize) {
      return {
        isValid: false,
        error: 'Ukuran file terlalu besar. Maksimal 10MB sebelum kompresi'
      };
    }

    // Check file extension
    const allowedExtensions = ['.jpg', '.jpeg', '.png'];
    const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();
    if (!allowedExtensions.includes(fileExt)) {
      return {
        isValid: false,
        error: 'Ekstensi file tidak valid. Gunakan .jpg, .jpeg, atau .png'
      };
    }

    return { isValid: true };
  }

  /**
   * Validate document files (for SIKA/SIMJA)
   */
  static validateDocumentFile(file: File): { isValid: boolean; error?: string } {
    // Allow both images and documents for SIKA/SIMJA
    const allowedTypes = [
      'image/jpeg', 'image/jpg', 'image/png',
      'application/pdf', 
      'application/msword',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];

    if (!allowedTypes.includes(file.type)) {
      return {
        isValid: false,
        error: 'File harus berupa gambar (JPG, PNG) atau dokumen (PDF, DOC, DOCX)'
      };
    }

    // Check file size (max 8MB)
    const maxSize = 8 * 1024 * 1024; // 8MB
    if (file.size > maxSize) {
      return {
        isValid: false,
        error: 'Ukuran file terlalu besar. Maksimal 8MB'
      };
    }

    const allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'];
    const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();
    if (!allowedExtensions.includes(fileExt)) {
      return {
        isValid: false,
        error: 'Ekstensi file tidak valid'
      };
    }

    return { isValid: true };
  }
}

=== FILE: src/utils/input-validation.ts ===
/**
 * Enhanced Input Validation Utilities
 * Validasi yang lebih ketat untuk berbagai tipe input
 */

export interface ValidationResult {
  isValid: boolean;
  error?: string;
  sanitizedValue?: string;
}

export class InputValidator {
  /**
   * Validate name fields (only letters, spaces, and common name characters)
   */
  static validateName(value: string, fieldName: string = 'Nama'): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: `${fieldName} wajib diisi` };
    }

    const trimmedValue = value.trim();

    // Check minimum length
    if (trimmedValue.length < 2) {
      return { isValid: false, error: `${fieldName} minimal 2 karakter` };
    }

    // Check maximum length
    if (trimmedValue.length > 100) {
      return { isValid: false, error: `${fieldName} maksimal 100 karakter` };
    }

    // Only allow letters, spaces, apostrophes, hyphens, and dots
    const nameRegex = /^[a-zA-Z\s.''-]+$/;
    if (!nameRegex.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: `${fieldName} hanya boleh berisi huruf, spasi, tanda petik, tanda hubung, dan titik` 
      };
    }

    // Check for multiple consecutive spaces
    if (/\s{2,}/.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: `${fieldName} tidak boleh memiliki lebih dari satu spasi berturut-turut` 
      };
    }

    // Sanitize: capitalize first letter of each word
    const sanitizedValue = trimmedValue
      .toLowerCase()
      .split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');

    return { isValid: true, sanitizedValue };
  }

  /**
   * Validate phone number (Indonesian format)
   */
  static validatePhoneNumber(value: string): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: 'Nomor telepon wajib diisi' };
    }

    const trimmedValue = value.trim();

    // Remove all non-numeric characters for validation
    const numbersOnly = trimmedValue.replace(/[^0-9]/g, '');

    // Check if it's all numbers (after cleaning)
    if (!/^[0-9+\-\s()]*$/.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: 'Nomor telepon hanya boleh berisi angka, +, -, (, ), dan spasi' 
      };
    }

    // Check length (Indonesian phone numbers)
    if (numbersOnly.length < 10 || numbersOnly.length > 15) {
      return { 
        isValid: false, 
        error: 'Nomor telepon harus 10-15 digit' 
      };
    }

    // Validate Indonesian phone number patterns
    if (numbersOnly.startsWith('08')) {
      // Mobile number format: 08xx-xxxx-xxxx
      if (numbersOnly.length < 11 || numbersOnly.length > 13) {
        return { 
          isValid: false, 
          error: 'Nomor HP Indonesia harus 11-13 digit (dimulai dengan 08)' 
        };
      }
    } else if (numbersOnly.startsWith('62')) {
      // International format: +62xxx
      if (numbersOnly.length < 12 || numbersOnly.length > 15) {
        return { 
          isValid: false, 
          error: 'Nomor internasional (+62) harus 12-15 digit' 
        };
      }
    } else if (!numbersOnly.startsWith('0')) {
      return { 
        isValid: false, 
        error: 'Nomor telepon harus dimulai dengan 08 (HP) atau 02/03/04/05/06/07 (telepon rumah)' 
      };
    }

    // Sanitize: format phone number
    let sanitizedValue: string;
    if (numbersOnly.startsWith('08')) {
      // Format: 0812-3456-7890
      sanitizedValue = numbersOnly.replace(/(\d{4})(\d{4})(\d+)/, '$1-$2-$3');
    } else if (numbersOnly.startsWith('62')) {
      // Format: +62-812-3456-7890
      sanitizedValue = `+${numbersOnly.replace(/(\d{2})(\d{3})(\d{4})(\d+)/, '$1-$2-$3-$4')}`;
    } else {
      sanitizedValue = trimmedValue;
    }

    return { isValid: true, sanitizedValue };
  }

  /**
   * Validate address (letters, numbers, spaces, and common address characters)
   */
  static validateAddress(value: string): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: 'Alamat wajib diisi' };
    }

    const trimmedValue = value.trim();

    // Check minimum length
    if (trimmedValue.length < 10) {
      return { isValid: false, error: 'Alamat minimal 10 karakter' };
    }

    // Check maximum length
    if (trimmedValue.length > 500) {
      return { isValid: false, error: 'Alamat maksimal 500 karakter' };
    }

    // Allow letters, numbers, spaces, and common address characters
    const addressRegex = /^[a-zA-Z0-9\s.,\-\/'#()]+$/;
    if (!addressRegex.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: 'Alamat hanya boleh berisi huruf, angka, spasi, dan karakter .,\-\/\'#()' 
      };
    }

    // Check for multiple consecutive spaces
    if (/\s{3,}/.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: 'Alamat tidak boleh memiliki lebih dari dua spasi berturut-turut' 
      };
    }

    // Sanitize: proper case and clean up spaces
    const sanitizedValue = trimmedValue
      .replace(/\s+/g, ' ') // Replace multiple spaces with single space
      .split(' ')
      .map(word => {
        // Don't capitalize prepositions and articles
        const lowerCaseWords = ['di', 'ke', 'dari', 'jalan', 'jl', 'rt', 'rw', 'no', 'kel', 'kec'];
        if (lowerCaseWords.includes(word.toLowerCase())) {
          return word.toLowerCase();
        }
        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
      })
      .join(' ');

    return { isValid: true, sanitizedValue };
  }

  /**
   * Validate email
   */
  static validateEmail(value: string): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: 'Email wajib diisi' };
    }

    const trimmedValue = value.trim().toLowerCase();

    // Basic email regex
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!emailRegex.test(trimmedValue)) {
      return { isValid: false, error: 'Format email tidak valid' };
    }

    // Check length
    if (trimmedValue.length > 254) {
      return { isValid: false, error: 'Email terlalu panjang (maksimal 254 karakter)' };
    }

    // Check for common typos
    const emailParts = trimmedValue.split('@');
    if (emailParts.length === 2) {
      const domain = emailParts[1];
      if (domain && (domain.includes('gmial') || domain.includes('gmai'))) {
        return { isValid: false, error: 'Mungkin Anda maksud gmail.com?' };
      }
    }

    return { isValid: true, sanitizedValue: trimmedValue };
  }

  /**
   * Validate vendor/company name
   */
  static validateVendorName(value: string): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: 'Nama vendor wajib diisi' };
    }

    const trimmedValue = value.trim();

    // Check minimum length
    if (trimmedValue.length < 2) {
      return { isValid: false, error: 'Nama vendor minimal 2 karakter' };
    }

    // Check maximum length
    if (trimmedValue.length > 150) {
      return { isValid: false, error: 'Nama vendor maksimal 150 karakter' };
    }

    // Allow letters, numbers, spaces, and common company characters
    const vendorRegex = /^[a-zA-Z0-9\s.,\-&()\/']+$/;
    if (!vendorRegex.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: 'Nama vendor hanya boleh berisi huruf, angka, spasi, dan karakter .,\-&()\/' 
      };
    }

    // Sanitize: proper case
    const sanitizedValue = trimmedValue
      .split(' ')
      .map(word => {
        // Keep certain abbreviations uppercase
        const upperCaseWords = ['PT', 'CV', 'UD', 'PD', 'TBK', 'LLC', 'LTD', 'INC'];
        if (upperCaseWords.includes(word.toUpperCase())) {
          return word.toUpperCase();
        }
        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
      })
      .join(' ');

    return { isValid: true, sanitizedValue };
  }

  /**
   * Validate job description
   */
  static validateJobDescription(value: string): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: 'Deskripsi pekerjaan wajib diisi' };
    }

    const trimmedValue = value.trim();

    // Check minimum length
    if (trimmedValue.length < 5) {
      return { isValid: false, error: 'Deskripsi pekerjaan minimal 5 karakter' };
    }

    // Check maximum length
    if (trimmedValue.length > 200) {
      return { isValid: false, error: 'Deskripsi pekerjaan maksimal 200 karakter' };
    }

    // Allow letters, numbers, spaces, and common description characters
    const jobRegex = /^[a-zA-Z0-9\s.,\-\/()&+]+$/;
    if (!jobRegex.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: 'Deskripsi pekerjaan hanya boleh berisi huruf, angka, spasi, dan karakter .,\-\/()&+' 
      };
    }

    // Sanitize: sentence case
    const sanitizedValue = trimmedValue.charAt(0).toUpperCase() + trimmedValue.slice(1);

    return { isValid: true, sanitizedValue };
  }

  /**
   * Validate document number (SIKA, SIMJA, etc.)
   */
  static validateDocumentNumber(value: string, documentType: string = 'Dokumen'): ValidationResult {
    if (!value || value.trim().length === 0) {
      return { isValid: false, error: `Nomor ${documentType} wajib diisi` };
    }

    const trimmedValue = value.trim().toUpperCase();

    // Allow letters, numbers, slashes, hyphens, and dots
    const docNumberRegex = /^[A-Z0-9\/\-\.]+$/;
    if (!docNumberRegex.test(trimmedValue)) {
      return { 
        isValid: false, 
        error: `Nomor ${documentType} hanya boleh berisi huruf besar, angka, /, -, dan .` 
      };
    }

    // Check length
    if (trimmedValue.length < 3) {
      return { isValid: false, error: `Nomor ${documentType} minimal 3 karakter` };
    }

    if (trimmedValue.length > 50) {
      return { isValid: false, error: `Nomor ${documentType} maksimal 50 karakter` };
    }

    return { isValid: true, sanitizedValue: trimmedValue };
  }

  /**
   * Validate number inputs
   */
  static validateNumber(
    value: string | number, 
    min?: number, 
    max?: number, 
    fieldName: string = 'Angka'
  ): ValidationResult {
    const numValue = typeof value === 'string' ? parseFloat(value) : value;

    if (isNaN(numValue)) {
      return { isValid: false, error: `${fieldName} harus berupa angka` };
    }

    if (min !== undefined && numValue < min) {
      return { isValid: false, error: `${fieldName} minimal ${min}` };
    }

    if (max !== undefined && numValue > max) {
      return { isValid: false, error: `${fieldName} maksimal ${max}` };
    }

    return { isValid: true, sanitizedValue: numValue.toString() };
  }
}

=== FILE: src/utils/jwt-config.ts ===
// src/utils/jwt-config.ts

/**
 * JWT Configuration utilities
 * Allows customization of JWT expiry times through environment variables
 */

export const JWT_CONFIG = {
  // Default: 24 hours (86400 seconds)
  JWT_EXPIRE_TIME: parseInt(process.env.JWT_EXPIRE_TIME || '86400'),
  
  // Default: 24 hours (86400 seconds)
  SESSION_MAX_AGE: parseInt(process.env.SESSION_MAX_AGE || '86400'),
  
  // Default: 1 hour (3600 seconds) - how often session gets updated when user is active
  SESSION_UPDATE_AGE: parseInt(process.env.SESSION_UPDATE_AGE || '3600'),
  
  // Client-side warning time (in minutes before expiry)
  WARNING_BEFORE_EXPIRY: parseInt(process.env.WARNING_BEFORE_EXPIRY || '5'),
  
  // Auto refresh interval (in minutes)
  AUTO_REFRESH_INTERVAL: parseInt(process.env.AUTO_REFRESH_INTERVAL || '30'),
} as const;

export const formatExpiryTime = (seconds: number): string => {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  
  if (hours > 0) {
    return `${hours}h ${minutes}m`;
  }
  return `${minutes}m`;
};

export const getExpiryDate = (fromNow: number = JWT_CONFIG.JWT_EXPIRE_TIME): Date => {
  return new Date(Date.now() + (fromNow * 1000));
};

export const isTokenExpired = (exp: number): boolean => {
  const now = Date.now() / 1000;
  return now >= exp;
};

export const getTimeUntilExpiry = (exp: number): number => {
  const now = Date.now() / 1000;
  return Math.max(0, exp - now);
};


=== FILE: src/utils/pdf/constants.ts ===
// Constants shared across photo loading and processing
export const MAX_IMAGE_SIZE = 800;
export const MAX_CONCURRENT_LOADS = 3;

=== FILE: src/utils/pdf/imageLoader.ts ===
import { PDFDocument, PDFImage } from "pdf-lib";
import { optimizeImage } from "./imageOptimizer";

// Ensure this module only runs on server-side
if (typeof window !== 'undefined') {
  throw new Error('imageLoader should only be used on server-side');
}

const MAX_CACHE_SIZE = 20;
const MAX_BATCH_SIZE = 3;
const BATCH_DELAY = 100; // ms between batches

// LRU Cache for processed images
class ImageCache {
  private cache = new Map<string, {
    image: PDFImage;
    lastAccessed: number;
  }>();

  get(key: string): PDFImage | undefined {
    const item = this.cache.get(key);
    if (item) {
      item.lastAccessed = Date.now();
      return item.image;
    }
    return undefined;
  }

  set(key: string, image: PDFImage): void {
    // Clean old entries if needed
    if (this.cache.size >= MAX_CACHE_SIZE) {
      // Sort by last accessed time and remove oldest
      const entries = Array.from(this.cache.entries());
      entries.sort((a, b) => a[1].lastAccessed - b[1].lastAccessed);
      
      // Remove oldest entries
      const toRemove = entries.slice(0, entries.length - MAX_CACHE_SIZE + 1);
      toRemove.forEach(([key]) => this.cache.delete(key));
    }

    this.cache.set(key, {
      image,
      lastAccessed: Date.now()
    });
  }

  delete(key: string): void {
    this.cache.delete(key);
  }

  clear(): void {
    this.cache.clear();
  }

  has(key: string): boolean {
    return this.cache.has(key);
  }
}

// Singleton cache instance
const imageCache = new ImageCache();

/**
 * Load and process image from base64 string
 */
async function loadBase64Image(
  pdfDoc: PDFDocument,
  base64Data: string,
  isPng: boolean
): Promise<PDFImage | null> {
  try {
    // Convert base64 to buffer
    const imageBuffer = Buffer.from(base64Data, 'base64');
    
    // Optimize image
    const optimizedBuffer = await optimizeImage(imageBuffer);
    
    // Embed in PDF
    return isPng
      ? await pdfDoc.embedPng(optimizedBuffer)
      : await pdfDoc.embedJpg(optimizedBuffer);
  } catch (error) {
    console.warn('Failed to process base64 image:', error);
    return null;
  }
}

/**
 * Load and process image from filesystem
 */
async function loadFileImage(
  pdfDoc: PDFDocument,
  filePath: string,
  isPng: boolean
): Promise<PDFImage | null> {
  try {
    const fs = await import('fs');
    if (!fs.existsSync(filePath)) {
      console.warn('File does not exist:', filePath);
      return null;
    }

    // Read and optimize image
    const imageBuffer = fs.readFileSync(filePath);
    const optimizedBuffer = await optimizeImage(imageBuffer);

    // Embed in PDF
    return isPng
      ? await pdfDoc.embedPng(optimizedBuffer)
      : await pdfDoc.embedJpg(optimizedBuffer);
  } catch (error) {
    console.warn('Failed to process file image:', error);
    return null;
  }
}

/**
 * Load worker photo with improved error handling and caching
 */
export async function loadWorkerPhoto(
  pdfDoc: PDFDocument,
  photoPath?: string | null
): Promise<PDFImage | null> {
  if (!photoPath) {
    console.log('LoadWorkerPhoto: No photo path provided');
    return null;
  }

  console.log('LoadWorkerPhoto: Loading photo from path:', photoPath);

  try {
    // Check cache first with validation
    const cached = imageCache.get(photoPath);
    if (cached) {
      try {
        // Validate cached image
        const imgDims = cached.scale(1);
        if (imgDims.width > 0 && imgDims.height > 0) {
          console.log('LoadWorkerPhoto: Using cached image for:', photoPath);
          return cached;
        } else {
          console.warn('LoadWorkerPhoto: Removing invalid cached image with zero dimensions');
          imageCache.delete(photoPath);
        }
      } catch (error) {
        console.warn('LoadWorkerPhoto: Invalid cached image, removing from cache:', error);
        imageCache.delete(photoPath);
      }
    }

    let resultImage: PDFImage | null = null;
    const timestamp = Date.now();

    if (photoPath.startsWith('data:image/') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {
      console.log('LoadWorkerPhoto: Processing base64 image');
      // Handle base64 data
      const isPng = photoPath.includes('image/png');
      let base64Data = photoPath;

      if (photoPath.startsWith('data:')) {
        const parts = photoPath.split(',');
        base64Data = parts[parts.length - 1] || '';
      }

      resultImage = await loadBase64Image(pdfDoc, base64Data, isPng);
    } else if (photoPath.startsWith('http://') || photoPath.startsWith('https://')) {
      console.log('LoadWorkerPhoto: Processing remote URL with cache busting');
      // Handle remote URLs with cache busting
      try {
        const response = await fetch(`${photoPath}?t=${timestamp}`);
        if (!response.ok) throw new Error('Failed to fetch image');
        const buffer = await response.arrayBuffer();
        const isPng = photoPath.toLowerCase().endsWith('.png');
        resultImage = isPng 
          ? await pdfDoc.embedPng(new Uint8Array(buffer))
          : await pdfDoc.embedJpg(new Uint8Array(buffer));
        console.log('LoadWorkerPhoto: Successfully loaded remote image');
      } catch (error) {
        console.warn('LoadWorkerPhoto: Failed to fetch remote image:', error);
        return null;
      }
    } else {
      console.log('LoadWorkerPhoto: Processing local file path');
      // Handle local file path with improved path resolution
      const path = await import('path');
      const isPng = photoPath.toLowerCase().endsWith('.png');

      // Determine final path based on input with proper error handling
      let finalPath: string;
      if (photoPath.startsWith('/api/files/')) {
        // Parse API file path: /api/files/{userId}/{category}/{filename}
        const apiParts = photoPath.split('/');
        if (apiParts.length >= 5) {
          const [, , , userId, category, ...filenameParts] = apiParts;
          const filename = filenameParts.join('/');
          
          // Validate required parts exist
          if (!userId || !category || !filename) {
            console.warn('LoadWorkerPhoto: Invalid API path structure:', { userId, category, filename });
            finalPath = path.join(process.cwd(), 'public', photoPath.replace('/api/files/', '/uploads/'));
          } else {
            // Map API categories to actual directory names
            const categoryFolders: Record<string, string> = {
              sika: 'dokumen-sika',
              simja: 'dokumen-simja',
              'id-card': 'id-card',
              other: 'lainnya',
              'worker-photo': 'foto-pekerja'  // This is the key mapping!
            };
            
            const folderName = categoryFolders[category] || category;
            finalPath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);
          }
        } else {
          // Fallback to simple replacement for malformed paths
          finalPath = path.join(process.cwd(), 'public', photoPath.replace('/api/files/', '/uploads/'));
        }
      } else if (photoPath.startsWith('/uploads/')) {
        finalPath = path.join(process.cwd(), 'public', photoPath);
      } else {
        finalPath = path.join(process.cwd(), 'public', `/uploads/${photoPath}`);
      }

      console.log('LoadWorkerPhoto: Resolved file path:', finalPath);
      resultImage = await loadFileImage(pdfDoc, finalPath, isPng);
    }

    // Validate and cache result
    if (resultImage) {
      try {
        const imgDims = resultImage.scale(1);
        if (imgDims.width > 0 && imgDims.height > 0) {
          console.log('LoadWorkerPhoto: Successfully loaded and cached image:', photoPath);
          imageCache.set(photoPath, resultImage);
          return resultImage;
        } else {
          console.warn('LoadWorkerPhoto: Skipping invalid image with zero dimensions:', photoPath);
          return null;
        }
      } catch (error) {
        console.warn('LoadWorkerPhoto: Failed to validate image dimensions:', error);
        return null;
      }
    }

    console.warn('LoadWorkerPhoto: Failed to load image:', photoPath);
    return null;
  } catch (error) {
    console.warn('LoadWorkerPhoto: Error loading worker photo:', error);
    return null;
  }
}

/**
 * Load worker photos in batches with improved error handling
 */
export async function preloadWorkerPhotos(
  pdfDoc: PDFDocument,
  workerList: Array<{ worker_photo?: string | null }>
): Promise<void> {
  // Filter out cached and null photos
  const photosToLoad = workerList
    .filter(w => w.worker_photo && !imageCache.has(w.worker_photo))
    .map(w => w.worker_photo as string);

  console.log(`Preloading ${photosToLoad.length} worker photos...`);

  // Process in small batches
  for (let i = 0; i < photosToLoad.length; i += MAX_BATCH_SIZE) {
    const batch = photosToLoad.slice(i, i + MAX_BATCH_SIZE);
    
    try {
      // Load batch in parallel with proper error handling
      await Promise.all(batch.map(async (photo) => {
        try {
          await loadWorkerPhoto(pdfDoc, photo);
        } catch (error) {
          console.warn(`Failed to preload photo: ${photo}`, error);
        }
      }));
      
      // Small delay between batches
      if (i + MAX_BATCH_SIZE < photosToLoad.length) {
        await new Promise(resolve => setTimeout(resolve, BATCH_DELAY));
      }
    } catch (error) {
      console.warn('Batch processing failed:', error);
      // Continue with next batch
    }
  }

  console.log('Worker photo preloading completed');
}

/**
 * Clear the image cache
 */
export function clearImageCache(): void {
  imageCache.clear();
}

=== FILE: src/utils/pdf/imageOptimizer.ts ===
// Conditional import for server-side only
let sharp: any = null;

// Only import sharp on server-side
if (typeof window === 'undefined') {
  try {
    // eslint-disable-next-line @typescript-eslint/no-require-imports
    sharp = require('sharp');
  } catch (error) {
    console.warn('Sharp not available, using fallback image processing');
  }
}

const MAX_IMAGE_SIZE = 500; // Maximum dimension in pixels
const JPEG_QUALITY = 70;   // JPEG compression quality (0-100)

interface ImageDimensions {
  width: number;
  height: number;
}

/**
 * Compress and optimize image for PDF embedding
 * @param imageBuffer Original image buffer
 * @returns Optimized image buffer
 */
export async function optimizeImage(imageBuffer: Buffer): Promise<Buffer> {
  // Return original buffer if not on server or sharp not available
  if (typeof window !== 'undefined' || !sharp) {
    console.log('Using original image buffer (client-side or sharp not available)');
    return imageBuffer;
  }

  try {
    // Get image info
    const metadata = await sharp(imageBuffer).metadata();
    if (!metadata.width || !metadata.height) {
      throw new Error('Could not get image dimensions');
    }

    // Calculate new dimensions
    const newDimensions = calculateDimensions({
      width: metadata.width,
      height: metadata.height
    });

    // Process image
    return await sharp(imageBuffer)
      // Resize while maintaining aspect ratio
      .resize(newDimensions.width, newDimensions.height, {
        fit: 'inside',
        withoutEnlargement: true
      })
      // Convert to JPEG with compression
      .jpeg({ 
        quality: JPEG_QUALITY,
        mozjpeg: true, // Use mozjpeg for better compression
        chromaSubsampling: '4:2:0' // Further reduce file size
      })
      // Optimize for web/pdf
      .toBuffer();

  } catch (error) {
    console.warn('Image optimization failed:', error);
    return imageBuffer; // Return original if optimization fails
  }
}

/**
 * Calculate new dimensions while maintaining aspect ratio
 */
function calculateDimensions(original: ImageDimensions): ImageDimensions {
  const { width, height } = original;

  if (width <= MAX_IMAGE_SIZE && height <= MAX_IMAGE_SIZE) {
    return original;
  }

  if (width > height) {
    return {
      width: MAX_IMAGE_SIZE,
      height: Math.round(height * MAX_IMAGE_SIZE / width)
    };
  } else {
    return {
      width: Math.round(width * MAX_IMAGE_SIZE / height),
      height: MAX_IMAGE_SIZE
    };
  }
}


=== FILE: src/utils/pdf/imageProcessor.ts ===
import { type PDFDocument, type PDFImage } from "pdf-lib";
import sharp from 'sharp';

const MAX_IMAGE_SIZE = 500; // Maximum dimension in pixels
const MAX_CACHE_SIZE = 20; // Maximum number of images to keep in cache

// Cache for processed images
const imageCache = new Map<string, PDFImage>();

/**
 * Compresses and processes image data for PDF embedding
 */
export async function processImage(inputData: Buffer): Promise<Buffer> {
  try {
    // Server-side compression using Sharp
    return await sharp(inputData)
      .resize(MAX_IMAGE_SIZE, MAX_IMAGE_SIZE, {
        fit: 'inside',
        withoutEnlargement: true
      })
      .jpeg({ quality: 70 })
      .toBuffer();
  } catch (error) {
    console.warn('Image compression failed:', error);
    return inputData; // Return original if compression fails
  }
}

/**
 * Cleans up the image cache if it exceeds the maximum size
 */
function cleanupCache() {
  if (imageCache.size > MAX_CACHE_SIZE) {
    const keysToDelete = Array.from(imageCache.keys())
      .slice(0, imageCache.size - MAX_CACHE_SIZE);
    keysToDelete.forEach(key => imageCache.delete(key));
  }
}

/**
 * Load and embed photo from file path or base64
 */
export async function loadWorkerPhoto(pdfDoc: PDFDocument, photoPath?: string | null): Promise<PDFImage | null> {
  if (!photoPath) return null;

  // Check cache first
  if (imageCache.has(photoPath)) {
    return imageCache.get(photoPath)!;
  }

  try {
    let imageBuffer: Buffer | null = null;

    if (photoPath.startsWith('data:image/') || photoPath.startsWith('data:') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {
      // Handle base64 data
      let base64Data: string | undefined;

      
      if (photoPath.startsWith('data:image/')) {
        const base64Parts = photoPath.split(',');
        base64Data = base64Parts[1];
      } else if (photoPath.startsWith('data:')) {
        const base64Parts = photoPath.split(',');
        base64Data = base64Parts.length > 1 ? base64Parts[1] : photoPath.replace('data:', '');
      } else {
        base64Data = photoPath;
      }
      
      if (base64Data) {
        imageBuffer = Buffer.from(base64Data, 'base64');
      }
    } else {
      // Handle file path
      const fs = await import('fs');
      const path = await import('path');
      let fullPath: string;
      
      if (photoPath.startsWith('/api/files/')) {
        const apiParts = photoPath.split('/');
        if (apiParts.length >= 5) {
          const [, , , userId, category, ...filenameParts] = apiParts;
          const filename = filenameParts.join('/');
          
          if (!userId || !category || !filename) {
            return null;
          }
          
          const categoryFolders: Record<string, string> = {
            sika: 'dokumen-sika',
            simja: 'dokumen-simja',
            id_card: 'id-card',
            other: 'lainnya',
            'worker-photo': 'foto-pekerja'
          };
          
          const folderName = categoryFolders[category] || category;
          fullPath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);
        } else {
          return null;
        }
      } else {
        fullPath = path.join(process.cwd(), 'public', 
          photoPath.startsWith('/') ? photoPath : `/uploads/${photoPath}`);
      }
      
      if (fs.existsSync(fullPath)) {
        imageBuffer = fs.readFileSync(fullPath);
      }
    }

    if (imageBuffer) {
      // Process and compress image
      const processedBuffer = await processImage(imageBuffer);
      const isPng = photoPath.toLowerCase().includes('.png');
      
      // Embed processed image
      const resultImage = isPng 
        ? await pdfDoc.embedPng(processedBuffer)
        : await pdfDoc.embedJpg(processedBuffer);

      // Cache the result
      imageCache.set(photoPath, resultImage);
      cleanupCache();

      return resultImage;
    }

    return null;
  } catch (error) {
    console.warn('Failed to load and process image:', error);
    return null;
  }
}

/**
 * Load worker photos in batches
 */
export async function preloadWorkerPhotos(
  pdfDoc: PDFDocument, 
  workerList: Array<{ worker_name: string; worker_photo?: string | null }>
): Promise<void> {
  // Filter out cached and null photos
  const photosToLoad = workerList
    .filter(worker => worker.worker_photo && !imageCache.has(worker.worker_photo))
    .map(worker => worker.worker_photo as string);

  // Process photos in batches
  const batchSize = 3;
  for (let i = 0; i < photosToLoad.length; i += batchSize) {
    const batch = photosToLoad.slice(i, i + batchSize);
    
    // Load batch in parallel
    await Promise.allSettled(
      batch.map(photo => loadWorkerPhoto(pdfDoc, photo))
    );
    
    // Small delay between batches to allow GC
    if (i + batchSize < photosToLoad.length) {
      await new Promise(resolve => setTimeout(resolve, 100));
    }
  }
}

/**
 * Clear the image cache
 */
export function clearImageCache(): void {
  imageCache.clear();
}

=== FILE: src/utils/pdf/newPhotoLoader.ts ===
import { PDFDocument, PDFImage } from 'pdf-lib';

const MAX_IMAGE_SIZE = 800; // Maximum size for either width or height
const MAX_CONCURRENT_LOADS = 3; // Maximum number of concurrent image loads
const imageCache = new Map<string, PDFImage>();

// Semaphore for limiting concurrent image loads
let activeLoads = 0;
const loadQueue: (() => void)[] = [];

function executeNextLoad() {
  if (activeLoads < MAX_CONCURRENT_LOADS && loadQueue.length > 0) {
    const nextLoad = loadQueue.shift();
    if (nextLoad) nextLoad();
  }
}

export function clearImageCache() {
  imageCache.clear();
}

async function compressImage(imageData: ArrayBuffer): Promise<ArrayBuffer> {
  if (typeof window !== 'undefined') {
    // Client-side compression
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        let width = img.width;
        let height = img.height;
        
        // Calculate new dimensions while maintaining aspect ratio
        if (width > MAX_IMAGE_SIZE || height > MAX_IMAGE_SIZE) {
          if (width > height) {
            height = Math.round(height * MAX_IMAGE_SIZE / width);
            width = MAX_IMAGE_SIZE;
          } else {
            width = Math.round(width * MAX_IMAGE_SIZE / height);
            height = MAX_IMAGE_SIZE;
          }
        }
        
        canvas.width = width;
        canvas.height = height;
        
        const ctx = canvas.getContext('2d');
        if (!ctx) {
          reject(new Error('Could not get canvas context'));
          return;
        }
        
        ctx.drawImage(img, 0, 0, width, height);
        
        // Convert to blob
        canvas.toBlob((blob) => {
          if (!blob) {
            reject(new Error('Could not convert to blob'));
            return;
          }
          
          // Convert blob to ArrayBuffer
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result as ArrayBuffer);
          reader.onerror = reject;
          reader.readAsArrayBuffer(blob);
        }, 'image/jpeg', 0.7); // Compress with 70% quality
      };
      
      img.onerror = reject;
      img.src = URL.createObjectURL(new Blob([imageData]));
    });
  } else {
    // Server-side compression using Sharp
    try {
      const sharp = await import('sharp');
      const buffer = Buffer.from(imageData);
      
      const processedBuffer = await sharp.default(buffer)
        .resize(MAX_IMAGE_SIZE, MAX_IMAGE_SIZE, {
          fit: 'inside',
          withoutEnlargement: true
        })
        .jpeg({ quality: 70 })
        .toBuffer();
      
      return processedBuffer.buffer as ArrayBuffer;
    } catch (error) {
      console.warn('Image compression failed:', error);
      return imageData;
    }
  }
}

export async function loadWorkerPhoto(pdfDoc: PDFDocument, photoPath?: string | null): Promise<PDFImage | null> {
  if (!photoPath) {
    return null;
  }

  // Check cache first
  if (imageCache.has(photoPath)) {
    return imageCache.get(photoPath)!;
  }

  // Wait for available slot if needed
  if (activeLoads >= MAX_CONCURRENT_LOADS) {
    await new Promise<void>(resolve => loadQueue.push(resolve));
  }
  activeLoads++;

  try {
    let resultImage: PDFImage | null = null;
    let imageData: ArrayBuffer | null = null;
    let retryCount = 0;
    const maxRetries = 2;

    while (retryCount <= maxRetries && !resultImage) {
      try {
        if (photoPath.startsWith('data:image/') || photoPath.startsWith('data:') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {
          // Handle base64 data
          let base64Data: string | undefined;
          const isPng = photoPath.includes('image/png');
          
          if (photoPath.startsWith('data:image/')) {
            const base64Parts = photoPath.split(',');
            base64Data = base64Parts[1];
          } else if (photoPath.startsWith('data:')) {
            const base64Parts = photoPath.split(',');
            base64Data = base64Parts.length > 1 ? base64Parts[1] : photoPath.replace('data:', '');
          } else {
            base64Data = photoPath;
          }
          
          if (base64Data) {
            const photoBytes = Buffer.from(base64Data, 'base64');
            try {
              const compressedData = await compressImage(photoBytes.buffer);
              const compressedBuffer = Buffer.from(compressedData);
              resultImage = isPng 
                ? await pdfDoc.embedPng(compressedBuffer)
                : await pdfDoc.embedJpg(compressedBuffer);
            } catch (err) {
              console.warn('Using original image due to compression failure:', err);
              resultImage = isPng 
                ? await pdfDoc.embedPng(photoBytes)
                : await pdfDoc.embedJpg(photoBytes);
            }
          }
        } else {
          // Handle file path with API compatibility
          const fullPath = photoPath.startsWith('/api/files/') 
            ? photoPath.replace('/api/files/', '/uploads/')
            : photoPath.startsWith('/') ? photoPath : `/uploads/${photoPath}`;

          if (typeof window !== 'undefined') {
            // Client-side loading with timeout
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            try {
              const response = await fetch(
                photoPath.startsWith('/api/files/') ? photoPath : fullPath,
                { signal: controller.signal }
              );
              
              if (response.ok) {
                imageData = await response.arrayBuffer();
              }
            } catch (error) {
              if (error instanceof Error && error.name === 'AbortError') {
                console.warn('Image load timeout:', photoPath);
              }
              throw error;
            } finally {
              clearTimeout(timeoutId);
            }
          } else {
            // Server-side loading with proper path resolution
            try {
              const fs = await import('fs');
              const path = await import('path');
              
              let photoFilePath: string;
              
              if (photoPath.startsWith('/api/files/')) {
                const apiParts = photoPath.split('/');
                if (apiParts.length >= 5) {
                  const [, , , userId, category, ...filenameParts] = apiParts;
                  const filename = filenameParts.join('/');
                  
                  if (!userId || !category || !filename) {
                    throw new Error('Invalid file path structure');
                  }
                  
                  const categoryFolders: Record<string, string> = {
                    sika: 'dokumen-sika',
                    simja: 'dokumen-simja',
                    id_card: 'id-card',
                    other: 'lainnya',
                    'worker-photo': 'foto-pekerja'
                  };
                  
                  const folderName = categoryFolders[category] || category;
                  photoFilePath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);
                } else {
                  throw new Error('Invalid API file path');
                }
              } else {
                photoFilePath = path.join(process.cwd(), 'public', fullPath);
              }
              
              if (!fs.existsSync(photoFilePath)) {
                throw new Error('File not found: ' + photoFilePath);
              }
              
              const fileBuffer = fs.readFileSync(photoFilePath);
              imageData = fileBuffer.buffer;
            } catch (error) {
              console.warn('Server-side image load failed:', error);
              throw error;
            }
          }

          if (imageData) {
            const isPng = fullPath.toLowerCase().includes('.png');
            try {
              const compressedData = await compressImage(imageData);
              const compressedBuffer = Buffer.from(compressedData);
              resultImage = isPng 
                ? await pdfDoc.embedPng(compressedBuffer)
                : await pdfDoc.embedJpg(compressedBuffer);
            } catch (err) {
              console.warn('Using original image due to compression failure:', err);
              const originalBuffer = Buffer.from(imageData);
              resultImage = isPng 
                ? await pdfDoc.embedPng(originalBuffer)
                : await pdfDoc.embedJpg(originalBuffer);
            }
          }
        }

        break; // Exit loop if successful
      } catch (error) {
        console.warn(`Attempt ${retryCount + 1} failed for ${photoPath}:`, error);
        if (retryCount < maxRetries) {
          retryCount++;
          await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));
        } else {
          throw error;
        }
      }
    }

    if (resultImage) {
      // Clean cache if too large (keep last 20 images)
      if (imageCache.size > 20) {
        const keysToDelete = Array.from(imageCache.keys()).slice(0, imageCache.size - 20);
        keysToDelete.forEach(key => imageCache.delete(key));
      }
      imageCache.set(photoPath, resultImage);
    }

    return resultImage;
  } catch (error) {
    console.error('Failed to load worker photo:', error);
    return null;
  } finally {
    activeLoads--;
    executeNextLoad();
  }
}

export async function preloadWorkerPhotos(
  pdfDoc: PDFDocument, 
  workerList: Array<{ worker_name: string; worker_photo?: string | null }>
): Promise<void> {
  // Filter out cached and null photos
  const photosToLoad = workerList
    .filter(worker => worker.worker_photo && !imageCache.has(worker.worker_photo))
    .map(worker => worker.worker_photo as string);

  // Process photos in batches
  const batchSize = 3;
  for (let i = 0; i < photosToLoad.length; i += batchSize) {
    const batch = photosToLoad.slice(i, i + batchSize);
    const batchPromises = batch.map(photo => loadWorkerPhoto(pdfDoc, photo));
    
    try {
      await Promise.all(batchPromises);
    } catch (error) {
      console.warn('Error loading batch of photos:', error);
    }
    
    // Small delay between batches
    if (i + batchSize < photosToLoad.length) {
      await new Promise(resolve => setTimeout(resolve, 100));
    }
  }
}

=== FILE: src/utils/pdf/photoLoader.ts ===
//src/utils/pdf/photoLoader.ts - Wrapper untuk backward compatibility
import { clearImageCache, loadWorkerPhoto, preloadWorkerPhotos } from './imageLoader';

export { clearImageCache, loadWorkerPhoto, preloadWorkerPhotos };

=== FILE: src/utils/pdf/simlokTemplate.ts ===
// simlok-pdf.ts
import {
  PDFDocument,
  StandardFonts,
  rgb,
  type PDFFont,
  type RGB,
  type PDFImage,
} from "pdf-lib";
import * as QRCode from 'qrcode';
import { numberToBahasa } from "@/lib/parseNumber";
/**
 * Load logo image for PDF generation
 * Works both on client-side (fetch) and server-side (fs)
 */
async function loadLogo(pdfDoc: PDFDocument): Promise<PDFImage | null> {
  try {
    const logoPath = '/assets/logo_pertamina.png';
    
    if (typeof window !== 'undefined') {
      // Client-side: use fetch
      const response = await fetch(logoPath);
      if (response.ok) {
        const logoBytes = await response.arrayBuffer();
        return await pdfDoc.embedPng(new Uint8Array(logoBytes));
      }
    } else {
      // Server-side: use file system
      const fs = await import('fs');
      const path = await import('path');
      const logoFilePath = path.join(process.cwd(), 'public', logoPath);
      
      if (fs.existsSync(logoFilePath)) {
        const fileBuffer = fs.readFileSync(logoFilePath);
        return await pdfDoc.embedPng(fileBuffer);
      }
    }
  } catch (error) {
    console.warn('Failed to load logo:', error);
  }
  
  return null;
}

/**
 * Generate QR code image for PDF
 */
async function generateQRImage(pdfDoc: PDFDocument, qrString: string): Promise<PDFImage | null> {
  try {
    // Generate QR code as PNG buffer
    const qrBuffer = await QRCode.toBuffer(qrString, {
      type: 'png',
      width: 200,
      margin: 2,
      color: {
        dark: '#000000',
        light: '#FFFFFF'
      }
    });
    
    // Embed QR code image into PDF
    return await pdfDoc.embedPng(qrBuffer);
  } catch (error) {
    console.warn('Failed to generate QR code image:', error);
    return null;
  }
}

/** Struktur data mengikuti placeholder di template kamu */
export interface SubmissionPDFData {
  simlok_number?: string | null;
  simlok_date?: string | Date | null | undefined;
  implementation_start_date?: string | Date | null | undefined;
  implementation_end_date?: string | Date | null | undefined;
  vendor_name: string;
  simja_number?: string | null;
  simja_date?: string | Date | null | undefined;
  sika_number?: string | null;
  sika_date?: string | Date | null | undefined;
  job_description: string;
  work_location: string;
  implementation: string | null;
  working_hours: string;            // contoh: "08:30 - 06:30 WIB"
  other_notes?: string | null;
  work_facilities: string;
  worker_names?: string | null;
  worker_count?: number | null;
  content?: string | null;
  signer_position?: string | null;
  signer_name?: string | null;
  qrcode?: string | null;  // QR code string for PDF
  // Tambahkan untuk daftar pekerja dari tabel terpisah
  final_status?: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED' | null;
  workerList?: Array<{
    worker_name: string;
    worker_photo?: string | null;
  }>;
  // Support database field name
  worker_list?: Array<{
    worker_name: string;
    worker_photo?: string | null;
  }>;
}

export type SIMLOKOptions = {
  logoBase64?: string;     // opsional
  primary?: RGB;           // warna judul
  cityIssued?: string;     // default "Jakarta"
  headTitle?: string;      // default "Sr Officer Security III"
  headName?: string;       // default "Juliarto Santoso"
  fontSize?: number;       // default 12
  leftLabelWidth?: number; // default 190
  lineGap?: number;        // default 15.5
};

const A4 = { w: 595.28, h: 841.89 };
const MARGIN = 50;
const LEFT_LABEL_WIDTH_DEFAULT = 160;
const LINE_GAP_DEFAULT = 15.5;

function toDate(d?: string | Date | null) {
  if (!d) return null;
  return typeof d === "string" ? new Date(d) : d;
}

function fmtDateID(d?: string | Date | null) {
  const dd = toDate(d);
  if (!dd || isNaN(+dd)) return "-";
  return dd.toLocaleDateString("id-ID", {
    day: "2-digit",
    month: "long",
    year: "numeric",
  });
}

/**
 * Ekstrak tanggal dari text pelaksanaan
 * Contoh: "Terhitung mulai tanggal 01 Agustus 2025 sampai 15 Agustus 2025"
 * Akan mengambil tanggal pertama: "01 Agustus 2025"
 */
function extractDateFromPelaksanaan(pelaksanaan?: string | null): Date | null {
  if (!pelaksanaan) return null;
  
  // Pattern untuk menangkap tanggal dalam format: DD Bulan YYYY
  const datePattern = /(\d{1,2})\s+(Januari|Februari|Maret|April|Mei|Juni|Juli|Agustus|September|Oktober|November|Desember)\s+(\d{4})/i;
  const match = pelaksanaan.match(datePattern);
  
  if (!match) return null;
  
  const [, day, month, year] = match;
  
  // Mapping bulan Indonesia ke nomor bulan
  const monthMap: { [key: string]: number } = {
    'januari': 0, 'februari': 1, 'maret': 2, 'april': 3,
    'mei': 4, 'juni': 5, 'juli': 6, 'agustus': 7,
    'september': 8, 'oktober': 9, 'november': 10, 'desember': 11
  };
  
  const monthIndex = month ? monthMap[month.toLowerCase()] : undefined;
  if (monthIndex === undefined || !year || !day) return null;
  
  return new Date(parseInt(year), monthIndex, parseInt(day));
}

/** Hapus newline ganda & spasi berlebih agar wrap presisi */
function normalizeInline(s?: string | null) {
  if (!s) return "";
  return s.replace(/\s+/g, " ").trim();
}

class PDFKit {
  doc!: PDFDocument;
  page: any;
  font!: PDFFont;
  bold!: PDFFont;

  x = MARGIN;
  y = A4.h - MARGIN;

  fs = 12;
  lineGap = LINE_GAP_DEFAULT;
  leftLabelWidth = LEFT_LABEL_WIDTH_DEFAULT;
  pageCount = 0;
  submissionData?: SubmissionPDFData;

  async init() {
    this.doc = await PDFDocument.create();
    this.page = this.doc.addPage([A4.w, A4.h]);
    this.font = await this.doc.embedFont(StandardFonts.Helvetica);
    this.bold = await this.doc.embedFont(StandardFonts.HelveticaBold);
    this.pageCount = 1;
  }

  async addPage() {
    this.page = this.doc.addPage([A4.w, A4.h]);
    this.pageCount++;
    this.x = MARGIN;
    
    // Add header to pages 2 and beyond
    if (this.pageCount > 1 && this.submissionData) {
      await this.addHeader();
      this.y = A4.h - 140; // Start content below header
    } else {
      this.y = A4.h - MARGIN;
    }
  }

  async addHeader() {
    if (!this.submissionData) return;
    
    // Add logo - await untuk memastikan logo ter-load
    const logoImage = await loadLogo(this.doc);
    if (logoImage) {
      const logoWidth = 120;
      const logoHeight = 40;
      const logoX = A4.w - logoWidth - 40;
      const logoY = A4.h - 60;
      
      this.page.drawImage(logoImage, {
        x: logoX,
        y: logoY,
        width: logoWidth,
        height: logoHeight,
      });
    }
    
    // Add header dengan nomor SIMLOK
    const simlokNumber = this.submissionData.simlok_number || "[DRAFT]/XX/09/2025";
    this.text(`Lampiran Simlok No. ${simlokNumber}`, MARGIN, A4.h - 80, {
      size: 12,
      bold: true,
      color: rgb(0, 0, 0),
    });

    // Add nama vendor di bawah lampiran
    this.text("Nama petugas ", MARGIN, A4.h - 100, {
      size: 11,
      bold: false,
      color: rgb(0, 0, 0),
    });

    // Hitung lebar text "Nama petugas " untuk positioning nama vendor
    const namaPetugasWidth = this.measure("Nama petugas ", { size: 11, bold: false });
    this.text(this.submissionData.vendor_name, MARGIN + namaPetugasWidth, A4.h - 100, {
      size: 11,
      bold: true,
      color: rgb(0, 0, 0),
    });

    // // Add separator line
    // const lineY = A4.h - 120;
    // const lineStartX = MARGIN;
    // const lineEndX = A4.w - MARGIN;
    // this.page.drawLine({
    //   start: { x: lineStartX, y: lineY },
    //   end: { x: lineEndX, y: lineY },
    //   thickness: 0.5,
    //   color: rgb(0.7, 0.7, 0.7),
    // });
  }

  measure(text: string, opts?: { size?: number; bold?: boolean }) {
    const size = opts?.size ?? this.fs;
    const f = opts?.bold ? this.bold : this.font;
    return f.widthOfTextAtSize(text, size);
  }

  text(
    t: string,
    x: number,
    y: number,
    o?: { size?: number; bold?: boolean; color?: RGB }
  ) {
    this.page.drawText(t, {
      x,
      y,
      size: o?.size ?? this.fs,
      font: o?.bold ? this.bold : this.font,
      color: o?.color ?? rgb(0, 0, 0),
    });
  }

  center(t: string, y: number, o?: { size?: number; bold?: boolean; color?: RGB }) {
    const w = this.measure(t, o);
    const cx = (A4.w - w) / 2;
    this.text(t, cx, y, o);
  }

  async wrap(
    t: string,
    x: number,
    maxW: number,
    o?: { size?: number; bold?: boolean }
  ) {
    const size = o?.size ?? this.fs;
    const f = o?.bold ? this.bold : this.font;
    const words = t.split(/\s+/);
    let line = "";
    const lines: string[] = [];
    for (const w of words) {
      const test = line ? line + " " + w : w;
      const width = f.widthOfTextAtSize(test, size);
      if (width > maxW && line) {
        lines.push(line);
        line = w;
      } else line = test;
    }
    if (line) lines.push(line);
    for (const ln of lines) {
      await this.pageBreak();
      this.text(ln, x, this.y, { size, bold: o?.bold ?? false });
      this.y -= this.lineGap;
    }
  }

  async pageBreak(min = 60) {
    if (this.y < MARGIN + min) await this.addPage();
  }

  /**
   * Baris bernomor dengan label di kiri, titik dua di kolom tengah,
   * dan value yang dibungkus di kolom kanan.
   */
  async numberedRow(
    no: number,
    label: string,
    rawValue?: string | null,
    opts?: { valueBold?: boolean }
  ) {
    const value = (rawValue ?? "").toString();
    await this.pageBreak();

    // Minimal spacing between rows for compactness
    if (no > 1) {
      this.y -= this.lineGap * 0.2; // Reduced from 0.5 to 0.2
    }

    // Label kiri (bold)
    const left = `${no}. ${label}`;
    this.text(left, this.x, this.y, { bold: false });

    // Titik dua di kolom tengah agar align konsisten
    const colonX = this.x + this.leftLabelWidth - this.measure(":", { size: this.fs }) - 2;
    this.text(":", colonX, this.y);

    // Value di kolom kanan (wrap)
    const rightX = this.x + this.leftLabelWidth + 4;
    const rightW = A4.w - MARGIN - rightX;
    await this.wrap(normalizeInline(value) || "-", rightX, rightW, {
      bold: !!opts?.valueBold,
    });
    
    // Spacing after each numbered row for better readability
    this.y -= this.lineGap * 0.4; // Increased spacing between points
  }
}

export async function generateSIMLOKPDF(submissionData: SubmissionPDFData): Promise<Uint8Array> {
  const k = new PDFKit();
  await k.init();
  
  // Store submission data for header generation
  k.submissionData = submissionData;
  
  const { page } = k;
  const { width, height } = page.getSize();

  // Load and embed the Pertamina logo
  const logoImage = await loadLogo(k.doc);

  const s = submissionData;

  // Set PDF metadata with SIMLOK information
  const simlokNumber = s.simlok_number ? `${s.simlok_number}` : "SIMLOK";
  const simlokTitle = `SIMLOK NO-${simlokNumber}`;
  const currentDate = new Date();
  
  k.doc.setTitle(simlokTitle);
  k.doc.setSubject("Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)");
  k.doc.setAuthor("PT PERTAMINA (PERSERO)");
  k.doc.setKeywords(["SIMLOK", "Pertamina", "Izin Masuk", simlokNumber, s.vendor_name]);
  k.doc.setProducer("SIMLOK System");
  k.doc.setCreator("SIMLOK PDF Generator");
  k.doc.setCreationDate(currentDate);
  k.doc.setModificationDate(currentDate);

  // Set initial styling - optimized for single page
  k.fs = 11; // Increased from 10 to 11
  k.lineGap = 13; // Increased from 12 to 13
  k.leftLabelWidth = 140; // Keep as 140 for compactness

  // Add logo to top-right if available
  if (logoImage) {
    const logoWidth = 120;
    const logoHeight = 40;
    const logoX = width - logoWidth - 40; // 40 pixels from right edge
    const logoY = height - 60; // 80 pixels from top (higher than title)
    
    page.drawImage(logoImage, {
      x: logoX,
      y: logoY,
      width: logoWidth,
      height: logoHeight,
    });
  }

  // Add centered header
  k.center("SURAT IZIN MASUK LOKASI", height - 85, {
    size: 14, // Reduced from 16 to 14
    bold: true,
    color: rgb(0, 0, 0),
  });

  // Add border bottom line under the title
  const titleY = height - 70;
  const lineY = titleY - 20; // Reduced spacing
  const lineStartX = 185; // Start line position
  const lineEndX = A4.w - 185; // End line position
  page.drawLine({
    start: { x: lineStartX, y: lineY },
    end: { x: lineEndX, y: lineY },
    thickness: 1,
    color: rgb(0, 0, 0),
  });

  // SIMLOK number (centered)
  const simlokNo = s.simlok_number ? `${s.simlok_number}` : "";
  k.center(`SIMLOK NO-${simlokNo}`, height - 105, {
    size: 12, // Reduced from 14 to 12
  });

  // Introduction text
  k.text("Dengan ini di berikan izin memasuki lokasi PT PERTAMINA (PERSERO) kepada", 50, height - 135, {
    size: 11, // Match with content font size
  });

  // Move to content area and add numbered items with proper spacing
  k.y = height - 160; // Added more spacing between intro text and point 1

  await k.numberedRow(1, "Nama", s.vendor_name, { valueBold: false });

  // Format berdasarkan (SIMJA info)
  const berdasarkan = s.simja_number
    ? `${normalizeInline(s.simja_number)} Tgl. ${fmtDateID(s.simja_date)}`
    : "";
  
  await k.numberedRow(2, "Berdasarkan", berdasarkan);
  await k.numberedRow(3, "Pekerjaan", s.job_description);
  await k.numberedRow(4, "Lokasi Kerja", s.work_location);
  
  // Use provided pelaksanaan or generate template based on dates
  let pelaksanaanText = s.implementation;
  if (!pelaksanaanText || pelaksanaanText.trim().length === 0) {
    if (s.implementation_start_date && s.implementation_end_date) {
      pelaksanaanText = `Terhitung mulai tanggal ${fmtDateID(s.implementation_start_date)} sampai ${fmtDateID(s.implementation_end_date)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;
    } else {
      pelaksanaanText = "Terhitung mulai tanggal [Tanggal Mulai] sampai [Tanggal Selesai]. Termasuk hari Sabtu, Minggu dan hari libur lainnya.";
    }
  }
  
  await k.numberedRow(5, "Pelaksanaan", normalizeInline(pelaksanaanText));
  await k.numberedRow(6, "Jam Kerja", `Mulai pukul ${s.working_hours}`);
  
  // Special handling for "Lain-lain" to show as bulleted list or template preview
  if (s.other_notes && s.other_notes.trim().length > 0) {
    await k.pageBreak();
    
    // Label kiri (bold)
    const left = "7. Lain-lain";
    k.text(left, k.x, k.y, { bold: false });

    // Titik dua di kolom tengah
    const colonX = k.x + k.leftLabelWidth - k.measure(":", { size: k.fs }) - 2;
    k.text(":", colonX, k.y);

    // Process lain-lain as bulleted list
   const lines = s.other_notes.split('\n').map((l: string) => l.trim()).filter(Boolean);
const rightX = k.x + k.leftLabelWidth + 4;
const rightW = A4.w - MARGIN - rightX;

for (let idx = 0; idx < lines.length; idx++) {
  const line = lines[idx];
  const isFirst = idx === 0;
  const isLast  = idx === lines.length - 2;

  if (isFirst) {
    await k.wrap(` ${line}`, rightX, rightW);
  } else {
    // newline (spasi vertikal) sebelum baris terakhir
    if (isLast) k.y -= k.lineGap;

    await k.pageBreak();
    await k.wrap(` ${line}`, rightX, rightW);
  }
}

    // Add spacing after custom other_notes to match other numbered rows
    k.y -= k.lineGap * 0.4;

  } else {
    // Generate template preview when no actual data
    await k.pageBreak();
    
    // Label kiri (bold)
    const left = "7. Lain-lain";
    k.text(left, k.x, k.y, { bold: false });

    // Titik dua di kolom tengah
    const colonX = k.x + k.leftLabelWidth - k.measure(":", { size: k.fs }) - 2;
    k.text(":", colonX, k.y);

    // Generate template preview similar to reviewer
    const rightX = k.x + k.leftLabelWidth + 4;
    const rightW = A4.w - MARGIN - rightX;
    
    // Generate structured template with bold formatting
    
    // Line 1: Introduction
    await k.wrap(" Izin diberikan berdasarkan :", rightX, rightW, { bold: false });
    
    // Minimal spacing before SIMJA section
    k.y -= k.lineGap * 0.2; // Reduced spacing
    
    // SIMJA section with mixed formatting
    if ((s.simja_number && s.simja_date) || s.simja_number || s.simja_date) {
      await k.pageBreak();
      
      // Bullet point dengan SIMJA bold dan sisa text normal
      const bulletX = rightX;
      k.text(" • ", bulletX, k.y, { bold: false });
      const simjaX = bulletX + k.measure(" • ", { bold: false });
      k.text("SIMJA", simjaX, k.y, { bold: true });
      const restX = simjaX + k.measure("SIMJA", { bold: true });
      k.text(" Ast. Man. Facility Management", restX, k.y, { bold: false });
      
      // Move to next line
      k.y -= k.lineGap;
      
      // Baris kedua dengan indentasi untuk No. dan Tanggal
      await k.pageBreak();
      const simjaNum = s.simja_number || '[Nomor SIMJA]';
      const simjaDate = s.simja_date ? fmtDateID(s.simja_date) : '[Tanggal SIMJA]';
      await k.wrap(`   No. ${simjaNum} Tanggal ${simjaDate}`, rightX, rightW, { bold: true });
      
      // Minimal spacing after SIMJA section
      k.y -= k.lineGap * 0.2;
    }
    
    // SIKA section with mixed formatting
    if ((s.sika_number && s.sika_date) || s.sika_number || s.sika_date) {
      await k.pageBreak();
      
      // Bullet point dengan SIKA bold dan sisa text normal
      const bulletX = rightX;
      k.text(" • ", bulletX, k.y, { bold: false });
      const sikaX = bulletX + k.measure(" • ", { bold: false });
      k.text("SIKA", sikaX, k.y, { bold: true });
      const restX = sikaX + k.measure("SIKA", { bold: true });
      k.text(" Pekerjaan Dingin", restX, k.y, { bold: false });
      
      // Move to next line
      k.y -= k.lineGap;
      
      // Baris kedua dengan indentasi untuk No. dan Tanggal
      await k.pageBreak();
      const sikaNum = s.sika_number || '[Nomor SIKA]';
      const sikaDate = s.sika_date ? fmtDateID(s.sika_date) : '[Tanggal SIKA]';
      await k.wrap(`   No.${sikaNum} Tanggal. ${sikaDate}`, rightX, rightW, { bold: true });
      
      // Minimal spacing after SIKA section
      k.y -= k.lineGap * 0.2;
    }
    
    // Head of Security section with bold date
    await k.pageBreak();
    await k.wrap(" ", rightX, rightW, { bold: false });
    
    await k.pageBreak();
    await k.wrap("  Diterima Sr Officer III Security:", rightX, rightW, { bold: false });
    
    await k.pageBreak();
    const simlokDate = s.simlok_date ? fmtDateID(s.simlok_date) : fmtDateID(new Date());
    await k.wrap(`  Tanggal ${simlokDate}`, rightX, rightW, { bold: true });
  }
  
  // Add spacing after point 7 (Lain-lain) to match other numbered rows
  k.y -= k.lineGap * 0.4; // Same spacing as numberedRow function
  
  // Get actual worker count from worker data if worker_count is null/0
  const currentWorkerData = s.workerList || (s as any).worker_list;
  const actualWorkerCount = s.worker_count || (currentWorkerData ? currentWorkerData.length : 0);
  
  await k.numberedRow(8, "Sarana Kerja", `${s.work_facilities}. Jumlah Pekerja ${actualWorkerCount} (${numberToBahasa(actualWorkerCount)}) Orang`);

  // Add content paragraph - use provided content or default template
  k.y -= 3; // Further reduced spacing
  const contentText = s.content && s.content.trim().length > 0 
    ? s.content 
    : "Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.";
  
  await k.pageBreak();
  await k.wrap(normalizeInline(contentText), 50, A4.w - 2 * MARGIN, { size: 11 }); // Match with main content font size
  k.y -= 3; // Further reduced spacing

  // Add bottom text
//   k.pageBreak();
//   k.wrap(`Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan
// tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan
// kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka
// kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan
// SIMLOK 2 hari sebelum masa berlaku habis.`, 50, A4.w - 2 * MARGIN);

  // Add signature section
  k.y -= 8; // Further reduced spacing
  const signatureY = k.y;

  // Extract date from pelaksanaan or use tanggal_simlok as fallback
  const dateFromPelaksanaan = extractDateFromPelaksanaan(s.implementation);
  const displayDate = dateFromPelaksanaan || toDate(s.simlok_date);

  // Right side - Location and Date (above Head title)
  k.text("Dikeluarkan di : Jakarta", A4.w - 230, signatureY, { size: 11 });
  k.text("Pada tanggal : " + fmtDateID(displayDate), A4.w - 230, signatureY - 15, { size: 11 });

  // Right side - Head title and name (below location/date)
  const jabatanSigner = s.signer_position || "Head Or Security Region I";
  const namaSigner = s.signer_name || "Julianto Santoso";
  
  // Calculate precise positions for perfect centering - more compact
  const jabatanY = signatureY - 40; // Reduced spacing
  const namaY = signatureY - 145; // Reduced spacing
  
  // Draw jabatan
  k.text(jabatanSigner, A4.w - 230, jabatanY, { size: 11 });
  
  // Add QR code if available - positioned with simple pixel values for easy maintenance
  if (s.qrcode && s.final_status === 'APPROVED') {
    const qrImage = await generateQRImage(k.doc, s.qrcode);
    if (qrImage) {
      const qrSize = 80; // Reduced QR code size
      const qrX = 395; // Adjusted position
      const qrY = signatureY - 130; // Adjusted position for more compact layout
      
      // Draw QR code at fixed pixel position
      page.drawImage(qrImage, {
        x: qrX,
        y: qrY,
        width: qrSize,
        height: qrSize,
      });
    }
  }
  
  // Draw nama
  k.text(namaSigner, A4.w - 230, namaY, { bold: true, size: 11 });

  // Add second page with worker photos if available
  // Handle both workerList (interface) and worker_list (database)
  const workerData = s.workerList || (s as any).worker_list;
  if (workerData && workerData.length > 0) {
    await addWorkerPhotosPage(k, workerData);
  }

  return k.doc.save();
}

import { loadWorkerPhoto, preloadWorkerPhotos } from './imageLoader';

/**
 * Add second page with worker photos
 */
async function addWorkerPhotosPage(
  k: PDFKit, 
  workerList: Array<{ worker_name: string; worker_photo?: string | null }>
) {
  // Only proceed if there are workers
  if (!workerList || workerList.length === 0) {
    return;
  }

  // Preload all worker photos in batch for better performance
  await preloadWorkerPhotos(k.doc, workerList);

  // Add new page - header akan otomatis ditambahkan
  await k.addPage();

  // Calculate grid layout optimized for 3x3 photos
  const photosPerRow = 3;
  const photoWidth = 130;  // Optimized for better fit
  const photoHeight = 170; // Optimized for better fit
  const marginHorizontal = (A4.w - (photosPerRow * photoWidth)) / (photosPerRow + 1);
  const marginVertical = 12; // Reduced vertical margin
  const nameSpacing = 20; // Space for worker name below photo
  
  let currentRow = 0;
  let currentCol = 0;
  const startY = A4.h - 140; // Optimized start position to fit header

  // Process each worker
  for (let i = 0; i < workerList.length; i++) {
    const worker = workerList[i];
    if (!worker) continue; // Skip if worker is undefined
    
    // Calculate position
    const x = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));
    const y = startY - (currentRow * (photoHeight + marginVertical + nameSpacing)); // Use nameSpacing constant

    // Check if we need a new page (optimized for 3x3 grid)
    const bottomY = y - photoHeight;
    const pageLimit = MARGIN + 30;
    
    // Check if we need a new page - either by space limit or by 3x3 grid limit (max 9 per page)
    const workersOnCurrentPage = (currentRow * photosPerRow) + currentCol;
    const needNewPageBySpace = bottomY < pageLimit;
    const needNewPageByGrid = workersOnCurrentPage >= 9; // 3x3 = 9 workers max per page
    
    if (needNewPageBySpace || needNewPageByGrid) {
      await k.addPage(); // Header akan otomatis ditambahkan oleh addPage()
      
      currentRow = 0;
      currentCol = 0;
      const newY = startY - (currentRow * (photoHeight + marginVertical + nameSpacing));
      // Recalculate x for new page
      const newX = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));
      
      // Draw on new page
      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, newX, newY, photoWidth, photoHeight);
    } else {
      // Draw on current page
      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, x, y, photoWidth, photoHeight);
    }

    // Move to next position
    currentCol++;
    if (currentCol >= photosPerRow) {
      currentCol = 0;
      currentRow++;
    }
  }
}

/**
 * Draw individual worker card with photo and name
 */
async function drawWorkerCard(
  page: any,
  doc: PDFDocument,
  font: PDFFont,
  boldFont: PDFFont,
  worker: { worker_name: string; worker_photo?: string | null },
  x: number,
  y: number,
  photoWidth: number,
  photoHeight: number
) {
  // Draw photo frame
  page.drawRectangle({
    x: x,
    y: y - photoHeight,
    width: photoWidth,
    height: photoHeight,
    borderColor: rgb(0.8, 0.8, 0.8),
    borderWidth: 1,
    color: rgb(0.98, 0.98, 0.98),
  });

  // Load and draw photo if available
  if (worker.worker_photo) {
    const photoImage = await loadWorkerPhoto(doc, worker.worker_photo);
    if (photoImage) {
      // Calculate dimensions to maintain aspect ratio
      const imgDims = photoImage.scale(1);
      const imgAspectRatio = imgDims.width / imgDims.height;
      const frameAspectRatio = photoWidth / photoHeight;
      
      let drawWidth = photoWidth - 10; // 5px padding on each side
      let drawHeight = photoHeight - 10;
      let drawX = x + 5;
      let drawY = y - photoHeight + 5;
      
      // Adjust dimensions to fit within frame while maintaining aspect ratio
      if (imgAspectRatio > frameAspectRatio) {
        // Image is wider, fit to width
        drawHeight = drawWidth / imgAspectRatio;
        drawY = y - (photoHeight + drawHeight) / 2;
      } else {
        // Image is taller, fit to height
        drawWidth = drawHeight * imgAspectRatio;
        drawX = x + (photoWidth - drawWidth) / 2;
      }
      
      page.drawImage(photoImage, {
        x: drawX,
        y: drawY,
        width: drawWidth,
        height: drawHeight,
      });
    } else {
      // Draw placeholder text if photo couldn't be loaded
      page.drawText("Foto tidak", { 
        x: x + photoWidth/2 - 25, 
        y: y - photoHeight/2 + 10, 
        size: 10, 
        font: font,
        color: rgb(0.6, 0.6, 0.6) 
      });
      page.drawText("tersedia", { 
        x: x + photoWidth/2 - 20, 
        y: y - photoHeight/2 - 5, 
        size: 10, 
        font: font,
        color: rgb(0.6, 0.6, 0.6) 
      });
    }
  } else {
    // Draw placeholder for no photo
    page.drawText("Tidak ada", { 
      x: x + photoWidth/2 - 25, 
      y: y - photoHeight/2 + 10, 
      size: 10, 
      font: font,
      color: rgb(0.6, 0.6, 0.6) 
    });
    page.drawText("foto", { 
      x: x + photoWidth/2 - 10, 
      y: y - photoHeight/2 - 5, 
      size: 10, 
      font: font,
      color: rgb(0.6, 0.6, 0.6) 
    });
  }

  // Draw worker name below photo with reduced spacing
  const nameY = y - photoHeight - 15; // Reduced from 15 to 8
  const maxNameWidth = photoWidth - 4; // Leave 2px margin on each side
  let displayName = worker.worker_name;
  let textWidth = boldFont.widthOfTextAtSize(displayName, 9);
  
  // Truncate name if too long to fit in photo width
  if (textWidth > maxNameWidth) {
    while (textWidth > maxNameWidth && displayName.length > 0) {
      displayName = displayName.substring(0, displayName.length - 4) + '...';
      textWidth = boldFont.widthOfTextAtSize(displayName, 9);
    }
  }
  
  const nameX = x + (photoWidth - textWidth) / 2; // Center the name
  
  page.drawText(displayName, { 
    x: nameX, 
    y: nameY, 
    size: 9, // Reduced font size from 10 to 9
    // font: boldFont,
    color: rgb(0, 0, 0)
  });
}


=== FILE: tsconfig.json ===
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "baseUrl": ".",
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/types/*": ["./src/types/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/server/*": ["./src/server/*"]
    },
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules", "dist", ".next", "coverage"]
}

