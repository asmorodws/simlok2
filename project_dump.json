{
  "root": "src",
  "children": [
    {
      "type": "directory",
      "name": "app",
      "children": [
        {
          "type": "directory",
          "name": "(auth)",
          "children": [
            {
              "type": "directory",
              "name": "login",
              "children": [
                {
                  "type": "file",
                  "name": "metadata.ts",
                  "content": "import { Metadata } from \"next\";\n\nexport const metadata: Metadata = {\n  title: \"Masuk - SIMLOK\",\n  description: \"Halaman masuk ke sistem SIMLOK\",\n};"
                },
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "\"use client\";\n\nimport { signIn } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport AuthRedirect from \"@/components/auth/AuthRedirect\";\nimport SignInForm from \"@/components/auth/SignInForm\";\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShow] = useState(false);\n  const [error, setError] = useState(\"\");\n  const router = useRouter();\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(\"\");\n\n    const res = await signIn(\"credentials\", {\n      redirect: false,\n      email,\n      password,\n    });\n\n    if (res?.error) {\n      // Convert NextAuth error codes to user-friendly messages\n      switch (res.error) {\n        case \"CredentialsSignin\":\n          setError(\"Email atau password salah\");\n          break;\n        case \"ACCOUNT_REJECTED\":\n          setError(\"Akun Anda telah ditolak oleh administrator. Silakan hubungi admin untuk informasi lebih lanjut.\");\n          break;\n        case \"Configuration\":\n          setError(\"Terjadi kesalahan konfigurasi sistem\");\n          break;\n        case \"AccessDenied\":\n          setError(\"Akses ditolak\");\n          break;\n        case \"Verification\":\n          setError(\"Token verifikasi tidak valid\");\n          break;\n        default:\n          setError(\"Terjadi kesalahan saat login. Silakan coba lagi.\");\n          break;\n      }\n    } else {\n      router.push(\"/\");\n    }\n  }\n\n  return (\n    <AuthRedirect>\n      <SignInForm\n        email={email}\n        password={password}\n        showPassword={showPassword}\n        error={error}\n        setEmail={setEmail}\n        setPassword={setPassword}\n        setShow={setShow}\n        handleSubmit={handleSubmit}\n      />\n    </AuthRedirect>\n  );\n}"
                }
              ]
            },
            {
              "type": "directory",
              "name": "signup",
              "children": [
                {
                  "type": "file",
                  "name": "metadata.ts",
                  "content": "import { Metadata } from \"next\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar - SIMLOK\",\n  description: \"Halaman pendaftaran akun baru untuk sistem SIMLOK\",\n};"
                },
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "// src/app/(auth)/signup/page.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport AuthRedirect from \"@/components/auth/AuthRedirect\";\nimport SignUpForm from \"@/components/auth/SignUpForm\";\nimport { getCsrfToken } from \"next-auth/react\";\n\nexport default function SignupPage() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [nama_petugas, setNamaPetugas] = useState(\"\");\n  const [nama_vendor, setNamaVendor] = useState(\"\");\n  const [alamat, setAlamat] = useState(\"\");\n  const [no_telp, setNoTelp] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [agreed, setAgreed] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const router = useRouter();\n\n  const validateForm = () => {\n    if (!nama_petugas.trim()) {\n      setError(\"Nama petugas harus diisi\");\n      return false;\n    }\n    if (!email.trim()) {\n      setError(\"Email harus diisi\");\n      return false;\n    }\n    if (!no_telp.trim()) {\n      setError(\"Nomor telepon harus diisi\");\n      return false;\n    }\n    if (!alamat.trim()) {\n      setError(\"Alamat harus diisi\");\n      return false;\n    }\n    if (!nama_vendor.trim()) {\n      setError(\"Nama vendor harus diisi\");\n      return false;\n    }\n    if (password.length < 8) {\n      setError(\"Password minimal 8 karakter\");\n      return false;\n    }\n    if (password !== confirmPassword) {\n      setError(\"Password dan konfirmasi password tidak sama\");\n      return false;\n    }\n    if (!agreed) {\n      setError(\"Anda harus menyetujui syarat dan ketentuan\");\n      return false;\n    }\n    return true;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const csrf = await getCsrfToken();\n      \n      const res = await fetch(\"/api/auth/signup\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          csrfToken: csrf,\n          officer_name: nama_petugas.trim(),\n          email: email.trim().toLowerCase(),\n          password,\n          vendor_name: nama_vendor.trim(),\n          address: alamat.trim(),\n          phone_number: no_telp.trim(),\n        }),\n      });\n\n      const data = await res.json();\n      \n      if (!res.ok) {\n        setError(data.error || \"Terjadi kesalahan saat mendaftar\");\n      } else {\n        // Registration successful - redirect to verification pending page\n        router.push(\"/verification-pending\");\n      }\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      setError(\"Terjadi kesalahan jaringan. Silakan coba lagi.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthRedirect>\n      <SignUpForm\n        email={email}\n        password={password}\n        confirmPassword={confirmPassword}\n        nama_petugas={nama_petugas}\n        nama_vendor={nama_vendor}\n        alamat={alamat}\n        no_telp={no_telp}\n        showPassword={showPassword}\n        showConfirmPassword={showConfirmPassword}\n        agreeToTerms={agreed}\n        error={error}\n        isLoading={isLoading}\n        setEmail={setEmail}\n        setPassword={setPassword}\n        setConfirmPassword={setConfirmPassword}\n        setNamaPetugas={setNamaPetugas}\n        setNamaVendor={setNamaVendor}\n        setAlamat={setAlamat}\n        setNoTelp={setNoTelp}\n        setShowPassword={setShowPassword}\n        setShowConfirmPassword={setShowConfirmPassword}\n        setAgree={setAgreed}\n        handleSubmit={handleSubmit}\n      />\n    </AuthRedirect>\n  );\n}"
                }
              ]
            },
            {
              "type": "directory",
              "name": "verification-pending",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "'use client';\n\nimport { useSession, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport { \n  ClockIcon, \n  ExclamationTriangleIcon, \n  UserIcon,\n  CheckCircleIcon,\n  ArrowRightIcon,\n  ShieldCheckIcon\n} from '@heroicons/react/24/outline';\nimport PageLoader from '@/components/ui/PageLoader';\n\nexport default function VerificationPendingPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [countdown, setCountdown] = useState(15);\n  const [autoRedirect, setAutoRedirect] = useState(true);\n\n  // Auto redirect to login after 15 seconds if not logged in\n  useEffect(() => {\n    if (status === 'unauthenticated' && autoRedirect && countdown > 0) {\n      const timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    } else if (status === 'unauthenticated' && autoRedirect && countdown === 0) {\n      router.push(\"/login\");\n    }\n    return undefined;\n  }, [countdown, autoRedirect, router, status]);\n\n  useEffect(() => {\n    // Redirect jika user sudah terverifikasi\n    if (session?.user?.verified_at) {\n      const role = session.user.role;\n if (role === \"VENDOR\") {\n        router.push(\"/vendor\");\n      } else if (role === \"VERIFIER\") {\n        router.push(\"/verifier\");\n      } else {\n        router.push('/dashboard');\n      }\n    }\n  }, [session, router]);\n\n  if (status === 'loading') {\n    return <PageLoader message=\"Memeriksa status verifikasi...\" />;\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const formatTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString('id-ID', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleLogout = async () => {\n    await signOut({ callbackUrl: '/login' });\n  };\n\n  const handleStopAutoRedirect = () => {\n    setAutoRedirect(false);\n  };\n\n  // If user is not logged in (just registered), show simplified version\n  if (status === 'unauthenticated') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md\">\n          <Card className=\"p-8 text-center shadow-xl\">\n            <div className=\"mb-6\">\n              <div className=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n                <ClockIcon className=\"w-8 h-8 text-orange-600\" />\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Pendaftaran Berhasil!\n              </h1>\n              <p className=\"text-gray-600\">\n                Akun vendor Anda telah berhasil dibuat\n              </p>\n            </div>\n\n            <div className=\"space-y-6\">\n              {/* Status Steps */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center text-left bg-green-50 p-4 rounded-lg\">\n                  <CheckCircleIcon className=\"w-6 h-6 text-green-500 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-green-800\">Pendaftaran Selesai</p>\n                    <p className=\"text-sm text-green-600\">Data vendor telah tersimpan</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center text-left bg-orange-50 p-4 rounded-lg\">\n                  <ClockIcon className=\"w-6 h-6 text-orange-500 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-orange-800\">Menunggu Verifikasi</p>\n                    <p className=\"text-sm text-orange-600\">Admin sedang meninjau akun Anda</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center text-left bg-gray-50 p-4 rounded-lg\">\n                  <ShieldCheckIcon className=\"w-6 h-6 text-gray-400 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-gray-500\">Akun Aktif</p>\n                    <p className=\"text-sm text-gray-400\">Setelah verifikasi selesai</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Information Box */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start\">\n                  <ExclamationTriangleIcon className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5 mr-3\" />\n                  <div className=\"text-left\">\n                    <h3 className=\"font-medium text-blue-900 mb-2\">Langkah Selanjutnya:</h3>\n                    <ul className=\"text-sm text-blue-800 space-y-1\">\n                      <li>• Admin akan meninjau data pendaftaran Anda</li>\n                      <li>• Proses verifikasi membutuhkan waktu 1-2 hari kerja</li>\n                      <li>• Anda akan menerima notifikasi setelah akun diverifikasi</li>\n                      <li>• Setelah diverifikasi, Anda dapat mengakses dashboard vendor</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"space-y-3\">\n                <Button\n                  onClick={() => router.push(\"/login\")}\n                  className=\"w-full\" \n                  size=\"md\"\n                >\n                  <ArrowRightIcon className=\"w-4 h-4 mr-2\" />\n                  Lanjut ke Halaman Login\n                </Button>\n                \n                {autoRedirect && (\n                  <button\n                    onClick={handleStopAutoRedirect}\n                    className=\"text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n                  >\n                    Auto redirect dalam {countdown} detik\n                    <br />\n                    <span className=\"underline\">Klik untuk membatalkan</span>\n                  </button>\n                )}\n              </div>\n\n              {/* Contact Information */}\n              <div className=\"pt-4 border-t border-gray-200\">\n                <p className=\"text-xs text-gray-500 mb-2\">\n                  Butuh bantuan?\n                </p>\n                <p className=\"text-xs text-gray-600\">\n                  Hubungi admin di{\" \"}\n                  <a href=\"mailto:admin@simlok.com\" className=\"text-blue-600 hover:text-blue-700\">\n                    admin@simlok.com\n                  </a>\n                  <br />\n                  atau telepon{\" \"}\n                  <a href=\"tel:+6281234567890\" className=\"text-blue-600 hover:text-blue-700\">\n                    +62 812-3456-7890\n                  </a>\n                </p>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // If user is logged in but not verified, show detailed version\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-lg\">\n        <Card className=\"p-8\">\n          {/* Icon and Status */}\n          <div className=\"flex flex-col items-center mb-8\">\n            <div className=\"w-20 h-20 bg-warning-100 rounded-full flex items-center justify-center mb-6\">\n              <ClockIcon className=\"w-10 h-10 text-warning-500\" />\n            </div>\n            \n            {/* Title */}\n            <h1 className=\"text-2xl font-semibold text-gray-900 mb-3 text-center\">\n              Menunggu Verifikasi\n            </h1>\n            \n            {/* Subtitle */}\n            <p className=\"text-gray-600 text-center mb-6\">\n              Akun Anda sedang dalam proses verifikasi oleh administrator\n            </p>\n          </div>\n\n          {/* User Info Card */}\n          <Card className=\"bg-gray-50 p-6 mb-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <UserIcon className=\"w-6 h-6 text-brand-500\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-medium text-gray-900 mb-2\">\n                  Informasi Akun\n                </h3>\n                <div className=\"space-y-2 text-sm text-gray-600\">\n                  <div className=\"flex justify-between\">\n                    <span>Email:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.email}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Nama:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.officer_name || session?.user?.name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Vendor:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.vendor_name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Role:</span>\n                    <span className=\"font-medium text-gray-900 capitalize\">\n                      {session?.user?.role?.toLowerCase()}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Tanggal Daftar:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.created_at ? \n                        formatDate(session.user.created_at.toString()) : \n                        'N/A'\n                      }\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Waktu:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.created_at ? \n                        formatTime(session.user.created_at.toString()) : \n                        'N/A'\n                      }\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          {/* Info Alert */}\n          <div className=\"flex gap-3 p-4 bg-blue-light-50 border border-blue-light-200 rounded-xl mb-8\">\n            <ExclamationTriangleIcon className=\"w-5 h-5 text-blue-light-500 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm\">\n              <p className=\"text-blue-light-800 font-medium mb-1\">\n                Proses Verifikasi\n              </p>\n              <p className=\"text-blue-light-700\">\n                Administrator akan memverifikasi akun Anda dalam waktu 1-2 hari kerja. \n                Anda akan menerima notifikasi email setelah akun diverifikasi.\n              </p>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex flex-col gap-3\">\n            <Button \n              onClick={handleLogout}\n              variant=\"primary\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              Keluar\n            </Button>\n            \n            <Button \n              onClick={() => window.location.reload()}\n              variant=\"outline\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              Refresh Status\n            </Button>\n          </div>\n\n          {/* Footer Info */}\n          <div className=\"mt-8 pt-6 border-t border-gray-200\">\n            <p className=\"text-xs text-gray-500 text-center\">\n              Butuh bantuan? Hubungi administrator melalui email atau sistem support.\n            </p>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "verification-rejected",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "'use client';\n\nimport { useSession, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport { \n  XCircleIcon, \n  ExclamationTriangleIcon, \n  UserIcon,\n  ArrowRightIcon,\n  PhoneIcon,\n  EnvelopeIcon\n} from '@heroicons/react/24/outline';\nimport PageLoader from '@/components/ui/PageLoader';\n\nexport default function VerificationRejectedPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [countdown, setCountdown] = useState(15);\n  const [autoRedirect, setAutoRedirect] = useState(true);\n\n  // Auto redirect to login after 15 seconds if not logged in\n  useEffect(() => {\n    if (status === 'unauthenticated' && autoRedirect && countdown > 0) {\n      const timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    } else if (status === 'unauthenticated' && autoRedirect && countdown === 0) {\n      router.push(\"/login\");\n    }\n    return undefined;\n  }, [countdown, autoRedirect, router, status]);\n\n  useEffect(() => {\n    // Redirect jika user sudah terverifikasi\n    if (session?.user?.verified_at) {\n      const role = session.user.role;\n if (role === \"VENDOR\") {\n        router.push(\"/vendor\");\n      } else if (role === \"VERIFIER\") {\n        router.push(\"/verifier\");\n      } else {\n        router.push('/dashboard');\n      }\n    }\n  }, [session, router]);\n\n  if (status === 'loading') {\n    return <PageLoader message=\"Memeriksa status verifikasi...\" />;\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const handleLogout = async () => {\n    await signOut({ callbackUrl: '/login' });\n  };\n\n  const handleStopAutoRedirect = () => {\n    setAutoRedirect(false);\n  };\n\n  // If user is not logged in, redirect to login\n  if (status === 'unauthenticated') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-red-50 to-pink-100 flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md\">\n          <Card className=\"p-8 text-center shadow-xl\">\n            <div className=\"mb-6\">\n              <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\n                <XCircleIcon className=\"w-8 h-8 text-red-600\" />\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Akun Ditolak\n              </h1>\n              <p className=\"text-gray-600\">\n                Verifikasi akun vendor Anda telah ditolak\n              </p>\n            </div>\n\n            <div className=\"space-y-6\">\n              {/* Information Box */}\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                <div className=\"flex items-start\">\n                  <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5 mr-3\" />\n                  <div className=\"text-left\">\n                    <h3 className=\"font-medium text-red-900 mb-2\">Alasan Penolakan:</h3>\n                    <p className=\"text-sm text-red-800\">\n                      Mohon hubungi administrator untuk informasi lebih lanjut mengenai penolakan akun Anda.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"space-y-3\">\n                <Button\n                  onClick={() => router.push(\"/login\")}\n                  className=\"w-full\" \n                  size=\"md\"\n                >\n                  <ArrowRightIcon className=\"w-4 h-4 mr-2\" />\n                  Kembali ke Login\n                </Button>\n                \n                {autoRedirect && (\n                  <button\n                    onClick={handleStopAutoRedirect}\n                    className=\"text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n                  >\n                    Auto redirect dalam {countdown} detik\n                    <br />\n                    <span className=\"underline\">Klik untuk membatalkan</span>\n                  </button>\n                )}\n              </div>\n\n              {/* Contact Information */}\n              <div className=\"pt-4 border-t border-gray-200\">\n                <p className=\"text-xs text-gray-500 mb-2\">\n                  Butuh bantuan?\n                </p>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-center text-xs text-gray-600\">\n                    <EnvelopeIcon className=\"w-4 h-4 mr-2\" />\n                    <a href=\"mailto:admin@simlok.com\" className=\"text-blue-600 hover:text-blue-700\">\n                      admin@simlok.com\n                    </a>\n                  </div>\n                  <div className=\"flex items-center justify-center text-xs text-gray-600\">\n                    <PhoneIcon className=\"w-4 h-4 mr-2\" />\n                    <a href=\"tel:+6281234567890\" className=\"text-blue-600 hover:text-blue-700\">\n                      +62 812-3456-7890\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // If user is logged in and rejected, show detailed version\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-lg\">\n        <Card className=\"p-8\">\n          {/* Icon and Status */}\n          <div className=\"flex flex-col items-center mb-8\">\n            <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6\">\n              <XCircleIcon className=\"w-10 h-10 text-red-500\" />\n            </div>\n            \n            {/* Title */}\n            <h1 className=\"text-2xl font-semibold text-gray-900 mb-3 text-center\">\n              Verifikasi Ditolak\n            </h1>\n            \n            {/* Subtitle */}\n            <p className=\"text-gray-600 text-center mb-6\">\n              Maaf, akun vendor Anda tidak dapat diverifikasi oleh administrator\n            </p>\n          </div>\n\n          {/* User Info Card */}\n          <Card className=\"bg-gray-50 p-6 mb-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <UserIcon className=\"w-6 h-6 text-red-500\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-medium text-gray-900 mb-2\">\n                  Informasi Akun\n                </h3>\n                <div className=\"space-y-2 text-sm text-gray-600\">\n                  <div className=\"flex justify-between\">\n                    <span>Email:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.email}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Nama:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.officer_name || session?.user?.name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Vendor:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.vendor_name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Status:</span>\n                    <span className=\"font-medium text-red-600\">\n                      Ditolak\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Tanggal Daftar:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.created_at ? \n                        formatDate(session.user.created_at.toString()) : \n                        'N/A'\n                      }\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          {/* Rejection Info Alert */}\n          <div className=\"flex gap-3 p-4 bg-red-50 border border-red-200 rounded-xl mb-8\">\n            <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm\">\n              <p className=\"text-red-800 font-medium mb-1\">\n                Akun Tidak Dapat Diverifikasi\n              </p>\n              <p className=\"text-red-700 mb-3\">\n                Administrator telah meninjau data akun Anda dan memutuskan untuk tidak memverifikasi akun ini.\n              </p>\n              <p className=\"text-red-700\">\n                Untuk informasi lebih lanjut mengenai alasan penolakan dan kemungkinan pengajuan ulang, \n                silakan hubungi administrator melalui kontak yang tersedia di bawah.\n              </p>\n            </div>\n          </div>\n\n          {/* Contact Information */}\n          <Card className=\"bg-blue-50 p-6 mb-6\">\n            <h3 className=\"font-medium text-blue-900 mb-3 text-center\">\n              Hubungi Administrator\n            </h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-center\">\n                <EnvelopeIcon className=\"w-5 h-5 text-blue-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-blue-800 font-medium\">Email</p>\n                  <a \n                    href=\"mailto:admin@simlok.com\" \n                    className=\"text-sm text-blue-600 hover:text-blue-700 underline\"\n                  >\n                    admin@simlok.com\n                  </a>\n                </div>\n              </div>\n              <div className=\"flex items-center justify-center\">\n                <PhoneIcon className=\"w-5 h-5 text-blue-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-blue-800 font-medium\">Telepon</p>\n                  <a \n                    href=\"tel:+6281234567890\" \n                    className=\"text-sm text-blue-600 hover:text-blue-700 underline\"\n                  >\n                    +62 812-3456-7890\n                  </a>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          {/* Action Buttons */}\n          <div className=\"flex flex-col gap-3\">\n            <Button \n              onClick={handleLogout}\n              variant=\"primary\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              Keluar\n            </Button>\n            \n            <Button \n              onClick={() => window.location.href = 'mailto:admin@simlok.com?subject=Pertanyaan Mengenai Penolakan Akun Vendor&body=Halo Admin,%0A%0ASaya ingin menanyakan mengenai penolakan verifikasi akun vendor saya.%0A%0AEmail: ' + session?.user?.email + '%0ANama: ' + (session?.user?.officer_name || '') + '%0APerusahaan: ' + (session?.user?.vendor_name || '') + '%0A%0AMohon penjelasan mengenai alasan penolakan dan apakah ada kemungkinan untuk pengajuan ulang.%0A%0ATerima kasih.'}\n              variant=\"outline\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              <EnvelopeIcon className=\"w-4 h-4 mr-2\" />\n              Kirim Email ke Admin\n            </Button>\n          </div>\n\n          {/* Footer Info */}\n          <div className=\"mt-8 pt-6 border-t border-gray-200\">\n            <p className=\"text-xs text-gray-500 text-center\">\n              Untuk pengajuan akun baru, silakan hubungi administrator terlebih dahulu.\n            </p>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}"
                }
              ]
            }
          ]
        },
        {
          "type": "directory",
          "name": "(dashboard)",
          "children": [
            {
              "type": "directory",
              "name": "approver",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverDashboard from \"@/components/approver/ApproverDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Approver - SIMLOK\",\n  description: \"Halaman dashboard untuk approver mengelola persetujuan pengajuan Simlok\",\n};\n\nexport default function ApproverPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\" , \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Dashboard Persetujuan\">\n        <ApproverDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                },
                {
                  "type": "directory",
                  "name": "scan-history",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from 'next';\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverScanHistoryContent from '@/components/approver/ApproverScanHistoryContent';\n\nexport const metadata: Metadata = {\n  title: 'Scan History - Approver Dashboard',\n  description: 'Monitor submission scan activities by verifiers',\n};\n\nexport default function ApproverScanHistoryPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Scan History\">\n        <ApproverScanHistoryContent />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "submissions",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverSubmissionsManagement from \"@/components/approver/ApproverSubmissionsManagement\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - Approver SIMLOK\",\n  description: \"Halaman untuk approver melihat dan menyetujui pengajuan Simlok\",\n};\n\nexport default function ApproverSubmissionsPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Daftar Pengajuan\">\n        <ApproverSubmissionsManagement />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "dashboard",
              "children": [
                {
                  "type": "directory",
                  "name": "notifications",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useToast } from '@/hooks/useToast';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport RoleGate from '@/components/security/RoleGate';\nimport {\n  BellIcon,\n  CheckIcon,\n  CheckCircleIcon,\n  ClockIcon,\n  DocumentPlusIcon,\n  UserPlusIcon,\n  ShieldCheckIcon,\n  MagnifyingGlassIcon,\n  InboxIcon,\n  XMarkIcon,\n  ArrowRightIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport PageLoader from '@/components/ui/PageLoader';\nimport SubmissionDetailModal from '@/components/vendor/SubmissionDetailModal';\nimport { fetchJSON } from '@/lib/fetchJson';\n\n// ---- Types ----\ninterface Notification {\n  id: string;\n  type: string;\n  title: string;\n  message: string;\n  data?: any;\n  isRead: boolean;\n  createdAt: string;\n  scope: string;\n  vendorId?: string;\n}\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  implementation_notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approved_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\ntype NotifListResponse = {\n  success: boolean;\n  data: {\n    data: Notification[];\n    pagination?: any;\n  };\n};\n\n// ---- anti-race util ----\nfunction useVersion() {\n  const v = useRef(0);\n  const bump = () => ++v.current;\n  const isStale = (snapshot: number) => snapshot !== v.current;\n  return { current: () => v.current, bump, isStale };\n}\n\nexport default function NotificationsPage() {\n  const { data: session, status } = useSession();\n  const { showError } = useToast();\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [filter, setFilter] = useState<'all' | 'unread' | 'read'>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n  const version = useVersion();\n\n  const refetch = async (scope: string) => {\n    const snap = version.current();\n    setLoading(true);\n    try {\n      const res = await fetchJSON<NotifListResponse>(`/api/v1/notifications?scope=${scope}&filter=all&pageSize=100`);\n      if (version.isStale(snap)) return;\n      setNotifications(res?.data?.data ?? []);\n    } catch (e) {\n      console.error('Refetch notifications error:', e);\n    } finally {\n      if (!version.isStale(snap)) setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const run = async () => {\n      if (!session?.user?.id) return;\n      let scope = session.user.role.toLowerCase();\n      if (session.user.role === 'SUPER_ADMIN') scope = 'admin';\n      version.bump();\n      await refetch(scope);\n    };\n    if (status === 'authenticated') run();\n  }, [session?.user?.id, session?.user?.role, status]);\n\n  const unreadCount = Array.isArray(notifications) ? notifications.filter(n => !n.isRead).length : 0;\n\n  const [markingAsRead, setMarkingAsRead] = useState(new Set<string>());\n\n  const markAsRead = async (notificationId: string) => {\n    if (markingAsRead.has(notificationId)) return;\n    const notification = notifications.find(n => n.id === notificationId);\n    if (notification?.isRead) return;\n\n    try {\n      setMarkingAsRead(prev => new Set([...prev, notificationId]));\n      setNotifications(prev => prev.map(n => (n.id === notificationId ? { ...n, isRead: true } : n)));\n      await fetchJSON(`/api/v1/notifications/${notificationId}/read`, { method: 'POST' });\n    } catch (error) {\n      console.error('Error marking as read:', error);\n      setNotifications(prev => prev.map(n => (n.id === notificationId ? { ...n, isRead: false } : n)));\n      showError('Gagal', 'Tidak dapat menandai notifikasi sebagai dibaca');\n    } finally {\n      setMarkingAsRead(prev => {\n        const s = new Set(prev);\n        s.delete(notificationId);\n        return s;\n      });\n    }\n  };\n\n  const markAllAsRead = async () => {\n    setNotifications(prev => prev.map(n => ({ ...n, isRead: true })));\n    try {\n      const scopeBody = session?.user?.role;\n      await fetchJSON('/api/v1/notifications/read-all', {\n        method: 'POST',\n        body: JSON.stringify({ scope: scopeBody }),\n      });\n      let scope = session?.user?.role?.toLowerCase() || 'vendor';\n      if (session?.user?.role === 'SUPER_ADMIN') scope = 'admin';\n      version.bump();\n      setTimeout(() => refetch(scope), 300);\n    } catch (error) {\n      console.error('Error mark all read:', error);\n      showError('Gagal', 'Tidak dapat menandai semua notifikasi sebagai dibaca');\n      let scope = session?.user?.role?.toLowerCase() || 'vendor';\n      if (session?.user?.role === 'SUPER_ADMIN') scope = 'admin';\n      version.bump();\n      refetch(scope);\n    }\n  };\n\n  // ---- UI helpers ----\n  const formatTimeAgo = (dateString: string): string => {\n    if (!dateString) return 'Tidak diketahui';\n    const date = new Date(dateString);\n    if (isNaN(date.getTime())) return 'Tanggal tidak valid';\n    const now = new Date();\n    const diff = Math.floor((now.getTime() - date.getTime()) / 1000);\n    if (diff < 60) return 'Baru saja';\n    if (diff < 3600) return `${Math.floor(diff / 60)} menit yang lalu`;\n    if (diff < 86400) return `${Math.floor(diff / 3600)} jam yang lalu`;\n    if (diff < 604800) return `${Math.floor(diff / 86400)} hari yang lalu`;\n    return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });\n  };\n\n  const getNotificationIcon = (type: string) => {\n    const iconClass = 'w-5 h-5';\n    switch (type) {\n      case 'submission_approved': return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'submission_rejected': return <XMarkIcon className={`${iconClass} text-red-600`} />;\n      case 'submission_pending': return <ClockIcon className={`${iconClass} text-amber-600`} />;\n      case 'status_change': return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_submission': return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_vendor': return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'vendor_verified': return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'user_registered': return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      default: return <BellIcon className={`${iconClass} text-gray-600`} />;\n    }\n  };\n\n  const submissionTypes = ['submission_approved','submission_rejected','submission_pending','new_submission','status_change'];\n  const vendorTypes = ['user_registered', 'new_vendor', 'new_user_verification', 'vendor_verified', 'vendor_registered'];\n\n  const hasSubmissionData = (n: Notification) => {\n    if (submissionTypes.includes(n.type)) return true;\n    if (n.data) {\n      try {\n        const parsed = typeof n.data === 'string' ? JSON.parse(n.data) : n.data;\n        if (parsed?.submissionId || parsed?.submission_id) return true;\n      } catch {\n        if (typeof n.data === 'string' && n.data.includes('submissionId')) return true;\n      }\n    }\n    const text = `${n.title} ${n.message}`.toLowerCase();\n    return ['pengajuan','submission','simlok'].some(k => text.includes(k));\n  };\n\n  const hasVendorData = (n: Notification) => {\n    if (vendorTypes.includes(n.type)) return true;\n    if (n.data) {\n      try {\n        const parsed = typeof n.data === 'string' ? JSON.parse(n.data) : n.data;\n        if (parsed?.vendorId || parsed?.userId) return true;\n      } catch {\n        if (typeof n.data === 'string' && n.data.includes('vendorId')) return true;\n      }\n    }\n    const text = `${n.title} ${n.message}`.toLowerCase();\n    return ['pendaftaran vendor','vendor baru mendaftar','verifikasi vendor'].some(k => text.includes(k));\n  };\n\n  const handleViewDetail = async (n: Notification) => {\n    if (!n.isRead) await markAsRead(n.id);\n\n    if (hasVendorData(n)) {\n      showError('Info', 'Detail vendor tidak tersedia di halaman ini. Gunakan panel notifikasi untuk detail vendor.');\n      return;\n    }\n\n    if (hasSubmissionData(n)) {\n      try {\n        let submissionId = '';\n        if (n.data) {\n          try {\n            const parsed = typeof n.data === 'string' ? JSON.parse(n.data) : n.data;\n            submissionId = parsed?.submissionId || parsed?.submission_id || '';\n          } catch {\n            if (typeof n.data === 'string') {\n              const m = n.data.match(/submissionId[:\\s]*([a-zA-Z0-9_-]+)/);\n              if (m?.[1]) submissionId = m[1];\n            }\n          }\n        }\n        if (!submissionId) {\n          const patterns = [\n            /ID[:\\s]*([a-zA-Z0-9_-]+)/,\n            /submission[:\\s]*([a-zA-Z0-9_-]+)/i,\n            /pengajuan[:\\s]*([a-zA-Z0-9_-]+)/i,\n            /([a-zA-Z0-9_-]{20,})/\n          ];\n          for (const p of patterns) {\n            const m1 = n.message.match(p);\n            const m2 = n.title.match(p);\n            if (m1?.[1]) { submissionId = m1[1]; break; }\n            if (m2?.[1]) { submissionId = m2[1]; break; }\n          }\n        }\n        if (!submissionId) {\n          showError('Error', 'ID submission tidak ditemukan dalam notifikasi ini');\n          return;\n        }\n        const submission = await fetchJSON<Submission>(`/api/submissions/${submissionId}`);\n        setSelectedSubmission(submission);\n      } catch (error) {\n        console.error('Error loading submission detail:', error);\n        showError('Error', 'Terjadi kesalahan saat memuat detail submission');\n      }\n      return;\n    }\n\n    showError('Info', 'Notifikasi ini tidak memiliki detail khusus untuk ditampilkan');\n  };\n\n  const truncateText = (text: string, maxLength = 100) =>\n    text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n\n  const filteredNotifications = Array.isArray(notifications)\n    ? notifications\n        .filter(n => (filter === 'unread' ? !n.isRead : filter === 'read' ? n.isRead : true))\n        .filter(n =>\n          !searchTerm\n            ? true\n            : n.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n              n.message.toLowerCase().includes(searchTerm.toLowerCase())\n        )\n    : [];\n\n  if (status === 'loading') {\n    return (\n      <SidebarLayout title=\"Notifikasi\" titlePage=\"Memuat...\">\n        <div className=\"max-w-5xl mx-auto px-3 md:px-6\">\n          <PageLoader message=\"Memuat notifikasi...\" fullScreen={false} />\n        </div>\n      </SidebarLayout>\n    );\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"SUPER_ADMIN\", \"VENDOR\", \"APPROVER\", \"REVIEWER\"]}>\n      <SidebarLayout title=\"Notifikasi\" titlePage=\"Semua Notifikasi\">\n        <div className=\"max-w-5xl mx-auto space-y-4 md:space-y-6 px-3 md:px-6\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between rounded-xl border bg-white p-3 md:p-4 shadow-sm\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"relative\">\n                <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <BellIcon className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                {unreadCount > 0 && (\n                  <div className=\"absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5\">\n                    {unreadCount > 99 ? '99+' : unreadCount}\n                  </div>\n                )}\n              </div>\n              <div>\n                <h1 className=\"text-base md:text-lg font-semibold text-gray-900\">Notifikasi</h1>\n                <p className=\"text-sm text-gray-500\">\n                  {loading ? 'Memuat...' : unreadCount > 0 ? `${unreadCount} belum dibaca` : 'Semua sudah dibaca'}\n                </p>\n              </div>\n            </div>\n\n            {unreadCount > 0 && !loading && (\n              <Button\n                onClick={markAllAsRead}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"flex items-center space-x-2 hover:bg-blue-50 hover:border-blue-300 transition-colors\"\n                aria-label=\"Tandai semua notifikasi sebagai dibaca\"\n              >\n                <CheckIcon className=\"w-4 h-4\" />\n                <span className=\"hidden sm:inline\">Tandai semua dibaca</span>\n                <span className=\"sm:hidden\">Tandai semua</span>\n              </Button>\n            )}\n          </div>\n\n          {/* Toolbar */}\n          <div className=\"rounded-xl border bg-white p-3 md:p-4 shadow-sm\">\n            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-3\">\n              <div className=\"md:col-span-7\">\n                <div className=\"relative\">\n                  <MagnifyingGlassIcon className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Cari notifikasi…\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900 placeholder:text-gray-500\"\n                    aria-label=\"Cari notifikasi\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"md:col-span-5 flex gap-2 md:justify-end\">\n                <div className=\"flex rounded-lg border border-gray-300 bg-white p-1\">\n                  {(['all', 'unread', 'read'] as const).map((filterOption) => (\n                    <button\n                      key={filterOption}\n                      onClick={() => setFilter(filterOption)}\n                      className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${\n                        filter === filterOption ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:text-gray-900'\n                      }`}\n                    >\n                      {filterOption === 'all' && 'Semua'}\n                      {filterOption === 'unread' && 'Belum Dibaca'}\n                      {filterOption === 'read' && 'Sudah Dibaca'}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* List */}\n          <div className=\"rounded-xl border bg-white shadow-sm overflow-hidden\">\n            {filteredNotifications.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-16 px-6\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                  <InboxIcon className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  {searchTerm \n                    ? 'Tidak ada hasil' \n                    : filter === 'unread' \n                      ? 'Tidak ada notifikasi belum dibaca'\n                      : filter === 'read'\n                        ? 'Tidak ada notifikasi yang sudah dibaca'\n                        : 'Tidak ada notifikasi'\n                  }\n                </h3>\n                <p className=\"text-sm text-gray-500 text-center max-w-sm\">\n                  {searchTerm\n                    ? `Tidak ditemukan notifikasi yang cocok dengan \"${searchTerm}\"`\n                    : filter === 'unread'\n                      ? 'Semua notifikasi Anda sudah dibaca'\n                      : filter === 'read'\n                        ? 'Belum ada notifikasi yang dibaca'\n                        : 'Anda akan melihat notifikasi baru di sini ketika ada aktivitas'}\n                </p>\n                {!searchTerm && (\n                  <Button\n                    onClick={() => (window.location.href = '/dashboard')}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"mt-4\"\n                  >\n                    Kembali ke Dashboard\n                  </Button>\n                )}\n              </div>\n            ) : (\n              <div className=\"divide-y divide-gray-100\">\n                {filteredNotifications.map((n) => {\n                  const isUnread = !n.isRead;\n                  const fullTimestamp = new Date(n.createdAt).toLocaleString('id-ID');\n\n                  return (\n                    <div\n                      key={n.id}\n                      className={`relative flex items-start gap-3 p-3 md:p-4 transition-all duration-200 hover:bg-gray-50 focus-within:ring-2 focus-within:ring-blue-500/30\n                        border-l-4\n                        ${isUnread ? 'border-l-blue-600 bg-white' : 'border-l-transparent bg-white'}\n                        ${hasSubmissionData(n) || hasVendorData(n) ? 'cursor-pointer' : ''}\n                      `}\n                      onClick={() => handleViewDetail(n)}\n                      role=\"listitem\"\n                    >\n                      {/* HAPUS dot biru agar hanya strip kiri yang jadi indikator */}\n                      {/* <div className=\"absolute left-1 top-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-blue-600\" /> */}\n\n                      {/* Avatar ikon: selalu abu-abu */}\n                      <div className=\"shrink-0 h-9 w-9 rounded-full flex items-center justify-center ml-2 bg-gray-100\">\n                        {getNotificationIcon(n.type)}\n                      </div>\n\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1 min-w-0\">\n                            <h3\n                              className={`text-sm md:text-base leading-tight ${isUnread ? 'font-semibold text-gray-900' : 'font-medium text-gray-800'}`}\n                              style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}\n                            >\n                              {truncateText(n.title, 80)}\n                            </h3>\n                            <p\n                              className=\"mt-0.5 text-xs md:text-sm text-gray-600 leading-relaxed\"\n                              style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}\n                            >\n                              {truncateText(n.message, 120)}\n                            </p>\n                          </div>\n\n                          <span className=\"text-[11px] md:text-xs text-gray-500 whitespace-nowrap ml-3\" title={fullTimestamp}>\n                            {formatTimeAgo(n.createdAt)}\n                          </span>\n                        </div>\n\n                        {(hasSubmissionData(n) || hasVendorData(n)) && (\n                          <div className=\"mt-3 pt-3 border-t border-gray-100 flex items-center justify-between\">\n                            <button className=\"inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors\">\n                              Lihat detail\n                              <ArrowRightIcon className=\"w-3 h-3 ml-1\" />\n                            </button>\n\n                            {isUnread && (\n                              <button\n                                onClick={async (e) => {\n                                  e.preventDefault();\n                                  e.stopPropagation();\n                                  await markAsRead(n.id);\n                                }}\n                                className=\"inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors\"\n                                aria-label=\"Tandai sebagai dibaca\"\n                              >\n                                <CheckIcon className=\"w-3 h-3\" />\n                                <span className=\"ml-1 hidden sm:inline\">Tandai dibaca</span>\n                              </button>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n\n            {filteredNotifications.length > 0 && (\n              <div className=\"flex items-center justify-between text-sm text-gray-500 p-3 border-t border-gray-100 bg-gray-50/50\">\n                <span>\n                  Menampilkan {filteredNotifications.length} dari {Array.isArray(notifications) ? notifications.length : 0} notifikasi\n                  {filter !== 'all' && ` (filter: ${filter === 'unread' ? 'belum dibaca' : 'sudah dibaca'})`}\n                </span>\n                <span className=\"text-xs text-gray-400\">\n                  💡 Semua notifikasi tetap tersimpan\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {selectedSubmission && (\n          <SubmissionDetailModal\n            submission={selectedSubmission}\n            isOpen={!!selectedSubmission}\n            onClose={() => setSelectedSubmission(null)}\n          />\n        )}\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
                    }
                  ]
                },
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import { redirect } from \"next/navigation\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport default async function DashboardPage() {\n  const session = await getServerSession(authOptions);\n  if (!session) redirect(\"/login\");\n\n  const { role } = session.user;\n\n  // Redirect to appropriate role-specific dashboard\n  if (role === \"SUPER_ADMIN\") {\n    redirect(\"/super-admin\");\n  } else if (role === \"APPROVER\") {\n    redirect(\"/approver\");\n  } else if (role === \"REVIEWER\") {\n    redirect(\"/reviewer\");\n  } else if (role === \"VENDOR\") {\n    redirect(\"/vendor\");\n  } else if (role === \"VERIFIER\") {\n    redirect(\"/verifier\");\n  }\n\n  // Fallback\n  redirect(\"/login\");\n}"
                }
              ]
            },
            {
              "type": "directory",
              "name": "profile",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import UserInfoCard from \"@/components/user-profile/UserInfoCard\";\nimport ChangePasswordCard from \"@/components/user-profile/ChangePasswordCard\";\nimport { Metadata } from \"next\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { redirect } from \"next/navigation\";\n\nexport const metadata: Metadata = {\n  title: \"Ubah Profil - SIMLOK\",\n  description: \"Edit your profile information\",\n};\n\nexport default async function Profile() {\n  const session = await getServerSession(authOptions);\n  \n  if (!session) {\n    redirect('/login');\n  }\n\n  // Fetch complete user data\n  const user = await prisma.user.findUnique({\n    where: {\n      id: session.user.id\n    }\n  });\n\n  if (!user) {\n    redirect('/login');\n  }\n\n  return (\n    <SidebarLayout title=\"Dashboard\" titlePage=\"Ubah Profil\">\n      <div className=\"rounded-2xl border border-gray-200 bg-white p-5 lg:p-6\">\n        <div className=\"space-y-6\">\n          <UserInfoCard user={user} />\n          <ChangePasswordCard />\n        </div>\n      </div>\n    </SidebarLayout>\n  );\n}\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "reviewer",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerDashboard from \"@/components/reviewer/ReviewerDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Reviewer - SIMLOK\",\n  description: \"Halaman dashboard untuk reviewer mengelola review pengajuan Simlok\",\n};\n\nexport default function ReviewerPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\" , \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Dashboard Review\">\n        <ReviewerDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                },
                {
                  "type": "directory",
                  "name": "scan-history",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from 'next';\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerScanHistoryContent from '@/components/reviewer/ReviewerScanHistoryContent';\n\nexport const metadata: Metadata = {\n  title: 'Scan History - Reviewer Dashboard',\n  description: 'Monitor submission scan activities by verifiers',\n};\n\nexport default function ReviewerScanHistoryPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\" , \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Scan History\">\n        <ReviewerScanHistoryContent />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "submissions",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerSubmissionsManagement from \"@/components/reviewer/ReviewerSubmissionsManagement\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - Reviewer SIMLOK\",\n  description: \"Halaman untuk reviewer melihat dan mengelola pengajuan Simlok\",\n};\n\nexport default function ReviewerSubmissionsPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Daftar Pengajuan\">\n        <ReviewerSubmissionsManagement />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\n// Import role types\nimport { redirect } from \"next/navigation\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport UserVerificationManagement from \"@/components/reviewer/UserVerificationManagement\";\nimport PageLoader from \"@/components/ui/PageLoader\";\n\nexport default function UserVerificationPage() {\n  const { data: session, status } = useSession();\n  \n  // State untuk refresh tabel\n  const [refreshTrigger] = useState(0);\n\n  // Loading state\n  if (status === \"loading\") {\n    return <PageLoader message=\"Memuat halaman verifikasi user...\" fullScreen={false} />;\n  }\n\n  // Redirect if not authenticated or not authorized\n  if (!session || ![\"REVIEWER\", \"SUPER_ADMIN\"].includes(session.user.role)) {\n    redirect(\"/login\");\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Verifikasi User\">\n        <div className=\"space-y-6\">\n          {/* Header Section */}\n          <div className=\"bg-white shadow-sm rounded-xl border border-gray-200/70\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h1 className=\"text-xl font-semibold text-gray-900\">\n                    Verifikasi User\n                  </h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    Kelola dan verifikasi user vendor dalam sistem\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* User Verification Management Component */}\n            <div className=\"p-6\">\n              <UserVerificationManagement refreshTrigger={refreshTrigger} />\n            </div>\n          </div>\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "super-admin",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport Link from \"next/link\";\nimport { UserData } from \"@/types/user\";\nimport { UserIcon, CheckCircleIcon, ClockIcon, XCircleIcon } from \"@heroicons/react/24/outline\";\nimport ReviewerUserVerificationModal from \"@/components/reviewer/ReviewerUserVerificationModal\";\nimport EditUserModal from \"@/components/admin/EditUserModal\";\nimport DeleteUserModal from \"@/components/admin/DeleteUserModal\";\n\nexport default function SuperAdminDashboard() {\n  const [stats, setStats] = useState({\n    totalUsers: 0,\n    totalPending: 0,\n    totalVerified: 0,\n    totalRejected: 0,\n    todayRegistrations: 0,\n    pendingVerifications: 0, // Legacy compatibility\n    recentUsers: [] as UserData[]\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [showUserVerificationModal, setShowUserVerificationModal] = useState(false);\n  const [showEditUserModal, setShowEditUserModal] = useState(false);\n  const [showDeleteUserModal, setShowDeleteUserModal] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<UserData | null>(null);\n\n  // === Simple in-file button styles (tanpa komponen terpisah) ===\n  const btnBase =\n    \"inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed text-xs px-3 py-1.5\";\n  const btnDetail =\n    `${btnBase} text-blue-700 hover:bg-blue-50 focus-visible:ring-blue-400`;\n  const btnEdit =\n    `${btnBase} text-gray-800 bg-white border border-gray-300 hover:bg-gray-100 focus-visible:ring-gray-400`;\n  const btnHapus =\n    `${btnBase} text-white bg-red-600 hover:bg-red-700 focus-visible:ring-red-600`;\n\n  const fetchDashboardStats = async () => {\n    try {\n      setLoading(true);\n      setError('');\n      const response = await fetch('/api/admin/dashboard-stats', { cache: 'no-store' });\n      if (!response.ok) {\n        throw new Error('Failed to fetch dashboard statistics');\n      }\n      const data = await response.json();\n      setStats({\n        totalUsers: data.totalUsers,\n        totalPending: data.totalPending,\n        totalVerified: data.totalVerified,\n        totalRejected: data.totalRejected,\n        todayRegistrations: data.todayRegistrations,\n        pendingVerifications: data.pendingVerifications, // Legacy compatibility\n        recentUsers: data.recentUsers\n      });\n    } catch (err) {\n      console.error('Error fetching dashboard stats:', err);\n      setError('Gagal memuat statistik dashboard');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchDashboardStats();\n  }, []);\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  const handleUserUpdate = (updatedUser: UserData) => {\n    setStats(prev => ({\n      ...prev,\n      recentUsers: prev.recentUsers.map(user =>\n        user.id === updatedUser.id ? updatedUser : user\n      )\n    }));\n    fetchDashboardStats();\n  };\n\n  const handleUserDelete = (deletedUserId: string) => {\n    setStats(prev => ({\n      ...prev,\n      recentUsers: prev.recentUsers.filter(user => user.id !== deletedUserId)\n    }));\n    fetchDashboardStats();\n  };\n\n  return (\n    <RoleGate allowedRoles={[\"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Super Admin Panel\" titlePage=\"Dashboard\">\n        <div className=\"space-y-6\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">\n              Selamat Datang di Super Admin Dashboard\n            </h1>\n            <p className=\"text-gray-600 mt-2\">\n              Kelola seluruh user sistem SIMLOK dengan fitur CRUD lengkap.\n            </p>\n          </div>\n\n          {/* Statistik Dashboard */}\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Verifikasi</h3>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats.totalPending}</p>\n                  )}\n                </div>\n                <div className=\"p-3 bg-amber-100 rounded-full\">\n                  <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n                </div>\n              </div>\n              {stats.totalPending > 0 && !loading && (\n                <div className=\"mt-4\">\n                  <Link\n                    href=\"/super-admin/users?tab=pending\"\n                    className=\"text-sm text-amber-600 hover:text-amber-800 font-medium flex items-center\"\n                  >\n                    Verifikasi sekarang\n                    <svg className=\"ml-1 w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                    </svg>\n                  </Link>\n                </div>\n              )}\n            </div>\n\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-500\">Terverifikasi</h3>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.totalVerified}</p>\n                  )}\n                </div>\n                <div className=\"p-3 bg-green-100 rounded-full\">\n                  <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats.totalRejected}</p>\n                  )}\n                </div>\n                <div className=\"p-3 bg-red-100 rounded-full\">\n                  <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-500\">Total User</h3>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.totalUsers}</p>\n                  )}\n                </div>\n                <div className=\"p-3 bg-blue-100 rounded-full\">\n                  <UserIcon className=\"w-6 h-6 text-blue-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-gray-500\">Registrasi Hari Ini</h3>\n                  {loading ? (\n                    <div className=\"h-8 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats.todayRegistrations}</p>\n                  )}\n                </div>\n                <div className=\"p-3 bg-purple-100 rounded-full\">\n                  <UserIcon className=\"w-6 h-6 text-purple-600\" />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Tabel User Terbaru */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">User Terbaru</h2>\n              <p className=\"text-sm text-gray-600\">Daftar 5 user yang baru mendaftar</p>\n            </div>\n\n            {loading ? (\n              <div className=\"p-6 space-y-4\">\n                {[...Array(5)].map((_, index) => (\n                  <div key={index} className=\"flex items-center space-x-4\">\n                    <div className=\"h-10 w-10 rounded-full bg-gray-200 animate-pulse\"></div>\n                    <div className=\"space-y-2 flex-1\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse w-1/4\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : error ? (\n              <div className=\"p-6 text-center text-red-500\">{error}</div>\n            ) : stats.recentUsers.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">Tidak ada user terbaru</div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Nama</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Email</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Role</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Tanggal Daftar</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {stats.recentUsers.map((user) => (\n                      <tr key={user.id}>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                          {user.vendor_name && (\n                            <div className=\"text-sm text-gray-500\">{user.vendor_name}</div>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {user.email}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n                            user.role === 'VENDOR' ? 'bg-blue-100 text-blue-800' :\n                            user.role === 'VERIFIER' ? 'bg-green-100 text-green-800' :\n                            'bg-gray-100 text-gray-800'\n                          }`}>\n                            {user.role}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {formatDate(user.created_at)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          {user.verified_at || user.verification_status === 'VERIFIED' ? (\n                            <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">\n                              Terverifikasi\n                            </span>\n                          ) : user.rejection_reason || user.verification_status === 'REJECTED' ? (\n                            <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800\">\n                              Ditolak\n                            </span>\n                          ) : (\n                            <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800\">\n                              Menunggu\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              onClick={() => {\n                                setSelectedUser(user);\n                                setShowUserVerificationModal(true);\n                              }}\n                              className={btnDetail}\n                              title=\"Lihat Detail\"\n                            >\n                              Detail\n                            </button>\n                            <button\n                              onClick={() => {\n                                setSelectedUser(user);\n                                setShowEditUserModal(true);\n                              }}\n                              className={btnEdit}\n                              title=\"Edit User\"\n                            >\n                              Edit\n                            </button>\n                            <button\n                              onClick={() => {\n                                setSelectedUser(user);\n                                setShowDeleteUserModal(true);\n                              }}\n                              className={btnHapus}\n                              title=\"Delete User\"\n                            >\n                              Hapus\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50\">\n              <Link\n                href=\"/super-admin/users\"\n                className=\"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center\"\n              >\n                Lihat semua user\n                <svg className=\"ml-1 w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </Link>\n            </div>\n          </div>\n\n          {/* Card untuk akses cepat ke fitur */}\n          \n        </div>\n\n        {/* Modal User Verification */}\n        <ReviewerUserVerificationModal\n          user={selectedUser}\n          isOpen={showUserVerificationModal}\n          onClose={() => {\n            setShowUserVerificationModal(false);\n            setSelectedUser(null);\n          }}\n          onUserUpdate={handleUserUpdate}\n        />\n\n        {/* Modal Edit User */}\n        <EditUserModal\n          user={selectedUser}\n          isOpen={showEditUserModal}\n          onClose={() => {\n            setShowEditUserModal(false);\n            setSelectedUser(null);\n          }}\n          onUserUpdate={handleUserUpdate}\n        />\n\n        {/* Modal Delete User */}\n        <DeleteUserModal\n          user={selectedUser}\n          isOpen={showDeleteUserModal}\n          onClose={() => {\n            setShowDeleteUserModal(false);\n            setSelectedUser(null);\n          }}\n          onUserDelete={handleUserDelete}\n        />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\n// Import role types\nimport { redirect } from \"next/navigation\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport UserVerificationManagement from \"@/components/admin/UserVerificationManagement\";\nimport PageLoader from \"@/components/ui/PageLoader\";\n\nexport default function UserVerificationPage() {\n  const { data: session, status } = useSession();\n  \n  // State untuk refresh tabel\n  const [refreshTrigger] = useState(0);\n\n  // Loading state\n  if (status === \"loading\") {\n    return <PageLoader message=\"Memuat halaman verifikasi user...\" fullScreen={false} />;\n  }\n\n  // Redirect if not authenticated or not authorized\n  if (!session || ![ \"SUPER_ADMIN\"].includes(session.user.role)) {\n    redirect(\"/login\");\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Super Admin Panel\" titlePage=\"Verifikasi User\">\n        <div className=\"space-y-6\">\n          {/* Header Section */}\n          <div className=\"bg-white shadow-sm rounded-xl border border-gray-200/70\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h1 className=\"text-xl font-semibold text-gray-900\">\n                    Verifikasi User\n                  </h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    Kelola dan verifikasi user vendor dalam sistem\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* User Verification Management Component */}\n            <div className=\"p-6\">\n              <UserVerificationManagement refreshTrigger={refreshTrigger} />\n            </div>\n          </div>\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "vendor",
              "children": [
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport VendorDashboard from \"@/components/dashboard/VendorDashboard\";\nimport VerificationGuard from \"@/components/security/VerificationGuard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Vendor - SIMLOK\",\n  description: \"Halaman dashboard untuk vendor mengelola pengajuan dan melihat status pengajuan\",\n};\n\nexport default function VendorPage() {\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Dashboard\">\n          <VendorDashboard />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}"
                },
                {
                  "type": "directory",
                  "name": "submissions",
                  "children": [
                    {
                      "type": "directory",
                      "name": "create",
                      "children": [
                        {
                          "type": "file",
                          "name": "page.tsx",
                          "content": "import { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport SubmissionForm from '@/components/submissions/SubmissionForm';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport VerificationGuard from '@/components/security/VerificationGuard';\n\nexport default async function CreateSubmissionPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/');\n  }\n\n  // Check verification status on server side\n  if (!session.user.verified_at) {\n    redirect('/verification-pending');\n  }\n\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Buat Pengajuan Baru\">\n          <SubmissionForm />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}\n"
                        }
                      ]
                    },
                    {
                      "type": "directory",
                      "name": "edit",
                      "children": [
                        {
                          "type": "directory",
                          "name": "[id]",
                          "children": [
                            {
                              "type": "file",
                              "name": "page.tsx",
                              "content": "import { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport EditSubmissionForm from '../../../../../../components/vendor/EditSubmissionForm';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\n\ninterface EditSubmissionPageProps {\n  params: Promise<{\n    id: string;\n  }>;\n}\n\nexport default async function EditSubmissionPage({ params }: EditSubmissionPageProps) {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/admin');\n  }\n\n  // Await params as required by Next.js 15\n  const { id } = await params;\n\n  return (\n    <SidebarLayout title=\"Vendor Panel\" titlePage=\"Ubah Pengajuan SIMLOK\">\n      <div className=\"space-y-6\">\n        <EditSubmissionForm submissionId={id} />\n      </div>\n    </SidebarLayout>\n  );\n}\n"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from \"next\";\nimport { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport RoleGate from '@/components/security/RoleGate';\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - SIMLOK\",\n  description: \"Halaman untuk melihat dan mengelola daftar pengajuan vendor\",\n};\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport VendorSubmissionsContent from '@/components/vendor/VendorSubmissionsContent';\nimport VerificationGuard from '@/components/security/VerificationGuard';\n\nexport default async function VendorSubmissionsPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/');\n  }\n\n  // Check verification status on server side\n  if (!session.user.verified_at) {\n    redirect('/verification-pending');\n  }\n\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Daftar Pengajuan\">\n          <VendorSubmissionsContent />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "verifier",
              "children": [
                {
                  "type": "directory",
                  "name": "history",
                  "children": [
                    {
                      "type": "file",
                      "name": "page.tsx",
                      "content": "import { Metadata } from 'next';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { redirect } from 'next/navigation';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport VerifierScanHistory from '@/components/verifier/VerifierScanHistory';\n\nexport const metadata: Metadata = {\n  title: 'Riwayat Scan - Verifier',\n  description: 'Riwayat scan QR code SIMLOK oleh verifier',\n};\n\nexport default async function VerifierHistoryPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session) {\n    redirect('/auth/signin');\n  }\n\n  if (session.user.role !== 'VERIFIER') {\n    redirect('/dashboard');\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"VERIFIER\"]}>\n      <SidebarLayout title=\"Riwayat Scan\" titlePage=\"Verifier\">\n        <VerifierScanHistory />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                    }
                  ]
                },
                {
                  "type": "file",
                  "name": "page.tsx",
                  "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport VerifierDashboard from \"@/components/verifier/VerifierDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Verifikator - SIMLOK\",\n  description: \"Halaman dashboard untuk verifikator mengelola dan memverifikasi pengajuan\",\n};\n\nexport default function VerifierPage() {\n  return (\n    <RoleGate allowedRoles={[\"VERIFIER\"]}>\n      <SidebarLayout title=\"Verifier Panel\" titlePage=\"Dashboard\">\n        <VerifierDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": []
                }
              ]
            }
          ]
        },
        {
          "type": "directory",
          "name": "api",
          "children": [
            {
              "type": "directory",
              "name": "admin",
              "children": [
                {
                  "type": "directory",
                  "name": "dashboard-stats",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    // Check if user has admin privileges\n    if (session.user.role !== 'SUPER_ADMIN') {\n      return new NextResponse(\"Forbidden\", { status: 403 });\n    }\n\n    // Get total users count\n    const totalUsers = await prisma.user.count();\n\n    // Get pending verifications count (users not verified and not rejected)\n    const totalPending = await prisma.user.count({\n      where: {\n        AND: [\n          { verified_at: null },\n          { verification_status: { notIn: ['VERIFIED', 'REJECTED'] } },\n          { rejection_reason: null }\n        ]\n      }\n    });\n\n    // Get verified users count\n    const totalVerified = await prisma.user.count({\n      where: {\n        OR: [\n          { verified_at: { not: null } },\n          { verification_status: 'VERIFIED' }\n        ]\n      }\n    });\n\n    // Get rejected users count\n    const totalRejected = await prisma.user.count({\n      where: {\n        OR: [\n          { rejection_reason: { not: null } },\n          { verification_status: 'REJECTED' }\n        ]\n      }\n    });\n\n    // Get today's registrations\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    const todayRegistrations = await prisma.user.count({\n      where: {\n        created_at: {\n          gte: today,\n          lt: tomorrow\n        }\n      }\n    });\n\n    // Get recent users (latest 5)\n    const recentUsers = await prisma.user.findMany({\n      orderBy: {\n        created_at: 'desc'\n      },\n      take: 5,\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        phone_number: true,\n        address: true,\n        role: true,\n        verified_at: true,\n        verification_status: true,\n        rejection_reason: true,\n        rejected_at: true,\n        created_at: true\n      }\n    });\n\n    return NextResponse.json({\n      totalUsers,\n      totalPending,\n      totalVerified, \n      totalRejected,\n      todayRegistrations,\n      recentUsers,\n      // Legacy compatibility\n      pendingVerifications: totalPending\n    });\n\n  } catch (error) {\n    console.error(\"[ADMIN_DASHBOARD_STATS]\", error);\n    return new NextResponse(\"Internal Server Error\", { status: 500 });\n  }\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\n\n// Schema for validating user update data\nconst updateUserSchema = z.object({\n  officer_name: z.string().optional().nullable(),\n  vendor_name: z.string().optional().nullable(),\n  email: z.string().email('Invalid email format'),\n  phone_number: z.string().optional().nullable(),\n  address: z.string().optional().nullable(),\n  role: z.enum(['VENDOR', 'VERIFIER', 'REVIEWER', 'APPROVER', 'SUPER_ADMIN']),\n  password: z.string().min(6).optional(),\n});\n\n// PUT /api/admin/users/[id] - Update user\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only SUPER_ADMIN can access this endpoint\n    if (session.user.role !== 'SUPER_ADMIN') {\n      return NextResponse.json({ error: 'Super Admin access required' }, { status: 403 });\n    }\n\n    // Check if user exists\n    const existingUser = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        role: true\n      }\n    });\n\n    if (!existingUser) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    const body = await request.json();\n    const validatedData = updateUserSchema.parse(body);\n\n    // Check if email is already taken by another user\n    if (validatedData.email !== existingUser.email) {\n      const emailExists = await prisma.user.findFirst({\n        where: {\n          email: validatedData.email,\n          id: { not: id }\n        }\n      });\n\n      if (emailExists) {\n        return NextResponse.json({ error: 'Email already exists' }, { status: 400 });\n      }\n    }\n\n    // Prepare update data\n    const updateData: any = {\n      email: validatedData.email,\n      role: validatedData.role,\n      phone_number: validatedData.phone_number || null,\n      address: validatedData.address || null,\n    };\n\n    // Handle name fields based on role\n    if (validatedData.role === 'VENDOR') {\n      updateData.vendor_name = validatedData.vendor_name;\n      updateData.officer_name = validatedData.vendor_name; // Keep officer_name as vendor_name for consistency\n    } else {\n      updateData.officer_name = validatedData.officer_name;\n      updateData.vendor_name = null;\n    }\n\n    // Hash password if provided\n    if (validatedData.password) {\n      updateData.password = await bcrypt.hash(validatedData.password, 12);\n    }\n\n    // Update user\n    const updatedUser = await prisma.user.update({\n      where: { id },\n      data: updateData,\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        phone_number: true,\n        address: true,\n        role: true,\n        verified_at: true,\n        verification_status: true,\n        rejection_reason: true,\n        rejected_at: true,\n        created_at: true\n      }\n    });\n\n    return NextResponse.json({\n      user: updatedUser,\n      message: 'User updated successfully'\n    });\n\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error updating user:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// DELETE /api/admin/users/[id] - Delete user\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only SUPER_ADMIN can access this endpoint\n    if (session.user.role !== 'SUPER_ADMIN') {\n      return NextResponse.json({ error: 'Super Admin access required' }, { status: 403 });\n    }\n\n    // Prevent self-deletion\n    if (session.user.id === id) {\n      return NextResponse.json({ error: 'Cannot delete your own account' }, { status: 400 });\n    }\n\n    // Check if user exists\n    const existingUser = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        role: true,\n        submissions: {\n          select: { id: true }\n        }\n      }\n    });\n\n    if (!existingUser) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    // Delete user (cascade will handle related records)\n    await prisma.user.delete({\n      where: { id }\n    });\n\n    return NextResponse.json({\n      message: 'User deleted successfully'\n    });\n\n  } catch (error) {\n    console.error('Error deleting user:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "approver",
              "children": [
                {
                  "type": "directory",
                  "name": "simloks",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "final",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\nimport { generateQrString } from '@/lib/qr-security';\n\n// Schema for validating final approval data\nconst finalApprovalSchema = z.object({\n  final_status: z.enum(['APPROVED', 'REJECTED']),\n  final_note: z.string().optional(),\n  simlok_number: z.string().optional(),\n  simlok_date: z.string().optional(),\n});\n\n// Function to generate simlok number - mengikuti sistem admin yang sudah ada\nasync function generateSimlokNumber(): Promise<string> {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n  // Get the last SIMLOK number for current month/year\n  const lastSubmission = await prisma.submission.findFirst({\n    where: {\n      simlok_number: {\n        contains: `/${month}/${year}`\n      }\n    },\n    orderBy: {\n      simlok_number: 'desc'\n    }\n  });\n\n  let nextNumber = 1;\n  \n  if (lastSubmission?.simlok_number) {\n    // Extract number from format: number/MM/YYYY\n    const match = lastSubmission.simlok_number.match(/^(\\d+)\\/\\d{2}\\/\\d{4}$/);\n    if (match && match[1]) {\n      nextNumber = parseInt(match[1]) + 1;\n    }\n  }\n\n  return `${nextNumber}/${month}/${year}`;\n}\n\n// PATCH /api/approver/simloks/[id]/final - Set final approval status\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    \n    // Check if submission exists and has been reviewed\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        review_status: true,\n        final_status: true,\n        user_id: true,\n        implementation_start_date: true,\n        implementation_end_date: true,\n        user: {\n          select: {\n            id: true,\n            vendor_name: true,\n            officer_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n          }\n        }\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Cannot finalize if not reviewed yet\n    if (existingSubmission.review_status === 'PENDING_REVIEW') {\n      return NextResponse.json({ \n        error: 'Cannot finalize submission that has not been reviewed yet' \n      }, { status: 400 });\n    }\n\n    // Cannot finalize if already finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Submission has already been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = finalApprovalSchema.parse(body);\n\n    // Generate simlok number only if approved\n    const updateData: any = {\n      final_status: validatedData.final_status,\n      final_note: validatedData.final_note || null,\n      approved_by_final_id: session.user.id,\n      approved_at: new Date(),\n    };\n\n    if (validatedData.final_status === 'APPROVED') {\n      // Use provided simlok number or generate one\n      updateData.simlok_number = validatedData.simlok_number?.trim() || await generateSimlokNumber();\n      \n      // Use provided date or current date\n      if (validatedData.simlok_date) {\n        updateData.simlok_date = new Date(validatedData.simlok_date);\n      } else {\n        updateData.simlok_date = new Date();\n      }\n      \n      // Auto-generate QR code when approved\n      const qrString = generateQrString({\n        id: resolvedParams.id,\n        implementation_start_date: existingSubmission.implementation_start_date || null,\n        implementation_end_date: existingSubmission.implementation_end_date || null\n      });\n      updateData.qrcode = qrString;\n      \n      updateData.approval_status = 'APPROVED'; // Update legacy field too\n    } else {\n      updateData.approval_status = 'REJECTED'; // Update legacy field too\n    }\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Log QR code generation for approved submissions\n    if (validatedData.final_status === 'APPROVED' && updateData.qrcode) {\n      console.log(`✅ QR Code auto-generated for approved submission ${resolvedParams.id}: ${updateData.qrcode.substring(0, 50)}...`);\n    }\n\n    // Import and use the event system for real-time notifications\n    const { notifyVendorStatusChange, notifyReviewerSubmissionApproved } = await import('@/server/events');\n    \n    // Notify vendor with real-time updates\n    const vendorStatus = validatedData.final_status === 'APPROVED' ? 'APPROVED' : 'REJECTED';\n    await notifyVendorStatusChange(\n      existingSubmission.user.id, \n      resolvedParams.id, \n      vendorStatus as 'APPROVED' | 'REJECTED'\n    );\n\n    // Notify reviewers when submission is approved\n    if (validatedData.final_status === 'APPROVED') {\n      await notifyReviewerSubmissionApproved(resolvedParams.id);\n    }\n\n    return NextResponse.json({ \n      submission: updatedSubmission,\n      message: `Submission ${validatedData.final_status.toLowerCase()} successfully`\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error finalizing submission:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
                            }
                          ]
                        },
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/approver/simloks/[id] - Get single submission for final approval (read-only)\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const submission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          },\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ submission });\n  } catch (error) {\n    console.error('Error fetching submission for approval:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        },
                        {
                          "type": "directory",
                          "name": "workers",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    // Check if submission exists\n    const submission = await prisma.submission.findUnique({\n      where: { id: id }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers for approver:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/approver/simloks - Get reviewed submissions for approval\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const reviewStatus = searchParams.get('reviewStatus');\n    const finalStatus = searchParams.get('finalStatus');\n    const vendorId = searchParams.get('vendorId');\n    const search = searchParams.get('search');\n    const sortBy = searchParams.get('sortBy') || 'reviewed_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {\n      // Only show submissions that have been reviewed (not pending review)\n      review_status: {\n        not: 'PENDING_REVIEW'\n      }\n    };\n\n    // Filter by specific review status if provided\n    if (reviewStatus && ['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {\n      whereClause.review_status = reviewStatus;\n    }\n\n    // Filter by final status if provided\n    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {\n      whereClause.final_status = finalStatus;\n    }\n\n    // Filter by vendor if provided\n    if (vendorId) {\n      whereClause.user_id = vendorId;\n    }\n\n    // Filter by search term (vendor name, job description, or officer name)\n    if (search) {\n      whereClause.OR = [\n        {\n          vendor_name: {\n            contains: search\n          }\n        },\n        {\n          job_description: {\n            contains: search\n          }\n        },\n        {\n          officer_name: {\n            contains: search\n          }\n        }\n      ];\n    }\n\n    const [submissions, total, statistics] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          },\n          reviewed_by_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          },\n          approved_by_final_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          },\n          worker_list: {\n            select: {\n              id: true,\n              worker_name: true,\n              worker_photo: true,\n            }\n          }\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n      // Get statistics for approver dashboard\n      Promise.all([\n        prisma.submission.count({\n          where: {\n            review_status: 'MEETS_REQUIREMENTS',\n            final_status: 'PENDING_APPROVAL'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            review_status: 'NOT_MEETS_REQUIREMENTS',\n            final_status: 'PENDING_APPROVAL'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            final_status: 'APPROVED'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            final_status: 'REJECTED'\n          }\n        }),\n      ])\n    ]);\n\n    // Format statistics\n    const [meetsCount, notMeetsCount, approvedCount, rejectedCount] = statistics;\n    const stats = {\n      total: total,\n      pending_approval_meets: meetsCount,\n      pending_approval_not_meets: notMeetsCount,\n      approved: approvedCount,\n      rejected: rejectedCount,\n    };\n\n    return NextResponse.json({\n      submissions,\n      statistics: stats,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching approver submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "auth",
              "children": [
                {
                  "type": "directory",
                  "name": "[...nextauth]",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "// app/api/auth/[...nextauth]/route.ts\nimport NextAuth from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "refresh",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextResponse } from \"next/server\";\nimport { TokenManager } from \"@/utils/token-manager\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function POST(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const body = await req.json();\n    const { refreshToken } = body;\n\n    if (!refreshToken) {\n      return NextResponse.json({ error: \"Refresh token required\" }, { status: 400 });\n    }\n\n    // Verify and rotate refresh token\n    const validToken = await TokenManager.getValidRefreshToken(refreshToken);\n    \n    if (!validToken || validToken.userId !== session.user.id) {\n      return NextResponse.json({ error: \"Invalid refresh token\" }, { status: 401 });\n    }\n\n    // Rotate token\n    const newToken = await TokenManager.rotateRefreshToken(session.user.id, refreshToken);\n\n    return NextResponse.json({\n      refreshToken: newToken.token,\n      expiresAt: newToken.expiresAt\n    });\n\n  } catch (error) {\n    console.error(\"Error refreshing token:\", error);\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\n  }\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "signup",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "// app/api/auth/signup/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/singletons\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\nimport { notifyAdminNewVendor } from \"@/server/events\";\n\n// Validation schema for vendor registration\nconst vendorRegistrationSchema = z.object({\n  csrfToken: z.string().min(1, \"CSRF token is required\"),\n  officer_name: z.string()\n    .min(2, \"Nama petugas minimal 2 karakter\")\n    .max(100, \"Nama petugas maksimal 100 karakter\")\n    .trim(),\n  email: z.string()\n    .email(\"Format email tidak valid\")\n    .min(5, \"Email terlalu pendek\")\n    .max(100, \"Email terlalu panjang\")\n    .toLowerCase(),\n  password: z.string()\n    .min(8, \"Password minimal 8 karakter\")\n    .max(100, \"Password terlalu panjang\")\n    .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/, \"Password harus mengandung huruf besar, huruf kecil, dan angka\"),\n  vendor_name: z.string()\n    .min(2, \"Nama vendor minimal 2 karakter\")\n    .max(150, \"Nama vendor maksimal 150 karakter\")\n    .trim(),\n  address: z.string()\n    .min(10, \"Alamat minimal 10 karakter\")\n    .max(500, \"Alamat maksimal 500 karakter\")\n    .trim(),\n  phone_number: z.string()\n    .min(10, \"Nomor telepon minimal 10 digit\")\n    .max(15, \"Nomor telepon maksimal 15 digit\")\n    .regex(/^[0-9+\\-\\s]+$/, \"Nomor telepon hanya boleh berisi angka, +, -, dan spasi\")\n    .trim(),\n});\n\n// Rate limiting store (in production, use Redis)\nconst registrationAttempts = new Map<string, { count: number; lastAttempt: number }>();\n\nfunction checkRateLimit(ip: string): boolean {\n  const now = Date.now();\n  const windowMs = 15 * 60 * 1000; // 15 minutes\n  const maxAttempts = 5; // Maximum 5 registration attempts per 15 minutes\n\n  const attempts = registrationAttempts.get(ip);\n  \n  if (!attempts) {\n    registrationAttempts.set(ip, { count: 1, lastAttempt: now });\n    return true;\n  }\n\n  // Reset counter if window has passed\n  if (now - attempts.lastAttempt > windowMs) {\n    registrationAttempts.set(ip, { count: 1, lastAttempt: now });\n    return true;\n  }\n\n  // Check if limit exceeded\n  if (attempts.count >= maxAttempts) {\n    return false;\n  }\n\n  // Increment counter\n  attempts.count++;\n  attempts.lastAttempt = now;\n  return true;\n}\n\nfunction validateCsrfToken(req: NextRequest, csrfToken: string): boolean {\n  try {\n    const cookieHeader = req.headers.get(\"cookie\") || \"\";\n    const csrfCookie = cookieHeader\n      .split(\"; \")\n      .find((c) => c.startsWith(\"__Host-next-auth.csrf-token=\") || c.startsWith(\"next-auth.csrf-token=\"));\n\n    if (!csrfCookie) {\n      return false;\n    }\n\n    // Format cookie: token|hash, URL encoded %7C = |\n    const cookieValue = decodeURIComponent(csrfCookie.split(\"=\")[1] || '');\n    const [expectedToken] = cookieValue.split(\"|\");\n    \n    return expectedToken === csrfToken;\n  } catch (error) {\n    console.error(\"CSRF validation error:\", error);\n    return false;\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    // Get client IP for rate limiting\n    const clientIP = req.headers.get(\"x-forwarded-for\") || \n                     req.headers.get(\"x-real-ip\") || \n                     \"127.0.0.1\";\n\n    // Check rate limit\n    if (!checkRateLimit(clientIP)) {\n      return NextResponse.json(\n        { error: \"Terlalu banyak percobaan pendaftaran. Silakan coba lagi dalam 15 menit.\" }, \n        { status: 429 }\n      );\n    }\n\n    // Parse and validate request body\n    const body = await req.json();\n    \n    // Validate input using Zod schema\n    const validationResult = vendorRegistrationSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      const errors = validationResult.error.issues.map((err: any) => err.message).join(\", \");\n      return NextResponse.json({ error: errors }, { status: 400 });\n    }\n\n    const { csrfToken, officer_name, email, password, vendor_name, address, phone_number } = validationResult.data;\n\n    // Validate CSRF token\n    if (!validateCsrfToken(req, csrfToken)) {\n      return NextResponse.json({ error: \"Invalid CSRF token\" }, { status: 403 });\n    }\n\n    // Check if user already exists\n    const existingUser = await prisma.user.findUnique({ \n      where: { email },\n      select: { id: true, email: true }\n    });\n    \n    if (existingUser) {\n      return NextResponse.json({ error: \"Email sudah terdaftar\" }, { status: 409 });\n    }\n\n    // Check if vendor name already exists (case-insensitive)\n    const existingVendor = await prisma.user.findFirst({\n      where: { \n        vendor_name: {\n          equals: vendor_name,\n        }\n      },\n      select: { id: true, vendor_name: true }\n    });\n\n    if (existingVendor) {\n      return NextResponse.json({ error: \"Nama vendor sudah terdaftar\" }, { status: 409 });\n    }\n\n    // Hash password with strong settings\n    const saltRounds = 12;\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n\n    // Create new vendor user\n    const newUser = await prisma.user.create({\n      data: {\n        officer_name,\n        email,\n        password: hashedPassword,\n        vendor_name,\n        address,\n        phone_number,\n        role: \"VENDOR\", // Always VENDOR for this registration endpoint\n        verified_at: null, // Requires admin verification\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n      }\n    });\n\n    // Notify admin and reviewer about new vendor registration\n    await notifyAdminNewVendor(newUser.id);\n    \n    const { notifyReviewerNewUser } = await import('@/server/events');\n    await notifyReviewerNewUser(newUser.id);\n\n    // Log successful registration (for audit purposes)\n    console.log(`New vendor registered: ${email} (${vendor_name}) at ${new Date().toISOString()}`);\n\n    return NextResponse.json(\n      { \n        message: \"Pendaftiran berhasil! Akun Anda sedang menunggu verifikasi admin.\", \n        user: {\n          id: newUser.id,\n          officer_name: newUser.officer_name,\n          email: newUser.email,\n          vendor_name: newUser.vendor_name,\n          role: newUser.role,\n          verified: !!newUser.verified_at,\n        }\n      },\n      { status: 201 }\n    );\n\n  } catch (error) {\n    console.error(\"Registration error:\", error);\n    \n    // Don't expose internal errors to client\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan internal server. Silakan coba lagi.\" }, \n      { status: 500 }\n    );\n  }\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "files",
              "children": [
                {
                  "type": "directory",
                  "name": "[userId]",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[category]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "[filename]",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { readFile } from 'fs/promises';\nimport { join } from 'path';\nimport { existsSync } from 'fs';\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ userId: string; category: string; filename: string }> }\n) {\n  try {\n    // Get session to check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Await params for Next.js 15 compatibility\n    const { userId, category, filename } = await params;\n\n    // Check if user can access this file\n    // Users can only access their own files, unless they're super admin, reviewer, or approver\n    const canAccess = \n      session.user.role === 'SUPER_ADMIN' || \n      session.user.role === 'REVIEWER' || \n      session.user.role === 'APPROVER' ||\n      session.user.id === userId;\n\n    // Debug logging\n    console.log('File access check:', {\n      requestedUserId: userId,\n      sessionUserId: session.user.id,\n      userRole: session.user.role,\n      category,\n      filename,\n      canAccess\n    });\n      \n    if (!canAccess) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n    }\n\n    // Map category to folder name\n    const categoryFolders = {\n      sika: 'dokumen-sika',\n      simja: 'dokumen-simja',\n      other: 'lainnya',\n      'worker-photo': 'foto-pekerja'\n    };\n\n    const folderName = categoryFolders[category as keyof typeof categoryFolders];\n    if (!folderName) {\n      return NextResponse.json({ error: 'Invalid category' }, { status: 400 });\n    }\n\n    // Construct file path\n    const filePath = join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n\n    // Check if file exists\n    if (!existsSync(filePath)) {\n      return NextResponse.json({ error: 'File not found' }, { status: 404 });\n    }\n\n    // Read file\n    const fileBuffer = await readFile(filePath);\n\n    // Determine content type based on file extension\n    const extension = filename.split('.').pop()?.toLowerCase();\n    let contentType = 'application/octet-stream';\n    \n    switch (extension) {\n      case 'pdf':\n        contentType = 'application/pdf';\n        break;\n      case 'jpg':\n      case 'jpeg':\n        contentType = 'image/jpeg';\n        break;\n      case 'png':\n        contentType = 'image/png';\n        break;\n      case 'gif':\n        contentType = 'image/gif';\n        break;\n      case 'doc':\n        contentType = 'application/msword';\n        break;\n      case 'docx':\n        contentType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';\n        break;\n    }\n\n    // Return file with proper headers\n    return new NextResponse(new Uint8Array(fileBuffer), {\n      headers: {\n        'Content-Type': contentType,\n        'Content-Disposition': `inline; filename=\"${filename}\"`,\n        'Cache-Control': 'private, max-age=3600', // Cache for 1 hour\n      },\n    });\n\n  } catch (error) {\n    console.error('File serving error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "manage",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// GET /api/files/manage - List all user files\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const files = await fileManager.listUserFiles(session.user.id);\n    \n    return NextResponse.json({\n      success: true,\n      files\n    });\n\n  } catch (error) {\n    console.error('Error listing files:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n\n// POST /api/files/manage - Rename or move file\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { action, oldFileName, newName, category } = body;\n\n    if (action === 'rename') {\n      if (!oldFileName || !newName) {\n        return NextResponse.json({ \n          error: 'oldFileName and newName are required' \n        }, { status: 400 });\n      }\n\n      const result = await fileManager.renameFile(\n        session.user.id,\n        oldFileName,\n        newName,\n        category\n      );\n\n      if (!result) {\n        return NextResponse.json({ \n          error: 'Failed to rename file' \n        }, { status: 400 });\n      }\n\n      return NextResponse.json({\n        success: true,\n        file: result\n      });\n    }\n\n    if (action === 'migrate') {\n      const result = await fileManager.migrateExistingFiles(session.user.id);\n      \n      return NextResponse.json({\n        success: true,\n        migrated: result.moved,\n        errors: result.errors\n      });\n    }\n\n    return NextResponse.json({ \n      error: 'Invalid action' \n    }, { status: 400 });\n\n  } catch (error) {\n    console.error('Error managing files:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n\n// DELETE /api/files/manage - Delete file\nexport async function DELETE(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const fileName = searchParams.get('fileName');\n\n    if (!fileName) {\n      return NextResponse.json({ \n        error: 'fileName is required' \n      }, { status: 400 });\n    }\n\n    const success = await fileManager.deleteFile(session.user.id, fileName);\n\n    if (!success) {\n      return NextResponse.json({ \n        error: 'Failed to delete file' \n      }, { status: 400 });\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'File deleted successfully'\n    });\n\n  } catch (error) {\n    console.error('Error deleting file:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "internal",
              "children": [
                {
                  "type": "directory",
                  "name": "session",
                  "children": [
                    {
                      "type": "directory",
                      "name": "validate",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "// src/app/api/internal/session/validate/route.ts\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const userId = searchParams.get(\"uid\");\n\n    if (!userId) {\n      return NextResponse.json(\n        { isValid: false, shouldLogout: true, reason: \"MISSING_UID\" },\n        { status: 400 }\n      );\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n      select: { id: true, isActive: true },\n    });\n\n    if (!user || !user.isActive) {\n      return NextResponse.json(\n        { isValid: false, shouldLogout: true, reason: \"USER_NOT_FOUND_OR_INACTIVE\" },\n        { status: 200 }\n      );\n    }\n\n    return NextResponse.json({ isValid: true });\n  } catch (e) {\n    console.error(\"validate-session error:\", e);\n    // Pada error, lebih aman paksa logout agar tidak kebobolan.\n    return NextResponse.json(\n      { isValid: false, shouldLogout: true, reason: \"SERVER_ERROR\" },\n      { status: 200 }\n    );\n  }\n}\n"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "notifications",
              "children": [
                {
                  "type": "directory",
                  "name": "stream",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { redisPub } from '@/lib/singletons';\n\nexport const runtime = 'nodejs';\n\nexport async function GET(request: NextRequest) {\n  const session = await getServerSession(authOptions);\n  \n  if (!session?.user) {\n    return new Response('Unauthorized', { status: 401 });\n  }\n\n  const searchParams = request.nextUrl.searchParams;\n  const scope = searchParams.get('scope') || \n    ( session.user.role === 'SUPER_ADMIN' ? 'admin' :\n     session.user.role === 'REVIEWER' ? 'reviewer' :\n     session.user.role === 'APPROVER' ? 'approver' : 'vendor');\n  const vendorId = searchParams.get('vendorId') || session.user.id;\n\n  // Create Server-Sent Events stream\n  const stream = new ReadableStream({\n    start(controller) {\n      console.log('🔥 SSE connection established for:', { scope, vendorId, role: session.user.role });\n\n      // Send initial connection message\n      const encoder = new TextEncoder();\n      controller.enqueue(encoder.encode(`data: ${JSON.stringify({ \n        type: 'connected', \n        message: 'Real-time notifications connected',\n        scope,\n        vendorId,\n        role: session.user.role\n      })}\\n\\n`));\n\n      // Subscribe to Redis channels for real-time updates\n      let channelName: string;\n      switch (scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${vendorId}`;\n          break;\n        default:\n          channelName = 'notifications:admin';\n      }\n      \n      // Create a Redis subscriber for this connection\n      const subscriber = redisPub.duplicate();\n      \n      subscriber.subscribe(channelName, (err, count) => {\n        if (err) {\n          console.error('Redis subscribe error:', err);\n          return;\n        }\n        console.log(`📡 Subscribed to Redis channel: ${channelName} (${count} channels)`);\n      });\n\n      subscriber.on('message', (channel, message) => {\n        try {\n          console.log(`📨 SSE Received message on ${channel}:`, message);\n          const data = JSON.parse(message);\n          \n          // Send the notification data to client\n          controller.enqueue(encoder.encode(`data: ${JSON.stringify(data)}\\n\\n`));\n          console.log(`📤 SSE Forwarded message to client:`, data.type);\n        } catch (error) {\n          console.error('❌ SSE Error processing Redis message:', error);\n        }\n      });\n\n      // Keep connection alive with heartbeat\n      const heartbeat = setInterval(() => {\n        controller.enqueue(encoder.encode(`data: ${JSON.stringify({ \n          type: 'heartbeat', \n          timestamp: new Date().toISOString() \n        })}\\n\\n`));\n      }, 30000); // Every 30 seconds\n\n      // Cleanup on connection close\n      request.signal.addEventListener('abort', () => {\n        console.log('🔌 SSE connection closed for:', { scope, vendorId });\n        clearInterval(heartbeat);\n        subscriber.unsubscribe();\n        subscriber.disconnect();\n        controller.close();\n      });\n    }\n  });\n\n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Headers': 'Cache-Control',\n    },\n  });\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "qr",
              "children": [
                {
                  "type": "directory",
                  "name": "verify",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { parseQrString, type QrPayload } from '@/lib/qr-security';\n\n// POST /api/qr/verify - Verify QR code and return submission data\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only VERIFIER and ADMIN can scan QR codes/barcodes\n    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ \n        error: 'Access denied. Only verifiers and admins can scan QR codes/barcodes.' \n      }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { qrData, qr_data, scanLocation, scanNotes, scanner_type } = body;\n\n    // Support both qrData and qr_data parameter names for compatibility\n    const qrString = qr_data || qrData;\n\n    console.log('=== QR VERIFY API ===');\n    console.log('Received qrString:', qrString);\n    console.log('qrString length:', qrString?.length);\n    console.log('scanner_type:', scanner_type);\n    console.log('session.user:', session.user);\n    console.log('session.user.id:', session.user.id);\n    console.log('session.user.role:', session.user.role);\n    console.log('====================');\n\n    if (!qrString) {\n      console.log('ERROR: No QR/Barcode string provided');\n      return NextResponse.json({ \n        success: false,\n        message: 'QR/Barcode string is required' \n      }, { status: 400 });\n    }\n\n    // Parse and verify QR code or barcode\n    const qrPayload: QrPayload | null = parseQrString(qrString);\n    \n    console.log('=== QR PARSING RESULT ===');\n    console.log('Parsed payload:', qrPayload);\n    console.log('========================');\n    \n    if (!qrPayload) {\n      console.log('ERROR: Failed to parse QR/Barcode');\n      return NextResponse.json({ \n        success: false,\n        message: 'Invalid QR code/barcode or data has been tampered with. Please make sure you are scanning a valid SIMLOK QR code or barcode generated by the system.' \n      }, { status: 400 });\n    }\n\n    // Check if QR/Barcode is valid for current date (simplified check)\n    const now = Date.now();\n    if (qrPayload.timestamp && now > qrPayload.timestamp + (7 * 24 * 60 * 60 * 1000)) { // 7 days validity\n      return NextResponse.json({ \n        success: false,\n        message: 'QR code/barcode has expired. Please generate a new one.' \n      }, { status: 400 });\n    }\n\n    // Fetch submission data\n    const submission = await prisma.submission.findUnique({\n      where: { id: qrPayload.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n          },\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ \n        success: false,\n        message: 'Submission not found' \n      }, { status: 404 });\n    }\n\n    // Check if submission is approved\n    if (submission.approval_status !== 'APPROVED') {\n      return NextResponse.json({ \n        success: false,\n        message: 'This submission is not approved yet' \n      }, { status: 400 });\n    }\n\n    // DEBUG: Check user session and database\n    console.log('=== USER SESSION DEBUG ===');\n    console.log('session.user:', JSON.stringify(session.user, null, 2));\n    console.log('session.user.id:', session.user.id);\n    \n    // Check if this user exists in database\n    const userExists = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { id: true, email: true, role: true, officer_name: true, address: true }\n    });\n    console.log('userExists in DB:', userExists);\n    \n    if (!userExists) {\n      console.log('ERROR: User not found in database');\n      return NextResponse.json({ \n        success: false,\n        message: 'User session is invalid. Please login again.' \n      }, { status: 401 });\n    }\n\n    // Check for duplicate scans - only prevent same verifier scanning same SIMLOK on same day\n    console.log('=== CHECKING FOR DUPLICATE SCAN BY SAME VERIFIER ON SAME DAY ===');\n    console.log('submission_id:', qrPayload.id);\n    console.log('scanned_by:', session.user.id);\n    \n    // Get today's date range (start and end of day)\n    const today = new Date();\n    const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);\n    const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);\n    \n    // Check if the same verifier has already scanned today\n    const existingTodayScanByUser = await prisma.qrScan.findFirst({\n      where: {\n        submission_id: qrPayload.id,\n        scanned_by: session.user.id,\n        scanned_at: {\n          gte: startOfDay,\n          lte: endOfDay,\n        }\n      },\n      include: {\n        user: {\n          select: {\n            officer_name: true,\n          },\n        },\n      },\n    });\n\n    console.log('existingTodayScanByUser found:', !!existingTodayScanByUser);\n\n    if (existingTodayScanByUser) {\n      console.log('=== DUPLICATE SCAN BY SAME USER TODAY DETECTED ===');\n      const scanDate = new Date(existingTodayScanByUser.scanned_at);\n      const formattedDate = scanDate.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: '2-digit', \n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n      });\n\n      return NextResponse.json({ \n        success: false, \n        error: 'duplicate_scan_same_day',\n        message: `QR code sudah anda scan hari ini pada ${formattedDate}. Satu verifikator hanya dapat melakukan scan sekali per hari untuk SIMLOK yang sama.`,\n        previousScan: {\n          scanDate: existingTodayScanByUser.scanned_at,\n          scanId: existingTodayScanByUser.id,\n          scannerName: existingTodayScanByUser.user.officer_name,\n        }\n      }, { status: 409 });\n    }\n\n    // Note: Different verifiers CAN scan the same SIMLOK on the same day\n    // This is allowed per the new requirements\n\n    console.log('=== NO DUPLICATE FOUND, PROCEEDING TO CREATE SCAN RECORD ===');\n\n    console.log('User verified for scan record creation:', userExists);\n\n    // Record the scan in database\n    try {\n      const scanRecord = await prisma.qrScan.create({\n        data: {\n          submission_id: qrPayload.id,\n          scanned_by: session.user.id,\n          scanner_name: userExists.officer_name || session.user.officer_name,\n          scan_location: userExists.address || 'Lokasi tidak tersedia',\n          notes: scanNotes || `Scanned via ${scanner_type || 'scanner'} at: ${scanLocation || 'Unknown location'}`,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              role: true,\n            }\n          }\n        }\n      });\n\n      console.log('=== SCAN RECORD CREATED SUCCESSFULLY ===');\n      console.log('scanRecord.id:', scanRecord.id);\n\n      // Return verification result with submission data in the format expected by the modal\n      return NextResponse.json({\n        success: true,\n        message: 'QR code/barcode verified successfully',\n        scan_id: scanRecord.id,\n        scanned_at: scanRecord.scanned_at,\n        scanned_by: scanRecord.user.officer_name,\n        data: {\n          submission: {\n            id: submission.id,\n            number: submission.simlok_number,\n            title: submission.job_description,\n            task: submission.implementation || 'No task description',\n            workers: submission.worker_list.map(worker => ({ name: worker.worker_name })),\n            vendor: submission.vendor_name ? { name: submission.vendor_name } : undefined,\n            location: submission.work_location || undefined,\n            implementation_start_date: submission.implementation_start_date?.toISOString(),\n            implementation_end_date: submission.implementation_end_date?.toISOString(),\n            status: submission.approval_status.toLowerCase(),\n          }\n        }\n      });\n\n    } catch (createError: any) {\n      console.error('Error creating scan record:', createError);\n      \n      // Check if it's a unique constraint violation (in case of race condition)\n      if (createError?.code === 'P2002') {\n        console.log('=== UNIQUE CONSTRAINT VIOLATION DETECTED (RACE CONDITION) ===');\n        \n        // Check again for today's scans by same user only (race condition handling)\n        const today = new Date();\n        const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);\n        const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);\n        \n        const raceConditionScan = await prisma.qrScan.findFirst({\n          where: {\n            submission_id: qrPayload.id,\n            scanned_by: session.user.id, // Only check for same user\n            scanned_at: {\n              gte: startOfDay,\n              lte: endOfDay,\n            }\n          },\n          include: {\n            user: {\n              select: {\n                officer_name: true,\n              },\n            },\n          },\n        });\n\n        if (raceConditionScan) {\n          const scanDate = new Date(raceConditionScan.scanned_at);\n          const formattedDate = scanDate.toLocaleDateString('id-ID', {\n            day: '2-digit',\n            month: '2-digit', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n          });\n\n          return NextResponse.json({ \n            success: false, \n            error: 'duplicate_scan_same_day',\n            message: `Anda sudah melakukan scan untuk SIMLOK ini hari ini pada ${formattedDate}. Verifikator yang sama tidak dapat scan SIMLOK yang sama di hari yang sama.`\n          }, { status: 409 });\n        }\n\n        return NextResponse.json({ \n          success: false, \n          error: 'duplicate_scan',\n          message: 'QR Code ini sudah pernah discan hari ini (race condition detected)'\n        }, { status: 409 });\n      }\n      \n      throw createError; // Re-throw if it's not a constraint violation\n    }\n\n  } catch (error) {\n    console.error('QR/Barcode verification error:', error);\n    return NextResponse.json({ \n      success: false,\n      message: 'Internal server error during QR/Barcode verification' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/qr/verify - Get recent scan history (for admin/verifier dashboard)\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only VERIFIER and ADMIN can view scan history\n    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ \n        error: 'Access denied. Only verifiers and admins can view scan history.' \n      }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const limit = Math.min(parseInt(searchParams.get('limit') || '50'), 100);\n    const offset = parseInt(searchParams.get('offset') || '0');\n    const submissionId = searchParams.get('submission_id');\n    const search = searchParams.get('search');\n    const status = searchParams.get('status');\n    const dateFrom = searchParams.get('dateFrom');\n    const dateTo = searchParams.get('dateTo');\n    const location = searchParams.get('location');\n\n    // Build where clause\n    const whereClause: any = {};\n    \n    if (submissionId) {\n      whereClause.submission_id = submissionId;\n    }\n\n    // For verifiers, only show their own scans\n    if (session.user.role === 'VERIFIER') {\n      whereClause.scanned_by = session.user.id;\n    }\n\n    // Add search filter\n    if (search) {\n      whereClause.OR = [\n        {\n          submission: {\n            simlok_number: {\n              contains: search\n            }\n          }\n        },\n        {\n          submission: {\n            vendor_name: {\n              contains: search\n            }\n          }\n        },\n        {\n          scan_location: {\n            contains: search\n          }\n        }\n      ];\n    }\n\n    // Add status filter\n    if (status) {\n      whereClause.submission = {\n        ...whereClause.submission,\n        approval_status: status\n      };\n    }\n\n    // Add date range filter\n    if (dateFrom || dateTo) {\n      whereClause.scanned_at = {};\n      if (dateFrom) {\n        whereClause.scanned_at.gte = new Date(dateFrom);\n      }\n      if (dateTo) {\n        const endDate = new Date(dateTo);\n        endDate.setHours(23, 59, 59, 999); // End of day\n        whereClause.scanned_at.lte = endDate;\n      }\n    }\n\n    // Add location filter\n    if (location) {\n      whereClause.scan_location = {\n        contains: location\n      };\n    }\n\n    // Fetch scan history\n    const scans = await prisma.qrScan.findMany({\n      where: whereClause,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        },\n        submission: {\n          select: {\n            id: true,\n            simlok_number: true,\n            vendor_name: true,\n            officer_name: true,\n            job_description: true,\n            work_location: true,\n            approval_status: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      },\n      take: limit,\n      skip: offset,\n    });\n\n    // Get total count\n    const totalCount = await prisma.qrScan.count({\n      where: whereClause,\n    });\n\n    return NextResponse.json({\n      scans,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount,\n      }\n    });\n\n  } catch (error) {\n    console.error('Scan history fetch error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error while fetching scan history' \n    }, { status: 500 });\n  }\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "reviewer",
              "children": [
                {
                  "type": "directory",
                  "name": "simloks",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "review",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\nimport { notifyApproverReviewedSubmission } from '@/server/events';\n\n// Schema for validating review data\nconst reviewSchema = z.object({\n  review_status: z.enum(['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS']),\n  review_note: z.string().optional(),\n  final_note: z.string().optional(),\n});\n\n// PATCH /api/reviewer/simloks/[id]/review - Set review status and note\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still reviewable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        final_status: true,\n        user_id: true,\n        user: {\n          select: {\n            vendor_name: true,\n            officer_name: true,\n          }\n        }\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot review after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot review submission after it has been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = reviewSchema.parse(body);\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: {\n        review_status: validatedData.review_status,\n        review_note: validatedData.review_note || null,\n        final_note: validatedData.final_note || null,\n        reviewed_by_id: session.user.id,\n        reviewed_at: new Date(),\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Notify approvers about the review result (both meets and doesn't meet requirements)\n    await notifyApproverReviewedSubmission(resolvedParams.id);\n\n    return NextResponse.json({ \n      submission: updatedSubmission,\n      message: 'Review submitted successfully'\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error submitting review:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                            }
                          ]
                        },
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating submission updates\nconst updateSubmissionSchema = z.object({\n  vendor_name: z.string().optional(),\n  vendor_phone: z.string().optional(),\n  based_on: z.string().optional(),\n  officer_name: z.string().optional(),\n  job_description: z.string().optional(),\n  work_location: z.string().optional(),\n  implementation: z.string().optional(),\n  working_hours: z.string().optional(),\n  other_notes: z.string().optional(),\n  work_facilities: z.string().optional(),\n  worker_count: z.number().optional(),\n  simja_number: z.string().optional(),\n  simja_date: z.string().optional(),\n  sika_number: z.string().optional(),\n  sika_date: z.string().optional(),\n  implementation_start_date: z.string().optional(),\n  implementation_end_date: z.string().optional(),\n  worker_names: z.string().optional(),\n  content: z.string().optional(),\n  notes: z.string().optional(),\n\n  signer_position: z.string().optional(),\n  signer_name: z.string().optional(),\n});\n\n// GET /api/reviewer/simloks/[id] - Get single submission for review\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const submission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n            phone_number: true,\n            address: true,\n            role: true,\n            verified_at: true,\n            verified_by: true,\n            created_at: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ submission });\n  } catch (error) {\n    console.error('Error fetching submission for review:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// PATCH /api/reviewer/simloks/[id] - Update submission content (only if not finalized)\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still editable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        final_status: true,\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot edit after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot edit submission after it has been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = updateSubmissionSchema.parse(body);\n\n    // Convert date strings to Date objects if provided and not empty\n    const updateData: any = { ...validatedData };\n    \n    // Remove empty date fields or convert to Date objects\n    if (validatedData.simja_date && validatedData.simja_date.trim() !== '') {\n      updateData.simja_date = new Date(validatedData.simja_date);\n    } else {\n      updateData.simja_date = null;\n    }\n    \n    if (validatedData.sika_date && validatedData.sika_date.trim() !== '') {\n      updateData.sika_date = new Date(validatedData.sika_date);\n    } else {\n      updateData.sika_date = null;\n    }\n    \n    if (validatedData.implementation_start_date && validatedData.implementation_start_date.trim() !== '') {\n      updateData.implementation_start_date = new Date(validatedData.implementation_start_date);\n    } else {\n      updateData.implementation_start_date = null;\n    }\n    \n    if (validatedData.implementation_end_date && validatedData.implementation_end_date.trim() !== '') {\n      updateData.implementation_end_date = new Date(validatedData.implementation_end_date);\n    } else {\n      updateData.implementation_end_date = null;\n    }\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n            phone_number: true,\n            address: true,\n            role: true,\n            verified_at: true,\n            verified_by: true,\n            created_at: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          }\n        }\n      }\n    });\n\n    console.log('Submission updated successfully by reviewer:', session.user.id);\n    \n    return NextResponse.json({\n      message: 'Submission updated successfully',\n      submission: updatedSubmission\n    });\n\n  } catch (error) {\n    console.error('Error updating submission:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json({\n        error: 'Invalid request data',\n        details: error.issues\n      }, { status: 400 });\n    }\n\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        },
                        {
                          "type": "directory",
                          "name": "workers",
                          "children": [
                            {
                              "type": "directory",
                              "name": "[workerId]",
                              "children": [
                                {
                                  "type": "file",
                                  "name": "route.ts",
                                  "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport fs from 'fs';\nimport path from 'path';\n\n// DELETE /api/reviewer/simloks/[id]/workers/[workerId] - Delete worker photo\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string; workerId: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const { id, workerId } = resolvedParams;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still editable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        final_status: true,\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot edit after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot delete worker after submission has been finalized' \n      }, { status: 400 });\n    }\n\n    // Find the worker photo to delete\n    const workerPhoto = await prisma.workerList.findUnique({\n      where: { id: workerId },\n      select: {\n        id: true,\n        worker_photo: true,\n        submission_id: true,\n      }\n    });\n\n    if (!workerPhoto) {\n      return NextResponse.json({ error: 'Worker photo not found' }, { status: 404 });\n    }\n\n    // Verify the worker belongs to this submission\n    if (workerPhoto.submission_id !== id) {\n      return NextResponse.json({ error: 'Worker does not belong to this submission' }, { status: 400 });\n    }\n\n    // Delete the physical file if it exists\n    try {\n      const photoPath = workerPhoto.worker_photo;\n      // Extract the relative path from the URL (assuming it starts with /uploads/)\n      if (photoPath && photoPath.startsWith('/uploads/')) {\n        const relativePath = photoPath.substring(1); // Remove leading slash\n        const fullPath = path.join(process.cwd(), 'public', relativePath);\n        \n        if (fs.existsSync(fullPath)) {\n          fs.unlinkSync(fullPath);\n          console.log('Physical file deleted:', fullPath);\n        }\n      }\n    } catch (fileError) {\n      console.error('Error deleting physical file:', fileError);\n      // Continue with database deletion even if file deletion fails\n    }\n\n    // Delete the worker photo from database\n    await prisma.workerList.delete({\n      where: { id: workerId }\n    });\n\n    console.log('Worker photo deleted successfully by reviewer:', session.user.id);\n    \n    return NextResponse.json({\n      message: 'Worker photo deleted successfully'\n    });\n\n  } catch (error) {\n    console.error('Error deleting worker photo:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                                }
                              ]
                            },
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    // Check if submission exists\n    const submission = await prisma.submission.findUnique({\n      where: { id: id }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers for reviewer:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "directory",
                      "name": "export",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport * as XLSX from 'xlsx';\n\n// GET /api/reviewer/simloks/export - Export submissions to Excel\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const reviewStatus = searchParams.get('reviewStatus');\n    const finalStatus = searchParams.get('finalStatus');\n    const search = searchParams.get('search');\n    const startDate = searchParams.get('startDate');\n    const endDate = searchParams.get('endDate');\n\n    const whereClause: any = {};\n\n    // Apply same filters as the main submissions list\n    if (reviewStatus && ['PENDING_REVIEW', 'MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {\n      whereClause.review_status = reviewStatus;\n    }\n\n    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {\n      whereClause.final_status = finalStatus;\n    }\n\n    if (search) {\n      whereClause.OR = [\n        { vendor_name: { contains: search } },\n        { job_description: { contains: search } },\n        { officer_name: { contains: search } }\n      ];\n    }\n\n    // Date range filter\n    if (startDate || endDate) {\n      whereClause.created_at = {};\n      if (startDate) {\n        whereClause.created_at.gte = new Date(startDate);\n      }\n      if (endDate) {\n        const endDateTime = new Date(endDate);\n        endDateTime.setHours(23, 59, 59, 999);\n        whereClause.created_at.lte = endDateTime;\n      }\n    }\n\n    // Fetch all submissions matching the filters\n    const submissions = await prisma.submission.findMany({\n      where: whereClause,\n      select: {\n        id: true,\n        vendor_name: true,\n        officer_name: true,\n        job_description: true,\n        work_location: true,\n        implementation: true,\n        working_hours: true,\n        other_notes: true,\n        work_facilities: true,\n        based_on: true,\n        approval_status: true,\n        review_status: true,\n        final_status: true,\n        content: true,\n        notes: true,\n        review_note: true,\n        final_note: true,\n        simja_number: true,\n        simja_date: true,\n        sika_number: true,\n        sika_date: true,\n        simlok_number: true,\n        simlok_date: true,\n        signer_name: true,\n        signer_position: true,\n        created_at: true,\n        reviewed_at: true,\n        approved_at: true,\n        user: {\n          select: {\n            email: true,\n            phone_number: true,\n            verification_status: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            worker_name: true,\n          }\n        },\n        _count: {\n          select: {\n            qrScans: true\n          }\n        },\n        qrScans: {\n          select: {\n            scanned_at: true,\n            scan_location: true,\n          },\n          orderBy: {\n            scanned_at: 'desc'\n          },\n          take: 1\n        }\n      },\n      orderBy: { created_at: 'desc' },\n    });\n\n    // Format data for Excel export\n    const excelData = submissions.map((submission, index) => {\n      // Get worker names as comma-separated string\n      const workerNames = submission.worker_list.map(w => w.worker_name).join(', ');\n      \n      // Format dates\n      const formatDate = (date: Date | string | null) => {\n        if (!date) return '-';\n        const d = new Date(date);\n        return d.toLocaleDateString('id-ID', {\n          day: '2-digit',\n          month: '2-digit',\n          year: 'numeric',\n          hour: '2-digit',\n          minute: '2-digit'\n        });\n      };\n\n      // Format status\n      const formatStatus = (status: string) => {\n        switch (status) {\n          case 'PENDING_REVIEW': return 'Menunggu Review';\n          case 'MEETS_REQUIREMENTS': return 'Memenuhi Syarat';\n          case 'NOT_MEETS_REQUIREMENTS': return 'Tidak Memenuhi Syarat';\n          case 'PENDING_APPROVAL': return 'Menunggu Persetujuan';\n          case 'APPROVED': return 'Disetujui';\n          case 'REJECTED': return 'Ditolak';\n          default: return status;\n        }\n      };\n\n      return {\n        'No': index + 1,\n        'Tanggal Pengajuan': formatDate(submission.created_at),\n        'Nama Vendor': submission.vendor_name,\n        'Penanggung Jawab': submission.officer_name,\n        'Email Vendor': submission.user?.email || '-',\n        'Telepon': submission.user?.phone_number || '-',\n        'Status Verifikasi Vendor': submission.user?.verification_status || '-',\n        'Deskripsi Pekerjaan': submission.job_description,\n        'Lokasi Kerja': submission.work_location,\n        'Pelaksanaan': submission.implementation || '-',\n        'Jam Kerja': submission.working_hours,\n        'Fasilitas Kerja': submission.work_facilities,\n        'Berdasarkan': submission.based_on,\n        'Catatan Lain': submission.other_notes || '-',\n        'Daftar Pekerja': workerNames,\n        'Jumlah Pekerja': submission.worker_list.length,\n        'Status Review': formatStatus(submission.review_status),\n        'Status Final': formatStatus(submission.final_status),\n        'Catatan Review': submission.review_note || '-',\n        'Catatan Final': submission.final_note || '-',\n        'Reviewer': submission.reviewed_by_user?.officer_name || '-',\n        'Email Reviewer': submission.reviewed_by_user?.email || '-',\n        'Approver': submission.approved_by_final_user?.officer_name || '-',\n        'Email Approver': submission.approved_by_final_user?.email || '-',\n        'Tanggal Review': formatDate(submission.reviewed_at),\n        'Tanggal Approval': formatDate(submission.approved_at),\n        'Nomor SIMJA': submission.simja_number || '-',\n        'Tanggal SIMJA': submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '-',\n        'Nomor SIKA': submission.sika_number || '-',\n        'Tanggal SIKA': submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '-',\n        'Nomor SIMLOK': submission.simlok_number || '-',\n        'Tanggal SIMLOK': submission.simlok_date ? new Date(submission.simlok_date).toLocaleDateString('id-ID') : '-',\n        'Nama Penandatangan': submission.signer_name || '-',\n        'Jabatan Penandatangan': submission.signer_position || '-',\n        'Jumlah Scan QR': submission._count.qrScans,\n        'Terakhir Discan': submission.qrScans[0] ? formatDate(submission.qrScans[0].scanned_at) : '-',\n        'Lokasi Scan Terakhir': submission.qrScans[0]?.scan_location || '-',\n      };\n    });\n\n    // Create workbook and worksheet\n    const workbook = XLSX.utils.book_new();\n    const worksheet = XLSX.utils.json_to_sheet(excelData);\n\n    // Set column widths for better readability\n    const columnWidths = [\n      { wch: 5 },   // No\n      { wch: 18 },  // Tanggal Pengajuan\n      { wch: 25 },  // Nama Vendor\n      { wch: 20 },  // Penanggung Jawab\n      { wch: 25 },  // Email Vendor\n      { wch: 15 },  // Telepon\n      { wch: 15 },  // Status Verifikasi\n      { wch: 40 },  // Deskripsi Pekerjaan\n      { wch: 30 },  // Lokasi Kerja\n      { wch: 20 },  // Pelaksanaan\n      { wch: 15 },  // Jam Kerja\n      { wch: 30 },  // Fasilitas Kerja\n      { wch: 15 },  // Berdasarkan\n      { wch: 30 },  // Catatan Lain\n      { wch: 50 },  // Daftar Pekerja\n      { wch: 12 },  // Jumlah Pekerja\n      { wch: 18 },  // Status Review\n      { wch: 18 },  // Status Final\n      { wch: 30 },  // Catatan Review\n      { wch: 30 },  // Catatan Final\n      { wch: 20 },  // Reviewer\n      { wch: 25 },  // Email Reviewer\n      { wch: 20 },  // Approver\n      { wch: 25 },  // Email Approver\n      { wch: 18 },  // Tanggal Review\n      { wch: 18 },  // Tanggal Approval\n      { wch: 15 },  // Nomor SIMJA\n      { wch: 15 },  // Tanggal SIMJA\n      { wch: 15 },  // Nomor SIKA\n      { wch: 15 },  // Tanggal SIKA\n      { wch: 15 },  // Nomor SIMLOK\n      { wch: 15 },  // Tanggal SIMLOK\n      { wch: 25 },  // Nama Penandatangan\n      { wch: 25 },  // Jabatan Penandatangan\n      { wch: 12 },  // Jumlah Scan QR\n      { wch: 18 },  // Terakhir Discan\n      { wch: 20 },  // Lokasi Scan Terakhir\n    ];\n    worksheet['!cols'] = columnWidths;\n\n    // Add worksheet to workbook\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Pengajuan SIMLOK');\n\n    // Generate Excel buffer\n    const excelBuffer = XLSX.write(workbook, { \n      type: 'buffer', \n      bookType: 'xlsx',\n      compression: true \n    });\n\n    // Generate filename with timestamp\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];\n    let filename = `Data_Pengajuan_SIMLOK_${timestamp}`;\n    \n    // Add filter info to filename\n    const filters = [];\n    if (reviewStatus) filters.push(reviewStatus);\n    if (finalStatus) filters.push(finalStatus);\n    if (search) filters.push(`search-${search.substring(0, 10)}`);\n    if (startDate || endDate) {\n      if (startDate && endDate) {\n        const start = new Date(startDate).toISOString().split('T')[0];\n        const end = new Date(endDate).toISOString().split('T')[0];\n        filters.push(`${start}_to_${end}`);\n      } else if (startDate) {\n        const start = new Date(startDate).toISOString().split('T')[0];\n        filters.push(`dari_${start}`);\n      } else if (endDate) {\n        const end = new Date(endDate).toISOString().split('T')[0];\n        filters.push(`sampai_${end}`);\n      }\n    }\n    \n    if (filters.length > 0) {\n      filename += `_${filters.join('_')}`;\n    }\n    \n    filename += '.xlsx';\n\n    // Return Excel file\n    return new NextResponse(excelBuffer, {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\n        'Content-Length': excelBuffer.length.toString(),\n      },\n    });\n\n  } catch (error) {\n    console.error('Error exporting submissions to Excel:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        }
                      ]
                    },
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/reviewer/simloks - Get submissions for reviewer dashboard\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const reviewStatus = searchParams.get('reviewStatus');\n    const finalStatus = searchParams.get('finalStatus');\n    const vendorId = searchParams.get('vendorId');\n    const search = searchParams.get('search');\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {};\n\n    // Filter by review status if provided\n    if (reviewStatus && ['PENDING_REVIEW', 'MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {\n      whereClause.review_status = reviewStatus;\n    }\n\n    // Filter by final status if provided\n    if (finalStatus && finalStatus.trim()) {\n      if (['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {\n        whereClause.final_status = finalStatus;\n      }\n    }\n    // Note: If no finalStatus is provided, show all submissions (don't filter by final_status)\n\n    // Filter by vendor if provided\n    if (vendorId) {\n      whereClause.user_id = vendorId;\n    }\n\n    // Filter by search term (vendor name, job description, or officer name)\n    if (search) {\n      whereClause.OR = [\n        {\n          vendor_name: {\n            contains: search\n          }\n        },\n        {\n          job_description: {\n            contains: search\n          }\n        },\n        {\n          officer_name: {\n            contains: search\n          }\n        }\n      ];\n    }\n\n    const [submissions, total, statistics, userStats] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        select: {\n          id: true,\n          approval_status: true,\n          review_status: true,\n          final_status: true,\n          vendor_name: true,\n          based_on: true,\n          officer_name: true,\n          job_description: true,\n          work_location: true,\n          implementation: true,\n          working_hours: true,\n          other_notes: true,\n          work_facilities: true,\n          simlok_number: true,\n          simlok_date: true,\n          created_at: true,\n          user: {\n            select: {\n              vendor_name: true,\n              officer_name: true,\n            }\n          },\n          reviewed_by_user: {\n            select: {\n              officer_name: true,\n            }\n          },\n          qrScans: {\n            select: {\n              scanned_at: true,\n            },\n            orderBy: {\n              scanned_at: 'desc'\n            },\n            take: 1\n          },\n          _count: {\n            select: {\n              qrScans: true\n            }\n          }\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n      // Get statistics for reviewer dashboard\n      prisma.submission.groupBy({\n        by: ['review_status'],\n        where: {\n          final_status: 'PENDING_APPROVAL'\n        },\n        _count: {\n          review_status: true\n        }\n      }),\n      // Get user verification statistics\n      Promise.all([\n        prisma.user.count({\n          where: { \n            role: 'VENDOR',\n            verified_at: null \n          }\n        }),\n        prisma.user.count({\n          where: { \n            role: 'VENDOR',\n            verified_at: { not: null }\n          }\n        })\n      ])\n    ]);\n\n    // Format submissions with scan data and remove IDs\n    const formattedSubmissions = submissions.map(submission => ({\n      approval_status: submission.approval_status,\n      review_status: submission.review_status,\n      final_status: submission.final_status,\n      vendor_name: submission.vendor_name,\n      based_on: submission.based_on,\n      officer_name: submission.officer_name,\n      job_description: submission.job_description,\n      work_location: submission.work_location,\n      implementation: submission.implementation,\n      working_hours: submission.working_hours,\n      other_notes: submission.other_notes,\n      work_facilities: submission.work_facilities,\n      simlok_number: submission.simlok_number,\n      simlok_date: submission.simlok_date,\n      created_at: submission.created_at,\n      scan_count: submission._count.qrScans,\n      last_scanned_at: submission.qrScans[0]?.scanned_at || null,\n      user: {\n        vendor_name: submission.vendor_name,\n        officer_name: submission.officer_name,\n      },\n      reviewed_by_user: submission.reviewed_by_user ? {\n        officer_name: submission.reviewed_by_user.officer_name,\n      } : null,\n      // Keep ID for internal operations but don't expose in list view\n      id: submission.id\n    }));\n\n    // Format statistics for frontend\n    const [pendingUserVerifications, totalVerifiedUsers] = userStats;\n    const stats = {\n      total: total,\n      pendingReview: statistics.find(s => s.review_status === 'PENDING_REVIEW')?._count.review_status || 0,\n      meetsRequirements: statistics.find(s => s.review_status === 'MEETS_REQUIREMENTS')?._count.review_status || 0,\n      notMeetsRequirements: statistics.find(s => s.review_status === 'NOT_MEETS_REQUIREMENTS')?._count.review_status || 0,\n      pendingUserVerifications,\n      totalVerifiedUsers\n    };\n\n    return NextResponse.json({\n      submissions: formattedSubmissions,\n      stats,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching reviewer submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating user verification data\nconst userVerificationSchema = z.object({\n  status: z.enum(['VERIFY', 'REJECT']),\n  note: z.string().optional(),\n});\n\n// PATCH /api/reviewer/users/[id] - Verify or reject user\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if user exists and is a vendor\n    const existingUser = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        role: true,\n        verified_at: true,\n        verification_status: true,\n        rejection_reason: true,\n        rejected_at: true,\n        created_at: true\n      }\n    });\n\n    if (!existingUser) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    if (existingUser.role !== 'VENDOR') {\n      return NextResponse.json({ error: 'Only vendor users can be verified' }, { status: 400 });\n    }\n\n    // Check if user is already verified\n    if (existingUser.verified_at || existingUser.verification_status === 'VERIFIED') {\n      return NextResponse.json({ error: 'User has already been verified' }, { status: 400 });\n    }\n\n    // Check if user is already rejected\n    if (existingUser.rejection_reason || existingUser.verification_status === 'REJECTED') {\n      return NextResponse.json({ error: 'User has already been rejected' }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = userVerificationSchema.parse(body);\n\n    let updatedUser;\n    let notificationTitle: string;\n    let notificationMessage: string;\n    let notificationType: string;\n\n    if (validatedData.status === 'VERIFY') {\n      console.log(`Verifying user ${id} by ${session.user.id}`);\n      \n      // Verify the user\n      updatedUser = await prisma.user.update({\n        where: { id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n          verification_status: 'VERIFIED'\n        },\n        include: {\n          submissions: {\n            select: { id: true }\n          }\n        }\n      });\n      \n      console.log(`User ${id} verification status updated to:`, updatedUser.verification_status);\n\n      notificationTitle = 'Akun Anda Telah Diverifikasi';\n      notificationMessage = 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.';\n      notificationType = 'user_verified';\n    } else {\n      // Reject the user - update status instead of deleting\n      updatedUser = await prisma.user.update({\n        where: { id },\n        data: {\n          verification_status: 'REJECTED',\n          rejected_at: new Date(),\n          rejected_by: session.user.officer_name,\n          rejection_reason: validatedData.note || 'No reason provided'\n        },\n        include: {\n          submissions: {\n            select: { id: true }\n          }\n        }\n      });\n\n      notificationTitle = 'Akun Anda Ditolak';\n      notificationMessage = `Maaf, akun vendor Anda tidak dapat diverifikasi. ${validatedData.note || 'Silakan hubungi super admin untuk informasi lebih lanjut.'}`;\n      notificationType = 'user_rejected';\n    }\n\n    // Create notification for the user\n    await prisma.notification.create({\n      data: {\n        scope: 'vendor',\n        vendor_id: id,\n        type: notificationType,\n        title: notificationTitle,\n        message: notificationMessage,\n        data: JSON.stringify({\n          userId: id,\n          verificationStatus: validatedData.status,\n          verifiedBy: session.user.officer_name,\n          verifiedAt: validatedData.status === 'VERIFY' ? new Date().toISOString() : null,\n          rejectedAt: validatedData.status === 'REJECT' ? new Date().toISOString() : null,\n          note: validatedData.note\n        })\n      }\n    });\n\n    // Notify the user via real-time events\n    const { notifyUserVerificationResult } = await import('@/server/events');\n    await notifyUserVerificationResult(id, validatedData.status, validatedData.note);\n\n    const responseData = { \n      user: {\n        id: updatedUser.id,\n        email: updatedUser.email,\n        officer_name: updatedUser.officer_name,\n        vendor_name: updatedUser.vendor_name,\n        verified_at: updatedUser.verified_at,\n        verification_status: updatedUser.verification_status,\n        rejected_at: updatedUser.rejected_at,\n        rejected_by: updatedUser.rejected_by,\n        rejection_reason: updatedUser.rejection_reason,\n        verified_by: validatedData.status === 'VERIFY' ? session.user.id : null\n      },\n      message: `User ${validatedData.status === 'VERIFY' ? 'verified' : 'rejected'} successfully`\n    };\n    \n    console.log('API Response:', JSON.stringify(responseData, null, 2));\n    \n    return NextResponse.json(responseData);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error verifying user:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// GET /api/reviewer/users/[id] - Get user details for verification\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        address: true,\n        phone_number: true,\n        profile_photo: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        submissions: {\n          select: {\n            id: true,\n            job_description: true,\n            approval_status: true,\n            created_at: true\n          },\n          orderBy: { created_at: 'desc' },\n          take: 5 // Show recent submissions\n        }\n      }\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ user });\n  } catch (error) {\n    console.error('Error fetching user details:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        }
                      ]
                    },
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/reviewer/users - Get pending user verifications\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const search = searchParams.get('search');\n    const status = searchParams.get('status'); // 'pending' | 'verified'\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {\n      role: 'VENDOR' // Only show vendor users for verification\n    };\n\n    // Filter by verification status\n    if (status === 'pending') {\n      whereClause.verification_status = 'PENDING';\n    } else if (status === 'verified') {\n      whereClause.verification_status = 'VERIFIED';\n    } else if (status === 'rejected') {\n      whereClause.verification_status = 'REJECTED';\n    }\n\n    // Search by name, vendor name, or email\n    if (search) {\n      whereClause.OR = [\n        { officer_name: { contains: search } },\n        { vendor_name: { contains: search } },\n        { email: { contains: search } }\n      ];\n    }\n\n    // Get users with pagination\n    const [users, totalCount] = await Promise.all([\n      prisma.user.findMany({\n        where: whereClause,\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          address: true,\n          phone_number: true,\n          profile_photo: true,\n          created_at: true,\n          verified_at: true,\n          verified_by: true,\n          verification_status: true,\n          rejected_at: true,\n          rejected_by: true,\n          rejection_reason: true,\n          role: true\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.user.count({ where: whereClause })\n    ]);\n\n    // Get verification stats\n    const stats = {\n      totalPending: await prisma.user.count({\n        where: { \n          role: 'VENDOR',\n          verification_status: 'PENDING'\n        }\n      }),\n      totalVerified: await prisma.user.count({\n        where: { \n          role: 'VENDOR',\n          verification_status: 'VERIFIED'\n        }\n      }),\n      totalRejected: await prisma.user.count({\n        where: { \n          role: 'VENDOR',\n          verification_status: 'REJECTED'\n        }\n      }),\n      totalUsers: await prisma.user.count({\n        where: { role: 'VENDOR' }\n      }),\n      todayRegistrations: await prisma.user.count({\n        where: {\n          role: 'VENDOR',\n          created_at: {\n            gte: new Date(new Date().setHours(0, 0, 0, 0))\n          }\n        }\n      })\n    };\n\n    return NextResponse.json({\n      users,\n      pagination: {\n        page,\n        limit,\n        total: totalCount,\n        totalPages: Math.ceil(totalCount / limit),\n      },\n      stats\n    });\n  } catch (error) {\n    console.error('Error fetching users for verification:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "vendors",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "approve",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating vendor approval\nconst approveVendorSchema = z.object({\n  approve: z.boolean(),\n});\n\n// PATCH /api/reviewer/vendors/[id]/approve - Approve or reject vendor registration\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can approve vendors\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const body = await request.json();\n    const { approve } = approveVendorSchema.parse(body);\n\n    // Find the vendor user\n    const vendor = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id,\n        role: 'VENDOR'\n      },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        verified_at: true,\n      }\n    });\n\n    if (!vendor) {\n      return NextResponse.json({ error: 'Vendor not found' }, { status: 404 });\n    }\n\n    if (vendor.verified_at) {\n      return NextResponse.json({ error: 'Vendor is already verified' }, { status: 400 });\n    }\n\n    if (approve) {\n      // Approve the vendor\n      const updatedVendor = await prisma.user.update({\n        where: { id: resolvedParams.id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n        },\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          verified_at: true,\n        }\n      });\n\n      // Create notification for the vendor\n      await prisma.notification.create({\n        data: {\n          scope: 'vendor',\n          vendor_id: vendor.id,\n          type: 'vendor_approved',\n          title: 'Akun Vendor Disetujui',\n          message: 'Selamat! Akun vendor Anda telah disetujui dan dapat mulai mengajukan Simlok.',\n          data: JSON.stringify({\n            vendorId: vendor.id,\n            approvedBy: session.user.officer_name,\n          }),\n        }\n      });\n\n      return NextResponse.json({ \n        vendor: updatedVendor,\n        message: 'Vendor approved successfully'\n      });\n    } else {\n      // For rejection, we might want to delete the vendor or mark as rejected\n      // For now, let's just create a notification\n      await prisma.notification.create({\n        data: {\n          scope: 'vendor',\n          vendor_id: vendor.id,\n          type: 'vendor_rejected',\n          title: 'Akun Vendor Ditolak',\n          message: 'Maaf, akun vendor Anda ditolak. Silakan hubungi administrator untuk informasi lebih lanjut.',\n          data: JSON.stringify({\n            vendorId: vendor.id,\n            rejectedBy: session.user.officer_name,\n          }),\n        }\n      });\n\n      return NextResponse.json({ \n        message: 'Vendor registration rejected'\n      });\n    }\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error processing vendor approval:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "worker-photos",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[photoId]",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport fs from 'fs/promises';\nimport path from 'path';\n\n// DELETE /api/reviewer/worker-photos/[photoId] - Delete worker photo\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ photoId: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    \n    // Find the worker and check if the submission is still editable\n    const worker = await prisma.workerList.findUnique({\n      where: { id: resolvedParams.photoId },\n      include: {\n        submission: {\n          select: {\n            id: true,\n            final_status: true,\n          }\n        }\n      }\n    });\n\n    if (!worker) {\n      return NextResponse.json({ error: 'Worker not found' }, { status: 404 });\n    }\n\n    // Cannot delete photos after submission is finalized\n    if (worker.submission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot delete worker photo after submission has been finalized' \n      }, { status: 400 });\n    }\n\n    // If worker has a photo, delete the file\n    if (worker.worker_photo) {\n      try {\n        const photoPath = path.join(process.cwd(), 'public', worker.worker_photo);\n        await fs.unlink(photoPath);\n      } catch (fileError) {\n        console.warn('Failed to delete photo file:', fileError);\n        // Continue with database deletion even if file deletion fails\n      }\n    }\n\n    // Update worker to remove photo reference\n    const updatedWorker = await prisma.workerList.update({\n      where: { id: resolvedParams.photoId },\n      data: {\n        worker_photo: null,\n      }\n    });\n\n    return NextResponse.json({ \n      worker: updatedWorker,\n      message: 'Worker photo deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting worker photo:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "scan-history",
              "children": [
                {
                  "type": "file",
                  "name": "route.ts",
                  "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history\n    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const dateFrom = searchParams.get('dateFrom');\n    const dateTo = searchParams.get('dateTo');\n    const verifier = searchParams.get('verifier');\n    const submissionId = searchParams.get('submissionId');\n    const search = searchParams.get('search');\n\n    const skip = (page - 1) * limit;\n\n    // Build filter conditions\n    const where: any = {};\n    \n    if (dateFrom || dateTo) {\n      where.scanned_at = {};\n      if (dateFrom) {\n        where.scanned_at.gte = new Date(dateFrom);\n      }\n      if (dateTo) {\n        // Add 1 day to include the entire date\n        const endDate = new Date(dateTo);\n        endDate.setDate(endDate.getDate() + 1);\n        where.scanned_at.lt = endDate;\n      }\n    }\n\n    if (verifier) {\n      where.user = {\n        officer_name: {\n          contains: verifier\n        }\n      };\n    }\n\n    if (submissionId) {\n      where.submission = {\n        simlok_number: {\n          contains: submissionId\n        }\n      };\n    }\n\n    // Add search functionality\n    if (search) {\n      where.OR = [\n        {\n          submission: {\n            simlok_number: {\n              contains: search\n            }\n          }\n        },\n        {\n          submission: {\n            vendor_name: {\n              contains: search\n            }\n          }\n        },\n        {\n          user: {\n            officer_name: {\n              contains: search\n            }\n          }\n        },\n        {\n          scan_location: {\n            contains: search\n          }\n        }\n      ];\n    }\n\n    // Get total count for pagination\n    const total = await prisma.qrScan.count({ where });\n\n    // Get scan history with related data\n    const scans = await prisma.qrScan.findMany({\n      where,\n      include: {\n        submission: {\n          select: {\n            id: true,\n            simlok_number: true,\n            vendor_name: true,\n            job_description: true,\n            review_status: true,\n            final_status: true,\n          }\n        },\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      },\n      skip,\n      take: limit,\n    });\n\n    return NextResponse.json({\n      scans,\n      total,\n      page,\n      limit,\n      totalPages: Math.ceil(total / limit)\n    });\n\n  } catch (error) {\n    console.error('Error fetching scan history:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
                }
              ]
            },
            {
              "type": "directory",
              "name": "socket",
              "children": [
                {
                  "type": "file",
                  "name": "route.ts",
                  "content": "import { io } from '@/server/socket';\nimport { NextRequest } from 'next/server';\n\nexport const runtime = 'nodejs';\n\nexport async function GET(_request: NextRequest) {\n  if (!io.httpServer) {\n    // Attach to global server if not attached\n    const server = (globalThis as any).__socket_server;\n    if (server) {\n      io.attach(server);\n    }\n  }\n  \n  return new Response('Socket.IO server is running', { \n    status: 200,\n    headers: {\n      'Content-Type': 'text/plain'\n    }\n  });\n}\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "submissions",
              "children": [
                {
                  "type": "directory",
                  "name": "[id]",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { generateSIMLOKPDF, type SubmissionPDFData } from '@/utils/pdf/simlokTemplate';\nimport { notifyVendorStatusChange } from '@/server/events';\nimport { cleanupSubmissionNotifications } from '@/lib/notificationCleanup';\nimport { generateQrString } from '@/lib/qr-security';\n\n// Function to generate auto SIMLOK number\nasync function generateSimlokNumber(): Promise<string> {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n  // Get the last SIMLOK number for current month/year\n  const lastSubmission = await prisma.submission.findFirst({\n    where: {\n      simlok_number: {\n        contains: `/${month}/${year}`\n      }\n    },\n    orderBy: {\n      simlok_number: 'desc'\n    }\n  });\n\n  let nextNumber = 1;\n  \n  if (lastSubmission?.simlok_number) {\n    // Extract number from format: number/MM/YYYY\n    const match = lastSubmission.simlok_number.match(/^(\\d+)\\/\\d{2}\\/\\d{4}$/);\n    if (match && match[1]) {\n      nextNumber = parseInt(match[1]) + 1;\n    }\n  }\n\n  return `${nextNumber}/${month}/${year}`;\n}\n\ninterface RouteParams {\n  params: Promise<{\n    id: string;\n  }>;\n}\n\n// GET /api/submissions/[id] - Get single submission with optional PDF generation\nexport async function GET(request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const { searchParams } = new URL(request.url);\n    const isPdfRequest = searchParams.get('format') === 'pdf';\n    const shouldClearCache = searchParams.get('clearCache') === 'true';\n\n    // Clear image cache if requested (for PDF generation)\n    if (shouldClearCache && isPdfRequest) {\n      try {\n        const { clearImageCache } = await import('@/utils/pdf/imageLoader');\n        clearImageCache();\n        console.log('API: Cleared image cache for fresh PDF generation');\n      } catch (error) {\n        console.warn('API: Failed to clear image cache:', error);\n      }\n    }\n\n    // Fetch submission with user and approved by user details\n    const submission = await prisma.submission.findFirst({\n      where: { \n        id,\n        // Vendors can only see their own submissions\n        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Check permissions\n    if (session.user.role === 'VENDOR' && submission.user_id !== session.user.id) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n    }\n\n    // If PDF is requested, generate and return PDF\n    if (isPdfRequest) {\n      return generatePDF(submission);\n    }\n\n    // Return regular JSON response\n    const response = NextResponse.json(submission);\n    \n    // Add cache control for better performance\n    response.headers.set('Cache-Control', 'private, max-age=60, stale-while-revalidate=300');\n    \n    return response;\n  } catch (error) {\n    console.error('Error fetching submission:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// Helper function to generate PDF\nasync function generatePDF(submission: any) {\n  try {\n    console.log('PDF Generation Debug:', {\n      submissionId: submission.id,\n      approval_status: submission.approval_status,\n      final_status: submission.final_status,\n      simlok_number: submission.simlok_number,\n      has_simlok_number: !!submission.simlok_number\n    });\n\n    // Allow PDF generation for any submission\n    // If no simlok_number, use a placeholder or generate temporary one\n    const pdfData = { ...submission };\n    \n    if (!submission.simlok_number) {\n      console.log('PDF Generation: Using placeholder simlok_number');\n      // Create a temporary/placeholder SIMLOK number for PDF preview\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      pdfData.simlok_number = `[DRAFT]/XX/${month}/${year}`;\n      pdfData.simlok_date = now;\n    }\n\n    // Generate PDF using the template with potentially modified data\n    const pdfBytes = await generateSIMLOKPDF(pdfData as SubmissionPDFData);\n\n    // Generate filename based on simlok_number (including placeholder)\n    const filename = pdfData.simlok_number ? \n      `SIMLOK_${pdfData.simlok_number.replace(/[\\[\\]/\\\\]/g, '_')}.pdf` :\n      `SIMLOK_PREVIEW_${submission.id}.pdf`;\n\n    // Return PDF response with proper cache control\n    return new NextResponse(Buffer.from(pdfBytes), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': `inline; filename=\"${filename}\"`,\n        'Cache-Control': 'no-store, no-cache, must-revalidate, proxy-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0',\n      },\n    });\n\n  } catch (error) {\n    console.error('Error generating PDF:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate PDF' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT /api/submissions/[id] - Update submission (Admin for approval, Vendor for editing PENDING submissions)\nexport async function PUT(request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    console.log('PUT /api/submissions/[id] - Session:', {\n      userId: session?.user?.id,\n      role: session?.user?.role,\n      email: session?.user?.email\n    });\n    \n    if (!session?.user) {\n      console.log('PUT /api/submissions/[id] - No session found');\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    console.log('PUT /api/submissions/[id] - Submission ID:', id);\n\n    // First, fetch the existing submission\n    const existingSubmission = await prisma.submission.findFirst({\n      where: { \n        id,\n        // Vendors can only edit their own submissions\n        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})\n      }\n    });\n\n    console.log('PUT /api/submissions/[id] - Existing submission:', {\n      found: !!existingSubmission,\n      status: existingSubmission?.approval_status,\n      userId: existingSubmission?.user_id\n    });\n\n    if (!existingSubmission) {\n      console.log('PUT /api/submissions/[id] - Submission not found or access denied');\n      return NextResponse.json({ error: 'Submission not found or access denied' }, { status: 404 });\n    }\n\n    // Check permissions based on role\n    if (session.user.role === 'VENDOR') {\n      // Vendors can only edit PENDING submissions and only their own\n      if (existingSubmission.user_id !== session.user.id) {\n        console.log('PUT /api/submissions/[id] - Access denied: not owner');\n        return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n      }\n      \n      if (existingSubmission.approval_status !== 'PENDING') {\n        console.log('PUT /api/submissions/[id] - Cannot edit non-pending submission');\n        return NextResponse.json({ \n          error: 'Can only edit pending submissions' \n        }, { status: 400 });\n      }\n    }\n\n    const body = await request.json();\n    console.log('PUT /api/submissions/[id] - Request body keys:', Object.keys(body));\n\n    const updateData: any = {};\n    let statusChanged = false;\n    let newStatus: 'PENDING' | 'APPROVED' | 'REJECTED' | undefined;\n\n    // Handle different types of updates based on user role\n    if ( session.user.role === 'VERIFIER') {\n      // Admin/Verifier updating approval status\n      if (body.status_approval_admin && ['APPROVED', 'REJECTED'].includes(body.status_approval_admin)) {\n        console.log('PUT /api/submissions/[id] - Admin/Verifier approval update');\n        console.log('PUT /api/submissions/[id] - Session user ID:', session.user.id);\n        console.log('PUT /api/submissions/[id] - Session user role:', session.user.role);\n        \n        const approvalData: any = {\n          approval_status: body.status_approval_admin,\n          notes: body.keterangan,\n          simlok_date: body.tanggal_simlok ? new Date(body.tanggal_simlok) : undefined,\n        };\n\n        // Track status change for notification\n        if (existingSubmission.approval_status !== body.status_approval_admin) {\n          statusChanged = true;\n          newStatus = body.status_approval_admin;\n        }\n\n        // Only add fields that are provided and valid\n        Object.entries(approvalData).forEach(([key, value]) => {\n          if (value !== undefined && value !== null && value !== '') {\n            updateData[key] = value;\n          }\n        });\n\n        // If approving, add additional fields\n        if (body.status_approval_admin === 'APPROVED') {\n          // Generate auto SIMLOK number\n          const autoSimlokNumber = await generateSimlokNumber();\n          updateData.simlok_number = autoSimlokNumber;\n          \n          updateData.implementation = body.pelaksanaan;\n          updateData.other_notes = body.lain_lain;\n          updateData.content = body.content;\n          updateData.signer_position = body.jabatan_signer;\n          updateData.signer_name = body.nama_signer;\n          \n          // Add implementation date range if provided\n          if (body.implementation_start_date) {\n            updateData.implementation_start_date = new Date(body.implementation_start_date);\n          }\n          if (body.implementation_end_date) {\n            updateData.implementation_end_date = new Date(body.implementation_end_date);\n          }\n          \n          // Generate secure QR code with implementation dates\n          const qrString = generateQrString({\n            id: id,\n            implementation_start_date: body.implementation_start_date ? new Date(body.implementation_start_date) : null,\n            implementation_end_date: body.implementation_end_date ? new Date(body.implementation_end_date) : null,\n          });\n          updateData.qrcode = qrString;\n          \n          // Verify the user exists before setting approved_by\n          const adminUser = await prisma.user.findUnique({\n            where: { id: session.user.id }\n          });\n          \n          if (adminUser) {\n            updateData.approved_by = session.user.id;\n          } else {\n            console.log('PUT /api/submissions/[id] - Admin user not found:', session.user.id);\n            return NextResponse.json({ \n              error: 'Your session is no longer valid. Please log out and log back in to continue.',\n              code: 'INVALID_SESSION'\n            }, { status: 401 });\n          }\n        }\n      } else {\n        console.log('PUT /api/submissions/[id] - Invalid approval status:', body.status_approval_admin);\n        return NextResponse.json({ \n          error: 'Invalid approval status. Must be APPROVED or REJECTED' \n        }, { status: 400 });\n      }\n    } else if (session.user.role === 'VENDOR') {\n      // Vendor updating their submission\n      console.log('PUT /api/submissions/[id] - Vendor update');\n      \n      // Only allow vendor to update certain fields and only if submission is PENDING\n      const allowedFields = [\n        'vendor_name', 'based_on', 'officer_name', 'job_description', \n        'work_location', 'working_hours', 'work_facilities', 'worker_count',\n        'simja_number', 'simja_date', 'sika_number', 'sika_date', 'worker_names',\n        'sika_document_upload', 'simja_document_upload'\n      ];\n\n      allowedFields.forEach(field => {\n        if (body[field] !== undefined) {\n          updateData[field] = body[field];\n        }\n      });\n\n      // Handle date fields\n      if (body.simja_date) {\n        updateData.simja_date = new Date(body.simja_date);\n      }\n      if (body.sika_date) {\n        updateData.sika_date = new Date(body.sika_date);\n      }\n\n    }\n\n    // Perform the update\n    const updatedSubmission = await prisma.submission.update({\n      where: { id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Handle workers if provided (only for vendor updates)\n    if (session.user.role === 'VENDOR' && body.workers && Array.isArray(body.workers)) {\n      // Delete existing workers for this submission\n      await prisma.workerList.deleteMany({\n        where: {\n          submission_id: id\n        }\n      });\n\n      // Create new workers\n      const validWorkers = body.workers.filter((worker: any) => \n        worker.worker_name && worker.worker_name.trim() !== ''\n      );\n\n      if (validWorkers.length > 0) {\n        await prisma.workerList.createMany({\n          data: validWorkers.map((worker: any) => ({\n            worker_name: worker.worker_name.trim(),\n            worker_photo: worker.worker_photo || null,\n            submission_id: id\n          }))\n        });\n      }\n    }\n\n    // Notify vendor if status changed\n    if (statusChanged && newStatus && existingSubmission.user_id) {\n      await notifyVendorStatusChange(\n        existingSubmission.user_id,\n        id,\n        newStatus\n      );\n    }\n\n    console.log('PUT /api/submissions/[id] - Update successful');\n    return NextResponse.json(updatedSubmission);\n  } catch (error) {\n    console.error('PUT /api/submissions/[id] - Error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// DELETE /api/submissions/[id] - Delete submission \nexport async function DELETE(_request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n\n    // Fetch the submission first to check permissions\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Permission checks based on role\n    if (session.user.role === 'VENDOR') {\n      // Vendors can only delete their own PENDING submissions\n      if (existingSubmission.user_id !== session.user.id) {\n        return NextResponse.json({ \n          error: 'Access denied. You can only delete your own submissions.' \n        }, { status: 403 });\n      }\n      \n      if (existingSubmission.approval_status !== 'PENDING') {\n        return NextResponse.json({ \n          error: 'Can only delete pending submissions. Approved or rejected submissions cannot be deleted.' \n        }, { status: 400 });\n      }\n    } else  if (session.user.role === 'VERIFIER') {\n      // Verifiers can delete pending and rejected submissions\n      if (existingSubmission.approval_status === 'APPROVED') {\n        return NextResponse.json({ \n          error: 'Cannot delete approved submissions.' \n        }, { status: 400 });\n      }\n    } else {\n      return NextResponse.json({ \n        error: 'Invalid role. Only admins, verifiers, and vendors can delete submissions.' \n      }, { status: 403 });\n    }\n\n    // Clean up related notifications before deleting submission\n    await cleanupSubmissionNotifications(id);\n\n    // Delete the submission\n    await prisma.submission.delete({\n      where: { id }\n    });\n\n    return NextResponse.json({ \n      message: 'Submission deleted successfully',\n      deletedId: id \n    });\n\n  } catch (error) {\n    console.error('Error deleting submission:', error);\n    return NextResponse.json({ \n      error: 'Internal server error. Please try again later.' \n    }, { status: 500 });\n  }\n}\n"
                    },
                    {
                      "type": "directory",
                      "name": "scans",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history\n    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const submissionId = resolvedParams.id;\n\n    // Get scan history for the specific submission\n    const scans = await prisma.qrScan.findMany({\n      where: {\n        submission_id: submissionId\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      }\n    });\n\n    // Get total scan count\n    const totalScans = scans.length;\n    const lastScan = scans[0] || null;\n\n    return NextResponse.json({\n      scans,\n      totalScans,\n      lastScan,\n      hasBeenScanned: totalScans > 0\n    });\n\n  } catch (error) {\n    console.error('Error fetching submission scan history:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
                        }
                      ]
                    },
                    {
                      "type": "directory",
                      "name": "workers",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n\n    // Get submission - allow admin/reviewer/approver to access any submission, vendor only their own\n    let submission;\n    \n    if (['ADMIN', 'SUPER_ADMIN', 'REVIEWER', 'APPROVER'].includes(session.user.role)) {\n      submission = await prisma.submission.findUnique({\n        where: { id: id }\n      });\n    } else {\n      submission = await prisma.submission.findFirst({\n        where: {\n          id: id,\n          user_id: session.user.id\n        }\n      });\n    }\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "file",
                  "name": "route.ts",
                  "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { SubmissionData } from '@/types/submission';\nimport { notifyAdminNewSubmission } from '@/server/events';\n\n// GET /api/submissions - Get all submissions\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const status = searchParams.get('status');\n    const search = searchParams.get('search') || '';\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const vendorName = searchParams.get('vendor');\n    const includeStats = searchParams.get('stats') === 'true';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {};\n\n    // Filter by role\n    if (session.user.role === 'VENDOR') {\n      whereClause.user_id = session.user.id;\n    }\n\n    // Filter by status if provided\n    if (status) {\n      whereClause.approval_status = status;\n    }\n\n    // Filter by vendor name if provided (admin/verifier only)\n    if (vendorName && session.user.role !== 'VENDOR') {\n      whereClause.vendor_name = {\n        contains: vendorName\n      };\n    }\n\n    // Add search functionality\n    if (search) {\n      const searchConditions = [\n        { vendor_name: { contains: search } },\n        { officer_name: { contains: search } },\n        { job_description: { contains: search } },\n        { work_location: { contains: search } },\n        { worker_names: { contains: search } }\n      ];\n\n      whereClause.OR = searchConditions;\n    }\n\n    // Prepare orderBy\n    const orderBy: any = {};\n    orderBy[sortBy] = sortOrder;\n\n    const [submissions, total] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          },\n          approved_by_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          }\n        },\n        orderBy: orderBy,\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n    ]);\n\n    const response: any = {\n      submissions,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    };\n\n    // Include statistics for admin requests\n    if (includeStats && session.user.role === 'SUPER_ADMIN') {\n      const statistics = await prisma.submission.groupBy({\n        by: ['approval_status'],\n        _count: {\n          approval_status: true\n        }\n      });\n\n      response.statistics = {\n        total: total,\n        pending: statistics.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n        approved: statistics.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n        rejected: statistics.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n      };\n    }\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Error fetching submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// POST /api/submissions - Create new submission\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Debug logging\n    console.log('POST /api/submissions - Session user:', {\n      id: session.user.id,\n      email: session.user.email,\n      role: session.user.role\n    });\n\n    // Only VENDOR can create submissions\n    if (session.user.role !== 'VENDOR') {\n      return NextResponse.json({ error: 'Only vendors can create submissions' }, { status: 403 });\n    }\n\n    const body: SubmissionData = await request.json();\n\n    // Debug logging for received data\n    console.log('POST /api/submissions - Received data:', {\n      ...body,\n      // Don't log sensitive data, just check if required fields exist\n      hasRequiredFields: {\n        vendor_name: !!body.vendor_name,\n        based_on: !!body.based_on,\n        officer_name: !!body.officer_name,\n        job_description: !!body.job_description,\n        work_location: !!body.work_location,\n        working_hours: !!body.working_hours,\n        work_facilities: !!body.work_facilities,\n        worker_names: !!body.worker_names\n      }\n    });\n\n    // Validate required fields\n    const requiredFields = [\n      'vendor_name', 'based_on', 'officer_name', 'job_description',\n      'work_location', 'working_hours', 'work_facilities', 'worker_names'\n    ];\n\n    for (const field of requiredFields) {\n      if (!body[field as keyof SubmissionData]) {\n        console.log(`POST /api/submissions - Missing required field: ${field}`);\n        return NextResponse.json({\n          error: `Field ${field} is required`\n        }, { status: 400 });\n      }\n    }\n\n    // Validate session user ID\n    if (!session.user.id) {\n      console.log('POST /api/submissions - Session user ID is missing');\n      return NextResponse.json({\n        error: 'User ID not found in session'\n      }, { status: 400 });\n    }\n\n    // Verify user exists in database\n    const userExists = await prisma.user.findUnique({\n      where: { id: session.user.id }\n    });\n\n    if (!userExists) {\n      console.log('POST /api/submissions - User not found in database:', session.user.id);\n      return NextResponse.json({\n        error: 'User not found in database'\n      }, { status: 400 });\n    }\n\n    console.log('POST /api/submissions - User verified:', userExists.email);\n\n    // Extract workers data and remove it from body since it's not part of Submission model\n    const { workers, ...submissionData } = body as any;\n\n    // Generate QR Code (simple implementation)\n    const qrData = `${session.user.id}-${Date.now()}`;\n\n    try {\n      // Create submission first\n      const submission = await prisma.submission.create({\n        data: {\n          ...submissionData,\n          user_id: session.user.id,\n          vendor_phone: userExists.phone_number, // Auto-fill dari data user\n          worker_count: submissionData.worker_count || null,\n          simja_date: submissionData.simja_date ? new Date(submissionData.simja_date) : null,\n          sika_date: submissionData.sika_date ? new Date(submissionData.sika_date) : null,\n          qrcode: qrData,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          }\n        }\n      });\n\n      // Create workers if they exist\n      if (workers && Array.isArray(workers) && workers.length > 0) {\n        const workersData = workers.map((worker: any) => ({\n          worker_name: worker.worker_name,\n          worker_photo: worker.worker_photo || null,\n          submission_id: submission.id,\n        }));\n\n        await prisma.workerList.createMany({\n          data: workersData,\n        });\n\n        console.log('POST /api/submissions - Workers created:', workersData.length);\n      }\n\n      // Notify admin about new submission\n      await notifyAdminNewSubmission(submission.id);\n\n      console.log('POST /api/submissions - Submission created successfully:', submission.id);\n      return NextResponse.json(submission, { status: 201 });\n    } catch (dbError) {\n      console.error('POST /api/submissions - Database error:', dbError);\n      return NextResponse.json({\n        error: 'Failed to create submission in database'\n      }, { status: 500 });\n    }\n  } catch (error) {\n    console.error('POST /api/submissions - General error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "upload",
              "children": [
                {
                  "type": "directory",
                  "name": "enhanced",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "/**\n * Enhanced File Upload API with Validation and Compression\n * Demonstrates integration of FileValidationService and FileCompressionService\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { writeFile, mkdir } from 'fs/promises';\nimport { join } from 'path';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { FileValidationService } from '@/services/FileValidationService';\nimport { FileCompressionService } from '@/services/FileCompressionService';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const category = formData.get('category') as string || 'other';\n    \n    if (!file) {\n      return NextResponse.json(\n        { error: 'No file provided' },\n        { status: 400 }\n      );\n    }\n\n    // Create uploads directory\n    const uploadsDir = join(process.cwd(), 'uploads', 'temp');\n    await mkdir(uploadsDir, { recursive: true });\n\n    // Save temporary file\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    \n    const originalName = file.name;\n    const tempFilePath = join(uploadsDir, `temp_${Date.now()}_${originalName}`);\n    await writeFile(tempFilePath, buffer);\n\n    try {\n      // Step 1: Validate file\n      console.log('🔍 Validating file:', originalName);\n      const validationResult = await FileValidationService.validateSIMLOKFile(\n        tempFilePath,\n        originalName,\n        category as 'sika' | 'simja' | 'id_card' | 'other'\n      );\n\n      if (!validationResult.isValid) {\n        return NextResponse.json(\n          { \n            error: 'File validation failed',\n            message: validationResult.error,\n            securityChecks: validationResult.securityChecks\n          },\n          { status: 400 }\n        );\n      }\n\n      // Step 2: Compress file if needed\n      console.log('🗜️ Compressing file if needed...');\n      let compressionApplied = false;\n      \n      if (FileCompressionService.canCompress(validationResult.mimeType)) {\n        const compressionResult = await FileCompressionService.compressFile(\n          tempFilePath,\n          {\n            quality: 60, // 40% compression for mobile optimization\n            maxSizeBytes: 2 * 1024 * 1024, // 2MB max\n            outputDir: uploadsDir,\n          }\n        );\n\n        if (compressionResult.success && compressionResult.outputPath) {\n          compressionApplied = true;\n          console.log(`✅ Compression successful: ${compressionResult.originalSize} -> ${compressionResult.compressedSize}`);\n        }\n      }\n\n      // Step 3: Move to permanent location (simulation)\n      const finalDir = join(process.cwd(), 'uploads', category, session.user.id);\n      await mkdir(finalDir, { recursive: true });\n      \n      const finalFileName = `${Date.now()}_${originalName}`;\n      const permanentPath = join(finalDir, finalFileName);\n      \n      // In a real implementation, you would move the file and save to database\n      console.log('📁 Final file path:', permanentPath);\n\n      // Step 4: Return success response\n      const response = {\n        success: true,\n        message: 'File uploaded successfully',\n        file: {\n          originalName,\n          finalName: finalFileName,\n          size: validationResult.size,\n          mimeType: validationResult.mimeType,\n          category,\n        },\n        validation: {\n          isValid: validationResult.isValid,\n          securityChecks: validationResult.securityChecks,\n        },\n        compression: compressionApplied ? {\n          applied: true,\n          originalSize: validationResult.size,\n          // In real implementation, get actual compressed size\n          compressedSize: Math.floor(validationResult.size * 0.6),\n          quality: 60,\n        } : {\n          applied: false,\n          reason: 'File type does not support compression or already within size limits'\n        },\n        paths: {\n          category,\n          fileName: finalFileName,\n          relativePath: `/uploads/${category}/${session.user.id}/${finalFileName}`,\n        }\n      };\n\n      return NextResponse.json(response, { status: 200 });\n\n    } catch (processingError) {\n      console.error('File processing error:', processingError);\n      return NextResponse.json(\n        { \n          error: 'File processing failed',\n          message: processingError instanceof Error ? processingError.message : 'Unknown processing error'\n        },\n        { status: 500 }\n      );\n    }\n\n  } catch (error) {\n    console.error('File upload error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Get upload limits and allowed types\nexport async function GET() {\n  const config = {\n    maxFileSize: '10MB',\n    allowedTypes: [\n      'image/jpeg',\n      'image/png',\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    ],\n    allowedExtensions: [\n      '.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'\n    ],\n    categories: [\n      { id: 'sika', name: 'SIKA Documents', allowedTypes: ['image/*', 'application/pdf'] },\n      { id: 'simja', name: 'SIMJA Documents', allowedTypes: ['image/*', 'application/pdf'] },\n      { id: 'id_card', name: 'ID Card', allowedTypes: ['image/*'] },\n      { id: 'other', name: 'Other Documents', allowedTypes: ['image/*', 'application/pdf'] },\n    ],\n    compression: {\n      enabled: true,\n      targetSize: '1-2MB',\n      quality: '60% (40% compression)',\n      supportedFormats: ['JPEG', 'PNG', 'PDF']\n    },\n    validation: {\n      magicBytesCheck: true,\n      malwareScanning: true,\n      fileSignatureValidation: true,\n    }\n  };\n\n  return NextResponse.json(config);\n}"
                    }
                  ]
                },
                {
                  "type": "file",
                  "name": "route.ts",
                  "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// Configure maximum file size (8MB)\nconst MAX_FILE_SIZE = 8 * 1024 * 1024;\n\n// Allowed file types\nconst ALLOWED_TYPES = [\n  'application/pdf',\n  'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'image/jpeg',\n  'image/jpg', \n  'image/png',\n  'image/gif'\n];\n\n// Allowed file extensions\nconst ALLOWED_EXTENSIONS = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif'];\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File | null;\n    const fieldName = formData.get('fieldName') as string | null; // Optional field to determine category\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });\n    }\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      return NextResponse.json({ \n        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` \n      }, { status: 400 });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return NextResponse.json({ \n        error: `File type not supported. Allowed types: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Validate file extension\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {\n      return NextResponse.json({ \n        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Convert file to buffer\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n\n    // Save file using FileManager\n    const fileInfo = await fileManager.saveFile(\n      buffer,\n      file.name,\n      session.user.id,\n      fieldName || undefined\n    );\n\n    return NextResponse.json({\n      success: true,\n      url: fileInfo.url,\n      filename: fileInfo.newName,\n      originalName: fileInfo.originalName,\n      size: fileInfo.size,\n      type: fileInfo.type,\n      category: fileInfo.category,\n      path: fileInfo.path\n    });\n\n  } catch (error) {\n    console.error('Upload error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error during file upload' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/upload - Get upload info (optional)\nexport async function GET() {\n  return NextResponse.json({\n    maxFileSize: MAX_FILE_SIZE,\n    allowedTypes: ALLOWED_TYPES,\n    allowedExtensions: ALLOWED_EXTENSIONS\n  });\n}\n"
                },
                {
                  "type": "directory",
                  "name": "worker-photo",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// Configure maximum file size (8MB)\nconst MAX_FILE_SIZE = 8 * 1024 * 1024;\n\n// Allowed image types for worker photos\nconst ALLOWED_TYPES = [\n  'image/jpeg',\n  'image/jpg', \n  'image/png'\n];\n\n// Allowed image extensions\nconst ALLOWED_EXTENSIONS = ['.jpg', '.jpeg', '.png'];\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File | null;\n    const workerName = formData.get('workerName') as string | null;\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });\n    }\n\n    if (!workerName) {\n      return NextResponse.json({ error: 'Worker name is required' }, { status: 400 });\n    }\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      return NextResponse.json({ \n        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` \n      }, { status: 400 });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return NextResponse.json({ \n        error: `File type not supported. Only images are allowed: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Validate file extension\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {\n      return NextResponse.json({ \n        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Convert file to buffer\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n\n    // Save worker photo using special method\n    const fileInfo = await fileManager.saveWorkerPhoto(\n      buffer,\n      file.name,\n      session.user.id,\n      workerName\n    );\n\n    return NextResponse.json({\n      success: true,\n      url: fileInfo.url,\n      filename: fileInfo.newName,\n      originalName: fileInfo.originalName,\n      workerName: workerName,\n      size: fileInfo.size,\n      type: fileInfo.type,\n      category: fileInfo.category,\n      path: fileInfo.path\n    });\n\n  } catch (error) {\n    console.error('Worker photo upload error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error during worker photo upload' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/upload/worker-photo - Get upload info\nexport async function GET() {\n  return NextResponse.json({\n    maxFileSize: MAX_FILE_SIZE,\n    allowedTypes: ALLOWED_TYPES,\n    allowedExtensions: ALLOWED_EXTENSIONS,\n    description: 'Upload endpoint for worker photos with worker name as filename'\n  });\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "user",
              "children": [
                {
                  "type": "directory",
                  "name": "change-password",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport bcrypt from \"bcryptjs\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function PUT(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    const body = await req.json();\n    const { currentPassword, newPassword } = body;\n\n    // Get user from database\n    const user = await prisma.user.findUnique({\n      where: {\n        id: session.user.id,\n      },\n    });\n\n    if (!user) {\n      return new NextResponse(\"User not found\", { status: 404 });\n    }\n\n    // Verify current password\n    const isValidPassword = await bcrypt.compare(currentPassword, user.password);\n    if (!isValidPassword) {\n      return new NextResponse(\"Invalid current password\", { status: 400 });\n    }\n\n    // Hash new password\n    const hashedPassword = await bcrypt.hash(newPassword, 10);\n\n    // Update password in database\n    await prisma.user.update({\n      where: {\n        id: session.user.id,\n      },\n      data: {\n        password: hashedPassword,\n      },\n    });\n\n    return new NextResponse(\"Password updated successfully\", { status: 200 });\n  } catch (error) {\n    console.error(\"[PASSWORD_CHANGE_ERROR]\", error);\n    return new NextResponse(\"Internal Server Error\", { status: 500 });\n  }\n}"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "users",
              "children": [
                {
                  "type": "directory",
                  "name": "[id]",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\nimport { User_role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\n\n// Schema validasi untuk update user\nconst updateUserSchema = z.object({\n  officer_name: z.string().min(1, \"Nama petugas wajib diisi\").optional(),\n  email: z.string().email(\"Email tidak valid\").optional(),\n  password: z.string().min(6, \"Password minimal 6 karakter\").optional(),\n  role: z.nativeEnum(User_role).optional(),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n  vendor_name: z.string().optional(),\n  verified_at: z.string().datetime().optional(),\n});\n\n// GET - Mengambil detail user berdasarkan ID\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== User_role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const user = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json(user);\n\n  } catch (error) {\n    console.error(\"Error fetching user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengambil data user\" },\n      { status: 500 }\n    );\n  }\n}\n\n  // PUT - Update user\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== User_role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const body = await request.json();\n    const validation = updateUserSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Data tidak valid\", details: validation.error.issues },\n        { status: 400 }\n      );\n    }\n\n    // Cek apakah user existe\n    const existingUser = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      }\n    });    if (!existingUser) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    const updateData: any = { ...validation.data };\n\n    // Hash password jika ada\n    if (updateData.password) {\n      updateData.password = await bcrypt.hash(updateData.password, 10);\n    }\n\n    // Handle vendor_name berdasarkan role\n    if (updateData.role === User_role.VERIFIER || updateData.role === User_role.SUPER_ADMIN) {\n      updateData.vendor_name = null;\n    }\n\n    // Parse verified_at jika ada\n    if (updateData.verified_at) {\n      updateData.verified_at = new Date(updateData.verified_at);\n    }\n\n    // Cek email unik jika email diubah\n    if (updateData.email && updateData.email !== existingUser.email) {\n      const emailExists = await prisma.user.findUnique({\n        where: { email: updateData.email }\n      });\n\n      if (emailExists) {\n        return NextResponse.json(\n          { error: \"Email sudah digunakan\" },\n          { status: 400 }\n        );\n      }\n    }\n\n    const updatedUser = await prisma.user.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    return NextResponse.json(updatedUser);\n\n  } catch (error) {\n    console.error(\"Error updating user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengupdate user\" },\n      { status: 500 }\n    );\n  }\n}\n\n  // DELETE - Hapus user\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== User_role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n\n    // Cek apakah user existe\n    const existingUser = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      }\n    });    if (!existingUser) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    await prisma.user.delete({\n      where: { id: resolvedParams.id }\n    });\n\n    return NextResponse.json(\n      { message: \"User berhasil dihapus\" },\n      { status: 200 }\n    );\n\n  } catch (error) {\n    console.error(\"Error deleting user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat menghapus user\" },\n      { status: 500 }\n    );\n  }\n}\n"
                    },
                    {
                      "type": "directory",
                      "name": "verify",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "// app/api/users/[id]/verify/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/singletons\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function PUT(\n  request: NextRequest,\n  context: { params: Promise<{ id: string }> }\n) {\n  try {\n    const params = await context.params;\n    const { id } = params;\n    const { action } = await request.json(); // \"approve\" or \"reject\"\n\n    // Check session\n    const session = await getServerSession(authOptions);\n    if (!session || ( session.user.role !== \"SUPER_ADMIN\")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Find user\n    const user = await prisma.user.findUnique({\n      where: { id },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n    }\n\n    let updatedUser;\n\n    if (action === \"approve\") {\n      // Approve user\n      updatedUser = await prisma.user.update({\n        where: { id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n        },\n        select: {\n          id: true,\n          officer_name: true,\n          email: true,\n          role: true,\n          vendor_name: true,\n          verified_at: true,\n          created_at: true,\n        },\n      });\n    } else if (action === \"reject\") {\n      // For now, we'll just delete the user. You might want to keep them with a \"rejected\" status\n      await prisma.user.delete({\n        where: { id },\n      });\n      \n      return NextResponse.json({ \n        message: \"User rejected and removed from system\",\n        success: true \n      });\n    } else {\n      return NextResponse.json({ error: \"Invalid action\" }, { status: 400 });\n    }\n\n    return NextResponse.json({\n      message: `User ${action === \"approve\" ? \"approved\" : \"rejected\"} successfully`,\n      user: updatedUser,\n      success: true\n    });\n\n  } catch (error) {\n    console.error(\"Error in user verification:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "profile",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { z } from \"zod\";\n\nconst commonSchema = z.object({\n  phone_number: z.string().trim().min(1, \"Nomor telepon wajib diisi\"),\n  address: z.string().trim().min(1, \"Alamat wajib diisi\"),\n  email: z.string().trim().email(\"Format email tidak valid\"),\n});\n\nconst vendorSchema = commonSchema.extend({\n  vendor_name: z.string().trim().min(1, \"Nama vendor wajib diisi\"),\n});\n\nconst officerSchema = commonSchema.extend({\n  officer_name: z.string().trim().min(1, \"Nama petugas wajib diisi\"),\n});\n\nexport async function PUT(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    // Pastikan session valid\n    if (!session?.user?.id) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    const body = await req.json().catch(() => ({}));\n    // Ambil role dari DB agar pasti terbaru\n    const user = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { role: true },\n    });\n\n    if (!user) {\n      return new NextResponse(\"User not found\", { status: 404 });\n    }\n\n    // Validasi sesuai role\n    let parsed:\n      | z.infer<typeof vendorSchema>\n      | z.infer<typeof officerSchema>;\n\n    if (user.role === \"VENDOR\") {\n      const res = vendorSchema.safeParse(body);\n      if (!res.success) {\n        const first = res.error.issues[0];\n        return new NextResponse(first?.message ?? \"Validasi gagal\", {\n          status: 400,\n        });\n      }\n      parsed = res.data;\n\n      // Update hanya field yang relevan untuk vendor\n      const updatedUser = await prisma.user.update({\n        where: { id: session.user.id },\n        data: {\n          vendor_name: parsed.vendor_name,\n          phone_number: parsed.phone_number,\n          address: parsed.address,\n          email: parsed.email,\n          // officer_name tidak disentuh (tetap nilai lama)\n        },\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          phone_number: true,\n          address: true,\n          role: true,\n        },\n      });\n\n      return NextResponse.json(updatedUser);\n    } else {\n      const res = officerSchema.safeParse(body);\n      if (!res.success) {\n        const first = res.error.issues[0];\n        return new NextResponse(first?.message ?? \"Validasi gagal\", {\n          status: 400,\n        });\n      }\n      parsed = res.data;\n\n      // Update hanya field yang relevan untuk non-vendor\n      const updatedUser = await prisma.user.update({\n        where: { id: session.user.id },\n        data: {\n          officer_name: parsed.officer_name,\n          phone_number: parsed.phone_number,\n          address: parsed.address,\n          email: parsed.email,\n          // vendor_name tidak disentuh (tetap nilai lama)\n        },\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          phone_number: true,\n          address: true,\n          role: true,\n        },\n      });\n\n      return NextResponse.json(updatedUser);\n    }\n  } catch (error: any) {\n    // Tangani kemungkinan constraint unique email\n    if (error?.code === \"P2002\" && Array.isArray(error?.meta?.target) && error.meta.target.includes(\"email\")) {\n      return new NextResponse(\"Email sudah digunakan\", { status: 409 });\n    }\n\n    console.error(\"[PROFILE_UPDATE]\", error);\n    return new NextResponse(\"Internal Server Error\", { status: 500 });\n  }\n}\n"
                    }
                  ]
                },
                {
                  "type": "file",
                  "name": "route.ts",
                  "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\nimport { User_role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\n\nconst userSchema = z.object({\n  officer_name: z.string().min(1, \"Nama petugas wajib diisi\"),\n  email: z.string().email(\"Email tidak valid\"),\n  password: z.string().min(6, \"Password minimal 6 karakter\").optional(),\n  role: z.nativeEnum(User_role),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n  vendor_name: z.string().optional(),\n});\n\n// GET - Mengambil daftar user dengan pagination, search, dan sort\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== User_role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    // Get search params\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n    const search = searchParams.get(\"search\") || \"\";\n    const sortBy = searchParams.get(\"sortBy\") || \"created_at\";\n    const sortOrder = searchParams.get(\"sortOrder\") || \"desc\";\n    const role = searchParams.get(\"role\") || \"\";\n    const verificationStatus = searchParams.get(\"verificationStatus\") || \"\"; // \"pending\", \"verified\", \"all\"\n\n    console.log(\"API received params:\", { \n      page, \n      limit, \n      search, \n      sortBy, \n      sortOrder, \n      role, \n      verificationStatus \n    });\n\n    const skip = (page - 1) * limit;\n\n    // Build where clause\n    const where: any = {};\n\n    // Filter by role if specified\n    if (role && (role === User_role.VENDOR || role === User_role.VERIFIER)) {\n      where.role = role;\n    }\n\n    // Filter by verification status\n    if (verificationStatus === \"pending\") {\n      where.verified_at = null;\n      console.log(\"Filtering for pending verification (verified_at is null)\");\n    } else if (verificationStatus === \"verified\") {\n      where.verified_at = { not: null };\n      console.log(\"Filtering for verified users (verified_at is not null)\");\n    } else {\n      console.log(\"No verification filter applied (showing all)\");\n    }\n    // \"all\" shows both pending and verified\n\n    console.log(\"Final query where clause:\", JSON.stringify(where, null, 2));\n\n    // Search functionality\n    if (search) {\n      where.OR = [\n        { officer_name: { contains: search } },\n        { email: { contains: search } },\n        { vendor_name: { contains: search } },\n        { phone_number: { contains: search } },\n      ];\n    }\n\n    // Get total count\n    const total = await prisma.user.count({ where });\n\n    // Get users with pagination and sorting\n    const users = await prisma.user.findMany({\n      where,\n      skip,\n      take: limit,\n      orderBy: {\n        [sortBy]: sortOrder as \"asc\" | \"desc\"\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    return NextResponse.json({\n      users,\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit)\n      }\n    });\n\n  } catch (error) {\n    console.error(\"Error fetching users:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengambil data user\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Membuat user baru\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== User_role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const body = await request.json();\n    const validation = userSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Data tidak valid\", details: validation.error.issues },\n        { status: 400 }\n      );\n    }\n\n    const { officer_name, email, password, role, address, phone_number, vendor_name } = validation.data;\n\n    // Cek apakah email sudah ada\n    const existingUser = await prisma.user.findUnique({\n      where: { email }\n    });\n\n    if (existingUser) {\n      return NextResponse.json(\n        { error: \"Email sudah digunakan\" },\n        { status: 400 }\n      );\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(password || \"password123\", 10);\n\n    // Buat user baru\n    const newUser = await prisma.user.create({\n      data: {\n        officer_name,\n        email,\n        password: hashedPassword,\n        role,\n        address: address || null,\n        phone_number: phone_number || null,\n        vendor_name: role === User_role.VENDOR ? (vendor_name || null) : null,\n        verified_by: session.user.officer_name,\n        verified_at: new Date(),\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n      }\n    });\n\n    return NextResponse.json(newUser, { status: 201 });\n\n  } catch (error) {\n    console.error(\"Error creating user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat membuat user\" },\n      { status: 500 }\n    );\n  }\n}\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "v1",
              "children": [
                {
                  "type": "directory",
                  "name": "notifications",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "read",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "// src/app/api/v1/notifications/[id]/read/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { Cache, CacheNamespaces } from \"@/lib/cache\";\nimport { resolveAudience } from \"@/lib/notificationAudience\";\n\nconst notifCacheKey = (aud: { readerKey: \"user\" | \"vendor\"; readerId: string }) =>\n  `list:${aud.readerKey}:${aud.readerId}`;\n\nexport async function POST(req: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user?.id) {\n      return NextResponse.json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    const userId = session.user.id;\n    const role   = session.user.role || \"VENDOR\";\n    const id     = params.id;\n    if (!id) return NextResponse.json({ success: false, error: \"id is required\" }, { status: 400 });\n\n    const audience = resolveAudience(req, role, userId);\n\n    // Validasi notifikasi sesuai audience (optional tapi bagus)\n    const notif = await prisma.notification.findFirst({\n      where: {\n        id,\n        scope: audience.scope,\n        ...(audience.readerKey === \"vendor\" ? { vendor_id: audience.readerId } : {}),\n      },\n      select: { id: true },\n    });\n    if (!notif) {\n      return NextResponse.json({ success: false, error: \"Notification not found\" }, { status: 404 });\n    }\n\n    // Upsert read marker sesuai unique constraint yang benar\n    if (audience.readerKey === \"user\") {\n      await prisma.notificationRead.upsert({\n        where: { notification_id_user_id: { notification_id: id, user_id: audience.readerId } },\n        create: { notification_id: id, user_id: audience.readerId },\n        update: {},\n      });\n    } else {\n      await prisma.notificationRead.upsert({\n        where: { notification_id_vendor_id: { notification_id: id, vendor_id: audience.readerId } },\n        create: { notification_id: id, vendor_id: audience.readerId },\n        update: {},\n      });\n    }\n\n    await Cache.invalidateByPrefix(notifCacheKey(audience), CacheNamespaces.NOTIFICATIONS);\n\n    // Hitung ulang unread\n    const unreadCount = await prisma.notification.count({\n      where: {\n        scope: audience.scope,\n        ...(audience.readerKey === \"vendor\" ? { vendor_id: audience.readerId } : {}),\n        reads: audience.readerKey === \"user\"\n          ? { none: { user_id: audience.readerId } }\n          : { none: { vendor_id: audience.readerId } },\n      },\n    });\n\n    const res = NextResponse.json({ success: true, data: { unreadCount } });\n    res.headers.set(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n    res.headers.set(\"Pragma\", \"no-cache\");\n    res.headers.set(\"Expires\", \"0\");\n    return res;\n  } catch (e: any) {\n    console.error(\"POST /api/v1/notifications/[id]/read error:\", e);\n    const res = NextResponse.json({ success: false, error: e.message || \"Server error\" }, { status: 500 });\n    res.headers.set(\"Cache-Control\", \"no-store\");\n    return res;\n  }\n}\n"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "directory",
                      "name": "read-all",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "// src/app/api/v1/notifications/read-all/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { Cache, CacheNamespaces } from \"@/lib/cache\";\nimport { resolveAudience } from \"@/lib/notificationAudience\";\n\nconst notifCacheKey = (aud: { readerKey: \"user\" | \"vendor\"; readerId: string }) =>\n  `list:${aud.readerKey}:${aud.readerId}`;\n\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user?.id) {\n      return NextResponse.json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    const userId = session.user.id;\n    const role   = session.user.role || \"VENDOR\";\n\n    const audience = resolveAudience(req, role, userId);\n\n    // Ambil semua notification id yg belum dibaca oleh audience ini\n    const unread = await prisma.notification.findMany({\n      where: {\n        scope: audience.scope,\n        ...(audience.readerKey === \"vendor\" ? { vendor_id: audience.readerId } : {}),\n        reads: audience.readerKey === \"user\"\n          ? { none: { user_id: audience.readerId } }\n          : { none: { vendor_id: audience.readerId } },\n      },\n      select: { id: true },\n    });\n\n    if (unread.length > 0) {\n      if (audience.readerKey === \"user\") {\n        await prisma.notificationRead.createMany({\n          data: unread.map((n) => ({ notification_id: n.id, user_id: audience.readerId })),\n          skipDuplicates: true,\n        });\n      } else {\n        await prisma.notificationRead.createMany({\n          data: unread.map((n) => ({ notification_id: n.id, vendor_id: audience.readerId })),\n          skipDuplicates: true,\n        });\n      }\n    }\n\n    await Cache.invalidateByPrefix(notifCacheKey(audience), CacheNamespaces.NOTIFICATIONS);\n\n    const res = NextResponse.json({ success: true, data: { unreadCount: 0 } });\n    res.headers.set(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n    res.headers.set(\"Pragma\", \"no-cache\");\n    res.headers.set(\"Expires\", \"0\");\n    return res;\n  } catch (e: any) {\n    console.error(\"POST /api/v1/notifications/read-all error:\", e);\n    const res = NextResponse.json({ success: false, error: e.message || \"Server error\" }, { status: 500 });\n    res.headers.set(\"Cache-Control\", \"no-store\");\n    return res;\n  }\n}\n"
                        }
                      ]
                    },
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "// src/app/api/v1/notifications/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { Cache, CacheNamespaces } from \"@/lib/cache\";\nimport { resolveAudience } from \"@/lib/notificationAudience\";\n\nconst NOTIF_LIST_TTL_SECONDS = 60;\nconst notifCacheKey = (aud: { readerKey: \"user\" | \"vendor\"; readerId: string }) =>\n  `list:${aud.readerKey}:${aud.readerId}`;\n\nexport async function GET(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user?.id) {\n      return NextResponse.json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    const userId = session.user.id;\n    const role   = session.user.role || \"VENDOR\";\n\n    // audience (scope + siapa yang membaca)\n    const audience = resolveAudience(req, role, userId);\n\n    const sp = new URL(req.url).searchParams;\n    const page     = Math.max(1, parseInt(sp.get(\"page\") || \"1\", 10));\n    const pageSize = Math.min(100, Math.max(1, parseInt(sp.get(\"pageSize\") || \"20\", 10)));\n    const search   = sp.get(\"search\") || undefined;\n    const filter   = (sp.get(\"filter\") as \"all\" | \"unread\" | \"read\") || \"all\";\n\n    const cacheKey = `${notifCacheKey(audience)}:scope=${audience.scope}:p=${page}:s=${pageSize}:f=${filter}:q=${search || \"\"}`;\n    const cached = await Cache.getJSON<{ data: any[]; pagination: any }>(cacheKey, {\n      namespace: CacheNamespaces.NOTIFICATIONS,\n    });\n    if (cached) {\n      const res = NextResponse.json({ success: true, data: cached });\n      res.headers.set(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n      res.headers.set(\"Pragma\", \"no-cache\");\n      res.headers.set(\"Expires\", \"0\");\n      return res;\n    }\n\n    // WHERE dasar: scope sesuai audience\n    const where: any = { scope: audience.scope };\n    // Untuk scope 'vendor' batasi vendor_id (notifikasi ke vendor tsb)\n    if (audience.readerKey === \"vendor\") where.vendor_id = audience.readerId;\n\n    if (search) {\n      where.OR = [\n        { title:   { contains: search, mode: \"insensitive\" } },\n        { message: { contains: search, mode: \"insensitive\" } },\n      ];\n    }\n\n    // Filter read/unread berbasis relasi reads (bukan menyembunyikan notif)\n    if (filter === \"unread\") {\n      where.reads = audience.readerKey === \"user\"\n        ? { none:  { user_id: audience.readerId } }\n        : { none:  { vendor_id: audience.readerId } };\n    } else if (filter === \"read\") {\n      where.reads = audience.readerKey === \"user\"\n        ? { some:  { user_id: audience.readerId } }\n        : { some:  { vendor_id: audience.readerId } };\n    }\n\n    const [rows, total] = await Promise.all([\n      prisma.notification.findMany({\n        where,\n        orderBy: { created_at: \"desc\" },\n        skip: (page - 1) * pageSize,\n        take: pageSize,\n        select: {\n          id: true,\n          scope: true,\n          vendor_id: true,\n          type: true,\n          title: true,\n          message: true,\n          data: true,\n          created_at: true,\n          reads: {\n            where: audience.readerKey === \"user\"\n              ? { user_id: audience.readerId }\n              : { vendor_id: audience.readerId },\n            select: { id: true },\n          },\n        },\n      }),\n      prisma.notification.count({ where }),\n    ]);\n\n    const data = rows.map((n) => ({\n      id: n.id,\n      type: n.type,\n      title: n.title,\n      message: n.message,\n      data: n.data ?? null,\n      createdAt: n.created_at.toISOString(),\n      isRead: n.reads.length > 0,\n      scope: n.scope,\n      vendorId: n.vendor_id ?? null,\n    }));\n\n    const result = {\n      data,\n      pagination: {\n        page,\n        pageSize,\n        total,\n        totalPages: Math.ceil(total / pageSize) || 1,\n      },\n    };\n\n    await Cache.setJSON(cacheKey, result, {\n      namespace: CacheNamespaces.NOTIFICATIONS,\n      ttl: NOTIF_LIST_TTL_SECONDS,\n    });\n\n    const res = NextResponse.json({ success: true, data: result });\n    res.headers.set(\"Cache-Control\", \"no-store, no-cache, must-revalidate, proxy-revalidate\");\n    res.headers.set(\"Pragma\", \"no-cache\");\n    res.headers.set(\"Expires\", \"0\");\n    return res;\n  } catch (e: any) {\n    console.error(\"GET /api/v1/notifications error:\", e);\n    const res = NextResponse.json({ success: false, error: e.message || \"Server error\" }, { status: 500 });\n    res.headers.set(\"Cache-Control\", \"no-store\");\n    return res;\n  }\n}\n"
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "vendor",
              "children": [
                {
                  "type": "directory",
                  "name": "dashboard",
                  "children": [
                    {
                      "type": "directory",
                      "name": "stats",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get submission statistics for current vendor\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    // Get total count\n    const totalCount = await prisma.submission.count({\n      where: { user_id: userId }\n    });\n\n    // Format statistics\n    const vendorStats = {\n      totalSubmissions: totalCount,\n      pendingSubmissions: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approvedSubmissions: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejectedSubmissions: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n      draftSubmissions: 0, // Assuming no draft status in current schema\n      totalApproved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      totalPending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      totalRejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json(vendorStats);\n\n  } catch (error) {\n    console.error(\"Vendor dashboard stats error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "dashboard-stats",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get statistics for current vendor\n    const [totalApproved, totalPending, totalRejected] = await Promise.all([\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"APPROVED\"\n        }\n      }),\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"PENDING\"\n        }\n      }),\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"REJECTED\"\n        }\n      })\n    ]);\n\n    return NextResponse.json({\n      totalApproved,\n      totalPending,\n      totalRejected\n    });\n\n  } catch (error) {\n    console.error(\"Vendor dashboard stats error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "latest-submissions",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get latest 5 submissions for current vendor\n    const submissions = await prisma.submission.findMany({\n      where: {\n        user_id: userId\n      },\n      select: {\n        id: true,\n        job_description: true,\n        work_location: true,\n        approval_status: true,\n        simlok_number: true,\n        created_at: true,\n        vendor_name: true,\n        officer_name: true,\n        based_on: true,\n        working_hours: true,\n        implementation: true,\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true\n          }\n        }\n      },\n      orderBy: {\n        created_at: \"desc\"\n      },\n      take: 5\n    });\n\n    return NextResponse.json({\n      submissions\n    });\n\n  } catch (error) {\n    console.error(\"Vendor latest submissions error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "simloks",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": [
                        {
                          "type": "directory",
                          "name": "workers",
                          "children": [
                            {
                              "type": "file",
                              "name": "route.ts",
                              "content": "/**\n * GET /api/vendor/simloks/[id]/workers\n * Get workers for a vendor's own submission\n */\n\nimport { NextRequest } from 'next/server';\nimport { prisma } from '@/lib/singletons';\nimport { \n  withErrorHandling, \n  apiSuccess, \n  apiError,\n  getAuthenticatedSession,\n  handleOptions,\n} from '@/lib/api-utils';\n\nasync function getVendorSubmissionWorkers(\n  _req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  \n  // Check authentication\n  const { session, error: authError } = await getAuthenticatedSession();\n  if (authError) return authError;\n\n  // Only vendors can access this endpoint\n  if (session.user.role !== 'VENDOR') {\n    return apiError('Access denied', 403);\n  }\n\n  // Check if submission belongs to this vendor\n  const submission = await prisma.submission.findFirst({\n    where: {\n      id: id,\n      user_id: session.user.id,\n    },\n  });\n\n  if (!submission) {\n    return apiError('Submission not found', 404);\n  }\n\n  // Get workers\n  const workers = await prisma.workerList.findMany({\n    where: {\n      submission_id: id,\n    },\n    orderBy: {\n      created_at: 'asc',\n    },\n  });\n\n  return apiSuccess({ workers });\n}\n\nexport const GET = withErrorHandling(getVendorSubmissionWorkers);\nexport const OPTIONS = handleOptions;"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "submissions",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n    const { searchParams } = new URL(request.url);\n    \n    // Extract query parameters\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const search = searchParams.get('search');\n    const status = searchParams.get('status');\n\n    // Build where clause\n    const where: any = {\n      user_id: userId\n    };\n\n    if (search) {\n      where.OR = [\n        { job_description: { contains: search } },\n        { work_location: { contains: search } },\n        { vendor_name: { contains: search } },\n        { officer_name: { contains: search } },\n        { simlok_number: { contains: search } }\n      ];\n    }\n\n    if (status) {\n      where.approval_status = status;\n    }\n\n    // Get total count for pagination\n    const totalCount = await prisma.submission.count({ where });\n    const totalPages = Math.ceil(totalCount / limit);\n    const skip = (page - 1) * limit;\n\n    // Get submissions without updated_at field\n    const submissions = await prisma.submission.findMany({\n      where,\n      select: {\n        id: true,\n        job_description: true,\n        work_location: true,\n        approval_status: true,\n        simlok_number: true,\n        simlok_date: true,\n        created_at: true,\n        vendor_name: true,\n        officer_name: true,\n        based_on: true,\n        working_hours: true,\n        implementation: true,\n        work_facilities: true,\n        worker_names: true,\n        content: true,\n        notes: true,\n        simja_number: true,\n        simja_date: true,\n        sika_number: true,\n        sika_date: true,\n        other_notes: true,\n        sika_document_upload: true,\n        simja_document_upload: true,\n        qrcode: true,\n        signer_position: true,\n        signer_name: true,\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true\n          }\n        }\n      },\n      orderBy: {\n        [sortBy]: sortOrder as 'asc' | 'desc'\n      },\n      skip,\n      take: limit\n    });\n\n    // Get statistics\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    const statistics = {\n      total: totalCount,\n      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        page,\n        limit,\n        total: totalCount,\n        pages: totalPages\n      },\n      statistics\n    });\n\n  } catch (error) {\n    console.error(\"Vendor submissions error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                    },
                    {
                      "type": "directory",
                      "name": "stats",
                      "children": [
                        {
                          "type": "file",
                          "name": "route.ts",
                          "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get statistics for all submissions (no filters)\n    const totalCount = await prisma.submission.count({ \n      where: { user_id: userId } \n    });\n\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    const statistics = {\n      total: totalCount,\n      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json({\n      statistics\n    });\n\n  } catch (error) {\n    console.error(\"Vendor statistics error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "directory",
              "name": "verifier",
              "children": [
                {
                  "type": "directory",
                  "name": "dashboard-stats",
                  "children": []
                },
                {
                  "type": "directory",
                  "name": "recent-submissions",
                  "children": []
                },
                {
                  "type": "directory",
                  "name": "search",
                  "children": []
                },
                {
                  "type": "directory",
                  "name": "stats",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    if (session.user.role !== 'VERIFIER') {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    // Get today's date range\n    const today = new Date();\n    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n    const todayEnd = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);\n\n    // Fetch stats in parallel\n    const [\n      totalScans,\n      todayScans,\n      totalSubmissions,\n      approvedSubmissions,\n      pendingSubmissions,\n      rejectedSubmissions\n    ] = await Promise.all([\n      // Total scans by this verifier\n      prisma.qrScan.count({\n        where: {\n          scanned_by: session.user.id\n        }\n      }),\n      \n      // Today's scans by this verifier\n      prisma.qrScan.count({\n        where: {\n          scanned_by: session.user.id,\n          scanned_at: {\n            gte: todayStart,\n            lt: todayEnd\n          }\n        }\n      }),\n      \n      // Total submissions\n      prisma.submission.count(),\n      \n      // Approved submissions\n      prisma.submission.count({\n        where: {\n          approval_status: 'APPROVED'\n        }\n      }),\n      \n      // Pending submissions\n      prisma.submission.count({\n        where: {\n          approval_status: 'PENDING'\n        }\n      }),\n      \n      // Rejected submissions\n      prisma.submission.count({\n        where: {\n          approval_status: 'REJECTED'\n        }\n      })\n    ]);\n\n    const stats = {\n      totalScans,\n      todayScans,\n      totalSubmissions,\n      approvedSubmissions,\n      pendingSubmissions,\n      rejectedSubmissions\n    };\n\n    return NextResponse.json(stats);\n\n  } catch (error) {\n    console.error('Error fetching verifier stats:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "submissions",
                  "children": [
                    {
                      "type": "file",
                      "name": "route.ts",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { db } from '@/lib/db';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session || session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const url = new URL(request.url);\n    const limit = parseInt(url.searchParams.get('limit') || '20');\n    const offset = parseInt(url.searchParams.get('offset') || '0');\n    const status = url.searchParams.get('status') || 'ALL';\n    const dateRange = url.searchParams.get('dateRange') || 'ALL';\n    const search = url.searchParams.get('search') || '';\n\n    // Build where conditions\n    const whereConditions: any = {};\n\n    // Status filter\n    if (status !== 'ALL') {\n      whereConditions.approval_status = status;\n    }\n\n    // Date range filter\n    if (dateRange !== 'ALL') {\n      const now = new Date();\n      let startDate: Date;\n      \n      switch (dateRange) {\n        case 'TODAY':\n          startDate = new Date(now);\n          startDate.setHours(0, 0, 0, 0);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n        case 'WEEK':\n          startDate = new Date(now);\n          startDate.setDate(now.getDate() - 7);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n        case 'MONTH':\n          startDate = new Date(now);\n          startDate.setDate(now.getDate() - 30);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n      }\n    }\n\n    // Search filter\n    if (search.trim()) {\n      whereConditions.OR = [\n        {\n          simlok_number: {\n            contains: search\n          }\n        },\n        {\n          vendor_name: {\n            contains: search\n          }\n        },\n        {\n          officer_name: {\n            contains: search\n          }\n        },\n        {\n          job_description: {\n            contains: search\n          }\n        },\n        {\n          work_location: {\n            contains: search\n          }\n        }\n      ];\n    }\n\n    // Fetch submissions with pagination\n    const [submissions, totalCount] = await Promise.all([\n      db.submission.findMany({\n        where: whereConditions,\n        take: limit,\n        skip: offset,\n        orderBy: [\n          {\n            approval_status: 'asc' // Show pending first\n          },\n          {\n            created_at: 'desc'\n          }\n        ],\n        select: {\n          id: true,\n          vendor_name: true,\n          officer_name: true,\n          job_description: true,\n          work_location: true,\n          implementation: true,\n          approval_status: true,\n          simlok_number: true,\n          simlok_date: true,\n          created_at: true\n        }\n      }),\n      db.submission.count({\n        where: whereConditions\n      })\n    ]);\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount\n      },\n      filters: {\n        status,\n        dateRange,\n        search\n      }\n    });\n\n  } catch (error) {\n    console.error('Error fetching submissions:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch submissions' },\n      { status: 500 }\n    );\n  }\n}\n"
                    }
                  ]
                },
                {
                  "type": "directory",
                  "name": "users",
                  "children": [
                    {
                      "type": "directory",
                      "name": "[id]",
                      "children": []
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "file",
          "name": "globals.css",
          "content": "@import \"tailwindcss\";\n@import \"react-datepicker/dist/react-datepicker.css\";\n@import \"../styles/datepicker.css\";\n@import \"../styles/auth.css\";\n\n\n@custom-variant dark (&:is(.dark *));\n\n@theme {\n  --font-*: initial;\n  --font-outfit: Outfit, sans-serif;\n\n  --breakpoint-*: initial;\n  --breakpoint-2xsm: 375px;\n  --breakpoint-xsm: 425px;\n  --breakpoint-3xl: 2000px;\n  --breakpoint-sm: 640px;\n  --breakpoint-md: 768px;\n  --breakpoint-lg: 1024px;\n  --breakpoint-xl: 1280px;\n  --breakpoint-2xl: 1536px;\n\n  --text-title-2xl: 72px;\n  --text-title-2xl--line-height: 90px;\n  --text-title-xl: 60px;\n  --text-title-xl--line-height: 72px;\n  --text-title-lg: 48px;\n  --text-title-lg--line-height: 60px;\n  --text-title-md: 36px;\n  --text-title-md--line-height: 44px;\n  --text-title-sm: 30px;\n  --text-title-sm--line-height: 38px;\n  --text-theme-xl: 20px;\n  --text-theme-xl--line-height: 30px;\n  --text-theme-sm: 14px;\n  --text-theme-sm--line-height: 20px;\n  --text-theme-xs: 12px;\n  --text-theme-xs--line-height: 18px;\n\n  --color-current: currentColor;\n  --color-transparent: transparent;\n  --color-white: #ffffff;\n  --color-black: #101828;\n\n  --color-brand-25: #f2f7ff;\n  --color-brand-50: #ecf3ff;\n  --color-brand-100: #dde9ff;\n  --color-brand-200: #c2d6ff;\n  --color-brand-300: #9cb9ff;\n  --color-brand-400: #7592ff;\n  --color-brand-500: #465fff;\n  --color-brand-600: #3641f5;\n  --color-brand-700: #2a31d8;\n  --color-brand-800: #252dae;\n  --color-brand-900: #262e89;\n  --color-brand-950: #161950;\n\n  --color-blue-light-25: #f5fbff;\n  --color-blue-light-50: #f0f9ff;\n  --color-blue-light-100: #e0f2fe;\n  --color-blue-light-200: #b9e6fe;\n  --color-blue-light-300: #7cd4fd;\n  --color-blue-light-400: #36bffa;\n  --color-blue-light-500: #0ba5ec;\n  --color-blue-light-600: #0086c9;\n  --color-blue-light-700: #026aa2;\n  --color-blue-light-800: #065986;\n  --color-blue-light-900: #0b4a6f;\n  --color-blue-light-950: #062c41;\n\n  --color-gray-25: #fcfcfd;\n  --color-gray-50: #f9fafb;\n  --color-gray-100: #f2f4f7;\n  --color-gray-200: #e4e7ec;\n  --color-gray-300: #d0d5dd;\n  --color-gray-400: #98a2b3;\n  --color-gray-500: #667085;\n  --color-gray-600: #475467;\n  --color-gray-700: #344054;\n  --color-gray-800: #1d2939;\n  --color-gray-900: #101828;\n  --color-gray-950: #0c111d;\n  --color-gray-dark: #1a2231;\n\n  --color-orange-25: #fffaf5;\n  --color-orange-50: #fff6ed;\n  --color-orange-100: #ffead5;\n  --color-orange-200: #fddcab;\n  --color-orange-300: #feb273;\n  --color-orange-400: #fd853a;\n  --color-orange-500: #fb6514;\n  --color-orange-600: #ec4a0a;\n  --color-orange-700: #c4320a;\n  --color-orange-800: #9c2a10;\n  --color-orange-900: #7e2410;\n  --color-orange-950: #511c10;\n\n  --color-success-25: #f6fef9;\n  --color-success-50: #ecfdf3;\n  --color-success-100: #d1fadf;\n  --color-success-200: #a6f4c5;\n  --color-success-300: #6ce9a6;\n  --color-success-400: #32d583;\n  --color-success-500: #12b76a;\n  --color-success-600: #039855;\n  --color-success-700: #027a48;\n  --color-success-800: #05603a;\n  --color-success-900: #054f31;\n  --color-success-950: #053321;\n\n  --color-error-25: #fffbfa;\n  --color-error-50: #fef3f2;\n  --color-error-100: #fee4e2;\n  --color-error-200: #fecdca;\n  --color-error-300: #fda29b;\n  --color-error-400: #f97066;\n  --color-error-500: #f04438;\n  --color-error-600: #d92d20;\n  --color-error-700: #b42318;\n  --color-error-800: #912018;\n  --color-error-900: #7a271a;\n  --color-error-950: #55160c;\n\n  --color-warning-25: #fffcf5;\n  --color-warning-50: #fffaeb;\n  --color-warning-100: #fef0c7;\n  --color-warning-200: #fedf89;\n  --color-warning-300: #fec84b;\n  --color-warning-400: #fdb022;\n  --color-warning-500: #f79009;\n  --color-warning-600: #dc6803;\n  --color-warning-700: #b54708;\n  --color-warning-800: #93370d;\n  --color-warning-900: #7a2e0e;\n  --color-warning-950: #4e1d09;\n\n  --color-theme-pink-500: #ee46bc;\n\n  --color-theme-purple-500: #7a5af8;\n\n  --shadow-theme-md:\n    0px 4px 8px -2px rgba(16, 24, 40, 0.1),\n    0px 2px 4px -2px rgba(16, 24, 40, 0.06);\n  --shadow-theme-lg:\n    0px 12px 16px -4px rgba(16, 24, 40, 0.08),\n    0px 4px 6px -2px rgba(16, 24, 40, 0.03);\n  --shadow-theme-sm:\n    0px 1px 3px 0px rgba(16, 24, 40, 0.1),\n    0px 1px 2px 0px rgba(16, 24, 40, 0.06);\n  --shadow-theme-xs: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);\n  --shadow-theme-xl:\n    0px 20px 24px -4px rgba(16, 24, 40, 0.08),\n    0px 8px 8px -4px rgba(16, 24, 40, 0.03);\n  --shadow-datepicker: -5px 0 0 #262d3c, 5px 0 0 #262d3c;\n  --shadow-focus-ring: 0px 0px 0px 4px rgba(70, 95, 255, 0.12);\n  --shadow-slider-navigation:\n    0px 1px 2px 0px rgba(16, 24, 40, 0.1), 0px 1px 3px 0px rgba(16, 24, 40, 0.1);\n  --shadow-tooltip:\n    0px 4px 6px -2px rgba(16, 24, 40, 0.05),\n    -8px 0px 20px 8px rgba(16, 24, 40, 0.05);\n\n  --drop-shadow-4xl:\n    0 35px 35px rgba(0, 0, 0, 0.25), 0 45px 65px rgba(0, 0, 0, 0.15);\n\n  --z-index-1: 1;\n  --z-index-9: 9;\n  --z-index-99: 99;\n  --z-index-999: 999;\n  --z-index-9999: 9999;\n  --z-index-99999: 99999;\n  --z-index-999999: 999999;\n}\n\n/*\n  The default border color has changed to `currentColor` in Tailwind CSS v4,\n  so we've added these compatibility styles to make sure everything still\n  looks the same as it did with Tailwind CSS v3.\n\n  If we ever want to remove these styles, we need to add an explicit border\n  color utility to any element that depends on these defaults.\n*/\n@layer base {\n  *,\n  ::after,\n  ::before,\n  ::backdrop,\n  ::file-selector-button {\n    border-color: var(--color-gray-200, currentColor);\n  }\n  button:not(:disabled),\n  [role=\"button\"]:not(:disabled) {\n    cursor: pointer;\n  }\n  body {\n    @apply relative font-normal font-outfit z-1 bg-gray-50;\n  }\n}\n\n@utility menu-item {\n  @apply relative flex items-center w-full gap-3 px-3 py-2 font-medium rounded-lg text-theme-sm;\n}\n\n@utility menu-item-active {\n  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;\n}\n\n@utility menu-item-inactive {\n  @apply text-gray-700 hover:bg-gray-100 group-hover:text-gray-700 dark:text-gray-300 dark:hover:bg-white/5 dark:hover:text-gray-300;\n}\n\n@utility menu-item-icon {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400;\n}\n\n@utility menu-item-icon-active {\n  @apply text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-item-icon-inactive {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;\n}\n\n@utility menu-item-arrow {\n  @apply relative;\n}\n\n@utility menu-item-arrow-active {\n  @apply rotate-180 text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-item-arrow-inactive {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;\n}\n\n@utility menu-dropdown-item {\n  @apply relative flex items-center gap-3 rounded-lg px-3 py-2.5 text-theme-sm font-medium;\n}\n\n@utility menu-dropdown-item-active {\n  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;\n}\n\n@utility menu-dropdown-item-inactive {\n  @apply text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-white/5;\n}\n\n@utility menu-dropdown-badge {\n  @apply block rounded-full px-2.5 py-0.5 text-xs font-medium uppercase text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-dropdown-badge-active {\n  @apply bg-brand-100 dark:bg-brand-500/20;\n}\n\n@utility menu-dropdown-badge-inactive {\n  @apply bg-brand-50 group-hover:bg-brand-100 dark:bg-brand-500/15 dark:group-hover:bg-brand-500/20;\n}\n\n@utility no-scrollbar {\n  /* Chrome, Safari and Opera */\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n@utility custom-scrollbar {\n  &::-webkit-scrollbar {\n    @apply size-1.5;\n  }\n\n  &::-webkit-scrollbar-track {\n    @apply rounded-full;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    @apply bg-gray-200 rounded-full dark:bg-gray-700;\n  }\n}\n\n.dark .custom-scrollbar::-webkit-scrollbar-thumb {\n  background-color: #344054;\n}\n\n\n\n@layer utilities {\n  /* For Remove Date Icon */\n  input[type=\"date\"]::-webkit-inner-spin-button,\n  input[type=\"time\"]::-webkit-inner-spin-button,\n  input[type=\"date\"]::-webkit-calendar-picker-indicator,\n  input[type=\"time\"]::-webkit-calendar-picker-indicator {\n    display: none;\n    -webkit-appearance: none;\n  }\n}\n\n/* third-party libraries CSS */\n.apexcharts-legend-text {\n  @apply !text-gray-700 dark:!text-gray-400;\n}\n\n.apexcharts-text {\n  @apply !fill-gray-700 dark:!fill-gray-400;\n}\n\n.apexcharts-tooltip.apexcharts-theme-light {\n  @apply gap-1 !rounded-lg !border-gray-200 p-3 !shadow-theme-sm dark:!border-gray-800 dark:!bg-gray-900;\n}\n\n.apexcharts-legend-text {\n  @apply pl-5! !text-gray-700 dark:!text-gray-400;\n}\n.apexcharts-tooltip-series-group {\n  @apply !p-0;\n}\n.apexcharts-tooltip-y-group {\n  @apply !p-0;\n}\n.apexcharts-tooltip-title {\n  @apply !mb-0 !border-b-0 !bg-transparent !p-0 !text-[10px] !leading-4 !text-gray-800 dark:!text-white/90;\n}\n.apexcharts-tooltip-text {\n  @apply !text-theme-xs !text-gray-700 dark:!text-white/90;\n}\n.apexcharts-tooltip-text-y-value {\n  @apply !font-medium;\n}\n\n.apexcharts-gridline {\n  @apply !stroke-gray-100 dark:!stroke-gray-800;\n}\n\n.flatpickr-wrapper {\n  @apply w-full;\n}\n.flatpickr-calendar {\n  @apply mt-2 !bg-white !rounded-xl !p-5 !border !border-gray-200 dark:!border-gray-800 !text-gray-500 dark:!bg-gray-dark dark:!text-gray-400 dark:!shadow-theme-xl 2xsm:!w-auto;\n}\n\n.flatpickr-months .flatpickr-prev-month:hover svg,\n.flatpickr-months .flatpickr-next-month:hover svg {\n  @apply stroke-brand-500;\n}\n.flatpickr-calendar.arrowTop:before,\n.flatpickr-calendar.arrowTop:after {\n  @apply hidden;\n}\n\n.flatpickr-current-month {\n  @apply !p-0;\n}\n.flatpickr-current-month .cur-month,\n.flatpickr-current-month input.cur-year {\n  @apply !h-auto !pt-0 !text-lg !font-medium !text-gray-800 dark:!text-white/90;\n}\n\n.flatpickr-prev-month,\n.flatpickr-next-month {\n  @apply !p-0;\n}\n\n.flatpickr-weekdays {\n  @apply h-auto mt-6 mb-4 !bg-transparent;\n}\n\n.flatpickr-weekday {\n  @apply !text-theme-sm !font-medium !text-gray-500 dark:!text-gray-400 !bg-transparent;\n}\n\n.flatpickr-day {\n  @apply !flex !items-center !text-theme-sm !font-medium !text-gray-800 dark:!text-white/90 dark:hover:!border-gray-300 dark:hover:!bg-gray-900;\n}\n.flatpickr-day.nextMonthDay,\n.flatpickr-day.prevMonthDay {\n  @apply !text-gray-400;\n}\n\n.flatpickr-months > .flatpickr-month {\n  background: none !important;\n}\n.flatpickr-month .flatpickr-current-month .flatpickr-monthDropdown-months {\n  background: none !important;\n  appearance: none;\n  background-image: none !important;\n  font-weight: 500;\n}\n.flatpickr-month\n.flatpickr-current-month\n.flatpickr-monthDropdown-months:focus {\n  outline: none !important;\n  border: 0 !important;\n}\n.flatpickr-months .flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month {\n  @apply !top-7 dark:!fill-white dark:!text-white !bg-transparent;\n}\n.flatpickr-months .flatpickr-prev-month.flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month.flatpickr-prev-month {\n  @apply !left-7;\n}\n.flatpickr-months .flatpickr-prev-month.flatpickr-next-month,\n.flatpickr-months .flatpickr-next-month.flatpickr-next-month {\n  @apply !right-7;\n}\n.flatpickr-days {\n  @apply !border-0;\n}\nspan.flatpickr-weekday,\n.flatpickr-months .flatpickr-month {\n  @apply dark:!fill-white dark:!text-white !bg-none;\n}\n.flatpickr-innerContainer {\n  @apply !border-b-0;\n}\n.flatpickr-months .flatpickr-month {\n  @apply !bg-none;\n}\n.flatpickr-day.inRange {\n  box-shadow: -5px 0 0 #f9fafb, 5px 0 0 #f9fafb !important;\n  @apply dark:!shadow-datepicker;\n}\n.flatpickr-day.inRange,\n.flatpickr-day.prevMonthDay.inRange,\n.flatpickr-day.nextMonthDay.inRange,\n.flatpickr-day.today.inRange,\n.flatpickr-day.prevMonthDay.today.inRange,\n.flatpickr-day.nextMonthDay.today.inRange,\n.flatpickr-day:hover,\n.flatpickr-day.prevMonthDay:hover,\n.flatpickr-day.nextMonthDay:hover,\n.flatpickr-day:focus,\n.flatpickr-day.prevMonthDay:focus,\n.flatpickr-day.nextMonthDay:focus {\n  @apply !border-gray-50 !bg-gray-50 dark:!border-0 dark:!border-white/5 dark:!bg-white/5;\n}\n.flatpickr-day.selected,\n.flatpickr-day.startRange,\n.flatpickr-day.selected,\n.flatpickr-day.endRange {\n  @apply !text-white dark:!text-white;\n}\n.flatpickr-day.selected,\n.flatpickr-day.startRange,\n.flatpickr-day.endRange,\n.flatpickr-day.selected.inRange,\n.flatpickr-day.startRange.inRange,\n.flatpickr-day.endRange.inRange,\n.flatpickr-day.selected:focus,\n.flatpickr-day.startRange:focus,\n.flatpickr-day.endRange:focus,\n.flatpickr-day.selected:hover,\n.flatpickr-day.startRange:hover,\n.flatpickr-day.endRange:hover,\n.flatpickr-day.selected.prevMonthDay,\n.flatpickr-day.startRange.prevMonthDay,\n.flatpickr-day.endRange.prevMonthDay,\n.flatpickr-day.selected.nextMonthDay,\n.flatpickr-day.startRange.nextMonthDay,\n.flatpickr-day.endRange.nextMonthDay {\n  background: #465fff;\n  @apply !border-brand-500 !bg-brand-500 hover:!border-brand-50 hover:!bg-brand-500;\n}\n.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n + 1)),\n.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n + 1)),\n.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n + 1)) {\n  box-shadow: -10px 0 0 #465fff;\n}\n\n.flatpickr-months .flatpickr-prev-month svg,\n.flatpickr-months .flatpickr-next-month svg,\n.flatpickr-months .flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month {\n  @apply hover:!fill-none;\n}\n.flatpickr-months .flatpickr-prev-month:hover svg,\n.flatpickr-months .flatpickr-next-month:hover svg {\n  fill: none !important;\n}\n\n.flatpickr-calendar.static {\n  @apply right-0;\n}\n\n.fc .fc-view-harness {\n  @apply max-w-full overflow-x-auto custom-scrollbar;\n}\n.fc-dayGridMonth-view.fc-view.fc-daygrid {\n  @apply min-w-[718px];\n}\n.fc .fc-scrollgrid-section > * {\n  border-right-width: 0;\n  border-bottom-width: 0;\n}\n.fc .fc-scrollgrid {\n  border-left-width: 0;\n}\n.fc .fc-toolbar.fc-header-toolbar {\n  @apply flex-col gap-4 px-6 pt-6 sm:flex-row;\n}\n.fc-button-group {\n  @apply gap-2;\n}\n.fc-button-group .fc-button {\n  @apply flex h-10 w-10 items-center justify-center !rounded-lg border border-gray-200 bg-transparent hover:border-gray-200 hover:bg-gray-50 focus:shadow-none active:!border-gray-200 active:!bg-transparent active:!shadow-none dark:border-gray-800 dark:hover:border-gray-800 dark:hover:bg-gray-900 dark:active:border-gray-800!;\n}\n\n.fc-button-group .fc-button.fc-prev-button:before {\n  @apply inline-block mt-1;\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.fc-button-group .fc-button.fc-next-button:before {\n  @apply inline-block mt-1;\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.dark .fc-button-group .fc-button.fc-prev-button:before {\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.dark .fc-button-group .fc-button.fc-next-button:before {\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.fc-button-group .fc-button .fc-icon {\n  @apply hidden;\n}\n.fc-addEventButton-button {\n  @apply !rounded-lg !border-0 !bg-brand-500 !px-4 !py-2.5 !text-sm !font-medium hover:!bg-brand-600 focus:!shadow-none;\n}\n.fc-toolbar-title {\n  @apply !text-lg !font-medium text-gray-800 dark:text-white/90;\n}\n.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child {\n  @apply rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900;\n}\n.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child .fc-button {\n  @apply !h-auto !w-auto rounded-md !border-0 bg-transparent !px-5 !py-2 text-sm font-medium text-gray-500 hover:text-gray-700 focus:shadow-none! dark:text-gray-400;\n}\n.fc-header-toolbar.fc-toolbar\n  .fc-toolbar-chunk:last-child\n  .fc-button.fc-button-active {\n  @apply text-gray-900 bg-white dark:bg-gray-800 dark:text-white;\n}\n.fc-theme-standard th {\n  @apply !border-x-0 border-t !border-gray-200 bg-gray-50 !text-left dark:!border-gray-800 dark:bg-gray-900;\n}\n.fc-theme-standard td,\n.fc-theme-standard .fc-scrollgrid {\n  @apply !border-gray-200 dark:!border-gray-800;\n}\n.fc .fc-col-header-cell-cushion {\n  @apply !px-5 !py-4 text-sm font-medium uppercase text-gray-400;\n}\n.fc .fc-daygrid-day.fc-day-today {\n  @apply bg-transparent;\n}\n.fc .fc-daygrid-day {\n  @apply p-2;\n}\n.fc .fc-daygrid-day.fc-day-today .fc-scrollgrid-sync-inner {\n  @apply rounded-sm bg-gray-100 dark:bg-white/[0.03];\n}\n.fc .fc-daygrid-day-number {\n  @apply !p-3 text-sm font-medium text-gray-700 dark:text-gray-400;\n}\n.fc .fc-daygrid-day-top {\n  @apply !flex-row;\n}\n.fc .fc-day-other .fc-daygrid-day-top {\n  opacity: 1;\n}\n.fc .fc-day-other .fc-daygrid-day-top .fc-daygrid-day-number {\n  @apply text-gray-400 dark:text-white/30;\n}\n.event-fc-color {\n  @apply rounded-lg py-2.5 pl-4 pr-3;\n}\n.event-fc-color .fc-event-title {\n  @apply p-0 text-sm font-normal text-gray-700;\n}\n.fc-daygrid-event-dot {\n  @apply w-1 h-5 ml-0 mr-3 border-none rounded-sm;\n}\n.fc-event {\n  @apply focus:shadow-none;\n}\n.fc-daygrid-event.fc-event-start {\n  @apply !ml-3;\n}\n.event-fc-color.fc-bg-success {\n  @apply border-success-50 bg-success-50;\n}\n.event-fc-color.fc-bg-danger {\n  @apply border-error-50 bg-error-50;\n}\n.event-fc-color.fc-bg-primary {\n  @apply border-brand-50 bg-brand-50;\n}\n.event-fc-color.fc-bg-warning {\n  @apply border-orange-50 bg-orange-50;\n}\n.event-fc-color.fc-bg-success .fc-daygrid-event-dot {\n  @apply bg-success-500;\n}\n.event-fc-color.fc-bg-danger .fc-daygrid-event-dot {\n  @apply bg-error-500;\n}\n.event-fc-color.fc-bg-primary .fc-daygrid-event-dot {\n  @apply bg-brand-500;\n}\n.event-fc-color.fc-bg-warning .fc-daygrid-event-dot {\n  @apply bg-orange-500;\n}\n.fc-direction-ltr .fc-timegrid-slot-label-frame {\n  @apply px-3 py-1.5 text-left text-sm font-medium text-gray-500 dark:text-gray-400;\n}\n.fc .fc-timegrid-axis-cushion {\n  @apply text-sm font-medium text-gray-500 dark:text-gray-400;\n}\n.custom-calendar .fc-h-event {\n  background-color: transparent;\n  border: none;\n  color: black;\n}\n.fc.fc-media-screen {\n  @apply min-h-screen;\n}\n\n.input-date-icon::-webkit-inner-spin-button,\n.input-date-icon::-webkit-calendar-picker-indicator {\n  opacity: 0;\n  -webkit-appearance: none;\n}\n\n.stocks-slider-outer .swiper-button-next:after,\n.stocks-slider-outer .swiper-button-prev:after {\n  @apply hidden;\n}\n\n.stocks-slider-outer .swiper-button-next,\n.stocks-slider-outer .swiper-button-prev {\n  @apply !static mt-0 h-8 w-9 rounded-full border dark:hover:bg-white/[0.05] border-gray-200 !text-gray-700 transition hover:bg-gray-100 dark:border-white/[0.03] dark:bg-gray-800 dark:!text-gray-400  dark:hover:!text-white/90;\n}\n\n.stocks-slider-outer .swiper-button-next.swiper-button-disabled,\n.stocks-slider-outer .swiper-button-prev.swiper-button-disabled {\n  @apply bg-white opacity-50 dark:bg-gray-900;\n}\n\n.stocks-slider-outer .swiper-button-next svg,\n.stocks-slider-outer .swiper-button-prev svg {\n  @apply !h-auto !w-auto;\n}\n\n.swiper-button-prev svg,\n.swiper-button-next svg {\n  @apply !h-auto !w-auto;\n}\n\n.carouselTwo .swiper-button-next:after,\n.carouselTwo .swiper-button-prev:after,\n.carouselFour .swiper-button-next:after,\n.carouselFour .swiper-button-prev:after {\n  @apply hidden;\n}\n.carouselTwo .swiper-button-next.swiper-button-disabled,\n.carouselTwo .swiper-button-prev.swiper-button-disabled,\n.carouselFour .swiper-button-next.swiper-button-disabled,\n.carouselFour .swiper-button-prev.swiper-button-disabled {\n  @apply bg-white/60 !opacity-100;\n}\n.carouselTwo .swiper-button-next,\n.carouselTwo .swiper-button-prev,\n.carouselFour .swiper-button-next,\n.carouselFour .swiper-button-prev {\n  @apply h-10 w-10 rounded-full border-[0.5px] border-white/10 bg-white/90 !text-gray-700 shadow-slider-navigation backdrop-blur-[10px];\n}\n\n.carouselTwo .swiper-button-prev,\n.carouselFour .swiper-button-prev {\n  @apply !left-3 sm:!left-4;\n}\n\n.carouselTwo .swiper-button-next,\n.carouselFour .swiper-button-next {\n  @apply !right-3 sm:!right-4;\n}\n\n.carouselThree .swiper-pagination,\n.carouselFour .swiper-pagination {\n  @apply !bottom-3 !left-1/2 inline-flex !w-auto -translate-x-1/2 items-center gap-1.5 rounded-[40px] border-[0.5px] border-white/10 bg-white/60 px-2 py-1.5 shadow-slider-navigation backdrop-blur-[10px] sm:!bottom-5;\n}\n\n.carouselThree .swiper-pagination-bullet,\n.carouselFour .swiper-pagination-bullet {\n  @apply !m-0 h-2.5 w-2.5 bg-white opacity-100 shadow-theme-xs duration-200 ease-in-out;\n}\n\n.carouselThree .swiper-pagination-bullet-active,\n.carouselFour .swiper-pagination-bullet-active {\n  @apply w-6.5 rounded-xl;\n}\n\n.jvectormap-container {\n  @apply !bg-gray-50 dark:!bg-gray-900;\n}\n.jvectormap-region.jvectormap-element {\n  @apply !fill-gray-300 hover:!fill-brand-500 dark:!fill-gray-700 dark:hover:!fill-brand-500;\n}\n.jvectormap-marker.jvectormap-element {\n  @apply !stroke-gray-200 dark:!stroke-gray-800;\n}\n.jvectormap-tip {\n  @apply !bg-brand-500 !border-none !px-2 !py-1;\n}\n.jvectormap-zoomin,\n.jvectormap-zoomout {\n  @apply !hidden;\n}\n\n.form-check-input:checked ~ span {\n  @apply border-[6px] border-brand-500 bg-brand-500 dark:border-brand-500;\n}\n\n.taskCheckbox:checked ~ .box span {\n  @apply opacity-100 bg-brand-500;\n}\n.taskCheckbox:checked ~ p {\n  @apply text-gray-400 line-through;\n}\n.taskCheckbox:checked ~ .box {\n  @apply border-brand-500 bg-brand-500 dark:border-brand-500;\n}\n\n.task {\n  transition: all 0.2s ease; /* Smooth transition for visual effects */\n}\n\n.task {\n  border-radius: 0.75rem;\n  box-shadow: 0 1px 3px 0 rgba(16, 24, 40, 0.1),\n    0 1px 2px 0 rgba(16, 24, 40, 0.06);\n  opacity: 0.8;\n  cursor: grabbing; /* Changes the cursor to indicate dragging */\n}\n\n/* React PDF Styles - Force Light Theme for PDF Viewer */\n.react-pdf__Document {\n  @apply bg-white;\n}\n\n.react-pdf__Page {\n  @apply bg-white border border-gray-200 shadow-sm;\n}\n\n.react-pdf__Page__canvas {\n  @apply bg-white;\n  /* Force white background to override any dark theme interference */\n  background-color: white !important;\n  color: black !important;\n}\n\n.react-pdf__Page__textContent {\n  @apply bg-white;\n  color: black !important;\n}\n\n.react-pdf__Page__annotations {\n  @apply bg-white;\n}\n\n/* Ensure PDF viewer container always has white background */\n.pdf-viewer-container {\n  @apply bg-white;\n  background-color: white !important;\n  color: black !important;\n}\n\n/* Fallback for any PDF rendering issues */\n.pdf-viewer-container * {\n  color: black !important;\n}\n\n/* Hide Edge/IE built-in password reveal & clear buttons */\ninput[type=\"password\"]::-ms-reveal,\ninput[type=\"password\"]::-ms-clear {\n  display: none;\n  width: 0;\n  height: 0;\n}\n"
        },
        {
          "type": "file",
          "name": "layout.tsx",
          "content": "// src/app/layout.tsx\nimport { Outfit } from \"next/font/google\";\nimport \"./globals.css\";\nimport AppProviders from \"@/providers/AppProvider\"; // provider tunggal\n\nconst outfit = Outfit({ subsets: [\"latin\"] });\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <body className={outfit.className} suppressHydrationWarning={true}>\n        <AppProviders>{children}</AppProviders>\n        <div id=\"datepicker-portal\"></div>\n      </body>\n    </html>\n  );\n}"
        },
        {
          "type": "file",
          "name": "page.tsx",
          "content": "// app/page.tsx\nimport { redirect } from \"next/navigation\";\nimport { getServerSession } from \"next-auth\";   // ✅ helper Next-Auth\nimport { authOptions } from \"@/lib/auth\";  // ✅ kita sudah punya\n\nexport default async function Home() {\n  const session = await getServerSession(authOptions); // ✅\n  if (!session) redirect(\"/login\");\n\n  const { role, verified_at } = session.user;\n  \n  // Check if user needs verification (except super admin)\n  if (role !== \"SUPER_ADMIN\" && !verified_at) {\n    redirect(\"/verification-pending\");\n  }\n\n  // Redirect to appropriate dashboard based on role\n  if (role === \"SUPER_ADMIN\") {\n    redirect(\"/super-admin\");\n  } else if (role === \"APPROVER\") {\n    redirect(\"/approver\");\n  } else if (role === \"REVIEWER\") {\n    redirect(\"/reviewer\");\n  } else if (role === \"VENDOR\") {\n    redirect(\"/vendor\");\n  } else if (role === \"VERIFIER\") {\n    redirect(\"/verifier\");\n  }\n\n  // Fallback redirect to dashboard\n  redirect(\"/dashboard\");\n}"
        },
        {
          "type": "file",
          "name": "socket-provider.tsx",
          "content": "'use client';\n\nimport { createContext, useContext } from 'react';\n\ninterface SocketContextType {\n  socket: null;\n  isConnected: false;\n}\n\nconst SocketContext = createContext<SocketContextType>({\n  socket: null,\n  isConnected: false,\n});\n\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within SocketProvider');\n  }\n  return context;\n};\n\nexport function SocketProvider({ children }: { children: React.ReactNode }) {\n  // Socket.IO has been replaced with Server-Sent Events (SSE)\n  // This provider is kept for backwards compatibility but does nothing\n  console.log('SocketProvider: Socket.IO disabled, using Server-Sent Events instead');\n\n  return (\n    <SocketContext.Provider value={{ socket: null, isConnected: false }}>\n      {children}\n    </SocketContext.Provider>\n  );\n}"
        }
      ]
    },
    {
      "type": "directory",
      "name": "components",
      "children": [
        {
          "type": "directory",
          "name": "admin",
          "children": [
            {
              "type": "file",
              "name": "DeleteUserModal.tsx",
              "content": "\"use client\";\n\nimport React, { useState } from \"react\";\nimport { XMarkIcon, ExclamationTriangleIcon, TrashIcon } from \"@heroicons/react/24/outline\";\nimport { UserData } from \"@/types/user\";\nimport { useToast } from \"@/hooks/useToast\";\n\ninterface DeleteUserModalProps {\n  user: UserData | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUserDelete: (userId: string) => void;\n}\n\nexport default function DeleteUserModal({ user, isOpen, onClose, onUserDelete }: DeleteUserModalProps) {\n  const { showSuccess, showError } = useToast();\n  const [loading, setLoading] = useState(false);\n\n  const handleDelete = async () => {\n    if (!user) return;\n\n    try {\n      setLoading(true);\n      \n      const response = await fetch(`/api/admin/users/${user.id}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Gagal menghapus user');\n      }\n\n      showSuccess('Berhasil', 'User berhasil dihapus');\n      onUserDelete(user.id);\n      onClose();\n      \n    } catch (error: any) {\n      console.error('Error deleting user:', error);\n      showError('Error', error.message || 'Gagal menghapus user');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen || !user) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3\">\n              <ExclamationTriangleIcon className=\"w-5 h-5 text-red-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Hapus User</h2>\n              <p className=\"text-sm text-gray-500\">Tindakan ini tidak dapat dibatalkan</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6\">\n          <div className=\"mb-4\">\n            <div className=\"flex items-center p-4 bg-red-50 rounded-lg border border-red-200\">\n              <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 mr-3 flex-shrink-0\" />\n              <div className=\"text-sm text-red-700\">\n                <p className=\"font-medium\">Peringatan!</p>\n                <p>Tindakan ini akan menghapus user secara permanen dan tidak dapat dibatalkan.</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium text-gray-900\">Detail User yang akan dihapus:</h4>\n            \n            <div className=\"bg-gray-50 rounded-lg p-4 space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Nama:</span>\n                <span className=\"font-medium text-gray-900\">\n                  {user.role === 'VENDOR' ? user.vendor_name : user.officer_name}\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Email:</span>\n                <span className=\"font-medium text-gray-900\">{user.email}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Role:</span>\n                <span className=\"font-medium text-gray-900\">{user.role}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Status:</span>\n                <span className=\"font-medium\">\n                  {user.verified_at || user.verification_status === 'VERIFIED' ? (\n                    <span className=\"text-green-600\">Terverifikasi</span>\n                  ) : user.rejection_reason || user.verification_status === 'REJECTED' ? (\n                    <span className=\"text-red-600\">Ditolak</span>\n                  ) : (\n                    <span className=\"text-yellow-600\">Menunggu</span>\n                  )}\n                </span>\n              </div>\n            </div>\n\n            <div className=\"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n              <p className=\"text-sm text-yellow-800\">\n                <span className=\"font-medium\">Catatan:</span> Semua data terkait user ini termasuk submission dan riwayat aktivitas akan ikut terhapus.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            disabled={loading}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors\"\n          >\n            Batal\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleDelete}\n            disabled={loading}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors flex items-center gap-2\"\n          >\n            <TrashIcon className=\"w-4 h-4\" />\n            {loading ? 'Menghapus...' : 'Ya, Hapus User'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "EditUserModal.tsx",
              "content": "\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { XMarkIcon, UserIcon } from \"@heroicons/react/24/outline\";\nimport { UserData } from \"@/types/user\";\nimport { useToast } from \"@/hooks/useToast\";\nimport Input from \"@/components/form/Input\";\nimport TextArea from \"@/components/form/textarea/TextArea\";\n\ninterface EditUserModalProps {\n  user: UserData | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUserUpdate: (user: UserData) => void;\n}\n\nconst USER_ROLES = [\n  { value: 'VENDOR', label: 'Vendor' },\n  { value: 'VERIFIER', label: 'Verifier' },\n  { value: 'REVIEWER', label: 'Reviewer' },\n  { value: 'APPROVER', label: 'Approver' },\n  { value: 'SUPER_ADMIN', label: 'Super Admin' }\n];\n\nexport default function EditUserModal({ user, isOpen, onClose, onUserUpdate }: EditUserModalProps) {\n  const { showSuccess, showError } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    officer_name: '',\n    vendor_name: '',\n    email: '',\n    phone_number: '',\n    address: '',\n    role: 'VENDOR'\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (user) {\n      setFormData({\n        officer_name: user.officer_name || '',\n        vendor_name: user.vendor_name || '',\n        email: user.email || '',\n        phone_number: user.phone_number || '',\n        address: user.address || '',\n        role: user.role || 'VENDOR'\n      });\n      setErrors({});\n    }\n  }, [user]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({ ...prev, [name]: value }));\n    \n    // Clear error when user starts typing\n    if (errors[name]) {\n      setErrors(prev => ({ ...prev, [name]: '' }));\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.email.trim()) {\n      newErrors.email = 'Email wajib diisi';\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = 'Format email tidak valid';\n    }\n\n    if (formData.role === 'VENDOR') {\n      if (!formData.vendor_name.trim()) {\n        newErrors.vendor_name = 'Nama vendor wajib diisi untuk role vendor';\n      }\n    } else {\n      if (!formData.officer_name.trim()) {\n        newErrors.officer_name = 'Nama petugas wajib diisi';\n      }\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n\n    try {\n      setLoading(true);\n      \n      const dataToSend = {\n        ...formData,\n        // Clean up data based on role\n        vendor_name: formData.role === 'VENDOR' ? formData.vendor_name : null,\n        officer_name: formData.role !== 'VENDOR' ? formData.officer_name : null\n      };\n\n      const response = await fetch(`/api/admin/users/${user?.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(dataToSend),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Gagal mengupdate user');\n      }\n\n      const result = await response.json();\n      \n      showSuccess('Berhasil', 'Data user berhasil diperbarui');\n      onUserUpdate(result.user);\n      onClose();\n      \n    } catch (error: any) {\n      console.error('Error updating user:', error);\n      showError('Error', error.message || 'Gagal mengupdate user');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen || !user) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3\">\n              <UserIcon className=\"w-5 h-5 text-blue-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Edit User</h2>\n              <p className=\"text-sm text-gray-500\">Perbarui informasi user</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <form onSubmit={handleSubmit} className=\"p-6 max-h-[calc(90vh-140px)] overflow-y-auto\">\n          <div className=\"space-y-6\">\n            {/* Role Selection */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Role <span className=\"text-red-500\">*</span>\n              </label>\n              <select\n                name=\"role\"\n                value={formData.role}\n                onChange={handleChange}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                required\n              >\n                {USER_ROLES.map(role => (\n                  <option key={role.value} value={role.value}>\n                    {role.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Conditional Name Fields */}\n              {formData.role === 'VENDOR' ? (\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Vendor <span className=\"text-red-500\">*</span>\n                  </label>\n                  <Input\n                    name=\"vendor_name\"\n                    type=\"text\"\n                    value={formData.vendor_name}\n                    onChange={handleChange}\n                    placeholder=\"PT. Nama Perusahaan\"\n                    {...(errors.vendor_name && { error: errors.vendor_name })}\n                    required\n                  />\n                </div>\n              ) : (\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Petugas <span className=\"text-red-500\">*</span>\n                  </label>\n                  <Input\n                    name=\"officer_name\"\n                    type=\"text\"\n                    value={formData.officer_name}\n                    onChange={handleChange}\n                    placeholder=\"Nama Lengkap Petugas\"\n                    {...(errors.officer_name && { error: errors.officer_name })}\n                    required\n                  />\n                </div>\n              )}\n\n              {/* Email */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Email <span className=\"text-red-500\">*</span>\n                </label>\n                <Input\n                  name=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={handleChange}\n                  placeholder=\"email@example.com\"\n                  {...(errors.email && { error: errors.email })}\n                  required\n                />\n              </div>\n\n              {/* Phone Number */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Nomor Telepon\n                </label>\n                <Input\n                  name=\"phone_number\"\n                  type=\"tel\"\n                  value={formData.phone_number}\n                  onChange={handleChange}\n                  placeholder=\"08123456789\"\n                  {...(errors.phone_number && { error: errors.phone_number })}\n                />\n              </div>\n\n              {/* Address */}\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Alamat\n                </label>\n                <TextArea\n                  name=\"address\"\n                  value={formData.address}\n                  onChange={handleChange}\n                  placeholder=\"Alamat lengkap\"\n                  rows={3}\n                  {...(errors.address && { error: errors.address })}\n                />\n              </div>\n            </div>\n          </div>\n        </form>\n\n        {/* Footer */}\n        <div className=\"flex justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n          >\n            Batal\n          </button>\n          <button\n            type=\"submit\"\n            onClick={handleSubmit}\n            disabled={loading}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n          >\n            {loading ? 'Menyimpan...' : 'Simpan Perubahan'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "UserVerificationManagement.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\n// ⛔️ Hapus import Button external agar seragam di file ini\n// import Button from '@/components/ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport ReviewerUserVerificationModal from '@/components/reviewer/ReviewerUserVerificationModal';\nimport EditUserModal from '@/components/admin/EditUserModal';\nimport DeleteUserModal from '@/components/admin/DeleteUserModal';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  UserIcon,\n  ClockIcon,\n  // ⛔️ Hapus ikon untuk tombol aksi agar simple (tanpa ikon)\n  // PencilIcon,\n  // TrashIcon,\n} from '@heroicons/react/24/outline';\nimport type { UserData } from '@/types/user';\n\ninterface Stats {\n  totalPending: number;\n  totalVerified: number;\n  totalRejected: number;\n  totalUsers: number;\n  todayRegistrations: number;\n}\n\ninterface UserVerificationManagementProps {\n  className?: string;\n  refreshTrigger?: number;\n}\n\ntype SortField = keyof UserData;\ntype SortOrder = 'asc' | 'desc';\n\n// Debounce helper\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n  useEffect(() => {\n    const t = setTimeout(() => setDebouncedValue(value), delay);\n    return () => clearTimeout(t);\n  }, [value, delay]);\n  return debouncedValue;\n}\n\nexport default function UserVerificationManagement({\n  className = '',\n  refreshTrigger = 0,\n}: UserVerificationManagementProps) {\n  const { showSuccess } = useToast();\n  const [users, setUsers] = useState<UserData[]>([]);\n  const [stats, setStats] = useState<Stats>({\n    totalPending: 0,\n    totalVerified: 0,\n    totalRejected: 0,\n    totalUsers: 0,\n    todayRegistrations: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  // Pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalUsersCount, setTotalUsersCount] = useState(0);\n  const [limit] = useState(10);\n\n  // Search & Filter\n  const [searchTerm, setSearchTerm] = useState('');\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n  const [statusFilter, setStatusFilter] = useState<'all' | 'pending' | 'verified' | 'rejected'>('all');\n\n  // Sorting\n  const [sortField, setSortField] = useState<SortField>('created_at');\n  const [sortOrder, setSortOrder] = useState<SortOrder>('desc');\n\n  // Modal states\n  const [selectedUser, setSelectedUser] = useState<UserData | null>(null);\n  const [showVerificationModal, setShowVerificationModal] = useState(false);\n  const [showEditUserModal, setShowEditUserModal] = useState(false);\n  const [showDeleteUserModal, setShowDeleteUserModal] = useState(false);\n\n  // Search focus retainer\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  // ======= SIMPLE BUTTON STYLES (inline, tanpa komponen terpisah) =======\n  const btnBase =\n    'inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';\n  const btnText = 'text-xs'; // ukuran ringkas untuk ruang tabel\n  const btnLink = `${btnBase} ${btnText} text-blue-700 hover:bg-blue-50 focus-visible:ring-blue-400 px-2 py-1.5`;\n  const btnNeutral = `${btnBase} ${btnText} text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus-visible:ring-gray-400 px-3 py-1.5`;\n  const btnDanger = `${btnBase} ${btnText} text-white bg-red-600 hover:bg-red-700 focus-visible:ring-red-600 px-3 py-1.5`;\n  const btnOutline = `${btnBase} text-sm px-3 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus-visible:ring-blue-500`;\n\n  const fetchUsers = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: String(currentPage),\n        limit: String(limit),\n        sortBy: String(sortField),\n        sortOrder: String(sortOrder),\n      });\n      if (debouncedSearchTerm) params.append('search', debouncedSearchTerm);\n      if (statusFilter !== 'all') params.append('status', statusFilter);\n\n      const res = await fetch(`/api/reviewer/users?${params.toString()}`, { cache: 'no-store' });\n      if (!res.ok) {\n        const err = await res.json().catch(() => ({}));\n        throw new Error(err.error || 'Gagal mengambil data user');\n      }\n      const data = await res.json();\n\n      // Expecting shape: { users: UserData[], stats: Stats, pagination: { totalPages, total } }\n      setUsers(Array.isArray(data.users) ? data.users : []);\n      setStats(\n        data.stats || {\n          totalPending: 0,\n          totalVerified: 0,\n          totalRejected: 0,\n          totalUsers: 0,\n          todayRegistrations: 0,\n        }\n      );\n      setTotalPages(Number(data.pagination?.totalPages || 1));\n      setTotalUsersCount(Number(data.pagination?.total || 0));\n    } catch (e) {\n      setError(e instanceof Error ? e.message : 'Terjadi kesalahan');\n      console.error('Error fetching users:', e);\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, debouncedSearchTerm, statusFilter, sortField, sortOrder, limit]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers, refreshTrigger]);\n\n  // Reset ke halaman 1 saat parameter list berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, statusFilter, sortField, sortOrder]);\n\n  // Kembalikan fokus ke search input setelah selesai loading\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  const handleSort = useCallback(\n    (field: SortField) => {\n      if (sortField === field) {\n        setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n      } else {\n        setSortField(field);\n        setSortOrder('asc');\n      }\n    },\n    [sortField, sortOrder]\n  );\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const resetFilters = useCallback(() => {\n    setSearchTerm('');\n    setStatusFilter('all');\n    setCurrentPage(1);\n    setSortField('created_at');\n    setSortOrder('desc');\n  }, []);\n\n  const getSortIcon = useCallback(\n    (field: SortField) => {\n      if (sortField !== field) return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n      return sortOrder === 'asc' ? (\n        <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      ) : (\n        <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />\n      );\n    },\n    [sortField, sortOrder]\n  );\n\n  const formatDate = useCallback((dateString: string | Date | null | undefined) => {\n    if (!dateString) return 'N/A';\n    try {\n      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n      if (isNaN(date.getTime())) return 'N/A';\n      return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' });\n    } catch {\n      return 'N/A';\n    }\n  }, []);\n\n  const getRoleBadge = useCallback((role: UserData['role'] | string) => {\n    const r = String(role); // toleransi enum/string\n    const colors: Record<string, string> = {\n      VENDOR: 'bg-green-100 text-green-800',\n      VERIFIER: 'bg-blue-100 text-blue-800',\n      REVIEWER: 'bg-yellow-100 text-yellow-800',\n      APPROVER: 'bg-orange-100 text-orange-800',\n      ADMIN: 'bg-purple-100 text-purple-800',\n      SUPER_ADMIN: 'bg-red-100 text-red-800',\n    };\n    return <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[r] || 'bg-gray-100 text-gray-800'}`}>{r}</span>;\n  }, []);\n\n  const getVerificationStatus = useCallback((user: UserData) => {\n    const s = user.verification_status || 'PENDING';\n    switch (s) {\n      case 'VERIFIED':\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">Terverifikasi</span>;\n      case 'REJECTED':\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800\">Ditolak</span>;\n      case 'PENDING':\n      default:\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-amber-100 text-amber-800\">Menunggu Verifikasi</span>;\n    }\n  }, []);\n\n  // === Modal wiring ===\n  const openVerificationModal = (user: UserData) => {\n    setSelectedUser(user);\n    setShowVerificationModal(true);\n  };\n  const closeVerificationModal = () => {\n    setShowVerificationModal(false);\n    setSelectedUser(null);\n  };\n  const openEditModal = (user: UserData) => {\n    setSelectedUser(user);\n    setShowEditUserModal(true);\n  };\n  const closeEditModal = () => {\n    setShowEditUserModal(false);\n    setSelectedUser(null);\n  };\n  const openDeleteModal = (user: UserData) => {\n    setSelectedUser(user);\n    setShowDeleteUserModal(true);\n  };\n  const closeDeleteModal = () => {\n    setShowDeleteUserModal(false);\n    setSelectedUser(null);\n  };\n\n  // Saat modal update user (approve/reject), sinkronkan list & stats\n  const handleUserUpdateFromModal = (updated: UserData) => {\n    setUsers((prev) => prev.map((u) => (u.id === updated.id ? { ...u, ...updated } : u)));\n\n    // Optimistic stats tweak:\n    setStats((prev) => {\n      const old = users.find((u) => u.id === updated.id);\n      if (!old) return prev;\n      const oldS = old.verification_status || 'PENDING';\n      const newS = updated.verification_status || 'PENDING';\n      if (oldS === newS) return prev;\n\n      let { totalPending, totalVerified, totalRejected } = prev;\n      const { totalUsers, todayRegistrations } = prev;\n      if (oldS === 'PENDING') totalPending = Math.max(0, totalPending - 1);\n      if (oldS === 'VERIFIED') totalVerified = Math.max(0, totalVerified - 1);\n      if (oldS === 'REJECTED') totalRejected = Math.max(0, totalRejected - 1);\n\n      if (newS === 'PENDING') totalPending += 1;\n      if (newS === 'VERIFIED') totalVerified += 1;\n      if (newS === 'REJECTED') totalRejected += 1;\n\n      return { totalPending, totalVerified, totalRejected, totalUsers, todayRegistrations };\n    });\n\n    // Refetch agar 100% konsisten\n    fetchUsers().catch(() => {});\n    showSuccess('Berhasil', 'Status verifikasi diperbarui');\n  };\n\n  // Handle edit user update\n  const handleUserEdit = (updated: UserData) => {\n    setUsers((prev) => prev.map((u) => (u.id === updated.id ? { ...u, ...updated } : u)));\n    // Refetch to ensure consistency\n    fetchUsers().catch(() => {});\n    showSuccess('Berhasil', 'Data user berhasil diperbarui');\n  };\n\n  // Handle user delete\n  const handleUserDelete = (deletedUserId: string) => {\n    setUsers((prev) => prev.filter((u) => u.id !== deletedUserId));\n    // Update stats\n    setStats((prev) => ({\n      ...prev,\n      totalUsers: Math.max(0, prev.totalUsers - 1)\n    }));\n    // Refetch to ensure consistency\n    fetchUsers().catch(() => {});\n    showSuccess('Berhasil', 'User berhasil dihapus');\n  };\n\n  const paginationInfo = useMemo(\n    () => ({\n      currentPage,\n      totalPages,\n      total: totalUsersCount,\n      startItem: (currentPage - 1) * limit + 1,\n      endItem: Math.min(currentPage * limit, totalUsersCount),\n    }),\n    [currentPage, totalPages, totalUsersCount, limit]\n  );\n\n  // ==== Render table content ====\n  const tableContent = useMemo(() => {\n    if (error) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n            <div className=\"text-red-800\">{error}</div>\n            <button onClick={fetchUsers} className={`${btnDanger} mt-2`}>\n              Coba Lagi\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    if (users.length === 0 && !loading) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-500\">Tidak ada user yang ditemukan</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th\n                  onClick={() => handleSort('officer_name')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Nama Petugas</span>\n                    {getSortIcon('officer_name')}\n                  </div>\n                </th>\n                <th\n                  onClick={() => handleSort('email')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Email</span>\n                    {getSortIcon('email')}\n                  </div>\n                </th>\n                <th\n                  onClick={() => handleSort('role')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Role</span>\n                    {getSortIcon('role')}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor/Kontak</th>\n                <th\n                  onClick={() => handleSort('created_at')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tgl Dibuat</span>\n                    {getSortIcon('created_at')}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n              </tr>\n            </thead>\n\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {users.map((user) => (\n                <tr key={user.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                    {user.address && <div className=\"text-sm text-gray-500 truncate max-w-xs\">{user.address}</div>}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.email}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">{getRoleBadge(user.role)}</td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.vendor_name ?? '-'}</div>\n                    {user.phone_number && <div className=\"text-sm text-gray-500\">{user.phone_number}</div>}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{formatDate(user.created_at)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">{getVerificationStatus(user)}</td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <div className=\"flex items-center justify-end gap-2\">\n                      {/* Tombol link-like (ringkas) untuk lihat detail/verifikasi */}\n                      <button\n                        onClick={() => openVerificationModal(user)}\n                        className={btnLink}\n                        title=\"Lihat Detail\"\n                      >\n                        Lihat\n                      </button>\n\n                      {/* Tombol netral untuk edit */}\n                      <button\n                        onClick={() => openEditModal(user)}\n                        className={btnNeutral}\n                        title=\"Edit User\"\n                      >\n                        Edit\n                      </button>\n\n                      {/* Tombol merah solid untuk aksi destruktif */}\n                      <button\n                        onClick={() => openDeleteModal(user)}\n                        className={btnDanger}\n                        title=\"Hapus User\"\n                      >\n                        Hapus\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {loading && (\n          <div className=\"flex justify-center items-center h-32\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\" />\n          </div>\n        )}\n      </div>\n    );\n  }, [users, loading, error, handleSort, getSortIcon, formatDate, getRoleBadge, getVerificationStatus]);\n\n  if (loading && users.length === 0) {\n    return (\n      <div className={`space-y-6 ${className}`}>\n        <div className=\"animate-pulse\">\n          <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-4\" />\n          <div className=\"space-y-3\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"h-16 bg-gray-200 rounded\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Statistik Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Verifikasi</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats.totalPending}</p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Terverifikasi</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.totalVerified}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n              <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats.totalRejected}</p>\n            </div>\n            <div className=\"p-3 bg-red-100 rounded-full\">\n              <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total User</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.totalUsers}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Registrasi Hari Ini</h3>\n              <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats.todayRegistrations}</p>\n            </div>\n            <div className=\"p-3 bg-purple-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-purple-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Search & Filter */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari nama, email, vendor, atau nomor telepon...\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        <select\n          value={statusFilter}\n          onChange={(e) => {\n            const v = e.target.value as 'all' | 'pending' | 'verified' | 'rejected';\n            setStatusFilter(v);\n            setCurrentPage(1);\n          }}\n          className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n        >\n          <option value=\"all\">Semua Status</option>\n          <option value=\"pending\">Belum Verifikasi</option>\n          <option value=\"verified\">Sudah Verifikasi</option>\n          <option value=\"rejected\">Ditolak</option>\n        </select>\n\n        {/* Tombol reset filter pakai style outline lokal */}\n        <button onClick={resetFilters} className={btnOutline}>\n          Reset Filter\n        </button>\n      </div>\n\n      {/* Tabel */}\n      <div className=\"relative\">{tableContent}</div>\n\n      {/* Pagination (tetap) */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-gray-700\">\n            Menampilkan {paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.total} user\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setCurrentPage((p) => Math.max(p - 1, 1))}\n              disabled={currentPage === 1}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Sebelumnya\n            </button>\n\n            <div className=\"flex items-center space-x-1\">\n              {[...Array(totalPages)].map((_, i) => {\n                const page = i + 1;\n                if (page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)) {\n                  return (\n                    <button\n                      key={page}\n                      onClick={() => setCurrentPage(page)}\n                      className={`px-3 py-2 border text-sm font-medium rounded-md ${\n                        currentPage === page\n                          ? 'bg-blue-500 border-blue-500 text-white'\n                          : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                      }`}\n                    >\n                      {page}\n                    </button>\n                  );\n                } else if (page === currentPage - 2 || page === currentPage + 2) {\n                  return (\n                    <span key={page} className=\"text-gray-500\">\n                      …\n                    </span>\n                  );\n                }\n                return null;\n              })}\n            </div>\n\n            <button\n              onClick={() => setCurrentPage((p) => Math.min(p + 1, totalPages))}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Selanjutnya\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Modal verifikasi */}\n      <ReviewerUserVerificationModal\n        user={selectedUser}\n        isOpen={showVerificationModal}\n        onClose={closeVerificationModal}\n        onUserUpdate={handleUserUpdateFromModal}\n      />\n\n      {/* Modal Edit User */}\n      <EditUserModal\n        user={selectedUser}\n        isOpen={showEditUserModal}\n        onClose={closeEditModal}\n        onUserUpdate={handleUserEdit}\n      />\n\n      {/* Modal Delete User */}\n      <DeleteUserModal\n        user={selectedUser}\n        isOpen={showDeleteUserModal}\n        onClose={closeDeleteModal}\n        onUserDelete={handleUserDelete}\n      />\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "approver",
          "children": [
            {
              "type": "file",
              "name": "ApproverDashboard.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  EyeIcon,\n  ClipboardDocumentListIcon,\n  CheckCircleIcon,\n  ChartBarIcon,\n  ClockIcon\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport StatsCardsLoader from '@/components/ui/StatsCardsLoader';\nimport TableLoader from '@/components/ui/TableLoader';\nimport ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';\nimport Link from 'next/link';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  updated_at?: string;\n  reviewed_at?: string | null;\n  approved_at?: string | null;\n  reviewed_by?: string | null;\n  approved_by?: string | null;\n  workers: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface DashboardStats {\n  total: number;\n  pending_approval_meets: number;\n  pending_approval_not_meets: number;\n  approved: number;\n  rejected: number;\n}\n\nexport default function ApproverDashboard() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [stats, setStats] = useState<DashboardStats>({\n    total: 0,\n    pending_approval_meets: 0,\n    pending_approval_not_meets: 0,\n    approved: 0,\n    rejected: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const fetchDashboardData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      // Fetch stats dan 10 submission terakhir untuk dashboard\n      const response = await fetch('/api/approver/simloks?page=1&limit=10&sortBy=reviewed_at&sortOrder=desc');\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data dashboard');\n      }\n      \n      const data = await response.json();\n      setSubmissions(data.submissions);\n      setStats(data.statistics);\n      setError(null);\n    } catch (err) {\n      console.error('Error fetching dashboard data:', err);\n      setError('Gagal memuat data dashboard');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, [fetchDashboardData]);\n\n  // Socket untuk real-time updates\n  const socket = useSocket();\n  \n  useEffect(() => {\n    if (!socket) return;\n\n    // Join approver room\n    socket.emit('join', { role: 'APPROVER' });\n\n    const handleNotificationNew = (notification: any) => {\n      console.log('New notification received for approver:', notification);\n      if (notification.type === 'reviewed_submission_approval') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleStatsUpdate = (statsUpdate: any) => {\n      console.log('Stats update received for approver:', statsUpdate);\n      if (statsUpdate.scope === 'approver') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleSubmissionReviewed = () => {\n      console.log('Submission reviewed - updating approver dashboard');\n      fetchDashboardData();\n    };\n\n    // Listen for new notifications (including reviewed submissions)\n    socket.on('notification:new', handleNotificationNew);\n    // Listen for stats updates\n    socket.on('stats:update', handleStatsUpdate);\n    // Listen for specific submission review events\n    socket.on('submission:reviewed', handleSubmissionReviewed);\n\n    return () => {\n      socket.off('notification:new', handleNotificationNew);\n      socket.off('stats:update', handleStatsUpdate);\n      socket.off('submission:reviewed', handleSubmissionReviewed);\n    };\n  }, [socket, fetchDashboardData]);\n\n  const handleViewDetail = (submissionId: string) => {\n    setSelectedSubmission(submissionId);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleApprovalSubmitted = () => {\n    fetchDashboardData();\n    handleCloseModal();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;\n        case 'MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <span className={`${baseClasses} bg-amber-100 text-amber-800`}>Menunggu Persetujuan</span>;\n        case 'APPROVED':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;\n        case 'REJECTED':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <StatsCardsLoader count={4} />\n        <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <TableLoader rows={5} columns={4} />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} className=\"mb-6\" />\n      )}\n\n      {/* Statistics Cards - Dashboard Design */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total Pengajuan</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.total}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <ClipboardDocumentListIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Persetujuan</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">\n                {stats.pending_approval_meets + stats.pending_approval_not_meets}\n              </p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.approved}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n              <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats.rejected}</p>\n            </div>\n            <div className=\"p-3 bg-red-100 rounded-full\">\n              <ChartBarIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Submissions */}\n      <div className=\"bg-white rounded-xl border shadow-sm\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between\">\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Pengajuan Terbaru</h2>\n              <p className=\"text-sm text-gray-500 mt-1\">10 pengajuan terakhir untuk persetujuan</p>\n            </div>\n            <Link \n              href=\"/approver/submissions\"\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors\"\n            >\n              Lihat Semua Pengajuan\n            </Link>\n          </div>\n        </div>\n        \n        {submissions.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <ClipboardDocumentListIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Tidak ada pengajuan</h3>\n            <p className=\"mt-1 text-sm text-gray-500\">Belum ada pengajuan yang perlu disetujui</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Vendor\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Deskripsi Pekerjaan\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status Review\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status Persetujuan\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Tanggal\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Aksi\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {submissions.map((submission) => (\n                  <tr key={submission.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {submission.vendor_name}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {submission.officer_name}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"text-sm text-gray-900 max-w-xs truncate\">\n                        {submission.job_description}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {submission.work_location}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      {getStatusBadge(submission.review_status, 'review')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      {getStatusBadge(submission.final_status, 'final')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {new Date(submission.created_at).toLocaleDateString('id-ID')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                      <Button\n                        onClick={() => handleViewDetail(submission.id)}\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"text-blue-600 hover:text-blue-700\"\n                      >\n                        <EyeIcon className=\"h-4 w-4 mr-1\" />\n                        Detail\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n\n      {/* Modal */}\n      {selectedSubmission && (\n        <ApproverSubmissionDetailModal\n          submissionId={selectedSubmission}\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n          onApprovalSubmitted={handleApprovalSubmitted}\n        />\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "ApproverScanHistoryContent.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  FunnelIcon,\n  QrCodeIcon,\n  UserIcon,\n  DocumentTextIcon,\n  ClockIcon,\n  EyeIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport { formatDistanceToNow, format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport DatePicker from '@/components/form/DatePicker';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    job_description: string;\n    review_status: string;\n    final_status: string;\n  };\n  user: {\n    id: string;\n    full_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface FilterState {\n  dateFrom: string;\n  dateTo: string;\n  verifier: string;\n  submissionId: string;\n}\n\nexport default function ApproverScanHistoryContent() {\n  const [scans, setScans] = useState<QrScan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n  const [filters, setFilters] = useState<FilterState>({\n    dateFrom: '',\n    dateTo: '',\n    verifier: '',\n    submissionId: ''\n  });\n  const [showFilters, setShowFilters] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n  const [showPdfModal, setShowPdfModal] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const pageSize = 15;\n\n  const fetchScanHistory = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: pageSize.toString(),\n        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),\n        ...(filters.dateTo && { dateTo: filters.dateTo }),\n        ...(filters.verifier && { verifier: filters.verifier }),\n        ...(filters.submissionId && { submissionId: filters.submissionId }),\n        ...(searchTerm && { search: searchTerm })\n      });\n\n      const response = await fetch(`/api/scan-history?${params}`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data = await response.json();\n      setScans(data.scans || []);\n      setTotalPages(Math.ceil((data.total || 0) / pageSize));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchScanHistory();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [currentPage, searchTerm]);\n\n  const handleFilterSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const resetFilters = () => {\n    setFilters({\n      dateFrom: '',\n      dateTo: '',\n      verifier: '',\n      submissionId: ''\n    });\n    setSearchTerm('');\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <Badge variant=\"warning\">Menunggu Review</Badge>;\n        case 'MEETS_REQUIREMENTS':\n          return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n        default:\n          return null;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n        case 'APPROVED':\n          return <Badge variant=\"success\">Disetujui</Badge>;\n        case 'REJECTED':\n          return <Badge variant=\"destructive\">Ditolak</Badge>;\n        default:\n          return null;\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Search and Filters */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"p-2 bg-green-100 rounded-lg\">\n              <QrCodeIcon className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">Manajemen Riwayat Scan</h2>\n              <p className=\"text-sm text-gray-500\">Pantau aktivitas scan QR code oleh verifikator</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-3\">\n            <Button\n              onClick={() => setShowFilters(!showFilters)}\n              variant={showFilters ? 'secondary' : 'primary'}\n              className=\"flex items-center space-x-2\"\n            >\n              <FunnelIcon className=\"h-4 w-4\" />\n              <span>Filter</span>\n            </Button>\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"relative mb-4\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            placeholder=\"Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator...\"\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n          />\n        </div>\n\n        {/* Advanced Filters */}\n        {showFilters && (\n          <div className=\"border-t border-gray-200 pt-4\">\n            <form onSubmit={handleFilterSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Dari\n                  </label>\n                  <DatePicker\n                    value={filters.dateFrom}\n                    onChange={(value) => setFilters(prev => ({ ...prev, dateFrom: value }))}\n                    placeholder=\"Pilih tanggal dari\"\n                    className=\"w-full\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Sampai\n                  </label>\n                  <DatePicker\n                    value={filters.dateTo}\n                    onChange={(value) => setFilters(prev => ({ ...prev, dateTo: value }))}\n                    placeholder=\"Pilih tanggal sampai\"\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Verifikator\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.verifier}\n                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nama verifikator...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nomor Simlok\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.submissionId}\n                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nomor simlok...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3\">\n                <Button type=\"submit\" className=\"flex items-center space-x-2\">\n                  <MagnifyingGlassIcon className=\"h-4 w-4\" />\n                  <span>Terapkan Filter</span>\n                </Button>\n                \n                <Button \n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={resetFilters}\n                >\n                  Reset\n                </Button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Scan History Table */}\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8\">\n            <div className=\"animate-pulse space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-gray-200 rounded-lg\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                  </div>\n                  <div className=\"w-20 h-8 bg-gray-200 rounded\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ) : scans.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <QrCodeIcon className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No scan history found</h3>\n            <p className=\"text-gray-500\">No QR code scans match your current filters.</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pengajuan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Verifikator\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Waktu Scan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {scans.map((scan) => (\n                    <tr key={scan.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-2 bg-green-100 rounded-lg mr-3\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-green-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.submission.simlok_number}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {scan.submission.vendor_name}\n                            </div>\n                            <div className=\"text-xs text-gray-400 truncate max-w-xs\">\n                              {scan.submission.job_description}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-1.5 bg-blue-100 rounded-full mr-3\">\n                            <UserIcon className=\"h-4 w-4 text-blue-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.user.full_name}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {scan.user.email}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center text-sm text-gray-900\">\n                          <ClockIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <div>\n                            <div className=\"font-medium\">\n                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"space-y-1\">\n                          {getStatusBadge(scan.submission.review_status, 'review')}\n                          {getStatusBadge(scan.submission.final_status, 'final')}\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          className=\"flex items-center space-x-1\"\n                        >\n                          <EyeIcon className=\"h-4 w-4\" />\n                          <span>Detail</span>\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"bg-white px-4 py-3 border-t border-gray-200 sm:px-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <p className=\"text-sm text-gray-700\">\n                      Menampilkan halaman <span className=\"font-medium\">{currentPage}</span> dari{' '}\n                      <span className=\"font-medium\">{totalPages}</span>\n                    </p>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <ChevronLeftIcon className=\"h-4 w-4\" />\n                      <span>Sebelumnya</span>\n                    </Button>\n                    \n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}\n                      disabled={currentPage === totalPages}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <span>Selanjutnya</span>\n                      <ChevronRightIcon className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Informasi Detail Scan</h3>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <span className=\"sr-only\">Close</span>\n                  ✕\n                </button>\n              </div>\n            </div>\n            \n            <div className=\"p-6 space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Pengajuan</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nomor Simlok:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.simlok_number}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Perusahaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.vendor_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Deskripsi Pekerjaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.job_description}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Verifikator</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nama:</span>\n                      <span className=\"font-medium\">{selectedScan.user.full_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Email:</span>\n                      <span className=\"font-medium\">{selectedScan.user.email}</span>\n                    </div>\n                    \n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Detail Scan</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-500\">Waktu Scan:</span>\n                    <span className=\"font-medium\">\n                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}\n                    </span>\n                  </div>\n                  {selectedScan.scanner_name && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Scanner Name:</span>\n                      <span className=\"font-medium\">{selectedScan.scanner_name}</span>\n                    </div>\n                  )}\n                  {selectedScan.scan_location && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Lokasi Scan:</span>\n                      <span className=\"font-medium\">{selectedScan.scan_location}</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              {/* PDF Button */}\n              <div className=\"flex justify-center pt-4 border-t border-gray-200\">\n                <Button\n                  onClick={() => setShowPdfModal(true)}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2\"\n                >\n                  <DocumentTextIcon className=\"w-5 h-5\" />\n                  <span>Lihat PDF SIMLOK</span>\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* SimlokPdfModal */}\n      {selectedScan && (\n        <SimlokPdfModal\n          isOpen={showPdfModal}\n          onClose={() => setShowPdfModal(false)}\n          submissionId={selectedScan.submission.id}\n          submissionName={selectedScan.submission.vendor_name}\n          nomorSimlok={selectedScan.submission.simlok_number}\n        />\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "ApproverSubmissionDetailModal.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  XMarkIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  DocumentTextIcon,\n  UserGroupIcon,\n  ClipboardDocumentCheckIcon,\n  QrCodeIcon,\n  ClockIcon,\n  BuildingOfficeIcon,\n  BriefcaseIcon,\n  DocumentIcon,\n  CalendarIcon,\n  EyeIcon,\n  MapPinIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { useToast } from '@/hooks/useToast';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport DetailSection from '@/components/common/DetailSection';\nimport InfoCard from '@/components/common/InfoCard';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\n\nimport DatePicker from '@/components/form/DatePicker';\n\ninterface SubmissionDetail {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  officer_email?: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  worker_count: number | null;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  implementation_start_date?: string | null;\n  implementation_end_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  reviewed_by_name?: string;\n  reviewed_by_email?: string;\n  final_note?: string;\n  approved_by_name?: string;\n  approved_by_email?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n    created_at: string;\n  }>;\n}\n\ninterface QrScan {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;\n  notes?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface ScanHistory {\n  scans: QrScan[];\n  totalScans: number;\n  lastScan?: QrScan;\n  hasBeenScanned: boolean;\n}\n\ninterface ApproverSubmissionDetailModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  onApprovalSubmitted: () => void;\n}\n\nconst ApproverSubmissionDetailModal: React.FC<ApproverSubmissionDetailModalProps> = ({\n  isOpen,\n  onClose,\n  submissionId,\n  onApprovalSubmitted\n}) => {\n  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'approval'>('details');\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n  const [scanHistory, setScanHistory] = useState<ScanHistory | null>(null);\n  const [loadingScanHistory, setLoadingScanHistory] = useState(false);\n  const [previewModal, setPreviewModal] = useState<{\n    isOpen: boolean;\n    fileUrl: string;\n    fileName: string;\n  }>({\n    isOpen: false,\n    fileUrl: '',\n    fileName: ''\n  });\n  const { showSuccess, showError } = useToast();\n\n  // Function to generate auto SIMLOK number - mengikuti sistem admin yang sudah ada\n  const generateSimlokNumber = async () => {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n    try {\n      // Call API untuk mendapatkan nomor terakhir (untuk demo, kita gunakan format sederhana)\n      // Server akan handle logic yang sebenarnya saat approve\n      \n      // Fallback format client-side: auto-increment berdasarkan bulan/tahun saat ini\n      // Format: sequential_number/MM/YYYY (contoh: 1/09/2025, 2/09/2025)\n      const timestamp = Date.now();\n      const fallbackNumber = timestamp % 1000; // Simple fallback\n      return `${fallbackNumber}/${month}/${year}`;\n    } catch (error) {\n      // Fallback jika error\n      const fallbackNumber = Math.floor(Math.random() * 1000) + 1;\n      return `${fallbackNumber}/${month}/${year}`;\n    }\n  };\n\n  // Function to get current date in YYYY-MM-DD format\n  const getCurrentDate = () => {\n    const now = new Date();\n    return now.toISOString().split('T')[0];\n  };\n\n  // Format date for display\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return '-';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  // Handle file view\n  const handleFileView = (fileUrl: string, fileName: string) => {\n    if (fileUrl) {\n      // Convert legacy URL to new format if needed\n      const convertedUrl = fileUrlHelper.convertLegacyUrl(fileUrl, fileName);\n      setPreviewModal({\n        isOpen: true,\n        fileUrl: convertedUrl,\n        fileName\n      });\n    }\n  };\n\n  // Handle close preview\n  const handleClosePreview = () => {\n    setPreviewModal({\n      isOpen: false,\n      fileUrl: '',\n      fileName: ''\n    });\n  };\n\n  // Approval form state\n  const [approvalData, setApprovalData] = useState({\n    final_status: '' as 'APPROVED' | 'REJECTED' | '',\n    simlok_number: '',\n    simlok_date: ''\n  });\n\n  const fetchSubmissionDetail = async () => {\n    if (!submissionId) return;\n    \n    try {\n      setLoading(true);\n      \n      const response = await fetch(`/api/approver/simloks/${submissionId}`);\n      if (!response.ok) {\n        if (response.status === 404) {\n          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');\n          onClose();\n          // Add delay before refreshing so user can see the error message\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n          return;\n        }\n        throw new Error('Gagal mengambil detail pengajuan');\n      }\n      \n      const data = await response.json();\n      setSubmission(data.submission);\n      \n      // Initialize approval data\n      setApprovalData({\n        final_status: data.submission.final_status === 'PENDING_APPROVAL' ? '' : data.submission.final_status,\n        simlok_number: data.submission.simlok_number || '',\n        simlok_date: (data.submission.simlok_date \n          ? new Date(data.submission.simlok_date).toISOString().split('T')[0] \n          : '') as string\n      });\n      \n      // Auto-fill SIMLOK data jika status APPROVED dan belum ada nomor SIMLOK\n      if (data.submission.final_status === 'APPROVED' && !data.submission.simlok_number) {\n        const simlokNumber = await generateSimlokNumber();\n        setApprovalData(prev => ({\n          ...prev,\n          simlok_number: simlokNumber,\n          simlok_date: getCurrentDate() as string\n        }));\n      }\n      \n    } catch (err) {\n      console.error('Error fetching submission:', err);\n      showError('Error', 'Gagal memuat detail pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchScanHistory = async () => {\n    if (!submissionId) return;\n    \n    try {\n      setLoadingScanHistory(true);\n      const response = await fetch(`/api/submissions/${submissionId}/scans`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data: ScanHistory = await response.json();\n      setScanHistory(data);\n    } catch (err) {\n      console.error('Error fetching scan history:', err);\n      // Don't show error for scan history as it's not critical\n    } finally {\n      setLoadingScanHistory(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen && submissionId) {\n      fetchSubmissionDetail();\n      fetchScanHistory();\n    }\n  }, [isOpen, submissionId]);\n\n  const handleViewPdf = () => {\n    setIsPdfModalOpen(true);\n  };\n\n  const handleSubmitApproval = async () => {\n    if (!approvalData.final_status) {\n      showError('Error', 'Pilih status persetujuan terlebih dahulu');\n      return;\n    }\n\n    if (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) {\n      showError('Error', 'Nomor SIMLOK wajib diisi untuk approval');\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      const response = await fetch(`/api/approver/simloks/${submissionId}/final`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          final_status: approvalData.final_status,\n          simlok_number: approvalData.final_status === 'APPROVED' ? approvalData.simlok_number.trim() : undefined,\n          simlok_date: approvalData.final_status === 'APPROVED' && approvalData.simlok_date ? approvalData.simlok_date : undefined,\n        }),\n      });\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');\n          onClose();\n          // Add delay before refreshing so user can see the error message\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n          return;\n        }\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal mengirim persetujuan');\n      }\n\n      const data = await response.json();\n      setSubmission(data.submission);\n      showSuccess('Berhasil', `Pengajuan berhasil ${approvalData.final_status === 'APPROVED' ? 'disetujui' : 'ditolak'}`);\n      onApprovalSubmitted();\n      \n    } catch (err: any) {\n      console.error('Error submitting approval:', err);\n      showError('Error', err.message || 'Gagal menyimpan persetujuan');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const canApprove = submission && submission.final_status === 'PENDING_APPROVAL';\n\n  // Handle status change with auto-fill\n  const handleStatusChange = async (status: 'APPROVED' | 'REJECTED') => {\n    if (status === 'APPROVED') {\n      // Auto-fill nomor SIMLOK dan tanggal jika belum ada\n      const simlokNumber = await generateSimlokNumber();\n      setApprovalData(prev => ({\n        ...prev,\n        final_status: status,\n        simlok_number: prev.simlok_number || simlokNumber,\n        simlok_date: prev.simlok_date || getCurrentDate() as string\n      }));\n    } else {\n      // Reset SIMLOK fields jika status REJECTED\n      setApprovalData(prev => ({\n        ...prev,\n        final_status: status,\n        simlok_number: '',\n        simlok_date: ''\n      }));\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_REVIEW':\n        return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">Detail & Approval Pengajuan</h2>\n            {submission && (\n              <div className=\"text-sm text-gray-500 mt-1 space-y-1\">\n                <p>\n                  <span className=\"font-medium\">{submission.vendor_name}</span> - {submission.officer_name}\n                </p>\n                {submission.simlok_number && (\n                  <p className=\"text-xs\">\n                    <span className=\"font-medium\">No. SIMLOK:</span> {submission.simlok_number}\n                    {submission.simlok_date && (\n                      <span className=\"ml-2\">• <span className=\"font-medium\">Tanggal:</span> {new Date(submission.simlok_date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</span>\n                    )}\n                  </p>\n                )}\n\n                \n                {/* Scan Status */}\n                <div className=\"mt-2 pt-2 border-t border-gray-100\">\n                  {loadingScanHistory ? (\n                    <div className=\"flex items-center text-xs text-gray-500\">\n                      <ClockIcon className=\"h-3 w-3 mr-1 animate-spin\" />\n                      Memuat status scan...\n                    </div>\n                  ) : scanHistory ? (\n                    <div className=\"space-y-1\">\n                      {scanHistory.hasBeenScanned ? (\n                        <div className=\"flex items-center text-xs text-green-600\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span className=\"font-medium\">SIMLOK telah discan</span>\n                          <span className=\"ml-2\">({scanHistory.totalScans}x)</span>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span>SIMLOK belum discan</span>\n                        </div>\n                      )}\n                      \n                      {scanHistory.lastScan && (\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center text-xs text-gray-500\">\n                            <ClockIcon className=\"h-3 w-3 mr-1\" />\n                            <span>Terakhir discan: {new Date(scanHistory.lastScan.scanned_at).toLocaleDateString('id-ID', {\n                              day: 'numeric',\n                              month: 'short',\n                              year: 'numeric',\n                              hour: '2-digit',\n                              minute: '2-digit'\n                            })}</span>\n                          </div>\n                          {scanHistory.lastScan.scan_location && (\n                            <div className=\"flex items-center text-xs text-gray-500\">\n                              <MapPinIcon className=\"h-3 w-3 mr-1\" />\n                              <span>Lokasi: {scanHistory.lastScan.scan_location}</span>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center text-xs text-gray-400\">\n                      <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                      <span>Status scan tidak tersedia</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n          <Button\n            onClick={onClose}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-gray-400 hover:text-gray-600\"\n          >\n            <XMarkIcon className=\"h-6 w-6\" />\n          </Button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200 flex-shrink-0\">\n          <nav className=\"flex space-x-8 px-6\">\n            <button\n              onClick={() => setActiveTab('details')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'details'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <DocumentTextIcon className=\"h-5 w-5 inline mr-2\" />\n              Detail SIMLOK\n            </button>\n            <button\n              onClick={() => setActiveTab('workers')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'workers'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <UserGroupIcon className=\"h-5 w-5 inline mr-2\" />\n              Data Pekerja\n            </button>\n            <button\n              onClick={() => setActiveTab('approval')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'approval'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <ClipboardDocumentCheckIcon className=\"h-5 w-5 inline mr-2\" />\n              Proses Approval\n            </button>\n          </nav>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n            </div>\n          )}\n\n          {submission && (\n            <>\n              {/* Details Tab */}\n              {activeTab === 'details' && (\n                <div className=\"space-y-6\">\n                  {/* Header dengan Status */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Detail SIMLOK</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"text-sm text-gray-500\">Review:</span>\n                      {getStatusBadge(submission.review_status)}\n                      <span className=\"text-sm text-gray-500\">Status:</span>\n                      {getStatusBadge(submission.final_status)}\n                    </div>\n                  </div>\n\n                  {/* Informasi Vendor - menggunakan DetailSection seperti admin */}\n                  <DetailSection \n                    title=\"Informasi Vendor\" \n                    icon={<BuildingOfficeIcon className=\"h-5 w-5 text-blue-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Nama Vendor\"\n                        value={submission.vendor_name}\n                      />\n                      <InfoCard\n                        label=\"Nama Petugas\"\n                        value={submission.officer_name}\n                      />\n                      {/* <InfoCard\n                        label=\"Email\"\n                        value={submission.officer_email || '-'}\n                      /> */}\n                      <InfoCard\n                        label=\"Nomor Telepon Vendor\"\n                        value={submission.vendor_phone || '-'}\n                      />\n                      <InfoCard\n                        label=\"Berdasarkan\"\n                        value={submission.based_on}\n                        className=\"md:col-span-2\"\n                      />\n                    </div>\n                  </DetailSection>\n\n                  {/* Informasi Dokumen - sama seperti admin */}\n                  <DetailSection \n                    title=\"Informasi Dokumen\" \n                    icon={<DocumentIcon className=\"h-5 w-5 text-orange-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      {submission.simja_number && (\n                        <InfoCard\n                          label=\"Nomor SIMJA\"\n                          value={submission.simja_number}\n                        />\n                      )}\n                      {submission.simja_date && (\n                        <InfoCard\n                          label=\"Tanggal SIMJA\"\n                          value={formatDate(submission.simja_date)}\n                        />\n                      )}\n                      {submission.sika_number && (\n                        <InfoCard\n                          label=\"Nomor SIKA\"\n                          value={submission.sika_number}\n                        />\n                      )}\n                      {submission.sika_date && (\n                        <InfoCard\n                          label=\"Tanggal SIKA\"\n                          value={formatDate(submission.sika_date)}\n\n                        />\n                      )}\n                      {/* Status dan Tanggal Pengajuan */}\n                      <InfoCard\n                        label=\"Tanggal Pengajuan\"\n                        value={formatDate(submission.created_at)}\n\n                      />\n                    </div>\n                    <div className=\"grid grid-cols-1 mt-5 md:grid-cols-2 gap-4\">\n                      {/* Dokumen SIKA */}\n                      {submission.sika_document_upload && (\n                        <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                          <div className=\"flex items-center space-x-3\">\n                            <DocumentIcon className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\n                            <div>\n                              <p className=\"font-medium text-gray-900\">Dokumen SIKA</p>\n                              <p className=\"text-sm text-gray-500\">File tersedia</p>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}\n                            className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                          >\n                            <EyeIcon className=\"w-4 h-4\" />\n                            <span>Lihat</span>\n                          </button>\n                        </div>\n                      )}\n\n                      {/* Dokumen SIMJA */}\n                      {submission.simja_document_upload && (\n                        <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                          <div className=\"flex items-center space-x-3\">\n                            <DocumentIcon className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\n                            <div>\n                              <p className=\"font-medium text-gray-900\">Dokumen SIMJA</p>\n                              <p className=\"text-sm text-gray-500\">File tersedia</p>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}\n                            className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                          >\n                            <EyeIcon className=\"w-4 h-4\" />\n                            <span>Lihat</span>\n                          </button>\n                        </div>\n                      )}\n\n                      {/* Message if no documents */}\n                      {!submission.sika_document_upload && !submission.simja_document_upload && (\n                        <div className=\"col-span-2 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n                          <DocumentIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">Tidak ada dokumen</h3>\n                          <p className=\"text-sm text-gray-500\">Belum ada dokumen yang diupload</p>\n                        </div>\n                      )}\n                    </div>\n                  </DetailSection>\n\n                  {/* Detail Pekerjaan - sama seperti admin */}\n                  <DetailSection \n                    title=\"Informasi Pekerjaan\" \n                    icon={<BriefcaseIcon className=\"h-5 w-5 text-green-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Pekerjaan\"\n                        value={submission.job_description}\n                      />\n                      <InfoCard\n                        label=\"Lokasi Kerja\"\n                        value={submission.work_location}\n                      />\n                      <InfoCard\n                        label=\"Pelaksanaan\"\n                        value={submission.implementation || 'Belum diisi'}\n                      />\n                      <InfoCard\n                        label=\"Jam Kerja\"\n                        value={submission.working_hours}\n                      />\n                      <InfoCard\n                        label=\"Jumlah Pekerja\"\n                        value={`${submission.worker_count || 0} orang`}\n                      />\n                      <InfoCard\n                        label=\"Sarana Kerja\"\n                        value={submission.work_facilities}\n                      />\n                    </div>\n                  </DetailSection>\n\n                  {/* Dokumen Pendukung */}\n                  {/* <DetailSection title=\"Dokumen Pendukung\" icon={<DocumentTextIcon className=\"h-5 w-5 text-blue-600\" />}>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Nomor SIMJA\"\n                        value={submission.simja_number || '-'}\n                      />\n                      <InfoCard\n                        label=\"Tanggal SIMJA\"\n                        value={submission.simja_date ? formatDate(submission.simja_date) : '-'}\n                      />\n                      <InfoCard\n                        label=\"Nomor SIKA\"\n                        value={submission.sika_number || '-'}\n                      />\n                      <InfoCard\n                        label=\"Tanggal SIKA\"\n                        value={submission.sika_date ? formatDate(submission.sika_date) : '-'}\n                      />\n                    </div>\n                  </DetailSection> */}\n\n                  {/* Jadwal Pelaksanaan */}\n                  <DetailSection title=\"Jadwal Pelaksanaan\" icon={<CalendarIcon className=\"h-5 w-5 text-blue-600\" />}>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Tanggal Mulai Pelaksanaan\"\n                        value={submission.implementation_start_date ? formatDate(submission.implementation_start_date) : '-'}\n                        \n                      />\n                      <InfoCard\n                        label=\"Tanggal Selesai Pelaksanaan\"\n                        value={submission.implementation_end_date ? formatDate(submission.implementation_end_date) : '-'}\n                        \n                      />\n                    </div>\n                  </DetailSection>\n\n                  {/* Dokumen Upload */}\n                  \n\n                  {/* Final Status Information */}\n                  {submission.final_status !== 'PENDING_APPROVAL' && (\n                    <DetailSection title=\"Status Pengajuan\" icon={<CheckCircleIcon className=\"h-5 w-5 text-blue-600\" />}>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <InfoCard\n                          label=\"Status\"\n                          value={getStatusBadge(submission.final_status)}\n                        />\n                        {submission.simlok_number && (\n                          <InfoCard\n                            label=\"Nomor SIMLOK\"\n                            value={submission.simlok_number}\n                          />\n                        )}\n                        {submission.simlok_date && (\n                          <InfoCard\n                            label=\"Tanggal SIMLOK\"\n                            value={formatDate(submission.simlok_date)}\n                          />\n                        )}\n                        {submission.final_note && (\n                          <InfoCard\n                            label=\"Catatan\"\n                            value={submission.final_note}\n                            className=\"md:col-span-2\"\n                          />\n                        )}\n                        {submission.approved_by_name && (\n                          <InfoCard\n                            label=\"Diproses oleh\"\n                            value={`${submission.approved_by_name}${submission.approved_at ? ` pada ${formatDate(submission.approved_at)}` : ''}`}\n                            className=\"md:col-span-2\"\n                          />\n                        )}\n                      </div>\n                    </DetailSection>\n                  )}\n                </div>\n              )}\n\n              {/* Workers Tab */}\n              {activeTab === 'workers' && (\n                <div className=\"space-y-6\">\n                  {/* Header dengan jumlah pekerja */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Data Pekerja</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full\">\n                        Total: {submission.worker_count || \n                          (submission.worker_names ? submission.worker_names.split('\\n').filter(name => name.trim()).length : submission.worker_list.length)\n                        } pekerja\n                      </span>\n                      {/* <span className=\"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full\">\n                        Foto: {submission.worker_list.length}\n                      </span> */}\n                    </div>\n                  </div>\n\n                  {submission.worker_list.length === 0 ? (\n                    <div className=\"text-center py-16\">\n                      <UserGroupIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada foto pekerja</h3>\n                      <p className=\"text-gray-500 max-w-md mx-auto\">\n                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                      {submission.worker_list.map((worker) => (\n                        <div\n                          key={worker.id}\n                          className=\"bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group\"\n                        >\n                          {/* Photo Section */}\n                          <div className=\"relative p-4 pb-2\">\n                            <div className=\"relative\">\n                              {worker.worker_photo ? (\n                                <img\n                                  src={worker.worker_photo ? fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`) : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo='}\n                                  alt={`Foto ${worker.worker_name}`}\n                                  className=\"w-full h-48 rounded-lg object-cover shadow-sm\"\n                                  onLoad={() => console.log('Approver tab - Image loaded successfully for:', worker.worker_name)}\n                                  onError={(e) => {\n                                    console.log('Approver tab - Image load error for worker:', worker.worker_name, 'URL:', worker.worker_photo);\n                                    if (worker.worker_photo) {\n                                      console.log('Approver tab - Processed URL:', fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`));\n                                    }\n                                    const target = e.target as HTMLImageElement;\n                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';\n                                  }}\n                                />\n                              ) : (\n                                <div className=\"w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm\">\n                                  <div className=\"text-center text-gray-500\">\n                                    <svg className=\"w-12 h-12 mx-auto mb-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                      <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\n                                    </svg>\n                                    <p className=\"text-sm\">Tidak ada foto</p>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Info Section */}\n                          <div className=\"px-4 pb-4\">\n                            <h4 className=\"font-semibold text-gray-900 text-sm mb-1 truncate\">\n                              {worker.worker_name}\n                            </h4>\n                            \n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Approval Tab */}\n              {activeTab === 'approval' && (\n                <div className=\"space-y-6\">\n                  <h3 className=\"text-lg font-medium text-gray-900\">Proses Approval Final</h3>\n                  {/* Review Information */}\n                  {submission.review_note && (\n                    <div className=\"bg-blue-50 rounded-lg p-6\">\n                      <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Catatan Review</h4>\n                      <p className=\"text-gray-700 whitespace-pre-line\">{submission.review_note}</p>\n                      {submission.reviewed_by_name && (\n                        <p className=\"text-sm text-gray-500 mt-2\">\n                          Direview oleh: {submission.reviewed_by_name}\n                          {submission.reviewed_at && (\n                            <span> pada {new Date(submission.reviewed_at).toLocaleDateString('id-ID')}</span>\n                          )}\n                        </p>\n                      )}\n                    </div>\n                  )}\n\n                  {submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className={`\n                      rounded-xl p-6 mb-6 border-2\n                      ${submission.final_status === 'APPROVED' \n                        ? 'bg-green-50 border-green-200' \n                        : 'bg-red-50 border-red-200'\n                      }\n                    `}>\n                      <div className=\"flex items-start space-x-4\">\n                        <div className={`\n                          flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center\n                          ${submission.final_status === 'APPROVED' \n                            ? 'bg-green-100' \n                            : 'bg-red-100'\n                          }\n                        `}>\n                          {submission.final_status === 'APPROVED' ? (\n                            <CheckCircleIcon className=\"h-6 w-6 text-green-600\" />\n                          ) : (\n                            <XCircleIcon className=\"h-6 w-6 text-red-600\" />\n                          )}\n                        </div>\n                        <div className=\"flex-1\">\n                          <h4 className={`\n                            text-lg font-semibold mb-2\n                            ${submission.final_status === 'APPROVED' \n                              ? 'text-green-900' \n                              : 'text-red-900'\n                            }\n                          `}>\n                            {submission.final_status === 'APPROVED' ? 'Pengajuan Disetujui' : 'Pengajuan Ditolak'}\n                          </h4>\n                          <div className=\"space-y-2 text-sm\">\n                            <div className=\"flex items-center space-x-2\">\n                              <span className=\"font-medium text-gray-700\">Status:</span>\n                              {getStatusBadge(submission.final_status)}\n                            </div>\n                            {submission.final_note && (\n                              <div>\n                                <span className=\"font-medium text-gray-700\">Catatan:</span>\n                                <p className=\"mt-1 text-gray-600\">{submission.final_note}</p>\n                              </div>\n                            )}\n                            {submission.approved_by_name && (\n                              <div className=\"pt-2 border-t border-gray-200\">\n                                <span className=\"font-medium text-gray-700\">Diproses oleh:</span>\n                                <p className=\"text-gray-600\">\n                                  {submission.approved_by_name} pada{' '}\n                                  {new Date(submission.approved_at!).toLocaleDateString('id-ID', {\n                                    weekday: 'long',\n                                    year: 'numeric',\n                                    month: 'long',\n                                    day: 'numeric'\n                                  })}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {canApprove && (\n                    <div className=\"space-y-8\">\n                      {/* Status Selection Card */}\n                      <div className=\"bg-gray-50 rounded-xl p-6 border border-gray-200\">\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                          <ClipboardDocumentCheckIcon className=\"h-5 w-5 text-blue-600 mr-2\" />\n                          Keputusan Persetujuan\n                        </h3>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          {/* Approve Option */}\n                          <label className={`\n                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                            ${approvalData.final_status === 'APPROVED' \n                              ? 'border-green-500 bg-green-50 shadow-md' \n                              : 'border-gray-200 bg-white hover:border-green-300 hover:bg-green-50'\n                            }\n                          `}>\n                            <input\n                              type=\"radio\"\n                              name=\"final_status\"\n                              value=\"APPROVED\"\n                              checked={approvalData.final_status === 'APPROVED'}\n                              onChange={(e) => {\n                                handleStatusChange(e.target.value as 'APPROVED');\n                              }}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                ${approvalData.final_status === 'APPROVED' \n                                  ? 'border-green-500 bg-green-500' \n                                  : 'border-gray-300'\n                                }\n                              `}>\n                                {approvalData.final_status === 'APPROVED' && (\n                                  <CheckCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Setujui Pengajuan</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan akan disetujui dan nomor SIMLOK dibuat</div>\n                              </div>\n                            </div>\n                          </label>\n\n                          {/* Reject Option */}\n                          <label className={`\n                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                            ${approvalData.final_status === 'REJECTED' \n                              ? 'border-red-500 bg-red-50 shadow-md' \n                              : 'border-gray-200 bg-white hover:border-red-300 hover:bg-red-50'\n                            }\n                          `}>\n                            <input\n                              type=\"radio\"\n                              name=\"final_status\"\n                              value=\"REJECTED\"\n                              checked={approvalData.final_status === 'REJECTED'}\n                              onChange={(e) => {\n                                handleStatusChange(e.target.value as 'REJECTED');\n                              }}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                ${approvalData.final_status === 'REJECTED' \n                                  ? 'border-red-500 bg-red-500' \n                                  : 'border-gray-300'\n                                }\n                              `}>\n                                {approvalData.final_status === 'REJECTED' && (\n                                  <XCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Tolak Pengajuan</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan akan ditolak dengan alasan</div>\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n                      </div>\n\n                      {approvalData.final_status === 'APPROVED' && (\n                        <div className=\"bg-white border border-gray-200 rounded-xl p-6\">\n                          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-blue-600 mr-2\" />\n                            Informasi SIMLOK\n                          </h3>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nomor SIMLOK\n                                <span className=\"text-red-500 ml-1\">*</span>\n                              </label>\n                              <div className=\"relative\">\n                                <input\n                                  type=\"text\"\n                                  value={approvalData.simlok_number}\n                                  onChange={(e) => setApprovalData({ ...approvalData, simlok_number: e.target.value })}\n                                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm\"\n                                  placeholder=\"Dibuat otomatis\"\n                                  required\n                                />\n                                <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                                  <CheckCircleIcon className=\"h-5 w-5 text-blue-500\" />\n                                </div>\n                              </div>\n                              <p className=\"text-xs text-gray-600 mt-2 flex items-center\">\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></span>\n                                Nomor otomatis dibuat berdasarkan urutan bulanan\n                              </p>\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Tanggal Penerbitan Simlok\n                              </label>\n                              <DatePicker\n                                value={approvalData.simlok_date}\n                                onChange={(value) => setApprovalData({ ...approvalData, simlok_date: value })}\n                                placeholder=\"Pilih tanggal penerbitan SIMLOK\"\n                                className=\"w-full px-4 py-3 bg-white shadow-sm\"\n                              />\n                              <p className=\"text-xs text-gray-600 mt-2 flex items-center\">\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></span>\n                                Tanggal dapat disesuaikan sesuai kebutuhan\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n\n\n\n                      {/* Submit Button */}\n                      <div className=\"flex justify-end pt-4 border-t border-gray-200\">\n                        <Button\n                          onClick={handleSubmitApproval}\n                          disabled={\n                            !approvalData.final_status || \n                            (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) ||\n                            saving\n                          }\n                          className={`\n                            px-8 py-3 rounded-lg font-medium transition-all duration-200 min-w-[160px]\n                            ${approvalData.final_status === 'APPROVED'\n                              ? 'bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl'\n                              : approvalData.final_status === 'REJECTED'\n                              ? 'bg-red-600 hover:bg-red-700 text-white shadow-lg hover:shadow-xl'\n                              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                            }\n                          `}\n                        >\n                          {saving ? (\n                            <div className=\"flex items-center\">\n                              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                              Memproses\n                            </div>\n                          ) : (\n                            <div className=\"flex items-center\">\n                              {approvalData.final_status === 'APPROVED' ? (\n                                <>\n                                  <CheckCircleIcon className=\"h-5 w-5 mr-2\" />\n                                  Setujui Pengajuan\n                                </>\n                              ) : approvalData.final_status === 'REJECTED' ? (\n                                <>\n                                  <XCircleIcon className=\"h-5 w-5 mr-2\" />\n                                  Tolak Pengajuan\n                                </>\n                              ) : (\n                                'Pilih Status'\n                              )}\n                            </div>\n                          )}\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n\n                  {!canApprove && submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-6\">\n                      <div className=\"text-center\">\n                        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4\">\n                          <ClipboardDocumentCheckIcon className=\"h-6 w-6 text-blue-600\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-blue-900 mb-2\">Pengajuan Sudah Difinalisasi</h3>\n                        <p className=\"text-sm text-blue-700\">\n                          Status persetujuan tidak dapat diubah karena pengajuan telah selesai diproses.\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200 flex-shrink-0 bg-white\">\n          <div className=\"flex items-center space-x-3\">\n            {/* Debug info untuk development */}\n            {/* {submission && (\n              <div className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">\n                Status: {submission.final_status} | SIMLOK: {submission.simlok_number || 'Belum ada'}\n              </div>\n            )} */}\n            \n            {/* Tampilkan tombol PDF - approver bisa lihat di semua status */}\n            {submission && (\n              <Button onClick={handleViewPdf} variant=\"primary\" size=\"sm\">\n                <DocumentTextIcon className=\"w-4 h-4 mr-2\" />\n                Lihat PDF\n              </Button>\n            )}\n          </div>\n          <Button onClick={onClose} variant=\"outline\">\n            Tutup\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submissionId}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={previewModal.isOpen}\n        onClose={handleClosePreview}\n        fileUrl={previewModal.fileUrl}\n        fileName={previewModal.fileName}\n      />\n    </div>\n  );\n};\n\nexport default ApproverSubmissionDetailModal;"
            },
            {
              "type": "file",
              "name": "ApproverSubmissionsManagement.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  EyeIcon,\n  XMarkIcon,\n  ClipboardDocumentListIcon,\n  CheckCircleIcon,\n  UserGroupIcon,\n  DocumentCheckIcon,\n  UserIcon,\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  approved_by_final_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface SubmissionsResponse {\n  submissions: Submission[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    pages: number;\n  };\n}\n\n// Empty State Component\nfunction EmptyState({ hasFilters, onClearFilters }: { hasFilters: boolean; onClearFilters: () => void }) {\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n      <div className=\"px-6 py-12 text-center\">\n        <div className=\"mx-auto h-24 w-24 text-gray-300 mb-6\">\n          <DocumentCheckIcon className=\"h-full w-full\" />\n        </div>\n        \n        {hasFilters ? (\n          <>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n              Tidak ada data yang sesuai dengan filter\n            </h3>\n            <p className=\"text-gray-500 mb-6 max-w-md mx-auto\">\n              Tidak ditemukan pengajuan yang sesuai dengan kriteria pencarian atau filter yang Anda terapkan.\n            </p>\n            <Button\n              onClick={onClearFilters}\n              variant=\"outline\"\n              className=\"mx-auto\"\n            >\n              <XMarkIcon className=\"h-4 w-4 mr-2\" />\n              Hapus Filter\n            </Button>\n          </>\n        ) : (\n          <>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n              Belum ada pengajuan untuk disetujui\n            </h3>\n            <p className=\"text-gray-500 mb-6 max-w-md mx-auto\">\n              Saat ini belum ada pengajuan Simlok yang telah direview dan memerlukan persetujuan final dari Anda.\n            </p>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto\">\n              <div className=\"bg-blue-50 p-4 rounded-lg text-center\">\n                <ClipboardDocumentListIcon className=\"h-8 w-8 text-blue-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-blue-900\">Vendor Submit</p>\n                <p className=\"text-xs text-blue-600\">Pengajuan masuk</p>\n              </div>\n              <div className=\"bg-yellow-50 p-4 rounded-lg text-center\">\n                <UserGroupIcon className=\"h-8 w-8 text-yellow-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-yellow-900\">Reviewer Check</p>\n                <p className=\"text-xs text-yellow-600\">Proses review</p>\n              </div>\n              <div className=\"bg-green-50 p-4 rounded-lg text-center\">\n                <CheckCircleIcon className=\"h-8 w-8 text-green-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-green-900\">Approver Final</p>\n                <p className=\"text-xs text-green-600\">Menunggu Anda</p>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Loading State Component  \nfunction LoadingState() {\n  return (\n    <div className=\"space-y-6\">\n      {/* Loading Filters */}\n      <div className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"flex-1 h-10 bg-gray-200 rounded\"></div>\n          <div className=\"sm:w-48 h-10 bg-gray-200 rounded\"></div>\n        </div>\n      </div>\n      \n      {/* Loading Table */}\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"p-6\">\n          <div className=\"space-y-4\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"flex items-center space-x-4\">\n                <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-32\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-48\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                <div className=\"h-8 bg-gray-200 rounded w-16\"></div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function ApproverSubmissionsManagement() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  \n  // Filters and pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');\n  const [finalStatusFilter, setFinalStatusFilter] = useState<string>('');\n  const [sortBy, setSortBy] = useState('reviewed_at');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    pages: 0,\n  });\n\n  // Socket connection\n  const socket = useSocket();\n\n  const fetchSubmissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: '10',\n        sortBy,\n        sortOrder,\n      });\n\n      if (searchTerm) params.append('search', searchTerm);\n      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);\n      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);\n\n      const response = await fetch(`/api/approver/simloks?${params}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data pengajuan');\n      }\n\n      const data: SubmissionsResponse = await response.json();\n      setSubmissions(data.submissions);\n      setPagination(data.pagination);\n    } catch (err) {\n      console.error('Error fetching submissions:', err);\n      setError('Gagal memuat data pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [fetchSubmissions]);\n\n  // Socket listeners for real-time updates\n  useEffect(() => {\n    if (!socket) return;\n\n    // Join approver room\n    socket.emit('join', { role: 'APPROVER' });\n\n    const handleSubmissionUpdate = () => {\n      console.log('Submission update received, refreshing approver submissions');\n      fetchSubmissions();\n    };\n\n    socket.on('submission:reviewed', handleSubmissionUpdate);\n    socket.on('submission:approved', handleSubmissionUpdate);\n    socket.on('submission:rejected', handleSubmissionUpdate);\n\n    return () => {\n      socket.off('submission:reviewed', handleSubmissionUpdate);\n      socket.off('submission:approved', handleSubmissionUpdate);\n      socket.off('submission:rejected', handleSubmissionUpdate);\n    };\n  }, [socket, fetchSubmissions]);\n\n  const handleSort = (field: string) => {\n    if (sortBy === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortBy(field);\n      setSortOrder('desc');\n    }\n    setCurrentPage(1);\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortBy !== field) return <ChevronUpDownIcon className=\"h-4 w-4\" />;\n    return sortOrder === 'asc' \n      ? <ChevronUpIcon className=\"h-4 w-4\" />\n      : <ChevronDownIcon className=\"h-4 w-4\" />;\n  };\n\n  const getReviewStatusBadge = (status: string) => {\n    switch (status) {\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const getFinalStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const handleViewDetails = (submission: Submission) => {\n    setSelectedSubmission(submission);\n    setShowDetailModal(true);\n  };\n\n  const clearFilters = () => {\n    setSearchTerm('');\n    setReviewStatusFilter('');\n    setFinalStatusFilter('');\n    setCurrentPage(1);\n  };\n\n  const handleCloseModal = () => {\n    setShowDetailModal(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleApprovalSubmitted = () => {\n    fetchSubmissions(); // Refresh data after approval\n  };\n\n  const hasFilters = searchTerm || reviewStatusFilter || finalStatusFilter;\n\n  if (loading && submissions.length === 0) {\n    return <LoadingState />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header and Filters - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <div>\n            <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Persetujuan Pengajuan</h1>\n            <p className=\"text-sm text-gray-500 mt-1\">Kelola dan setujui pengajuan SIMLOK</p>\n          </div>\n        </div>\n\n        {/* Toolbar - Search and Filters */}\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n          <div className=\"relative w-full md:w-80\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              placeholder=\"Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas...\"\n              value={searchTerm}\n              onChange={(e) => {\n                setSearchTerm(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n            />\n          </div>\n          <div className=\"flex gap-2 md:w-auto\">\n            <select\n              value={reviewStatusFilter}\n              onChange={(e) => {\n                setReviewStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Review</option>\n              <option value=\"MEETS_REQUIREMENTS\">Memenuhi Syarat</option>\n              <option value=\"NOT_MEETS_REQUIREMENTS\">Tidak Memenuhi Syarat</option>\n            </select>\n            <select\n              value={finalStatusFilter}\n              onChange={(e) => {\n                setFinalStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Akhir</option>\n              <option value=\"PENDING_APPROVAL\">Menunggu Persetujuan</option>\n              <option value=\"APPROVED\">Disetujui</option>\n              <option value=\"REJECTED\">Ditolak</option>\n            </select>\n            {hasFilters && (\n              <Button\n                onClick={clearFilters}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-gray-600 border-gray-300 hover:bg-gray-50\"\n              >\n                <XMarkIcon className=\"h-4 w-4 mr-1\" />\n                Reset\n              </Button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Show empty state if no submissions */}\n      {!loading && submissions.length === 0 ? (\n        <EmptyState hasFilters={hasFilters ? true : false} onClearFilters={clearFilters} />\n      ) : (\n        <div>\n          {/* Submissions Table - Unified Design */}\n          <div className=\"bg-white rounded-xl border shadow-sm overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th \n                  className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors\"\n                  onClick={() => handleSort('reviewed_at')}\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tanggal Review</span>\n                    {getSortIcon('reviewed_at')}\n                  </div>\n                </th>\n                <th \n                  className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors\"\n                  onClick={() => handleSort('vendor_name')}\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Vendor & PJ</span>\n                    {getSortIcon('vendor_name')}\n                  </div>\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Pekerjaan & Lokasi\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status Review\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status Final\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Reviewer\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {submissions.map((submission) => (\n                <tr key={submission.id} className=\"hover:bg-gray-50 transition-colors\">\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {submission.reviewed_at \n                        ? new Date(submission.reviewed_at).toLocaleDateString('id-ID', {\n                            day: '2-digit',\n                            month: 'short',\n                            year: 'numeric'\n                          })\n                        : '-'\n                      }\n                    </div>\n                    {submission.reviewed_at && (\n                      <div className=\"text-xs text-gray-500\">\n                        {new Date(submission.reviewed_at).toLocaleTimeString('id-ID', {\n                          hour: '2-digit',\n                          minute: '2-digit'\n                        })}\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"max-w-44\">\n                      <div className=\"text-sm font-medium text-gray-900 truncate\" title={submission.vendor_name}>\n                        {submission.vendor_name}\n                      </div>\n                      <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-1\">\n                        <UserIcon className=\"h-3 w-3 flex-shrink-0\" />\n                        <span className=\"truncate\" title={submission.officer_name}>{submission.officer_name}</span>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"max-w-52\">\n                      <div className=\"text-sm font-medium text-gray-900 truncate\" title={submission.job_description}>\n                        {submission.job_description}\n                      </div>\n                      <div className=\"text-xs text-gray-500 mt-1 truncate\" title={submission.work_location}>\n                         {submission.work_location}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    {getReviewStatusBadge(submission.review_status)}\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    {getFinalStatusBadge(submission.final_status)}\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900 max-w-28\">\n                      <span className=\"truncate block\" title={submission.reviewed_by_user?.officer_name || '-'}>\n                        {submission.reviewed_by_user?.officer_name || '-'}\n                      </span>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium\">\n                    <Button\n                      onClick={() => handleViewDetails(submission)}\n                      size=\"sm\"\n                      variant={submission.final_status === 'PENDING_APPROVAL' ? 'primary' : 'outline'}\n                      className=\"inline-flex items-center\"\n                    >\n                      <EyeIcon className=\"h-4 w-4 mr-1\" />\n                      {submission.final_status === 'PENDING_APPROVAL' ? 'Setujui' : 'Lihat'}\n                    </Button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>        {/* Enhanced Pagination */}\n        {pagination.pages > 1 && (\n          <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200\">\n            <div className=\"flex-1 flex justify-between sm:hidden\">\n              <Button\n                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                disabled={currentPage === 1}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                Sebelumnya\n              </Button>\n              <Button\n                onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                disabled={currentPage === pagination.pages}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                Selanjutnya\n              </Button>\n            </div>\n            <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-700\">\n                  Menampilkan{' '}\n                  <span className=\"font-medium\">\n                    {(currentPage - 1) * pagination.limit + 1}\n                  </span>{' '}\n                  sampai{' '}\n                  <span className=\"font-medium\">\n                    {Math.min(currentPage * pagination.limit, pagination.total)}\n                  </span>{' '}\n                  dari{' '}\n                  <span className=\"font-medium\">{pagination.total}</span> pengajuan\n                </p>\n              </div>\n              <div>\n                <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\n                  <Button\n                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                    disabled={currentPage === 1}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-r-none\"\n                  >\n                    Sebelumnya\n                  </Button>\n                  \n                  {Array.from({ length: Math.min(5, pagination.pages) }, (_, i) => {\n                    const pageNum = i + 1;\n                    return (\n                      <Button\n                        key={pageNum}\n                        onClick={() => setCurrentPage(pageNum)}\n                        variant={currentPage === pageNum ? \"primary\" : \"outline\"}\n                        size=\"sm\"\n                        className=\"rounded-none\"\n                      >\n                        {pageNum}\n                      </Button>\n                    );\n                  })}\n                  \n                  <Button\n                    onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                    disabled={currentPage === pagination.pages}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-l-none\"\n                  >\n                    Selanjutnya\n                  </Button>\n                </nav>\n              </div>\n            </div>\n          </div>\n        )}\n        </div>\n        </div>\n      )}\n\n      {/* New Detail Modal */}\n      <ApproverSubmissionDetailModal\n        isOpen={showDetailModal}\n        onClose={handleCloseModal}\n        submissionId={selectedSubmission?.id || ''}\n        onApprovalSubmitted={handleApprovalSubmitted}\n      />\n    </div>\n  );\n}"
            }
          ]
        },
        {
          "type": "directory",
          "name": "auth",
          "children": [
            {
              "type": "file",
              "name": "AuthRedirect.tsx",
              "content": "\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function AuthRedirect({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === \"loading\") return; // tunggu dulu\n\n    if (session?.user?.role && session.accessToken) {\n      switch (session.user.role ) {\n        case \"VENDOR\":\n          router.replace(\"/vendor\");\n          break;\n        case \"VERIFIER\":\n          router.replace(\"/verifier\");\n          break;\n        default:\n          router.replace(\"/\"); // fallback\n      }\n    }\n  }, [session, status, router]);\n\n  if (status === \"loading\") {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  // hanya render children kalau memang BELUM login\n  return <>{!session ? children : null}</>;\n}"
            },
            {
              "type": "file",
              "name": "SignInForm.tsx",
              "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport type { FC } from \"react\";\nimport { EyeIcon, EyeSlashIcon } from \"@heroicons/react/24/outline\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\n\nimport Input from \"@/components/form/Input\";\nimport Label from \"@/components/form/Label\";\nimport Button from \"@/components/ui/button/Button\";\n\ninterface Props {\n  email: string;\n  password: string;\n  showPassword: boolean;\n  error: string;\n  setEmail: (v: string) => void;\n  setPassword: (v: string) => void;\n  setShow: (v: boolean) => void;\n  handleSubmit: (e: React.FormEvent) => void;\n}\n\n/**\n * Catatan:\n * - Untuk field password, gunakan <input> native agar tidak double ikon mata.\n *   (Beberapa komponen Input kustom punya toggle bawaan. Dengan native input, kita kontrol penuh.)\n */\nconst SignInForm: FC<Props> = ({\n  email,\n  password,\n  showPassword,\n  error,\n  setEmail,\n  setPassword,\n  setShow,\n  handleSubmit,\n}) => {\n  const [pwdFocused, setPwdFocused] = useState(false);\n\n  return (\n    <div className=\"min-h-screen flex\">\n      {/* Left Section - Welcome & Branding */}\n      <div className=\"hidden lg:flex lg:w-1/2 bg-blue-600 relative\">\n        <div className=\"flex flex-col justify-center items-center w-full text-white\">\n          <div className=\"text-center w-full\" style={{ marginTop: \"-10rem\" }}>\n            <div className=\"mb-15 flex w-full bg-white p-5 justify-center\">\n              <Image\n                src=\"/assets/logo.svg\"\n                alt=\"Logo SIMLOK\"\n                width={200}\n                height={90}\n                className=\"object-contain drop-shadow-lg\"\n                priority\n              />\n            </div>\n\n            <h1 className=\"text-6xl font-bold mb-6 tracking-wide text-white\">\n              SIMLOK\n            </h1>\n            <p className=\"text-xl text-white font-light tracking-wide leading-relaxed\">\n              Sistem Informasi Manajemen Lokasi Kerja Pertamina\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Right Section - Login Form */}\n      <div className=\"w-full lg:w-1/2 flex flex-col justify-center p-6 lg:p-12 bg-white min-h-screen\">\n        <div className=\"w-full max-w-md mx-auto\">\n          {/* Mobile Logo */}\n          <div className=\"lg:hidden flex justify-center mb-8\">\n            <Image\n              src=\"/assets/logo.svg\"\n              alt=\"Logo SIMLOK\"\n              width={300}\n              height={300}\n              className=\"object-contain\"\n              priority\n            />\n          </div>\n\n          <div className=\"w-full\">\n            <div className=\"mb-8\">\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Masuk ke SIMLOK\n              </h1>\n              <p className=\"text-gray-600\">Masukkan email dan password Anda</p>\n            </div>\n\n            {error && (\n              <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-800\">{error}</p>\n              </div>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {/* Email */}\n              <div>\n                <Label className=\"text-gray-700 font-medium text-sm\" htmlFor=\"email\">\n                  Email <span className=\"text-red-500\">*</span>\n                </Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"masukkan@email.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  autoComplete=\"username\"\n                  className=\"mt-2 h-12 px-4 text-base border-gray-300 focus:border-blue-500 focus:ring-blue-500 rounded-lg\"\n                />\n              </div>\n\n              {/* Password — gunakan native input untuk hindari double eye icon */}\n              <div>\n                <Label className=\"text-gray-700 font-medium text-sm\" htmlFor=\"password\">\n                  Password <span className=\"text-red-500\">*</span>\n                </Label>\n                <div className={`relative mt-2 ${pwdFocused ? \"ring-1 ring-blue-500 rounded-lg\" : \"\"}`}>\n                  <input\n                    id=\"password\"\n                    name=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"Masukkan password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    onFocus={() => setPwdFocused(true)}\n                    onBlur={() => setPwdFocused(false)}\n                    required\n                    autoComplete=\"current-password\"\n                    className=\"block w-full h-12 px-4 pr-12 text-base rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShow(!showPassword)}\n                    aria-label={showPassword ? \"Sembunyikan password\" : \"Tampilkan password\"}\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                  >\n                    {showPassword ? (\n                      <EyeSlashIcon className=\"w-5 h-5\" />\n                    ) : (\n                      <EyeIcon className=\"w-5 h-5\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              <Button\n                className=\"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg\"\n                type=\"submit\"\n              >\n                Masuk\n              </Button>\n            </form>\n\n            <div className=\"mt-6 pt-6 border-t border-gray-200\">\n              <p className=\"text-center text-gray-600 text-sm\">\n                Belum memiliki akun?{\" \"}\n                <Link href=\"/signup\" className=\"text-blue-600 hover:text-blue-800 font-medium\">\n                  Daftar sebagai Vendor\n                </Link>\n              </p>\n            </div>\n          </div>\n\n          {/* Footer (opsional) */}\n          {/* <div className=\"mt-8 text-center text-xs text-gray-500\">\n            <p>© 2025 Pertamina. Seluruh hak cipta dilindungi.</p>\n          </div> */}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SignInForm;\n"
            },
            {
              "type": "file",
              "name": "SignUpForm.tsx",
              "content": "\"use client\";\n\nimport Checkbox from \"@/components/form/Checkbox\";\nimport Label from \"@/components/form/Label\";\nimport Button from \"@/components/ui/button/Button\";\nimport Input from \"@/components/form/Input\";\nimport { EyeIcon, EyeSlashIcon } from \"@heroicons/react/24/outline\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport type { FC } from \"react\";\n\ninterface Props {\n  email: string;\n  password: string;\n  confirmPassword: string;\n  nama_petugas: string;\n  nama_vendor: string;\n  alamat: string;\n  no_telp: string;\n  showPassword: boolean;\n  showConfirmPassword: boolean;\n  agreeToTerms: boolean;\n  error: string;\n  isLoading: boolean;\n  setEmail: (v: string) => void;\n  setPassword: (v: string) => void;\n  setConfirmPassword: (v: string) => void;\n  setNamaPetugas: (v: string) => void;\n  setNamaVendor: (v: string) => void;\n  setAlamat: (v: string) => void;\n  setNoTelp: (v: string) => void;\n  setShowPassword: (v: boolean) => void;\n  setShowConfirmPassword: (v: boolean) => void;\n  setAgree: (v: boolean) => void;\n  handleSubmit: (e: React.FormEvent) => void;\n}\n\nconst SignUpForm: FC<Props> = ({\n  email,\n  password,\n  confirmPassword,\n  nama_petugas,\n  nama_vendor,\n  alamat,\n  no_telp,\n  showPassword,\n  showConfirmPassword,\n  agreeToTerms,\n  error,\n  isLoading,\n  setEmail,\n  setPassword,\n  setConfirmPassword,\n  setNamaPetugas,\n  setNamaVendor,\n  setAlamat,\n  setNoTelp,\n  setShowPassword,\n  setShowConfirmPassword,\n  setAgree,\n  handleSubmit,\n}) => (\n  <div className=\"min-h-screen flex\">\n    {/* Left Section - Welcome & Branding */}\n    <div className=\"hidden lg:flex lg:w-1/2 bg-blue-600 relative\">\n      <div className=\"flex flex-col justify-center items-center w-full text-white\">\n         <div className=\"text-center w-full\" style={{ marginTop: '-10rem' }}>\n          <div className=\"mb-15 flex w-full bg-white p-5 justify-center\">\n            <Image\n              src=\"/assets/logo.svg\"\n              alt=\"Logo SIMLOK\"\n              width={200}\n              height={90}\n              className=\"object-contain drop-shadow-lg\"\n            />\n          </div>\n          \n          {/* SIMLOK Title */}\n          <h1 className=\"text-6xl font-bold mb-6 tracking-wide text-white\">\n            SIMLOK\n          </h1>\n          <p className=\"text-xl text-white font-light tracking-wide leading-relaxed\">\n            Sistem Informasi Manajemen Lokasi Kerja Pertamina\n          </p>\n        </div>\n      </div>\n    </div>\n\n    {/* Right Section - Sign Up Form */}\n    <div className=\"w-full lg:w-1/2 flex flex-col bg-white h-screen overflow-y-auto\">\n      <div className=\"flex-1 flex flex-col justify-center p-4 lg:p-6\">\n        <div className=\"w-full max-w-lg mx-auto\">\n          <div className=\"lg:hidden flex justify-center mb-6\">\n            <Image\n              src=\"/assets/logo.svg\"\n              alt=\"Logo SIMLOK\"\n              width={200}\n              height={90}\n              className=\"object-contain\"\n            />\n          </div>\n\n          <div className=\"w-full\">\n            <div className=\"mb-4\">\n              <h1 className=\"text-lg font-bold text-gray-900 mb-1\">Daftar Akun Vendor</h1>\n              <p className=\"text-gray-600 text-xs\">\n                Lengkapi formulir untuk mendaftar sebagai vendor SIMLOK\n              </p>\n            </div>\n\n            {error && (\n              <div className=\"mb-3 p-2 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-xs text-red-800\">{error}</p>\n              </div>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-3\">\n              <div className=\"space-y-3\">\n                <h3 className=\"text-sm font-semibold text-gray-900\">Informasi Petugas</h3>\n\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      Nama Petugas <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"nama_petugas\"\n                      name=\"nama_petugas\"\n                      type=\"text\"\n                      value={nama_petugas}\n                      onChange={(e) => setNamaPetugas(e.target.value)}\n                      placeholder=\"Ahmad Budi\"\n                      required\n                      disabled={isLoading}\n                      className=\"mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      Email <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"email\"\n                      name=\"email\"\n                      type=\"email\"\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      placeholder=\"email@perusahaan.com\"\n                      required\n                      disabled={isLoading}\n                      className=\"mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      No. Telepon <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"no_telp\"\n                      name=\"no_telp\"\n                      type=\"tel\"\n                      value={no_telp}\n                      onChange={(e) => setNoTelp(e.target.value)}\n                      placeholder=\"08123456789\"\n                      required\n                      disabled={isLoading}\n                      className=\"mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      Nama Vendor <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <Input\n                      id=\"nama_vendor\"\n                      name=\"nama_vendor\"\n                      type=\"text\"\n                      value={nama_vendor}\n                      onChange={(e) => setNamaVendor(e.target.value)}\n                      placeholder=\"PT. Nama Perusahaan\"\n                      required\n                      disabled={isLoading}\n                      className=\"mt-1 h-11 px-4 text-sm w-full border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500\"\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <Label className=\"text-gray-700 font-medium text-xs\">\n                    Alamat Perusahaan <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <textarea\n                    value={alamat}\n                    onChange={(e) => {\n                      const value = e.target.value;\n                      // Validasi alamat: hanya huruf, angka, spasi, koma, titik, tanda hubung\n                      if (/^[a-zA-Z0-9\\s,./-]*$/.test(value)) {\n                        setAlamat(value);\n                      }\n                    }}\n                    placeholder=\"Jalan, Nomor, Kelurahan, Kecamatan, Kota\"\n                    required\n                    disabled={isLoading}\n                    rows={2}\n                    className=\"mt-1 w-full h-24 px-4 py-3 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed resize-none\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-3 pt-3 border-t border-gray-200\">\n                <h3 className=\"text-sm font-semibold text-gray-900\">Keamanan Akun</h3>\n\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      Password <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <div className=\"relative mt-1\">\n                      <input\n                        type={showPassword ? \"text\" : \"password\"}\n                        placeholder=\"Min 8 karakter\"\n                        value={password}\n                        onChange={(e) => setPassword(e.target.value)}\n                        required\n                        minLength={8}\n                        disabled={isLoading}\n                        className=\"w-full h-11 px-4 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowPassword(!showPassword)}\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                      >\n                        {showPassword ? (\n                          <EyeSlashIcon className=\"w-3 h-3\" />\n                        ) : (\n                          <EyeIcon className=\"w-3 h-3\" />\n                        )}\n                      </button>\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label className=\"text-gray-700 font-medium text-xs\">\n                      Konfirmasi <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <div className=\"relative mt-1\">\n                      <input\n                        type={showConfirmPassword ? \"text\" : \"password\"}\n                        placeholder=\"Ulangi password\"\n                        value={confirmPassword}\n                        onChange={(e) => setConfirmPassword(e.target.value)}\n                        required\n                        minLength={8}\n                        disabled={isLoading}\n                        className=\"w-full h-11 px-4 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                      >\n                        {showConfirmPassword ? (\n                          <EyeSlashIcon className=\"w-3 h-3\" />\n                        ) : (\n                          <EyeIcon className=\"w-3 h-3\" />\n                        )}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n\n                {password !== confirmPassword && confirmPassword && (\n                  <p className=\"text-xs text-red-600 mt-1\">\n                    Password tidak sama\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex items-start gap-2 pt-3\">\n                <Checkbox\n                  checked={agreeToTerms}\n                  onChange={setAgree}\n                  label=\"\"\n                  disabled={isLoading}\n                />\n                <span className=\"text-xs text-gray-700\">\n                  Saya menyetujui{\" \"}\n                  <Link href=\"/terms\" className=\"text-blue-600 hover:text-blue-800 underline\">\n                    Syarat dan Ketentuan\n                  </Link>{\" \"}\n                  serta{\" \"}\n                  <Link href=\"/privacy\" className=\"text-blue-600 hover:text-blue-800 underline\">\n                    Kebijakan Privasi\n                  </Link>{\" \"}\n                  yang berlaku. <span className=\"text-red-500\">*</span>\n                </span>\n              </div>\n\n              <Button \n                className=\"w-full h-9 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm disabled:opacity-50\" \n                type=\"submit\"\n                disabled={isLoading || !agreeToTerms || password !== confirmPassword}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center justify-center\">\n                    <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-1\"></div>\n                    Mendaftar...\n                  </div>\n                ) : (\n                  \"Daftar sebagai Vendor\"\n                )}\n              </Button>\n            </form>\n\n            <div className=\"mt-4 pt-3 border-t border-gray-200\">\n              <p className=\"text-center text-gray-600 text-xs\">\n                Sudah memiliki akun?{\" \"}\n                <Link \n                  href=\"/login\" \n                  className=\"text-blue-600 hover:text-blue-800 font-medium\"\n                >\n                  Masuk di sini\n                </Link>\n              </p>\n            </div>\n          </div>\n\n          {/* <div className=\"mt-3 text-center text-xs text-gray-500\">\n            <p>© 2025 Pertamina. Seluruh hak cipta dilindungi.</p>\n          </div> */}\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nexport default SignUpForm;\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "common",
          "children": [
            {
              "type": "file",
              "name": "ConfirmationModal.tsx",
              "content": "interface ConfirmationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n}\n\nexport default function ConfirmationModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = \"Ya\",\n  cancelText = \"Batal\"\n}: ConfirmationModalProps) {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n      <div className=\"fixed inset-0 bg-black/50\" onClick={onClose}></div>\n      <div className=\"relative z-50 w-full max-w-md p-6 bg-white rounded-lg shadow-lg\">\n        <h3 className=\"text-lg font-medium text-gray-900\">{title}</h3>\n        <p className=\"mt-2 text-sm text-gray-500\">{message}</p>\n        <div className=\"mt-4 flex justify-end space-x-3\">\n          <button\n            type=\"button\"\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\n            onClick={onClose}\n          >\n            {cancelText}\n          </button>\n          <button\n            type=\"button\"\n            className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700\"\n            onClick={() => {\n              onConfirm();\n              onClose();\n            }}\n          >\n            {confirmText}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "DetailSection.tsx",
              "content": "'use client';\n\nimport { ReactNode } from 'react';\nimport { ChevronDownIcon, ChevronRightIcon } from '@heroicons/react/24/outline';\nimport { useState } from 'react';\n\ninterface DetailSectionProps {\n  title: string;\n  children: ReactNode;\n  icon?: ReactNode;\n  defaultOpen?: boolean;\n  collapsible?: boolean;\n  badge?: ReactNode;\n  className?: string;\n}\n\nexport default function DetailSection({\n  title,\n  children,\n  icon,\n  defaultOpen = true,\n  collapsible = false,\n  badge,\n  className = ''\n}: DetailSectionProps) {\n  const [isOpen, setIsOpen] = useState(defaultOpen);\n\n  return (\n    <div className={`bg-white border border-gray-200 rounded-lg shadow-sm ${className}`}>\n      <div \n        className={`flex items-center justify-between p-4 ${\n          collapsible ? 'cursor-pointer hover:bg-gray-50' : ''\n        } border-b border-gray-100`}\n        onClick={collapsible ? () => setIsOpen(!isOpen) : undefined}\n      >\n        <div className=\"flex items-center space-x-3\">\n          {icon && <div className=\"flex-shrink-0\">{icon}</div>}\n          <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\n          {badge && <div className=\"flex-shrink-0\">{badge}</div>}\n        </div>\n        \n        {collapsible && (\n          <div className=\"flex-shrink-0\">\n            {isOpen ? (\n              <ChevronDownIcon className=\"h-5 w-5 text-gray-500\" />\n            ) : (\n              <ChevronRightIcon className=\"h-5 w-5 text-gray-500\" />\n            )}\n          </div>\n        )}\n      </div>\n      \n      {(!collapsible || isOpen) && (\n        <div className=\"p-4\">\n          {children}\n        </div>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "DocumentPreviewModal.tsx",
              "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { XMarkIcon, ArrowTopRightOnSquareIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';\nimport LoadingSpinner from '../ui/LoadingSpinner';\n\ninterface DocumentPreviewModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  fileUrl: string;\n  fileName: string;\n  fileType?: string;\n}\n\nexport default function DocumentPreviewModal({ \n  isOpen, \n  onClose, \n  fileUrl, \n  fileName, \n  fileType \n}: DocumentPreviewModalProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Handle escape key press\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  // Reset states when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setLoading(true);\n      setError(null);\n    }\n  }, [isOpen, fileUrl]);\n\n  if (!isOpen) return null;\n\n  // Determine file type from URL or provided type\n  const determineFileType = (url: string, type?: string): string => {\n    if (type) return type.toLowerCase();\n    \n    const extension = url.split('.').pop()?.toLowerCase() || '';\n    \n    if (['pdf'].includes(extension)) return 'pdf';\n    if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension)) return 'image';\n    if (['doc', 'docx'].includes(extension)) return 'document';\n    \n    return 'unknown';\n  };\n\n  const detectedFileType = determineFileType(fileUrl, fileType);\n\n  const handleDownload = () => {\n    const link = document.createElement('a');\n    link.href = fileUrl;\n    link.download = fileName;\n    link.target = '_blank';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const handleOpenInNewTab = () => {\n    window.open(fileUrl, '_blank');\n  };\n\n  const renderPreviewContent = () => {\n    if (error) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"text-red-500 text-lg mb-2\">!</div>\n            <p className=\"text-gray-600\">{error}</p>\n            <button\n              onClick={handleOpenInNewTab}\n              className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n            >\n              Buka di Tab Baru\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    switch (detectedFileType) {\n      case 'pdf':\n        return (\n          <div className=\"flex-1 relative\">\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-gray-50\">\n                <div className=\"text-center\">\n                  <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">Memuat dokumen...</p>\n                </div>\n              </div>\n            )}\n            <iframe\n              src={fileUrl}\n              className=\"w-full h-full border-0\"\n              title={fileName}\n              onLoad={() => setLoading(false)}\n              onError={() => {\n                setLoading(false);\n                setError('Gagal memuat dokumen PDF');\n              }}\n            />\n          </div>\n        );\n\n      case 'image':\n        return (\n          <div className=\"flex-1 flex items-center justify-center p-4 bg-gray-50\">\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">Memuat gambar...</p>\n                </div>\n              </div>\n            )}\n            <img\n              src={fileUrl}\n              alt={fileName}\n              className=\"max-w-full max-h-full object-contain\"\n              onLoad={() => setLoading(false)}\n              onError={() => {\n                setLoading(false);\n                setError('Gagal memuat gambar');\n              }}\n            />\n          </div>\n        );\n\n      case 'document':\n        return (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">📄</div>\n              <p className=\"text-gray-600 mb-4\">\n                Dokumen Word tidak dapat ditampilkan langsung.\n              </p>\n              <div className=\"space-x-4\">\n                <button\n                  onClick={handleDownload}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\n                >\n                  Download Dokumen\n                </button>\n                <button\n                  onClick={handleOpenInNewTab}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                >\n                  Buka di Tab Baru\n                </button>\n              </div>\n            </div>\n          </div>\n        );\n\n      default:\n        return (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">📎</div>\n              <p className=\"text-gray-600 mb-4\">\n                File ini tidak dapat ditampilkan langsung.\n              </p>\n              <div className=\"space-x-4\">\n                <button\n                  onClick={handleDownload}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\n                >\n                  Download File\n                </button>\n                <button\n                  onClick={handleOpenInNewTab}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                >\n                  Buka di Tab Baru\n                </button>\n              </div>\n            </div>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-hidden\">\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black/50 transition-opacity\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-2\">\n        <div className=\"relative bg-white rounded-lg shadow-xl w-full max-w-7xl h-[95vh] flex flex-col\">\n          \n          {/* Header - Fixed */}\n          <div className=\"bg-white flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0\">\n            <div className=\"flex items-center space-x-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 truncate max-w-md\">\n                {fileName}\n              </h3>\n              <span className=\"text-sm text-gray-500 capitalize\">\n                {detectedFileType}\n              </span>\n            </div>\n            \n            {/* Action buttons */}\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={handleDownload}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Download\"\n              >\n                <ArrowDownTrayIcon className=\"w-5 h-5\" />\n              </button>\n              \n              <button\n                onClick={handleOpenInNewTab}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Buka di Tab Baru\"\n              >\n                <ArrowTopRightOnSquareIcon className=\"w-5 h-5\" />\n              </button>\n              \n              <button\n                onClick={onClose}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Tutup\"\n              >\n                <XMarkIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content - Scrollable */}\n          <div className=\"bg-white flex-1 overflow-hidden flex flex-col\">\n            {renderPreviewContent()}\n          </div>\n\n\n        </div>\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "InfoCard.tsx",
              "content": "'use client';\n\nimport { ReactNode } from 'react';\n\ninterface InfoCardProps {\n  label: string;\n  value: string | ReactNode;\n  icon?: ReactNode;\n  copyable?: boolean;\n  className?: string;\n  valueClassName?: string;\n}\n\nexport default function InfoCard({\n  label,\n  value,\n  icon,\n  copyable = false,\n  className = '',\n  valueClassName = ''\n}: InfoCardProps) {\n  const handleCopy = async () => {\n    if (copyable && typeof value === 'string') {\n      try {\n        await navigator.clipboard.writeText(value);\n        // You could add a toast notification here\n      } catch (err) {\n        console.error('Failed to copy:', err);\n      }\n    }\n  };\n\n  return (\n    <div className={`space-y-1 ${className}`}>\n      <div className=\"flex items-center space-x-2\">\n        {icon && <div className=\"flex-shrink-0\">{icon}</div>}\n        <label className=\"text-sm font-semibold text-gray-700\">\n          {label}\n        </label>\n      </div>\n      \n      <div className={`group relative ${copyable ? 'cursor-pointer' : ''}`} onClick={copyable ? handleCopy : undefined}>\n        {typeof value === 'string' ? (\n          <p className={`text-sm font-normal text-gray-900 ${copyable ? 'hover:text-blue-600' : ''} ${valueClassName}`}>\n            {value || '-'}\n          </p>\n        ) : (\n          <div className={valueClassName}>\n            {value}\n          </div>\n        )}\n        \n        {copyable && typeof value === 'string' && value && (\n          <span className=\"absolute top-0 left-full ml-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-500\">\n            Klik untuk copy\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "RealtimeUpdates.tsx",
              "content": "import { useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\n\nlet socket: Socket | null = null;\n\n// Temporarily disable Socket.IO until server is properly configured\nconst SOCKET_ENABLED = process.env.NODE_ENV === 'development' && false; // Disabled for now\n\nexport const initSocket = () => {\n  if (!socket && SOCKET_ENABLED) {\n    socket = io(process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3000', {\n      path: '/api/socket',\n      addTrailingSlash: false,\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: 5,\n      timeout: 20000,\n      transports: ['websocket', 'polling'], // Fallback to polling if websocket fails\n    });\n  }\n  return socket;\n};\n\nexport const getSocket = () => socket;\n\nexport const useSocket = () => {\n  const socketRef = useRef<Socket | null>(null);\n\n  useEffect(() => {\n    if (!SOCKET_ENABLED) {\n      return;\n    }\n\n    if (!socketRef.current) {\n      socketRef.current = initSocket();\n    }\n\n    const currentSocket = socketRef.current;\n    if (!currentSocket) return;\n\n    const handleConnect = () => {\n      console.log('Connected to socket server');\n    };\n\n    const handleDisconnect = (reason: string) => {\n      console.log('Disconnected from socket server:', reason);\n    };\n\n    const handleError = (error: any) => {\n      console.error('Socket error:', error);\n    };\n\n    const handleConnectError = (error: any) => {\n      console.error('Socket connection error:', error);\n    };\n\n    const handleReconnect = (attemptNumber: number) => {\n      console.log('Socket reconnected after', attemptNumber, 'attempts');\n    };\n\n    const handleReconnectError = (error: any) => {\n      console.error('Socket reconnection error:', error);\n    };\n\n    currentSocket.on('connect', handleConnect);\n    currentSocket.on('disconnect', handleDisconnect);\n    currentSocket.on('error', handleError);\n    currentSocket.on('connect_error', handleConnectError);\n    currentSocket.on('reconnect', handleReconnect);\n    currentSocket.on('reconnect_error', handleReconnectError);\n\n    return () => {\n      if (!currentSocket) return;\n      currentSocket.off('connect', handleConnect);\n      currentSocket.off('disconnect', handleDisconnect);\n      currentSocket.off('error', handleError);\n      currentSocket.off('connect_error', handleConnectError);\n      currentSocket.off('reconnect', handleReconnect);\n      currentSocket.off('reconnect_error', handleReconnectError);\n    };\n  }, []);\n\n  return SOCKET_ENABLED ? socketRef.current : null;\n};\n"
            },
            {
              "type": "file",
              "name": "SimlokPdfModal.tsx",
              "content": "'use client';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { XMarkIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';\nimport LoadingSpinner from '../ui/LoadingSpinner';\n\ninterface SimlokPdfModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  submissionName: string;\n  nomorSimlok?: string;\n}\n\nexport default function SimlokPdfModal({\n  isOpen,\n  onClose,\n  submissionId,\n  submissionName,\n  nomorSimlok,\n}: SimlokPdfModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null); // <-- ubah: null, bukan \"\"\n  const objectUrlRef = useRef<string | null>(null); // untuk blob URL cleanup\n\n  // Cleanup object URL ketika modal ditutup/unmount\n  useEffect(() => {\n    return () => {\n      if (objectUrlRef.current) {\n        URL.revokeObjectURL(objectUrlRef.current);\n        objectUrlRef.current = null;\n      }\n    };\n  }, []);\n\n  // Esc key + body scroll lock\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') onClose();\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  // Siapkan URL/pdf saat modal dibuka, cleanup saat ditutup\n  useEffect(() => {\n    let cancelled = false;\n\n    async function prepare() {\n      if (!isOpen || !submissionId) {\n        // Reset state when modal is closed\n        setPdfUrl(null);\n        setError(null);\n        setLoading(true);\n        return;\n      }\n\n      setLoading(true);\n      setError(null);\n\n      // bersihkan object URL lama\n      if (objectUrlRef.current) {\n        URL.revokeObjectURL(objectUrlRef.current);\n        objectUrlRef.current = null;\n      }\n      setPdfUrl(null);\n\n      try {\n        // Pakai timestamp supaya bypass cache dan clear server cache\n        const t = Date.now();\n        const apiUrl = `/api/submissions/${encodeURIComponent(\n          submissionId\n        )}?format=pdf&t=${t}&clearCache=true`;\n\n        console.log('SimlokPdfModal: Requesting PDF from:', apiUrl);\n\n        // Kalau endpoint protected, pakai credentials: 'include'\n        // dan mode 'same-origin' (default) supaya cookie terkirim\n        const res = await fetch(apiUrl, {\n          method: 'GET',\n          credentials: 'include',\n          cache: 'no-store', // Force no caching\n        });\n\n        if (!res.ok) {\n          // Try to get error details from response\n          try {\n            const errorData = await res.json();\n            throw new Error(errorData.error || `Gagal memuat PDF (${res.status})`);\n          } catch (jsonError) {\n            throw new Error(`Gagal memuat PDF (${res.status})`);\n          }\n        }\n\n        console.log('SimlokPdfModal: PDF response received successfully');\n\n        // Gunakan blob -> object URL agar:\n        // - lebih stabil di berbagai browser\n        // - bisa di-print/download tanpa kebijakan CORS aneh\n        const blob = await res.blob();\n        const url = URL.createObjectURL(blob);\n        objectUrlRef.current = url;\n\n        console.log('SimlokPdfModal: PDF blob URL created:', url);\n\n        if (!cancelled) {\n          setPdfUrl(url);\n          setLoading(false);\n          setError(null);\n        }\n      } catch (e: any) {\n        console.error('SimlokPdfModal: Error loading PDF:', e);\n        if (!cancelled) {\n          setError(e?.message || 'Gagal memuat dokumen PDF SIMLOK.');\n          setLoading(false);\n        }\n      }\n    }\n\n    prepare();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [isOpen, submissionId]);\n\n  // Generate filename (must be before early return to avoid hook order issues)\n  const filename = useMemo(() => {\n    if (nomorSimlok) return `SIMLOK_${nomorSimlok.replace(/[/\\\\]/g, '_')}.pdf`;\n    return `SIMLOK_${submissionName.replace(/[/\\\\]/g, '_')}.pdf`;\n  }, [nomorSimlok, submissionName]);\n\n  if (!isOpen) return null;\n\n  const handleDownload = async () => {\n    try {\n      setError(null);\n\n      // Jika kita sudah punya blob URL, kita bisa fetch ulang BLOB-nya dari URL asli\n      // atau langsung pakai fetch API lagi supaya dapat file fresh.\n      // Lebih konsisten: refetch dari endpoint (agar bukan blob object sementara).\n      const t = Date.now();\n      const apiUrl = `/api/submissions/${encodeURIComponent(\n        submissionId\n      )}?format=pdf&t=${t}`;\n\n      const res = await fetch(apiUrl, {\n        method: 'GET',\n        credentials: 'include',\n      });\n      if (!res.ok) throw new Error('Gagal mendownload PDF');\n\n      const blob = await res.blob();\n      const url = URL.createObjectURL(blob);\n\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n\n      URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error(err);\n      setError('Gagal mendownload PDF SIMLOK');\n    }\n  };\n\n  // Optional: print (bisa gunakan blob URL langsung)\n  // const handlePrint = () => {\n  //   if (!pdfUrl) return;\n  //   const w = window.open(pdfUrl, '_blank');\n  //   if (w) {\n  //     w.addEventListener('load', () => w.print());\n  //   }\n  // };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-hidden\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/60 transition-opacity backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-2\">\n        <div className=\"relative bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[95vh] flex flex-col\">\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white flex items-center justify-between p-4 rounded-t-lg flex-shrink-0\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"bg-white/20 rounded-lg p-2\">\n                <svg className=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path\n                    fillRule=\"evenodd\"\n                    d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z\"\n                    clipRule=\"evenodd\"\n                  />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold\">Dokumen SIMLOK</h3>\n                <p className=\"text-sm text-blue-100\">\n                  {nomorSimlok ? `No: ${nomorSimlok}` : submissionName}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              {/* <button\n                onClick={handlePrint}\n                disabled={Boolean(loading || error || !pdfUrl)}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Print PDF\"\n              >\n                <PrinterIcon className=\"w-5 h-5\" />\n              </button> */}\n              <button\n                onClick={handleDownload}\n                disabled={Boolean(loading || error)}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Download PDF\"\n              >\n                <ArrowDownTrayIcon className=\"w-5 h-5\" />\n              </button>\n\n              <div className=\"w-px h-6 bg-white/20 mx-2\" />\n\n              <button\n                onClick={onClose}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full\"\n                title=\"Tutup\"\n              >\n                <XMarkIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 relative bg-gray-100\">\n            {/* Overlay loading */}\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-white/90 z-10\">\n                <div className=\"text-center\">\n                  <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n                  <p className=\"text-gray-700 font-medium\">Memuat dokumen SIMLOK...</p>\n                  <p className=\"text-sm text-gray-500 mt-2\">Mohon tunggu sebentar</p>\n                </div>\n              </div>\n            )}\n\n            {/* Error state */}\n            {error && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-gray-50\">\n                <div className=\"text-center p-8\">\n                  <div className=\"text-red-500 text-6xl mb-4\">!</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Gagal Memuat PDF</h3>\n                  <p className=\"text-gray-600 mb-4\">{error}</p>\n                  <div className=\"space-x-4\">\n                    <button\n                      onClick={() => {\n                        // trigger ulang effect dengan toggle isOpen sebentar\n                        setError(null);\n                        // force reload dengan ganti submissionId param waktu\n                        // (cukup biarkan effect di atas jalan otomatis saat error==null + isOpen true)\n                        const t = Date.now();\n                        const apiUrl = `/api/submissions/${encodeURIComponent(\n                          submissionId\n                        )}?format=pdf&t=${t}`;\n                        setLoading(true);\n                        fetch(apiUrl, { credentials: 'include' })\n                          .then(r => {\n                            if (!r.ok) throw new Error('Gagal memuat ulang');\n                            return r.blob();\n                          })\n                          .then(b => {\n                            if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current);\n                            const url = URL.createObjectURL(b);\n                            objectUrlRef.current = url;\n                            setPdfUrl(url);\n                            setLoading(false);\n                          })\n                          .catch(e => {\n                            setLoading(false);\n                            setError(e?.message || 'Gagal memuat ulang dokumen');\n                          });\n                      }}\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                    >\n                      Coba Lagi\n                    </button>\n                    <button\n                      onClick={onClose}\n                      className=\"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors\"\n                    >\n                      Tutup\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Hanya render iframe saat pdfUrl siap */}\n            {!error && pdfUrl && pdfUrl.trim() !== '' && (\n              <iframe\n                key={pdfUrl} // re-mount saat URL berubah\n                src={pdfUrl}\n                className=\"w-full h-full border-0\"\n                title={`SIMLOK - ${submissionName}`}\n                onLoad={() => {\n                  // sebagian browser tidak memanggil ini untuk blob URL; tidak masalah\n                  setLoading(false);\n                }}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "WorkersList.tsx",
              "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  UserIcon, \n  PhotoIcon, \n  EyeIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  XMarkIcon \n} from '@heroicons/react/24/outline';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\n\ninterface Worker {\n  id: string;\n  worker_name: string;\n  worker_photo: string | null;\n  submission_id: string;\n  created_at: string;\n}\n\ninterface WorkersListProps {\n  submissionId: string;\n  fallbackWorkers?: string;\n  layout?: 'grid' | 'list';\n  showPhotos?: boolean;\n  maxDisplayCount?: number;\n  verificationMode?: boolean;\n  className?: string;\n  // Context for different API endpoints\n  context?: 'vendor' | 'reviewer' | 'admin' | 'approver';\n}\n\nexport default function WorkersList({ \n  submissionId, \n  fallbackWorkers = '', \n  layout = 'grid',\n  showPhotos = true,\n  maxDisplayCount = 6,\n  verificationMode = false,\n  className = '',\n  context = 'vendor',\n}: WorkersListProps) {\n  const [workers, setWorkers] = useState<Worker[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [imageErrors, setImageErrors] = useState<Set<string>>(new Set());\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  useEffect(() => {\n    const fetchWorkers = async () => {\n      if (!submissionId) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        // Choose the correct API endpoint based on context\n        let apiUrl = '';\n        switch (context) {\n          case 'approver':\n            apiUrl = `/api/approver/simloks/${submissionId}/workers`;\n            break;\n          case 'reviewer':\n            apiUrl = `/api/reviewer/simloks/${submissionId}/workers`;\n            break;\n          case 'admin':\n            apiUrl = `/api/admin/simloks/${submissionId}/workers`;\n            break;\n          case 'vendor':\n          default:\n            apiUrl = `/api/submissions/${submissionId}/workers`;\n            break;\n        }\n\n        const response = await fetch(apiUrl);\n        if (!response.ok) {\n          throw new Error('Failed to fetch workers');\n        }\n        const data = await response.json();\n        setWorkers(data.workers || []);\n      } catch (err) {\n        console.error('Error fetching workers:', err);\n        setError(err instanceof Error ? err.message : 'Unknown error');\n        \n        // Fallback: parse fallback workers string\n        if (fallbackWorkers) {\n          const fallbackWorkersList = fallbackWorkers.split(',').map((name, index) => ({\n            id: `fallback-${index}`,\n            worker_name: name.trim(),\n            worker_photo: null,\n            submission_id: submissionId,\n            created_at: new Date().toISOString(),\n          }));\n          setWorkers(fallbackWorkersList);\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchWorkers();\n  }, [submissionId, fallbackWorkers, context]);\n\n  const handleImageError = (workerId: string) => {\n    setImageErrors(prev => new Set([...prev, workerId]));\n  };\n\n  const handleImageClick = (imageUrl: string) => {\n    if (imageUrl) {\n      setSelectedImage(imageUrl);\n    }\n  };\n\n  const closeModal = () => {\n    setSelectedImage(null);\n  };\n\n  if (loading) {\n    return (\n      <div className={`animate-pulse ${className}`}>\n        <div className=\"flex items-center space-x-3 mb-3\">\n          <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-16\"></div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className=\"bg-gray-50 rounded-lg p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"h-12 w-12 bg-gray-200 rounded-full\"></div>\n                <div className=\"flex-1\">\n                  <div className=\"h-4 bg-gray-200 rounded mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-3/4\"></div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (error && workers.length === 0) {\n    return (\n      <div className={`text-center py-6 ${className}`}>\n        <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n        <p className=\"text-gray-500\">Gagal memuat data pekerja</p>\n        <p className=\"text-sm text-gray-400 mt-1\">{error}</p>\n      </div>\n    );\n  }\n\n  if (workers.length === 0) {\n    return (\n      <div className={`text-center py-6 ${className}`}>\n        <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n        <p className=\"text-gray-500\">Belum ada data pekerja</p>\n      </div>\n    );\n  }\n\n  const displayedWorkers = showAll || !maxDisplayCount ? workers : workers.slice(0, maxDisplayCount);\n  const remainingCount = workers.length - (maxDisplayCount || 0);\n\n  return (\n    <div className={className}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">\n            Jumlah pekerja ({workers.length} orang)\n          </span>\n          {verificationMode && (\n            <span className=\"bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n              Mode Verifikasi\n            </span>\n          )}\n        </div>\n        \n        {maxDisplayCount && workers.length > maxDisplayCount && (\n          <button\n            onClick={() => setShowAll(!showAll)}\n            className=\"text-blue-600 hover:text-blue-700 text-sm font-medium\"\n          >\n            {showAll ? 'Tampilkan Lebih Sedikit' : `Lihat Semua (+${remainingCount})`}\n          </button>\n        )}\n      </div>\n\n      {/* Workers Display */}\n      {layout === 'grid' ? (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6\">\n          {displayedWorkers.map((worker) => (\n            <div\n              key={worker.id}\n              className={`bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border ${\n                verificationMode \n                  ? 'border-purple-200 hover:border-purple-300' \n                  : 'border-gray-100 hover:border-gray-200'\n              }`}\n            >\n              {/* Photo Section - Large and prominent */}\n              <div className=\"relative p-4 pb-2\">\n                {showPhotos && (\n                  <div className=\"relative\">\n                    {worker.worker_photo && !imageErrors.has(worker.id) ? (\n                      <img\n                        src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}\n                        alt={`Foto ${worker.worker_name}`}\n                        className=\"w-full h-48 rounded-lg object-cover cursor-pointer hover:scale-105 transition-transform duration-200 shadow-sm\"\n                        onError={() => handleImageError(worker.id)}\n                        onClick={() => handleImageClick(worker.worker_photo!)}\n                        title=\"Klik untuk memperbesar\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-48 rounded-lg bg-gray-100 flex flex-col items-center justify-center shadow-sm\">\n                        {worker.worker_photo ? (\n                          <>\n                            <PhotoIcon className=\"h-12 w-12 text-gray-400 mb-2\" />\n                            <span className=\"text-xs text-gray-500\">Gagal memuat foto</span>\n                          </>\n                        ) : (\n                          <>\n                            <UserIcon className=\"h-12 w-12 text-gray-400 mb-2\" />\n                            <span className=\"text-xs text-gray-500\">Tidak ada foto</span>\n                          </>\n                        )}\n                      </div>\n                    )}\n                    \n                    {/* Status indicator */}\n                    <div className={`absolute top-2 right-2 w-3 h-3 rounded-full border-2 border-white ${\n                      worker.worker_photo && !imageErrors.has(worker.id)\n                        ? 'bg-green-500' \n                        : 'bg-orange-500'\n                    }`}></div>\n                    \n                    {/* Verification badge */}\n                    {verificationMode && (\n                      <div className=\"absolute top-2 left-2 w-6 h-6 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center\">\n                        <EyeIcon className=\"h-3 w-3 text-white\" />\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Content Section - Name and details below photo */}\n              <div className=\"p-4 pt-2\">\n                <h2 className=\"font-semibold text-gray-900 text-base mb-1\">\n                  {worker.worker_name}\n                </h2>\n\n                {/* Verification Actions */}\n                {verificationMode && (\n                  <div className=\"flex justify-center space-x-2 pt-3 border-t border-gray-100\">\n                    <button \n                      className=\"flex items-center justify-center w-8 h-8 text-green-600 hover:bg-green-50 rounded-full transition-colors\"\n                      title=\"Verifikasi Valid\"\n                    >\n                      <CheckCircleIcon className=\"h-5 w-5\" />\n                    </button>\n                    <button \n                      className=\"flex items-center justify-center w-8 h-8 text-red-600 hover:bg-red-50 rounded-full transition-colors\"\n                      title=\"Perlu Koreksi\"\n                    >\n                      <XCircleIcon className=\"h-5 w-5\" />\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {displayedWorkers.map((worker, index) => (\n            <div\n              key={worker.id}\n              className={`flex items-center space-x-4 p-4 bg-white border rounded-xl hover:shadow-md transition-all duration-200 ${\n                verificationMode \n                  ? 'border-purple-200 hover:border-purple-300' \n                  : 'border-gray-100 hover:border-gray-200'\n              }`}\n            >\n              {/* Number */}\n              <div className=\"flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center\">\n                <span className=\"text-sm font-medium text-gray-600\">\n                  {index + 1}\n                </span>\n              </div>\n              \n              {/* Photo */}\n              {showPhotos && (\n                <div className=\"flex-shrink-0 relative\">\n                  {worker.worker_photo && !imageErrors.has(worker.id) ? (\n                    <img\n                      src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}\n                      alt={`Foto ${worker.worker_name}`}\n                      className=\"h-12 w-12 rounded-lg object-cover border-2 border-gray-200 cursor-pointer hover:border-blue-400 transition-colors shadow-sm\"\n                      onError={() => handleImageError(worker.id)}\n                      onClick={() => handleImageClick(worker.worker_photo!)}\n                      title=\"Klik untuk memperbesar\"\n                    />\n                  ) : (\n                    <div className=\"h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-gray-200\">\n                      {worker.worker_photo ? (\n                        <PhotoIcon className=\"h-6 w-6 text-gray-400\" />\n                      ) : (\n                        <UserIcon className=\"h-6 w-6 text-gray-400\" />\n                      )}\n                    </div>\n                  )}\n                  \n                  {/* Status indicator */}\n                  <div className={`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${\n                    worker.worker_photo && !imageErrors.has(worker.id)\n                      ? 'bg-green-500' \n                      : 'bg-orange-500'\n                  }`}></div>\n                  \n                  {verificationMode && (\n                    <div className=\"absolute -top-1 -left-1 w-4 h-4 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center\">\n                      <EyeIcon className=\"h-2.5 w-2.5 text-white\" />\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {/* Worker Info */}\n              <div className=\"flex-1 min-w-0\">\n                <h3 className=\"text-base font-medium text-gray-900 truncate\">\n                  {worker.worker_name}\n                </h3>\n                <p className=\"text-sm text-gray-500\">\n                  Pekerja #{index + 1}\n                </p>\n              </div>\n              \n              {/* Status Badge */}\n              <div className=\"flex-shrink-0\">\n                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                  worker.worker_photo && !imageErrors.has(worker.id)\n                    ? 'bg-green-100 text-green-800' \n                    : 'bg-orange-100 text-orange-800'\n                }`}>\n                  <div className={`w-2 h-2 rounded-full mr-1.5 ${\n                    worker.worker_photo && !imageErrors.has(worker.id)\n                      ? 'bg-green-400' \n                      : 'bg-orange-400'\n                  }`}></div>\n                  {worker.worker_photo && !imageErrors.has(worker.id) \n                    ? 'Foto Tersedia' \n                    : 'Tanpa Foto'}\n                </span>\n              </div>\n\n              {/* Verification Actions */}\n              {verificationMode && (\n                <div className=\"flex space-x-2 flex-shrink-0\">\n                  <button \n                    className=\"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors\"\n                    title=\"Verifikasi Valid\"\n                  >\n                    <CheckCircleIcon className=\"h-5 w-5\" />\n                  </button>\n                  <button \n                    className=\"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors\"\n                    title=\"Perlu Koreksi\"\n                  >\n                    <XCircleIcon className=\"h-5 w-5\" />\n                  </button>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Photo Modal for worker photos */}\n      {selectedImage && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          {/* Backdrop */}\n          <div\n            className=\"fixed inset-0 bg-black/75 transition-opacity\"\n            onClick={closeModal}\n          />\n          \n          {/* Modal */}\n          <div className=\"flex min-h-full items-center justify-center p-4\">\n            <div className=\"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden\">\n              <button\n                onClick={closeModal}\n                className=\"absolute top-2 right-2 z-10 bg-white hover:bg-gray-100 rounded-full p-2 shadow-lg transition-colors\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n              <img\n                src={selectedImage}\n                alt=\"Preview\"\n                className=\"max-w-full max-h-[90vh] object-contain\"\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "dashboard",
          "children": [
            {
              "type": "file",
              "name": "DashboardMainContent.tsx",
              "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { PlusIcon, ChartPieIcon, ClockIcon, ArrowTrendingUpIcon } from \"@heroicons/react/24/outline\";\nimport Card from \"../ui/Card\";\nimport { SectionTitle } from \"../ui/SectionTitle\";\nimport { Stat } from \"../ui/Stat\";\nimport { ActivityList } from \"../ui/ActivityList\";\nimport PageHeader from \"../layout/PageHeader\";\n\nexport default function DashboardMainContent() {\n  const { data: session } = useSession();\n  const role = session?.user.role ?? \"VENDOR\";\n\n  const stats = [\n    { label: \"Products\", value: 42, icon: ChartPieIcon },\n    { label: \"Orders\", value: 128, icon: ClockIcon },\n    { label: \"Earnings\", value: \"$3,210\", icon: ArrowTrendingUpIcon },\n    { label: \"Pending\", value: \"$450\", icon: PlusIcon },\n  ];\n\n  const activities = [\n    { id: 1, txt: \"Order #1234 confirmed\", time: \"1 m ago\" },\n    { id: 2, txt: \"Charlie left review\", time: \"1 h ago\" },\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\n      {/* Debug info - remove in production */}\n      {/* {process.env.NODE_ENV === 'development' && (\n        <div className=\"lg:col-span-3 mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n          <h3 className=\"font-semibold text-yellow-800\">Debug Session Info:</h3>\n          <pre className=\"text-sm text-yellow-700 mt-2\">\n            {JSON.stringify({\n              userId: session?.user?.id,\n              nama_petugas: session?.user?.nama_petugas,\n              nama_vendor: session?.user?.nama_vendor,\n              role: session?.user?.role,\n              email: session?.user?.email,\n              isVerified: session?.user?.verified_at ? true : false,\n            }, null, 2)}\n          </pre>\n        </div>\n      )} */}\n      \n      {/* Main column */}\n      <div className=\"space-y-6 lg:col-span-2\">\n        {/* Header */}\n        <PageHeader\n          title={`Welcome back, ${session?.user.officer_name ?? session?.user.name ?? \"User\"}!`}\n          subtitle={\n            role === \"VENDOR\" && session?.user.vendor_name \n              ? `${session.user.vendor_name} - You are logged in as ${role.toLowerCase()}.`\n              : `You are logged in as ${role.toLowerCase()}.`\n          }\n          cta={\n            <div className=\"flex gap-2\">\n              {[\"Add Product\", \"View Orders\", \"Analytics\", \"Support\"].map((a) => (\n                <button\n                  key={a}\n                  className=\"rounded-full bg-white px-4 py-2 text-sm font-medium text-slate-800 shadow-sm transition hover:bg-slate-100 \"\n                >\n                  {a}\n                </button>\n              ))}\n            </div>\n          }\n        />\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-2 gap-4 md:grid-cols-4\">\n          {stats.map((s, i) => (\n            <Stat key={i} label={s.label} value={s.value} icon={s.icon as any} />\n          ))}\n        </div>\n\n        {/* Simple placeholder for chart */}\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle right={<ChartPieIcon className=\"h-5 w-5 text-slate-500\" />}>\n            Sales Trend\n          </SectionTitle>\n          <div className=\"mt-4 h-48 bg-gray-50 rounded-lg flex items-center justify-center\">\n            <div className=\"text-center\">\n              <ChartPieIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-2\" />\n              <p className=\"text-gray-500\">Chart will be displayed here</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Sidebar column */}\n      <div className=\"space-y-6\">\n        {/* Vendor Info - only show for VENDOR role */}\n        {role === \"VENDOR\" && (\n          <Card className=\"p-6 bg-white border border-slate-200\">\n            <SectionTitle>Informasi Vendor</SectionTitle>\n            <div className=\"space-y-3 mt-4\">\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Nama Vendor</span>\n                <p className=\"text-sm text-gray-900 font-semibold\">\n                  {session?.user.vendor_name || \"Belum diisi\"}\n                </p>\n              </div>\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Nama Petugas</span>\n                <p className=\"text-sm text-gray-900\">\n                  {session?.user.officer_name || session?.user.name || \"Belum diisi\"}\n                </p>\n              </div>\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Email</span>\n                <p className=\"text-sm text-gray-900\">\n                  {session?.user.email || \"Belum diisi\"}\n                </p>\n              </div>\n            </div>\n          </Card>\n        )}\n\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle>Recent Activity</SectionTitle>\n          <ActivityList items={activities} />\n        </Card>\n\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle>Quick Stats</SectionTitle>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-slate-700\">Conversion</span>\n              <span className=\"font-bold text-slate-900\">12%</span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-slate-700\">Avg. Order</span>\n              <span className=\"font-bold text-slate-900\">$89</span>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "VendorDashboard.tsx",
              "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { \n  ClockIcon,\n  PlusIcon,\n  CheckCircleIcon,\n  XCircleIcon\n} from \"@heroicons/react/24/outline\";\nimport Card from \"../ui/Card\";\nimport { Badge } from \"../ui/Badge\";\nimport Button from \"../ui/button/Button\";\nimport Alert from \"../ui/alert/Alert\";\nimport LoadingSpinner from \"../ui/LoadingSpinner\";\nimport ConfirmModal from \"../ui/modal/ConfirmModal\";\nimport SubmissionDetailModal from \"../vendor/SubmissionDetailModal\";\nimport { useStatsStore } from \"@/store/useStatsStore\";\nimport { useSubmissionStore } from \"@/store/useSubmissionStore\";\nimport { useSocket } from \"@/components/common/RealtimeUpdates\";\n\ninterface VendorSubmission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\nexport default function VendorDashboard() {\n  const { data: session } = useSession();\n  \n  // Use Zustand stores for realtime data\n  const { \n    vendorStats,\n    loading: statsLoading,\n    fetchVendorStats \n  } = useStatsStore();\n  \n  const { \n    submissions,\n    loading: submissionsLoading,\n    fetchVendorSubmissions \n  } = useSubmissionStore();\n  \n  // Initialize Socket.IO connection\n  useSocket();\n\n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<VendorSubmission | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  // Alert state\n  const [alert, setAlert] = useState<{\n    show: boolean;\n    variant: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n  }>({\n    show: false,\n    variant: 'info',\n    title: '',\n    message: ''\n  });\n\n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    show: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n    isLoading: boolean;\n  }>({\n    show: false,\n    title: '',\n    message: '',\n    onConfirm: () => {},\n    isLoading: false\n  });\n\n  useEffect(() => {\n    // Initialize data fetching\n    if (session?.user?.id) {\n      fetchVendorStats();\n      fetchVendorSubmissions();\n    }\n  }, [session?.user?.id, fetchVendorStats, fetchVendorSubmissions]);\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING': return <Badge variant=\"warning\">Menunggu</Badge>;\n      case 'APPROVED': return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED': return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default: return <Badge>{status}</Badge>;\n    }\n  };\n\n  const handleDelete = useCallback((id: string) => {\n    setConfirmModal({\n      show: true,\n      title: 'Konfirmasi Hapus',\n      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',\n      onConfirm: () => performDelete(id),\n      isLoading: false\n    });\n  }, []);\n\n  const performDelete = async (id: string) => {\n    try {\n      setConfirmModal(prev => ({ ...prev, isLoading: true }));\n\n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal menghapus pengajuan');\n      }\n\n      // Close confirm modal\n      setConfirmModal(prev => ({ ...prev, show: false, isLoading: false }));\n\n      // Refresh data setelah berhasil menghapus\n      await fetchVendorSubmissions();\n      await fetchVendorStats();\n      \n      // Show success message\n      setAlert({\n        show: true,\n        variant: 'success',\n        title: 'Berhasil!',\n        message: 'Pengajuan berhasil dihapus'\n      });\n      \n      // Auto hide after 3 seconds\n      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 3000);\n    } catch (error) {\n      setConfirmModal(prev => ({ ...prev, isLoading: false }));\n      \n      console.error('Error deleting submission:', error);\n      setAlert({\n        show: true,\n        variant: 'error',\n        title: 'Gagal Menghapus',\n        message: error instanceof Error ? error.message : 'Gagal menghapus pengajuan'\n      });\n      \n      // Auto hide after 5 seconds\n      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 5000);\n    }\n  };\n\n  const handleViewDetail = useCallback(async (submission: VendorSubmission) => {\n    try {\n      // Fetch full submission data from API\n      const response = await fetch(`/api/submissions/${submission.id}`);\n      if (response.ok) {\n        const fullSubmissionData = await response.json();\n        setSelectedSubmission(fullSubmissionData);\n        setIsModalOpen(true);\n      } else {\n        console.error('Failed to fetch submission details');\n        setAlert({\n          show: true,\n          variant: 'error',\n          title: 'Error',\n          message: 'Gagal memuat detail pengajuan'\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching submission details:', error);\n      setAlert({\n        show: true,\n        variant: 'error',\n        title: 'Error',\n        message: 'Terjadi kesalahan saat memuat detail pengajuan'\n      });\n    }\n  }, []);\n\n  const handleCloseModal = useCallback(() => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  }, []);\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Alert Notification */}\n      {alert.show && (\n        <div className=\"fixed top-4 right-4 z-50 max-w-md\">\n          <Alert\n            variant={alert.variant}\n            title={alert.title}\n            message={alert.message}\n          />\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-semibold text-gray-900\">\n              Selamat datang di dashboard vendor, {session?.user.officer_name ?? session?.user.name ?? \"Vendor\"}\n            </h1>\n            <p className=\"text-gray-600 mt-1\">\n              {session?.user.vendor_name && `${session.user.vendor_name} - `}\n              Kelola pengajuan SIMLOK Anda\n            </p>\n          </div>\n          <div className=\"mt-4 sm:mt-0\">\n            <Link href=\"/vendor/submissions/create\">\n              <Button variant=\"primary\" size=\"md\">\n                <PlusIcon className=\"w-5 h-5 mr-2\" />\n                Buat pengajuan\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Disetujui</p>\n              <p className=\"text-3xl font-bold text-green-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalApproved || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Menunggu</p>\n              <p className=\"text-3xl font-bold text-orange-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalPending || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\n              <ClockIcon className=\"w-6 h-6 text-orange-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Ditolak</p>\n              <p className=\"text-3xl font-bold text-red-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalRejected || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center\">\n              <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Recent Submissions Table */}\n      <Card className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">Pengajuan Terbaru</h3>\n          <Link href=\"/vendor/submissions\" className=\"text-sm text-blue-600 hover:text-blue-500\">\n            Lihat Semua\n          </Link>\n        </div>\n        \n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead>\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Pekerjaan\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Lokasi Kerja\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  No. SIMLOK\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Tanggal\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {submissionsLoading ? (\n                <tr>\n                  <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\n                    <div className=\"flex items-center justify-center\">\n                      <LoadingSpinner size=\"md\" />\n                      <span className=\"ml-2 text-gray-600\">Memuat pengajuan...</span>\n                    </div>\n                  </td>\n                </tr>\n              ) : submissions.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\n                    <div className=\"text-center\">\n                      <ClockIcon className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                      <h3 className=\"text-sm font-medium text-gray-900\">Belum ada pengajuan</h3>\n                      <p className=\"text-sm text-gray-500 mt-1\">\n                        Mulai dengan membuat pengajuan SIMLOK pertama Anda\n                      </p>\n                      <Link href=\"/vendor/submissions/create\" className=\"mt-4 inline-block\">\n                        <Button variant=\"primary\" size=\"sm\">\n                          <PlusIcon className=\"w-4 h-4 mr-2\" />\n                          Buat Pengajuan Pertama\n                        </Button>\n                      </Link>\n                    </div>\n                  </td>\n                </tr>\n              ) : (\n                submissions.slice(0, 5).map((submission: any) => (\n                  <tr key={submission.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-4 text-sm text-gray-900\">\n                      <div className=\"max-w-xs truncate\" title={submission.job_description}>\n                        {submission.job_description}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-600\">\n                      <div className=\"max-w-xs truncate\" title={submission.work_location}>\n                        {submission.work_location}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-4\">\n                      {getStatusBadge(submission.approval_status)}\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-600\">\n                      {submission.simlok_number || '-'}\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-500\">\n                      {formatDate(submission.created_at)}\n                    </td>\n                    <td className=\"px-4 py-4\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          onClick={() => handleViewDetail(submission)}\n                          variant=\"info\"\n                          size=\"sm\"\n                          title=\"Lihat Detail\"\n                        >\n                          Lihat\n                        </Button>\n                        {submission.approval_status === 'PENDING' && (\n                          <>\n                            {/* <Link href={`/vendor/submissions/edit/${submission.id}`}>\n                              <Button\n                                variant=\"warning\"\n                                size=\"sm\"\n                                title=\"Ubah Pengajuan\"\n                                className=\"mr-2\"\n                              >\n                                Ubah\n                              </Button>\n                            </Link> */}\n                            <Button\n                              onClick={() => handleDelete(submission.id)}\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              title=\"Hapus Pengajuan\"\n                            >\n                              Hapus\n                            </Button>\n                          </>\n                        )}\n                        {submission.approval_status !== 'PENDING' && (\n                          <span className=\"text-gray-400 text-xs\">Tidak dapat diubah</span>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Quick Actions Footer */}\n        {/* {!loading && submissions.length > 0 && (\n          <div className=\"mt-6 pt-4 border-t border-gray-200\">\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Link href=\"/vendor/submissions/create\">\n                <Button variant=\"primary\" size=\"sm\" className=\"w-full sm:w-auto\">\n                  <PlusIcon className=\"w-4 h-4 mr-2\" />\n                  Buat Pengajuan Baru\n                </Button>\n              </Link>\n              <Link href=\"/vendor/submissions\">\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full sm:w-auto\">\n                  Kelola Semua Pengajuan\n                </Button>\n              </Link>\n            </div>\n          </div>\n        )} */}\n      </Card>\n\n      {/* Modal Detail */}\n      {selectedSubmission && (\n        <SubmissionDetailModal\n          submission={selectedSubmission}\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n        />\n      )}\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.show}\n        onClose={() => setConfirmModal(prev => ({ ...prev, show: false }))}\n        onConfirm={confirmModal.onConfirm}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        variant=\"danger\"\n        confirmText=\"Hapus\"\n        cancelText=\"Batal\"\n        isLoading={confirmModal.isLoading}\n      />\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "VerifierDashboard.tsx",
              "content": "'use client';\n\nimport { useState, useRef } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { CameraIcon } from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\nimport ScanHistory from '../scanner/ScanHistory';\n\nexport default function VerifierDashboard() {\n  const { data: session } = useSession();\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"py-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">\n                  Dashboard Verifier\n                </h1>\n                <p className=\"mt-2 text-gray-600\">\n                  Selamat datang, {session?.user?.officer_name}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Quick Scan Actions */}\n        <div className=\"mb-8\">\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-semibold text-gray-900 mb-4\">\n                Barcode & QR Code Scanner\n              </h2>\n              <p className=\"text-gray-600 mb-6\">\n                Scan barcode atau QR code SIMLOK untuk verifikasi. Scanner mendukung berbagai format: QR Code, Code 128, Code 39, EAN, UPC. Pastikan browser mengizinkan akses kamera.\n              </p>\n              \n              <div className=\"flex justify-center space-x-4\">\n                <Button\n                  onClick={() => {\n                    console.log('Opening barcode scanner from verifier dashboard');\n                    // Close any open detail modals from scan history\n                    if (scanHistoryRef.current?.closeDetailModal) {\n                      scanHistoryRef.current.closeDetailModal();\n                    }\n                    setScannerOpen(true);\n                  }}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                  size=\"lg\"\n                >\n                  <CameraIcon className=\"w-6 h-6 mr-2\" />\n                  Mulai Scan Barcode/QR Code\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Scan History */}\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n              Riwayat Scan Barcode & QR Code\n            </h3>\n          </div>\n          <ScanHistory \n            ref={scanHistoryRef}\n            className=\"border-0 shadow-none bg-transparent\" \n          />\n        </div>\n      </div>\n\n      {/* Barcode & QR Code Scanner Modal */}\n      <CameraQRScanner\n        isOpen={scannerOpen}\n        onClose={() => {\n          console.log('Closing barcode scanner from verifier dashboard');\n          setScannerOpen(false);\n        }}\n        onScan={(result: string) => {\n          console.log('Barcode/QR Scanned in verifier:', result);\n          // Scanner will handle the verification automatically\n          // Just close the scanner after successful scan\n          setScannerOpen(false);\n        }}\n        title=\"Scan Barcode/QR Code SIMLOK\"\n        description=\"Arahkan kamera ke barcode atau QR code SIMLOK untuk memverifikasi\"\n      />\n    </div>\n  );\n}"
            }
          ]
        },
        {
          "type": "directory",
          "name": "form",
          "children": [
            {
              "type": "file",
              "name": "Checkbox.tsx",
              "content": "import React from \"react\";\n\ninterface CheckboxProps {\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  label?: string;\n  className?: string;\n  disabled?: boolean;\n}\n\nexport default function Checkbox({ checked, onChange, label, className = \"\", disabled = false }: CheckboxProps) {\n  return (\n    <label className={`flex items-center ${disabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'} ${className}`}>\n      <input\n        type=\"checkbox\"\n        checked={checked}\n        onChange={(e) => onChange(e.target.checked)}\n        disabled={disabled}\n        className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n      />\n      {label && <span className=\"ml-2 text-sm text-gray-700\">{label}</span>}\n    </label>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "DatePicker.tsx",
              "content": "'use client';\n\nimport React from 'react';\nimport ReactDatePicker from 'react-datepicker';\n\nexport interface DatePickerProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n  autoFocus?: boolean;\n}\n\n// DatePicker using react-datepicker for better reliability\nexport default function DatePicker({\n  value,\n  onChange,\n  placeholder = 'Pilih tanggal',\n  disabled = false,\n  className = '',\n  autoFocus = false\n}: DatePickerProps) {\n  // Convert string value to Date object\n  const selectedDate = value ? new Date(value) : null;\n\n  // Handle date change\n  const handleChange = (date: Date | null) => {\n    if (date && onChange) {\n      // Format date to YYYY-MM-DD\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const formattedDate = `${year}-${month}-${day}`;\n      onChange(formattedDate);\n    } else if (!date && onChange) {\n      onChange('');\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <ReactDatePicker\n        selected={selectedDate}\n        onChange={handleChange}\n        placeholderText={placeholder}\n        disabled={disabled}\n        autoFocus={autoFocus}\n        dateFormat=\"dd/MM/yyyy\"\n        className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white ${className}`}\n        calendarClassName=\"react-datepicker-calendar\"\n        popperClassName=\"react-datepicker-popper\"\n        popperPlacement=\"bottom-start\"\n        showPopperArrow={false}\n        isClearable={false}\n        todayButton=\"Hari ini\"\n        onKeyDown={(e) => {\n          // Mencegah pengetikan manual kecuali untuk navigasi\n          if (\n            e.key !== 'Tab' && \n            e.key !== 'Enter' && \n            e.key !== 'Escape' && \n            e.key !== 'ArrowUp' && \n            e.key !== 'ArrowDown' && \n            e.key !== 'ArrowLeft' && \n            e.key !== 'ArrowRight'\n          ) {\n            e.preventDefault();\n          }\n        }}\n        onFocus={(e) => {\n          // Membuka datepicker saat input mendapat focus\n          e.target.blur();\n          e.target.focus();\n        }}\n      />\n    </div>\n  );\n}\n\n"
            },
            {
              "type": "file",
              "name": "DateRangePicker.tsx",
              "content": "'use client';\n\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { CalendarIcon, ArrowRightIcon } from '@heroicons/react/24/outline';\n\nexport interface DateRange {\n  startDate: string;\n  endDate: string;\n}\n\nexport interface DateRangePickerProps {\n  value?: DateRange;\n  onChange?: (value: DateRange) => void;\n  startLabel?: string;\n  endLabel?: string;\n  disabled?: boolean;\n  className?: string;\n  minDate?: string;\n  maxDate?: string;\n  required?: boolean;\n  error?: string;\n}\n\n/**\n * Robust Date Range Picker with validation and auto-template generation\n */\nexport default function DateRangePicker({\n  value = { startDate: '', endDate: '' },\n  onChange,\n  startLabel = 'Tanggal Mulai',\n  endLabel = 'Tanggal Selesai',\n  disabled = false,\n  className = '',\n  minDate,\n  maxDate,\n  required = false,\n  error\n}: DateRangePickerProps) {\n  const [dateRange, setDateRange] = useState<DateRange>(value);\n  const [errors, setErrors] = useState<{ start?: string; end?: string }>({});\n\n  // Sync with external value\n  useEffect(() => {\n    setDateRange(value);\n  }, [value]);\n\n  // Validate date range\n  const validateDateRange = useCallback((range: DateRange): { start?: string; end?: string } => {\n    const errors: { start?: string; end?: string } = {};\n    \n    // Validate start date\n    if (required && !range.startDate) {\n      errors.start = 'Tanggal mulai wajib diisi';\n    } else if (range.startDate) {\n      const startDate = new Date(range.startDate);\n      if (isNaN(startDate.getTime())) {\n        errors.start = 'Format tanggal tidak valid';\n      } else {\n        // Check min date\n        if (minDate && startDate < new Date(minDate)) {\n          errors.start = `Tanggal tidak boleh sebelum ${new Date(minDate).toLocaleDateString('id-ID')}`;\n        }\n        // Check max date\n        if (maxDate && startDate > new Date(maxDate)) {\n          errors.start = `Tanggal tidak boleh setelah ${new Date(maxDate).toLocaleDateString('id-ID')}`;\n        }\n      }\n    }\n\n    // Validate end date\n    if (required && !range.endDate) {\n      errors.end = 'Tanggal selesai wajib diisi';\n    } else if (range.endDate) {\n      const endDate = new Date(range.endDate);\n      if (isNaN(endDate.getTime())) {\n        errors.end = 'Format tanggal tidak valid';\n      } else {\n        // Check min date\n        if (minDate && endDate < new Date(minDate)) {\n          errors.end = `Tanggal tidak boleh sebelum ${new Date(minDate).toLocaleDateString('id-ID')}`;\n        }\n        // Check max date\n        if (maxDate && endDate > new Date(maxDate)) {\n          errors.end = `Tanggal tidak boleh setelah ${new Date(maxDate).toLocaleDateString('id-ID')}`;\n        }\n        // Check if end date is after start date\n        if (range.startDate && endDate < new Date(range.startDate)) {\n          errors.end = 'Tanggal selesai harus setelah tanggal mulai';\n        }\n      }\n    }\n\n    return errors;\n  }, [minDate, maxDate, required]);\n\n  // Handle start date change\n  const handleStartDateChange = useCallback((newStartDate: string) => {\n    const newRange = { ...dateRange, startDate: newStartDate };\n    setDateRange(newRange);\n    \n    const validationErrors = validateDateRange(newRange);\n    setErrors(validationErrors);\n    \n    if (onChange && Object.keys(validationErrors).length === 0) {\n      onChange(newRange);\n    }\n  }, [dateRange, onChange, validateDateRange]);\n\n  // Handle end date change\n  const handleEndDateChange = useCallback((newEndDate: string) => {\n    const newRange = { ...dateRange, endDate: newEndDate };\n    setDateRange(newRange);\n    \n    const validationErrors = validateDateRange(newRange);\n    setErrors(validationErrors);\n    \n    if (onChange && Object.keys(validationErrors).length === 0) {\n      onChange(newRange);\n    }\n  }, [dateRange, onChange, validateDateRange]);\n\n  // Calculate duration\n  const getDuration = useCallback((): number | null => {\n    if (!dateRange.startDate || !dateRange.endDate) return null;\n    \n    try {\n      const start = new Date(dateRange.startDate);\n      const end = new Date(dateRange.endDate);\n      \n      if (isNaN(start.getTime()) || isNaN(end.getTime())) return null;\n      \n      const diffTime = end.getTime() - start.getTime();\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both start and end dates\n      \n      return diffDays > 0 ? diffDays : null;\n    } catch (error) {\n      return null;\n    }\n  }, [dateRange]);\n\n  // Format date for display\n  const formatDateForDisplay = useCallback((dateStr: string): string => {\n    if (!dateStr) return '';\n    \n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) return '';\n      \n      return date.toLocaleDateString('id-ID', {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    } catch (error) {\n      return '';\n    }\n  }, []);\n\n  const duration = getDuration();\n  const hasValidRange = dateRange.startDate && dateRange.endDate && Object.keys(errors).length === 0;\n\n  return (\n    <div className={className}>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {/* Start Date */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            {startLabel}\n            {required && <span className=\"text-red-500 ml-1\">*</span>}\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"date\"\n              value={dateRange.startDate}\n              onChange={(e) => handleStartDateChange(e.target.value)}\n              disabled={disabled}\n              min={minDate}\n              max={maxDate}\n              className={`\n                w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200\n                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n                ${errors.start \n                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500' \n                  : 'border-gray-300 hover:border-gray-400'\n                }\n                ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}\n              `}\n            />\n            <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none\" />\n          </div>\n          {errors.start && (\n            <div className=\"mt-1 text-sm text-red-600 flex items-center\">\n              <svg className=\"h-4 w-4 mr-1 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n              </svg>\n              {errors.start}\n            </div>\n          )}\n        </div>\n\n        {/* End Date */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            {endLabel}\n            {required && <span className=\"text-red-500 ml-1\">*</span>}\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"date\"\n              value={dateRange.endDate}\n              onChange={(e) => handleEndDateChange(e.target.value)}\n              disabled={disabled}\n              min={dateRange.startDate || minDate}\n              max={maxDate}\n              className={`\n                w-full px-3 py-2 pr-10 border rounded-md transition-all duration-200\n                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n                ${errors.end \n                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500' \n                  : 'border-gray-300 hover:border-gray-400'\n                }\n                ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}\n              `}\n            />\n            <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none\" />\n          </div>\n          {errors.end && (\n            <div className=\"mt-1 text-sm text-red-600 flex items-center\">\n              <svg className=\"h-4 w-4 mr-1 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n              </svg>\n              {errors.end}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Date Range Summary */}\n      {hasValidRange && (\n        <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center text-sm text-blue-800\">\n              <CalendarIcon className=\"h-4 w-4 mr-2\" />\n              <span className=\"font-medium\">Periode Pelaksanaan:</span>\n            </div>\n            {duration && (\n              <div className=\"text-sm font-medium text-blue-700 bg-blue-100 px-2 py-1 rounded\">\n                {duration} hari\n              </div>\n            )}\n          </div>\n          <div className=\"mt-2 text-sm text-blue-700\">\n            <div className=\"flex items-center\">\n              <span className=\"font-medium\">{formatDateForDisplay(dateRange.startDate)}</span>\n              <ArrowRightIcon className=\"h-4 w-4 mx-2 text-blue-500\" />\n              <span className=\"font-medium\">{formatDateForDisplay(dateRange.endDate)}</span>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Global Error */}\n      {error && (\n        <div className=\"mt-2 text-sm text-red-600 flex items-center\">\n          <svg className=\"h-4 w-4 mr-1 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n          </svg>\n          {error}\n        </div>\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "EnhancedFileUpload.tsx",
              "content": "\"use client\";\n\nimport { useState, useRef } from \"react\";\nimport {\n  DocumentIcon,\n  XMarkIcon,\n  CloudArrowUpIcon,\n  PhotoIcon,\n  PencilSquareIcon,\n  TrashIcon,\n} from \"@heroicons/react/24/outline\";\nimport { ImageCompressor } from \"@/utils/image-compression\";\nimport { useToast } from \"@/hooks/useToast\";\n\ninterface EnhancedFileUploadProps {\n  id: string;\n  name: string;\n  value: string;\n  onChange: (value: string) => void;\n  onFileChange?: (file: File | null) => void;\n  uploadType: \"worker-photo\" | \"document\" | \"other\";\n  multiple?: boolean;\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n  label?: string;\n  description?: string;\n  workerName?: string; // khusus foto pekerja\n}\n\nexport default function EnhancedFileUpload({\n  id,\n  name,\n  value,\n  onChange,\n  onFileChange,\n  uploadType,\n  multiple = false,\n  required = false,\n  disabled = false,\n  className = \"\",\n  label,\n  description,\n  workerName,\n}: EnhancedFileUploadProps) {\n  const [dragActive, setDragActive] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { showSuccess, showError } = useToast();\n\n  // --- Helpers UI ---\n  const getAcceptTypes = () => {\n    switch (uploadType) {\n      case \"worker-photo\":\n        return \".jpg,.jpeg,.png,.webp\";\n      case \"document\":\n        return \".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp\";\n      default:\n        return \".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp\";\n    }\n  };\n\n  const text = (() => {\n    if (uploadType === \"worker-photo\") {\n      return {\n        title: \"Unggah Foto Pekerja\",\n        subtitle: \"Tarik & letakkan atau klik untuk memilih\",\n        formats: \"JPG, JPEG, PNG, WebP — maks 10MB (dikompres otomatis)\",\n      };\n    }\n    return {\n      title: \"Unggah Dokumen\",\n      subtitle: \"Tarik & letakkan atau klik untuk memilih\",\n      formats: \"PDF, DOC, DOCX, JPG, PNG, WebP — maks 8MB\",\n    };\n  })();\n\n  const fileNameFromUrl = (url: string): string => {\n    if (!url) return \"\";\n    try {\n      const decoded = decodeURIComponent(url);\n      const last = decoded.split(\"?\")[0]?.split(\"/\").pop() ?? \"\";\n      return last;\n    } catch {\n      const last = url.split(\"?\")[0]?.split(\"/\").pop() ?? \"\";\n      return last;\n    }\n  };\n\n  // --- Validasi & Upload ---\n  const validateFile = (file: File): { isValid: boolean; error?: string } => {\n    switch (uploadType) {\n      case \"worker-photo\":\n        return ImageCompressor.validateWorkerPhoto(file);\n      case \"document\":\n        return ImageCompressor.validateDocumentFile(file);\n      default:\n        return { isValid: false, error: \"Tipe upload tidak valid\" };\n    }\n  };\n\n  const uploadFile = async (file: File): Promise<string> => {\n    let fileToUpload = file;\n\n    if (uploadType === \"worker-photo\") {\n      try {\n        const compressionResult = await ImageCompressor.compressWorkerPhoto(file, {\n          maxWidth: 800,\n          maxHeight: 600,\n          quality: 0.85,\n          maxSizeKB: 500,\n        });\n        fileToUpload = compressionResult.file;\n      } catch (e) {\n        // Kompresi gagal → pakai file asli, tetap lanjut upload\n        console.error(\"Compression error:\", e);\n      }\n    }\n\n    const formData = new FormData();\n    formData.append(\"file\", fileToUpload);\n    if (uploadType === \"worker-photo\" && workerName) {\n      formData.append(\"workerName\", workerName);\n    }\n    if (name) {\n      formData.append(\"fieldName\", name);\n    }\n\n    const uploadEndpoint =\n      uploadType === \"worker-photo\" ? \"/api/upload/worker-photo\" : \"/api/upload\";\n\n    const res = await fetch(uploadEndpoint, { method: \"POST\", body: formData });\n    if (!res.ok) {\n      let message = \"Upload gagal\";\n      try {\n        const data = await res.json();\n        message = data?.error || message;\n      } catch {\n        // ignore\n      }\n      throw new Error(message);\n    }\n    const data = await res.json();\n    return data.url as string;\n  };\n\n  const handleFileSelect = async (files: FileList | null) => {\n    if (!files || files.length === 0) return;\n    const file = files[0];\n    if (!file) return; // guard: File | undefined\n\n    setError(null);\n\n    const validation = validateFile(file);\n    if (!validation.isValid) {\n      setError(validation.error || \"File tidak valid\");\n      return;\n    }\n\n    try {\n      setUploading(true);\n      setUploadProgress(0);\n\n      // Progress sederhana agar UX terasa responsif\n      const tick = setInterval(() => {\n        setUploadProgress((p) => (p < 90 ? p + 8 : p));\n      }, 120);\n\n      const url = await uploadFile(file);\n\n      clearInterval(tick);\n      setUploadProgress(100);\n\n      onChange?.(url);\n      onFileChange?.(file);\n      showSuccess(\"Berhasil\", \"File berhasil diunggah\");\n    } catch (e: unknown) {\n      const msg = e instanceof Error ? e.message : \"Gagal mengunggah file\";\n      setError(msg);\n      showError(\"Gagal\", msg);\n    } finally {\n      setTimeout(() => setUploadProgress(0), 800);\n      setUploading(false);\n    }\n  };\n\n  // --- Drag & Drop ---\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (disabled) return;\n    if (e.type === \"dragenter\" || e.type === \"dragover\") setDragActive(true);\n    if (e.type === \"dragleave\") setDragActive(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (disabled) return;\n    setDragActive(false);\n    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      handleFileSelect(e.dataTransfer.files);\n    }\n  };\n\n  const handleRemove = (e?: React.MouseEvent) => {\n    e?.stopPropagation();\n    onChange?.(\"\");\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\n    setError(null);\n  };\n\n  const handleReplace = (e?: React.MouseEvent) => {\n    e?.stopPropagation();\n    fileInputRef.current?.click();\n  };\n\n  // --- Render ---\n  const fileName = fileNameFromUrl(value);\n  const hasFile = Boolean(value);\n  const isImage = uploadType === \"worker-photo\";\n\n  return (\n    <div className={`w-full ${className}`}>\n      {label && (\n        <label htmlFor={id} className=\"mb-2 block text-sm font-medium text-gray-700\">\n          {label}\n          {required && <span className=\"ml-1 text-red-500\">*</span>}\n        </label>\n      )}\n\n      {/* Dropzone */}\n      <div\n        role=\"button\"\n        tabIndex={0}\n        aria-disabled={disabled}\n        onKeyDown={(e) => {\n          if (disabled) return;\n          if (e.key === \"Enter\" || e.key === \" \") fileInputRef.current?.click();\n        }}\n        className={[\n          \"relative group rounded-xl border-2 border-dashed p-4 transition\",\n          disabled ? \"opacity-60 cursor-not-allowed\" : \"cursor-pointer\",\n          dragActive\n            ? \"border-blue-500 bg-blue-50\"\n            : error\n            ? \"border-red-300 bg-red-50\"\n            : \"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-50\",\n          \"focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400/60\",\n        ].join(\" \")}\n        onClick={() => !disabled && fileInputRef.current?.click()}\n        onDragEnter={handleDrag}\n        onDragOver={handleDrag}\n        onDragLeave={handleDrag}\n        onDrop={handleDrop}\n      >\n        <input\n          ref={fileInputRef}\n          id={id}\n          name={name}\n          type=\"file\"\n          className=\"hidden\"\n          accept={getAcceptTypes()}\n          multiple={multiple}\n          disabled={disabled}\n          onChange={(e) => handleFileSelect(e.target.files)}\n        />\n\n        {/* ================== STATE: UPLOADING ================== */}\n        {uploading ? (\n          <div className=\"text-center\">\n            <CloudArrowUpIcon className=\"mx-auto h-10 w-10 text-blue-500 animate-bounce\" />\n            <p className=\"mt-3 text-sm font-medium text-gray-900\">\n              Mengunggah{uploadType === \"worker-photo\" ? \" & mengompres\" : \"\"}…\n            </p>\n            <div className=\"mt-3 h-2 w-full overflow-hidden rounded-full bg-gray-200\">\n              <div\n                className=\"h-2 rounded-full bg-blue-600 transition-all duration-300\"\n                style={{ width: `${uploadProgress}%` }}\n              />\n            </div>\n            <div className=\"mt-1 text-xs text-gray-500\">{uploadProgress}%</div>\n          </div>\n        ) : /* ================ STATE: HAS FILE ================ */ hasFile ? (\n          isImage ? (\n            /* FOTO → preview rapih & tidak melebihi komponen */\n            <div\n              className=\"relative mx-auto flex max-w-full flex-col items-center gap-3\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"relative w-full max-w-[360px] overflow-hidden rounded-lg border bg-white\">\n                {/* Kotak rasio agar tinggi terkontrol (4:3). Gambar absolute agar tidak overflow */}\n                <div className=\"relative w-full aspect-[4/3]\">\n                  <img\n                    src={value}\n                    alt={workerName ? `Foto ${workerName}` : \"Foto pekerja\"}\n                    className=\"absolute inset-0 h-full w-full object-cover\"\n                  />\n                </div>\n\n                {/* Overlay hover (tetap di dalam kontainer, tidak melebihi) */}\n                <div className=\"pointer-events-none absolute inset-0 hidden items-center justify-center bg-black/45 group-hover:flex\">\n                  <div className=\"pointer-events-auto flex gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={handleReplace}\n                      className=\"inline-flex items-center gap-1 rounded-md bg-white/95 px-3 py-2 text-sm font-medium text-gray-700 shadow hover:bg-white\"\n                    >\n                      <PencilSquareIcon className=\"h-4 w-4\" />\n                      Ganti\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={handleRemove}\n                      className=\"inline-flex items-center gap-1 rounded-md bg-white/95 px-3 py-2 text-sm font-medium text-red-600 shadow hover:bg-white\"\n                    >\n                      <TrashIcon className=\"h-4 w-4\" />\n                      Hapus\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              {/* filename + helper */}\n              <div className=\"text-center\">\n                <div\n                  className=\"mx-auto max-w-[280px] truncate text-sm font-medium text-gray-900 sm:max-w-[360px]\"\n                  title={fileName}\n                >\n                  {fileName || \"foto-terunggah\"}\n                </div>\n                {workerName && (\n                  <div className=\"mt-0.5 text-[11px] text-gray-500\">\n                    Untuk: <span className=\"font-medium\">{workerName}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          ) : (\n            /* DOKUMEN → kartu file */\n            <div\n              className=\"relative mx-auto flex max-w-full flex-col items-center gap-3\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\"relative flex w-full max-w-[420px] items-center gap-3 rounded-lg border bg-white p-3\">\n                <div className=\"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-md bg-gray-50\">\n                  <DocumentIcon className=\"h-6 w-6 text-blue-500\" />\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                  <div\n                    className=\"truncate text-sm font-medium text-gray-900\"\n                    title={fileName}\n                  >\n                    {fileName || \"file-terunggah\"}\n                  </div>\n                  <div className=\"truncate text-xs text-gray-500\">{value}</div>\n                </div>\n\n                {/* Overlay hover */}\n                <div className=\"absolute inset-0 hidden items-center justify-center bg-black/40 group-hover:flex\">\n                  <div className=\"pointer-events-auto flex gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={handleReplace}\n                      className=\"inline-flex items-center gap-1 rounded-md bg-white/95 px-3 py-2 text-sm font-medium text-gray-700 shadow hover:bg-white\"\n                    >\n                      <PencilSquareIcon className=\"h-4 w-4\" />\n                      Ganti\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={handleRemove}\n                      className=\"inline-flex items-center gap-1 rounded-md bg-white/95 px-3 py-2 text-sm font-medium text-red-600 shadow hover:bg-white\"\n                    >\n                      <XMarkIcon className=\"h-4 w-4\" />\n                      Hapus\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )\n        ) : (\n          /* ================ STATE: EMPTY ================ */\n          <div className=\"text-center\">\n            {uploadType === \"worker-photo\" ? (\n              <PhotoIcon className=\"mx-auto h-10 w-10 text-blue-500\" />\n            ) : (\n              <DocumentIcon className=\"mx-auto h-10 w-10 text-blue-500\" />\n            )}\n            <p className=\"mt-3 text-sm font-medium text-gray-900\">{text.title}</p>\n            <p className=\"mt-1 text-xs text-gray-600\">{text.subtitle}</p>\n            <p className=\"mt-1 text-xs text-gray-400\">{text.formats}</p>\n          </div>\n        )}\n      </div>\n\n      {/* Bantuan & Error */}\n      {description && !error && (\n        <p className=\"mt-2 text-sm text-gray-500\">{description}</p>\n      )}\n      {error && <p className=\"mt-2 text-sm text-red-600\">{error}</p>}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "FileUpload.tsx",
              "content": "'use client';\n\nimport { useState, useRef } from 'react';\nimport { DocumentIcon, XMarkIcon, CloudArrowUpIcon } from '@heroicons/react/24/outline';\n\ninterface FileUploadProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (url: string) => void;\n  onFileChange?: (file: File | null) => void;\n  accept?: string;\n  multiple?: boolean;\n  maxSize?: number; // in MB - default is now 8MB\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n  label?: string;\n  description?: string;\n}\n\nexport default function FileUpload({\n  id,\n  name,\n  value,\n  onChange,\n  onFileChange,\n  accept = \".pdf,.doc,.docx,.jpg,.jpeg,.png\",\n  multiple = false,\n  maxSize = 8, // 8MB default\n  required = false,\n  disabled = false,\n  className,\n  label,\n  description\n}: FileUploadProps) {\n  const [dragActive, setDragActive] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const validateFileInput = (file: File): string | null => {\n    // Check file size first\n    if (file.size > maxSize * 1024 * 1024) {\n      return `Ukuran file terlalu besar. Maksimal ${maxSize}MB`;\n    }\n\n    // Check file type based on accept prop\n    const acceptedTypes = accept.split(',').map(type => type.trim());\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    \n    const isValidType = acceptedTypes.some(type => {\n      if (type.startsWith('.')) {\n        return type === fileExtension;\n      }\n      return file.type.match(type);\n    });\n\n    if (!isValidType) {\n      return `Tipe file tidak didukung. Tipe yang diizinkan: ${accept}`;\n    }\n\n    return null;\n  };\n\n  const uploadFile = async (file: File): Promise<string> => {\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    // Add field name to help categorize the file\n    if (name) {\n      formData.append('fieldName', name);\n    }\n\n    const response = await fetch('/api/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Upload failed');\n    }\n\n    const data = await response.json();\n    return data.url;\n  };\n\n  const handleFileSelect = async (files: FileList | null) => {\n    if (!files || files.length === 0) return;\n\n    const file = files[0];\n    if (!file) return;\n    \n    setError(null);\n\n    // Validate file\n    const validationError = validateFileInput(file);\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    try {\n      setUploading(true);\n      setUploadProgress(0);\n\n      // Simulate progress for better UX\n      const progressInterval = setInterval(() => {\n        setUploadProgress(prev => Math.min(prev + 10, 90));\n      }, 100);\n\n      const fileUrl = await uploadFile(file);\n      \n      clearInterval(progressInterval);\n      setUploadProgress(100);\n\n      // Notify parent components\n      if (onChange) {\n        onChange(fileUrl);\n      }\n      if (onFileChange) {\n        onFileChange(file);\n      }\n\n      setTimeout(() => {\n        setUploading(false);\n        setUploadProgress(0);\n      }, 500);\n\n    } catch (error) {\n      setError(error instanceof Error ? error.message : 'Upload failed');\n      setUploading(false);\n      setUploadProgress(0);\n    }\n  };\n\n  const handleDragEnter = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (disabled) return;\n\n    const files = e.dataTransfer.files;\n    handleFileSelect(files);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    handleFileSelect(e.target.files);\n  };\n\n  const handleClick = () => {\n    if (disabled) return;\n    fileInputRef.current?.click();\n  };\n\n  const removeFile = () => {\n    if (onChange) {\n      onChange('');\n    }\n    if (onFileChange) {\n      onFileChange(null);\n    }\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    setError(null);\n  };\n\n  const getFileName = () => {\n    if (value) {\n      return value.split('/').pop() || 'Uploaded file';\n    }\n    return null;\n  };\n\n  return (\n    <div className={`space-y-2 ${className || ''}`}>\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700\">\n          {label}\n          {required && <span className=\"text-red-500 ml-1\">*</span>}\n        </label>\n      )}\n\n      {description && (\n        <p className=\"text-sm text-gray-500\">{description}</p>\n      )}\n\n      <div\n        className={`relative border-2 border-dashed rounded-lg p-6 transition-colors ${\n          dragActive \n            ? 'border-blue-400 bg-blue-50' \n            : disabled \n            ? 'border-gray-200 bg-gray-50' \n            : 'border-gray-300 hover:border-gray-400'\n        } ${\n          !disabled ? 'cursor-pointer' : 'cursor-not-allowed'\n        }`}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        onClick={handleClick}\n      >\n        <input\n          ref={fileInputRef}\n          id={id}\n          name={name}\n          type=\"file\"\n          accept={accept}\n          multiple={multiple}\n          required={required}\n          disabled={disabled}\n          onChange={handleInputChange}\n          className=\"hidden\"\n        />\n\n        {uploading ? (\n          <div className=\"text-center\">\n            <CloudArrowUpIcon className=\"mx-auto h-12 w-12 text-blue-500 animate-pulse\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">Uploading...</div>\n              <div className=\"mt-2 w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${uploadProgress}%` }}\n                />\n              </div>\n              <div className=\"text-xs text-gray-500 mt-1\">{uploadProgress}%</div>\n            </div>\n          </div>\n        ) : value ? (\n          <div className=\"text-center\">\n            <DocumentIcon className=\"mx-auto h-12 w-12 text-green-500\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">{getFileName()}</div>\n              <div className=\"text-xs text-gray-500 mt-1\">File uploaded successfully</div>\n              <button\n                type=\"button\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  removeFile();\n                }}\n                className=\"mt-2 inline-flex items-center px-3 py-1 text-xs font-medium text-red-600 bg-red-50 rounded-md hover:bg-red-100\"\n              >\n                <XMarkIcon className=\"h-4 w-4 mr-1\" />\n                Remove\n              </button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"text-center\">\n            <CloudArrowUpIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">\n                {dragActive ? 'Drop file here' : 'Click to upload or drag and drop'}\n              </div>\n              <div className=\"text-xs text-gray-500 mt-1\">\n                {accept} up to {maxSize}MB\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {error && (\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-200 rounded-md p-2\">\n          {error}\n        </div>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "ImprovedDatePicker.tsx",
              "content": "'use client';\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { CalendarIcon, XMarkIcon } from '@heroicons/react/24/outline';\n\nexport interface ImprovedDatePickerProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n  autoFocus?: boolean;\n  minDate?: string;\n  maxDate?: string;\n  label?: string;\n  error?: string;\n  helperText?: string;\n}\n\n/**\n * Improved DatePicker component with better error handling and user experience\n */\nexport default function ImprovedDatePicker({\n  id,\n  name,\n  value = '',\n  onChange,\n  placeholder = 'Pilih tanggal',\n  required = false,\n  disabled = false,\n  className = '',\n  autoFocus = false,\n  minDate,\n  maxDate,\n  label,\n  error,\n  helperText\n}: ImprovedDatePickerProps) {\n  const [internalValue, setInternalValue] = useState(value);\n  const [isFocused, setIsFocused] = useState(false);\n  const [hasError, setHasError] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Sync internal value with external value\n  useEffect(() => {\n    setInternalValue(value);\n  }, [value]);\n\n  // Format date for display\n  const formatDateForDisplay = useCallback((dateStr: string): string => {\n    if (!dateStr) return '';\n    \n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) return '';\n      \n      return date.toLocaleDateString('id-ID', {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    } catch (error) {\n      console.warn('Date formatting error:', error);\n      return '';\n    }\n  }, []);\n\n  // Validate date\n  const validateDate = useCallback((dateStr: string): boolean => {\n    if (!dateStr) return !required;\n    \n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) return false;\n      \n      // Check min date\n      if (minDate) {\n        const minDateObj = new Date(minDate);\n        if (date < minDateObj) return false;\n      }\n      \n      // Check max date\n      if (maxDate) {\n        const maxDateObj = new Date(maxDate);\n        if (date > maxDateObj) return false;\n      }\n      \n      return true;\n    } catch (error) {\n      return false;\n    }\n  }, [minDate, maxDate, required]);\n\n  // Handle input change\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setInternalValue(newValue);\n    \n    const isValid = validateDate(newValue);\n    setHasError(!isValid);\n    \n    if (onChange) {\n      onChange(newValue);\n    }\n  }, [onChange, validateDate]);\n\n  // Handle clear button\n  const handleClear = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    setInternalValue('');\n    setHasError(false);\n    \n    if (onChange) {\n      onChange('');\n    }\n    \n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [onChange]);\n\n  // Handle focus\n  const handleFocus = useCallback(() => {\n    setIsFocused(true);\n  }, []);\n\n  // Handle blur\n  const handleBlur = useCallback(() => {\n    setIsFocused(false);\n  }, []);\n\n  const hasValue = internalValue && internalValue.length > 0;\n  const showError = error || (hasError && hasValue);\n  const displayValue = formatDateForDisplay(internalValue);\n\n  return (\n    <div className={`relative ${className}`}>\n      {/* Label */}\n      {label && (\n        <label \n          htmlFor={id}\n          className=\"block text-sm font-medium text-gray-700 mb-2\"\n        >\n          {label}\n          {required && <span className=\"text-red-500 ml-1\">*</span>}\n        </label>\n      )}\n\n      {/* Input Container */}\n      <div className=\"relative\">\n        {/* Native Date Input */}\n        <input\n          ref={inputRef}\n          id={id}\n          name={name}\n          type=\"date\"\n          value={internalValue}\n          onChange={handleChange}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          placeholder={placeholder}\n          required={required}\n          disabled={disabled}\n          autoFocus={autoFocus}\n          min={minDate}\n          max={maxDate}\n          className={`\n            w-full px-3 py-2 pr-12 border rounded-md transition-all duration-200\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n            ${showError \n              ? 'border-red-300 focus:ring-red-500 focus:border-red-500' \n              : isFocused \n                ? 'border-blue-300' \n                : 'border-gray-300 hover:border-gray-400'\n            }\n            ${disabled ? 'bg-gray-50 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-900'}\n            ${hasValue ? 'text-gray-900' : 'text-gray-500'}\n          `}\n        />\n\n        {/* Calendar Icon */}\n        <div className=\"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none\">\n          <CalendarIcon className={`h-4 w-4 ${showError ? 'text-red-400' : 'text-gray-400'}`} />\n        </div>\n\n        {/* Clear Button */}\n        {hasValue && !disabled && (\n          <button\n            type=\"button\"\n            onClick={handleClear}\n            className=\"absolute inset-y-0 right-8 flex items-center pr-1 hover:bg-gray-100 rounded-r-md transition-colors\"\n            tabIndex={-1}\n          >\n            <XMarkIcon className=\"h-4 w-4 text-gray-400 hover:text-gray-600\" />\n          </button>\n        )}\n      </div>\n\n      {/* Display Value */}\n      {displayValue && (\n        <div className=\"mt-2 text-sm text-gray-600 bg-gray-50 px-3 py-2 rounded-md border\">\n          <span className=\"font-medium\">Tanggal terpilih:</span> {displayValue}\n        </div>\n      )}\n\n      {/* Error Message */}\n      {showError && (\n        <div className=\"mt-1 text-sm text-red-600 flex items-center\">\n          <svg className=\"h-4 w-4 mr-1 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n          </svg>\n          {error || 'Tanggal tidak valid'}\n        </div>\n      )}\n\n      {/* Helper Text */}\n      {helperText && !showError && (\n        <div className=\"mt-1 text-sm text-gray-500\">\n          {helperText}\n        </div>\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "Input.tsx",
              "content": "import React from \"react\";\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  className?: string;\n  error?: string;\n}\n\nexport default function Input({ className = \"\", error, ...props }: InputProps) {\n  return (\n    <div className=\"w-full\">\n      <input\n        className={`w-full px-3 py-2 border ${error ? 'border-red-500' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-1 ${error ? 'focus:ring-red-500 focus:border-red-500' : 'focus:ring-blue-500 focus:border-blue-500'} ${className}`}\n        {...props}\n      />\n      {error && (\n        <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "Label.tsx",
              "content": "import React, { FC, ReactNode } from \"react\";\nimport { twMerge } from \"tailwind-merge\";\n\ninterface LabelProps {\n  htmlFor?: string;\n  children: ReactNode;\n  className?: string;\n}\n\nconst Label: FC<LabelProps> = ({ htmlFor, children, className }) => {\n  return (\n    <label\n      htmlFor={htmlFor}\n      className={twMerge(\n        // Default classes that apply by default\n        \"mb-1.5 block text-sm font-medium text-gray-700\",\n\n        // User-defined className that can override the default margin\n        className\n      )}\n    >\n      {children}\n    </label>\n  );\n};\n\nexport default Label;\n"
            },
            {
              "type": "file",
              "name": "TimePicker.tsx",
              "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { ClockIcon, ChevronDownIcon } from '@heroicons/react/24/outline';\n\ninterface TimePickerProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport default function TimePicker({\n  id,\n  name,\n  value,\n  onChange,\n  placeholder = \"Pilih waktu\",\n  required = false,\n  disabled = false,\n  className\n}: TimePickerProps) {\n  const [startTime, setStartTime] = useState('');\n  const [endTime, setEndTime] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n\n  // Generate time options (00:00 to 23:00 with 1 hour intervals)\n  const generateTimeOptions = () => {\n    const times = [];\n    for (let hour = 0; hour < 24; hour++) {\n      const formattedHour = hour.toString().padStart(2, '0');\n      times.push(`${formattedHour}:00`);\n    }\n    return times;\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Parse existing value if any\n  useEffect(() => {\n    if (value) {\n      if (value.includes(' - ')) {\n        const parts = value.split(' - ');\n        if (parts.length >= 2 && parts[0] && parts[1]) {\n          setStartTime(parts[0].trim());\n          setEndTime(parts[1].replace(' WIB', '').trim());\n        }\n      } else if (value.includes(' s/d ')) {\n        const parts = value.split(' s/d ');\n        if (parts.length >= 2 && parts[0] && parts[1]) {\n          setStartTime(parts[0].trim());\n          setEndTime(parts[1].replace(' WIB', '').trim());\n        }\n      }\n    }\n  }, [value]);\n\n  const handleStartTimeChange = (time: string) => {\n    setStartTime(time);\n  };\n\n  const handleEndTimeChange = (time: string) => {\n    setEndTime(time);\n  };\n\n  const handleApply = () => {\n    if (startTime && endTime) {\n      const timeRange = `${startTime} WIB - ${endTime} WIB`;\n      if (onChange) {\n        onChange(timeRange);\n      }\n      setIsOpen(false);\n    }\n  };\n\n  const handleReset = () => {\n    setStartTime('');\n    setEndTime('');\n    if (onChange) {\n      onChange('');\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <div \n        className={`w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 ${\n          disabled ? 'bg-gray-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'\n        } ${className || ''}`}\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n      >\n        <input\n          id={id}\n          name={name}\n          type=\"text\"\n          value={value || ''}\n          placeholder={placeholder}\n          readOnly\n          required={required}\n          disabled={disabled}\n          className=\"w-full bg-transparent outline-none cursor-pointer\"\n        />\n        <ClockIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n      </div>\n\n      {isOpen && !disabled && (\n        <>\n          {/* Overlay to close dropdown when clicking outside */}\n          <div \n            className=\"fixed inset-0 z-40\" \n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Dropdown content */}\n          <div className=\"absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-xl min-w-[350px]\">\n            <div className=\"p-4 space-y-4\">\n              <div className=\"text-sm font-medium text-gray-900 mb-3\">\n                Pilih Rentang Waktu Kerja\n              </div>\n              \n              {/* Start Time Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Waktu Mulai\n                </label>\n                <div className=\"relative\">\n                  <select\n                    value={startTime}\n                    onChange={(e) => handleStartTimeChange(e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white\"\n                  >\n                    <option value=\"\">-- Pilih Waktu Mulai --</option>\n                    {timeOptions.map((time) => (\n                      <option key={`start-${time}`} value={time}>\n                        {time}\n                      </option>\n                    ))}\n                  </select>\n                  <ChevronDownIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                </div>\n              </div>\n\n              {/* End Time Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Waktu Selesai\n                </label>\n                <div className=\"relative\">\n                  <select\n                    value={endTime}\n                    onChange={(e) => handleEndTimeChange(e.target.value)}\n                    disabled={!startTime}\n                    className={`w-full px-3 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 appearance-none bg-white ${\n                      !startTime \n                        ? 'bg-gray-50 cursor-not-allowed text-gray-400'\n                        : 'border-gray-300 focus:ring-blue-500 focus:border-blue-500'\n                    }`}\n                  >\n                    <option value=\"\">\n                      {!startTime ? '-- Pilih waktu mulai terlebih dahulu --' : '-- Pilih Waktu Selesai --'}\n                    </option>\n                    {timeOptions.map((time) => (\n                      <option key={`end-${time}`} value={time}>\n                        {time}\n                      </option>\n                    ))}\n                  </select>\n                  <ChevronDownIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                </div>\n              </div>\n\n              {/* Preview */}\n              {startTime && endTime && (\n                <div className=\"p-3 bg-blue-50 rounded-md border border-blue-200\">\n                  <div className=\"text-sm text-blue-800\">\n                    <strong>Preview:</strong> {startTime} - {endTime} WIB\n                  </div>\n                </div>\n              )}\n\n              {/* Action Buttons */}\n              <div className=\"flex justify-between space-x-2 pt-2 border-t border-gray-200\">\n                <button\n                  type=\"button\"\n                  onClick={handleReset}\n                  className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50\"\n                >\n                  Reset\n                </button>\n                <div className=\"flex space-x-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setIsOpen(false)}\n                    className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50\"\n                  >\n                    Batal\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={handleApply}\n                    disabled={!startTime || !endTime}\n                    className=\"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\"\n                  >\n                    Terapkan\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "directory",
              "name": "input",
              "children": [
                {
                  "type": "file",
                  "name": "InputField.tsx",
                  "content": "\"use client\";\nimport React from \"react\";\n\ninterface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  error?: string;\n}\n\nconst InputField: React.FC<InputFieldProps> = ({ error, ...props }) => {\n  return (\n    <div className=\"relative\">\n      <input\n        {...props}\n        className={`w-full rounded-lg border bg-white px-4 py-3 text-sm text-gray-800 outline-none transition focus:border-gray-900 ${\n          error\n            ? \"border-red-500 focus:border-red-500\"\n            : \"border-gray-300\"\n        }`}\n      />\n      {error && (\n        <p className=\"mt-1 text-xs text-red-500\">{error}</p>\n      )}\n    </div>\n  );\n};\n\nexport default InputField;"
                }
              ]
            },
            {
              "type": "directory",
              "name": "textarea",
              "children": [
                {
                  "type": "file",
                  "name": "TextArea.tsx",
                  "content": "import React, { forwardRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  className?: string;\n  error?: string;\n}\n\nconst TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(\n  ({ className, error, ...props }, ref) => {\n    return (\n      <div>\n        <textarea\n          className={cn(\n            \"flex min-h-[100px] w-full rounded-md border bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50\",\n            error\n              ? \"border-red-500 focus:border-red-500 focus:ring-red-500\"\n              : \"border-gray-300 focus:border-blue-500 focus:ring-blue-500\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        />\n        {error && (\n          <p className=\"mt-1 text-sm text-red-500\">\n            {error}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nTextArea.displayName = \"TextArea\";\n\nexport default TextArea;"
                }
              ]
            }
          ]
        },
        {
          "type": "directory",
          "name": "layout",
          "children": [
            {
              "type": "file",
              "name": "PageHeader.tsx",
              "content": "\"use client\";\n\nexport default function PageHeader({\n  title,\n  subtitle,\n  cta,\n}: {\n  title: string;\n  subtitle?: string;\n  cta?: React.ReactNode;\n}) {\n  return (\n    <div className=\"rounded-3xl bg-gradient-to-r from-blue-600 to-blue-800 p-8 text-white shadow-lg\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <h1 className=\"text-2xl font-bold md:text-3xl\">{title}</h1>\n          {subtitle && <p className=\"mt-2 text-blue-100 opacity-90\">{subtitle}</p>}\n        </div>\n        {cta && <div className=\"flex-shrink-0\">{cta}</div>}\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "SidebarLayout.tsx",
              "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { signOut, useSession } from \"next-auth/react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport NotificationsBell from \"@/components/notifications/NotificationsBell\";\n\nimport {\n  HomeIcon,\n  UsersIcon,\n  ClipboardDocumentListIcon,\n  ClockIcon,\n  QrCodeIcon,\n  Bars3Icon,\n  XMarkIcon,\n} from \"@heroicons/react/24/outline\";\n\ninterface Props {\n  children: React.ReactNode;\n  title: string;\n  titlePage?: string;\n}\n\nexport default function SidebarLayout({ children, title, titlePage}: Props) {\n  const { data: session } = useSession();\n  const pathname = usePathname();\n  const [sidebarOpen, setSidebarOpen] = useState(false); // Start with false for mobile-first\n\n  const handleLinkClick = () => {\n    // Close sidebar on mobile after clicking a link\n    if (window.innerWidth < 768) {\n      setSidebarOpen(false);\n    }\n  };\n\n  // Define menu type\n  type MenuItem = {\n    label: string;\n    href: string;\n    icon: React.ComponentType<{ className?: string }>;\n  };\n\n  type MenuConfig = {\n    SUPER_ADMIN: MenuItem[];\n    REVIEWER: MenuItem[];\n    APPROVER: MenuItem[];\n    VENDOR: MenuItem[];\n    VERIFIER: MenuItem[];\n  };\n\n  const menuConfig: MenuConfig = {\n    SUPER_ADMIN: [\n      { label: \"Dashboard\", href: \"/super-admin\", icon: HomeIcon },\n      { label: \"Kelola User\", href: \"/super-admin/users\", icon: UsersIcon },\n    ],\n    REVIEWER: [\n      { label: \"Dashboard\", href: \"/reviewer\", icon: HomeIcon },\n      { label: \"Review Pengajuan\", href: \"/reviewer/submissions\", icon: ClipboardDocumentListIcon },\n      { label: \"Verifikasi User\", href: \"/reviewer/users\", icon: UsersIcon },\n      { label: \"Riwayat Scan\", href: \"/reviewer/scan-history\", icon: QrCodeIcon },\n    ],\n    APPROVER: [\n      { label: \"Dashboard\", href: \"/approver\", icon: HomeIcon },\n      { label: \"Persetujuan\", href: \"/approver/submissions\", icon: ClipboardDocumentListIcon },\n      { label: \"Riwayat Scan\", href: \"/approver/scan-history\", icon: QrCodeIcon },\n    ],\n    VENDOR: [\n      { label: \"Dashboard\", href: \"/vendor\", icon: HomeIcon },\n      { label: \"Pengajuan Simlok\", href: \"/vendor/submissions\", icon: ClipboardDocumentListIcon },\n    ],\n    VERIFIER: [\n      { label: \"Dashboard\", href: \"/verifier\", icon: HomeIcon },\n      { label: \"Riwayat Scan\", href: \"/verifier/history\", icon: ClockIcon },\n    ],\n  };\n\n  const userRole = session?.user?.role as keyof MenuConfig | undefined;\n  const menu = userRole ? menuConfig[userRole] : menuConfig.SUPER_ADMIN;\n\n  return (\n    <div className=\"flex h-screen bg-gray-50\">\n      {/* Mobile backdrop */}\n      {sidebarOpen && (\n        <div className=\"fixed inset-0 z-20 bg-black/30 md:hidden\" onClick={() => setSidebarOpen(false)} />\n      )}\n\n      {/* Sidebar */}\n      <aside\n        className={`fixed inset-y-0 left-0 z-30 h-full flex-col border-r border-slate-200 bg-white shadow-sm transition-all duration-300 ease-in-out md:relative md:flex ${\n          sidebarOpen ? \"flex w-64\" : \"hidden md:flex md:w-20\"\n        }`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-slate-200 px-4 py-4\">\n          {sidebarOpen && <h1 className=\"text-lg font-bold\">{title}</h1>}\n          <button\n            onClick={() => setSidebarOpen(!sidebarOpen)}\n            className={`rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${\n              sidebarOpen ? \"ml-auto md:ml-auto\" : \"mx-auto\"\n            }`}\n            aria-label=\"Toggle sidebar\"\n          >\n            {sidebarOpen ? <XMarkIcon className=\"h-6 w-6\" /> : <Bars3Icon className=\"h-6 w-6\" />}\n          </button>\n        </div>\n\n        {/* Navigation */}\n        <nav className=\"flex-1 space-y-2 px-2 py-6\">\n          {menu.map((item: MenuItem) => {\n            const active = pathname === item.href;\n            const Icon = item.icon;\n            return (\n              <Link\n                key={item.href}\n                href={item.href}\n                onClick={handleLinkClick}\n                title={item.label}\n                className={`group relative flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium outline-none transition-colors hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${\n                  active\n                    ? \"bg-blue-100 text-blue-700\"\n                    : \"text-slate-700\"\n                } ${!sidebarOpen ? \"justify-center\" : \"\"}`}\n              >\n                <Icon className=\"h-5 w-5 flex-shrink-0\" />\n                {sidebarOpen && <span>{item.label}</span>}\n              </Link>\n            );\n          })}\n        </nav>\n\n        {/* Profile & Logout */}\n        <div className=\"border-t border-slate-200 p-4\">\n          <Link \n            href=\"/profile\" \n            className={`mb-4 flex items-center gap-3 ${!sidebarOpen && \"justify-center\"} hover:bg-slate-100 p-2 rounded-md transition-colors`}\n            onClick={handleLinkClick}\n          >\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-slate-300 text-sm font-bold text-white\">\n              {session?.user.name?.charAt(0).toUpperCase()}\n            </div>\n            {sidebarOpen && (\n              <div>\n                <p className=\"truncate text-sm font-medium\">{session?.user.name}</p>\n              </div>\n            )}\n          </Link>\n          <button\n            onClick={() => signOut({ callbackUrl: \"/\" })}\n            className={`w-full rounded-md bg-red-600 py-2 text-sm font-medium text-white outline-none transition hover:bg-red-700 focus-visible:ring-2 focus-visible:ring-red-500 ${\n              !sidebarOpen ? \"px-0 flex justify-center\" : \"\"\n            }`}\n          >\n            {sidebarOpen ? \"Logout\" : <span className=\"text-xs\">⏻</span>}\n          </button>\n        </div>\n      </aside>\n\n      {/* Main wrapper */}\n      <div className={`flex min-w-0 flex-1 flex-col transition-all duration-300 ${\n        sidebarOpen ? \"md:ml-0\" : \"md:ml-0\"\n      }`}>\n        {/* Top bar */}\n        <header className=\"flex items-center justify-between border-b border-slate-200 px-3 py-3 bg-white md:px-6\">\n          <button\n            onClick={() => setSidebarOpen(true)}\n            className=\"rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 md:hidden\"\n            aria-label=\"Open sidebar\"\n          >\n            <Bars3Icon className=\"h-6 w-6\" />\n          </button>\n          <div className=\"text-xl font-semibold\">{titlePage}</div>\n          {session?.user?.role !== \"SUPER_ADMIN\" && (\n            <NotificationsBell />\n          )}\n        </header>\n\n        {/* Content area */}\n        <main className=\"min-h-0 flex-1 overflow-y-auto bg-gray-50 p-4 md:p-8 \">\n          <div className=\"mx-auto w-full max-w-7xl\">{children}</div>\n        </main>\n      </div>\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "notifications",
          "children": [
            {
              "type": "file",
              "name": "NotificationsBell.tsx",
              "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { BellIcon } from '@heroicons/react/24/outline';\nimport { useSession } from 'next-auth/react';\nimport { useNotificationsStore } from '../../store/notifications';\nimport { useRealTimeNotifications } from '../../hooks/useRealTimeNotifications';\nimport NotificationsPanel from './NotificationsPanel';\n\nexport default function NotificationsBell() {\n  const { data: session } = useSession();\n  const [isOpen, setIsOpen] = useState(false);\n  const { \n    items: notifications,\n    unreadCount,\n    setItems,\n    setUnreadCount,\n    setCursor,\n    setHasMore\n  } = useNotificationsStore();\n\n  // Enable real-time notifications via SSE\n  const { isConnected } = useRealTimeNotifications();\n\n  console.log('NotificationsBell - Current store state (v3-SSE):', { \n    notifications: notifications?.length, \n    unreadCount,\n    isConnected\n  });\n\n  // Load initial notifications and unread count\n  useEffect(() => {\n    if (session?.user) {\n      loadNotifications();\n    }\n  }, [session]);\n\n  // Sync unread count with store items changes\n  useEffect(() => {\n    if (notifications.length > 0) {\n      const calculatedUnreadCount = notifications.filter(n => !n.isRead).length;\n      if (calculatedUnreadCount !== unreadCount) {\n        setUnreadCount(calculatedUnreadCount);\n      }\n    }\n  }, [notifications, unreadCount, setUnreadCount]);\n\n  const loadNotifications = async () => {\n    if (!session?.user) return;\n\n    // Skip notifications for verifier role\n    if (session.user.role === 'VERIFIER') {\n      return;\n    }\n\n    try {\n      // Determine scope based on user role\n      let scope: string;\n      if ( session.user.role === 'SUPER_ADMIN') {\n        scope = 'admin';\n      } else if (session.user.role === 'REVIEWER') {\n        scope = 'reviewer';\n      } else if (session.user.role === 'APPROVER') {\n        scope = 'approver';\n      } else {\n        scope = 'vendor';\n      }\n\n      const params = new URLSearchParams({\n        scope,\n        limit: '20',\n        filter: 'all'  // Always get ALL notifications\n      });\n\n      // Add vendorId only for vendor scope\n      if (scope === 'vendor' && session.user.id) {\n        params.append('vendorId', session.user.id);\n      }\n\n      console.log('Loading notifications with params:', params.toString());\n      console.log('Using endpoint: /api/v1/notifications (Build: 2025-09-06-v3)');\n\n      const response = await fetch(`/api/v1/notifications?${params}`);\n      if (response.ok) {\n        const result = await response.json();\n        console.log('Notifications loaded:', result);\n        \n        // Extract notifications from nested data structure\n        const notifications = Array.isArray(result.data?.data) ? result.data.data : [];\n        console.log('NotificationsBell - About to setItems with:', notifications);\n        setItems(notifications);\n        \n        // Count unread notifications\n        const unreadCount = notifications.filter((n: any) => !n.isRead).length;\n        console.log('NotificationsBell - Setting unreadCount to:', unreadCount);\n        console.log('NotificationsBell - All notifications:', notifications.map((n: any) => ({ id: n.id, isRead: n.isRead, title: n.title })));\n        setUnreadCount(unreadCount);\n        \n        setCursor(result.data?.pagination?.nextCursor);\n        setHasMore(result.data?.pagination?.hasMore || false);\n      } else {\n        console.error('Failed to load notifications:', response.status, response.statusText);\n        const errorData = await response.json();\n        console.error('Error details:', errorData);\n      }\n    } catch (error) {\n      console.error('Error loading notifications:', error);\n    }\n  };\n\n  if (!session?.user) {\n    return null;\n  }\n\n  // Hide notification bell for verifiers as they don't receive notifications\n  if (session.user.role === 'VERIFIER') {\n    return null;\n  }\n\n  return (\n    <div className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`relative p-2 rounded-lg transition-all duration-200 ${\n          isOpen \n            ? 'bg-blue-50 text-blue-600' \n            : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'\n        }`}\n        aria-label=\"Notifications\"\n      >\n        <BellIcon className=\"h-6 w-6\" />\n        {unreadCount > 0 && (\n          <span className=\"absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5\">\n            {unreadCount > 99 ? '99+' : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {isOpen && (\n        <NotificationsPanel \n          onClose={() => setIsOpen(false)}\n        />\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "NotificationsPanel.tsx",
              "content": "// src/components/notifications/NotificationsPanel.tsx\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport {\n  BellIcon,\n  XMarkIcon,\n  CheckIcon,\n  CheckCircleIcon,\n  ClockIcon,\n  UserPlusIcon,\n  DocumentPlusIcon,\n  ShieldCheckIcon,\n  InboxIcon\n} from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\nimport SubmissionDetailModal from '../vendor/SubmissionDetailModal';\nimport ApproverSubmissionDetailModal from '../approver/ApproverSubmissionDetailModal';\nimport ReviewerSubmissionDetailModal from '../reviewer/ImprovedReviewerSubmissionDetailModal';\nimport ReviewerUserVerificationModal from '../reviewer/ReviewerUserVerificationModal';\nimport { UserData } from '@/types/user';\nimport { useToast } from '@/hooks/useToast';\n\nimport { useNotificationsStore, type Notification } from '../../store/notifications';\n\ninterface NotificationsPanelProps {\n  onClose: () => void;\n}\n\nexport default function NotificationsPanel({ onClose }: NotificationsPanelProps) {\n  const { data: session } = useSession();\n  const {\n    items: notifications,\n    unreadCount,\n    markAsRead,\n    markAllAsRead\n  } = useNotificationsStore();\n  const { showError, showWarning } = useToast();\n\n  // Helper scope & vendorId dari session\n  const getScopeAndVendor = () => {\n    if (!session?.user) return { scope: 'vendor' as const, vendorId: undefined as string | undefined };\n    const role = session.user.role;\n    if (role === 'SUPER_ADMIN') return { scope: 'admin' as const, vendorId: undefined };\n    if (role === 'APPROVER')    return { scope: 'approver' as const, vendorId: undefined };\n    if (role === 'REVIEWER')    return { scope: 'reviewer' as const, vendorId: undefined };\n    // VENDOR\n    return { scope: 'vendor' as const, vendorId: session.user.id };\n  };\n\n  const [selectedSubmission, setSelectedSubmission] = useState<any>(null);\n  const [selectedSubmissionId, setSelectedSubmissionId] = useState<string | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n\n  // State for vendor verification modal\n  const [selectedVendorUser, setSelectedVendorUser] = useState<UserData | null>(null);\n\n  // Close panel on ESC & lock scroll\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') onClose();\n    };\n    document.addEventListener('keydown', handleEscape);\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [onClose]);\n\n  const handleViewDetail = async (notification: Notification) => {\n    try {\n      // Vendor detail types\n      if (\n        notification.type === 'user_registered' ||\n        notification.type === 'new_vendor' ||\n        notification.type === 'new_user_verification'\n      ) {\n        await handleVendorDetail(notification);\n        return;\n      }\n\n      // Extract submissionId\n      let submissionId: string | null = null;\n      if (notification.data) {\n        try {\n          const parsed = typeof notification.data === 'string'\n            ? JSON.parse(notification.data)\n            : notification.data;\n          submissionId = parsed.submissionId || parsed.submission_id || null;\n        } catch {\n          // ignore\n        }\n      }\n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        submissionId =\n          notification.message.match(idPattern)?.[1] ||\n          notification.title.match(idPattern)?.[1] ||\n          null;\n      }\n      if (!submissionId) return;\n\n      // Endpoint by role\n      let apiEndpoint = `/api/submissions/${submissionId}`;\n      if (session?.user?.role === 'APPROVER') apiEndpoint = `/api/approver/simloks/${submissionId}`;\n      else if (session?.user?.role === 'REVIEWER') apiEndpoint = `/api/reviewer/simloks/${submissionId}`;\n      else if (session?.user?.role === 'SUPER_ADMIN') apiEndpoint = `/api/submissions/${submissionId}`;\n\n      const response = await fetch(apiEndpoint);\n      if (response.status === 404) {\n        showWarning('Pengajuan Tidak Ditemukan', 'Pengajuan pada notifikasi ini sudah tidak tersedia atau dihapus.');\n        if (!notification.isRead) {\n          try {\n            const { scope, vendorId } = getScopeAndVendor();\n            await markAsRead(notification.id, { scope, vendorId });\n          } catch {}\n        }\n        return;\n      }\n      if (!response.ok) throw new Error(`Failed to fetch submission details: ${response.status}`);\n      const payload = await response.json();\n      const submissionData = payload.submission || payload;\n\n      setSelectedSubmission(submissionData);\n      setSelectedSubmissionId(submissionId);\n      setIsDetailModalOpen(true);\n\n      if (!notification.isRead) {\n        try {\n          const { scope, vendorId } = getScopeAndVendor();\n          await markAsRead(notification.id, { scope, vendorId });\n        } catch {}\n      }\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('404')) {\n        showWarning('Pengajuan Tidak Ditemukan', 'Pengajuan pada notifikasi ini sudah tidak tersedia atau dihapus.');\n      } else {\n        showError('Gagal Memuat Detail', 'Terjadi kesalahan saat memuat detail pengajuan. Silakan coba lagi.');\n      }\n    }\n  };\n\n  const handleVendorDetail = async (notification: Notification) => {\n    try {\n      let vendorId: string | null = null;\n      if (notification.data) {\n        try {\n          const parsed = typeof notification.data === 'string'\n            ? JSON.parse(notification.data)\n            : notification.data;\n          vendorId = parsed.vendorId || parsed.userId || parsed.user_id || null;\n        } catch {}\n      }\n      if (!vendorId) return;\n\n      if (session?.user?.role === 'REVIEWER') {\n        const response = await fetch(`/api/reviewer/users/${vendorId}`);\n        if (response.status === 404) {\n          showWarning('Data Vendor Tidak Ditemukan', 'Data vendor pada notifikasi ini sudah tidak tersedia.');\n          return;\n        }\n        if (!response.ok) throw new Error(`HTTP ${response.status}`);\n        const data = await response.json();\n        setSelectedVendorUser(data.user);\n      } else {\n        showWarning('Info', 'Fitur detail vendor tidak tersedia untuk role ini.');\n      }\n\n      if (!notification.isRead) {\n        try {\n          const { scope, vendorId: vId } = getScopeAndVendor();\n          await markAsRead(notification.id, { scope, vendorId: vId });\n        } catch {}\n      }\n    } catch (err) {\n      showError('Gagal Memuat Detail Vendor', 'Gagal memuat detail vendor. Silakan coba lagi.');\n    }\n  };\n\n  const handleCloseDetailModal = () => {\n    setIsDetailModalOpen(false);\n    setSelectedSubmission(null);\n    setSelectedSubmissionId(null);\n  };\n\n  const formatTimeAgo = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diff = Math.floor((now.getTime() - date.getTime()) / 1000);\n    if (diff < 60) return 'Baru saja';\n    if (diff < 3600) return `${Math.floor(diff / 60)}m`;\n    if (diff < 86400) return `${Math.floor(diff / 3600)}j`;\n    if (diff < 604800) return `${Math.floor(diff / 86400)}h`;\n    return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });\n  };\n\n  const getNotificationIcon = (type: string) => {\n    const iconClass = 'w-5 h-5';\n    switch (type) {\n      case 'submission_approved':\n        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'submission_rejected':\n        return <XMarkIcon className={`${iconClass} text-red-500`} />;\n      case 'submission_pending':\n        return <ClockIcon className={`${iconClass} text-amber-500`} />;\n      case 'status_change':\n        return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_submission':\n        return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'user_registered':\n      case 'new_vendor':\n      case 'new_user_verification':\n        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      default:\n        return <BellIcon className={`${iconClass} text-gray-500`} />;\n    }\n  };\n\n  const truncateText = (text: string, maxLength = 80) =>\n    text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n\n  const getEnhancedMessage = (notification: Notification) => {\n    const { type, message, title } = notification;\n    switch (type) {\n      case 'submission_approved':\n        return {\n          title: 'Pengajuan Disetujui',\n          message: truncateText('Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.'),\n          action: 'Lihat detail'\n        };\n      case 'submission_rejected':\n        return {\n          title: 'Pengajuan Ditolak',\n          message: truncateText('Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.'),\n          action: 'Lihat detail'\n        };\n      case 'submission_pending':\n        return {\n          title: 'Status Pending',\n          message: truncateText('Pengajuan Simlok Anda sedang dalam proses review lebih lanjut.'),\n          action: 'Lihat detail'\n        };\n      case 'status_change': {\n        let enhancedTitle = title;\n        let enhancedMessage = message;\n        if (title.includes('Disetujui')) {\n          enhancedTitle = 'Pengajuan Disetujui';\n          enhancedMessage = 'Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.';\n        } else if (title.includes('Ditolak')) {\n          enhancedTitle = 'Pengajuan Ditolak';\n          enhancedMessage = 'Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.';\n        }\n        return {\n          title: truncateText(enhancedTitle, 50),\n          message: truncateText(enhancedMessage),\n          action: 'Lihat detail'\n        };\n      }\n      case 'new_submission':\n        return {\n          title: 'Pengajuan Baru Masuk',\n          message: truncateText(message.replace('Pengajuan baru dari', 'Pengajuan Simlok baru dari')),\n          action: 'Lihat detail'\n        };\n      case 'user_registered':\n      case 'new_vendor':\n      case 'new_user_verification':\n        return {\n          title: 'User Baru Perlu Verifikasi',\n          message: truncateText(message.replace('User baru terdaftar', 'User baru mendaftar dan perlu verifikasi')),\n          action: 'Lihat detail'\n        };\n      default:\n        return {\n          title: truncateText(title, 50),\n          message: truncateText(message),\n          action: 'Lihat detail'\n        };\n    }\n  };\n\n  const hasSubmissionData = (notification: Notification) => {\n    if (\n      notification.type === 'user_registered' ||\n      notification.type === 'new_vendor' ||\n      notification.type === 'new_user_verification'\n    ) {\n      return true;\n    }\n    const hasSubmissionType = notification.type.includes('submission') || notification.type === 'status_change';\n    let hasSubmissionId = false;\n    if (notification.data) {\n      if (typeof notification.data === 'string') {\n        hasSubmissionId = notification.data.includes('submissionId');\n      } else if (typeof notification.data === 'object') {\n        hasSubmissionId =\n          (notification.data as any).submissionId || (notification.data as any).submission_id;\n      }\n    }\n    const hasIdInMessage = notification.message.includes('ID');\n    const hasIdInTitle = notification.title.includes('ID');\n    return hasSubmissionType || hasSubmissionId || hasIdInMessage || hasIdInTitle;\n  };\n\n  if (!notifications) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div className=\"fixed inset-0 z-40\" onClick={onClose} />\n\n      {/* Floating Panel */}\n      <div\n        className=\"absolute right-0 top-12 w-[90vw] md:w-[420px] bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-[70vh] flex flex-col overflow-hidden\"\n        role=\"dialog\"\n        aria-label=\"Panel notifikasi\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0 bg-gray-50/50\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"relative\">\n              <BellIcon className=\"w-5 h-5 text-gray-700\" />\n              {unreadCount > 0 && (\n                <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center\">\n                  <span className=\"text-[10px] font-semibold\">{unreadCount > 9 ? '9+' : unreadCount}</span>\n                </div>\n              )}\n            </div>\n            <div>\n              <h3 className=\"text-sm font-semibold text-gray-900\">Notifikasi</h3>\n              {unreadCount > 0 && <p className=\"text-xs text-gray-500\">{unreadCount} belum dibaca</p>}\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            {unreadCount > 0 && (\n              <Button\n                onClick={async () => {\n                  try {\n                    const { scope, vendorId } = getScopeAndVendor();\n                    await markAllAsRead({ scope, vendorId });\n                  } catch (error) {\n                    console.error('Error marking all notifications as read:', error);\n                  }\n                }}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-xs px-3 py-1.5 hover:bg-blue-50 hover:border-blue-300 transition-colors\"\n              >\n                <CheckIcon className=\"w-3 h-3 mr-1\" />\n                Tandai Semua\n              </Button>\n            )}\n            <button\n              onClick={onClose}\n              className=\"p-1.5 hover:bg-gray-100 rounded-md transition-colors\"\n              aria-label=\"Tutup panel\"\n            >\n              <XMarkIcon className=\"w-4 h-4 text-gray-500 hover:text-gray-700\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto\" role=\"list\" aria-label=\"Daftar notifikasi\">\n          {!notifications || notifications.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 px-6\">\n              <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                <InboxIcon className=\"w-8 h-8 text-gray-400\" />\n              </div>\n              <h4 className=\"text-sm font-medium text-gray-900 mb-2\">Tidak ada notifikasi</h4>\n              <p className=\"text-xs text-gray-500 text-center leading-relaxed\">\n                Anda akan melihat notifikasi baru di sini ketika ada aktivitas\n              </p>\n            </div>\n          ) : (\n            <div className=\"divide-y divide-gray-100\">\n              {Array.isArray(notifications) && notifications.slice(0, 10).map((notification) => {\n                const enhancedInfo = getEnhancedMessage(notification);\n                const isUnread = !notification.isRead;\n                const fullTimestamp = new Date(notification.createdAt).toLocaleString('id-ID');\n\n                return (\n                  <div\n                    key={`notification-${notification.id}-${notification.createdAt}`}\n                    role=\"listitem\"\n                    className={`group relative transition-all duration-200 hover:bg-gray-50\n  border-l-4\n  ${isUnread ? 'border-l-blue-600 bg-white' : 'border-l-transparent bg-white'}\n  ${hasSubmissionData(notification) ? 'cursor-pointer' : ''}\n`}\n\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      if (hasSubmissionData(notification)) {\n                        handleViewDetail(notification);\n                      }\n                    }}\n                  >\n                    <div className=\"p-3 pl-7\">\n                      <div className=\"flex items-start space-x-3\">\n                        <div className=\"flex-shrink-0\">\n                          {/* Netral: selalu abu-abu agar tidak ada highlight biru lain */}\n                          <div className=\"w-9 h-9 rounded-full flex items-center justify-center transition-colors bg-gray-100\">\n                            {getNotificationIcon(notification.type)}\n                          </div>\n                        </div>\n\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-start justify-between mb-1\">\n                            <h4\n                              className={`text-sm leading-tight ${\n                                isUnread ? 'font-semibold text-gray-900' : 'font-medium text-gray-800'\n                              }`}\n                              style={{\n                                lineClamp: 2,\n                                WebkitLineClamp: 2,\n                                display: '-webkit-box',\n                                WebkitBoxOrient: 'vertical',\n                                overflow: 'hidden'\n                              }}\n                            >\n                              {enhancedInfo.title}\n                            </h4>\n                            <span className=\"text-[11px] text-gray-500 whitespace-nowrap ml-2\" title={fullTimestamp}>\n                              {formatTimeAgo(notification.createdAt)}\n                            </span>\n                          </div>\n\n                          <p\n                            className=\"text-xs text-gray-600 leading-relaxed mb-2\"\n                            style={{\n                              lineClamp: 2,\n                              WebkitLineClamp: 2,\n                              display: '-webkit-box',\n                              WebkitBoxOrient: 'vertical',\n                              overflow: 'hidden'\n                            }}\n                          >\n                            {enhancedInfo.message}\n                          </p>\n\n                          <div className=\"flex items-center justify-between\">\n                            {hasSubmissionData(notification) && (\n                              <button className=\"inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors\">\n                                {enhancedInfo.action}\n                              </button>\n                            )}\n\n                            {isUnread && (\n                              <button\n                                onClick={async (e) => {\n                                  e.preventDefault();\n                                  e.stopPropagation();\n                                  try {\n                                    const { scope, vendorId } = getScopeAndVendor();\n                                    await markAsRead(notification.id, { scope, vendorId });\n                                  } catch (error) {\n                                    console.error('Error marking notification as read:', error);\n                                  }\n                                }}\n                                className=\"inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors\"\n                                aria-label=\"Tandai sebagai dibaca\"\n                              >\n                                <CheckIcon className=\"w-3 h-3 mr-1\" />\n                                Tandai dibaca\n                              </button>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        {notifications.length > 0 && (\n          <div className=\"border-t border-gray-200 p-3 flex-shrink-0 bg-gray-50/30\">\n            <div className=\"flex items-center justify-between text-xs\">\n              <span className=\"text-gray-500\">\n                {Math.min(notifications.length, 10)} dari {notifications.length}\n              </span>\n              {!!notifications.length && (\n                <a\n                  href=\"/dashboard/notifications\"\n                  className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium hover:underline transition-colors\"\n                  onClick={onClose}\n                >\n                  Lihat semua →\n                </a>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Modal Detail Submission */}\n      {selectedSubmission && selectedSubmissionId && (\n        <>\n          {session?.user?.role === 'APPROVER' && (\n            <ApproverSubmissionDetailModal\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n              submissionId={selectedSubmissionId}\n              onApprovalSubmitted={() => {\n                handleCloseDetailModal();\n              }}\n            />\n          )}\n\n          {session?.user?.role === 'REVIEWER' && (\n            <ReviewerSubmissionDetailModal\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n              submissionId={selectedSubmissionId}\n              onReviewSubmitted={() => {\n                handleCloseDetailModal();\n              }}\n            />\n          )}\n\n          {(session?.user?.role === 'SUPER_ADMIN' || session?.user?.role === 'VENDOR') && (\n            <SubmissionDetailModal\n              submission={selectedSubmission}\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n            />\n          )}\n        </>\n      )}\n\n      {/* User Verification Modal for Vendor Details */}\n      {selectedVendorUser && (\n        <>\n          {session?.user?.role === 'REVIEWER' ? (\n            <ReviewerUserVerificationModal\n              isOpen={!!selectedVendorUser}\n              onClose={() => {\n                setSelectedVendorUser(null);\n              }}\n              user={selectedVendorUser}\n              onUserUpdate={(updatedUser: UserData) => {\n                setSelectedVendorUser(updatedUser);\n              }}\n            />\n          ) : (\n            <div />\n          )}\n        </>\n      )}\n    </>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "reviewer",
          "children": [
            {
              "type": "file",
              "name": "ExportFilterModal.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  XMarkIcon,\n  ArrowDownTrayIcon,\n  CalendarDaysIcon,\n} from \"@heroicons/react/24/outline\";\nimport Button from '@/components/ui/button/Button';\nimport DatePicker from '@/components/form/DatePicker';\n\ninterface ExportFilterModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onExport: (filters: ExportFilters) => void;\n  currentFilters: ExportFilters;\n  exportLoading: boolean;\n}\n\nexport interface ExportFilters {\n  search: string;\n  reviewStatus: string;\n  finalStatus: string;\n  startDate: string;\n  endDate: string;\n}\n\nexport default function ExportFilterModal({\n  isOpen,\n  onClose,\n  onExport,\n  currentFilters,\n  exportLoading\n}: ExportFilterModalProps) {\n  const [startDate, setStartDate] = useState<string>('');\n  const [endDate, setEndDate] = useState<string>('');\n\n  // Reset dates when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setStartDate('');\n      setEndDate('');\n    }\n  }, [isOpen]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // Include current page filters but only use dates from modal\n    onExport({\n      search: currentFilters.search,\n      reviewStatus: currentFilters.reviewStatus,\n      finalStatus: currentFilters.finalStatus,\n      startDate: startDate,\n      endDate: endDate\n    });\n  };\n\n  const handleReset = () => {\n    setStartDate('');\n    setEndDate('');\n  };\n\n  const hasDateFilter = startDate || endDate;\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-md\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\n              <ArrowDownTrayIcon className=\"h-5 w-5 text-green-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Export ke Excel</h2>\n              <p className=\"text-sm text-gray-500\">Pilih rentang tanggal untuk export</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            disabled={exportLoading}\n          >\n            <XMarkIcon className=\"h-5 w-5 text-gray-500\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit}>\n          {/* Content */}\n          <div className=\"p-6 space-y-4\">\n            {/* Date Range */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                <CalendarDaysIcon className=\"h-4 w-4 inline mr-1\" />\n                Filter Rentang Tanggal (Opsional)\n              </label>\n              <div className=\"space-y-3\">\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-600 mb-1\">\n                    Tanggal Mulai\n                  </label>\n                  <DatePicker\n                    value={startDate}\n                    onChange={(value) => setStartDate(value)}\n                    placeholder=\"Pilih tanggal mulai\"\n                    className=\"border-gray-300 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs font-medium text-gray-600 mb-1\">\n                    Tanggal Akhir\n                  </label>\n                  <DatePicker\n                    value={endDate}\n                    onChange={(value) => setEndDate(value)}\n                    placeholder=\"Pilih tanggal akhir\"\n                    className=\"border-gray-300 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2\">\n                Kosongkan kedua field untuk export semua data\n              </p>\n            </div>\n\n            {/* Info Summary */}\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n              <div className=\"text-sm text-blue-800\">\n                {hasDateFilter ? (\n                  <div>\n                    <div className=\"font-medium mb-1\">Export dengan filter:</div>\n                    <div>\n                      📅 Tanggal: {\n                        startDate && endDate \n                          ? `${new Date(startDate).toLocaleDateString('id-ID')} - ${new Date(endDate).toLocaleDateString('id-ID')}`\n                          : startDate\n                          ? `Dari ${new Date(startDate).toLocaleDateString('id-ID')}`\n                          : `Sampai ${new Date(endDate).toLocaleDateString('id-ID')}`\n                      }\n                    </div>\n                  </div>\n                ) : (\n                  <div>\n                    <div className=\"font-medium\">Export data SIMLOK ke Excel</div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-6 border-t border-gray-200 bg-gray-50\">\n            <div className=\"flex gap-3 justify-end\">\n              {hasDateFilter && (\n                <Button\n                  type=\"button\"\n                  onClick={handleReset}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  disabled={exportLoading}\n                  className=\"text-gray-600 border-gray-300 hover:bg-gray-50\"\n                >\n                  Reset Tanggal\n                </Button>\n              )}\n              <Button\n                type=\"button\"\n                onClick={onClose}\n                variant=\"outline\"\n                disabled={exportLoading}\n              >\n                Batal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={exportLoading}\n                className=\"bg-green-600 hover:bg-green-700 text-white\"\n              >\n                <ArrowDownTrayIcon className=\"h-4 w-4 mr-2\" />\n                {exportLoading ? 'Mengekspor...' : 'Export Excel'}\n              </Button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "ImprovedReviewerSubmissionDetailModal.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport {\n  XMarkIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  DocumentTextIcon,\n  UserGroupIcon,\n  CalendarIcon,\n  ArrowRightIcon,\n  PencilIcon,\n  TrashIcon,\n  PlusIcon,\n  BuildingOfficeIcon,\n  UserIcon,\n  BriefcaseIcon,\n  DocumentIcon,\n  EyeIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport DatePicker from '@/components/form/DatePicker';\n\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport DetailSection from '@/components/common/DetailSection';\nimport InfoCard from '@/components/common/InfoCard';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport { useImplementationDates } from '@/hooks/useImplementationDates';\n\n// Types\ninterface WorkerPhoto {\n  id: string;\n  worker_name: string;\n  worker_photo: string;\n  created_at: string;\n}\n\ninterface SubmissionDetail {\n  id: string;\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  officer_email?: string;\n  job_description: string;\n  work_location: string;\n  implementation: string;\n  working_hours: string;\n  other_notes: string;\n  work_facilities: string;\n  worker_count: number | null;\n  simja_number: string;\n  simja_date: string | null;\n  simja_document_upload?: string | null;\n  sika_number: string;\n  sika_date: string | null;\n  sika_document_upload?: string | null;\n  simlok_number: string | null;\n  simlok_date: string | null;\n  implementation_start_date: string | null;\n  implementation_end_date: string | null;\n  worker_names: string;\n  content: string;\n  notes: string;\n\n  signer_position: string;\n  signer_name: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  review_note: string;\n  reviewed_by_name?: string;\n  reviewed_by_email?: string;\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  final_note: string;\n  approved_by_name?: string;\n  approved_by_email?: string;\n  created_at: string;\n  reviewed_at: string;\n  approved_at: string;\n  worker_list: WorkerPhoto[];\n}\n\n// Date Range Component\ninterface DateRange {\n  startDate: string;\n  endDate: string;\n}\n\ninterface ImprovedDateRangePickerProps {\n  value: DateRange;\n  onChange: (value: DateRange) => void;\n  disabled?: boolean;\n  className?: string;\n}\n\nconst ImprovedDateRangePicker: React.FC<ImprovedDateRangePickerProps> = ({\n  value,\n  onChange,\n  disabled = false,\n  className = ''\n}) => {\n  const [localRange, setLocalRange] = useState<DateRange>(value);\n  const [errors, setErrors] = useState<{ start?: string; end?: string }>({});\n\n  // Sync with external value\n  useEffect(() => {\n    setLocalRange(value);\n  }, [value]);\n\n  // Validate date range\n  const validateRange = useCallback((range: DateRange) => {\n    const newErrors: { start?: string; end?: string } = {};\n\n    if (range.startDate && range.endDate) {\n      const startDate = new Date(range.startDate);\n      const endDate = new Date(range.endDate);\n\n      if (endDate < startDate) {\n        newErrors.end = 'Tanggal selesai harus setelah tanggal mulai';\n      }\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  }, []);\n\n  // Handle start date change\n  const handleStartChange = useCallback((startDate: string) => {\n    const newRange = { ...localRange, startDate };\n    setLocalRange(newRange);\n\n    if (validateRange(newRange)) {\n      onChange(newRange);\n    }\n  }, [localRange, onChange, validateRange]);\n\n  // Handle end date change\n  const handleEndChange = useCallback((endDate: string) => {\n    const newRange = { ...localRange, endDate };\n    setLocalRange(newRange);\n\n    if (validateRange(newRange)) {\n      onChange(newRange);\n    }\n  }, [localRange, onChange, validateRange]);\n\n  // Calculate duration\n  const getDuration = useCallback((): number | null => {\n    if (!localRange.startDate || !localRange.endDate) return null;\n\n    try {\n      const start = new Date(localRange.startDate);\n      const end = new Date(localRange.endDate);\n\n      if (isNaN(start.getTime()) || isNaN(end.getTime())) return null;\n\n      const diffTime = end.getTime() - start.getTime();\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n    } catch {\n      return null;\n    }\n  }, [localRange]);\n\n  const duration = getDuration();\n  const hasValidRange = localRange.startDate && localRange.endDate && Object.keys(errors).length === 0;\n\n  return (\n    <div className={`relative ${className}`} style={{ overflow: 'visible' }}>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div className=\"relative\" style={{ zIndex: 20 }}>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Tanggal Mulai Pelaksanaan\n          </label>\n          <DatePicker\n            value={localRange.startDate}\n            onChange={handleStartChange}\n            disabled={disabled}\n            placeholder=\"Pilih tanggal mulai\"\n            className=\"w-full relative\"\n          />\n          {errors.start && (\n            <div className=\"mt-1 text-sm text-red-600\">{errors.start}</div>\n          )}\n        </div>\n\n        <div className=\"relative\" style={{ zIndex: 20 }}>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Tanggal Selesai Pelaksanaan\n          </label>\n          <DatePicker\n            value={localRange.endDate}\n            onChange={handleEndChange}\n            disabled={disabled}\n            placeholder=\"Pilih tanggal selesai\"\n            className=\"w-full relative\"\n          />\n          {errors.end && (\n            <div className=\"mt-1 text-sm text-red-600\">{errors.end}</div>\n          )}\n        </div>\n      </div>\n\n      {hasValidRange && (\n        <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center text-sm text-blue-800\">\n              <CalendarIcon className=\"h-4 w-4 mr-2\" />\n              <span className=\"font-medium\">Periode Pelaksanaan:</span>\n            </div>\n            {duration && (\n              <div className=\"text-sm font-medium text-blue-700 bg-blue-100 px-2 py-1 rounded\">\n                {duration} hari\n              </div>\n            )}\n          </div>\n          <div className=\"mt-2 text-sm text-blue-700\">\n            <div className=\"flex items-center\">\n              <span className=\"font-medium\">\n                {localRange.startDate ? new Date(localRange.startDate).toLocaleDateString('id-ID') : ''}\n              </span>\n              <ArrowRightIcon className=\"h-4 w-4 mx-2 text-blue-500\" />\n              <span className=\"font-medium\">\n                {localRange.endDate ? new Date(localRange.endDate).toLocaleDateString('id-ID') : ''}\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n\n\n// Helper functions for status badges\nconst getReviewStatusBadge = (status: string) => {\n  switch (status) {\n    case 'PENDING_REVIEW':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200\">\n          <CalendarIcon className=\"w-3 h-3 mr-1\" />\n          Menunggu Review\n        </span>\n      );\n    case 'MEETS_REQUIREMENTS':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200\">\n          <CheckCircleIcon className=\"w-3 h-3 mr-1\" />\n          Sesuai Persyaratan\n        </span>\n      );\n    case 'NOT_MEETS_REQUIREMENTS':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200\">\n          <XCircleIcon className=\"w-3 h-3 mr-1\" />\n          Tidak Sesuai\n        </span>\n      );\n    default:\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200\">\n          Status Tidak Diketahui\n        </span>\n      );\n  }\n};\n\nconst getFinalStatusBadge = (status: string) => {\n  switch (status) {\n    case 'PENDING_APPROVAL':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200\">\n          <CalendarIcon className=\"w-3 h-3 mr-1\" />\n          Menunggu Persetujuan\n        </span>\n      );\n    case 'APPROVED':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200\">\n          <CheckCircleIcon className=\"w-3 h-3 mr-1\" />\n          Disetujui\n        </span>\n      );\n    case 'REJECTED':\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200\">\n          <XCircleIcon className=\"w-3 h-3 mr-1\" />\n          Ditolak\n        </span>\n      );\n    default:\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200\">\n          Status Tidak Diketahui\n        </span>\n      );\n  }\n};\n\n// Main Component Props\ninterface ReviewerSubmissionDetailModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  onReviewSubmitted: () => void;\n}\n\nconst ImprovedReviewerSubmissionDetailModal: React.FC<ReviewerSubmissionDetailModalProps> = ({\n  isOpen,\n  onClose,\n  submissionId,\n  onReviewSubmitted,\n}) => {\n  // State management\n  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'review'>('details');\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n\n  // Document preview modal state\n  const [previewModal, setPreviewModal] = useState<{\n    isOpen: boolean;\n    fileUrl: string;\n    fileName: string;\n  }>({\n    isOpen: false,\n    fileUrl: '',\n    fileName: ''\n  });\n\n  // Worker editing states\n  const [isEditingWorkers, setIsEditingWorkers] = useState(false);\n  const [editableWorkers, setEditableWorkers] = useState<WorkerPhoto[]>([]);\n  const [workersToDelete, setWorkersToDelete] = useState<string[]>([]);\n  const [editableWorkerCount, setEditableWorkerCount] = useState(0);\n  const [workerCountInput, setWorkerCountInput] = useState('0');\n  const [savingWorkers, setSavingWorkers] = useState(false);\n\n  // Form states\n\n\n  const [reviewData, setReviewData] = useState({\n    review_status: '' as 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS' | '',\n    review_note: '',\n    final_note: ''\n  });\n\n  const [approvalForm, setApprovalForm] = useState({\n    content: '',\n    pelaksanaan: '',\n    jabatan_signer: 'Sr Officer Security III',\n    nama_signer: 'Julianto Santoso'\n  });\n\n  const { showSuccess, showError } = useToast();\n\n  // Helper function to format date for Indonesian locale\n  const formatDate = useCallback((dateStr: string | Date) => {\n    if (!dateStr) return '';\n    try {\n      const date = new Date(dateStr);\n      return date.toLocaleDateString('id-ID', {\n        day: 'numeric',\n        month: 'long',\n        year: 'numeric'\n      });\n    } catch {\n      return '';\n    }\n  }, []);\n\n  // Handle file preview\n  const handleFileView = useCallback((fileUrl: string, fileName: string) => {\n    if (fileUrl) {\n      // Convert legacy URL to new format if needed\n      const convertedUrl = fileUrlHelper.convertLegacyUrl(fileUrl, fileName);\n      setPreviewModal({\n        isOpen: true,\n        fileUrl: convertedUrl,\n        fileName\n      });\n    }\n  }, []);\n\n  // Close file preview modal\n  const handleClosePreview = useCallback(() => {\n    setPreviewModal({\n      isOpen: false,\n      fileUrl: '',\n      fileName: ''\n    });\n  }, []);\n\n  // Use the improved implementation dates hook with stable dependencies\n  const implementationDatesHook = useImplementationDates({\n    simjaNumber: submission?.simja_number ?? '',\n    simjaDate: submission?.simja_date ?? '',\n    sikaNumber: submission?.sika_number ?? '',\n    sikaDate: submission?.sika_date ?? '',\n    signerPosition: approvalForm.jabatan_signer ?? 'Sr Officer Security III'\n  });\n\n  // Auto-fill pelaksanaan when implementation dates are set with correct template\n  useEffect(() => {\n    if (implementationDatesHook.dates.startDate && implementationDatesHook.dates.endDate) {\n      const pelaksanaanTemplate = `Terhitung mulai tanggal ${formatDate(implementationDatesHook.dates.startDate)} sampai ${formatDate(implementationDatesHook.dates.endDate)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;\n\n      setApprovalForm(prev => ({\n        ...prev,\n        pelaksanaan: pelaksanaanTemplate\n      }));\n    }\n  }, [implementationDatesHook.dates.startDate, implementationDatesHook.dates.endDate, formatDate]);\n\n\n\n  // Initialize editable workers when submission changes\n  useEffect(() => {\n    if (submission?.worker_list) {\n      setEditableWorkers([...submission.worker_list]);\n      setWorkersToDelete([]);\n      const count = submission.worker_count || submission.worker_list.length;\n      setEditableWorkerCount(count);\n      setWorkerCountInput(count.toString());\n    }\n  }, [submission?.worker_list, submission?.worker_count]);\n\n\n\n  // Sync input with worker count changes\n  useEffect(() => {\n    if (!isEditingWorkers) {\n      setWorkerCountInput(editableWorkerCount.toString());\n    }\n  }, [editableWorkerCount, isEditingWorkers]);\n\n  // Auto-sync worker count when workers are added/removed during editing\n  useEffect(() => {\n    if (isEditingWorkers) {\n      // Only auto-sync when workers are actually added or removed\n      // Don't force input changes when user manually changes count\n      // This allows user to freely edit the input without interference\n    }\n  }, [editableWorkers.length, isEditingWorkers]);\n\n  // Fetch submission details\n  const fetchSubmissionDetail = useCallback(async () => {\n    if (!submissionId || !isOpen) return;\n\n    console.log('[Modal] Fetching submission detail for:', submissionId);\n\n    try {\n      setLoading(true);\n\n      // Add abort controller to prevent multiple simultaneous requests\n      const controller = new AbortController();\n\n      const response = await fetch(`/api/reviewer/simloks/${submissionId}`, {\n        signal: controller.signal\n      });\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');\n          onClose();\n          // Add delay before refreshing so user can see the error message\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n          return;\n        }\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      const sub = data.submission;\n      setSubmission(sub);\n\n      setReviewData({\n        review_status: sub.review_status === 'PENDING_REVIEW' ? '' : sub.review_status,\n        review_note: sub.review_note || '',\n        final_note: sub.final_note || ''\n      });\n\n      setApprovalForm({\n        content: sub.content || 'Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.',\n        pelaksanaan: sub.implementation || '',\n        jabatan_signer: sub.signer_position || 'Sr Officer Security III',\n        nama_signer: sub.signer_name || 'Julianto Santoso'\n      });\n\n    } catch (err: any) {\n      console.error('Error fetching submission:', err);\n      if (err.name !== 'AbortError') {\n        showError('Error', err.message || 'Gagal memuat detail pengajuan');\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [submissionId, isOpen, showError]);\n\n  // Fetch scan history\n  const fetchScanHistory = useCallback(async () => {\n    if (!submissionId || !isOpen) return;\n\n    console.log('[Modal] Fetching scan history for:', submissionId);\n\n    try {\n      const controller = new AbortController();\n\n      const response = await fetch(`/api/submissions/${submissionId}/scans`, {\n        signal: controller.signal\n      });\n\n      if (response.ok) {\n        await response.json();\n        // Scan history loaded successfully\n      } else if (response.status !== 404) {\n        console.warn('Failed to fetch scan history:', response.statusText);\n      }\n    } catch (err: any) {\n      if (err.name !== 'AbortError') {\n        console.error('Error fetching scan history:', err);\n      }\n    }\n  }, [submissionId, isOpen]);\n\n  // Handle review submission\n  const handleSubmitReview = useCallback(async () => {\n    if (!reviewData.review_status) {\n      showError('Error', 'Pilih status review terlebih dahulu');\n      return;\n    }\n\n    if (!reviewData.review_note.trim()) {\n      showError('Error', 'Catatan review wajib diisi');\n      return;\n    }\n\n    if (!reviewData.final_note.trim()) {\n      showError('Error', 'Catatan untuk vendor wajib diisi');\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      // 1. Save implementation dates and template data\n      const updatePayload = {\n        implementation_start_date: implementationDatesHook.dates.startDate,\n        implementation_end_date: implementationDatesHook.dates.endDate,\n        implementation: approvalForm.pelaksanaan,\n        content: approvalForm.content,\n        signer_position: approvalForm.jabatan_signer,\n        signer_name: approvalForm.nama_signer,\n        // Preserve SIMJA and SIKA dates to prevent them from being lost\n        simja_number: submission?.simja_number,\n        simja_date: submission?.simja_date,\n        sika_number: submission?.sika_number,\n        sika_date: submission?.sika_date,\n        // Preserve worker count to prevent it from being reset\n        worker_count: editableWorkerCount\n      };\n\n      const saveResponse = await fetch(`/api/reviewer/simloks/${submissionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updatePayload),\n      });\n\n      if (!saveResponse.ok) {\n        if (saveResponse.status === 404) {\n          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');\n          onClose();\n          // Add delay before refreshing so user can see the error message\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n          return;\n        }\n        throw new Error('Gagal menyimpan template approval');\n      }\n\n      // 2. Submit review\n      const reviewResponse = await fetch(`/api/reviewer/simloks/${submissionId}/review`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(reviewData),\n      });\n\n      if (!reviewResponse.ok) {\n        if (reviewResponse.status === 404) {\n          showError('Pengajuan Tidak Ditemukan', 'Pengajuan sudah dihapus oleh vendor');\n          onClose();\n          // Add delay before refreshing so user can see the error message\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n          return;\n        }\n        const errorData = await reviewResponse.json();\n        throw new Error(errorData.error || 'Gagal mengirim review');\n      }\n\n      const data = await reviewResponse.json();\n      setSubmission(data.submission);\n      showSuccess('Berhasil', 'Review berhasil dikirim dan template approval tersimpan');\n      onReviewSubmitted();\n\n    } catch (err: any) {\n      console.error('Error submitting review:', err);\n      showError('Error', err.message || 'Gagal mengirim review');\n    } finally {\n      setSaving(false);\n    }\n  }, [\n    submissionId,\n    reviewData,\n    implementationDatesHook.dates.startDate,\n    implementationDatesHook.dates.endDate,\n    implementationDatesHook.template.pelaksanaan,\n    implementationDatesHook.template.lainLain,\n    approvalForm,\n    showSuccess,\n    showError,\n    onReviewSubmitted\n  ]);\n\n  // Effects with debouncing to prevent duplicate calls\n  useEffect(() => {\n    if (!isOpen || !submissionId) {\n      return;\n    }\n\n    // Reset states when opening\n    setActiveTab('details');\n    setLoading(true);\n\n    // Debounce the fetch calls\n    const timeoutId = setTimeout(() => {\n      fetchSubmissionDetail();\n      fetchScanHistory();\n    }, 100);\n\n    return () => {\n      clearTimeout(timeoutId);\n    };\n  }, [isOpen, submissionId]); // Removed function dependencies to prevent infinite loops\n\n  // Initialize dates when submission data is loaded\n  useEffect(() => {\n    if (submission?.implementation_start_date && submission?.implementation_end_date) {\n      implementationDatesHook.updateDates({\n        startDate: new Date(submission.implementation_start_date).toISOString().split('T')[0] || '',\n        endDate: new Date(submission.implementation_end_date).toISOString().split('T')[0] || ''\n      });\n    }\n  }, [submission?.implementation_start_date, submission?.implementation_end_date]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      // Cleanup with delay to prevent rendering issues\n      const timeoutId = setTimeout(() => {\n        setSubmission(null);\n        setLoading(false);\n        setSaving(false);\n        setIsPdfModalOpen(false);\n        setActiveTab('details');\n        setReviewData({\n          review_status: '',\n          review_note: '',\n          final_note: ''\n        });\n        setApprovalForm({\n          content: '',\n          pelaksanaan: '',\n          jabatan_signer: 'Sr Officer Security III',\n          nama_signer: 'Julianto Santoso'\n        });\n        implementationDatesHook.reset();\n      }, 50);\n\n      return () => clearTimeout(timeoutId);\n    }\n\n    return undefined;\n  }, [isOpen]);\n\n  // Worker management functions\n  const addWorker = () => {\n    const newWorker: WorkerPhoto = {\n      id: `temp_${Date.now()}`,\n      worker_name: '',\n      worker_photo: '',\n      created_at: new Date().toISOString(),\n    };\n    setEditableWorkers(prev => [...prev, newWorker]);\n  };\n\n  const removeWorker = (workerId: string) => {\n    // If it's a new temp worker, remove it immediately\n    if (workerId.startsWith('temp_')) {\n      setEditableWorkers(prev => prev.filter(w => w.id !== workerId));\n    } else {\n      // For existing workers, mark for deletion and hide from UI\n      setWorkersToDelete(prev => [...prev, workerId]);\n      setEditableWorkers(prev => prev.filter(w => w.id !== workerId));\n    }\n  };\n\n  const updateWorkerName = (workerId: string, name: string) => {\n    setEditableWorkers(prev =>\n      prev.map(w => w.id === workerId ? { ...w, worker_name: name } : w)\n    );\n  };\n\n  const updateWorkerPhoto = async (workerId: string, file: File) => {\n    try {\n      const formData = new FormData();\n      formData.append('photo', file);\n\n      const response = await fetch(`/api/reviewer/worker-photos/${workerId}`, {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (response.ok) {\n        const { photo_url } = await response.json();\n        setEditableWorkers(prev =>\n          prev.map(w => w.id === workerId ? { ...w, worker_photo: photo_url } : w)\n        );\n        showSuccess('Berhasil', 'Photo berhasil diunggah');\n      } else {\n        showError('Error', 'Gagal mengunggah photo');\n      }\n    } catch (error) {\n      showError('Error', 'Terjadi kesalahan saat mengunggah photo');\n    }\n  };\n\n  const saveWorkerChanges = async () => {\n    // Validate worker count before saving\n    if (editableWorkerCount === 0) {\n      showError('Error', 'Harap mengisikan jumlah pekerja yang valid (minimal 1 orang)');\n      return;\n    }\n\n    try {\n      setSavingWorkers(true);\n\n      // First, delete workers that were marked for deletion\n      if (workersToDelete.length > 0) {\n        for (const workerId of workersToDelete) {\n          try {\n            await fetch(`/api/reviewer/simloks/${submission?.id}/workers/${workerId}`, {\n              method: 'DELETE',\n            });\n          } catch (error) {\n            console.warn(`Failed to delete worker ${workerId}:`, error);\n          }\n        }\n      }\n\n      // Then update the worker list\n      const response = await fetch(`/api/reviewer/simloks/${submission?.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          worker_list: editableWorkers,\n          worker_count: editableWorkerCount\n        }),\n      });\n\n      if (response.ok) {\n        await response.json();\n\n        // Update local submission state to reflect deleted workers\n        if (submission) {\n          const filteredWorkers = submission.worker_list.filter(w => !workersToDelete.includes(w.id));\n          setSubmission({\n            ...submission,\n            worker_list: [...filteredWorkers, ...editableWorkers.filter(w => w.id.startsWith('temp_'))],\n            worker_count: editableWorkerCount\n          });\n        }\n\n        // Clear workers to delete\n        setWorkersToDelete([]);\n        setIsEditingWorkers(false);\n        showSuccess('Berhasil', 'Data pekerja berhasil diperbarui');\n      } else {\n        showError('Error', 'Gagal memperbarui data pekerja');\n      }\n    } catch (error) {\n      showError('Error', 'Terjadi kesalahan saat memperbarui data pekerja');\n    } finally {\n      setSavingWorkers(false);\n    }\n  };\n\n  const cancelWorkerEditing = () => {\n    if (submission?.worker_list) {\n      setEditableWorkers([...submission.worker_list]);\n      const count = submission.worker_count || submission.worker_list.length;\n      setEditableWorkerCount(count);\n      setWorkerCountInput(count.toString());\n    }\n    setWorkersToDelete([]);\n    setIsEditingWorkers(false);\n  };\n\n  // Helper functions\n  const canEdit = useMemo(() => {\n    return submission && submission.final_status === 'PENDING_APPROVAL';\n  }, [submission?.final_status]);\n\n  // Prevent rendering if not open or no submissionId\n  if (!isOpen || !submissionId) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={(e) => {\n        // Close modal when clicking backdrop\n        if (e.target === e.currentTarget) {\n          onClose();\n        }\n      }}\n    >\n      <div\n        className=\"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between  p-6 border-b border-gray-200 flex-shrink-0\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">Detail & Review Pengajuan</h2>\n            {submission && (\n              <div className=\"text-sm text-gray-500 mt-1 space-y-1\">\n                <p>\n                  <span className=\"font-medium\">{submission.vendor_name}</span> - {submission.officer_name}\n                </p>\n                {submission.simlok_number && (\n                  <p className=\"text-xs\">\n                    <span className=\"font-medium\">No. SIMLOK:</span> {submission.simlok_number}\n                  </p>\n                )}\n              </div>\n            )}\n          </div>\n          <Button onClick={onClose} variant=\"ghost\" size=\"sm\">\n            <XMarkIcon className=\"h-6 w-6\" />\n          </Button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200 flex-shrink-0\">\n          <nav className=\"flex space-x-8 px-6\">\n            <button\n              onClick={() => setActiveTab('details')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'details'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <DocumentTextIcon className=\"h-5 w-5 inline mr-2\" />\n              Detail SIMLOK\n            </button>\n            <button\n              onClick={() => setActiveTab('workers')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'workers'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <UserGroupIcon className=\"h-5 w-5 inline mr-2\" />\n              Data Pekerja\n            </button>\n            <button\n              onClick={() => setActiveTab('review')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'review'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <CheckCircleIcon className=\"h-5 w-5 inline mr-2\" />\n              Review\n            </button>\n          </nav>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n            </div>\n          )}\n\n          {submission && (\n            <>\n              {/* Review Tab */}\n              {activeTab === 'review' && (\n                <div className=\"space-y-8\">\n                  {/* Review Form */}\n                  <div className=\"bg-white rounded-2xl gap-4 space-y-4 p-6 border border-gray-200 shadow-sm\">\n                    <div className=\"flex items-center justify-between mb-4 \">\n                      <h3 className=\"text-lg font-bold text-gray-900\">Review Pengajuan SIMLOK</h3>\n                      {submission.review_status !== 'PENDING_REVIEW' && (\n                        <span className=\"text-sm px-3 py-1 rounded-full bg-blue-100 text-blue-800 font-medium\">\n                          Sudah Direview\n                        </span>\n                      )}\n                    </div>\n\n\n\n                    {/* Implementation Dates */}\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm p-6 relative\">\n                      <h4 className=\"text-base font-medium text-gray-900 mb-4\">Jadwal Pelaksanaan</h4>\n                      <div style={{ overflow: 'visible', position: 'relative', zIndex: 10 }}>\n                        <ImprovedDateRangePicker\n                          value={implementationDatesHook.dates}\n                          onChange={implementationDatesHook.updateDates}\n                          disabled={submission.final_status !== 'PENDING_APPROVAL'}\n                          className=\"mb-4\"\n                        />\n                      </div>\n\n                      {/* Generated Templates Preview */}\n                      {implementationDatesHook.template.pelaksanaan && (\n                        <div className=\"mt-6\">\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Template Pelaksanaan (Auto-generated)\n                            </label>\n                            <div className=\"p-3 bg-gray-50 border rounded-lg text-sm\">\n                              {implementationDatesHook.template.pelaksanaan}\n                            </div>\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Pelaksanaan Input Fields */}\n                      {implementationDatesHook.template.pelaksanaan && (\n                        <div className=\"mt-6 space-y-4\">\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              5. Pelaksanaan\n                            </label>\n                            <textarea\n                              value={approvalForm.pelaksanaan}\n                              onChange={(e) => setApprovalForm(prev => ({ ...prev, pelaksanaan: e.target.value }))}\n                              className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                                }`}\n                              rows={3}\n                              placeholder=\"Terhitung mulai tanggal...\"\n                              readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                            />\n                          </div>\n\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              6. Jam Kerja\n                            </label>\n                            <input\n                              type=\"text\"\n                              value={submission?.working_hours || '08:00 WIB - 17:00 WIB'}\n                              readOnly\n                              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-600\"\n                            />\n                            <p className=\"text-xs text-gray-500 mt-1\">\n                              Jam kerja diambil dari data vendor (tidak dapat diubah di tahap review)\n                            </p>\n                          </div>\n\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              7. Lain-lain (Preview Template)\n                            </label>\n                            <div className=\"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-sm\">\n                              <div className=\"text-gray-700 whitespace-pre-line\">\n                                {(() => {\n                                  let template = \"Izin diberikan berdasarkan:\";\n\n                                  // SIMJA section\n                                  if (submission.simja_number && submission.simja_date) {\n                                    template += `\\n• Simja Ast Man Facility Management\\n  ${submission.simja_number} Tgl. ${formatDate(submission.simja_date)}`;\n                                  }\n\n                                  // SIKA section  \n                                  if (submission.sika_number && submission.sika_date) {\n                                    template += `\\n• SIKA Pekerjaan Dingin\\n  ${submission.sika_number} Tgl. ${formatDate(submission.sika_date)}`;\n                                  }\n\n                                  // Head of Security section - akan diisi saat approval dengan tanggal SIMLOK\n                                  template += `\\n  Diterima Sr Officer Security III\\n  [Tanggal SIMLOK - akan diisi saat approval]`;\n\n                                  return template;\n                                })()}\n                              </div>\n                            </div>\n                            <p className=\"text-xs text-gray-500 mt-2\">\n                              ℹ️ Template ini akan di-generate otomatis oleh approver saat approval berdasarkan data SIMJA, SIKA dan tanggal SIMLOK. Reviewer tidak perlu mengisi field ini.\n                            </p>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Signer Information */}\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm p-6\">\n                      <h4 className=\"text-base font-medium text-gray-900 mb-4\">Data Penandatangan</h4>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Jabatan</label>\n                          <input\n                            type=\"text\"\n                            value={approvalForm.jabatan_signer}\n                            onChange={(e) => setApprovalForm(prev => ({ ...prev, jabatan_signer: e.target.value }))}\n                            className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                              }`}\n                            readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                          />\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nama Lengkap</label>\n                          <input\n                            type=\"text\"\n                            value={approvalForm.nama_signer}\n                            onChange={(e) => setApprovalForm(prev => ({ ...prev, nama_signer: e.target.value }))}\n                            className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                              }`}\n                            readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Content Field - Isi Surat Izin Masuk Lokasi */}\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm p-6\">\n                      <h4 className=\"text-base font-medium text-gray-900 mb-4\">Content - Isi Surat Izin Masuk Lokasi</h4>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Content\n                          <span className=\"text-xs text-gray-500 ml-1\">(Isi surat izin masuk lokasi)</span>\n                        </label>\n                        <textarea\n                          value={approvalForm.content}\n                          onChange={(e) => setApprovalForm(prev => ({ ...prev, content: e.target.value }))}\n                          rows={4}\n                          className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                            }`}\n                          placeholder=\"Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.\"\n                          readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                        />\n                        <p className=\"text-xs text-gray-500 mt-2\">\n                          Isi ketentuan dan syarat-syarat untuk surat izin masuk lokasi\n                        </p>\n                      </div>\n                    </div>\n\n                  </div>\n                  <div className=\"space-y-4 bg-white rounded-2xl gap-4 p-6 border border-gray-200 shadow-sm\">\n                    <div>\n                      <label className=\"block text-sm font-semibold text-gray-800 mb-2\">\n                        Catatan untuk Approver <span className=\"text-red-500\">*</span>\n                      </label>\n                      <textarea\n                        value={reviewData.review_note}\n                        onChange={(e) => setReviewData({ ...reviewData, review_note: e.target.value })}\n                        rows={4}\n                        className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                          }`}\n                        placeholder=\"Berikan penjelasan detail mengenai hasil review...\"\n                        readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                        required\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-semibold text-gray-800 mb-2\">\n                        Catatan untuk Vendor <span className=\"text-red-500\">*</span>\n                      </label>\n                      <textarea\n                        value={reviewData.final_note}\n                        onChange={(e) => setReviewData({ ...reviewData, final_note: e.target.value })}\n                        rows={4}\n                        className={`w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${submission.final_status !== 'PENDING_APPROVAL' ? 'bg-gray-50' : ''\n                          }`}\n                        placeholder=\"Berikan keterangan yang akan ditampilkan kepada vendor...\"\n                        readOnly={submission.final_status !== 'PENDING_APPROVAL'}\n                        required\n                      />\n                      <p className=\"text-xs text-gray-500 mt-2\">\n                        Catatan ini akan ditampilkan kepada vendor setelah pengajuan disetujui/ditolak\n                      </p>\n                    </div>\n                  </div>\n                  {/* Review Decision */}\n                  <div className=\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-8 border border-gray-200\">\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-6 text-center\">Keputusan Review</h3>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <label className={`relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all ${reviewData.review_status === 'MEETS_REQUIREMENTS'\n                        ? 'border-green-500 bg-green-50'\n                        : 'border-gray-200 bg-white hover:border-green-300'\n                        }`}>\n                        <input\n                          type=\"radio\"\n                          name=\"review_status\"\n                          value=\"MEETS_REQUIREMENTS\"\n                          checked={reviewData.review_status === 'MEETS_REQUIREMENTS'}\n                          onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}\n                          className=\"sr-only\"\n                          disabled={submission.final_status !== 'PENDING_APPROVAL'}\n                        />\n                        <div className=\"flex items-center\">\n                          <CheckCircleIcon className=\"h-5 w-5 mr-3 text-green-500\" />\n                          <div>\n                            <div className=\"font-medium\">Memenuhi Syarat</div>\n                            <div className=\"text-sm text-gray-500\">Sesuai persyaratan</div>\n                          </div>\n                        </div>\n                      </label>\n\n                      <label className={`relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all ${reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'\n                        ? 'border-red-500 bg-red-50'\n                        : 'border-gray-200 bg-white hover:border-red-300'\n                        }`}>\n                        <input\n                          type=\"radio\"\n                          name=\"review_status\"\n                          value=\"NOT_MEETS_REQUIREMENTS\"\n                          checked={reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'}\n                          onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}\n                          className=\"sr-only\"\n                          disabled={submission.final_status !== 'PENDING_APPROVAL'}\n                        />\n                        <div className=\"flex items-center\">\n                          <XCircleIcon className=\"h-5 w-5 mr-3 text-red-500\" />\n                          <div>\n                            <div className=\"font-medium\">Tidak Memenuhi Syarat</div>\n                            <div className=\"text-sm text-gray-500\">Perlu perbaikan</div>\n                          </div>\n                        </div>\n                      </label>\n                    </div>\n\n                    {/* Submit Button - Available while final status is PENDING_APPROVAL */}\n                    {submission.final_status === 'PENDING_APPROVAL' && (\n                      <div className=\"mt-6\">\n                        <Button\n                          onClick={handleSubmitReview}\n                          variant=\"primary\"\n                          disabled={!reviewData.review_status || !reviewData.review_note.trim() || !reviewData.final_note.trim() || saving}\n                          className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 font-bold py-4 text-base\"\n                        >\n                          {saving ? (\n                            <div className=\"flex items-center justify-center\">\n                              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3\"></div>\n                              <span>\n                                {submission.review_status === 'PENDING_REVIEW'\n                                  ? 'Mengirim Review...'\n                                  : 'Memperbarui Review...'}\n                              </span>\n                            </div>\n                          ) : (\n                            <span>\n                              {submission.review_status === 'PENDING_REVIEW'\n                                ? 'Submit Review'\n                                : 'Update Review'}\n                            </span>\n                          )}\n                        </Button>\n                      </div>\n                    )}\n\n                    {/* Review Status Info - Show when already reviewed and can still edit */}\n                    {submission.review_status !== 'PENDING_REVIEW' && submission.final_status === 'PENDING_APPROVAL' && (\n                      <div className=\"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-blue-700 mb-2 flex items-center justify-center\">\n                            <span className=\"mr-2\">Status saat ini:</span>\n                            {getReviewStatusBadge(submission.review_status)}\n                          </div>\n                          <p className=\"text-sm text-blue-600\">\n                            Anda dapat mengubah review ini karena belum disetujui/ditolak oleh approver\n                          </p>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Final Review Status - Show when review is locked */}\n                    {submission.final_status !== 'PENDING_APPROVAL' && (\n                      <div className=\"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                        <div className=\"text-center\">\n                          <div className=\"text-sm text-gray-600 mb-2\">\n                            {getReviewStatusBadge(submission.review_status)}\n                          </div>\n                          <div className=\"text-sm text-gray-600 mb-2\">\n                            Status Akhir: {getFinalStatusBadge(submission.final_status)}\n                          </div>\n                          <p className=\"text-sm text-gray-500\">\n                            Review telah selesai pada {submission.reviewed_at ? new Date(submission.reviewed_at).toLocaleDateString('id-ID', {\n                              day: 'numeric',\n                              month: 'long',\n                              year: 'numeric',\n                              hour: '2-digit',\n                              minute: '2-digit'\n                            }) : '-'}\n                          </p>\n                          {submission.reviewed_by_name && (\n                            <p className=\"text-xs text-gray-400 mt-1\">\n                              Direview oleh: {submission.reviewed_by_name}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Details Tab */}\n              {activeTab === 'details' && (\n                <div className=\"space-y-6\">\n                  {/* Header dengan Status dan Review */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Detail SIMLOK</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"text-sm text-gray-500\">Review:</span>\n                      {getReviewStatusBadge(submission.review_status)}\n                      <span className=\"text-sm text-gray-500\">Status:</span>\n                      {getFinalStatusBadge(submission.final_status)}\n                    </div>\n                  </div>\n\n                  {/* Informasi Vendor - menggunakan DetailSection seperti admin */}\n                  <DetailSection\n                    title=\"Informasi Vendor\"\n                    icon={<BuildingOfficeIcon className=\"h-5 w-5 text-blue-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Nama Vendor\"\n                        value={submission.vendor_name}\n                      />\n                      <InfoCard\n                        label=\"Nama Petugas\"\n                        value={submission.officer_name}\n                        icon={<UserIcon className=\"h-4 w-4 text-gray-500\" />}\n                      />\n                      {/* <InfoCard\n                        label=\"Email\"\n                        value={submission.officer_email || '-'}\n                      /> */}\n                      <InfoCard\n                        label=\"Nomor Telepon Vendor\"\n                        value={submission.vendor_phone || '-'}\n                      />\n                      <InfoCard\n                        label=\"Berdasarkan\"\n                        value={submission.based_on}\n                      />\n                    </div>\n                  </DetailSection>\n\n                  {/* Informasi Dokumen - sama seperti admin */}\n                  <DetailSection\n                    title=\"Informasi Dokumen\"\n                    icon={<DocumentIcon className=\"h-5 w-5 text-orange-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      {submission.simja_number && (\n                        <InfoCard\n                          label=\"Nomor SIMJA\"\n                          value={submission.simja_number}\n                        />\n                      )}\n                      {submission.simja_date && (\n                        <InfoCard\n                          label=\"Tanggal SIMJA\"\n                          value={formatDate(submission.simja_date)}\n\n                        />\n                      )}\n                      {submission.sika_number && (\n                        <InfoCard\n                          label=\"Nomor SIKA\"\n                          value={submission.sika_number}\n                        />\n                      )}\n                      {submission.sika_date && (\n                        <InfoCard\n                          label=\"Tanggal SIKA\"\n                          value={formatDate(submission.sika_date)}\n\n                        />\n                      )}\n                      {/* Status dan Tanggal Pengajuan */}\n\n                    </div>\n\n                    <div className=\"grid grid-cols-1 mt-5 md:grid-cols-2 gap-4\">\n                      {/* Dokumen SIKA */}\n                      {submission.sika_document_upload && (\n                        <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                          <div className=\"flex items-center space-x-3\">\n                            <DocumentIcon className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\n                            <div>\n                              <p className=\"font-medium text-gray-900\">Dokumen SIKA</p>\n                              <p className=\"text-sm text-gray-500\">File tersedia</p>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}\n                            className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                          >\n                            <EyeIcon className=\"w-4 h-4\" />\n                            <span>Lihat</span>\n                          </button>\n                        </div>\n                      )}\n\n                      {/* Dokumen SIMJA */}\n                      {submission.simja_document_upload && (\n                        <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                          <div className=\"flex items-center space-x-3\">\n                            <DocumentIcon className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\n                            <div>\n                              <p className=\"font-medium text-gray-900\">Dokumen SIMJA</p>\n                              <p className=\"text-sm text-gray-500\">File tersedia</p>\n                            </div>\n                          </div>\n                          <button\n                            onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}\n                            className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                          >\n                            <EyeIcon className=\"w-4 h-4\" />\n                            <span>Lihat</span>\n                          </button>\n                        </div>\n                      )}\n\n                      {/* Message if no documents */}\n                      {!submission.sika_document_upload && !submission.simja_document_upload && (\n                        <div className=\"col-span-2 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n                          <DocumentIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                          <h3 className=\"text-sm font-medium text-gray-900 mb-1\">Tidak ada dokumen</h3>\n                          <p className=\"text-sm text-gray-500\">Belum ada dokumen yang diupload</p>\n                        </div>\n                      )}\n                    </div>\n                  </DetailSection>\n\n                  {/* Detail Pekerjaan - sama seperti admin */}\n                  <DetailSection\n                    title=\"Informasi Pekerjaan\"\n                    icon={<BriefcaseIcon className=\"h-5 w-5 text-green-500\" />}\n                  >\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <InfoCard\n                        label=\"Pekerjaan\"\n                        value={submission.job_description}\n                      />\n                      <InfoCard\n                        label=\"Lokasi Kerja\"\n                        value={submission.work_location}\n                      />\n                      <InfoCard\n                        label=\"Pelaksanaan\"\n                        value={submission.implementation || 'Belum diisi'}\n                      />\n                      <InfoCard\n                        label=\"Jam Kerja\"\n                        value={submission.working_hours}\n                      />\n                      <InfoCard\n                        label=\"Jumlah Pekerja\"\n                        value={`${submission.worker_count || 0} orang`}\n                      />\n                      <InfoCard\n                        label=\"Sarana Kerja\"\n                        value={submission.work_facilities}\n                      />\n                    </div>\n\n                  </DetailSection>\n\n                </div>\n              )}\n\n              {/* Workers Tab */}\n              {activeTab === 'workers' && (\n                <div className=\"space-y-6\">\n                  {/* Header dengan jumlah pekerja */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Data Pekerja</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      {canEdit && (\n                        isEditingWorkers ? (\n                          <div className=\"flex gap-2\">\n                            <Button\n                              onClick={cancelWorkerEditing}\n                              variant=\"outline\"\n                              size=\"sm\"\n                            >\n                              Batal\n                            </Button>\n                            <Button\n                              onClick={saveWorkerChanges}\n                              variant=\"primary\"\n                              size=\"sm\"\n                              disabled={savingWorkers}\n                            >\n                              {savingWorkers ? 'Menyimpan...' : 'Simpan'}\n                            </Button>\n                          </div>\n                        ) : (\n                          <Button\n                            onClick={() => setIsEditingWorkers(true)}\n                            variant=\"primary\"\n                            size=\"sm\"\n                          >\n                            <PencilIcon className=\"w-4 h-4 mr-2\" />\n                            Edit Pekerja\n                          </Button>\n                        )\n                      )}\n\n                      {/* Badge Total selalu tampil */}\n                      <span className=\"bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full\">\n                        Total: {isEditingWorkers ? editableWorkerCount : (submission.worker_count ||\n                          (submission.worker_names ? submission.worker_names.split('\\n').filter(name => name.trim()).length : submission.worker_list.length)\n                        )} pekerja\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* Worker Count Configuration - Vendor Style */}\n                  {isEditingWorkers && (\n                    <div className=\"space-y-4 mb-6\">\n                      <div>\n                        <label htmlFor=\"jumlah_pekerja\" className=\"mb-1.5 block text-sm font-medium text-gray-700\">\n                          Jumlah Pekerja\n                        </label>\n                        <input\n                          id=\"jumlah_pekerja\"\n                          name=\"jumlah_pekerja\"\n                          type=\"text\"\n                          value={workerCountInput}\n                          onChange={(e) => {\n                            const inputValue = e.target.value;\n\n                            // Allow completely empty input (show placeholder)\n                            if (inputValue === '') {\n                              setWorkerCountInput('');\n                              setEditableWorkerCount(0);\n                              return;\n                            }\n\n                            // Only allow numeric input - remove any non-numeric characters\n                            const cleanValue = inputValue.replace(/\\D/g, '');\n\n                            // If after cleaning there's nothing left, make it empty\n                            if (cleanValue === '') {\n                              setWorkerCountInput('');\n                              setEditableWorkerCount(0);\n                              return;\n                            }\n\n                            const numValue = parseInt(cleanValue, 10);\n                            if (!isNaN(numValue) && numValue >= 0 && numValue <= 9999) {\n                              setWorkerCountInput(cleanValue);\n                              setEditableWorkerCount(numValue);\n                            }\n                          }}\n                          onKeyDown={(e) => {\n                            // Allow all navigation and editing keys\n                            const allowedKeys = [\n                              'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',\n                              'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',\n                              'Home', 'End', 'PageUp', 'PageDown'\n                            ];\n\n                            if (allowedKeys.includes(e.key)) {\n                              return; // Allow these keys\n                            }\n\n                            // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X, Ctrl+Z\n                            if (e.ctrlKey && ['a', 'c', 'v', 'x', 'z'].includes(e.key.toLowerCase())) {\n                              return;\n                            }\n\n                            // Only allow numeric keys (0-9)\n                            if (!/[0-9]/.test(e.key)) {\n                              e.preventDefault();\n                            }\n                          }}\n                          onBlur={() => {\n                            // Only auto-correct to 1 if user actually wants to save with empty value\n                            // During editing, allow empty state to show placeholder\n                            if (workerCountInput === '') {\n                              // Keep it empty to show placeholder, don't force a value\n                              setEditableWorkerCount(0);\n                            }\n                          }}\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                          placeholder=\"Masukkan jumlah pekerja\"\n                        />\n                        <p className=\"text-sm text-gray-500 mt-1\">\n                          Jumlah total pekerja yang akan bekerja di lokasi ini\n                        </p>\n                      </div>\n\n                      <div className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg w-full\">\n                        <div className=\"font-medium mb-1\">Info:</div>\n                        <div>Pekerja yang diinput foto: {editableWorkers.length}</div>\n                        <div>Jumlah pekerja: {editableWorkerCount || 0}</div>\n                        {editableWorkerCount > 0 && editableWorkers.length !== editableWorkerCount && (\n                          <div className=\"text-orange-600 mt-1\">\n                            Jumlah tidak sesuai dengan daftar pekerja\n                          </div>\n                        )}\n                        {editableWorkerCount > 0 && editableWorkers.length === editableWorkerCount && (\n                          <div className=\"text-green-600 mt-1\">\n                            Jumlah sesuai dengan daftar pekerja\n                          </div>\n                        )}\n                        {editableWorkerCount === 0 && (\n                          <div className=\"text-red-600 mt-1\">\n                            Harap mengisikan jumlah pekerja (minimal 1 orang)\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.worker_list.length === 0 ? (\n                    <div className=\"text-center py-16\">\n                      <UserGroupIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada foto pekerja</h3>\n                      <p className=\"text-gray-500 max-w-md mx-auto\">\n                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                      {(isEditingWorkers ? editableWorkers : submission.worker_list).map((worker, workerIndex) => (\n                        <div\n                          key={`worker-${workerIndex}-${worker.worker_name}`}\n                          className=\"bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group\"\n                        >\n                          {/* Photo Section */}\n                          <div className=\"relative p-4 pb-2\">\n                            <div className=\"relative\">\n                              {worker.worker_photo ? (\n                                <img\n                                  src={worker.worker_photo}\n                                  alt={`Foto ${worker.worker_name}`}\n                                  className=\"w-full h-48 rounded-lg object-cover shadow-sm\"\n                                  onError={(e) => {\n                                    const target = e.target as HTMLImageElement;\n                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';\n                                  }}\n                                />\n                              ) : (\n                                <div className=\"w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm\">\n                                  <div className=\"text-center text-gray-500\">\n                                    <svg className=\"w-12 h-12 mx-auto mb-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                      <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\n                                    </svg>\n                                    <p className=\"text-sm\">Tidak ada foto</p>\n                                  </div>\n                                </div>\n                              )}\n                              {isEditingWorkers && (\n                                <div className=\"absolute top-2 right-2 flex gap-1\">\n                                  <label className=\"cursor-pointer bg-blue-500 text-white p-1.5 rounded-full hover:bg-blue-600 transition-colors\">\n                                    <input\n                                      type=\"file\"\n                                      accept=\"image/*\"\n                                      className=\"hidden\"\n                                      onChange={(e) => {\n                                        const file = e.target.files?.[0];\n                                        if (file) {\n                                          updateWorkerPhoto(worker.id, file);\n                                        }\n                                      }}\n                                    />\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" />\n                                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\n                                    </svg>\n                                  </label>\n                                  <button\n                                    onClick={() => removeWorker(worker.id)}\n                                    className=\"bg-red-500 text-white p-1.5 rounded-full hover:bg-red-600 transition-colors\"\n                                  >\n                                    <TrashIcon className=\"w-4 h-4\" />\n                                  </button>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Info Section */}\n                          <div className=\"px-4 pb-4\">\n                            {isEditingWorkers ? (\n                              <input\n                                type=\"text\"\n                                value={worker.worker_name}\n                                onChange={(e) => updateWorkerName(worker.id, e.target.value)}\n                                className=\"w-full font-semibold text-gray-900 text-sm mb-1 border border-gray-300 rounded px-2 py-1 focus:border-blue-500 focus:outline-none\"\n                                placeholder=\"Nama pekerja\"\n                              />\n                            ) : (\n                              <h4 className=\"font-semibold text-gray-900 text-sm mb-1 truncate\">\n                                {worker.worker_name}\n                              </h4>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                      {isEditingWorkers && (\n                        <div className=\"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors\">\n                          <button\n                            onClick={addWorker}\n                            className=\"w-full h-64 flex flex-col items-center justify-center text-gray-500 hover:text-gray-700 transition-colors\"\n                          >\n                            <PlusIcon className=\"w-12 h-12 mb-2\" />\n                            <span className=\"text-sm font-medium\">Tambah Pekerja</span>\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200 bg-white\">\n          <div>\n            {submission?.review_status !== 'PENDING_REVIEW' && (\n              <Button onClick={() => setIsPdfModalOpen(true)} variant=\"primary\" size=\"sm\">\n                <DocumentTextIcon className=\"w-4 h-4 mr-2\" />\n                Lihat Preview PDF SIMLOK\n              </Button>\n            )}\n          </div>\n          <Button onClick={onClose} variant=\"outline\">\n            Tutup\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submissionId}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={previewModal.isOpen}\n        onClose={handleClosePreview}\n        fileUrl={previewModal.fileUrl}\n        fileName={previewModal.fileName}\n      />\n    </div>\n  );\n};\n\nexport default ImprovedReviewerSubmissionDetailModal;"
            },
            {
              "type": "file",
              "name": "ReviewerDashboard.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  ClipboardDocumentListIcon,\n  ClockIcon,\n  CheckCircleIcon,\n  ExclamationTriangleIcon,\n  EyeIcon\n} from '@heroicons/react/24/outline';\n\nimport Button from '@/components/ui/button/Button';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport PageLoader from '@/components/ui/PageLoader';\nimport ReviewerSubmissionDetailModal from './ImprovedReviewerSubmissionDetailModal';\nimport Link from 'next/link';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  approved_by_final_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface StatsData {\n  pendingReview: number;\n  meetsRequirements: number;\n  notMeetsRequirements: number;\n  total: number;\n  pendingUserVerifications?: number;\n  totalVerifiedUsers?: number;\n}\n\nconst ReviewerDashboard = () => {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [stats, setStats] = useState<StatsData>({ \n    pendingReview: 0, \n    meetsRequirements: 0, \n    notMeetsRequirements: 0, \n    total: 0,\n    pendingUserVerifications: 0,\n    totalVerifiedUsers: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  \n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const fetchDashboardData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      // Fetch stats dan 10 submission terakhir untuk dashboard\n      const response = await fetch('/api/reviewer/simloks?page=1&limit=10&sortBy=created_at&sortOrder=desc');\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data dashboard');\n      }\n      \n      const data = await response.json();\n      setSubmissions(data.submissions || []);\n      setStats(data.stats || { pendingReview: 0, meetsRequirements: 0, notMeetsRequirements: 0, total: 0 });\n      setError(null);\n    } catch (err) {\n      console.error('Error fetching dashboard data:', err);\n      setError('Gagal memuat data dashboard');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, [fetchDashboardData]);\n\n  // Socket untuk real-time updates\n  const socket = useSocket();\n  \n  useEffect(() => {\n    if (!socket) return;\n\n    // Join reviewer room\n    socket.emit('join', { role: 'REVIEWER' });\n\n    const handleNotificationNew = (notification: any) => {\n      console.log('New notification received for reviewer:', notification);\n      if (notification.type === 'new_submission_review') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleStatsUpdate = (statsUpdate: any) => {\n      console.log('Stats update received for reviewer:', statsUpdate);\n      if (statsUpdate.scope === 'reviewer') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleSubmissionCreated = () => {\n      console.log('New submission created - updating reviewer dashboard');\n      fetchDashboardData();\n    };\n\n    // Listen for new notifications (including new submissions to review)\n    socket.on('notification:new', handleNotificationNew);\n    // Listen for stats updates\n    socket.on('stats:update', handleStatsUpdate);\n    // Listen for new submission events\n    socket.on('submission:created', handleSubmissionCreated);\n\n    return () => {\n      socket.off('notification:new', handleNotificationNew);\n      socket.off('stats:update', handleStatsUpdate);\n      socket.off('submission:created', handleSubmissionCreated);\n    };\n  }, [socket, fetchDashboardData]);\n\n  const handleViewDetail = (submissionId: string) => {\n    setSelectedSubmission(submissionId);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleReviewSubmitted = () => {\n    fetchDashboardData();\n    handleCloseModal();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;\n        case 'MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Persetujuan</span>;\n        case 'APPROVED':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;\n        case 'REJECTED':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    }\n  };\n\n  if (loading) {\n    return <PageLoader message=\"Memuat dashboard reviewer...\" />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        \n        {error && (\n          <Alert variant=\"error\" title=\"Error\" message={error} className=\"mb-6\" />\n        )}\n\n        {/* Statistics Cards - Updated Design */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Total Pengajuan</h3>\n                <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats?.total || 0}</p>\n              </div>\n              <div className=\"p-3 bg-blue-100 rounded-full\">\n                <ClipboardDocumentListIcon className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Review</h3>\n                <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats?.pendingReview || 0}</p>\n              </div>\n              <div className=\"p-3 bg-amber-100 rounded-full\">\n                <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Memenuhi Syarat</h3>\n                <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats?.meetsRequirements || 0}</p>\n              </div>\n              <div className=\"p-3 bg-green-100 rounded-full\">\n                <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Tidak Memenuhi Syarat</h3>\n                <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats?.notMeetsRequirements || 0}</p>\n              </div>\n              <div className=\"p-3 bg-red-100 rounded-full\">\n                <ExclamationTriangleIcon className=\"w-6 h-6 text-red-600\" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* User Verification Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8\">\n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">User Perlu Verifikasi</h3>\n                <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats?.pendingUserVerifications || 0}</p>\n              </div>\n              <div className=\"p-3 bg-purple-100 rounded-full\">\n                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">User Terverifikasi</h3>\n                <p className=\"text-2xl font-bold text-indigo-600 mt-1\">{stats?.totalVerifiedUsers || 0}</p>\n              </div>\n              <div className=\"p-3 bg-indigo-100 rounded-full\">\n                <svg className=\"w-6 h-6 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Recent Submissions */}\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n            <h2 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <ClipboardDocumentListIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n              10 Pengajuan Terakhir\n            </h2>\n            <Link href=\"/reviewer/submissions\">\n              <Button variant=\"outline\" size=\"sm\">\n                Lihat Semua Pengajuan\n              </Button>\n            </Link>\n          </div>\n\n          {submissions.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <ClipboardDocumentListIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Belum ada pengajuan</h3>\n              <p className=\"mt-1 text-sm text-gray-500\">Pengajuan yang perlu direview akan muncul di sini</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Vendor & Petugas\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Lokasi Kerja\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Review\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Akhir\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Tanggal Dibuat\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {submissions.map((submission) => (\n                    <tr key={submission.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4\">\n                        <div>\n                          <div className=\"text-sm font-medium text-gray-900\">{submission.vendor_name}</div>\n                          <div className=\"text-sm text-gray-500\">{submission.user.officer_name}</div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <div className=\"text-sm text-gray-900\">{submission.work_location}</div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        {getStatusBadge(submission.review_status, 'review')}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        {getStatusBadge(submission.final_status, 'final')}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {new Date(submission.created_at).toLocaleDateString('id-ID')}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <Button\n                          onClick={() => handleViewDetail(submission.id)}\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"text-blue-600 hover:text-blue-900\"\n                        >\n                          <EyeIcon className=\"w-4 h-4 mr-1\" />\n                          Detail\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Modal */}\n      {selectedSubmission && (\n        <ReviewerSubmissionDetailModal\n          key={selectedSubmission}\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n          submissionId={selectedSubmission}\n          onReviewSubmitted={handleReviewSubmitted}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ReviewerDashboard;"
            },
            {
              "type": "file",
              "name": "ReviewerScanHistoryContent.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  FunnelIcon,\n  QrCodeIcon,\n  UserIcon,\n  DocumentTextIcon,\n  ClockIcon,\n  EyeIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport { formatDistanceToNow, format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport DatePicker from '@/components/form/DatePicker';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    job_description: string;\n    review_status: string;\n    final_status: string;\n  };\n  user: {\n    id: string;\n    full_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface FilterState {\n  dateFrom: string;\n  dateTo: string;\n  verifier: string;\n  submissionId: string;\n}\n\nexport default function ReviewerScanHistoryContent() {\n  const [scans, setScans] = useState<QrScan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n  const [filters, setFilters] = useState<FilterState>({\n    dateFrom: '',\n    dateTo: '',\n    verifier: '',\n    submissionId: ''\n  });\n  const [showFilters, setShowFilters] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n  const [showPdfModal, setShowPdfModal] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const pageSize = 15;\n\n  const fetchScanHistory = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: pageSize.toString(),\n        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),\n        ...(filters.dateTo && { dateTo: filters.dateTo }),\n        ...(filters.verifier && { verifier: filters.verifier }),\n        ...(filters.submissionId && { submissionId: filters.submissionId }),\n        ...(searchTerm && { search: searchTerm })\n      });\n\n      const response = await fetch(`/api/scan-history?${params}`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data = await response.json();\n      setScans(data.scans || []);\n      setTotalPages(Math.ceil((data.total || 0) / pageSize));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchScanHistory();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [currentPage, searchTerm]);\n\n  const handleFilterSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const resetFilters = () => {\n    setFilters({\n      dateFrom: '',\n      dateTo: '',\n      verifier: '',\n      submissionId: ''\n    });\n    setSearchTerm('');\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <Badge variant=\"warning\">Menunggu Review</Badge>;\n        case 'MEETS_REQUIREMENTS':\n          return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n        default:\n          return null;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n        case 'APPROVED':\n          return <Badge variant=\"success\">Disetujui</Badge>;\n        case 'REJECTED':\n          return <Badge variant=\"destructive\">Ditolak</Badge>;\n        default:\n          return null;\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Search and Filters */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <QrCodeIcon className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">Manajemen Riwayat Scan</h2>\n              <p className=\"text-sm text-gray-500\">Pantau aktivitas scan QR code oleh verifikator</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-3\">\n            <Button\n              onClick={() => setShowFilters(!showFilters)}\n              variant={showFilters ? 'secondary' : 'primary'}\n              className=\"flex items-center space-x-2\"\n            >\n              <FunnelIcon className=\"h-4 w-4\" />\n              <span>Filter</span>\n            </Button>\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"relative mb-4\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            placeholder=\"Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator...\"\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        {/* Advanced Filters */}\n        {showFilters && (\n          <div className=\"border-t border-gray-200 pt-4\">\n            <form onSubmit={handleFilterSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Dari\n                  </label>\n                  <DatePicker\n                    value={filters.dateFrom}\n                    onChange={(value) => setFilters(prev => ({ ...prev, dateFrom: value }))}\n                    placeholder=\"Pilih tanggal dari\"\n                    className=\"w-full\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Sampai\n                  </label>\n                  <DatePicker\n                    value={filters.dateTo}\n                    onChange={(value) => setFilters(prev => ({ ...prev, dateTo: value }))}\n                    placeholder=\"Pilih tanggal sampai\"\n                    className=\"w-full\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Verifikator\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.verifier}\n                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nama verifikator...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nomor Simlok\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.submissionId}\n                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nomor simlok...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3\">\n                <Button type=\"submit\" className=\"flex items-center space-x-2\">\n                  <MagnifyingGlassIcon className=\"h-4 w-4\" />\n                  <span>Terapkan Filter</span>\n                </Button>\n                \n                <Button \n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={resetFilters}\n                >\n                  Reset\n                </Button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Scan History Table */}\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8\">\n            <div className=\"animate-pulse space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-gray-200 rounded-lg\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                  </div>\n                  <div className=\"w-20 h-8 bg-gray-200 rounded\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ) : scans.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <QrCodeIcon className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No scan history found</h3>\n            <p className=\"text-gray-500\">No QR code scans match your current filters.</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pengajuan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Verifikator\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Waktu Scan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {scans.map((scan) => (\n                    <tr key={scan.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-2 bg-blue-100 rounded-lg mr-3\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-blue-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.submission.simlok_number}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {scan.submission.vendor_name}\n                            </div>\n                            <div className=\"text-xs text-gray-400 truncate max-w-xs\">\n                              {scan.submission.job_description}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-1.5 bg-green-100 rounded-full mr-3\">\n                            <UserIcon className=\"h-4 w-4 text-green-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.user.full_name}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {scan.user.email}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center text-sm text-gray-900\">\n                          <ClockIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <div>\n                            <div className=\"font-medium\">\n                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"space-y-1\">\n                          {getStatusBadge(scan.submission.review_status, 'review')}\n                          {getStatusBadge(scan.submission.final_status, 'final')}\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          className=\"flex items-center space-x-1\"\n                        >\n                          <EyeIcon className=\"h-4 w-4\" />\n                          <span>Detail</span>\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"bg-white px-4 py-3 border-t border-gray-200 sm:px-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <p className=\"text-sm text-gray-700\">\n                      Menampilkan halaman <span className=\"font-medium\">{currentPage}</span> dari{' '}\n                      <span className=\"font-medium\">{totalPages}</span>\n                    </p>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <ChevronLeftIcon className=\"h-4 w-4\" />\n                      <span>Sebelumnya</span>\n                    </Button>\n                    \n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}\n                      disabled={currentPage === totalPages}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <span>Selanjutnya</span>\n                      <ChevronRightIcon className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Informasi Detail Scan</h3>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <span className=\"sr-only\">Close</span>\n                  ✕\n                </button>\n              </div>\n            </div>\n            \n            <div className=\"p-6 space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Pengajuan</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nomor Simlok:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.simlok_number}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Perusahaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.vendor_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Deskripsi Pekerjaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.job_description}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Verifikator</h4>\n                  <div className=\"space-y-2 text-sm\">\n                     {selectedScan.scanner_name && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Scanner Name:</span>\n                      <span className=\"font-medium\">{selectedScan.scanner_name}</span>\n                    </div>\n                  )}\n                  {selectedScan.scan_location && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Lokasi Scan:</span>\n                      <span className=\"font-medium\">{selectedScan.scan_location}</span>\n                    </div>\n                  )}\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Email:</span>\n                      <span className=\"font-medium\">{selectedScan.user.email}</span>\n                    </div>\n                    \n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Detail Scan</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-500\">Waktu Scan:</span>\n                    <span className=\"font-medium\">\n                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}\n                    </span>\n                  </div>\n                 \n                </div>\n              </div>\n              \n              {/* PDF Button */}\n              <div className=\"flex justify-center pt-4 border-t border-gray-200\">\n                <Button\n                  onClick={() => setShowPdfModal(true)}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2\"\n                >\n                  <DocumentTextIcon className=\"w-5 h-5\" />\n                  <span>Lihat PDF SIMLOK</span>\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* SimlokPdfModal */}\n      {selectedScan && (\n        <SimlokPdfModal\n          isOpen={showPdfModal}\n          onClose={() => setShowPdfModal(false)}\n          submissionId={selectedScan.submission.id}\n          submissionName={selectedScan.submission.vendor_name}\n          nomorSimlok={selectedScan.submission.simlok_number}\n        />\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "ReviewerSubmissionsManagement.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  PencilIcon,\n  UserIcon,\n  ClipboardDocumentListIcon,\n  ArrowDownTrayIcon,\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport ReviewerSubmissionDetailModal from './ImprovedReviewerSubmissionDetailModal';\nimport ExportFilterModal, { ExportFilters } from './ExportFilterModal';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\n\ninterface Submission {\n  id: string; // Keep for internal operations\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  scan_count: number;\n  last_scanned_at?: string | null;\n  user: {\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface SubmissionsResponse {\n  submissions: Submission[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    pages: number;\n  };\n}\n\nexport default function ReviewerSubmissionsManagement() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  const [exportLoading, setExportLoading] = useState(false);\n  const [showExportModal, setShowExportModal] = useState(false);\n  \n  // Filters and pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');\n  const [finalStatusFilter, setFinalStatusFilter] = useState<string>(''); // Default to show all statuses\n  const [sortBy, setSortBy] = useState('created_at');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    pages: 0,\n  });\n\n  // Socket connection\n  const socket = useSocket();\n\n  const fetchSubmissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: '10',\n        sortBy,\n        sortOrder,\n      });\n\n      if (searchTerm) params.append('search', searchTerm);\n      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);\n      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);\n\n      const response = await fetch(`/api/reviewer/simloks?${params}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data pengajuan');\n      }\n\n      const data: SubmissionsResponse = await response.json();\n      setSubmissions(data.submissions);\n      setPagination(data.pagination);\n    } catch (err) {\n      console.error('Error fetching submissions:', err);\n      setError('Gagal memuat data pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [fetchSubmissions]);\n\n  // Socket listeners for real-time updates\n  useEffect(() => {\n    if (!socket) return;\n\n    // Join reviewer room\n    socket.emit('join', { role: 'REVIEWER' });\n\n    const handleSubmissionUpdate = () => {\n      console.log('Submission update received, refreshing reviewer submissions');\n      fetchSubmissions();\n    };\n\n    socket.on('submission:created', handleSubmissionUpdate);\n    socket.on('submission:reviewed', handleSubmissionUpdate);\n    socket.on('submission:approved', handleSubmissionUpdate);\n    socket.on('submission:rejected', handleSubmissionUpdate);\n\n    return () => {\n      socket.off('submission:created', handleSubmissionUpdate);\n      socket.off('submission:reviewed', handleSubmissionUpdate);\n      socket.off('submission:approved', handleSubmissionUpdate);\n      socket.off('submission:rejected', handleSubmissionUpdate);\n    };\n  }, [socket, fetchSubmissions]);\n\n  const handleSort = (field: string) => {\n    if (sortBy === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortBy(field);\n      setSortOrder('desc');\n    }\n    setCurrentPage(1);\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortBy !== field) return <ChevronUpDownIcon className=\"h-4 w-4\" />;\n    return sortOrder === 'asc' \n      ? <ChevronUpIcon className=\"h-4 w-4\" />\n      : <ChevronDownIcon className=\"h-4 w-4\" />;\n  };\n\n  const getReviewStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_REVIEW':\n        return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const getFinalStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const handleViewDetails = (submission: Submission) => {\n    setSelectedSubmission(submission);\n    setShowDetailModal(true);\n  };\n\n  const handleExportToExcel = async (filters: ExportFilters) => {\n    try {\n      setExportLoading(true);\n      \n      // Build query parameters with filters from modal\n      const params = new URLSearchParams();\n      if (filters.search) params.append('search', filters.search);\n      if (filters.reviewStatus) params.append('reviewStatus', filters.reviewStatus);\n      if (filters.finalStatus) params.append('finalStatus', filters.finalStatus);\n      if (filters.startDate) params.append('startDate', filters.startDate);\n      if (filters.endDate) params.append('endDate', filters.endDate);\n\n      const response = await fetch(`/api/reviewer/simloks/export?${params}`);\n      \n      if (!response.ok) {\n        throw new Error('Gagal mengekspor data');\n      }\n\n      // Get the filename from response headers\n      const contentDisposition = response.headers.get('Content-Disposition');\n      let filename = 'Data_Pengajuan_SIMLOK.xlsx';\n      if (contentDisposition) {\n        const filenameMatch = contentDisposition.match(/filename=\"(.+)\"/);\n        if (filenameMatch && filenameMatch[1]) {\n          filename = filenameMatch[1];\n        }\n      }\n\n      // Create blob and download\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n\n      // Close modal after successful export\n      setShowExportModal(false);\n\n    } catch (error) {\n      console.error('Error exporting to Excel:', error);\n      setError('Gagal mengekspor data ke Excel');\n    } finally {\n      setExportLoading(false);\n    }\n  };\n\n  if (loading && submissions.length === 0) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header and Filters - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <div>\n            <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Review Pengajuan</h1>\n            <p className=\"text-sm text-gray-500 mt-1\">Kelola dan review pengajuan SIMLOK</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={() => setShowExportModal(true)}\n              disabled={exportLoading}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"text-green-600 border-green-600 hover:bg-green-50\"\n            >\n              <ArrowDownTrayIcon className=\"h-4 w-4 mr-2\" />\n              Export Excel\n            </Button>\n          </div>\n        </div>\n\n        {/* Toolbar - Search and Filters */}\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n          <div className=\"relative w-full md:w-80\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              placeholder=\"Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas...\"\n              value={searchTerm}\n              onChange={(e) => {\n                setSearchTerm(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n            />\n          </div>\n          <div className=\"flex gap-2 md:w-auto\">\n            <select\n              value={reviewStatusFilter}\n              onChange={(e) => {\n                setReviewStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Review</option>\n              <option value=\"PENDING_REVIEW\">Menunggu Review</option>\n              <option value=\"MEETS_REQUIREMENTS\">Memenuhi Syarat</option>\n              <option value=\"NOT_MEETS_REQUIREMENTS\">Tidak Memenuhi Syarat</option>\n            </select>\n            <select\n              value={finalStatusFilter}\n              onChange={(e) => {\n                setFinalStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Akhir</option>\n              <option value=\"PENDING_APPROVAL\">Menunggu Persetujuan</option>\n              <option value=\"APPROVED\">Disetujui</option>\n              <option value=\"REJECTED\">Ditolak</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Submissions Table - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm overflow-hidden\">\n        {submissions.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <ClipboardDocumentListIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Tidak ada pengajuan</h3>\n            <p className=\"text-gray-500 max-w-md mx-auto\">\n              {searchTerm || reviewStatusFilter || finalStatusFilter \n                ? 'Tidak ada pengajuan yang sesuai dengan filter yang dipilih.'\n                : 'Belum ada pengajuan yang tersedia untuk di-review.'\n              }\n            </p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th \n                      className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                      onClick={() => handleSort('created_at')}\n                    >\n                      <div className=\"flex items-center space-x-1\">\n                        <span>Tanggal</span>\n                        {getSortIcon('created_at')}\n                      </div>\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Vendor & Penanggung Jawab\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pekerjaan & Lokasi\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Review\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Final\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Scan\n                    </th>\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {submissions.map((submission, index) => (\n                    <tr key={`submission-${index}-${submission.created_at}`} className=\"hover:bg-gray-50 transition-colors\">\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {new Date(submission.created_at).toLocaleDateString('id-ID', {\n                            day: '2-digit',\n                            month: 'short',\n                            year: 'numeric'\n                          })}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                          {new Date(submission.created_at).toLocaleTimeString('id-ID', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"max-w-48\">\n                          <div className=\"font-medium text-sm text-gray-900 truncate\" title={submission.vendor_name}>\n                            {submission.vendor_name}\n                          </div>\n                          <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-1\">\n                            <UserIcon className=\"h-3 w-3 flex-shrink-0\" />\n                            <span className=\"truncate\" title={submission.officer_name}>{submission.officer_name}</span>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"max-w-64\">\n                          <div className=\"text-sm text-gray-900 font-medium truncate\" title={submission.job_description}>\n                            {submission.job_description}\n                          </div>\n                          <div className=\"text-xs text-gray-500 mt-1 truncate\" title={submission.work_location}>\n                             {submission.work_location}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        {getReviewStatusBadge(submission.review_status)}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        {getFinalStatusBadge(submission.final_status)}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        {submission.final_status === 'APPROVED' ? (\n                          <div className=\"text-sm\">\n                            {submission.scan_count > 0 ? (\n                              <div>\n                                <Badge variant=\"success\">\n                                  Sudah discan ({submission.scan_count}x)\n                                </Badge>\n                                {submission.last_scanned_at && (\n                                  <div className=\"text-xs text-gray-500 mt-1\">\n                                    Terakhir: {new Date(submission.last_scanned_at).toLocaleDateString('id-ID', {\n                                      day: '2-digit',\n                                      month: 'short',\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                )}\n                              </div>\n                            ) : (\n                              <Badge variant=\"warning\">Belum discan</Badge>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-xs text-gray-400\">-</span>\n                        )}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap text-center\">\n                        <Button\n                          onClick={() => handleViewDetails(submission)}\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"text-blue-600 border-blue-600 hover:bg-blue-50\"\n                        >\n                          <PencilIcon className=\"h-4 w-4 mr-1\" />\n                          {submission.final_status === 'PENDING_APPROVAL' ? 'Review' : 'Lihat'}\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {pagination.pages > 1 && (\n              <div className=\"px-4 py-3 border-t border-gray-200 bg-gray-50\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"text-sm text-gray-700\">\n                    Menampilkan {((currentPage - 1) * pagination.limit) + 1} sampai{' '}\n                    {Math.min(currentPage * pagination.limit, pagination.total)} dari{' '}\n                    {pagination.total} pengajuan\n                  </div>\n                  <div className=\"flex space-x-1\">\n                    <Button\n                      onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      Sebelumnya\n                    </Button>\n                    {Array.from({ length: pagination.pages }, (_, i) => i + 1)\n                      .filter(page => {\n                        const distance = Math.abs(page - currentPage);\n                        return distance === 0 || distance === 1 || page === 1 || page === pagination.pages;\n                      })\n                      .map((page, index, array) => (\n                        <React.Fragment key={page}>\n                          {index > 0 && array[index - 1] !== page - 1 && (\n                            <span className=\"px-3 py-1 text-gray-500\">...</span>\n                          )}\n                          <Button\n                            onClick={() => setCurrentPage(page)}\n                            variant={currentPage === page ? \"primary\" : \"outline\"}\n                            size=\"sm\"\n                            className={currentPage === page ? \"bg-blue-600 text-white\" : \"\"}\n                          >\n                            {page}\n                          </Button>\n                        </React.Fragment>\n                      ))}\n                    <Button\n                      onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                      disabled={currentPage === pagination.pages}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      Selanjutnya\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Export Filter Modal */}\n      <ExportFilterModal\n        isOpen={showExportModal}\n        onClose={() => setShowExportModal(false)}\n        onExport={handleExportToExcel}\n        currentFilters={{\n          search: searchTerm,\n          reviewStatus: reviewStatusFilter,\n          finalStatus: finalStatusFilter,\n          startDate: '',\n          endDate: ''\n        }}\n        exportLoading={exportLoading}\n      />\n\n      {/* Detail Modal */}\n      {showDetailModal && selectedSubmission && (\n        <ReviewerSubmissionDetailModal\n          key={selectedSubmission.id}\n          isOpen={showDetailModal}\n          onClose={() => {\n            setShowDetailModal(false);\n            setSelectedSubmission(null);\n          }}\n          submissionId={selectedSubmission.id}\n          onReviewSubmitted={() => {\n            fetchSubmissions();\n          }}\n        />\n      )}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "ReviewerUserVerificationModal.tsx",
              "content": "'use client';\n\nimport React, { useState } from 'react';\nimport Button from '@/components/ui/button/Button';\nimport Card from '@/components/ui/Card';\nimport { UserData } from '@/types/user';\nimport { useToast } from '@/hooks/useToast';\nimport { \n  XMarkIcon, \n  CheckCircleIcon, \n  XCircleIcon,\n  ExclamationTriangleIcon,\n  UserIcon,\n  EnvelopeIcon,\n  BuildingOfficeIcon,\n  PhoneIcon,\n  MapPinIcon,\n  ClockIcon,\n  ShieldCheckIcon,\n  IdentificationIcon\n} from '@heroicons/react/24/outline';\n\ninterface ReviewerUserVerificationModalProps {\n  user: UserData | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUserUpdate?: (updatedUser: UserData) => void;\n}\n\nexport default function ReviewerUserVerificationModal({\n  user,\n  isOpen,\n  onClose,\n  onUserUpdate\n}: ReviewerUserVerificationModalProps) {\n  const [processing, setProcessing] = useState<string | null>(null);\n  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);\n  const [currentUser, setCurrentUser] = useState<UserData | null>(user);\n  const { showSuccess, showError } = useToast();\n\n  // Update local user state when prop changes\n  React.useEffect(() => {\n    setCurrentUser(user);\n  }, [user]);\n\n  if (!isOpen || !currentUser) return null;\n\n  const formatDate = (dateString: string | Date | null | undefined) => {\n    if (!dateString) return 'N/A';\n    \n    try {\n      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n      if (isNaN(date.getTime())) return 'N/A';\n      \n      return date.toLocaleDateString('id-ID', {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } catch (error) {\n      console.error('Error formatting date:', error);\n      return 'N/A';\n    }\n  };\n\n  const handleVerifyUser = async (action: 'approve' | 'reject') => {\n    if (!currentUser) return;\n    \n    setProcessing(currentUser.id);\n    \n    try {\n      const response = await fetch(`/api/reviewer/users/${currentUser.id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          status: action === 'approve' ? 'VERIFY' : 'REJECT'\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update user verification');\n      }\n\n      const result = await response.json();\n      \n      if (action === 'approve' && result.user) {\n        // Update local state immediately\n        setCurrentUser(result.user);\n        onUserUpdate?.(result.user);\n        showSuccess('Berhasil', 'User berhasil diverifikasi');\n      } else if (action === 'reject' && result.user) {\n        // Update local state for rejection\n        setCurrentUser(result.user);\n        onUserUpdate?.(result.user);\n        showSuccess('Berhasil', 'User berhasil ditolak');\n      }\n\n      setShowConfirmModal(null);\n      \n    } catch (error) {\n      console.error('Error updating user verification:', error);\n      showError('Error', error instanceof Error ? error.message : 'Failed to update user verification');\n    } finally {\n      setProcessing(null);\n    }\n  };\n\n  const handleModalClose = () => {\n    setShowConfirmModal(null);\n    onClose();\n  };\n\n  const isVerified = currentUser.verification_status === 'VERIFIED';\n  const isRejected = currentUser.verification_status === 'REJECTED';\n  const isPending = currentUser.verification_status === 'PENDING' || !currentUser.verification_status;\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n        <div className=\"max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n          <Card className=\"shadow-2xl\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4\">\n                  <UserIcon className=\"w-6 h-6 text-brand-600\" />\n                </div>\n                <div>\n                  <h2 className=\"text-xl font-semibold text-gray-900\">\n                    Detail User\n                  </h2>\n                  <p className=\"text-sm text-gray-500\">\n                    Informasi lengkap dan status verifikasi\n                  </p>\n                </div>\n              </div>\n              <Button\n                onClick={handleModalClose}\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"p-2\"\n              >\n                <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n              </Button>\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6 max-h-[calc(90vh-200px)] overflow-y-auto\">\n              <div className=\"space-y-8\">\n                {/* Status Section */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${\n                      isVerified \n                        ? 'bg-green-100 text-green-800' \n                        : isRejected\n                        ? 'bg-red-100 text-red-800'\n                        : 'bg-warning-100 text-warning-800'\n                    }`}>\n                      {isVerified ? (\n                        <CheckCircleIcon className=\"w-4 h-4\" />\n                      ) : isRejected ? (\n                        <XCircleIcon className=\"w-4 h-4\" />\n                      ) : (\n                        <ClockIcon className=\"w-4 h-4\" />\n                      )}\n                      {isVerified ? 'Terverifikasi' : isRejected ? 'Ditolak' : 'Menunggu Verifikasi'}\n                    </div>\n                    <div className={`px-3 py-1 rounded-full text-sm font-medium ${\n                      currentUser.role === 'VENDOR' \n                        ? 'bg-blue-100 text-blue-800' \n                        : currentUser.role === 'VERIFIER'\n                        ? 'bg-purple-100 text-purple-800'\n                        : 'bg-gray-100 text-gray-800'\n                    }`}>\n                      <IdentificationIcon className=\"w-4 h-4 inline mr-1\" />\n                      {currentUser.role}\n                    </div>\n                  </div>\n                </div>\n\n                {/* User Info Grid */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                  {/* Personal Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <UserIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Personal\n                      </h3>\n                      \n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <UserIcon className=\"w-5 h-5 text-blue-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {currentUser.officer_name}\n                            </p>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <EnvelopeIcon className=\"w-5 h-5 text-green-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Email</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {currentUser.email}\n                            </p>\n                          </div>\n                        </div>\n\n                        {currentUser.phone_number && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <PhoneIcon className=\"w-5 h-5 text-orange-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">No. Telepon</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {currentUser.phone_number}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        {currentUser.address && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <MapPinIcon className=\"w-5 h-5 text-purple-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {currentUser.address}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n\n                  {/* System Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <ShieldCheckIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Sistem\n                      </h3>\n\n                      <div className=\"space-y-4\">\n                        {currentUser.vendor_name && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <BuildingOfficeIcon className=\"w-5 h-5 text-indigo-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {currentUser.vendor_name}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <ClockIcon className=\"w-5 h-5 text-gray-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Tanggal Daftar</p>\n                            <p className=\"text-base font-medium text-gray-900\">\n                              {formatDate(currentUser.created_at)}\n                            </p>\n                          </div>\n                        </div>\n\n                        {isVerified && currentUser.verified_at && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <ShieldCheckIcon className=\"w-5 h-5 text-green-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Diverifikasi Pada</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {formatDate(currentUser.verified_at)}\n                              </p>\n                              {currentUser.verified_by && (\n                                <p className=\"text-sm text-gray-600 mt-1\">\n                                  \n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        )}\n\n                        {isRejected && currentUser.rejected_at && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <XCircleIcon className=\"w-5 h-5 text-red-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Ditolak Pada</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {formatDate(currentUser.rejected_at)}\n                              </p>\n                              \n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n\n                {/* Actions for Pending Users */}\n                {isPending && (\n                  <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                        <CheckCircleIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n                        Tindakan Verifikasi\n                      </h3>\n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, \n                        sedangkan penolakan akan mengubah status user menjadi ditolak.\n                      </p>\n\n                      <div className=\"flex flex-col sm:flex-row gap-4\">\n                        <Button\n                          onClick={() => setShowConfirmModal('approve')}\n                          disabled={processing === currentUser.id}\n                          variant=\"primary\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <CheckCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Setujui User\n                        </Button>\n                        <Button\n                          onClick={() => setShowConfirmModal('reject')}\n                          disabled={processing === currentUser.id}\n                          variant=\"destructive\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <XCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Tolak User\n                        </Button>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n\n                {/* Verification Status Info */}\n                {isVerified && (\n                  <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n                    <div className=\"p-6\">\n                      <div className=\"flex items-start\">\n                        <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                          <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                        </div>\n                        <div>\n                          <h4 className=\"text-lg font-semibold text-green-900 mb-2\">\n                            User Sudah Terverifikasi\n                          </h4>\n                          <p className=\"text-green-700\">\n                            User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan \n                            memiliki akses penuh ke fitur yang tersedia.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n\n                {/* Rejection Status Info */}\n                {isRejected && (\n                  <Card className=\"bg-gradient-to-r from-red-50 to-pink-50\">\n                    <div className=\"p-6\">\n                      <div className=\"flex items-start\">\n                        <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                          <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n                        </div>\n                        <div>\n                          <h4 className=\"text-lg font-semibold text-red-900 mb-2\">\n                            User Telah Ditolak\n                          </h4>\n                          <p className=\"text-red-700\">\n                            User ini telah ditolak dan tidak dapat mengakses sistem. User tidak dapat login dan \n                            perlu menghubungi administrator untuk informasi lebih lanjut.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n              </div>\n            </div>\n\n            {/* Footer */}\n            <div className=\"flex justify-end p-6 border-t border-gray-200\">\n              <Button onClick={handleModalClose} variant=\"outline\" size=\"md\">\n                Tutup\n              </Button>\n            </div>\n          </Card>\n        </div>\n      </div>\n\n      {/* Confirmation Modal */}\n      {showConfirmModal && currentUser && (\n        <ConfirmationModal\n          isOpen={!!showConfirmModal}\n          onClose={() => setShowConfirmModal(null)}\n          user={currentUser}\n          action={showConfirmModal}\n          isProcessing={processing === currentUser.id}\n          onConfirm={() => handleVerifyUser(showConfirmModal)}\n        />\n      )}\n    </>\n  );\n}\n\n// Modal Konfirmasi\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  user: UserData;\n  action: 'approve' | 'reject';\n  isProcessing: boolean;\n  onConfirm: () => void;\n}\n\nfunction ConfirmationModal({ isOpen, onClose, user, action, isProcessing, onConfirm }: ConfirmationModalProps) {\n  if (!isOpen) return null;\n\n  const isApprove = action === 'approve';\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]\">\n      <Card className=\"max-w-md w-full mx-4\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center mb-4\">\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n              isApprove ? 'bg-green-100' : 'bg-red-100'\n            }`}>\n              {isApprove ? (\n                <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n              ) : (\n                <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n              )}\n            </div>\n            <div className=\"ml-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}\n              </h3>\n            </div>\n          </div>\n\n          <p className=\"text-gray-600 mb-6\">\n            Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}\n            <strong className=\"text-gray-900\">{user.officer_name}</strong>?\n          </p>\n\n          {!isApprove && (\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 mb-6\">\n              <div className=\"flex items-start\">\n                <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-medium text-red-800 mb-1\">Peringatan!</p>\n                  <p className=\"text-red-700\">\n                    Status user akan diubah menjadi ditolak dan tidak dapat login lagi.\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-end space-x-3\">\n            <Button\n              onClick={onClose}\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={isProcessing}\n            >\n              Batal\n            </Button>\n            <Button\n              onClick={onConfirm}\n              disabled={isProcessing}\n              variant={isApprove ? \"primary\" : \"destructive\"}\n              size=\"sm\"\n            >\n              {isProcessing ? (\n                <span className=\"flex items-center\">\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                  Memproses...\n                </span>\n              ) : (\n                `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`\n              )}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "UserVerificationManagement.tsx",
              "content": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport Button from '@/components/ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport ReviewerUserVerificationModal from '@/components/reviewer/ReviewerUserVerificationModal';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  UserIcon,\n  ClockIcon,\n} from '@heroicons/react/24/outline';\nimport type { UserData } from '@/types/user';\n\ninterface Stats {\n  totalPending: number;\n  totalVerified: number;\n  totalRejected: number;\n  totalUsers: number;\n  todayRegistrations: number;\n}\n\ninterface UserVerificationManagementProps {\n  className?: string;\n  refreshTrigger?: number;\n}\n\ntype SortField = keyof UserData;\ntype SortOrder = 'asc' | 'desc';\n\n// Debounce helper\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n  useEffect(() => {\n    const t = setTimeout(() => setDebouncedValue(value), delay);\n    return () => clearTimeout(t);\n  }, [value, delay]);\n  return debouncedValue;\n}\n\nexport default function UserVerificationManagement({\n  className = '',\n  refreshTrigger = 0,\n}: UserVerificationManagementProps) {\n  const { showSuccess } = useToast();\n  const [users, setUsers] = useState<UserData[]>([]);\n  const [stats, setStats] = useState<Stats>({\n    totalPending: 0,\n    totalVerified: 0,\n    totalRejected: 0,\n    totalUsers: 0,\n    todayRegistrations: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  // Pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalUsersCount, setTotalUsersCount] = useState(0);\n  const [limit] = useState(10);\n\n  // Search & Filter\n  const [searchTerm, setSearchTerm] = useState('');\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n  const [statusFilter, setStatusFilter] = useState<'all' | 'pending' | 'verified' | 'rejected'>('all');\n\n  // Sorting\n  const [sortField, setSortField] = useState<SortField>('created_at');\n  const [sortOrder, setSortOrder] = useState<SortOrder>('desc');\n\n  // Modal: gunakan ReviewerUserVerificationModal\n  const [selectedUser, setSelectedUser] = useState<UserData | null>(null);\n  const [showVerificationModal, setShowVerificationModal] = useState(false);\n\n  // Search focus retainer\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  const fetchUsers = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: String(currentPage),\n        limit: String(limit),\n        sortBy: String(sortField),\n        sortOrder: String(sortOrder),\n      });\n      if (debouncedSearchTerm) params.append('search', debouncedSearchTerm);\n      if (statusFilter !== 'all') params.append('status', statusFilter);\n\n      const res = await fetch(`/api/reviewer/users?${params.toString()}`);\n      if (!res.ok) {\n        const err = await res.json().catch(() => ({}));\n        throw new Error(err.error || 'Gagal mengambil data user');\n      }\n      const data = await res.json();\n\n      // Expecting shape: { users: UserData[], stats: Stats, pagination: { totalPages, total } }\n      setUsers(Array.isArray(data.users) ? data.users : []);\n      setStats(\n        data.stats || {\n          totalPending: 0,\n          totalVerified: 0,\n          totalRejected: 0,\n          totalUsers: 0,\n          todayRegistrations: 0,\n        }\n      );\n      setTotalPages(Number(data.pagination?.totalPages || 1));\n      setTotalUsersCount(Number(data.pagination?.total || 0));\n    } catch (e) {\n      setError(e instanceof Error ? e.message : 'Terjadi kesalahan');\n      console.error('Error fetching users:', e);\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, debouncedSearchTerm, statusFilter, sortField, sortOrder, limit]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers, refreshTrigger]);\n\n  // Reset ke halaman 1 saat parameter list berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, statusFilter, sortField, sortOrder]);\n\n  // Kembalikan fokus ke search input setelah selesai loading\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  const handleSort = useCallback(\n    (field: SortField) => {\n      if (sortField === field) {\n        setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n      } else {\n        setSortField(field);\n        setSortOrder('asc');\n      }\n    },\n    [sortField, sortOrder]\n  );\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const resetFilters = useCallback(() => {\n    setSearchTerm('');\n    setStatusFilter('all');\n    setCurrentPage(1);\n    setSortField('created_at');\n    setSortOrder('desc');\n  }, []);\n\n  const getSortIcon = useCallback(\n    (field: SortField) => {\n      if (sortField !== field) return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n      return sortOrder === 'asc' ? (\n        <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      ) : (\n        <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />\n      );\n    },\n    [sortField, sortOrder]\n  );\n\n  const formatDate = useCallback((dateString: string | Date | null | undefined) => {\n    if (!dateString) return 'N/A';\n    try {\n      const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n      if (isNaN(date.getTime())) return 'N/A';\n      return date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' });\n    } catch {\n      return 'N/A';\n    }\n  }, []);\n\n  const getRoleBadge = useCallback((role: UserData['role'] | string) => {\n    const r = String(role); // toleransi enum/string\n    const colors: Record<string, string> = {\n      VENDOR: 'bg-green-100 text-green-800',\n      VERIFIER: 'bg-blue-100 text-blue-800',\n      REVIEWER: 'bg-yellow-100 text-yellow-800',\n      APPROVER: 'bg-orange-100 text-orange-800',\n      ADMIN: 'bg-purple-100 text-purple-800',\n      SUPER_ADMIN: 'bg-red-100 text-red-800',\n    };\n    return <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[r] || 'bg-gray-100 text-gray-800'}`}>{r}</span>;\n  }, []);\n\n  const getVerificationStatus = useCallback((user: UserData) => {\n    const s = user.verification_status || 'PENDING';\n    switch (s) {\n      case 'VERIFIED':\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">Terverifikasi</span>;\n      case 'REJECTED':\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800\">Ditolak</span>;\n      case 'PENDING':\n      default:\n        return <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-amber-100 text-amber-800\">Menunggu Verifikasi</span>;\n    }\n  }, []);\n\n  // === Modal wiring (gunakan ReviewerUserVerificationModal) ===\n  const openModal = (user: UserData) => {\n    setSelectedUser(user);\n    setShowVerificationModal(true);\n  };\n\n  const closeModal = () => {\n    setShowVerificationModal(false);\n    setSelectedUser(null);\n  };\n\n  // Saat modal update user (approve/reject), sinkronkan list & stats\n  const handleUserUpdateFromModal = (updated: UserData) => {\n    setUsers((prev) => prev.map((u) => (u.id === updated.id ? { ...u, ...updated } : u)));\n\n    // Optimistic stats tweak:\n    setStats((prev) => {\n      const old = users.find((u) => u.id === updated.id);\n      if (!old) return prev;\n      const oldS = old.verification_status || 'PENDING';\n      const newS = updated.verification_status || 'PENDING';\n      if (oldS === newS) return prev;\n\n      let { totalPending, totalVerified, totalRejected } = prev;\n      const { totalUsers, todayRegistrations } = prev;\n      if (oldS === 'PENDING') totalPending = Math.max(0, totalPending - 1);\n      if (oldS === 'VERIFIED') totalVerified = Math.max(0, totalVerified - 1);\n      if (oldS === 'REJECTED') totalRejected = Math.max(0, totalRejected - 1);\n\n      if (newS === 'PENDING') totalPending += 1;\n      if (newS === 'VERIFIED') totalVerified += 1;\n      if (newS === 'REJECTED') totalRejected += 1;\n\n      return { totalPending, totalVerified, totalRejected, totalUsers, todayRegistrations };\n    });\n\n    // Refetch agar 100% konsisten\n    fetchUsers().catch(() => {});\n    showSuccess('Berhasil', 'Status verifikasi diperbarui');\n  };\n\n  const paginationInfo = useMemo(\n    () => ({\n      currentPage,\n      totalPages,\n      total: totalUsersCount,\n      startItem: (currentPage - 1) * limit + 1,\n      endItem: Math.min(currentPage * limit, totalUsersCount),\n    }),\n    [currentPage, totalPages, totalUsersCount, limit]\n  );\n\n  // ==== Render table content ====\n  const tableContent = useMemo(() => {\n    if (error) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n            <div className=\"text-red-800\">{error}</div>\n            <Button onClick={fetchUsers} variant=\"destructive\" size=\"sm\" className=\"mt-2\">\n              Coba Lagi\n            </Button>\n          </div>\n        </div>\n      );\n    }\n\n    if (users.length === 0 && !loading) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-500\">Tidak ada user yang ditemukan</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th\n                  onClick={() => handleSort('officer_name')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Nama Petugas</span>\n                    {getSortIcon('officer_name')}\n                  </div>\n                </th>\n                <th\n                  onClick={() => handleSort('email')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Email</span>\n                    {getSortIcon('email')}\n                  </div>\n                </th>\n                <th\n                  onClick={() => handleSort('role')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Role</span>\n                    {getSortIcon('role')}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Vendor/Kontak</th>\n                <th\n                  onClick={() => handleSort('created_at')}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tgl Dibuat</span>\n                    {getSortIcon('created_at')}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n              </tr>\n            </thead>\n\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {users.map((user) => (\n                <tr key={user.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                    {user.address && <div className=\"text-sm text-gray-500 truncate max-w-xs\">{user.address}</div>}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.email}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">{getRoleBadge(user.role)}</td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.vendor_name ?? '-'}</div>\n                    {user.phone_number && <div className=\"text-sm text-gray-500\">{user.phone_number}</div>}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{formatDate(user.created_at)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">{getVerificationStatus(user)}</td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <div className=\"flex items-center justify-end\">\n                      <Button onClick={() => openModal(user)} variant=\"info\" size=\"sm\" className=\"px-3 py-1.5 whitespace-nowrap\">\n                        Lihat\n                      </Button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        {loading && (\n          <div className=\"flex justify-center items-center h-32\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\" />\n          </div>\n        )}\n      </div>\n    );\n  }, [users, loading, error, handleSort, getSortIcon, formatDate, getRoleBadge, getVerificationStatus]);\n\n  if (loading && users.length === 0) {\n    return (\n      <div className={`space-y-6 ${className}`}>\n        <div className=\"animate-pulse\">\n          <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-4\" />\n          <div className=\"space-y-3\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"h-16 bg-gray-200 rounded\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Statistik Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Verifikasi</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats.totalPending}</p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Terverifikasi</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.totalVerified}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n              <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats.totalRejected}</p>\n            </div>\n            <div className=\"p-3 bg-red-100 rounded-full\">\n              <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total User</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.totalUsers}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Registrasi Hari Ini</h3>\n              <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats.todayRegistrations}</p>\n            </div>\n            <div className=\"p-3 bg-purple-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-purple-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Search & Filter */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari nama, email, vendor, atau nomor telepon...\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        <select\n          value={statusFilter}\n          onChange={(e) => {\n            const v = e.target.value as 'all' | 'pending' | 'verified' | 'rejected';\n            setStatusFilter(v);\n            setCurrentPage(1);\n          }}\n          className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n        >\n          <option value=\"all\">Semua Status</option>\n          <option value=\"pending\">Belum Verifikasi</option>\n          <option value=\"verified\">Sudah Verifikasi</option>\n          <option value=\"rejected\">Ditolak</option>\n        </select>\n\n        <Button onClick={resetFilters} variant=\"outline\" size=\"sm\" className=\"px-3 py-2\">\n          Reset Filter\n        </Button>\n      </div>\n\n      {/* Tabel */}\n      <div className=\"relative\">{tableContent}</div>\n\n      {/* Pagination */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-gray-700\">\n            Menampilkan {paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.total} user\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setCurrentPage((p) => Math.max(p - 1, 1))}\n              disabled={currentPage === 1}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Sebelumnya\n            </button>\n\n            <div className=\"flex items-center space-x-1\">\n              {[...Array(totalPages)].map((_, i) => {\n                const page = i + 1;\n                if (page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)) {\n                  return (\n                    <button\n                      key={page}\n                      onClick={() => setCurrentPage(page)}\n                      className={`px-3 py-2 border text-sm font-medium rounded-md ${\n                        currentPage === page\n                          ? 'bg-blue-500 border-blue-500 text-white'\n                          : 'border-gray-300 text-gray-700 bg-white hover:bg-gray-50'\n                      }`}\n                    >\n                      {page}\n                    </button>\n                  );\n                } else if (page === currentPage - 2 || page === currentPage + 2) {\n                  return (\n                    <span key={page} className=\"text-gray-500\">\n                      …\n                    </span>\n                  );\n                }\n                return null;\n              })}\n            </div>\n\n            <button\n              onClick={() => setCurrentPage((p) => Math.min(p + 1, totalPages))}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Selanjutnya\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Modal verifikasi — pakai komponenmu */}\n      <ReviewerUserVerificationModal\n        user={selectedUser}\n        isOpen={showVerificationModal}\n        onClose={closeModal}\n        onUserUpdate={handleUserUpdateFromModal}\n      />\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "scanner",
          "children": [
            {
              "type": "file",
              "name": "CameraQRScanner.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { BrowserMultiFormatReader } from '@zxing/browser';\nimport { NotFoundException } from '@zxing/library';\nimport {\n  XMarkIcon,\n  CameraIcon,\n  StopIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { Modal } from '@/components/ui/modal';\nimport ScanModal from './ScanModal';\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n  scanned_at?: string;\n  scanned_by?: string;\n  scan_id?: string;\n}\n\ninterface CameraQRScannerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onScan?: (result: string) => void;\n  title?: string;\n  description?: string;\n}\n\nexport default function CameraQRScanner({ isOpen, onClose, onScan, title = \"Scan Barcode/QR Code SIMLOK\", description }: CameraQRScannerProps) {\n  const [isScanning, setIsScanning] = useState(false);\n  const [scanResult, setScanResult] = useState<ScanResult | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const codeReaderRef = useRef<BrowserMultiFormatReader | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const scanningRef = useRef<boolean>(false); // Track if scanning is active\n  const scanIdRef = useRef<number>(0); // Unique ID for each scan session\n\n  const resetScannerState = useCallback(() => {\n    console.log('=== RESETTING SCANNER STATE ===');\n    setScanResult(null);\n    setIsModalOpen(false);\n    setError(null);\n    scanningRef.current = false;\n    // Don't reset scanIdRef here as we want it to keep incrementing\n  }, []);\n\n  useEffect(() => {\n    if (isOpen) {\n      console.log('=== SCANNER OPENED ===');\n      // Reset previous scan results when opening scanner\n      resetScannerState();\n      initializeScanner();\n    } else {\n      console.log('=== SCANNER CLOSED ===');\n      stopScanner();\n    }\n\n    return () => {\n      console.log('=== SCANNER CLEANUP ===');\n      stopScanner();\n    };\n  }, [isOpen, resetScannerState]);\n\n  const initializeScanner = async () => {\n    try {\n      console.log('=== INITIALIZING SCANNER ===');\n      setError(null);\n      setScanResult(null); // Clear any previous scan results\n      setIsModalOpen(false); // Ensure modal is closed\n      scanningRef.current = false; // Reset scanning state\n      \n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        throw new Error('Camera not supported in this browser');\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { \n          facingMode: 'environment',\n          width: { ideal: 1280 },\n          height: { ideal: 720 }\n        }\n      });\n\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        streamRef.current = stream;\n        console.log('Video stream attached');\n      }\n\n      codeReaderRef.current = new BrowserMultiFormatReader();\n      console.log('BrowserMultiFormatReader initialized');\n      \n      setIsScanning(true);\n      startScanning();\n    } catch (err) {\n      console.error('Failed to initialize scanner:', err);\n      setError(err instanceof Error ? err.message : 'Failed to access camera');\n    }\n  };\n\n  const startScanning = async () => {\n    if (!videoRef.current) {\n      console.error('Video element not available');\n      return;\n    }\n\n    try {\n      // Increment scan ID for this session\n      scanIdRef.current += 1;\n      const currentScanId = scanIdRef.current;\n      \n      console.log(`=== STARTING SCAN PROCESS (ID: ${currentScanId}) ===`);\n      \n      // Reset any previous scan result before starting new scan\n      setScanResult(null);\n      setIsModalOpen(false);\n      \n      // Always create a fresh code reader instance to avoid state issues\n      if (codeReaderRef.current) {\n        codeReaderRef.current = null;\n      }\n      codeReaderRef.current = new BrowserMultiFormatReader();\n      console.log('Fresh BrowserMultiFormatReader created');\n      \n      scanningRef.current = true; // Mark scanning as active\n      \n      codeReaderRef.current.decodeFromVideoDevice(\n        undefined,\n        videoRef.current,\n        (result, error) => {\n          // Check if this is still the current scan session\n          if (scanIdRef.current !== currentScanId) {\n            console.log(`Ignoring result from old scan session (${currentScanId} vs ${scanIdRef.current})`);\n            return;\n          }\n          \n          // Check if scanning is still active before processing\n          if (!scanningRef.current) {\n            console.log('Scanning stopped, ignoring result');\n            return;\n          }\n\n          if (result) {\n            console.log(`=== SCAN SUCCESS (ID: ${currentScanId}) ===`);\n            console.log('Scanned text:', result.getText());\n            scanningRef.current = false; // Stop scanning immediately\n            handleScanSuccess(result.getText());\n          }\n          \n          if (error && !(error instanceof NotFoundException)) {\n            console.log('Scan error (non-critical):', error.message);\n          }\n        }\n      );\n    } catch (err) {\n      console.error('Error during scanning:', err);\n      setError('Scanning failed');\n      scanningRef.current = false;\n    }\n  };\n\n  const handleScanSuccess = async (scannedText: string) => {\n    console.log('=== PROCESSING SCAN RESULT ===');\n    console.log('Scanned text:', scannedText);\n    \n    try {\n      // Stop all scanning activity immediately\n      setIsScanning(false);\n      scanningRef.current = false;\n\n      const response = await fetch('/api/qr/verify', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          qrData: scannedText,\n          scanner_type: 'barcode_scanner'\n        }),\n      });\n\n      console.log('API response status:', response.status);\n      const result = await response.json();\n      console.log('API response data:', result);\n      console.log('API response data.data:', result.data);\n      console.log('API response data.data.submission:', result.data?.submission);\n\n      setScanResult(result);\n      \n      // Call onScan callback if provided\n      if (onScan) {\n        onScan(scannedText);\n      }\n      \n      console.log('=== SETTING MODAL STATE ===');\n      console.log('result.success:', result.success);\n      console.log('About to set modal open to true');\n      setIsModalOpen(true);\n      console.log('Modal state should be open now');\n      \n    } catch (error) {\n      console.error('Error verifying QR:', error);\n      const errorResult = {\n        success: false,\n        error: 'Failed to verify barcode/QR code'\n      };\n      setScanResult(errorResult);\n      setIsModalOpen(true);\n    }\n  };\n\n  const stopCamera = () => {\n    console.log('=== STOPPING CAMERA ===');\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => {\n        track.stop();\n        console.log('Camera track stopped');\n      });\n      streamRef.current = null;\n    }\n  };\n\n  const stopScanner = () => {\n    console.log('=== STOPPING SCANNER ===');\n    setIsScanning(false);\n    scanningRef.current = false; // Stop scanning process\n    \n    if (codeReaderRef.current) {\n      try {\n        // Create a new instance to completely reset the scanner\n        codeReaderRef.current = null;\n        console.log('Code reader cleared');\n      } catch (error) {\n        console.log('Error clearing code reader:', error);\n      }\n    }\n    \n    stopCamera();\n  };\n\n  const handleClose = () => {\n    console.log('=== CLOSING SCANNER ===');\n    stopScanner();\n    setScanResult(null);\n    setError(null);\n    onClose();\n  };\n\n  const handleModalClose = () => {\n    console.log('=== CLOSING RESULT MODAL ===');\n    setIsModalOpen(false);\n    setScanResult(null);\n    setError(null);\n    \n    // Restart scanning after modal closes if scanner is still open\n    if (isOpen && videoRef.current) {\n      console.log('=== RESTARTING SCANNER AFTER MODAL CLOSE ===');\n      // Add delay to ensure state is properly reset and avoid race conditions\n      setTimeout(() => {\n        setIsScanning(true);\n        scanningRef.current = false; // Reset scanning state\n        startScanning();\n      }, 300); // Increased delay for more stability\n    }\n  };\n\n  console.log('=== RENDER STATE ===');\n  console.log('isOpen:', isOpen);\n  console.log('isScanning:', isScanning);\n  console.log('scanResult:', scanResult);\n  console.log('isModalOpen:', isModalOpen);\n\n  return (\n    <>\n      <Modal isOpen={isOpen} onClose={handleClose}>\n        <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n          <div className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">\n              {title}\n            </h2>\n            {description && (\n              <p className=\"text-gray-600 mb-4\">\n                {description}\n              </p>\n            )}\n            \n            <div className=\"space-y-4\">\n              {error && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                  <p className=\"text-red-700\">{error}</p>\n                </div>\n              )}\n\n              <div className=\"relative bg-black rounded-lg overflow-hidden\">\n                <video\n                  ref={videoRef}\n                  autoPlay\n                  playsInline\n                  muted\n                  className=\"w-full h-80 object-cover\"\n                />\n                \n                {isScanning && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"border-2 border-green-500 w-64 h-64 rounded-lg animate-pulse\">\n                      <div className=\"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-green-500\"></div>\n                      <div className=\"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-green-500\"></div>\n                      <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-green-500\"></div>\n                      <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-green-500\"></div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex justify-between items-center\">\n                <p className=\"text-sm text-gray-600\">\n                  {isScanning ? 'Scanning for barcode/QR code...' : 'Camera ready'}\n                </p>\n                \n                <div className=\"flex gap-2\">\n                  {!isScanning ? (\n                    <Button onClick={initializeScanner} startIcon={<CameraIcon className=\"h-4 w-4\" />}>\n                      Start Scanning\n                    </Button>\n                  ) : (\n                    <Button onClick={stopScanner} variant=\"outline\" startIcon={<StopIcon className=\"h-4 w-4\" />}>\n                      Stop Scanning\n                    </Button>\n                  )}\n                  \n                  <Button onClick={handleClose} variant=\"outline\" startIcon={<XMarkIcon className=\"h-4 w-4\" />}>\n                    Close\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Modal>\n\n      {scanResult && (\n        <ScanModal\n          isOpen={isModalOpen}\n          onClose={handleModalClose}\n          result={scanResult}\n        />\n      )}\n    </>\n  );\n}"
            },
            {
              "type": "file",
              "name": "QrScanErrorModal.tsx",
              "content": "'use client';\n\nimport React from 'react';\nimport { X, XCircle, AlertTriangle, RefreshCw } from 'lucide-react';\n\ninterface QrScanErrorModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  error: string;\n  message?: string | undefined;\n  errorType?: 'invalid' | 'expired' | 'network' | 'unknown';\n  onRetry?: () => void;\n}\n\nconst QrScanErrorModal: React.FC<QrScanErrorModalProps> = ({\n  isOpen,\n  onClose,\n  error: errorMessage,\n  message,\n  errorType = 'unknown',\n  onRetry\n}) => {\n  if (!isOpen) return null;\n\n  const getErrorIcon = () => {\n    switch (errorType) {\n      case 'invalid':\n        return <XCircle className=\"h-12 w-12 text-red-500\" />;\n      case 'expired':\n        return <AlertTriangle className=\"h-12 w-12 text-orange-500\" />;\n      case 'network':\n        return <AlertTriangle className=\"h-12 w-12 text-yellow-500\" />;\n      default:\n        return <XCircle className=\"h-12 w-12 text-red-500\" />;\n    }\n  };\n\n  const getErrorTitle = () => {\n    switch (errorType) {\n      case 'invalid':\n        return 'QR Code Tidak Valid';\n      case 'expired':\n        return 'QR Code Kedaluwarsa';\n      case 'network':\n        return 'Masalah Koneksi';\n      default:\n        return 'Scan Gagal';\n    }\n  };\n\n  const getErrorDescription = () => {\n    switch (errorType) {\n      case 'invalid':\n        return 'QR Code yang dipindai tidak valid atau bukan QR Code SIMLOK.';\n      case 'expired':\n        return 'QR Code yang dipindai sudah kedaluwarsa. Silakan minta QR Code baru.';\n      case 'network':\n        return 'Terjadi masalah koneksi saat memverifikasi QR Code.';\n      default:\n        return 'Terjadi kesalahan saat memindai QR Code.';\n    }\n  };\n\n  const getHeaderColor = () => {\n    switch (errorType) {\n      case 'expired':\n        return 'bg-orange-50 border-orange-200';\n      case 'network':\n        return 'bg-yellow-50 border-yellow-200';\n      default:\n        return 'bg-red-50 border-red-200';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        {/* Header */}\n        <div className={`flex items-center justify-between p-4 border-b ${getHeaderColor()}`}>\n          <div className=\"flex items-center space-x-2\">\n            {getErrorIcon()}\n            <h2 className=\"text-lg font-semibold text-gray-800\">{getErrorTitle()}</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 space-y-4\">\n          {/* Error Description */}\n          <div className=\"text-center\">\n            <p className=\"text-gray-600 mb-2\">{message || getErrorDescription()}</p>\n            {errorMessage && (\n              <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-3\">\n                <p className=\"text-sm text-gray-700 font-mono\">{errorMessage}</p>\n              </div>\n            )}\n          </div>\n\n          {/* Solutions/Tips */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-blue-800 mb-2\">Tips:</h4>\n            <ul className=\"text-sm text-blue-700 space-y-1\">\n              {errorType === 'invalid' && (\n                <>\n                  <li>• Pastikan QR Code adalah QR Code SIMLOK yang valid</li>\n                  <li>• Pastikan QR Code tidak rusak atau terpotong</li>\n                  <li>• Coba posisikan QR Code lebih dekat ke kamera</li>\n                </>\n              )}\n              {errorType === 'expired' && (\n                <>\n                  <li>• Minta QR Code baru dari sistem</li>\n                  <li>• Pastikan permohonan masih dalam periode yang valid</li>\n                </>\n              )}\n              {errorType === 'network' && (\n                <>\n                  <li>• Periksa koneksi internet</li>\n                  <li>• Coba lagi dalam beberapa saat</li>\n                </>\n              )}\n              {errorType === 'unknown' && (\n                <>\n                  <li>• Coba scan ulang QR Code</li>\n                  <li>• Pastikan kamera dapat membaca QR Code dengan jelas</li>\n                </>\n              )}\n            </ul>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-gray-200 bg-gray-50 space-y-2\">\n          {onRetry && (\n            <button\n              onClick={onRetry}\n              className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2\"\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n              <span>Coba Scan Lagi</span>\n            </button>\n          )}\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\n          >\n            Tutup\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QrScanErrorModal;\n"
            },
            {
              "type": "file",
              "name": "QrScanResultModal.tsx",
              "content": "'use client';\n\nimport React from 'react';\nimport { X, CheckCircle, User, Calendar, MapPin, QrCode } from 'lucide-react';\n\ninterface Submission {\n  id: string;\n  number: string;\n  title: string;\n  task: string;\n  workers?: { name: string }[];\n  vendor?: { name: string };\n  location?: string;\n  implementation_start_date?: string | null;\n  implementation_end_date?: string | null;\n  status: string;\n}\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n}\n\ninterface QrScanResultModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  result: ScanResult;\n  submission?: Submission | null;\n  scanTime?: Date;\n  scannedBy?: string;\n  onScanAnother: () => void;\n}\n\nconst QrScanResultModal: React.FC<QrScanResultModalProps> = ({\n  isOpen,\n  onClose,\n  result,\n  submission,\n  scanTime,\n  scannedBy,\n  onScanAnother\n}) => {\n  // Extract submission from result if not provided directly\n  const submissionData = submission || result.data?.submission;\n  \n  if (!isOpen || !result.success || !submissionData) return null;\n\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return 'Tidak ditentukan';\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status.toLowerCase()) {\n      case 'completed':\n        return 'text-green-600 bg-green-100';\n      case 'in_progress':\n        return 'text-blue-600 bg-blue-100';\n      case 'pending':\n        return 'text-yellow-600 bg-yellow-100';\n      default:\n        return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status.toLowerCase()) {\n      case 'completed':\n        return 'Selesai';\n      case 'in_progress':\n        return 'Sedang Berlangsung';\n      case 'pending':\n        return 'Menunggu';\n      default:\n        return status;\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-green-50\">\n          <div className=\"flex items-center space-x-2\">\n            <CheckCircle className=\"h-6 w-6 text-green-600\" />\n            <h2 className=\"text-lg font-semibold text-green-800\">QR Code Valid</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4 space-y-4\">\n          {/* Scan Information */}\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n            <h4 className=\"font-medium text-green-800 mb-2\">Informasi Scan</h4>\n            <div className=\"space-y-1 text-sm\">\n              {scanTime && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">Waktu Scan:</span>\n                  <span className=\"text-green-800 font-medium\">{scanTime.toLocaleString('id-ID')}</span>\n                </div>\n              )}\n              {scannedBy && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">Dipindai oleh:</span>\n                  <span className=\"text-green-800 font-medium\">{scannedBy}</span>\n                </div>\n              )}\n              {/* {scanId && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">ID Scan:</span>\n                  <span className=\"text-green-800 font-mono text-xs\">{scanId}</span>\n                </div>\n              )} */}\n            </div>\n          </div>\n\n          {/* Submission Number */}\n          <div className=\"text-center\">\n            <div className=\"text-sm text-gray-600\">Nomor Permohonan</div>\n            <div className=\"text-xl font-bold text-gray-900\">{submissionData.number}</div>\n          </div>\n\n          {/* Status */}\n          <div className=\"flex justify-center\">\n            <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(submissionData.status)}`}>\n              {getStatusText(submissionData.status)}\n            </span>\n          </div>\n\n          {/* Title */}\n          <div>\n            <div className=\"text-sm font-medium text-gray-700 mb-1\">Judul Pekerjaan</div>\n            <div className=\"text-gray-900\">{submissionData.title}</div>\n          </div>\n\n          {/* Task */}\n          <div>\n            <div className=\"text-sm font-medium text-gray-700 mb-1\">Uraian Pekerjaan</div>\n            <div className=\"text-gray-900 text-sm\">{submissionData.task}</div>\n          </div>\n\n          {/* Vendor */}\n          {submissionData.vendor && (\n            <div className=\"flex items-start space-x-2\">\n              <User className=\"h-4 w-4 text-gray-500 mt-1\" />\n              <div>\n                <div className=\"text-sm font-medium text-gray-700\">Vendor</div>\n                <div className=\"text-gray-900\">{submissionData.vendor.name}</div>\n              </div>\n            </div>\n          )}\n\n          {/* Location */}\n          {submissionData.location && (\n            <div className=\"flex items-start space-x-2\">\n              <MapPin className=\"h-4 w-4 text-gray-500 mt-1\" />\n              <div>\n                <div className=\"text-sm font-medium text-gray-700\">Lokasi</div>\n                <div className=\"text-gray-900\">{submissionData.location}</div>\n              </div>\n            </div>\n          )}\n\n          {/* Implementation Period */}\n          <div className=\"flex items-start space-x-2\">\n            <Calendar className=\"h-4 w-4 text-gray-500 mt-1\" />\n            <div>\n              <div className=\"text-sm font-medium text-gray-700\">Periode Pelaksanaan</div>\n              <div className=\"text-gray-900 text-sm\">\n                {formatDate(submissionData.implementation_start_date || null)} - {formatDate(submissionData.implementation_end_date || null)}\n              </div>\n            </div>\n          </div>\n\n          {/* Workers */}\n          {submissionData.workers && submissionData.workers.length > 0 && (\n            <div>\n              <div className=\"text-sm font-medium text-gray-700 mb-1\">Pekerja</div>\n              <div className=\"space-y-1\">\n                {submissionData.workers.map((worker: any, index: number) => (\n                  <div key={index} className=\"text-sm text-gray-900 bg-gray-50 px-2 py-1 rounded\">\n                    {worker.name}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-gray-200 bg-gray-50 space-y-2\">\n          {onScanAnother && (\n            <button\n              onClick={() => {\n                onScanAnother();\n                onClose();\n              }}\n              className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2\"\n            >\n              <QrCode className=\"h-4 w-4\" />\n              <span>Scan QR Code Lain</span>\n            </button>\n          )}\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\n          >\n            Tutup\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QrScanResultModal;\n"
            },
            {
              "type": "file",
              "name": "ScanHistory.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { \n  QrCodeIcon, \n  EyeIcon, \n  ClockIcon, \n  UserIcon,\n  BuildingOfficeIcon,\n  DocumentIcon,\n  MapPinIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport Alert from '@/components/ui/alert/Alert';\nimport Button from '@/components/ui/button/Button';\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\n\ninterface ScanHistoryItem {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;\n  notes?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    role: string;\n  };\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    officer_name: string;\n    job_description: string;\n    work_location: string;\n    approval_status: string;\n  };\n}\n\ninterface Pagination {\n  total: number;\n  limit: number;\n  offset: number;\n  hasMore: boolean;\n}\n\ninterface ScanHistoryProps {\n  submissionId?: string; // If provided, show scans for specific submission only\n  className?: string;\n}\n\ninterface ScanHistoryRef {\n  closeDetailModal: () => void;\n}\n\nconst ScanHistory = forwardRef<ScanHistoryRef, ScanHistoryProps>(function ScanHistory({ submissionId, className = '' }, ref) {\n  const { data: session } = useSession();\n  const [scans, setScans] = useState<ScanHistoryItem[]>([]);\n  const [pagination, setPagination] = useState<Pagination>({\n    total: 0,\n    limit: 20,\n    offset: 0,\n    hasMore: false\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedScan, setSelectedScan] = useState<ScanHistoryItem | null>(null);\n\n  // Expose methods to parent component via ref\n  useImperativeHandle(ref, () => ({\n    closeDetailModal: () => {\n      setSelectedScan(null);\n    }\n  }));\n\n  // Fetch scan history\n  const fetchScanHistory = async (offset = 0) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const params = new URLSearchParams({\n        limit: pagination.limit.toString(),\n        offset: offset.toString(),\n      });\n\n      if (submissionId) {\n        params.append('submission_id', submissionId);\n      }\n\n      const response = await fetch(`/api/qr/verify?${params}`);\n      const data = await response.json();\n\n      if (response.ok) {\n        setScans(data.scans);\n        setPagination(data.pagination);\n      } else {\n        setError(data.error || 'Failed to fetch scan history');\n      }\n    } catch (err) {\n      console.error('Error fetching scan history:', err);\n      setError('Network error while fetching scan history');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Load data on mount\n  useEffect(() => {\n    fetchScanHistory();\n  }, [submissionId]);\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return {\n      date: date.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: 'long',\n        year: 'numeric'\n      }),\n      time: date.toLocaleTimeString('id-ID', {\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      })\n    };\n  };\n\n  // Get role badge color\n  const getRoleBadge = (role: string) => {\n    const roleConfig = {\n      ADMIN: { label: 'Admin', className: 'bg-purple-100 text-purple-800' },\n      VERIFIER: { label: 'Verifier', className: 'bg-blue-100 text-blue-800' },\n      VENDOR: { label: 'Vendor', className: 'bg-green-100 text-green-800' }\n    };\n    \n    const config = roleConfig[role as keyof typeof roleConfig] || { \n      label: role, \n      className: 'bg-gray-100 text-gray-800' \n    };\n    \n    return (\n      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${config.className}`}>\n        {config.label}\n      </span>\n    );\n  };\n\n  // Handle pagination\n  const handlePrevious = () => {\n    const newOffset = Math.max(0, pagination.offset - pagination.limit);\n    fetchScanHistory(newOffset);\n  };\n\n  const handleNext = () => {\n    const newOffset = pagination.offset + pagination.limit;\n    fetchScanHistory(newOffset);\n  };\n\n  if (!session) {\n    return (\n      <Alert\n        variant=\"error\"\n        title=\"Akses Ditolak\"\n        message=\"Anda harus login untuk melihat history scan\"\n      />\n    );\n  }\n\n  return (\n    <div className={`scan-history ${className}`}>\n      <div className=\"bg-white rounded-lg shadow-lg\">\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <ClockIcon className=\"h-6 w-6 text-blue-500 mr-3\" />\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  {submissionId ? 'History Scan Submission' : 'History Scan QR Code'}\n                </h2>\n                <p className=\"text-sm text-gray-500\">\n                  {pagination.total} total scan records\n                </p>\n              </div>\n            </div>\n            \n            <Button\n              onClick={() => fetchScanHistory(pagination.offset)}\n              variant=\"secondary\"\n              size=\"sm\"\n            >\n              Refresh\n            </Button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6\">\n          {/* Error State */}\n          {error && (\n            <Alert\n              variant=\"error\"\n              title=\"Error\"\n              message={error}\n              className=\"mb-4\"\n            />\n          )}\n\n          {/* Loading State */}\n          {isLoading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <LoadingSpinner size=\"lg\" className=\"mr-3\" />\n              <span className=\"text-gray-600\">Memuat riwayat scan...</span>\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!isLoading && scans.length === 0 && !error && (\n            <div className=\"text-center py-12\">\n              <QrCodeIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                Belum Ada Scan\n              </h3>\n              <p className=\"text-gray-500\">\n                {submissionId \n                  ? 'Submission ini belum pernah di-scan'\n                  : 'Belum ada QR code yang di-scan'\n                }\n              </p>\n            </div>\n          )}\n\n          {/* Scan History List */}\n          {!isLoading && scans.length > 0 && (\n            <div className=\"space-y-4\">\n              {scans.map((scan) => {\n                const dateTime = formatDate(scan.scanned_at);\n                \n                return (\n                  <div\n                    key={scan.id}\n                    className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1 space-y-3\">\n                        {/* Scan Info */}\n                        <div className=\"flex items-center space-x-4\">\n                          <div className=\"flex items-center text-sm text-gray-600\">\n                            <ClockIcon className=\"h-4 w-4 mr-1\" />\n                            <span className=\"font-medium\">{dateTime.date}</span>\n                            <span className=\"mx-2\">•</span>\n                            <span>{dateTime.time}</span>\n                          </div>\n                          \n                          <div className=\"flex items-center text-sm\">\n                            <UserIcon className=\"h-4 w-4 text-gray-400 mr-1\" />\n                            <span className=\"font-medium text-gray-700\">\n                              {scan.scanner_name || scan.user.officer_name}\n                            </span>\n                            <span className=\"ml-2\">\n                              {getRoleBadge(scan.user.role)}\n                            </span>\n                          </div>\n                        </div>\n\n                        {/* Submission Info */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                          <div className=\"flex items-center\">\n                            <DocumentIcon className=\"h-4 w-4 text-blue-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">SIMLOK:</span>\n                              <span className=\"ml-1 font-semibold text-blue-600\">\n                                {scan.submission.simlok_number}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"flex items-center\">\n                            <BuildingOfficeIcon className=\"h-4 w-4 text-green-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Vendor:</span>\n                              <span className=\"ml-1 font-medium\">\n                                {scan.submission.vendor_name}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"flex items-center\">\n                            <UserIcon className=\"h-4 w-4 text-purple-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Petugas:</span>\n                              <span className=\"ml-1 font-medium\">\n                                {scan.submission.officer_name}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Job Description */}\n                        <div className=\"text-sm\">\n                          <span className=\"text-gray-600\">Pekerjaan:</span>\n                          <span className=\"ml-1\">{scan.submission.job_description}</span>\n                        </div>\n\n                        {/* Location */}\n                        <div className=\"text-sm\">\n                          <span className=\"text-gray-600\">Lokasi:</span>\n                          <span className=\"ml-1\">{scan.submission.work_location}</span>\n                        </div>\n\n                        {/* Scan Location */}\n                        {scan.scan_location && (\n                          <div className=\"flex items-center text-sm\">\n                            <MapPinIcon className=\"h-4 w-4 text-orange-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Lokasi Scan:</span>\n                              <span className=\"ml-1 font-medium text-orange-600\">{scan.scan_location}</span>\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Notes */}\n                        {scan.notes && (\n                          <div className=\"text-sm bg-blue-50 p-3 rounded-md border-l-4 border-blue-200\">\n                            <span className=\"text-blue-700 font-medium\">Catatan:</span>\n                            <span className=\"ml-1 text-blue-600\">{scan.notes}</span>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Actions */}\n                      <div className=\"flex-shrink-0 ml-4\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                        >\n                          <EyeIcon className=\"h-4 w-4 mr-1\" />\n                          Detail\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Pagination */}\n          {!isLoading && scans.length > 0 && (\n            <div className=\"flex items-center justify-between mt-6 pt-4 border-t border-gray-200\">\n              <div className=\"text-sm text-gray-600\">\n                Showing {pagination.offset + 1} to {Math.min(pagination.offset + pagination.limit, pagination.total)} of {pagination.total} scans\n              </div>\n              \n              <div className=\"flex space-x-2\">\n                <Button\n                  onClick={handlePrevious}\n                  disabled={pagination.offset === 0}\n                  variant=\"secondary\"\n                  size=\"sm\"\n                >\n                  <ChevronLeftIcon className=\"h-4 w-4 mr-1\" />\n                  Previous\n                </Button>\n                \n                <Button\n                  onClick={handleNext}\n                  disabled={!pagination.hasMore}\n                  variant=\"secondary\"\n                  size=\"sm\"\n                >\n                  Next\n                  <ChevronRightIcon className=\"h-4 w-4 ml-1\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          <div className=\"flex min-h-full items-center justify-center p-4\">\n            <div \n              className=\"fixed inset-0 bg-black/30 transition-opacity\"\n              onClick={() => setSelectedScan(null)}\n            />\n            \n            <div className=\"relative bg-white rounded-lg shadow-xl max-w-2xl w-full\">\n              <div className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n                  Detail Scan QR Code\n                </h3>\n                \n                <div className=\"space-y-4\">\n                  {/* Scan Details */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <span className=\"block text-sm font-medium text-gray-600\">Waktu Scan</span>\n                      <span className=\"text-gray-900\">\n                        {formatDate(selectedScan.scanned_at).date} - {formatDate(selectedScan.scanned_at).time}\n                      </span>\n                    </div>\n                    \n                    <div>\n                      <span className=\"block text-sm font-medium text-gray-600\">Di-scan Oleh</span>\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"text-gray-900\">\n                          {selectedScan.scanner_name || selectedScan.user.officer_name}\n                        </span>\n                        {getRoleBadge(selectedScan.user.role)}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Submission Details */}\n                  <div className=\"pt-4 border-t border-gray-200\">\n                    <h4 className=\"font-medium text-gray-900 mb-3\">Submission Details</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                      <div>\n                        <span className=\"block font-medium text-gray-600\">SIMLOK Number</span>\n                        <span className=\"text-blue-600 font-semibold\">\n                          {selectedScan.submission.simlok_number}\n                        </span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Vendor</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.vendor_name}</span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Officer</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.officer_name}</span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Status</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.approval_status}</span>\n                      </div>\n                      \n                      <div className=\"md:col-span-2\">\n                        <span className=\"block font-medium text-gray-600\">Job Description</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.job_description}</span>\n                      </div>\n                      \n                      <div className=\"md:col-span-2\">\n                        <span className=\"block font-medium text-gray-600\">Work Location</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.work_location}</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Scan Location */}\n                  {selectedScan.scan_location && (\n                    <div className=\"pt-4 border-t border-gray-200\">\n                      <div className=\"flex items-center\">\n                        <MapPinIcon className=\"h-5 w-5 text-orange-500 mr-2\" />\n                        <span className=\"block font-medium text-gray-600 mb-2\">Scan Location</span>\n                      </div>\n                      <div className=\"bg-orange-50 p-3 rounded-md text-sm text-orange-700 border-l-4 border-orange-200\">\n                        {selectedScan.scan_location}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Notes */}\n                  {selectedScan.notes && (\n                    <div className=\"pt-4 border-t border-gray-200\">\n                      <span className=\"block font-medium text-gray-600 mb-2\">Notes</span>\n                      <div className=\"bg-gray-50 p-3 rounded-md text-sm text-gray-700\">\n                        {selectedScan.notes}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Close Button */}\n                <div className=\"mt-6 flex justify-end\">\n                  <Button\n                    onClick={() => setSelectedScan(null)}\n                    variant=\"secondary\"\n                  >\n                    Close\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default ScanHistory;\n"
            },
            {
              "type": "file",
              "name": "ScanModal.tsx",
              "content": "'use client';\n\nimport React from 'react';\nimport { XMarkIcon } from '@heroicons/react/24/outline';\nimport { CheckCircleIcon, XCircleIcon } from '@heroicons/react/24/solid';\nimport Button from '@/components/ui/button/Button';\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n  scanned_at?: string;\n  scanned_by?: string;\n  scan_id?: string;\n  previousScan?: {\n    scanDate: string | Date;\n    scanId: string;\n    scannerName: string;\n  };\n}\n\ninterface ScanModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  result: ScanResult;\n}\n\nconst ScanModal: React.FC<ScanModalProps> = ({\n  isOpen,\n  onClose,\n  result\n}) => {\n  if (!isOpen) return null;\n\n  // Debug logging\n  console.log('=== SCAN MODAL DEBUG ===');\n  console.log('result:', result);\n  console.log('result.data:', result.data);\n  console.log('result.data?.submission:', result.data?.submission);\n\n  const submission = result.data?.submission;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 md:p-8\"\n      onClick={onClose}\n    >\n      <div \n        className=\"bg-white  rounded-lg  shadow-xl h-full w-full md:h-auto md:max-w-2xl md:min-w-[600px] md:max-h-[80vh] flex flex-col\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"p-4 md:p-6 h-full flex flex-col overflow-hidden\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-4 shrink-0\">\n            <h2 className=\"text-xl font-semibold\">\n              {result.success ? 'Scan Berhasil' : 'Scan Gagal'}\n            </h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 p-1\"\n            >\n              <XMarkIcon className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          {/* Scrollable Content */}\n          <div className=\"flex-1 overflow-y-auto\">\n            {/* Status Icon & Message */}\n            <div className=\"text-center mb-6\">\n              {result.success ? (\n                <CheckCircleIcon className=\"h-16 w-16 text-green-500 mx-auto mb-3\" />\n              ) : (\n                <XCircleIcon className=\"h-16 w-16 text-red-500 mx-auto mb-3\" />\n              )}\n              \n              <p className=\"text-lg font-medium mb-2\">\n                {result.success ? 'Barcode/QR Code Valid' : \n                 result.error === 'duplicate_scan_same_day' ? 'Sudah Discan Hari Ini' :\n                 result.error === 'already_scanned_by_other' ? 'Sudah Discan Verifikator Lain' :\n                 result.error === 'duplicate_scan' ? 'QR Code Sudah Pernah Discan' :\n                 'Barcode/QR Code Tidak Valid'}\n              </p>\n              \n              {result.message && (\n                <p className=\"text-gray-600 text-sm md:text-base\">{result.message}</p>\n              )}\n              \n              {/* Show previous scan info for all duplicate error types */}\n              {(result.error === 'duplicate_scan_same_day' || \n                result.error === 'already_scanned_by_other' || \n                result.error === 'duplicate_scan') && result.previousScan && (\n                <div className=\"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200 text-left max-w-md mx-auto\">\n                  <h4 className=\"text-sm font-medium text-yellow-800 mb-2\">Informasi Scan Sebelumnya:</h4>\n                  <div className=\"text-xs text-yellow-700 space-y-1\">\n                    <p><span className=\"font-medium\">Verifikator:</span> {result.previousScan.scannerName}</p>\n                    <p><span className=\"font-medium\">Waktu:</span> {new Date(result.previousScan.scanDate).toLocaleDateString('id-ID', {\n                      day: '2-digit',\n                      month: '2-digit',\n                      year: 'numeric',\n                      hour: '2-digit',\n                      minute: '2-digit',\n                    })}</p>\n                  </div>\n                </div>\n              )}\n              \n              {result.error && !['duplicate_scan', 'duplicate_scan_same_day', 'already_scanned_by_other'].includes(result.error) && (\n                <p className=\"text-red-600 text-sm md:text-base\">{result.error}</p>\n              )}\n            </div>\n\n            {/* Submission Details */}\n            {result.success && submission && (\n              <div className=\"bg-gray-50 rounded-lg p-4 md:p-6 mb-6\">\n                <h3 className=\"font-semibold mb-4 text-lg\">Detail SIMLOK</h3>\n                <div className=\"space-y-4 md:space-y-3\">\n                  <div className=\"grid md:grid-cols-2 gap-4\">\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Nomor SIMLOK:</span>\n                      <p className=\"font-medium\">{submission.number || '-'}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Status:</span>\n                      <p className=\"font-medium capitalize\">\n                        {submission.status === 'approved' ? 'Disetujui' : \n                         submission.status === 'pending' ? 'Menunggu' : \n                         submission.status === 'rejected' ? 'Ditolak' : \n                         submission.status}\n                      </p>\n                    </div>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Vendor:</span>\n                    <p className=\"font-medium\">{submission.vendor?.name || '-'}</p>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Pekerjaan:</span>\n                    <p className=\"font-medium\">{submission.title || submission.task || '-'}</p>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Lokasi:</span>\n                    <p className=\"font-medium\">{submission.location || '-'}</p>\n                  </div>\n                  {submission.workers && submission.workers.length > 0 && (\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Pekerja:</span>\n                      <div className=\"mt-1\">\n                        {submission.workers.map((worker: any, index: number) => (\n                          <p key={index} className=\"font-medium text-sm\">\n                            • {worker.name}\n                          </p>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  {(submission.implementation_start_date || submission.implementation_end_date) && (\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Periode Pelaksanaan:</span>\n                      <p className=\"font-medium\">\n                        {submission.implementation_start_date ? \n                          new Date(submission.implementation_start_date).toLocaleDateString('id-ID') : \n                          '-'} \n                        {submission.implementation_end_date && \n                          ` s/d ${new Date(submission.implementation_end_date).toLocaleDateString('id-ID')}`}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Scan Information */}\n            {/* {result.success && (result.scanned_at || result.scanned_by) && (\n              <div className=\"bg-blue-50 rounded-lg p-4 mb-6\">\n                <h3 className=\"font-semibold mb-3 text-blue-900\">Informasi Scan</h3>\n                <div className=\"space-y-2\">\n                  {result.scanned_by && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">Discan oleh:</span>\n                      <p className=\"font-medium text-blue-900\">{result.scanned_by}</p>\n                    </div>\n                  )}\n                  {result.scanned_at && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">Waktu scan:</span>\n                      <p className=\"font-medium text-blue-900\">\n                        {new Date(result.scanned_at).toLocaleString('id-ID')}\n                      </p>\n                    </div>\n                  )}\n                  {result.scan_id && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">ID Scan:</span>\n                      <p className=\"font-medium text-blue-900 font-mono text-sm\">{result.scan_id}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )} */}\n            \n            {/* Extra padding for better scrolling on mobile */}\n            <div className=\"pb-4 md:pb-6\"></div>\n          </div>\n\n          {/* Actions - Fixed at bottom */}\n          <div className=\"flex gap-3 shrink-0 pt-4 md:pt-6 border-t border-gray-200 md:px-2\">\n            <Button \n              onClick={onClose}\n              variant={result.success ? \"primary\" : \"outline\"}\n              className=\"flex-1 md:py-3 md:text-base md:font-medium\"\n            >\n              {result.success ? 'Selesai' : 'Tutup'}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ScanModal;"
            }
          ]
        },
        {
          "type": "directory",
          "name": "security",
          "children": [
            {
              "type": "file",
              "name": "RoleGate.tsx",
              "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect } from \"react\";\n\ninterface Props {\n  allowedRoles: (\"SUPER_ADMIN\" | \"VENDOR\" | \"VERIFIER\" | \"REVIEWER\" | \"APPROVER\")[];\n  children: React.ReactNode;\n}\n\nexport default function RoleGate({ allowedRoles, children }: Props) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === \"loading\") return;\n    if (!session) router.replace(\"/login\");\n    else if (!allowedRoles.includes(session.user.role)) router.replace(\"/\"); // Redirect to home if role is not allowed\n  }, [session, status, allowedRoles, router]);\n\n  if (status === \"loading\") return <p className=\"p-8\">Loading…</p>;\n  if (!session || !allowedRoles.includes(session.user.role)) return null;\n\n  return <>{children}</>;\n}"
            },
            {
              "type": "file",
              "name": "SessionExpiryHandler.tsx",
              "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { JWT_CONFIG, getTimeUntilExpiry, formatExpiryTime } from \"@/utils/jwt-config\";\nimport ConfirmModal from \"../ui/modal/ConfirmModal\";\n\ninterface SessionExpiryHandlerProps {\n  children: React.ReactNode;\n}\n\nexport default function SessionExpiryHandler({ children }: SessionExpiryHandlerProps) {\n  const { data: session, status, update } = useSession();\n  const router = useRouter();\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const refreshIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  \n  const [showSessionWarning, setShowSessionWarning] = useState(false);\n  const [showSessionExpired, setShowSessionExpired] = useState(false);\n\n  useEffect(() => {\n    // Clear existing timeout\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    if (status === \"authenticated\" && session) {\n      // Calculate time until session expires\n      const now = Date.now() / 1000;\n      const expiresAt = session.expires ? new Date(session.expires).getTime() / 1000 : now + JWT_CONFIG.SESSION_MAX_AGE;\n      const timeUntilExpiry = getTimeUntilExpiry(expiresAt) * 1000; // Convert to milliseconds\n\n      console.log('Session expires at:', new Date(expiresAt * 1000));\n      console.log('Time until expiry:', formatExpiryTime(timeUntilExpiry / 1000));\n\n      if (timeUntilExpiry > 0) {\n        // Set timeout to show warning before expiry\n        const warningTime = Math.max(0, timeUntilExpiry - (JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000));\n        \n        timeoutRef.current = setTimeout(async () => {\n          setShowSessionWarning(true);\n        }, warningTime);\n      } else {\n        // Session already expired\n        console.log('Session already expired');\n        router.push(\"/login\");\n      }\n    }\n\n    // Cleanup timeout on unmount\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [session, status, router, update]);\n\n  // Auto-refresh session periodically (but not on visibility change)\n  useEffect(() => {\n    // Clear existing interval\n    if (refreshIntervalRef.current) {\n      clearInterval(refreshIntervalRef.current);\n    }\n\n    // Auto-refresh based on configured interval (only when authenticated)\n    if (status === \"authenticated\") {\n      refreshIntervalRef.current = setInterval(async () => {\n        try {\n          const response = await fetch(\"/api/auth/session\");\n          if (!response.ok) {\n            console.log('Session validation failed, redirecting to login');\n            setShowSessionExpired(true);\n          }\n        } catch (error) {\n          console.error('Session validation error:', error);\n          setShowSessionExpired(true);\n        }\n      }, JWT_CONFIG.AUTO_REFRESH_INTERVAL * 60 * 1000); // Convert minutes to milliseconds\n    }\n\n    return () => {\n      if (refreshIntervalRef.current) {\n        clearInterval(refreshIntervalRef.current);\n      }\n    };\n  }, [status, router]);\n\n  const handleExtendSession = async () => {\n    try {\n      await update();\n      setShowSessionWarning(false);\n      console.log('Session refreshed successfully');\n    } catch (error) {\n      console.error('Failed to refresh session:', error);\n      setShowSessionExpired(true);\n    }\n  };\n\n  const handleSessionExpiry = () => {\n    setShowSessionWarning(false);\n    setTimeout(() => {\n      setShowSessionExpired(true);\n    }, JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000);\n  };\n\n  const handleGoToLogin = () => {\n    setShowSessionExpired(false);\n    router.push(\"/login\");\n  };\n\n  return (\n    <>\n      {children}\n      \n      <ConfirmModal\n        isOpen={showSessionWarning}\n        title=\"Session Warning\"\n        message={`Your session will expire in ${JWT_CONFIG.WARNING_BEFORE_EXPIRY} minutes. Would you like to extend your session?`}\n        onConfirm={handleExtendSession}\n        onClose={handleSessionExpiry}\n        confirmText=\"Extend Session\"\n        cancelText=\"Let it expire\"\n      />\n\n      <ConfirmModal\n        isOpen={showSessionExpired}\n        title=\"Session Expired\"\n        message=\"Your session has expired. Please log in again.\"\n        onConfirm={handleGoToLogin}\n        onClose={handleGoToLogin}\n        confirmText=\"Go to Login\"\n        showCancel={false}\n      />\n    </>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "VerificationGuard.tsx",
              "content": "'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect } from 'react';\n\ninterface VerificationGuardProps {\n  children: React.ReactNode;\n}\n\nexport default function VerificationGuard({ children }: VerificationGuardProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === 'loading') return; // Still loading\n\n    if (!session) {\n      router.push('/login');\n      return;\n    }\n\n    // Check if user account has been rejected\n    if (session.user.verification_status === 'REJECTED') {\n      console.log('VerificationGuard - User account rejected, redirecting...');\n      router.push('/verification-rejected');\n      return;\n    }\n\n    // Check if user is verified (admin always allowed)\n    if (session.user.role !== 'SUPER_ADMIN' && !session.user.verified_at) {\n      console.log('VerificationGuard - User not verified, redirecting...');\n      router.push('/verification-pending');\n      return;\n    }\n  }, [session, status, router]);\n\n  // Show loading while checking\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Don't render if not authenticated\n  if (!session) {\n    return null;\n  }\n\n  // Don't render if account is rejected\n  if (session.user.verification_status === 'REJECTED') {\n    return null;\n  }\n\n  // Don't render if not verified (except admin)\n  if (session.user.role !== 'SUPER_ADMIN' && !session.user.verified_at) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "submissions",
          "children": [
            {
              "type": "file",
              "name": "SubmissionForm.tsx",
              "content": "'use client';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSession } from 'next-auth/react';\n\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport Input from '@/components/form/Input';\nimport Label from '@/components/form/Label';\nimport DatePicker from '@/components/form/DatePicker';\nimport TimePicker from '@/components/form/TimePicker';\nimport EnhancedFileUpload from '@/components/form/EnhancedFileUpload';\nimport Alert from '../ui/alert/Alert';\nimport { useToast } from '@/hooks/useToast';\nimport { SubmissionData } from '@/types/submission';\n\n// ===============================\n// Types\n// ===============================\ninterface Worker {\n  id: string;\n  worker_name: string;\n  worker_photo: string;\n}\n\n// (helper) ambil nama file dari URL kalau ada\n// function getFilenameFromUrl(url: string) {\n//   try {\n//     const u = new URL(url);\n//     const pathname = u.pathname;\n//     const last = pathname.split('/').filter(Boolean).pop();\n//     return last ?? 'file';\n//   } catch {\n//     const parts = url.split('?')[0]?.split('#')[0]?.split('/');\n//     return parts?.pop() || 'file';\n//   }\n// }\n\n// ===============================\n// Component\n// ===============================\nexport default function SubmissionForm() {\n  const router = useRouter();\n  const { data: session } = useSession();\n  const { showSuccess, showError } = useToast();\n\n  const [isLoading, setIsLoading] = useState(false);\n  const [alert, setAlert] = useState<{\n    variant: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n  } | null>(null);\n\n  // -------------------------------\n  // Workers state + helpers\n  // -------------------------------\n  const [workers, setWorkers] = useState<Worker[]>([\n    { id: `${Date.now()}`, worker_name: '', worker_photo: '' },\n  ]);\n\n  // angka target baris (valid terakhir)\n  const [desiredCount, setDesiredCount] = useState<number>(1);\n  // input teks yang user ketik (editable, bisa kosong \"\")\n  const [workerCountInput, setWorkerCountInput] = useState<string>('1');\n\n  // bulk add\n  const [showBulk, setShowBulk] = useState(false);\n  const [bulkNames, setBulkNames] = useState('');\n\n  // autofocus name input setelah tambah baris\n  const lastAddedRef = useRef<HTMLInputElement | null>(null);\n\n  // -------------------------------\n  // Form data\n  // -------------------------------\n  const [formData, setFormData] = useState<SubmissionData>({\n    vendor_name: '',\n    based_on: '',\n    officer_name: '',\n    job_description: '',\n    work_location: '',\n    working_hours: '',\n    work_facilities: '',\n    worker_count: 1, // akan diset dari desiredCount saat submit\n    simja_number: '',\n    simja_date: '',\n    sika_number: '',\n    sika_date: '',\n    worker_names: '',\n    sika_document_upload: '',\n    simja_document_upload: '',\n  });\n\n  // Prefill vendor/officer dari session\n  useEffect(() => {\n    if (session?.user) {\n      setFormData((prev) => ({\n        ...prev,\n        vendor_name: session.user.vendor_name || prev.vendor_name || '',\n        officer_name: session.user.officer_name || prev.officer_name || '',\n      }));\n    }\n  }, [session]);\n\n  // Sync awal: 1 baris => input \"1\", desiredCount = 1\n  useEffect(() => {\n    const initial = workers.length || 1;\n    setDesiredCount(initial);\n    setWorkerCountInput(String(initial));\n    setFormData((prev) => ({ ...prev, worker_count: initial }));\n  }, []);\n\n  // -------------------------------\n  // Derived\n  // -------------------------------\n\n  // effectiveDesired = angka yang dipakai UI untuk cek mismatch:\n  // - kalau input kosong, jangan anggap mismatch (pakai panjang workers supaya pesan tidak mengganggu saat user menghapus)\n  // - kalau ada angka valid, pakai desiredCount\n  const effectiveDesired = workerCountInput === '' ? workers.length : desiredCount;\n\n  const rowsMismatch = useMemo(\n    () => workers.length !== effectiveDesired,\n    [workers.length, effectiveDesired]\n  );\n\n  const allWorkersValid = useMemo(\n    () => workers.every((w) => w.worker_name.trim() && w.worker_photo.trim()),\n    [workers]\n  );\n\n  // -------------------------------\n  // Utilities\n  // -------------------------------\n  const statusPill = (ok: boolean) => (\n    <span\n      className={`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium ${\n        ok\n          ? 'bg-green-50 text-green-700 border border-green-200'\n          : 'bg-amber-50 text-amber-700 border border-amber-200'\n      }`}\n    >\n      {ok ? 'Lengkap' : 'Perlu dilengkapi'}\n    </span>\n  );\n\n  const focusLastAdded = () => {\n    setTimeout(() => {\n      lastAddedRef.current?.focus();\n      lastAddedRef.current?.select();\n    }, 0);\n  };\n\n  // -------------------------------\n  // Handlers: generic fields\n  // -------------------------------\n  const handleFileUpload = (fieldName: keyof SubmissionData) => (url: string) => {\n    setFormData((prev) => ({ ...prev, [fieldName]: url }));\n  };\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const { name, value, type } = e.target;\n    setFormData((prev) => ({\n      ...prev,\n      [name]: type === 'number' ? (value === '' ? ('' as any) : Number(value)) : value,\n    }));\n  };\n\n  const handleDateChange = (name: keyof SubmissionData) => (value: string) => {\n    setFormData((prev) => ({ ...prev, [name]: value }));\n  };\n\n  const handleTimeChange = (value: string) => {\n    setFormData((prev) => ({ ...prev, working_hours: value }));\n  };\n\n  // -------------------------------\n  // Handlers: workers\n  // -------------------------------\n  const addWorker = (presetName = '') => {\n    const newWorker: Worker = {\n      id: `${Date.now()}_${Math.random().toString(36).slice(2, 7)}`,\n      worker_name: presetName,\n      worker_photo: '',\n    };\n    setWorkers((prev) => [...prev, newWorker]);\n    setDesiredCount((n) => {\n      const next = n + 1;\n      // sinkronkan tampilan input juga\n      setWorkerCountInput(String(next));\n      return next;\n    });\n    focusLastAdded();\n  };\n\n  const removeWorker = (id: string) => {\n    setWorkers((prev) => {\n      const nextArr = prev.filter((w) => w.id !== id);\n      // jaga minimal 1\n      const nextLen = Math.max(1, nextArr.length);\n      setDesiredCount(nextLen);\n      setWorkerCountInput(String(nextLen));\n      return nextArr.length > 0 ? nextArr : prev; // cegah kosong total\n    });\n  };\n\n  const updateWorkerName = (id: string, name: string) => {\n    setWorkers((prev) => prev.map((w) => (w.id === id ? { ...w, worker_name: name } : w)));\n  };\n\n  const updateWorkerPhoto = (id: string, url: string) => {\n    setWorkers((prev) => prev.map((w) => (w.id === id ? { ...w, worker_photo: url } : w)));\n  };\n\n  // Sesuaikan jumlah baris dengan angka efektif dari input/user\n  const applyDesiredCount = () => {\n    // jika input kosong, anggap tidak ada perubahan (biarkan sama)\n    const count =\n      workerCountInput === ''\n        ? workers.length\n        : Math.max(1, Math.min(9999, Number(desiredCount || 1)));\n\n    if (count > workers.length) {\n      // tambah baris kosong\n      const delta = count - workers.length;\n      const toAdd: Worker[] = Array.from({ length: delta }).map(() => ({\n        id: `${Date.now()}_${Math.random().toString(36).slice(2, 7)}`,\n        worker_name: '',\n        worker_photo: '',\n      }));\n      setWorkers((prev) => [...prev, ...toAdd]);\n      focusLastAdded();\n    } else if (count < workers.length) {\n      // kurangi baris dari belakang\n      setWorkers((prev) => prev.slice(0, count));\n    }\n\n    // pastikan displayed input & desired sinkron ke count final\n    setDesiredCount(count);\n    setWorkerCountInput(String(count));\n  };\n\n  const addBulkWorkers = () => {\n    const lines = bulkNames\n      .split('\\n')\n      .map((s) => s.trim())\n      .filter(Boolean);\n\n    if (lines.length === 0) return;\n\n    const toAdd: Worker[] = lines.map((name) => ({\n      id: `${Date.now()}_${Math.random().toString(36).slice(2, 7)}`,\n      worker_name: name,\n      worker_photo: '',\n    }));\n\n    setWorkers((prev) => [...prev, ...toAdd]);\n    setDesiredCount((n) => {\n      const next = n + toAdd.length;\n      setWorkerCountInput(String(next));\n      return next;\n    });\n    setBulkNames('');\n    setShowBulk(false);\n    focusLastAdded();\n  };\n\n  // -------------------------------\n  // Submit\n  // -------------------------------\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      // Validasi jumlah min 1\n      if (workers.length === 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Minimal harus ada satu pekerja.',\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Jika user sedang mengosongkan input, jangan izinkan submit\n      if (workerCountInput === '') {\n        setAlert({\n          variant: 'warning',\n          title: 'Jumlah Pekerja Kosong',\n          message:\n            'Isi angka pada \"Jumlah Pekerja\" atau klik Sesuaikan agar sesuai dengan baris yang ada.',\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Peringatan mismatch jumlah baris vs input worker_count\n      if (workers.length !== desiredCount) {\n        setAlert({\n          variant: 'warning',\n          title: 'Jumlah Tidak Sinkron',\n          message:\n            'Jumlah baris pekerja tidak sama dengan input \"Jumlah Pekerja\". Klik \"Sesuaikan\" atau perbarui angkanya.',\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Validasi isi\n      const invalidNames = workers.filter((w) => !w.worker_name.trim()).length;\n      const invalidPhotos = workers.filter((w) => !w.worker_photo.trim()).length;\n\n      if (invalidNames > 0 || invalidPhotos > 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Form Pekerja Belum Lengkap',\n          message:\n            invalidNames > 0\n              ? 'Ada nama pekerja yang kosong. Lengkapi semua nama.'\n              : 'Semua pekerja harus memiliki foto. Lengkapi foto pekerja.',\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Format untuk DB\n      const workerNames = workers.map((w) => w.worker_name.trim()).join('\\n');\n\n      const payload: SubmissionData & { workers: Worker[] } = {\n        ...formData,\n        worker_count: desiredCount, // kirim angka yang diinput user (valid)\n        worker_names: workerNames,\n        workers,\n      };\n\n      const response = await fetch('/api/submissions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({}));\n        throw new Error(error.error || 'Failed to create submission');\n      }\n\n      showSuccess('Berhasil!', 'Pengajuan SIMLOK berhasil dibuat!');\n      router.push('/vendor/submissions');\n    } catch (error) {\n      console.error('Error creating submission:', error);\n      const errorMessage =\n        error instanceof Error ? error.message : 'Failed to create submission. Please try again.';\n      showError('Error!', errorMessage);\n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: errorMessage,\n      });\n      setTimeout(() => setAlert(null), 5000);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // ===============================\n  // Render\n  // ===============================\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <Card>\n        <div className=\"p-6\">\n          <form onSubmit={handleSubmit} className=\"space-y-8\">\n            {/* ================= Vendor ================= */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">\n                Informasi Vendor\n              </h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"vendor_name\">Nama Vendor</Label>\n                  <Input\n                    id=\"vendor_name\"\n                    name=\"vendor_name\"\n                    type=\"text\"\n                    value={session?.user?.vendor_name || formData.vendor_name || ''}\n                    onChange={handleChange}\n                    required\n                    disabled={!!session?.user?.vendor_name}\n                    placeholder=\"Masukkan nama vendor\"\n                    className={session?.user?.vendor_name ? 'cursor-not-allowed bg-gray-50' : ''}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"officer_name\">Nama Petugas</Label>\n                  <Input\n                    id=\"officer_name\"\n                    name=\"officer_name\"\n                    type=\"text\"\n                    value={formData.officer_name || ''}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Nama petugas yang bertanggung jawab\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <Label htmlFor=\"based_on\">Berdasarkan</Label>\n                  <Input\n                    id=\"based_on\"\n                    name=\"based_on\"\n                    type=\"text\"\n                    value={formData.based_on}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Contoh: Surat Izin Kerja No. 123/2024\"\n                  />\n                </div>\n\n                {/* Dokumen */}\n                <div>\n                  <Label htmlFor=\"simja_number\">Nomor SIMJA</Label>\n                  <Input\n                    id=\"simja_number\"\n                    name=\"simja_number\"\n                    type=\"text\"\n                    value={formData.simja_number || ''}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Contoh: SIMJA/2024/001\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sika_number\">Nomor SIKA</Label>\n                  <Input\n                    id=\"sika_number\"\n                    name=\"sika_number\"\n                    type=\"text\"\n                    value={formData.sika_number || ''}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Contoh: SIKA/2024/001\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"simja_date\">Tanggal SIMJA</Label>\n                  <DatePicker\n                    id=\"simja_date\"\n                    name=\"simja_date\"\n                    value={formData.simja_date || ''}\n                    onChange={handleDateChange('simja_date')}\n                    placeholder=\"Pilih tanggal SIMJA\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sika_date\">Tanggal SIKA</Label>\n                  <DatePicker\n                    id=\"sika_date\"\n                    name=\"sika_date\"\n                    value={formData.sika_date || ''}\n                    onChange={handleDateChange('sika_date')}\n                    placeholder=\"Pilih tanggal SIKA\"\n                    required\n                  />\n                </div>\n\n                {/* Upload dokumen */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"simja_document_upload\">UPLOAD DOKUMEN SIMJA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <EnhancedFileUpload\n                      id=\"simja_document_upload\"\n                      name=\"simja_document_upload\"\n                      value={formData.simja_document_upload || ''}\n                      onChange={handleFileUpload('simja_document_upload')}\n                      uploadType=\"document\"\n                      label=\"\"\n                      description=\"Upload PDF/DOC/DOCX/JPG/PNG maks 8MB\"\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"sika_document_upload\">UPLOAD DOKUMEN SIKA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <EnhancedFileUpload\n                      id=\"sika_document_upload\"\n                      name=\"sika_document_upload\"\n                      value={formData.sika_document_upload || ''}\n                      onChange={handleFileUpload('sika_document_upload')}\n                      uploadType=\"document\"\n                      required\n                      label=\"\"\n                      description=\"Upload PDF/DOC/DOCX/JPG/PNG maks 8MB\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* ================= Pekerjaan ================= */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">\n                Informasi Pekerjaan\n              </h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"job_description\">Pekerjaan</Label>\n                  <Input\n                    id=\"job_description\"\n                    name=\"job_description\"\n                    type=\"text\"\n                    value={formData.job_description}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Contoh: Instalasi dan pemeliharaan peralatan\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"work_location\">Lokasi Kerja</Label>\n                  <Input\n                    id=\"work_location\"\n                    name=\"work_location\"\n                    type=\"text\"\n                    value={formData.work_location}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Contoh: Area Produksi Unit 1, Kilang Cilacap\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"working_hours\">Jam kerja</Label>\n                  <TimePicker\n                    id=\"working_hours\"\n                    name=\"working_hours\"\n                    value={formData.working_hours}\n                    onChange={handleTimeChange}\n                    required\n                    placeholder=\"Pilih jam kerja\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"work_facilities\">Sarana kerja</Label>\n                  <Input\n                    id=\"work_facilities\"\n                    name=\"work_facilities\"\n                    value={formData.work_facilities}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: Toolkit lengkap, APD standar, crane mobile\"\n                    required\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* ================= Workers ================= */}\n            <div className=\"p-6 rounded-lg\">\n              <div className=\"flex flex-col gap-3 md:flex-row md:items-end md:justify-between mb-3 \">\n                <div>\n                  <h2 className=\"text-lg font-semibold text-gray-900\">Daftar Pekerja</h2>\n\n                  {rowsMismatch ? (\n                    <p className=\"text-[11px] text-amber-600 mt-1\">\n                      Baris saat ini: {workers.length}. Klik <b>Sesuaikan</b> untuk menambah/mengurangi.\n                    </p>\n                  ) : (\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Lengkapi Nama & Foto. Kamu bisa tambah satu-satu atau tempel banyak nama.\n                    </p>\n                  )}\n                </div>\n\n                <div className=\"flex items-end gap-2 flex-wrap sm:flex-nowrap\">\n                  <div className=\"flex-1 min-w-[180px]\">\n                    <Label htmlFor=\"worker_count\">Jumlah Pekerja</Label>\n\n                    {/* INPUT TEXT: editable, bisa kosong, filter angka */}\n                    <input\n                      id=\"worker_count\"\n                      name=\"worker_count\"\n                      type=\"text\"\n                      value={workerCountInput}\n                      onChange={(e) => {\n                        const inputValue = e.target.value;\n\n                        // Izinkan kosong\n                        if (inputValue === '') {\n                          setWorkerCountInput('');\n                          // jangan ubah desiredCount; biarkan angka valid terakhir tersimpan\n                          return;\n                        }\n\n                        // Hanya angka\n                        const clean = inputValue.replace(/\\D/g, '');\n                        if (clean === '') {\n                          setWorkerCountInput('');\n                          return;\n                        }\n\n                        // Batas aman\n                        const num = Math.max(1, Math.min(9999, parseInt(clean, 10)));\n                        setWorkerCountInput(clean);\n                        setDesiredCount(num);\n                      }}\n                      onKeyDown={(e) => {\n                        const allowed = [\n                          'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',\n                          'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',\n                          'Home', 'End'\n                        ];\n                        if (allowed.includes(e.key)) return;\n                        if ((e.ctrlKey || e.metaKey) && ['a','c','v','x','z'].includes(e.key.toLowerCase())) return;\n                        if (!/[0-9]/.test(e.key)) e.preventDefault();\n                      }}\n                      onBlur={() => {\n                        // kalau kosong saat blur → set ke panjang workers supaya tidak bikin mismatch permanen\n                        if (workerCountInput === '') {\n                          const fallback = workers.length || 1;\n                          setDesiredCount(fallback);\n                          setWorkerCountInput(String(fallback));\n                        }\n                      }}\n                      placeholder=\"Masukkan jumlah pekerja\"\n                      className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 ${\n                        rowsMismatch ? 'border-amber-300' : 'border-gray-300'\n                      }`}\n                    />\n                  </div>\n\n                  <div className=\"flex gap-2 flex-shrink-0 whitespace-nowrap\">\n                    <Button\n                      type=\"button\"\n                      onClick={() => addWorker()}\n                      className=\"whitespace-nowrap\"\n                    >\n                      + Tambah\n                    </Button>\n                    {rowsMismatch && (\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={applyDesiredCount}\n                        className=\"whitespace-nowrap\"\n                      >\n                        Sesuaikan\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/* Tambah Cepat */}\n              {showBulk && (\n                <div className=\"mb-4 rounded-lg border border-blue-200 bg-blue-50 p-3\">\n                  <Label htmlFor=\"bulk_names\">Tempel banyak nama (satu per baris)</Label>\n                  <textarea\n                    id=\"bulk_names\"\n                    className=\"mt-1 w-full rounded-md border border-blue-200 bg-white p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-300\"\n                    rows={4}\n                    placeholder={`Contoh:\\nBudi Santoso\\nSari Dewi\\nAndi Wijaya`}\n                    value={bulkNames}\n                    onChange={(e) => setBulkNames(e.target.value)}\n                  />\n                  <div className=\"mt-2 flex items-center gap-2\">\n                    <Button type=\"button\" onClick={addBulkWorkers}>Tambahkan</Button>\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setBulkNames('')}>Bersihkan</Button>\n                  </div>\n                </div>\n              )}\n\n              {/* Tabel ringkas */}\n              <div className=\"overflow-hidden rounded-xl border border-gray-200\">\n                <div className=\"grid grid-cols-12 bg-gray-50 text-xs font-semibold text-gray-600\">\n                  <div className=\"col-span-1 px-3 py-2\">No</div>\n                  <div className=\"col-span-5 px-3 py-2\">Nama Pekerja</div>\n                  <div className=\"col-span-4 px-3 py-2\">Foto</div>\n                  <div className=\"col-span-2 px-3 py-2 text-right\">Aksi</div>\n                </div>\n\n                <div className=\"divide-y divide-gray-100\">\n                  {workers.map((w, idx) => {\n                    const ok = !!w.worker_name.trim() && !!w.worker_photo.trim();\n                    // const filename = w.worker_photo ? getFilenameFromUrl(w.worker_photo) : '';\n                    return (\n                      <div key={w.id} className=\"grid grid-cols-12 items-center text-sm\">\n                        <div className=\"col-span-1 px-3 py-3 text-gray-500\">{idx + 1}</div>\n\n                        <div className=\"col-span-5 px-3 py-3\">\n                          <Input\n                            id={`worker_name_${w.id}`}\n                            name={`worker_name_${w.id}`}\n                            type=\"text\"\n                            value={w.worker_name}\n                            onChange={(e) => updateWorkerName(w.id, e.target.value)}\n                            placeholder=\"Nama lengkap pekerja\"\n                          />\n                          <div className=\"mt-1\">{statusPill(ok)}</div>\n                        </div>\n\n                        {/* FOTO */}\n                        <div className=\"col-span-4 px-3 py-3\">\n                          <EnhancedFileUpload\n                            id={`worker_photo_${w.id}`}\n                            name={`worker_photo_${w.id}`}\n                            value={w.worker_photo}\n                            onChange={(url) => updateWorkerPhoto(w.id, url)}\n                            uploadType=\"worker-photo\"\n                            workerName={w.worker_name || `Pekerja ${idx + 1}`}\n                            required={false}\n                          />\n                        </div>\n\n                        <div className=\"col-span-2 px-3 py-3 text-right\">\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                            onClick={() => removeWorker(w.id)}\n                            disabled={workers.length <= 1}\n                            title={workers.length <= 1 ? 'Minimal 1 pekerja' : 'Hapus baris'}\n                          >\n                            Hapus\n                          </Button>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n\n              <div className=\"mt-2 text-xs text-gray-500\">\n                • Jumlah pekerja <b>editable</b>: ketik angka, lalu klik <b>Sesuaikan</b> untuk otomatis menambah/mengurangi baris. <br />\n                • Wajib isi nama & unggah foto untuk setiap pekerja sebelum submit.\n              </div>\n            </div>\n\n            {/* ================= Actions ================= */}\n            <div className=\"flex justify-end gap-3\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => router.back()}>\n                Batal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={isLoading}\n                title={\n                  !allWorkersValid\n                    ? 'Lengkapi nama & foto semua pekerja'\n                    : rowsMismatch\n                      ? 'Jumlah baris ≠ jumlah pekerja. Sesuaikan dulu.'\n                      : ''\n                }\n              >\n                {isLoading ? 'Menyimpan...' : 'Buat Pengajuan'}\n              </Button>\n            </div>\n          </form>\n        </div>\n      </Card>\n\n      {/* Alert */}\n      {alert && <Alert variant={alert.variant} title={alert.title} message={alert.message} />}\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "ui",
          "children": [
            {
              "type": "file",
              "name": "ActivityList.tsx",
              "content": "\"use client\";\nexport function ActivityList({\n  items,\n}: {\n  items: { id: number; txt: string; time: string }[];\n}) {\n  return (\n    <ul className=\"space-y-3\">\n      {items.map((act) => (\n        <li key={act.id} className=\"text-sm\">\n          <p className=\"text-slate-900\">{act.txt}</p>\n          <p className=\"text-xs text-slate-500\">{act.time}</p>\n        </li>\n      ))}\n    </ul>\n  );\n}"
            },
            {
              "type": "file",
              "name": "Badge.tsx",
              "content": "\"use client\";\n\ninterface BadgeProps {\n  children: React.ReactNode;\n  variant?: \"default\" | \"success\" | \"warning\" | \"destructive\";\n}\n\nexport function Badge({ children, variant = \"default\" }: BadgeProps) {\n  const variantClasses = {\n    default: \"border-slate-200 bg-slate-50 text-slate-700\",\n    success: \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n    warning: \"border-amber-200 bg-amber-50 text-amber-700\",\n    destructive: \"border-red-200 bg-red-50 text-red-700\",\n  };\n\n  // Force red styling with inline styles for destructive variant\n  const inlineStyle = variant === 'destructive' ? {\n    borderColor: '#ef4444 !important',\n    backgroundColor: '#ef4444 !important',\n    color: '#ffffff !important',\n    fontWeight: '600'\n  } : {};\n\n  return (\n    <span \n      className={`inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium ${variantClasses[variant]}`}\n      style={inlineStyle}\n    >\n      {children}\n    </span>\n  );\n}"
            },
            {
              "type": "file",
              "name": "Card.tsx",
              "content": "\"use client\";\nimport type { ReactNode } from \"react\";\n\nexport default function Card({\n  children,\n  className = \"\",\n}: {\n  children: ReactNode;\n  className?: string;\n}) {\n  return (\n    <div\n      className={`rounded-2xl border border-slate-200/70 bg-white shadow-sm ${className}`}\n    >\n      {children}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "LoadingSpinner.tsx",
              "content": "'use client';\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n}\n\nexport default function LoadingSpinner({ size = 'md', className = '' }: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'w-4 h-4',\n    md: 'w-6 h-6',\n    lg: 'w-8 h-8'\n  };\n\n  return (\n    <div\n      className={`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${sizeClasses[size]} ${className}`}\n      role=\"status\"\n      aria-label=\"Loading\"\n    >\n      <span className=\"sr-only\">Loading...</span>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "PageLoader.tsx",
              "content": "'use client';\n\nimport LoadingSpinner from './LoadingSpinner';\n\ninterface PageLoaderProps {\n  message?: string;\n  size?: 'sm' | 'md' | 'lg';\n  fullScreen?: boolean;\n  className?: string;\n}\n\nexport default function PageLoader({ \n  message = \"Memuat...\", \n  size = 'lg',\n  fullScreen = true,\n  className = ''\n}: PageLoaderProps) {\n  const containerClass = fullScreen \n    ? \"min-h-screen bg-gray-50 flex items-center justify-center\"\n    : \"flex items-center justify-center py-12\";\n\n  return (\n    <div className={`${containerClass} ${className}`}>\n      <div className=\"text-center\">\n        <LoadingSpinner size={size} />\n        <p className=\"text-gray-600 mt-3 text-sm font-medium\">{message}</p>\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "SectionTitle.tsx",
              "content": "\"use client\";\nimport type { ReactNode } from \"react\";\n\nexport function SectionTitle({ children, right }: { children: ReactNode; right?: ReactNode }) {\n  return (\n    <div className=\"mb-4 flex items-center justify-between gap-3\">\n      <h2 className=\"text-lg font-semibold text-slate-900\">{children}</h2>\n      {right}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "Stat.tsx",
              "content": "\"use client\";\nimport type { ComponentType } from \"react\";\n\nexport function Stat({\n  label,\n  value,\n  icon: Icon,\n}: {\n  label: string;\n  value: string | number;\n  icon?: ComponentType<{ className?: string }>;\n}) {\n  return (\n    <div className=\"rounded-2xl border border-sky-200/50 bg-sky-50/60 p-5 shadow-sm\">\n      <div className=\"flex items-start justify-between\">\n        <p className=\"text-sm text-slate-600\">{label}</p>\n        {Icon && <Icon className=\"h-5 w-5 text-slate-400\" />}\n      </div>\n      <p className=\"mt-1 text-2xl font-bold text-slate-900\">{value}</p>\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "StatCard.tsx",
              "content": "'use client';\n\nimport React from 'react';\n\ntype Accent =\n  | 'blue'\n  | 'green'\n  | 'red'\n  | 'amber'\n  | 'purple'\n  | 'indigo'\n  | 'gray';\n\nconst accentMap: Record<\n  Accent,\n  { text: string; bg: string; ring: string; pill: string }\n> = {\n  blue:   { text: 'text-blue-600',   bg: 'bg-blue-100',   ring: 'ring-blue-200',   pill: 'text-blue-700 bg-blue-50' },\n  green:  { text: 'text-green-600',  bg: 'bg-green-100',  ring: 'ring-green-200',  pill: 'text-green-700 bg-green-50' },\n  red:    { text: 'text-red-600',    bg: 'bg-red-100',    ring: 'ring-red-200',    pill: 'text-red-700 bg-red-50' },\n  amber:  { text: 'text-amber-600',  bg: 'bg-amber-100',  ring: 'ring-amber-200',  pill: 'text-amber-700 bg-amber-50' },\n  purple: { text: 'text-purple-600', bg: 'bg-purple-100', ring: 'ring-purple-200', pill: 'text-purple-700 bg-purple-50' },\n  indigo: { text: 'text-indigo-600', bg: 'bg-indigo-100', ring: 'ring-indigo-200', pill: 'text-indigo-700 bg-indigo-50' },\n  gray:   { text: 'text-gray-600',   bg: 'bg-gray-100',   ring: 'ring-gray-200',   pill: 'text-gray-700 bg-gray-50' },\n};\n\nexport interface StatCardProps {\n  title: string;\n  value: number | string;\n  icon?: React.ReactNode;\n  accent?: Accent;\n  /** subtitle kecil di bawah title (opsional) */\n  hint?: string;\n  /** delta: +12% / -3 / dst (opsional) */\n  deltaText?: string;\n  /** up | down | neutral (opsional) */\n  deltaTrend?: 'up' | 'down' | 'neutral';\n  className?: string;\n}\n\nexport default function StatCard({\n  title,\n  value,\n  icon,\n  accent = 'gray',\n  hint,\n  deltaText,\n  deltaTrend = 'neutral',\n  className = '',\n}: StatCardProps) {\n  const a = accentMap[accent];\n\n  const deltaColor =\n    deltaTrend === 'up'\n      ? 'text-green-700 bg-green-50'\n      : deltaTrend === 'down'\n      ? 'text-red-700 bg-red-50'\n      : 'text-gray-700 bg-gray-50';\n\n  return (\n    <div className={`bg-white rounded-xl border shadow-sm p-6 ${className}`}>\n      <div className=\"flex items-start justify-between\">\n        <div className=\"min-w-0\">\n          <h3 className=\"text-sm font-medium text-gray-500 truncate\">{title}</h3>\n          {hint && <p className=\"text-xs text-gray-400 mt-0.5 truncate\">{hint}</p>}\n          <p className={`text-2xl font-bold mt-2 ${a.text}`}>{value}</p>\n        </div>\n        {icon ? (\n          <div className={`p-3 rounded-full ${a.bg} ring-1 ${a.ring}`}>\n            {icon}\n          </div>\n        ) : null}\n      </div>\n\n      {typeof deltaText !== 'undefined' && deltaText !== '' && (\n        <div\n          className={`inline-flex items-center gap-1 text-xs font-medium mt-3 px-2 py-1 rounded-full ${deltaColor}`}\n        >\n          {deltaTrend === 'up' && (\n            <svg className=\"w-3.5 h-3.5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path d=\"M3 12l7-7 7 7H3z\" />\n            </svg>\n          )}\n          {deltaTrend === 'down' && (\n            <svg className=\"w-3.5 h-3.5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path d=\"M17 8l-7 7-7-7h14z\" />\n            </svg>\n          )}\n          <span>{deltaText}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "StatsCardsLoader.tsx",
              "content": "'use client';\n\ninterface StatsCardsLoaderProps {\n  count?: number;\n}\n\nexport default function StatsCardsLoader({ count = 4 }: StatsCardsLoaderProps) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"bg-white p-6 rounded-xl border shadow-sm animate-pulse\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-3\">\n              <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n              <div className=\"h-8 bg-gray-200 rounded w-16\"></div>\n            </div>\n            <div className=\"w-12 h-12 bg-gray-200 rounded-full\"></div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "TableLoader.tsx",
              "content": "'use client';\n\ninterface TableLoaderProps {\n  rows?: number;\n  columns?: number;\n  showHeader?: boolean;\n}\n\nexport default function TableLoader({ \n  rows = 5, \n  columns = 4,\n  showHeader = true \n}: TableLoaderProps) {\n  return (\n    <div className=\"animate-pulse\">\n      {/* Header skeleton */}\n      {showHeader && (\n        <div className=\"bg-gray-50 p-4 border-b\">\n          <div className=\"grid gap-4\" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>\n            {Array.from({ length: columns }).map((_, i) => (\n              <div key={i} className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n            ))}\n          </div>\n        </div>\n      )}\n      \n      {/* Rows skeleton */}\n      <div className=\"divide-y divide-gray-200\">\n        {Array.from({ length: rows }).map((_, i) => (\n          <div key={i} className=\"p-4\">\n            <div className=\"grid gap-4 items-center\" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>\n              {Array.from({ length: columns }).map((_, j) => (\n                <div key={j} className=\"space-y-2\">\n                  <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\n                  {j === 0 && <div className=\"h-3 bg-gray-200 rounded w-2/3\"></div>}\n                </div>\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}"
            },
            {
              "type": "directory",
              "name": "alert",
              "children": [
                {
                  "type": "file",
                  "name": "Alert.tsx",
                  "content": "import Link from \"next/link\";\nimport React from \"react\";\n\ninterface AlertProps {\n  variant: \"success\" | \"error\" | \"warning\" | \"info\"; // Alert type\n  title: string; // Title of the alert\n  message: string; // Message of the alert\n  showLink?: boolean; // Whether to show the \"Learn More\" link\n  linkHref?: string; // Link URL\n  linkText?: string; // Link text\n  className?: string; // Additional CSS classes\n}\n\nconst Alert: React.FC<AlertProps> = ({\n  variant,\n  title,\n  message,\n  showLink = false,\n  linkHref = \"#\",\n  linkText = \"Learn more\",\n  className = \"\",\n}) => {\n  // Tailwind classes for each variant\n  const variantClasses = {\n    success: {\n      container:\n        \"border-success-500 bg-success-50\",\n      icon: \"text-success-500\",\n    },\n    error: {\n      container:\n        \"border-error-500 bg-error-50\",\n      icon: \"text-error-500\",\n    },\n    warning: {\n      container:\n        \"border-warning-500 bg-warning-50\",\n      icon: \"text-warning-500\",\n    },\n    info: {\n      container:\n        \"border-blue-light-500 bg-blue-light-50\",\n      icon: \"text-blue-light-500\",\n    },\n  };\n\n  // Icon for each variant\n  const icons = {\n    success: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.70186 12.0001C3.70186 7.41711 7.41711 3.70186 12.0001 3.70186C16.5831 3.70186 20.2984 7.41711 20.2984 12.0001C20.2984 16.5831 16.5831 20.2984 12.0001 20.2984C7.41711 20.2984 3.70186 16.5831 3.70186 12.0001ZM12.0001 1.90186C6.423 1.90186 1.90186 6.423 1.90186 12.0001C1.90186 17.5772 6.423 22.0984 12.0001 22.0984C17.5772 22.0984 22.0984 17.5772 22.0984 12.0001C22.0984 6.423 17.5772 1.90186 12.0001 1.90186ZM15.6197 10.7395C15.9712 10.388 15.9712 9.81819 15.6197 9.46672C15.2683 9.11525 14.6984 9.11525 14.347 9.46672L11.1894 12.6243L9.6533 11.0883C9.30183 10.7368 8.73198 10.7368 8.38051 11.0883C8.02904 11.4397 8.02904 12.0096 8.38051 12.3611L10.553 14.5335C10.7217 14.7023 10.9507 14.7971 11.1894 14.7971C11.428 14.7971 11.657 14.7023 11.8257 14.5335L15.6197 10.7395Z\"\n        />\n      </svg>\n    ),\n    error: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M20.3499 12.0004C20.3499 16.612 16.6115 20.3504 11.9999 20.3504C7.38832 20.3504 3.6499 16.612 3.6499 12.0004C3.6499 7.38881 7.38833 3.65039 11.9999 3.65039C16.6115 3.65039 20.3499 7.38881 20.3499 12.0004ZM11.9999 22.1504C17.6056 22.1504 22.1499 17.6061 22.1499 12.0004C22.1499 6.3947 17.6056 1.85039 11.9999 1.85039C6.39421 1.85039 1.8499 6.3947 1.8499 12.0004C1.8499 17.6061 6.39421 22.1504 11.9999 22.1504ZM13.0008 16.4753C13.0008 15.923 12.5531 15.4753 12.0008 15.4753L11.9998 15.4753C11.4475 15.4753 10.9998 15.923 10.9998 16.4753C10.9998 17.0276 11.4475 17.4753 11.9998 17.4753L12.0008 17.4753C12.5531 17.4753 13.0008 17.0276 13.0008 16.4753ZM11.9998 6.62898C12.414 6.62898 12.7498 6.96476 12.7498 7.37898L12.7498 13.0555C12.7498 13.4697 12.414 13.8055 11.9998 13.8055C11.5856 13.8055 11.2498 13.4697 11.2498 13.0555L11.2498 7.37898C11.2498 6.96476 11.5856 6.62898 11.9998 6.62898Z\"\n          fill=\"#F04438\"\n        />\n      </svg>\n    ),\n    warning: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.6501 12.0001C3.6501 7.38852 7.38852 3.6501 12.0001 3.6501C16.6117 3.6501 20.3501 7.38852 20.3501 12.0001C20.3501 16.6117 16.6117 20.3501 12.0001 20.3501C7.38852 20.3501 3.6501 16.6117 3.6501 12.0001ZM12.0001 1.8501C6.39441 1.8501 1.8501 6.39441 1.8501 12.0001C1.8501 17.6058 6.39441 22.1501 12.0001 22.1501C17.6058 22.1501 22.1501 17.6058 22.1501 12.0001C22.1501 6.39441 17.6058 1.8501 12.0001 1.8501ZM10.9992 7.52517C10.9992 8.07746 11.4469 8.52517 11.9992 8.52517H12.0002C12.5525 8.52517 13.0002 8.07746 13.0002 7.52517C13.0002 6.97289 12.5525 6.52517 12.0002 6.52517H11.9992C11.4469 6.52517 10.9992 6.97289 10.9992 7.52517ZM12.0002 17.3715C11.586 17.3715 11.2502 17.0357 11.2502 16.6215V10.945C11.2502 10.5308 11.586 10.195 12.0002 10.195C12.4144 10.195 12.7502 10.5308 12.7502 10.945V16.6215C12.7502 17.0357 12.4144 17.3715 12.0002 17.3715Z\"\n          fill=\"\"\n        />\n      </svg>\n    ),\n    info: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.6501 11.9996C3.6501 7.38803 7.38852 3.64961 12.0001 3.64961C16.6117 3.64961 20.3501 7.38803 20.3501 11.9996C20.3501 16.6112 16.6117 20.3496 12.0001 20.3496C7.38852 20.3496 3.6501 16.6112 3.6501 11.9996ZM12.0001 1.84961C6.39441 1.84961 1.8501 6.39392 1.8501 11.9996C1.8501 17.6053 6.39441 22.1496 12.0001 22.1496C17.6058 22.1496 22.1501 17.6053 22.1501 11.9996C22.1501 6.39392 17.6058 1.84961 12.0001 1.84961ZM10.9992 7.52468C10.9992 8.07697 11.4469 8.52468 11.9992 8.52468H12.0002C12.5525 8.52468 13.0002 8.07697 13.0002 7.52468C13.0002 6.9724 12.5525 6.52468 12.0002 6.52468H11.9992C11.4469 6.52468 10.9992 6.9724 10.9992 7.52468ZM12.0002 17.371C11.586 17.371 11.2502 17.0352 11.2502 16.621V10.9445C11.2502 10.5303 11.586 10.1945 12.0002 10.1945C12.4144 10.1945 12.7502 10.5303 12.7502 10.9445V16.621C12.7502 17.0352 12.4144 17.371 12.0002 17.371Z\"\n          fill=\"\"\n        />\n      </svg>\n    ),\n  };\n\n  return (\n    <div\n      className={`rounded-xl border p-4 ${variantClasses[variant].container} ${className}`}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={`-mt-0.5 ${variantClasses[variant].icon}`}>\n          {icons[variant]}\n        </div>\n\n        <div className=\"flex-1\">\n          <h4 className=\"mb-1 text-sm font-semibold text-gray-800\">\n            {title}\n          </h4>\n\n          <p className=\"text-sm text-gray-500\">{message}</p>\n\n          {showLink && (\n            <Link\n              href={linkHref}\n              className=\"inline-block mt-3 text-sm font-medium text-gray-500 underline\"\n            >\n              {linkText}\n            </Link>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Alert;\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "button",
              "children": [
                {
                  "type": "file",
                  "name": "Button.tsx",
                  "content": "import React, { ReactNode } from \"react\";\n\ninterface ButtonProps {\n  children: ReactNode; // Button text or content\n  size?: \"sm\" | \"md\" | \"lg\"; // Button size\n  variant?: \"primary\" | \"secondary\" | \"outline\" | \"ghost\" | \"destructive\" | \"success\" | \"warning\" | \"info\"; // Button variant\n  startIcon?: ReactNode; // Icon before the text\n  endIcon?: ReactNode; // Icon after the text\n  onClick?: ((e?: any) => void) | (() => void); // Click handler\n  disabled?: boolean; // Disabled state\n  className?: string; // Additional classes\n  type?: \"button\" | \"submit\" | \"reset\"; // Button type\n  title?: string; // Tooltip text\n}\n\nconst Button: React.FC<ButtonProps> = ({\n  children,\n  size = \"md\",\n  variant = \"primary\",\n  startIcon,\n  endIcon,\n  onClick,\n  className = \"\",\n  disabled = false,\n  type = \"button\",\n  title,\n}) => {\n  // Size Classes\n  const sizeClasses = {\n    sm: \"px-3 py-2 text-sm\",\n    md: \"px-4 py-2 text-sm\",\n    lg: \"px-6 py-3 text-base\",\n  };\n\n  // Variant Classes - sesuai referensi warna yang diberikan\n  const variantClasses = {\n    primary:\n      \"bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300\",\n    secondary:\n      \"bg-gray-500 text-white shadow-sm hover:bg-gray-600 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-300\",\n    outline:\n      \"bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-100 disabled:text-gray-400\",\n    ghost:\n      \"bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:text-gray-400\",\n    destructive:\n      \"bg-red-600 text-white shadow-sm hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:bg-red-300\",\n    success:\n      \"bg-emerald-500 text-white shadow-sm hover:bg-emerald-600 focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 disabled:bg-emerald-300\",\n    warning:\n      \"bg-amber-500 text-white shadow-sm hover:bg-amber-600 focus:ring-2 focus:ring-amber-400 focus:ring-offset-2 disabled:bg-amber-300\",\n    info:\n      \"bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300\",\n  };\n\n  return (\n    <button\n      type={type}\n      title={title}\n      className={`inline-flex items-center justify-center font-medium gap-2 rounded-md transition-colors duration-200 focus:outline-none ${\n        sizeClasses[size]\n      } ${variantClasses[variant]} ${\n        disabled ? \"cursor-not-allowed opacity-50\" : \"\"\n      } ${className}`}\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {startIcon && <span className=\"flex items-center\">{startIcon}</span>}\n      {children}\n      {endIcon && <span className=\"flex items-center\">{endIcon}</span>}\n    </button>\n  );\n};\n\nexport default Button;\n"
                }
              ]
            },
            {
              "type": "directory",
              "name": "modal",
              "children": [
                {
                  "type": "file",
                  "name": "ConfirmModal.tsx",
                  "content": "'use client';\n\nimport { XMarkIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\nimport Button from '../button/Button';\nimport LoadingSpinner from '../LoadingSpinner';\n\ninterface ConfirmModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  showCancel?: boolean;\n  variant?: 'danger' | 'warning' | 'info';\n  isLoading?: boolean;\n}\n\nexport default function ConfirmModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = 'Konfirmasi',\n  cancelText = 'Batal',\n  showCancel = true,\n  variant = 'danger',\n  isLoading = false\n}: ConfirmModalProps) {\n  if (!isOpen) return null;\n\n  const variantConfig = {\n    danger: {\n      icon: 'text-red-600',\n      button: 'bg-red-600 hover:bg-red-700 border-red-600'\n    },\n    warning: {\n      icon: 'text-amber-500',\n      button: 'bg-amber-500 hover:bg-amber-600 border-amber-500'\n    },\n    info: {\n      icon: 'text-blue-600',\n      button: 'bg-blue-600 hover:bg-blue-700 border-blue-600'\n    }\n  };\n\n  const config = variantConfig[variant];\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center\">\n              <ExclamationTriangleIcon className={`w-6 h-6 ${config.icon} mr-2`} />\n              <h3 className=\"text-lg font-medium text-gray-900\">{title}</h3>\n            </div>\n            {showCancel && (\n              <button\n                onClick={onClose}\n                disabled={isLoading}\n                className=\"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 disabled:opacity-50\"\n              >\n                <XMarkIcon className=\"h-5 w-5\" />\n              </button>\n            )}\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            <p className=\"text-sm text-gray-600 mb-6\">{message}</p>\n\n            {/* Buttons */}\n            <div className=\"flex justify-end space-x-3\">\n              {showCancel && (\n                <Button\n                  type=\"button\"\n                  onClick={onClose}\n                  disabled={isLoading}\n                  variant=\"outline\"\n                >\n                  {cancelText}\n                </Button>\n              )}\n              <Button\n                type=\"button\"\n                onClick={onConfirm}\n                disabled={isLoading}\n                className={`text-white ${config.button} focus:ring-2 focus:ring-offset-2`}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center\">\n                    <LoadingSpinner size=\"sm\" className=\"mr-2\" />\n                    Loading...\n                  </div>\n                ) : (\n                  confirmText\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
                }
              ]
            },
            {
              "type": "file",
              "name": "modal.tsx",
              "content": "\"use client\";\nimport React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ntype ModalProps = {\n  children: React.ReactNode;\n  isOpen: boolean;\n  onClose: () => void;\n  className?: string;\n};\n\nexport const Modal: React.FC<ModalProps> = ({\n  children,\n  isOpen,\n  onClose,\n  className,\n}) => {\n  if (!isOpen) return null;\n\n  return (\n    <>\n      <div\n        className=\"fixed inset-0 z-[99] bg-black/50 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      <div\n        className={cn(\n          \"fixed left-1/2 top-1/2 z-[999] -translate-x-1/2 -translate-y-1/2\",\n          className\n        )}\n      >\n        {children}\n      </div>\n    </>\n  );\n};"
            },
            {
              "type": "directory",
              "name": "toast",
              "children": [
                {
                  "type": "file",
                  "name": "Toast.tsx",
                  "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { XMarkIcon, CheckCircleIcon, ExclamationCircleIcon, InformationCircleIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\n\nexport interface ToastProps {\n  id: string;\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n  onClose: (id: string) => void;\n}\n\nexport default function Toast({ \n  id, \n  variant, \n  title, \n  message, \n  duration = 5000, \n  onClose \n}: ToastProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isExiting, setIsExiting] = useState(false);\n\n  useEffect(() => {\n    // Show animation\n    setIsVisible(true);\n\n    // Auto-hide timer\n    const timer = setTimeout(() => {\n      handleClose();\n    }, duration);\n\n    return () => clearTimeout(timer);\n  }, [duration]);\n\n  const handleClose = () => {\n    setIsExiting(true);\n    setTimeout(() => {\n      onClose(id);\n    }, 300); // Wait for exit animation\n  };\n\n  const variantConfig = {\n    success: {\n      bgColor: 'bg-emerald-50 border-emerald-200',\n      iconColor: 'text-emerald-500',\n      titleColor: 'text-emerald-800',\n      messageColor: 'text-emerald-700',\n      icon: CheckCircleIcon\n    },\n    error: {\n      bgColor: 'bg-red-50 border-red-200',\n      iconColor: 'text-red-500',\n      titleColor: 'text-red-800',\n      messageColor: 'text-red-700',\n      icon: ExclamationCircleIcon\n    },\n    warning: {\n      bgColor: 'bg-amber-50 border-amber-200',\n      iconColor: 'text-amber-500',\n      titleColor: 'text-amber-800',\n      messageColor: 'text-amber-700',\n      icon: ExclamationTriangleIcon\n    },\n    info: {\n      bgColor: 'bg-blue-50 border-blue-200',\n      iconColor: 'text-blue-500',\n      titleColor: 'text-blue-800',\n      messageColor: 'text-blue-700',\n      icon: InformationCircleIcon\n    }\n  };\n\n  const config = variantConfig[variant];\n  const IconComponent = config.icon;\n\n  return (\n    <div\n      className={`\n        pointer-events-auto w-full overflow-hidden rounded-lg border shadow-lg\n        ${config.bgColor}\n        transform transition-all duration-300 ease-in-out\n        ${isVisible && !isExiting \n          ? 'translate-x-0 opacity-100' \n          : 'translate-x-full opacity-0'\n        }\n      `}\n      style={{ minWidth: '320px', maxWidth: '400px' }}\n    >\n      <div className=\"p-4\">\n        <div className=\"flex items-start\">\n          <div className=\"flex-shrink-0\">\n            <IconComponent className={`h-6 w-6 ${config.iconColor}`} />\n          </div>\n          <div className=\"ml-3 flex-1 min-w-0\">\n            <p className={`text-sm font-medium ${config.titleColor} break-words`}>\n              {title}\n            </p>\n            <p className={`mt-1 text-sm ${config.messageColor} break-words`}>\n              {message}\n            </p>\n          </div>\n          <div className=\"ml-4 flex flex-shrink-0\">\n            <button\n              type=\"button\"\n              className={`\n                inline-flex rounded-md p-1.5 transition-colors duration-200\n                ${config.iconColor} hover:bg-black/5 focus:outline-none focus:ring-2 focus:ring-offset-2\n              `}\n              onClick={handleClose}\n            >\n              <span className=\"sr-only\">Dismiss</span>\n              <XMarkIcon className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
                },
                {
                  "type": "file",
                  "name": "ToastContainer.tsx",
                  "content": "'use client';\n\nimport { useState, useCallback } from 'react';\nimport Toast from './Toast';\n\ninterface ToastData {\n  id: string;\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n}\n\nexport interface ToastContextType {\n  addToast: (toast: Omit<ToastData, 'id'>) => void;\n  removeToast: (id: string) => void;\n}\n\nexport default function ToastContainer() {\n  const [toasts, setToasts] = useState<ToastData[]>([]);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  const addToast = useCallback((toast: Omit<ToastData, 'id'>) => {\n    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);\n    setToasts(prev => [...prev, { ...toast, id }]);\n  }, []);\n\n  // Expose methods globally for easy access\n  if (typeof window !== 'undefined') {\n    (window as any).showToast = addToast;\n  }\n\n  return (\n    <div\n      className=\"fixed top-4 right-4 z-[9999] flex flex-col space-y-2 pointer-events-none max-w-sm w-full\"\n      style={{ zIndex: 9999 }}\n    >\n      {toasts.map((toast) => (\n        <Toast\n          key={toast.id}\n          id={toast.id}\n          variant={toast.variant}\n          title={toast.title}\n          message={toast.message}\n          duration={toast.duration || 5000}\n          onClose={removeToast}\n        />\n      ))}\n    </div>\n  );\n}\n"
                }
              ]
            }
          ]
        },
        {
          "type": "directory",
          "name": "user-profile",
          "children": [
            {
              "type": "file",
              "name": "ChangePasswordCard.tsx",
              "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport { useModal } from \"@/hooks/useModal\";\nimport { Modal } from \"@/components/ui/modal\";\nimport Button from \"@/components/ui/button/Button\";\nimport Input from \"@/components/form/input/InputField\";\nimport Label from \"@/components/form/Label\";\nimport { useToast } from \"@/hooks/useToast\";\nimport { EyeIcon, EyeSlashIcon } from \"@heroicons/react/24/outline\";\n\nexport default function ChangePasswordCard() {\n  const { isOpen, openModal, closeModal } = useModal();\n  const { showSuccess, showError } = useToast();\n\n  const [passwords, setPasswords] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n\n  const [errors, setErrors] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n\n  const [showPassword, setShowPassword] = useState({\n    current: false,\n    new: false,\n    confirm: false,\n  });\n\n  const toggleShow = (field: \"current\" | \"new\" | \"confirm\") => {\n    setShowPassword((prev) => ({ ...prev, [field]: !prev[field] }));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setPasswords((prev) => ({\n      ...prev,\n      [name]: value,\n    }));\n    setErrors((prev) => ({\n      ...prev,\n      [name]: \"\",\n    }));\n  };\n\n  const validatePasswords = () => {\n    let isValid = true;\n    const newErrors = {\n      currentPassword: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    };\n\n    if (!passwords.currentPassword) {\n      newErrors.currentPassword = \"Password saat ini wajib diisi\";\n      isValid = false;\n    }\n\n    if (!passwords.newPassword) {\n      newErrors.newPassword = \"Password baru wajib diisi\";\n      isValid = false;\n    } else if (passwords.newPassword.length < 8) {\n      newErrors.newPassword = \"Password minimal 8 karakter\";\n      isValid = false;\n    }\n\n    if (!passwords.confirmPassword) {\n      newErrors.confirmPassword = \"Silakan konfirmasi password baru Anda\";\n      isValid = false;\n    } else if (passwords.newPassword !== passwords.confirmPassword) {\n      newErrors.confirmPassword = \"Password tidak cocok\";\n      isValid = false;\n    }\n\n    setErrors(newErrors);\n    return isValid;\n  };\n\n  const handleSave = async () => {\n    if (validatePasswords()) {\n      try {\n        const response = await fetch(\"/api/user/change-password\", {\n          method: \"PUT\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            currentPassword: passwords.currentPassword,\n            newPassword: passwords.newPassword,\n          }),\n        });\n\n        if (!response.ok) {\n          const error = await response.text();\n          throw new Error(error);\n        }\n\n        closeModal();\n        setPasswords({\n          currentPassword: \"\",\n          newPassword: \"\",\n          confirmPassword: \"\",\n        });\n        showSuccess(\"Berhasil\", \"Password berhasil diubah\");\n      } catch (error) {\n        console.error(\"Error changing password:\", error);\n        showError(\n          \"Error\",\n          error instanceof Error ? error.message : \"Gagal mengubah password\"\n        );\n        setErrors((prev) => ({\n          ...prev,\n          currentPassword:\n            error instanceof Error ? error.message : \"Gagal mengubah password\",\n        }));\n      }\n    }\n  };\n\n  return (\n    <div className=\"p-5 border border-gray-200 rounded-2xl lg:p-6\">\n      <div className=\"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between\">\n        <div>\n          <h4 className=\"text-lg font-semibold text-gray-800 lg:mb-2\">\n            Pengaturan Password\n          </h4>\n          <p className=\"text-sm text-gray-500\">\n            Ubah password Anda untuk menjaga keamanan akun\n          </p>\n        </div>\n\n        <button\n          onClick={openModal}\n          className=\"flex w-full items-center justify-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-xs hover:bg-gray-50 hover:text-gray-800 lg:inline-flex lg:w-auto\"\n        >\n          Ubah Password\n        </button>\n      </div>\n\n      <Modal isOpen={isOpen} onClose={closeModal} className=\"max-w-[500px] m-4\">\n        <div className=\"no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 lg:p-8\">\n          <div className=\"pr-14\">\n            <h4 className=\"mb-2 text-2xl font-semibold text-gray-800\">\n              Ubah Password\n            </h4>\n            <p className=\"mb-6 text-sm text-gray-500\">\n              Silakan masukkan password saat ini dan pilih password baru.\n            </p>\n          </div>\n          <form className=\"flex flex-col gap-5\">\n            {/* Password Saat Ini */}\n            <div>\n              <Label>Password Saat Ini</Label>\n              <div className=\"relative\">\n                <Input\n                  type={showPassword.current ? \"text\" : \"password\"}\n                  name=\"currentPassword\"\n                  value={passwords.currentPassword}\n                  onChange={handleChange}\n                  error={errors.currentPassword}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => toggleShow(\"current\")}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                >\n                  {showPassword.current ? (\n                    <EyeSlashIcon className=\"w-5 h-5\" />\n                  ) : (\n                    <EyeIcon className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Password Baru */}\n            <div>\n              <Label>Password Baru</Label>\n              <div className=\"relative\">\n                <Input\n                  type={showPassword.new ? \"text\" : \"password\"}\n                  name=\"newPassword\"\n                  value={passwords.newPassword}\n                  onChange={handleChange}\n                  error={errors.newPassword}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => toggleShow(\"new\")}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                >\n                  {showPassword.new ? (\n                    <EyeSlashIcon className=\"w-5 h-5\" />\n                  ) : (\n                    <EyeIcon className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Konfirmasi Password Baru */}\n            <div>\n              <Label>Konfirmasi Password Baru</Label>\n              <div className=\"relative\">\n                <Input\n                  type={showPassword.confirm ? \"text\" : \"password\"}\n                  name=\"confirmPassword\"\n                  value={passwords.confirmPassword}\n                  onChange={handleChange}\n                  error={errors.confirmPassword}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => toggleShow(\"confirm\")}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n                >\n                  {showPassword.confirm ? (\n                    <EyeSlashIcon className=\"w-5 h-5\" />\n                  ) : (\n                    <EyeIcon className=\"w-5 h-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-3 mt-6 lg:justify-end\">\n              <Button size=\"sm\" variant=\"outline\" onClick={closeModal}>\n                Batal\n              </Button>\n              <Button size=\"sm\" onClick={handleSave}>\n                Perbarui Password\n              </Button>\n            </div>\n          </form>\n        </div>\n      </Modal>\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "UserInfoCard.tsx",
              "content": "\"use client\";\n\nimport React, { useState } from \"react\";\nimport Input from \"../form/Input\";\nimport TextArea from \"../form/textarea/TextArea\";\nimport { useRouter } from \"next/navigation\";\nimport { useToast } from \"@/hooks/useToast\";\nimport ConfirmationModal from \"../common/ConfirmationModal\";\n\ninterface UserInfoCardProps {\n  user: {\n    id: string;\n    email: string;\n    officer_name: string;\n    vendor_name: string | null;\n    phone_number: string | null;\n    address: string | null;\n    role: string; // gunakan enum jika ada\n  };\n}\n\nexport default function UserInfoCard({ user }: UserInfoCardProps) {\n  const router = useRouter();\n  const { showSuccess, showError } = useToast();\n\n  const [isEditing, setIsEditing] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\n\n  const [errors, setErrors] = useState({\n    officer_name: \"\",\n    vendor_name: \"\",\n    phone_number: \"\",\n    address: \"\",\n    email: \"\",\n  });\n\n  const [formData, setFormData] = useState({\n    officer_name: user.officer_name ?? \"\",\n    vendor_name: user.vendor_name ?? \"\",\n    phone_number: user.phone_number ?? \"\",\n    address: user.address ?? \"\",\n    email: user.email ?? \"\",\n  });\n\n  const validateEmail = (email: string) =>\n    /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n\n  const validateForm = () => {\n    if (user.role === \"VENDOR\") {\n      return (\n        formData.vendor_name.trim() &&\n        formData.email.trim() &&\n        formData.phone_number.trim() &&\n        formData.address.trim()\n      );\n    }\n    return (\n      formData.officer_name.trim() &&\n      formData.email.trim() &&\n      formData.phone_number.trim() &&\n      formData.address.trim()\n    );\n  };\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const { name, value } = e.target;\n\n    if (name === \"address\") {\n      // Izinkan huruf, angka, spasi, koma, titik, garis miring, dash\n      if (/^[a-zA-Z0-9\\s,./-]*$/.test(value)) {\n        setFormData((prev) => ({ ...prev, [name]: value }));\n      }\n    } else {\n      setFormData((prev) => ({ ...prev, [name]: value }));\n    }\n\n    if (errors[name as keyof typeof errors]) {\n      setErrors((prev) => ({ ...prev, [name]: \"\" }));\n    }\n  };\n\n  const handleSaveConfirm = async () => {\n    try {\n      setIsLoading(true);\n\n      const newErrors = {\n        officer_name: \"\",\n        vendor_name: \"\",\n        phone_number: \"\",\n        address: \"\",\n        email: \"\",\n      };\n\n      // Validasi berdasarkan role\n      if (user.role === \"VENDOR\") {\n        if (!formData.vendor_name.trim()) {\n          newErrors.vendor_name = \"Nama vendor wajib diisi\";\n        }\n      } else {\n        if (!formData.officer_name.trim()) {\n          newErrors.officer_name = \"Nama petugas wajib diisi\";\n        }\n      }\n\n      // Validasi umum\n      if (!formData.phone_number.trim()) newErrors.phone_number = \"Nomor telepon wajib diisi\";\n      if (!formData.address.trim()) newErrors.address = \"Alamat wajib diisi\";\n      if (!formData.email.trim() || !validateEmail(formData.email.trim()))\n        newErrors.email = \"Format email tidak valid\";\n\n      const hasErrors = Object.values(newErrors).some((e) => e !== \"\");\n      if (hasErrors) {\n        setErrors(newErrors);\n        const first = Object.values(newErrors).find((e) => e !== \"\");\n        if (first) showError(\"Error\", first);\n        setIsLoading(false);\n        return;\n      }\n\n      // Kirim field sesuai role + email\n      const dataToSend =\n        user.role === \"VENDOR\"\n          ? {\n              vendor_name: formData.vendor_name.trim(),\n              phone_number: formData.phone_number.trim(),\n              address: formData.address.trim(),\n              email: formData.email.trim(), // ✅ email ikut dikirim\n            }\n          : {\n              officer_name: formData.officer_name.trim(),\n              phone_number: formData.phone_number.trim(),\n              address: formData.address.trim(),\n              email: formData.email.trim(), // ✅ email ikut dikirim\n            };\n\n      const response = await fetch(\"/api/users/profile\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(dataToSend),\n      });\n\n      const text = await response.text();\n\n      if (!response.ok) {\n        // pesan error dari server (mis. 400 validasi, 409 email duplikat)\n        throw new Error(text || \"Gagal memperbarui profil\");\n      }\n\n      showSuccess(\"Berhasil\", \"Profil berhasil diperbarui\");\n      setIsEditing(false);\n      setShowConfirmModal(false);\n      router.refresh();\n    } catch (error: any) {\n      console.error(\"Error updating profile:\", error);\n      showError(\"Error\", error?.message ?? \"Gagal memperbarui profil\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSave = () => {\n    setErrors({\n      officer_name: \"\",\n      vendor_name: \"\",\n      phone_number: \"\",\n      address: \"\",\n      email: \"\",\n    });\n\n    if (!validateEmail(formData.email.trim())) {\n      setErrors((prev) => ({ ...prev, email: \"Format email tidak valid\" }));\n      showError(\"Error\", \"Format email tidak valid\");\n      return;\n    }\n\n    if (!validateForm()) {\n      showError(\"Error\", \"Mohon isi semua field yang wajib diisi\");\n      return;\n    }\n\n    setShowConfirmModal(true);\n  };\n\n  return (\n    <>\n      <div className=\"p-5 border border-gray-200 rounded-2xl lg:p-6\">\n        <div className=\"flex flex-col gap-6\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"text-lg font-semibold text-gray-800\">\n              Informasi Pribadi\n            </h4>\n\n            {!isEditing ? (\n              <button\n                onClick={() => setIsEditing(true)}\n                className=\"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50\"\n              >\n                <svg\n                  className=\"h-4 w-4\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"\n                  />\n                </svg>\n                Ubah\n              </button>\n            ) : (\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={() => {\n                    setFormData({\n                      officer_name: user.officer_name ?? \"\",\n                      vendor_name: user.vendor_name ?? \"\",\n                      phone_number: user.phone_number ?? \"\",\n                      address: user.address ?? \"\",\n                      email: user.email ?? \"\",\n                    });\n                    setIsEditing(false);\n                  }}\n                  className=\"inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50\"\n                >\n                  Batal\n                </button>\n                <button\n                  onClick={handleSave}\n                  disabled={isLoading}\n                  className=\"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 disabled:opacity-50\"\n                >\n                  {isLoading ? \"Menyimpan...\" : \"Simpan Perubahan\"}\n                </button>\n              </div>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n            {/* Nama Vendor - khusus VENDOR */}\n            {user.role === \"VENDOR\" && (\n              <div className=\"lg:col-span-2\">\n                <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n                {isEditing ? (\n                  <Input\n                    id=\"vendor_name\"\n                    name=\"vendor_name\"\n                    type=\"text\"\n                    value={formData.vendor_name}\n                    onChange={handleChange}\n                    placeholder=\"PT. Nama Perusahaan\"\n                    required\n                    className=\"mt-1\"\n                  />\n                ) : (\n                  <p className=\"mt-1 text-base text-gray-900\">\n                    {user.vendor_name || \"-\"}\n                  </p>\n                )}\n              </div>\n            )}\n\n            {/* Nama Petugas - untuk semua role (editable jika bukan vendor, tampil readonly jika vendor) */}\n            <div>\n              <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n              {isEditing  ? (\n                <Input\n                  id=\"officer_name\"\n                  name=\"officer_name\"\n                  type=\"text\"\n                  value={formData.officer_name}\n                  onChange={handleChange}\n                  placeholder=\"Masukkan nama petugas\"\n                  required\n                  className=\"mt-1\"\n                />\n              ) : (\n                <p className=\"mt-1 text-base text-gray-900\">\n                  {user.officer_name || \"-\"}\n                </p>\n              )}\n            </div>\n\n            {/* Email - semua role */}\n            <div>\n              <p className=\"text-sm font-medium text-gray-500\">Email</p>\n              {isEditing ? (\n                <Input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={handleChange}\n                  placeholder=\"email@perusahaan.com\"\n                  required\n                  error={errors.email}\n                  className=\"mt-1\"\n                />\n              ) : (\n                <p className=\"mt-1 text-base text-gray-900\">{user.email}</p>\n              )}\n            </div>\n\n            {/* Nomor Telepon */}\n            <div>\n              <p className=\"text-sm font-medium text-gray-500\">Nomor Telepon</p>\n              {isEditing ? (\n                <Input\n                  id=\"phone_number\"\n                  name=\"phone_number\"\n                  type=\"tel\"\n                  value={formData.phone_number}\n                  onChange={handleChange}\n                  placeholder=\"08123456789\"\n                  required\n                  className=\"mt-1\"\n                />\n              ) : (\n                <p className=\"mt-1 text-base text-gray-900\">\n                  {user.phone_number || \"-\"}\n                </p>\n              )}\n            </div>\n\n            {/* Alamat */}\n            <div className=\"lg:col-span-2\">\n              <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n              {isEditing ? (\n                <TextArea\n                  name=\"address\"\n                  value={formData.address}\n                  onChange={handleChange}\n                  className=\"mt-1\"\n                  rows={3}\n                  error={errors.address}\n                />\n              ) : (\n                <p className=\"mt-1 text-base text-gray-900 whitespace-pre-line\">\n                  {user.address || \"-\"}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <ConfirmationModal\n        isOpen={showConfirmModal}\n        onClose={() => setShowConfirmModal(false)}\n        onConfirm={handleSaveConfirm}\n        title=\"Konfirmasi Perubahan\"\n        message=\"Apakah Anda yakin ingin menyimpan perubahan pada profil?\"\n        confirmText=\"Simpan\"\n        cancelText=\"Batal\"\n      />\n    </>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "vendor",
          "children": [
            {
              "type": "file",
              "name": "EditSubmissionForm.tsx",
              "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSession } from 'next-auth/react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport Input from '@/components/form/Input';\nimport Label from '@/components/form/Label';\nimport DatePicker from '@/components/form/DatePicker';\nimport TimePicker from '@/components/form/TimePicker';\nimport FileUpload from '@/components/form/FileUpload';\nimport Alert from '@/components/ui/alert/Alert';\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\nimport { useToast } from '@/hooks/useToast';\n\n// Define Worker interface for dynamic inputs\ninterface Worker {\n  id: string;\n  nama_pekerja: string;\n  foto_pekerja: string;\n}\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string | null;\n  work_facilities: string;\n  worker_count?: number | null;\n  simja_number?: string | null;\n  simja_date?: Date | null;\n  sika_number?: string | null;\n  sika_date?: Date | null;\n  worker_names: string;\n  content: string | null;\n  sika_document_upload?: string | null;\n  simja_document_upload?: string | null;\n}\n\ninterface EditSubmissionFormProps {\n  submissionId: string;\n}\n\nexport default function EditSubmissionForm({ submissionId }: EditSubmissionFormProps) {\n  const router = useRouter();\n  const { data: session, status: _status } = useSession();\n  const { showSuccess, showError } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isInitialLoading, setIsInitialLoading] = useState(true);\n  const [alert, setAlert] = useState<{ variant: 'success' | 'error' | 'warning' | 'info', title: string, message: string } | null>(null);\n  const [submission, setSubmission] = useState<Submission | null>(null);\n  \n  // State for dynamic workers\n  const [workers, setWorkers] = useState<Worker[]>([\n    { id: '1', nama_pekerja: '', foto_pekerja: '' }\n  ]);\n  \n  // Load submission data\n  useEffect(() => {\n    const fetchSubmission = async () => {\n      setIsInitialLoading(true);\n      try {\n        const response = await fetch(`/api/submissions/${submissionId}`);\n        if (response.ok) {\n          const data = await response.json();\n          setSubmission(data);\n          \n          // Also fetch workers data\n          const workersResponse = await fetch(`/api/submissions/${submissionId}/workers`);\n          if (workersResponse.ok) {\n            const workersData = await workersResponse.json();\n            if (workersData.workers && workersData.workers.length > 0) {\n              setWorkers(workersData.workers.map((worker: any) => ({\n                id: worker.id,\n                nama_pekerja: worker.worker_name || worker.nama_pekerja || '',\n                foto_pekerja: worker.worker_photo || worker.foto_pekerja || ''\n              })));\n            }\n          }\n        } else {\n          setAlert({\n            variant: 'error',\n            title: 'Error!',\n            message: 'Gagal memuat data pengajuan'\n          });\n        }\n      } catch (error) {\n        console.error('Error fetching submission:', error);\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Gagal memuat data pengajuan'\n        });\n      } finally {\n        setIsInitialLoading(false);\n      }\n    };\n    \n    if (submissionId) {\n      fetchSubmission();\n    }\n  }, [submissionId]);\n\n  const [formData, setFormData] = useState({\n    nama_vendor: '',\n    berdasarkan: '',\n    nama_petugas: '',\n    pekerjaan: '',\n    lokasi_kerja: '',\n    pelaksanaan: '',\n    jam_kerja: '',\n    lain_lain: '',\n    sarana_kerja: '',\n    jumlah_pekerja: 0,\n    nomor_simja: '',\n    tanggal_simja: '',\n    nomor_sika: '',\n    tanggal_sika: '',\n    nama_pekerja: '',\n    content: '',\n    upload_doc_sika: '',\n    upload_doc_simja: '',\n  });\n\n  // Update form data when submission is loaded\n  useEffect(() => {\n    if (submission) {\n      setFormData({\n        nama_vendor: submission.vendor_name || '',\n        berdasarkan: submission.based_on || '',\n        nama_petugas: submission.officer_name || '',\n        pekerjaan: submission.job_description || '',\n        lokasi_kerja: submission.work_location || '',\n        pelaksanaan: submission.implementation || '',\n        jam_kerja: submission.working_hours || '',\n        lain_lain: submission.other_notes || '',\n        sarana_kerja: submission.work_facilities || '',\n        jumlah_pekerja: submission.worker_count || 0,\n        nomor_simja: submission.simja_number || '',\n        tanggal_simja: submission.simja_date ? (() => {\n          const date = new Date(submission.simja_date);\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        })() : '',\n        nomor_sika: submission.sika_number || '',\n        tanggal_sika: submission.sika_date ? (() => {\n          const date = new Date(submission.sika_date);\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        })() : '',\n        nama_pekerja: submission.worker_names || '',\n        content: submission.content || '',\n        upload_doc_sika: submission.sika_document_upload || '',\n        upload_doc_simja: submission.simja_document_upload || '',\n      });\n    }\n  }, [submission]);\n  \n  // Auto-fill form data when session is available (for readonly fields)\n  useEffect(() => {\n    if (session?.user && submission) {\n      setFormData(prev => ({\n        ...prev,\n        // Keep vendor name readonly for vendors - use session data if available\n        nama_vendor: session.user.vendor_name || submission.vendor_name || prev.nama_vendor || '',\n      }));\n    }\n  }, [session, submission]);\n\n  // Handle file upload from FileUpload component\n  const handleFileUpload = (fieldName: string) => (url: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [fieldName]: url\n    }));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value, type } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'number' ? (value === '' ? 0 : Number(value)) : value\n    }));\n  };\n\n  const handleDateChange = (name: string) => (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleTimeChange = (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      jam_kerja: value\n    }));\n  };\n\n  // Functions for managing dynamic workers\n  const addWorker = () => {\n    const newWorker: Worker = {\n      id: Date.now().toString(),\n      nama_pekerja: '',\n      foto_pekerja: ''\n    };\n    setWorkers(prev => [...prev, newWorker]);\n  };\n\n  const removeWorker = (id: string) => {\n    if (workers.length > 1) {\n      setWorkers(prev => prev.filter(worker => worker.id !== id));\n    }\n  };\n\n  const updateWorkerName = (id: string, nama: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, nama_pekerja: nama } : worker\n    ));\n  };\n\n  const updateWorkerPhoto = (id: string, foto: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, foto_pekerja: foto } : worker\n    ));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Check if submission is loaded\n    if (!submission) {\n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: 'Data pengajuan belum dimuat'\n      });\n      return;\n    }\n    \n    // Check if submission is still editable\n    if (submission.approval_status !== 'PENDING') {\n      setAlert({\n        variant: 'warning',\n        title: 'Peringatan!',\n        message: 'Tidak dapat mengubah pengajuan yang sudah diproses oleh admin.'\n      });\n      return;\n    }\n    \n    // Client-side validation\n    const requiredFields = [\n      'nama_vendor', 'berdasarkan', 'nama_petugas', 'pekerjaan', \n      'lokasi_kerja', 'jam_kerja', 'sarana_kerja', 'nama_pekerja'\n    ];\n\n    for (const field of requiredFields) {\n      const value = formData[field as keyof typeof formData];\n      if (!value || (typeof value === 'string' && value.trim() === '')) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: `Field ${field} harus diisi!`\n        });\n        return;\n      }\n    }\n    \n    setIsLoading(true);\n\n    try {\n      // Validate workers\n      const validWorkers = workers.filter(worker => worker.nama_pekerja.trim() !== '');\n      if (validWorkers.length === 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Minimal harus ada satu pekerja yang diisi'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Check if all workers have photos\n      const workersWithoutPhoto = validWorkers.filter(worker => !worker.foto_pekerja.trim());\n      if (workersWithoutPhoto.length > 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Semua pekerja harus memiliki foto. Silakan upload foto untuk semua pekerja.'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Format worker names for database\n      const workerNames = validWorkers.map(worker => worker.nama_pekerja.trim()).join('\\n');\n\n      // Prepare submission data - transform Indonesian field names to English for API\n      const formattedData = {\n        vendor_name: formData.nama_vendor,\n        based_on: formData.berdasarkan,\n        officer_name: formData.nama_petugas,\n        job_description: formData.pekerjaan,\n        work_location: formData.lokasi_kerja,\n        implementation: formData.pelaksanaan,\n        working_hours: formData.jam_kerja,\n        other_notes: formData.lain_lain,\n        work_facilities: formData.sarana_kerja,\n        worker_count: formData.jumlah_pekerja,\n        simja_number: formData.nomor_simja,\n        simja_date: formData.tanggal_simja ? new Date(formData.tanggal_simja) : null,\n        sika_number: formData.nomor_sika,\n        sika_date: formData.tanggal_sika ? new Date(formData.tanggal_sika) : null,\n        worker_names: workerNames,\n        content: formData.content,\n        sika_document_upload: formData.upload_doc_sika,\n        simja_document_upload: formData.upload_doc_simja,\n        workers: validWorkers.map(worker => ({\n          worker_name: worker.nama_pekerja.trim(),\n          worker_photo: worker.foto_pekerja\n        }))\n      };\n\n      console.log('Sending update request:', {\n        url: `/api/submissions/${submission.id}`,\n        method: 'PUT',\n        data: formattedData\n      });\n\n      const response = await fetch(`/api/submissions/${submission.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(formattedData),\n      });\n\n      console.log('Response status:', response.status);\n      console.log('Response headers:', Object.fromEntries(response.headers.entries()));\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Error response:', errorText);\n        \n        let errorMessage;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorMessage = errorJson.error || errorJson.message || 'Gagal menyimpan perubahan';\n        } catch {\n          errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n        }\n        \n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: `Error: ${errorMessage}`\n        });\n        showError('Gagal Menyimpan', errorMessage);\n        return;\n      }\n\n      const result = await response.json();\n      console.log('Update successful:', result);\n      \n      // Show success toast and redirect immediately\n      showSuccess('Berhasil!', 'Perubahan berhasil disimpan!');\n      \n      // Redirect immediately without delay\n      router.push('/vendor/submissions');\n    } catch (error) {\n      console.error('Network/unexpected error:', error);\n      \n      let errorMessage = 'Terjadi kesalahan tidak terduga';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: `Gagal menyimpan perubahan: ${errorMessage}`\n      });\n      showError('Error!', `Gagal menyimpan perubahan: ${errorMessage}`);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      {isInitialLoading ? (\n        <Card>\n          <div className=\"p-6 text-center\">\n            <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n            <p className=\"text-gray-600\">Memuat data pengajuan...</p>\n          </div>\n        </Card>\n      ) : !submission ? (\n        <Card>\n          <div className=\"p-6 text-center\">\n            <p className=\"text-red-600\">Data pengajuan tidak ditemukan</p>\n          </div>\n        </Card>\n      ) : (\n        <Card>\n          <div className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-6\">\n              <div className=\"text-sm text-gray-500\">\n                Status: <span className={`font-medium ${\n                  submission.approval_status === 'PENDING' ? 'text-yellow-600' :\n                  submission.approval_status === 'APPROVED' ? 'text-green-600' :\n                  'text-red-600'\n                }`}>{\n                  submission.approval_status === 'PENDING' ? 'Menunggu Review' :\n                  submission.approval_status === 'APPROVED' ? 'Disetujui' :\n                  submission.approval_status === 'REJECTED' ? 'Ditolak' :\n                  submission.approval_status\n                }</span>\n              </div>\n            </div>\n            \n            {submission.approval_status !== 'PENDING' && (\n              <div className=\"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <p className=\"text-yellow-800 text-sm\">\n                  <span className=\"font-medium\">Peringatan:</span> Pengajuan ini sudah diproses oleh admin dan tidak dapat diubah.\n                  Anda hanya dapat melihat detailnya saja.\n                </p>\n              </div>\n            )}\n            \n            <form onSubmit={handleSubmit} className=\"space-y-8\">\n              <fieldset disabled={submission.approval_status !== 'PENDING'} className={submission.approval_status !== 'PENDING' ? 'opacity-60' : ''}>\n            \n            {/* Informasi Vendor */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Vendor</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"nama_vendor\">Nama vendor</Label>\n                  <Input\n                    id=\"nama_vendor\"\n                    name=\"nama_vendor\"\n                    value={session?.user?.vendor_name || formData.nama_vendor || ''}\n                    onChange={handleChange}\n                    type=\"text\"\n                    required\n                    disabled={!!session?.user?.vendor_name}\n                    placeholder=\"PT. Nama Perusahaan\"\n                    className={session?.user?.vendor_name ? \"cursor-not-allowed\" : \"\"}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"nama_petugas\">Nama petugas</Label>\n                  <Input\n                    id=\"nama_petugas\"\n                    name=\"nama_petugas\"\n                    value={formData.nama_petugas}\n                    onChange={handleChange}\n                    type=\"text\"\n                    required\n                    placeholder=\"Nama petugas yang bertanggung jawab\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <Label htmlFor=\"berdasarkan\">Berdasarkan</Label>\n                  <Input\n                    id=\"berdasarkan\"\n                    name=\"berdasarkan\"\n                    value={formData.berdasarkan}\n                    onChange={handleChange}\n                    type='text'\n                    required\n                  />\n                </div>\n\n                {/* Document Numbers */}\n                <div>\n                  <Label htmlFor=\"nomor_simja\">Nomor SIMJA</Label>\n                  <Input\n                    id=\"nomor_simja\"\n                    name=\"nomor_simja\"\n                    value={formData.nomor_simja}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIMJA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"nomor_sika\">Nomor SIKA</Label>\n                  <Input\n                    id=\"nomor_sika\"\n                    name=\"nomor_sika\"\n                    value={formData.nomor_sika}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIKA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"tanggal_simja\">Tanggal SIMJA</Label>\n                  <DatePicker\n                    id=\"tanggal_simja\"\n                    name=\"tanggal_simja\"\n                    value={formData.tanggal_simja}\n                    onChange={handleDateChange('tanggal_simja')}\n                    placeholder=\"Pilih tanggal SIMJA\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"tanggal_sika\">Tanggal SIKA</Label>\n                  <DatePicker\n                    id=\"tanggal_sika\"\n                    name=\"tanggal_sika\"\n                    value={formData.tanggal_sika}\n                    onChange={handleDateChange('tanggal_sika')}\n                    placeholder=\"Pilih tanggal SIKA\"\n                    required\n                  />\n                </div>\n\n                {/* File Upload Areas */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"upload_doc_simja\">UPLOAD DOKUMEN SIMJA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"upload_doc_simja\"\n                      name=\"upload_doc_simja\"\n                      label=\"\"\n                      description=\"Upload dokumen SIMJA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.upload_doc_simja}\n                      onChange={handleFileUpload('upload_doc_simja')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required={false}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"upload_doc_sika\">UPLOAD DOKUMEN SIKA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"upload_doc_sika\"\n                      name=\"upload_doc_sika\"\n                      label=\"\"\n                      description=\"Upload dokumen SIKA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.upload_doc_sika}\n                      onChange={handleFileUpload('upload_doc_sika')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required={false}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Informasi Pekerjaan */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Pekerjaan</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"pekerjaan\">Pekerjaan</Label>\n                  <Input\n                    id=\"pekerjaan\"\n                    name=\"pekerjaan\"\n                    value={formData.pekerjaan}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"lokasi_kerja\">Lokasi kerja</Label>\n                  <Input\n                    id=\"lokasi_kerja\"\n                    name=\"lokasi_kerja\"\n                    value={formData.lokasi_kerja}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"jam_kerja\">Jam kerja</Label>\n                  <TimePicker\n                    id=\"jam_kerja\"\n                    name=\"jam_kerja\"\n                    value={formData.jam_kerja}\n                    onChange={handleTimeChange}\n                    required\n                    placeholder=\"Pilih jam kerja\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sarana_kerja\">Sarana kerja</Label>\n                  <Input\n                    id=\"sarana_kerja\"\n                    name=\"sarana_kerja\"\n                    value={formData.sarana_kerja}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: Toolkit lengkap, APD standar, crane mobile\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"jumlah_pekerja\">Jumlah Pekerja</Label>\n                  <Input\n                    id=\"jumlah_pekerja\"\n                    name=\"jumlah_pekerja\"\n                    type=\"number\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={formData.jumlah_pekerja || ''}\n                    onChange={handleChange}\n                    placeholder=\"Masukkan jumlah pekerja\"\n                    required\n                  />\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    Jumlah total pekerja yang akan bekerja di lokasi ini\n                  </p>\n                </div>\n\n                <div className=\"flex items-end\">\n                  <div className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg w-full\">\n                    <div className=\"font-medium mb-1\">Info:</div>\n                    <div>Pekerja yang diinput: {workers.length}</div>\n                    <div>Jumlah pekerja: {formData.jumlah_pekerja || 0}</div>\n                    {formData.jumlah_pekerja && workers.length !== Number(formData.jumlah_pekerja) && (\n                      <div className=\"text-orange-600 mt-1\">\n                        ⚠️ Jumlah tidak sesuai dengan daftar pekerja\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Daftar nama pekerja */}\n            <div className=\"p-6 rounded-lg\">\n              <div className=\"flex justify-between items-center mb-6 border-b border-gray-300 \">\n                <div className='flex justify-between'>\n                  <h2 className=\"text-lg font-semibold text-gray-900 pb-2\">Daftar Nama Pekerja</h2>\n                  <p className=\"text-sm text-gray-500 mt-2\">Total: {workers.length} pekerja</p>\n                </div>\n               \n              </div>\n              \n              {/* Workers Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {workers.map((worker, _index) => (\n                  <div key={worker.id} className=\"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md\">\n                    {/* Header */}\n                    <div className=\"flex justify-between items-center mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        {/* <div className=\"bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium\">\n                          {index + 1}\n                        </div>\n                        <span className=\"text-sm font-medium text-gray-700\">Pekerja {index + 1}</span> */}\n                      </div>\n                      {workers.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          onClick={() => removeWorker(worker.id)}\n                          variant=\"outline\"\n                          className=\"text-red-500 hover:bg-red-50 border-red-200 w-8 h-8 p-0 rounded-full\"\n                          title=\"Hapus pekerja\"\n                          disabled={submission.approval_status !== 'PENDING'}\n                        >\n                          ✕\n                        </Button>\n                      )}\n                    </div>\n                    \n                    {/* Photo Preview */}\n                    <div className=\"mb-4\">\n\n                      <div className=\"relative\">\n                        {worker.foto_pekerja ? (\n                          <div className=\"relative group\">\n                            <img \n                              src={worker.foto_pekerja} \n                              alt={`Foto ${worker.nama_pekerja || 'pekerja'}`}\n                              className=\"w-full h-50 object-cover rounded-lg border-2 border-gray-300\"\n                            />\n                            <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center\">\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                onClick={() => document.getElementById(`foto_pekerja_${worker.id}`)?.click()}\n                                className=\"bg-white text-gray-800 hover:bg-gray-100 text-xs px-3 py-1\"\n                                disabled={submission.approval_status !== 'PENDING'}\n                              >\n                                Ganti Foto\n                              </Button>\n                            </div>\n                            <button\n                              type=\"button\"\n                              onClick={() => updateWorkerPhoto(worker.id, '')}\n                              className=\"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\"\n                              title=\"Hapus foto\"\n                              disabled={submission.approval_status !== 'PENDING'}\n                            >\n                              ✕\n                            </button>\n                          </div>\n                        ) : (\n                          <div \n                            onClick={() => submission.approval_status === 'PENDING' && document.getElementById(`foto_pekerja_${worker.id}`)?.click()}\n                            className={`w-full h-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center transition-all duration-200 bg-gray-50 ${\n                              submission.approval_status === 'PENDING' \n                                ? 'cursor-pointer hover:border-blue-400 hover:bg-blue-50' \n                                : 'cursor-not-allowed opacity-60'\n                            }`}\n                          >\n                           \n                            <p className=\"text-sm font-medium text-gray-600\">Upload Foto Pekerja</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">Klik atau drag & drop foto</p>\n   \n                          </div>\n                        )}\n                        <FileUpload\n                          id={`foto_pekerja_${worker.id}`}\n                          name={`foto_pekerja_${worker.id}`}\n                          label=\"\"\n                          description=\"\"\n                          value={worker.foto_pekerja}\n                          onChange={(url) => updateWorkerPhoto(worker.id, url)}\n                          accept=\".jpg,.jpeg,.png\"\n                          maxSize={8}\n                          required={false}\n                          className=\"sr-only\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Name Input */}\n                    <div>\n                      <Label htmlFor={`nama_pekerja_${worker.id}`} className=\"text-sm font-medium text-gray-700\">\n                        Nama Lengkap\n                      </Label>\n                      <Input\n                        id={`nama_pekerja_${worker.id}`}\n                        name={`nama_pekerja_${worker.id}`}\n                        value={worker.nama_pekerja}\n                        onChange={(e) => updateWorkerName(worker.id, e.target.value)}\n                        type=\"text\"\n                        placeholder=\"Masukkan nama lengkap\"\n                        required\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    \n                    {/* Status Indicator */}\n                    <div className=\"mt-3 flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${\n                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'bg-green-400' \n                          : 'bg-red-400'\n                      }`}></div>\n                      <span className={`text-xs ${\n                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'text-green-600' \n                          : 'text-red-600'\n                      }`}>\n                        {worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'Lengkap' \n                          : worker.nama_pekerja.trim() \n                            ? 'Perlu foto' \n                            : 'Belum lengkap'}\n                      </span>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Add New Worker Card */}\n                {submission.approval_status === 'PENDING' && (\n                  <div \n                    onClick={addWorker}\n                    className=\"border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex flex-col items-center justify-center min-h-[280px] text-gray-500 hover:text-blue-600\"\n                  >\n                    <div className=\"text-4xl mb-2\">➕</div>\n                    <p className=\"text-sm font-medium\">Tambah Pekerja Baru</p>\n                    <p className=\"text-xs mt-1\">Klik untuk menambah</p>\n                  </div>\n                )}\n              </div>\n              \n           \n             \n            </div>\n\n            </fieldset>\n\n            <div className=\"flex justify-end space-x-4 pt-6 border-t\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => router.back()}\n                disabled={isLoading}\n              >\n                Batal\n              </Button>\n              {submission.approval_status === 'PENDING' && (\n                <Button\n                  type=\"submit\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? 'Menyimpan...' : 'Simpan Perubahan'}\n                </Button>\n              )}\n            </div>\n          </form>\n\n          {/* Alert */}\n          {alert && (\n            <Alert\n              variant={alert.variant}\n              title={alert.title}\n              message={alert.message}\n            />\n          )}\n        </div>\n      </Card>\n      )}\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "SubmissionDetailModal.tsx",
              "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { \n  XMarkIcon, \n  EyeIcon, \n  DocumentIcon, \n  BuildingOfficeIcon,\n  UserIcon,\n  BriefcaseIcon,\n  CalendarIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon as PendingIcon\n} from '@heroicons/react/24/outline';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport WorkersList from '@/components/common/WorkersList';\nimport DetailSection from '@/components/common/DetailSection';\nimport InfoCard from '@/components/common/InfoCard';\nimport Button from '@/components/ui/button/Button';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status?: string;\n  review_note?: string;\n  final_note?: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\ninterface SubmissionDetailModalProps {\n  submission: Submission | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function SubmissionDetailModal({\n  submission,\n  isOpen,\n  onClose\n}: SubmissionDetailModalProps) {\n  const [showDebug, setShowDebug] = useState(false);\n  const [isDocumentModalOpen, setIsDocumentModalOpen] = useState(false);\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n  const [selectedDocument, setSelectedDocument] = useState<{\n    url: string;\n    title: string;\n  } | null>(null);\n\n  useEffect(() => {\n    // Handle escape key to close modal\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  if (!isOpen || !submission) return null;\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    switch (status) {\n      case 'PENDING':\n        return (\n          <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>\n            Menunggu\n          </span>\n        );\n      case 'APPROVED':\n        return (\n          <span className={`${baseClasses} bg-green-100 text-green-800`}>\n            Disetujui\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className={`${baseClasses} bg-red-100 text-red-800`}>\n            Ditolak\n          </span>\n        );\n      default:\n        return (\n          <span className={`${baseClasses} bg-gray-100 text-gray-800`}>\n            {status}\n          </span>\n        );\n    }\n  };\n\n  const handleFileView = (url: string, title: string) => {\n    setSelectedDocument({ url: fileUrlHelper.convertLegacyUrl(url), title });\n    setIsDocumentModalOpen(true);\n  };\n\n  const handleDownloadPdf = () => {\n    setIsPdfModalOpen(true);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between border-b border-gray-200 p-6 flex-shrink-0\">\n            <div className=\"flex items-center space-x-3\">\n\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900\">Detail Pengajuan SIMLOK</h2>\n                <p className=\"text-sm text-gray-500 mt-1\">\n                  Dibuat pada {formatDate(submission.created_at)}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              {getStatusBadge(submission.approval_status)}\n              <button\n                onClick={onClose}\n                className=\"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            <div className=\"space-y-8\">\n              {/* Debug Section - Development Only */}\n              {process.env.NODE_ENV === 'development' && (\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                  <button\n                    onClick={() => setShowDebug(!showDebug)}\n                    className=\"text-sm font-medium text-yellow-800 hover:text-yellow-900\"\n                  >\n                    {showDebug ? 'Hide' : 'Show'} Debug Info\n                  </button>\n                  {showDebug && (\n                    <div className=\"mt-3\">\n                      <h4 className=\"font-bold mb-2\">Debug Info:</h4>\n                      <pre className=\"text-xs bg-yellow-50 p-3 rounded border overflow-auto max-h-40\">\n                        {JSON.stringify({\n                          id: submission.id,\n                          vendor_name: submission.vendor_name,\n                          officer_name: submission.officer_name,\n                          user: submission.user,\n                          based_on: submission.based_on,\n                          job_description: submission.job_description,\n                          work_location: submission.work_location,\n                          implementation: submission.implementation,\n                          working_hours: submission.working_hours,\n                          work_facilities: submission.work_facilities,\n                          other_notes: submission.other_notes,\n                          content: submission.content\n                        }, null, 2)}\n                      </pre>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Informasi Vendor */}\n              <DetailSection \n                title=\"Informasi Vendor\" \n                icon={<BuildingOfficeIcon className=\"h-5 w-5 text-blue-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Nama Vendor\"\n                    value={submission.vendor_name || '-'}\n                  />\n                  <InfoCard\n                    label=\"Nama Petugas\"\n                    value={submission.officer_name || '-'}\n                    icon={<UserIcon className=\"h-4 w-4 text-gray-500\" />}\n                  />\n                  <InfoCard\n                    label=\"Email\"\n                    value={submission.user?.email || '-'}\n                  />\n                  <InfoCard\n                    label=\"Berdasarkan\"\n                    value={submission.based_on || '-'}\n                  />\n                </div>\n              </DetailSection>\n\n                {/* Informasi Dokumen */}\n              <DetailSection \n                title=\"Informasi Dokumen\" \n                icon={<DocumentIcon className=\"h-5 w-5 text-orange-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {submission.simja_number && (\n                    <InfoCard\n                      label=\"Nomor SIMJA\"\n                      value={submission.simja_number}\n                    />\n                  )}\n                  {submission.simja_date && (\n                    <InfoCard\n                      label=\"Tanggal SIMJA\"\n                      value={formatDate(submission.simja_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                  {submission.sika_number && (\n                    <InfoCard\n                      label=\"Nomor SIKA\"\n                      value={submission.sika_number}\n                    />\n                  )}\n                  {submission.sika_date && (\n                    <InfoCard\n                      label=\"Tanggal SIKA\"\n                      value={formatDate(submission.sika_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                  {submission.approval_status === 'APPROVED' && submission.simlok_number && (\n                    <InfoCard\n                      label=\"Nomor SIMLOK\"\n                      value={submission.simlok_number}\n                    />\n                  )}\n                  {submission.approval_status === 'APPROVED' && submission.simlok_date && (\n                    <InfoCard\n                      label=\"Tanggal SIMLOK\"\n                      value={formatDate(submission.simlok_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                </div>\n              </DetailSection>\n\n              {/* Informasi Pekerjaan */}\n              <DetailSection \n                title=\"Informasi Pekerjaan\" \n                icon={<BriefcaseIcon className=\"h-5 w-5 text-green-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Pekerjaan\"\n                    value={submission.job_description || '-'}\n                  />\n                  <InfoCard\n                    label=\"Lokasi Kerja\"\n                    value={submission.work_location || '-'}\n                  />\n                  <InfoCard\n                    label=\"Pelaksanaan\"\n                    value={submission.implementation || 'Akan diisi oleh admin saat approval'}\n                  />\n                  <InfoCard\n                    label=\"Jam Kerja\"\n                    value={submission.working_hours || '-'}\n                  />\n                  <InfoCard\n                    label=\"Sarana Kerja\"\n                    value={submission.work_facilities || '-'}\n                    className=\"md:col-span-2\"\n                  />\n                </div>\n\n                {/* {submission.other_notes && (\n                  <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                    <InfoCard\n                      label=\"Lain-lain\"\n                      value={\n                        <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                          {submission.other_notes}\n                        </div>\n                      }\n                    />\n                  </div>\n                )} */}\n              </DetailSection>\n\n              {/* Daftar Pekerja */}\n              <DetailSection \n                title=\"Daftar Pekerja\" \n                icon={<UserIcon className=\"h-5 w-5 text-purple-500\" />}\n              >\n                {submission.worker_names ? (\n                  <WorkersList\n                    submissionId={submission.id}\n                    fallbackWorkers={submission.worker_names}\n                    layout=\"grid\"\n                    showPhotos={true}\n                    maxDisplayCount={6}\n                  />\n                ) : (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p>Belum ada data pekerja</p>\n                  </div>\n                )}\n              </DetailSection>\n\n              {/* Upload Dokumen */}\n              <DetailSection \n                title=\"Dokumen Upload\" \n                icon={<DocumentIcon className=\"h-5 w-5 text-red-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {submission.sika_document_upload && (\n                    <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                      <div className=\"flex items-center space-x-3\">\n                        <DocumentIcon className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Dokumen SIKA</p>\n                          <p className=\"text-sm text-gray-500\">File tersedia</p>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}\n                        className=\"flex items-center space-x-2\"\n                      >\n                        <EyeIcon className=\"w-4 h-4\" />\n                        <span>Lihat</span>\n                      </Button>\n                    </div>\n                  )}\n                  \n                  {submission.simja_document_upload && (\n                    <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                      <div className=\"flex items-center space-x-3\">\n                        <DocumentIcon className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Dokumen SIMJA</p>\n                          <p className=\"text-sm text-gray-500\">File tersedia</p>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}\n                        className=\"flex items-center space-x-2\"\n                      >\n                        <EyeIcon className=\"w-4 h-4\" />\n                        <span>Lihat</span>\n                      </Button>\n                    </div>\n                  )}\n                  \n                  {!submission.sika_document_upload && !submission.simja_document_upload && (\n                    <div className=\"col-span-2 text-center py-8 text-gray-500\">\n                      <DocumentIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <p>Belum ada dokumen yang diupload</p>\n                    </div>\n                  )}\n                </div>\n              </DetailSection>\n\n              {/* Informasi Penanda Tangan */}\n              {/* {(submission.signer_position || submission.signer_name) && (\n                <DetailSection \n                  title=\"Informasi Penanda Tangan\" \n                  icon={<UserIcon className=\"h-5 w-5 text-indigo-500\" />}\n                >\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <InfoCard\n                      label=\"Jabatan Penanda Tangan\"\n                      value={submission.signer_position || '-'}\n                    />\n                    <InfoCard\n                      label=\"Nama Penanda Tangan\"\n                      value={submission.signer_name || '-'}\n                    />\n                  </div>\n                </DetailSection>\n              )} */}\n\n              {/* Status & Approval */}\n              <DetailSection \n                title=\"Status Pengajuan\" \n                icon={\n                  submission.approval_status === 'APPROVED' ? (\n                    <CheckCircleIcon className=\"h-5 w-5 text-green-500\" />\n                  ) : submission.approval_status === 'REJECTED' ? (\n                    <XCircleIcon className=\"h-5 w-5 text-red-500\" />\n                  ) : (\n                    <PendingIcon className=\"h-5 w-5 text-orange-500\" />\n                  )\n                }\n                \n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Status\"\n                    value={getStatusBadge(submission.approval_status)}\n                  />\n                  {submission.approvedByUser && (\n                    <InfoCard\n                      label=\"Disetujui oleh\"\n                      value={submission.approvedByUser.officer_name}\n                    />\n                  )}\n\n                  {submission.notes && (\n                    <InfoCard\n                      label=\"Keterangan\"\n                      value={\n                        <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                          {submission.notes}\n                        </div>\n                      }\n                    />\n                  )}\n\n                  {/* Review Notes from Reviewer - Show if exists */}\n                  {submission.review_note && (\n                    <div className=\"md:col-span-2 bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                      <div className=\"flex items-start\">\n                        <DocumentIcon className=\"h-5 w-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0\" />\n                        <div className=\"flex-1\">\n                          <h4 className=\"text-sm font-medium text-blue-800 mb-2\">Catatan Review</h4>\n                          <p className=\"text-sm text-blue-700 whitespace-pre-line\">\n                            {submission.review_note}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Final Notes for Vendor - Show if exists and submission is finalized */}\n                  {submission.final_note && (submission.approval_status === 'APPROVED' || submission.approval_status === 'REJECTED') && (\n                    <div className={`md:col-span-2 border rounded-lg p-4 ${\n                      submission.approval_status === 'APPROVED' \n                        ? 'bg-green-50 border-green-200' \n                        : 'bg-red-50 border-red-200'\n                    }`}>\n                      <div className=\"flex items-start\">\n                        <DocumentIcon className={`h-5 w-5 mr-3 mt-0.5 flex-shrink-0 ${\n                          submission.approval_status === 'APPROVED' \n                            ? 'text-green-500' \n                            : 'text-red-500'\n                        }`} />\n                        <div className=\"flex-1\">\n                          <h4 className={`text-sm font-medium mb-2 ${\n                            submission.approval_status === 'APPROVED' \n                              ? 'text-green-800' \n                              : 'text-red-800'\n                          }`}>\n                            Keterangan dari Reviewer\n                          </h4>\n                          <p className={`text-sm whitespace-pre-line ${\n                            submission.approval_status === 'APPROVED' \n                              ? 'text-green-700' \n                              : 'text-red-700'\n                          }`}>\n                            {submission.final_note}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Status-specific information */}\n                  {submission.approval_status === 'PENDING' && (\n                    <div className=\"md:col-span-2 bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <PendingIcon className=\"h-5 w-5 text-yellow-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-yellow-800\">Menunggu Review</h4>\n                          <p className=\"text-sm text-yellow-700 mt-1\">\n                            Pengajuan Anda sedang dalam proses review oleh admin.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.approval_status === 'APPROVED' && (\n                    <div className=\"md:col-span-2 bg-green-50 border border-green-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <CheckCircleIcon className=\"h-5 w-5 text-green-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-green-800\">Pengajuan Disetujui</h4>\n                          <p className=\"text-sm text-green-700 mt-1\">\n                            Selamat! Pengajuan SIMLOK Anda telah disetujui.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.approval_status === 'REJECTED' && (\n                    <div className=\"md:col-span-2 bg-red-50 border border-red-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <XCircleIcon className=\"h-5 w-5 text-red-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-red-800\">Pengajuan Ditolak</h4>\n                          <p className=\"text-sm text-red-700 mt-1\">\n                            Pengajuan SIMLOK Anda tidak dapat disetujui. Silakan hubungi admin untuk informasi lebih lanjut.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </DetailSection>\n            </div>\n\n            {/* Footer Actions */}\n            <div className=\"flex items-center justify-between border-t border-gray-200 pt-6 mt-8\">\n              <div className=\"flex items-center space-x-3 justify-between w-full\">\n                {submission.approval_status === 'APPROVED' && submission.simlok_number && (\n                  <Button\n                    variant=\"primary\"\n                    size=\"sm\"\n                    onClick={handleDownloadPdf}\n                  >\n                    <DocumentIcon className=\"w-4 h-4 mr-2\" />\n                    Lihat PDF\n                  </Button>\n                )}\n                \n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={onClose}\n                >\n                  Tutup\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={isDocumentModalOpen}\n        onClose={() => setIsDocumentModalOpen(false)}\n        fileUrl={selectedDocument?.url || ''}\n        fileName={selectedDocument?.title || ''}\n      />\n\n      {/* PDF Download Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submission?.id || ''}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n    </div>\n  );\n}\n"
            },
            {
              "type": "file",
              "name": "VendorSubmissionsContent.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport Link from 'next/link';\nimport { \n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  PlusIcon\n} from \"@heroicons/react/24/outline\";\nimport SubmissionDetailModal from './SubmissionDetailModal';\nimport Button from '../ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport ConfirmModal from '../ui/modal/ConfirmModal';\nimport { useSubmissionStore } from '@/store/useSubmissionStore';\nimport TableLoader from '../ui/TableLoader';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\n// Types already defined in the store\n\n// Custom hook untuk debounced value\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n\nexport default function VendorSubmissionsContent() {\n  const { showSuccess, showError } = useToast();\n  \n  // Use Zustand store for realtime submissions data\n  const { \n    submissions,\n    loading,\n    searchTerm,\n    sortField,\n    sortOrder,\n    currentPage,\n    totalPages,\n    allSubmissionsStats,\n    filteredTotal,\n    fetchVendorSubmissions,\n    fetchVendorStats,\n    setSearchTerm,\n    setSortField,\n    setSortOrder,\n    setCurrentPage\n  } = useSubmissionStore();\n  \n  // Initialize Socket.IO connection\n  useSocket();\n  \n  const [error] = useState(\"\");\n  \n  // Status filter (local state)\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [limit] = useState(10);\n\n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  \n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    isOpen: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n  }>({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: () => {}\n  });\n\n  // Ref untuk search input\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  // Debounced search term\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  // Fetch statistics once when component mounts\n  useEffect(() => {\n    fetchVendorStats();\n  }, [fetchVendorStats]);\n\n  // Fetch submissions when filters change\n  useEffect(() => {\n    const params = {\n      page: currentPage,\n      limit,\n      search: debouncedSearchTerm,\n      sortBy: sortField,\n      sortOrder,\n      ...(statusFilter && { status: statusFilter }),\n    };\n    \n    fetchVendorSubmissions(params);\n  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions]);\n\n  // Kembalikan fokus ke search input setelah data reload\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  // Reset ke halaman 1 saat search term berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, statusFilter]);\n\n  const handleSort = useCallback((field: string) => {\n    if (field === sortField) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortOrder(\"desc\");\n    }\n    setCurrentPage(1);\n  }, [sortField, sortOrder, setSortField, setSortOrder, setCurrentPage]);\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const handleStatusFilterChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\n    setStatusFilter(e.target.value);\n  }, []);\n\n  const handleDelete = useCallback((id: string) => {\n    setConfirmModal({\n      isOpen: true,\n      title: 'Konfirmasi Hapus',\n      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',\n      onConfirm: () => performDelete(id)\n    });\n  }, []);\n\n  const performDelete = useCallback(async (id: string) => {\n    try {\n      setConfirmModal(prev => ({ ...prev, isOpen: false }));\n      \n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal menghapus pengajuan');\n      }\n\n      // Refresh data setelah berhasil menghapus\n      const params = {\n        page: currentPage,\n        limit,\n        search: debouncedSearchTerm,\n        sortBy: sortField,\n        sortOrder,\n        ...(statusFilter && { status: statusFilter }),\n      };\n      \n      await fetchVendorSubmissions(params);\n      \n      showSuccess('Berhasil!', 'Pengajuan berhasil dihapus');\n    } catch (error: any) {\n      console.error('Error deleting submission:', error);\n      showError('Error!', error.message || 'Gagal menghapus pengajuan');\n    }\n  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions, showSuccess, showError]);\n\n  const handleViewDetail = useCallback((submission: Submission) => {\n    setSelectedSubmission(submission);\n    setIsModalOpen(true);\n  }, []);\n\n  const handleCloseModal = useCallback(() => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  }, []);\n\n  const paginationInfo = useMemo(() => ({\n    currentPage,\n    totalPages,\n    filteredTotal,\n    limit,\n    startItem: ((currentPage - 1) * limit) + 1,\n    endItem: Math.min(currentPage * limit, filteredTotal)\n  }), [currentPage, totalPages, filteredTotal, limit]);\n\n  const getSortIcon = useCallback((field: string) => {\n    if (sortField !== field) {\n      return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n    }\n    return sortOrder === \"asc\" \n      ? <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      : <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />;\n  }, [sortField, sortOrder]);\n\n  const formatDate = useCallback((dateString: string) => {\n    return new Date(dateString).toLocaleDateString(\"id-ID\", {\n      year: \"numeric\",\n      month: \"short\", \n      day: \"numeric\"\n    });\n  }, []);\n\n  const getStatusBadge = useCallback((status: string) => {\n    const statusConfig = {\n      'PENDING': { label: \"Menunggu\", className: \"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full\" },\n      'APPROVED': { label: \"Disetujui\", className: \"bg-green-100 text-green-700 px-2 py-0.5 rounded-full\" },\n      'REJECTED': { label: \"Ditolak\", className: \"bg-red-100 text-red-700 px-2 py-0.5 rounded-full\" }\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || { \n      label: status, \n      className: 'bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full' \n    };\n    \n    return (\n      <span className={`text-xs font-semibold ${config.className}`}>\n        {config.label}\n      </span>\n    );\n  }, []);\n\n  // Function to format nama_pekerja for table display\n  const formatNamaPekerjaPreview = useCallback((names: string, maxDisplay: number = 2): string => {\n    if (!names) return '';\n    const namesList = names\n      .split(/[\\n,]+/)\n      .map(name => name.trim())\n      .filter(name => name.length > 0);\n    \n    if (namesList.length <= maxDisplay) {\n      return namesList.join(', ');\n    }\n    \n    return `${namesList.slice(0, maxDisplay).join(', ')} +${namesList.length - maxDisplay} lainnya`;\n  }, []);\n\n\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-3 md:px-6 space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Total</h3>\n          <p className=\"text-2xl font-bold text-blue-600 mt-1\">{allSubmissionsStats?.total || 0}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Menunggu</h3>\n          <p className=\"text-2xl font-bold text-yellow-600 mt-1\">\n            {allSubmissionsStats?.pending || 0}\n          </p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n          <p className=\"text-2xl font-bold text-green-600 mt-1\">\n            {allSubmissionsStats?.approved || 0}\n          </p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n          <p className=\"text-2xl font-bold text-red-600 mt-1\">\n            {allSubmissionsStats?.rejected || 0}\n          </p>\n        </div>\n      </div>\n\n      {/* Header */}\n       <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Pengajuan Saya</h1>\n          {/* <p className=\"text-sm text-gray-500 mt-1\">Daftar Pengajuan SIMLOK ({paginationInfo.totalSubmissions || 0} pengajuan)</p> */}\n        </div>\n        \n        <Link href=\"/vendor/submissions/create\">\n          <Button \n            variant=\"primary\"\n            size=\"md\"\n            startIcon={<PlusIcon className=\"w-4 h-4\" />}\n            className=\"whitespace-nowrap\"\n          >\n            Buat Pengajuan Baru\n          </Button>\n        </Link>\n      </div>\n\n      {/* Toolbar - Search and Filters */}\n      <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n        <div className=\"relative w-full md:w-80\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari pekerjaan atau petugas…\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n          />\n        </div>\n        \n        <select\n          value={statusFilter}\n          onChange={handleStatusFilterChange}\n          className=\"w-44 px-3 py-2.5 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n        >\n          <option value=\"\">Semua</option>\n          <option value=\"APPROVED\">Disetujui</option>\n          <option value=\"REJECTED\">Ditolak</option>\n          <option value=\"PENDING\">Menunggu</option>\n        </select>\n      </div>\n      </div>\n\n      {/* Content */}\n      {error ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Gagal memuat data pengajuan</h3>\n          <p className=\"text-gray-500 mb-4\">Periksa koneksi atau coba ulang</p>\n          <button \n            onClick={() => {\n              const params = {\n                page: currentPage,\n                limit,\n                search: debouncedSearchTerm,\n                sortBy: sortField,\n                sortOrder,\n                ...(statusFilter && { status: statusFilter }),\n              };\n              fetchVendorSubmissions(params);\n            }}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors\"\n          >\n            Coba Lagi\n          </button>\n        </div>\n      ) : submissions.length === 0 && !loading ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2h16a2 2 0 002-2v-5m0 0V9a2 2 0 00-2-2H6a2 2 0 00-2 2v4\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada pengajuan</h3>\n          <p className=\"text-gray-500 mb-6\">Buat pengajuan baru untuk memulai</p>\n          <Link href=\"/vendor/submissions/create\">\n            <Button \n              variant=\"primary\"\n              size=\"md\"\n              startIcon={<PlusIcon className=\"w-4 h-4\" />}\n            >\n              Buat Pengajuan Baru\n            </Button>\n          </Link>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm\">\n          {loading ? (\n            <TableLoader rows={5} columns={5} showHeader={true} />\n          ) : (\n            <>\n              {/* Desktop Table View */}\n              <div className=\"hidden md:block\">\n                <table className=\"min-w-full table-fixed\">\n                  <colgroup>\n                    <col className=\"w-[28%]\" />\n                    <col className=\"w-[18%]\" />\n                    <col className=\"w-[22%]\" />\n                    <col className=\"w-[12%]\" />\n                    <col className=\"w-[10%]\" />\n                    <col className=\"w-[10%]\" />\n                  </colgroup>\n                  <thead>\n                    <tr className=\"bg-gray-50/50 border-b border-gray-200\">\n                      <th \n                        onClick={() => handleSort(\"job_description\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Pekerjaan & Petugas</span>\n                          {getSortIcon(\"job_description\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Sarana Kerja\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Lokasi & Waktu\n                      </th>\n                      <th \n                        onClick={() => handleSort(\"approval_status\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Status</span>\n                          {getSortIcon(\"approval_status\")}\n                        </div>\n                      </th>\n                      <th \n                        onClick={() => handleSort(\"created_at\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Tanggal</span>\n                          {getSortIcon(\"created_at\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Aksi\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {submissions.map((submission: any) => (\n                      <tr \n                        key={submission.id} \n                        className=\"hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                        onClick={() => handleViewDetail(submission)}\n                      >\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm font-medium text-gray-900 break-words leading-snug\">\n                            {submission.job_description}\n                          </div>\n                          <div className=\"text-xs text-gray-500 mt-1 font-medium\">{submission.officer_name}</div>\n                          {/* <div className=\"text-xs text-gray-500 mt-1\" title={submission.worker_names}>\n                            Pekerja: {formatNamaPekerjaPreview(submission.worker_names, 3)}\n                          </div> */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm text-gray-800 break-words leading-snug\">\n                            {submission.work_facilities}\n                          </div>\n                          {/* {submission.other_notes && (\n                            <div className=\"text-xs text-gray-600 mt-1 break-words leading-relaxed\">\n                              <span className=\"font-medium\">Catatan:</span> {submission.other_notes}\n                            </div>\n                          )} */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm text-gray-800 leading-snug\">\n                            <div className=\"font-medium break-words\">{submission.work_location}</div>\n                            {/* {submission.implementation && (\n                              <div className=\"text-xs text-gray-600 mt-1 break-words\">\n                                <span className=\"font-medium\">Pelaksanaan:</span> {submission.implementation}\n                              </div>\n                            )} */}\n                            {submission.working_hours && (\n                              <div className=\"text-xs text-gray-600 mt-1\">\n                                <span className=\"font-medium\">Jam:</span> {submission.working_hours}\n                              </div>\n                            )}\n                          </div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"space-y-1\">\n                            {getStatusBadge(submission.approval_status)}\n                          </div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-xs text-gray-500\">{formatDate(submission.created_at)}</div>\n\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"flex items-start gap-1\" onClick={(e) => e.stopPropagation()}>\n                            <Button\n                              onClick={() => handleViewDetail(submission)}\n                              variant=\"info\"\n                              size=\"sm\"\n                              title=\"Lihat detail submission\"\n                              className=\"text-xs \"\n                            >\n                              Lihat\n                            </Button>\n                            {submission.approval_status === 'PENDING' && (\n                              <>\n                                {/* <Link href={`/vendor/submissions/edit/${submission.id}`} className=\"w-full\">\n                                  <Button\n                                    variant=\"warning\"\n                                    size=\"sm\"\n                                    title=\"Edit submission\"\n                                    className=\"text-xs w-full\"\n                                  >\n                                    Edit\n                                  </Button>\n                                </Link> */}\n                                <Button \n                                  onClick={() => handleDelete(submission.id)} \n                                  variant=\"destructive\" \n                                  size=\"sm\"\n                                  title=\"Hapus submission ini\"\n                                  className=\"text-xs w-full\"\n                                >\n                                  Hapus\n                                </Button>\n                              </>\n                            )}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Mobile Card View */}\n              <div className=\"md:hidden divide-y divide-gray-200\">\n                {submissions.map((submission: any) => (\n                  <div \n                    key={submission.id}\n                    className=\"p-4 hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                    onClick={() => handleViewDetail(submission)}\n                  >\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-medium text-gray-900 break-words leading-snug\">{submission.job_description}</h3>\n                        <p className=\"text-sm text-gray-500 font-medium\">{submission.officer_name}</p>\n                      </div>\n                      {getStatusBadge(submission.approval_status)}\n                    </div>\n                    \n                    <div className=\"space-y-3\">\n                      <div>\n                        <p className=\"text-xs text-gray-500 mb-1\">\n                          <span className=\"font-medium\">Pekerja:</span> {formatNamaPekerjaPreview(submission.worker_names, 3)}\n                        </p>\n                        <p className=\"text-sm text-gray-800 break-words leading-snug\">\n                          <span className=\"font-medium\">Sarana:</span> {submission.work_facilities}\n                        </p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-sm text-gray-800 break-words leading-snug\">\n                          <span className=\"font-medium\">Lokasi:</span> {submission.work_location}\n                        </p>\n                        {submission.implementation && (\n                          <p className=\"text-xs text-gray-600 mt-1 break-words\">\n                            <span className=\"font-medium\">Pelaksanaan:</span> {submission.implementation}\n                          </p>\n                        )}\n                        {submission.working_hours && (\n                          <p className=\"text-xs text-gray-600 mt-1\">\n                            <span className=\"font-medium\">Jam Kerja:</span> {submission.working_hours}\n                          </p>\n                        )}\n                      </div>\n\n                      {(submission.other_notes || submission.notes) && (\n                        <div className=\"bg-gray-50 rounded-lg p-2\">\n                          {submission.other_notes && (\n                            <p className=\"text-xs text-gray-600 break-words leading-relaxed\">\n                              <span className=\"font-medium\">Catatan Lain:</span> {submission.other_notes}\n                            </p>\n                          )}\n                          {submission.notes && (\n                            <p className=\"text-xs text-gray-600 break-words leading-relaxed mt-1\">\n                              <span className=\"font-medium\">Catatan Admin:</span> {submission.notes}\n                            </p>\n                          )}\n                        </div>\n                      )}\n                      \n                      <div className=\"flex justify-between items-center text-xs text-gray-500\">\n                        <span>{formatDate(submission.created_at)}</span>\n                        <div className=\"text-right\">\n                          {submission.simlok_number && (\n                            <div>SIMLOK: {submission.simlok_number}</div>\n                          )}\n                          {submission.sika_number && (\n                            <div>SIKA: {submission.sika_number}</div>\n                          )}\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex items-center space-x-2 pt-2\" onClick={(e) => e.stopPropagation()}>\n                        <Button\n                          onClick={() => handleViewDetail(submission)}\n                          variant=\"info\"\n                          size=\"sm\"\n                          className=\"text-xs flex-1\"\n                        >\n                          Lihat Detail\n                        </Button>\n                        {submission.approval_status === 'PENDING' && (\n                          <>\n                            <Link href={`/vendor/submissions/edit/${submission.id}`}>\n                              <Button\n                                variant=\"warning\"\n                                size=\"sm\"\n                                className=\"text-xs\"\n                              >\n                                Edit\n                              </Button>\n                            </Link>\n                            <Button \n                              onClick={() => handleDelete(submission.id)} \n                              variant=\"destructive\" \n                              size=\"sm\"\n                              className=\"text-xs\"\n                            >\n                              Hapus\n                            </Button>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n\n          {/* Footer with Pagination */}\n          {totalPages > 1 && !loading && (\n            <div className=\"flex items-center justify-between text-sm text-gray-500 p-3 border-t\">\n              <span>{paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.filteredTotal}</span>\n              \n              <div className=\"flex items-center space-x-1\">\n                <button\n                  onClick={() => setCurrentPage((prev: number) => Math.max(prev - 1, 1))}\n                  disabled={currentPage === 1}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  ←\n                </button>\n                \n                {[...Array(totalPages)].map((_, index) => {\n                  const page = index + 1;\n                  if (\n                    page === 1 ||\n                    page === totalPages ||\n                    (page >= currentPage - 1 && page <= currentPage + 1)\n                  ) {\n                    return (\n                      <button\n                        key={page}\n                        onClick={() => setCurrentPage(page)}\n                        className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                          currentPage === page\n                            ? \"bg-blue-600 text-white\"\n                            : \"border border-gray-300 text-gray-700 bg-white hover:bg-gray-50\"\n                        }`}\n                      >\n                        {page}\n                      </button>\n                    );\n                  } else if (\n                    page === currentPage - 2 ||\n                    page === currentPage + 2\n                  ) {\n                    return <span key={page} className=\"text-gray-400 px-1\">…</span>;\n                  }\n                  return null;\n                })}\n                \n                <button\n                  onClick={() => setCurrentPage((prev: number) => Math.min(prev + 1, totalPages))}\n                  disabled={currentPage === totalPages}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  →\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Modal Detail */}\n      <SubmissionDetailModal\n        submission={selectedSubmission}\n        isOpen={isModalOpen}\n        onClose={handleCloseModal}\n      />\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.isOpen}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        onConfirm={confirmModal.onConfirm}\n        onClose={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))}\n        variant=\"danger\"\n      />\n    </div>\n  );\n}\n"
            }
          ]
        },
        {
          "type": "directory",
          "name": "verifier",
          "children": [
            {
              "type": "file",
              "name": "VerifierDashboard.tsx",
              "content": "'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { \n  EyeIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon,\n  QrCodeIcon,\n  MapPinIcon,\n  BuildingOfficeIcon,\n  UserIcon,\n  ArrowRightIcon,\n  DocumentTextIcon,\n  UsersIcon,\n  BriefcaseIcon,\n  CalendarDaysIcon,\n  XMarkIcon,\n  DocumentCheckIcon,\n  CameraIcon\n} from '@heroicons/react/24/outline';\nimport { format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport { useToast } from '@/hooks/useToast';\nimport Button from '../ui/button/Button';\nimport LoadingSpinner from '../ui/LoadingSpinner';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\n\ninterface SubmissionData {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string;\n  approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';\n  simlok_number?: string;\n  simlok_date?: string;\n  created_at: string;\n  working_hours?: string;\n  worker_count?: number;\n  implementation_start_date?: string;\n  implementation_end_date?: string;\n  simja_number?: string;\n  sika_number?: string;\n}\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name: string;\n  scan_location?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number?: string;\n    vendor_name: string;\n    officer_name: string;\n    job_description: string;\n    work_location: string;\n    approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';\n    working_hours?: string;\n    implementation?: string;\n    simja_number?: string;\n    sika_number?: string;\n    worker_count?: number;\n    implementation_start_date?: string;\n    implementation_end_date?: string;\n    created_at?: string;\n  };\n}\n\nexport default function VerifierDashboard() {\n  const { showError } = useToast();\n  \n  const [recentScans, setRecentScans] = useState<QrScan[]>([]);\n  const [stats, setStats] = useState({\n    totalScans: 0,\n    todayScans: 0,\n    totalSubmissions: 0,\n    approvedSubmissions: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [selectedSubmission, setSelectedSubmission] = useState<SubmissionData | null>(null);\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, []);\n\n  const fetchDashboardData = async () => {\n    setLoading(true);\n    try {\n      // Fetch stats, recent submissions, and recent scans in parallel\n      const [submissionsRes, scansRes, statsRes] = await Promise.all([\n        fetch('/api/verifier/submissions?limit=5&offset=0&status=ALL&dateRange=ALL&search='),\n        fetch('/api/qr/verify?limit=5&offset=0&search='),\n        fetch('/api/verifier/stats')\n      ]);\n\n      if (submissionsRes.ok) {\n        await submissionsRes.json();\n        // Data submissions tersimpan tapi tidak ditampilkan di dashboard\n      }\n\n      if (scansRes.ok) {\n        const scanData = await scansRes.json();\n        setRecentScans(scanData.scans || []);\n      }\n\n      if (statsRes.ok) {\n        const statsData = await statsRes.json();\n        setStats(statsData);\n      }\n    } catch (error) {\n      console.error('Error fetching dashboard data:', error);\n      showError('Error', 'Gagal memuat data dashboard');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n            <ClockIcon className=\"w-3 h-3 mr-1\" />\n            Pending\n          </span>\n        );\n      case 'APPROVED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n            <CheckCircleIcon className=\"w-3 h-3 mr-1\" />\n            Approved\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n            <XCircleIcon className=\"w-3 h-3 mr-1\" />\n            Rejected\n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total Scan QR</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.totalScans}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <QrCodeIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Scan Hari Ini</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.todayScans}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CalendarDaysIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total Submission</h3>\n              <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats.totalSubmissions}</p>\n            </div>\n            <div className=\"p-3 bg-purple-100 rounded-full\">\n              <DocumentTextIcon className=\"w-6 h-6 text-purple-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats.approvedSubmissions}</p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <DocumentCheckIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Quick Scan Actions */}\n      <div className=\"bg-white shadow rounded-lg p-6\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n            Barcode & QR Code Scanner\n          </h2>\n          <p className=\"text-gray-600 mb-6\">\n            Scan barcode atau QR code SIMLOK untuk verifikasi. Scanner mendukung berbagai format: QR Code, Code 128, Code 39, EAN, UPC. Pastikan browser mengizinkan akses kamera.\n          </p>\n          \n          <div className=\"flex justify-center\">\n            <Button\n              onClick={() => {\n                console.log('Opening barcode scanner from verifier dashboard');\n                // Close any open detail modals from scan history\n                if (scanHistoryRef.current?.closeDetailModal) {\n                  scanHistoryRef.current.closeDetailModal();\n                }\n                setScannerOpen(true);\n              }}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              size=\"lg\"\n            >\n              <CameraIcon className=\"w-6 h-6 mr-2\" />\n              Mulai Scan Barcode/QR Code\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Scans */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-lg font-medium text-gray-900\">Scan QR Terbaru</h3>\n              <p className=\"text-sm text-gray-500\">5 scan terakhir yang telah dilakukan</p>\n            </div>\n            <Button\n              onClick={() => window.location.href = '/verifier/history'}\n              variant=\"outline\"\n              size=\"sm\"\n            >\n              Lihat Semua\n              <ArrowRightIcon className=\"w-4 h-4 ml-2\" />\n            </Button>\n          </div>\n        </div>\n        \n        {recentScans.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <QrCodeIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n              Belum ada scan\n            </h3>\n            <p className=\"mt-1 text-sm text-gray-500\">\n              Belum ada QR code yang di-scan hari ini.\n            </p>\n          </div>\n        ) : (\n          <div className=\"divide-y divide-gray-200\">\n            {recentScans.map((scan) => (\n              <div key={scan.id} className=\"p-4 hover:bg-gray-50 transition-colors\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"p-2 bg-blue-100 rounded-lg\">\n                        <QrCodeIcon className=\"w-5 h-5 text-blue-600\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-2\">\n                          <p className=\"text-sm font-medium text-gray-900\">\n                            {scan.submission.simlok_number || 'Belum ada nomor'}\n                          </p>\n                          {getStatusBadge(scan.submission.approval_status)}\n                        </div>\n                        <p className=\"text-xs text-gray-500 mt-1\">\n                          {scan.submission.vendor_name} • {scan.submission.officer_name}\n                        </p>\n                        <div className=\"flex items-center space-x-4 text-xs text-gray-500 mt-1\">\n                          <span className=\"flex items-center\">\n                            <CalendarDaysIcon className=\"w-3 h-3 mr-1\" />\n                            {format(new Date(scan.scanned_at), 'dd MMM yyyy HH:mm', { locale: id })}\n                          </span>\n                          {scan.scan_location && (\n                            <span className=\"flex items-center\">\n                              <MapPinIcon className=\"w-3 h-3 mr-1\" />\n                              {scan.scan_location}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <Button\n                    onClick={() => setSelectedScan(scan)}\n                    variant=\"outline\"\n                    size=\"sm\"\n                  >\n                    <EyeIcon className=\"w-4 h-4 mr-1\" />\n                    Detail\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n      \n      {/* Enhanced Scan Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200\">\n          <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300\">\n            {/* Modal Header */}\n            <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-white/20 rounded-lg\">\n                    <QrCodeIcon className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-xl font-bold\">Detail Scan QR Code</h3>\n                    <p className=\"text-blue-100 text-sm\">\n                      {selectedScan.submission.simlok_number || 'Informasi Pengajuan'}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                >\n                  <XMarkIcon className=\"w-6 h-6 text-white\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-100px)]\">\n              {/* Status Banner */}\n              <div className=\"mb-6\">\n                {selectedScan.submission.approval_status === 'PENDING' && (\n                  <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <ClockIcon className=\"w-5 h-5 text-yellow-600 mr-2\" />\n                      <span className=\"font-semibold text-yellow-800\">Status: Menunggu Persetujuan</span>\n                    </div>\n                  </div>\n                )}\n                {selectedScan.submission.approval_status === 'APPROVED' && (\n                  <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <CheckCircleIcon className=\"w-5 h-5 text-green-600 mr-2\" />\n                      <span className=\"font-semibold text-green-800\">Status: Telah Disetujui</span>\n                    </div>\n                  </div>\n                )}\n                {selectedScan.submission.approval_status === 'REJECTED' && (\n                  <div className=\"bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <XCircleIcon className=\"w-5 h-5 text-red-600 mr-2\" />\n                      <span className=\"font-semibold text-red-800\">Status: Ditolak</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Main Content Grid */}\n              <div className=\"space-y-6\">\n                {/* Submission Information */}\n                <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200\">\n                  <div className=\"flex items-center mb-6\">\n                    <div className=\"p-3 bg-blue-100 rounded-xl mr-4\">\n                      <DocumentTextIcon className=\"w-6 h-6 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"text-xl font-bold text-gray-800\">Informasi Pengajuan</h4>\n                      <p className=\"text-sm text-gray-500\">Detail lengkap pengajuan SIMLOK</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                    {/* Left Column */}\n                    <div className=\"space-y-4\">\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <QrCodeIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Nomor SIMLOK</span>\n                        </div>\n                        <p className=\"text-lg font-bold text-gray-900\">\n                          {selectedScan.submission.simlok_number || 'Belum ada nomor'}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <BuildingOfficeIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Perusahaan</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.submission.vendor_name}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <UserIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Petugas PIC</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.submission.officer_name}\n                        </p>\n                      </div>\n\n                      {selectedScan.submission.worker_count && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <UsersIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Jumlah Pekerja</span>\n                          </div>\n                          <p className=\"text-lg font-bold text-gray-900\">\n                            {selectedScan.submission.worker_count} orang\n                          </p>\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Right Column */}\n                    <div className=\"space-y-4\">\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <BriefcaseIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Deskripsi Pekerjaan</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700 leading-relaxed\">\n                          {selectedScan.submission.job_description}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <MapPinIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Lokasi Kerja</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700 leading-relaxed\">\n                          {selectedScan.submission.work_location}\n                        </p>\n                      </div>\n\n                      {selectedScan.submission.working_hours && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <ClockIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Jam Kerja</span>\n                          </div>\n                          <p className=\"text-sm text-gray-700\">\n                            {selectedScan.submission.working_hours}\n                          </p>\n                        </div>\n                      )}\n\n                      {(selectedScan.submission.implementation_start_date || selectedScan.submission.implementation_end_date) && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <CalendarDaysIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Periode Pelaksanaan</span>\n                          </div>\n                          <p className=\"text-sm text-gray-700\">\n                            {selectedScan.submission.implementation_start_date && \n                              format(new Date(selectedScan.submission.implementation_start_date), 'dd MMM yyyy', { locale: id })}\n                            {selectedScan.submission.implementation_start_date && selectedScan.submission.implementation_end_date && ' - '}\n                            {selectedScan.submission.implementation_end_date && \n                              format(new Date(selectedScan.submission.implementation_end_date), 'dd MMM yyyy', { locale: id })}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Document Numbers */}\n                  {(selectedScan.submission.simja_number || selectedScan.submission.sika_number) && (\n                    <div className=\"mt-6 pt-4 border-t border-gray-200\">\n                      <h5 className=\"text-sm font-semibold text-gray-700 mb-3\">Nomor Dokumen Pendukung</h5>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        {selectedScan.submission.simja_number && (\n                          <div className=\"bg-blue-50 rounded-lg p-3 border border-blue-200\">\n                            <span className=\"text-xs font-medium text-blue-600\">SIMJA</span>\n                            <p className=\"text-sm font-semibold text-blue-900 mt-1\">\n                              {selectedScan.submission.simja_number}\n                            </p>\n                          </div>\n                        )}\n                        {selectedScan.submission.sika_number && (\n                          <div className=\"bg-green-50 rounded-lg p-3 border border-green-200\">\n                            <span className=\"text-xs font-medium text-green-600\">SIKA</span>\n                            <p className=\"text-sm font-semibold text-green-900 mt-1\">\n                              {selectedScan.submission.sika_number}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Scan Information */}\n                <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200\">\n                  <div className=\"flex items-center mb-6\">\n                    <div className=\"p-3 bg-blue-100 rounded-xl mr-4\">\n                      <QrCodeIcon className=\"w-6 h-6 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"text-xl font-bold text-gray-800\">Detail Scan QR Code</h4>\n                      <p className=\"text-sm text-gray-500\">Informasi verifikasi dan validasi</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <CalendarDaysIcon className=\"w-4 h-4 text-blue-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Tanggal Scan</span>\n                      </div>\n                      <p className=\"text-lg font-bold text-gray-900\">\n                        {format(new Date(selectedScan.scanned_at), 'dd MMMM yyyy', { locale: id })}\n                      </p>\n                      <p className=\"text-sm text-gray-600\">\n                        {format(new Date(selectedScan.scanned_at), \"HH:mm:ss 'WIB'\", { locale: id })}\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <MapPinIcon className=\"w-4 h-4 text-blue-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Lokasi Scan</span>\n                      </div>\n                      <p className=\"text-sm font-semibold text-gray-900\">\n                        {selectedScan.scan_location || 'Lokasi tidak diketahui'}\n                      </p>\n                    </div>\n\n                    {selectedScan.scanner_name && (\n                      <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <UserIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Scanner</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.scanner_name}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* <div className=\"mt-4 bg-white rounded-lg p-4 border border-blue-200\">\n                    <div className=\"flex items-center space-x-2 mb-2\">\n                      <CheckCircleIcon className=\"w-4 h-4 text-blue-600\" />\n                      <span className=\"text-sm font-medium text-gray-600\">ID Scan</span>\n                    </div>\n                    <p className=\"text-xs font-mono text-gray-600 bg-gray-100 px-3 py-2 rounded-lg\">\n                      {selectedScan.id}\n                    </p>\n                  </div> */}\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200\">\n                <Button\n                  variant=\"secondary\"\n                  onClick={() => setSelectedScan(null)}\n                  className=\"px-6\"\n                >\n                  Tutup\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Enhanced Submission Detail Modal */}\n      {selectedSubmission && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200\">\n          <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300\">\n            {/* Modal Header */}\n            <div className=\"bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-white/20 rounded-lg\">\n                    <DocumentTextIcon className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-xl font-bold\">Detail Submission</h3>\n                    <p className=\"text-purple-100 text-sm\">\n                      {selectedSubmission.simlok_number || 'Informasi Pengajuan'}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setSelectedSubmission(null)}\n                  className=\"p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                >\n                  <XMarkIcon className=\"w-6 h-6 text-white\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-100px)]\">\n              {/* Status Banner */}\n              <div className=\"mb-6\">\n                {selectedSubmission.approval_status === 'PENDING' && (\n                  <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <ClockIcon className=\"w-5 h-5 text-yellow-600 mr-2\" />\n                      <span className=\"font-semibold text-yellow-800\">Status: Menunggu Persetujuan</span>\n                    </div>\n                  </div>\n                )}\n                {selectedSubmission.approval_status === 'APPROVED' && (\n                  <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <CheckCircleIcon className=\"w-5 h-5 text-green-600 mr-2\" />\n                      <span className=\"font-semibold text-green-800\">Status: Telah Disetujui</span>\n                    </div>\n                  </div>\n                )}\n                {selectedSubmission.approval_status === 'REJECTED' && (\n                  <div className=\"bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <XCircleIcon className=\"w-5 h-5 text-red-600 mr-2\" />\n                      <span className=\"font-semibold text-red-800\">Status: Ditolak</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Submission Information */}\n              <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200\">\n                <div className=\"flex items-center mb-6\">\n                  <div className=\"p-3 bg-purple-100 rounded-xl mr-4\">\n                    <DocumentTextIcon className=\"w-6 h-6 text-purple-600\" />\n                  </div>\n                  <div>\n                    <h4 className=\"text-xl font-bold text-gray-800\">Informasi Pengajuan SIMLOK</h4>\n                    <p className=\"text-sm text-gray-500\">Detail lengkap pengajuan submission</p>\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                  {/* Left Column */}\n                  <div className=\"space-y-4\">\n                    <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <QrCodeIcon className=\"w-4 h-4 text-purple-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Nomor SIMLOK</span>\n                      </div>\n                      <p className=\"text-lg font-bold text-gray-900\">\n                        {selectedSubmission.simlok_number || 'Belum ada nomor'}\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <BuildingOfficeIcon className=\"w-4 h-4 text-purple-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Perusahaan</span>\n                      </div>\n                      <p className=\"text-sm font-semibold text-gray-900\">\n                        {selectedSubmission.vendor_name}\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <UserIcon className=\"w-4 h-4 text-purple-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Petugas PIC</span>\n                      </div>\n                      <p className=\"text-sm font-semibold text-gray-900\">\n                        {selectedSubmission.officer_name}\n                      </p>\n                    </div>\n\n                    {selectedSubmission.worker_count && (\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <UsersIcon className=\"w-4 h-4 text-purple-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Jumlah Pekerja</span>\n                        </div>\n                        <p className=\"text-lg font-bold text-gray-900\">\n                          {selectedSubmission.worker_count} orang\n                        </p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Right Column */}\n                  <div className=\"space-y-4\">\n                    <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <BriefcaseIcon className=\"w-4 h-4 text-purple-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Deskripsi Pekerjaan</span>\n                      </div>\n                      <p className=\"text-sm text-gray-700 leading-relaxed\">\n                        {selectedSubmission.job_description}\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <MapPinIcon className=\"w-4 h-4 text-purple-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Lokasi Kerja</span>\n                      </div>\n                      <p className=\"text-sm text-gray-700 leading-relaxed\">\n                        {selectedSubmission.work_location}\n                      </p>\n                    </div>\n\n                    {selectedSubmission.working_hours && (\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <ClockIcon className=\"w-4 h-4 text-purple-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Jam Kerja</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700\">\n                          {selectedSubmission.working_hours}\n                        </p>\n                      </div>\n                    )}\n\n                    {(selectedSubmission.implementation_start_date || selectedSubmission.implementation_end_date) && (\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <CalendarDaysIcon className=\"w-4 h-4 text-purple-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Periode Pelaksanaan</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700\">\n                          {selectedSubmission.implementation_start_date && \n                            format(new Date(selectedSubmission.implementation_start_date), 'dd MMM yyyy', { locale: id })}\n                          {selectedSubmission.implementation_start_date && selectedSubmission.implementation_end_date && ' - '}\n                          {selectedSubmission.implementation_end_date && \n                            format(new Date(selectedSubmission.implementation_end_date), 'dd MMM yyyy', { locale: id })}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Document Numbers */}\n                {(selectedSubmission.simja_number || selectedSubmission.sika_number) && (\n                  <div className=\"mt-6 pt-4 border-t border-gray-200\">\n                    <h5 className=\"text-sm font-semibold text-gray-700 mb-3\">Nomor Dokumen Pendukung</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      {selectedSubmission.simja_number && (\n                        <div className=\"bg-blue-50 rounded-lg p-3 border border-blue-200\">\n                          <span className=\"text-xs font-medium text-blue-600\">SIMJA</span>\n                          <p className=\"text-sm font-semibold text-blue-900 mt-1\">\n                            {selectedSubmission.simja_number}\n                          </p>\n                        </div>\n                      )}\n                      {selectedSubmission.sika_number && (\n                        <div className=\"bg-green-50 rounded-lg p-3 border border-green-200\">\n                          <span className=\"text-xs font-medium text-green-600\">SIKA</span>\n                          <p className=\"text-sm font-semibold text-green-900 mt-1\">\n                            {selectedSubmission.sika_number}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200\">\n                <Button\n                  variant=\"secondary\"\n                  onClick={() => setSelectedSubmission(null)}\n                  className=\"px-6\"\n                >\n                  Tutup\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Barcode & QR Code Scanner Modal */}\n      <CameraQRScanner\n        isOpen={scannerOpen}\n        onClose={() => {\n          console.log('Closing barcode scanner from verifier dashboard');\n          setScannerOpen(false);\n        }}\n        onScan={(result: string) => {\n          console.log('Barcode/QR Scanned in verifier:', result);\n          // Scanner will handle the verification automatically\n          // Just close the scanner after successful scan\n          setScannerOpen(false);\n        }}\n        title=\"Scan Barcode/QR Code SIMLOK\"\n        description=\"Arahkan kamera ke barcode atau QR code SIMLOK untuk memverifikasi\"\n      />\n    </div>\n  );\n}"
            },
            {
              "type": "file",
              "name": "VerifierScanHistory.tsx",
              "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  CalendarDaysIcon,\n  EyeIcon,\n  MagnifyingGlassIcon,\n  QrCodeIcon,\n  ClockIcon,\n  MapPinIcon,\n  BuildingOfficeIcon,\n  UserIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  FunnelIcon,\n  XMarkIcon,\n  DocumentTextIcon,\n  UsersIcon,\n  BriefcaseIcon\n} from '@heroicons/react/24/outline';\nimport { format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport { useToast } from '@/hooks/useToast';\nimport Button from '../ui/button/Button';\nimport LoadingSpinner from '../ui/LoadingSpinner';\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name: string;\n  scan_location?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number?: string;\n    vendor_name: string;\n    officer_name: string;\n    job_description: string;\n    work_location: string;\n    approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';\n    working_hours?: string;\n    implementation?: string;\n    simja_number?: string;\n    sika_number?: string;\n    worker_count?: number;\n    implementation_start_date?: string;\n    implementation_end_date?: string;\n    created_at?: string;\n    review_status?: 'PENDING' | 'APPROVED' | 'REJECTED';\n    final_status?: 'PENDING' | 'APPROVED' | 'REJECTED';\n  };\n}\n\nexport default function VerifierScanHistory() {\n  const { showError } = useToast();\n  \n  const [scans, setScans] = useState<QrScan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [showFilters, setShowFilters] = useState(false);\n  const [filters, setFilters] = useState({\n    status: '',\n    dateFrom: '',\n    dateTo: '',\n    location: ''\n  });\n  const [pagination, setPagination] = useState({\n    total: 0,\n    limit: 20,\n    offset: 0,\n    hasMore: true\n  });\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n\n  useEffect(() => {\n    fetchScanHistory();\n  }, [pagination.offset, searchTerm, filters]);\n\n  const fetchScanHistory = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams({\n        limit: pagination.limit.toString(),\n        offset: pagination.offset.toString(),\n        search: searchTerm\n      });\n\n      // Add filters to params\n      if (filters.status) params.append('status', filters.status);\n      if (filters.dateFrom) params.append('dateFrom', filters.dateFrom);\n      if (filters.dateTo) params.append('dateTo', filters.dateTo);\n      if (filters.location) params.append('location', filters.location);\n\n      const response = await fetch(`/api/qr/verify?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        setScans(data.scans || []);\n        setPagination(prev => ({\n          ...prev,\n          total: data.pagination?.total || 0,\n          hasMore: data.pagination?.hasMore || false\n        }));\n      } else {\n        showError('Error', 'Gagal memuat riwayat scan');\n      }\n    } catch (error) {\n      console.error('Error fetching scan history:', error);\n      showError('Error', 'Gagal memuat riwayat scan');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSearch = (value: string) => {\n    setSearchTerm(value);\n    setPagination(prev => ({ ...prev, offset: 0 }));\n  };\n\n  const handleFilterChange = (key: string, value: string) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n    setPagination(prev => ({ ...prev, offset: 0 }));\n  };\n\n  const clearFilters = () => {\n    setFilters({\n      status: '',\n      dateFrom: '',\n      dateTo: '',\n      location: ''\n    });\n    setPagination(prev => ({ ...prev, offset: 0 }));\n  };\n\n  const hasActiveFilters = Object.values(filters).some(value => value !== '');\n\n  const loadMore = () => {\n    setPagination(prev => ({\n      ...prev,\n      offset: prev.offset + prev.limit\n    }));\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n            <ClockIcon className=\"w-3 h-3 mr-1\" />\n            Pending\n          </span>\n        );\n      case 'APPROVED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n            <CheckCircleIcon className=\"w-3 h-3 mr-1\" />\n            Approved\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n            <XCircleIcon className=\"w-3 h-3 mr-1\" />\n            Rejected\n          </span>\n        );\n      default:\n        return null;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const formatDateShort = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'short',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header Section */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Riwayat Scan QR</h1>\n          <p className=\"text-sm text-gray-600 mt-1\">\n            Daftar SIMLOK yang telah Anda scan\n          </p>\n        </div>\n        \n        <div className=\"flex items-center text-sm text-gray-500\">\n          <CalendarDaysIcon className=\"w-4 h-4 mr-2\" />\n          Total: {pagination.total} scan\n        </div>\n      </div>\n\n      {/* Search and Filter Section */}\n      <div className=\"bg-white shadow rounded-lg\">\n        <div className=\"p-4 space-y-4\">\n          {/* Search Bar */}\n          <div className=\"relative\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              value={searchTerm}\n              onChange={(e) => handleSearch(e.target.value)}\n              className=\"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              placeholder=\"Cari nomor SIMLOK, vendor, atau lokasi scan...\"\n            />\n          </div>\n\n          {/* Filter Toggle Button */}\n          <div className=\"flex items-center justify-between\">\n            <Button\n              onClick={() => setShowFilters(!showFilters)}\n              variant=\"outline\"\n              size=\"sm\"\n              className={showFilters ? 'bg-blue-50 text-blue-700 border-blue-200' : ''}\n            >\n              <FunnelIcon className=\"w-4 h-4 mr-2\" />\n              Filter\n              {hasActiveFilters && (\n                <span className=\"ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full\">\n                  {Object.values(filters).filter(v => v !== '').length}\n                </span>\n              )}\n            </Button>\n\n            {hasActiveFilters && (\n              <Button\n                onClick={clearFilters}\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"text-gray-500 hover:text-gray-700\"\n              >\n                <XMarkIcon className=\"w-4 h-4 mr-1\" />\n                Clear\n              </Button>\n            )}\n          </div>\n\n          {/* Filter Panel */}\n          {showFilters && (\n            <div className=\"border-t pt-4 space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                {/* Status Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Status\n                  </label>\n                  <select\n                    value={filters.status}\n                    onChange={(e) => handleFilterChange('status', e.target.value)}\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm\"\n                  >\n                    <option value=\"\">Semua Status</option>\n                    <option value=\"PENDING\">Pending</option>\n                    <option value=\"APPROVED\">Approved</option>\n                    <option value=\"REJECTED\">Rejected</option>\n                  </select>\n                </div>\n\n                {/* Date From Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Dari\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateFrom}\n                    onChange={(e) => handleFilterChange('dateFrom', e.target.value)}\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm\"\n                  />\n                </div>\n\n                {/* Date To Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Sampai\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateTo}\n                    onChange={(e) => handleFilterChange('dateTo', e.target.value)}\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm\"\n                  />\n                </div>\n\n                {/* Location Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Lokasi Scan\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.location}\n                    onChange={(e) => handleFilterChange('location', e.target.value)}\n                    placeholder=\"Lokasi scan...\"\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Scan History List */}\n      <div className=\"bg-white shadow rounded-lg\">\n        {loading && pagination.offset === 0 ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <LoadingSpinner size=\"lg\" />\n          </div>\n        ) : scans.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <QrCodeIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n              Belum ada riwayat scan\n            </h3>\n            <p className=\"mt-1 text-sm text-gray-500\">\n              {searchTerm ? 'Tidak ada hasil yang sesuai dengan pencarian.' : 'Anda belum melakukan scan QR code SIMLOK.'}\n            </p>\n          </div>\n        ) : (\n          <>\n            {/* Mobile Card Layout */}\n            <div className=\"block lg:hidden\">\n              <div className=\"divide-y divide-gray-200\">\n                {scans.map((scan) => (\n                  <div key={scan.id} className=\"p-4 hover:bg-gray-50 transition-colors\">\n                    {/* Header with Status and Date */}\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        {getStatusBadge(scan.submission.approval_status)}\n                      </div>\n                      <div className=\"text-xs text-gray-500\">\n                        {formatDateShort(scan.scanned_at)}\n                      </div>\n                    </div>\n\n                    {/* SIMLOK Number */}\n                    <div className=\"mb-3\">\n                      <div className=\"text-sm font-medium text-gray-900 flex items-center\">\n                        <QrCodeIcon className=\"w-4 h-4 mr-2 text-blue-500\" />\n                        {scan.submission.simlok_number || 'Belum ada nomor'}\n                      </div>\n                    </div>\n\n                    {/* Vendor Info */}\n                    <div className=\"mb-3\">\n                      <div className=\"text-sm font-medium text-gray-900 mb-1 flex items-center\">\n                        <BuildingOfficeIcon className=\"w-4 h-4 mr-2 text-gray-400\" />\n                        {scan.submission.vendor_name}\n                      </div>\n                      <div className=\"text-xs text-gray-500 flex items-center ml-6\">\n                        <UserIcon className=\"w-3 h-3 mr-1\" />\n                        {scan.submission.officer_name}\n                      </div>\n                    </div>\n\n                    {/* Scan Location */}\n                    {scan.scan_location && (\n                      <div className=\"mb-3\">\n                        <div className=\"text-xs text-gray-500 flex items-center\">\n                          <MapPinIcon className=\"w-3 h-3 mr-1\" />\n                          Discan di: {scan.scan_location}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Action Button */}\n                    <div className=\"flex justify-end\">\n                      <Button\n                        onClick={() => setSelectedScan(scan)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"w-full sm:w-auto\"\n                      >\n                        <EyeIcon className=\"w-4 h-4 mr-2\" />\n                        Lihat Detail\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Desktop Table Layout */}\n            <div className=\"hidden lg:block\">\n              <div className=\"overflow-hidden  md:rounded-lg\">\n                <div className=\"overflow-x-auto\">\n                  <table className=\"min-w-full divide-y divide-gray-200\" style={{tableLayout: 'fixed', width: '100%'}}>\n                    <thead className=\"bg-gray-50\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '150px'}}>\n                          SIMLOK\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '200px'}}>\n                          Vendor\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '180px'}}>\n                          Lokasi Scan\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '120px'}}>\n                          Status\n                        </th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '150px'}}>\n                          Waktu Scan\n                        </th>\n                        <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\" style={{width: '80px'}}>\n                          Aksi\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\n                      {scans.map((scan) => (\n                        <tr key={scan.id} className=\"hover:bg-gray-50\">\n                          <td className=\"px-4 py-4 text-sm\" style={{width: '150px'}}>\n                            <div className=\"font-medium text-gray-900 truncate\" title={scan.submission.simlok_number || 'Belum ada nomor'}>\n                              {scan.submission.simlok_number || 'Belum ada nomor'}\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-4 text-sm\" style={{width: '200px'}}>\n                            <div>\n                              <div className=\"font-medium text-gray-900 truncate\" title={scan.submission.vendor_name}>\n                                {scan.submission.vendor_name}\n                              </div>\n                              <div className=\"text-gray-500 truncate\" title={scan.submission.officer_name}>\n                                {scan.submission.officer_name}\n                              </div>\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-4 text-sm\" style={{width: '180px'}}>\n                            <div className=\"text-gray-900 truncate\" title={scan.scan_location || 'Tidak diketahui'}>\n                              {scan.scan_location || 'Tidak diketahui'}\n                            </div>\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap\" style={{width: '120px'}}>\n                            {getStatusBadge(scan.submission.approval_status)}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-500\" style={{width: '150px'}}>\n                            {formatDate(scan.scanned_at)}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-right text-sm font-medium\" style={{width: '80px'}}>\n                            <Button\n                              onClick={() => setSelectedScan(scan)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                            >\n                              <EyeIcon className=\"w-4 h-4\" />\n                            </Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            </div>\n          </>\n        )}\n\n        {/* Load More */}\n        {pagination.hasMore && scans.length > 0 && (\n          <div className=\"px-4 py-4 border-t border-gray-200\">\n            <Button\n              onClick={loadMore}\n              disabled={loading}\n              variant=\"outline\"\n              className=\"w-full\"\n            >\n              {loading ? (\n                <div className=\"flex items-center justify-center\">\n                  <LoadingSpinner size=\"sm\" className=\"mr-2\" />\n                  Memuat...\n                </div>\n              ) : (\n                'Muat Lebih Banyak'\n              )}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {/* Enhanced Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200\">\n          <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-4 duration-300\">\n            {/* Modal Header */}\n            <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-white/20 rounded-lg\">\n                    <QrCodeIcon className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-xl font-bold\">Detail Scan QR Code</h3>\n                    <p className=\"text-blue-100 text-sm\">\n                      {selectedScan.submission.simlok_number || 'Informasi Pengajuan'}\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                >\n                  <XMarkIcon className=\"w-6 h-6 text-white\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-100px)]\">\n              {/* Status Banner */}\n              <div className=\"mb-6\">\n                {selectedScan.submission.approval_status === 'PENDING' && (\n                  <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <ClockIcon className=\"w-5 h-5 text-yellow-600 mr-2\" />\n                      <span className=\"font-semibold text-yellow-800\">Status: Menunggu Persetujuan</span>\n                    </div>\n                  </div>\n                )}\n                {selectedScan.submission.approval_status === 'APPROVED' && (\n                  <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <CheckCircleIcon className=\"w-5 h-5 text-green-600 mr-2\" />\n                      <span className=\"font-semibold text-green-800\">Status: Telah Disetujui</span>\n                    </div>\n                  </div>\n                )}\n                {selectedScan.submission.approval_status === 'REJECTED' && (\n                  <div className=\"bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 p-4 rounded-lg\">\n                    <div className=\"flex items-center\">\n                      <XCircleIcon className=\"w-5 h-5 text-red-600 mr-2\" />\n                      <span className=\"font-semibold text-red-800\">Status: Ditolak</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Main Content Grid */}\n              <div className=\"space-y-6\">\n                {/* Submission Information */}\n                <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200\">\n                  <div className=\"flex items-center mb-6\">\n                    <div className=\"p-3 bg-blue-100 rounded-xl mr-4\">\n                      <DocumentTextIcon className=\"w-6 h-6 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"text-xl font-bold text-gray-800\">Informasi Pengajuan</h4>\n                      <p className=\"text-sm text-gray-500\">Detail lengkap pengajuan SIMLOK</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                    {/* Left Column */}\n                    <div className=\"space-y-4\">\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <QrCodeIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Nomor SIMLOK</span>\n                        </div>\n                        <p className=\"text-lg font-bold text-gray-900\">\n                          {selectedScan.submission.simlok_number || 'Belum ada nomor'}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <BuildingOfficeIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Perusahaan</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.submission.vendor_name}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <UserIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Petugas PIC</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.submission.officer_name}\n                        </p>\n                      </div>\n\n                      {selectedScan.submission.worker_count && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <UsersIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Jumlah Pekerja</span>\n                          </div>\n                          <p className=\"text-lg font-bold text-gray-900\">\n                            {selectedScan.submission.worker_count} orang\n                          </p>\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Right Column */}\n                    <div className=\"space-y-4\">\n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <BriefcaseIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Deskripsi Pekerjaan</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700 leading-relaxed\">\n                          {selectedScan.submission.job_description}\n                        </p>\n                      </div>\n                      \n                      <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <MapPinIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Lokasi Kerja</span>\n                        </div>\n                        <p className=\"text-sm text-gray-700 leading-relaxed\">\n                          {selectedScan.submission.work_location}\n                        </p>\n                      </div>\n\n                      {selectedScan.submission.working_hours && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <ClockIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Jam Kerja</span>\n                          </div>\n                          <p className=\"text-sm text-gray-700\">\n                            {selectedScan.submission.working_hours}\n                          </p>\n                        </div>\n                      )}\n\n                      {(selectedScan.submission.implementation_start_date || selectedScan.submission.implementation_end_date) && (\n                        <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <CalendarDaysIcon className=\"w-4 h-4 text-blue-600\" />\n                            <span className=\"text-sm font-medium text-gray-600\">Periode Pelaksanaan</span>\n                          </div>\n                          <p className=\"text-sm text-gray-700\">\n                            {selectedScan.submission.implementation_start_date && \n                              format(new Date(selectedScan.submission.implementation_start_date), 'dd MMM yyyy', { locale: id })}\n                            {selectedScan.submission.implementation_start_date && selectedScan.submission.implementation_end_date && ' - '}\n                            {selectedScan.submission.implementation_end_date && \n                              format(new Date(selectedScan.submission.implementation_end_date), 'dd MMM yyyy', { locale: id })}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Document Numbers */}\n                  {(selectedScan.submission.simja_number || selectedScan.submission.sika_number) && (\n                    <div className=\"mt-6 pt-4 border-t border-gray-200\">\n                      <h5 className=\"text-sm font-semibold text-gray-700 mb-3\">Nomor Dokumen Pendukung</h5>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        {selectedScan.submission.simja_number && (\n                          <div className=\"bg-blue-50 rounded-lg p-3 border border-blue-200\">\n                            <span className=\"text-xs font-medium text-blue-600\">SIMJA</span>\n                            <p className=\"text-sm font-semibold text-blue-900 mt-1\">\n                              {selectedScan.submission.simja_number}\n                            </p>\n                          </div>\n                        )}\n                        {selectedScan.submission.sika_number && (\n                          <div className=\"bg-green-50 rounded-lg p-3 border border-green-200\">\n                            <span className=\"text-xs font-medium text-green-600\">SIKA</span>\n                            <p className=\"text-sm font-semibold text-green-900 mt-1\">\n                              {selectedScan.submission.sika_number}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Scan Information */}\n                <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200\">\n                  <div className=\"flex items-center mb-6\">\n                    <div className=\"p-3 bg-blue-100 rounded-xl mr-4\">\n                      <QrCodeIcon className=\"w-6 h-6 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"text-xl font-bold text-gray-800\">Detail Scan QR Code</h4>\n                      <p className=\"text-sm text-gray-500\">Informasi verifikasi dan validasi</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <CalendarDaysIcon className=\"w-4 h-4 text-blue-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Tanggal Scan</span>\n                      </div>\n                      <p className=\"text-lg font-bold text-gray-900\">\n                        {format(new Date(selectedScan.scanned_at), 'dd MMMM yyyy', { locale: id })}\n                      </p>\n                      <p className=\"text-sm text-gray-600\">\n                        {format(new Date(selectedScan.scanned_at), \"HH:mm:ss 'WIB'\", { locale: id })}\n                      </p>\n                    </div>\n                    \n                    <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <MapPinIcon className=\"w-4 h-4 text-blue-600\" />\n                        <span className=\"text-sm font-medium text-gray-600\">Lokasi Scan</span>\n                      </div>\n                      <p className=\"text-sm font-semibold text-gray-900\">\n                        {selectedScan.scan_location || 'Lokasi tidak diketahui'}\n                      </p>\n                    </div>\n\n                    {selectedScan.scanner_name && (\n                      <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <UserIcon className=\"w-4 h-4 text-blue-600\" />\n                          <span className=\"text-sm font-medium text-gray-600\">Scanner</span>\n                        </div>\n                        <p className=\"text-sm font-semibold text-gray-900\">\n                          {selectedScan.scanner_name}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* <div className=\"mt-4 bg-white rounded-lg p-4 border border-blue-200\">\n                    <div className=\"flex items-center space-x-2 mb-2\">\n                      <CheckCircleIcon className=\"w-4 h-4 text-blue-600\" />\n                      <span className=\"text-sm font-medium text-gray-600\">ID Scan</span>\n                    </div>\n                    <p className=\"text-xs font-mono text-gray-600 bg-gray-100 px-3 py-2 rounded-lg\">\n                      {selectedScan.id}\n                    </p>\n                  </div> */}\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-200\">\n                <Button\n                  variant=\"secondary\"\n                  onClick={() => setSelectedScan(null)}\n                  className=\"px-6\"\n                >\n                  Tutup\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"
            }
          ]
        }
      ]
    },
    {
      "type": "directory",
      "name": "context",
      "children": [
        {
          "type": "file",
          "name": "ThemeContext.tsx",
          "content": "\"use client\";\n\nimport type React from \"react\";\nimport { createContext, useState, useContext, useEffect } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeContextType = {\n  theme: Theme;\n  toggleTheme: () => void;\n};\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({\n  children,\n}) => {\n  const [theme, setTheme] = useState<Theme>(\"light\");\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  useEffect(() => {\n    // This code will only run on the client side\n    const savedTheme = localStorage.getItem(\"theme\") as Theme | null;\n    const initialTheme = savedTheme || \"light\"; // Default to light theme\n\n    setTheme(initialTheme);\n    setIsInitialized(true);\n  }, []);\n\n  useEffect(() => {\n    if (isInitialized) {\n      localStorage.setItem(\"theme\", theme);\n      if (theme === \"dark\") {\n        document.documentElement.classList.add(\"dark\");\n      } else {\n        document.documentElement.classList.remove(\"dark\");\n      }\n    }\n  }, [theme, isInitialized]);\n\n  const toggleTheme = () => {\n    setTheme((prevTheme) => (prevTheme === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  // Prevent hydration mismatch by not rendering until client-side\n  if (!isInitialized) {\n    return (\n      <ThemeContext.Provider value={{ theme: \"light\", toggleTheme }}>\n        {children}\n      </ThemeContext.Provider>\n    );\n  }\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n};\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "hooks",
      "children": [
        {
          "type": "file",
          "name": "useImplementationDates.ts",
          "content": "import { useState, useCallback, useMemo } from 'react';\n\nexport interface ImplementationDates {\n  startDate: string;\n  endDate: string;\n}\n\nexport interface ImplementationTemplate {\n  pelaksanaan: string;\n  lainLain: string;\n}\n\nexport interface UseImplementationDatesOptions {\n  simjaNumber?: string | undefined;\n  simjaDate?: string | undefined;\n  sikaNumber?: string | undefined;\n  sikaDate?: string | undefined;\n  signerPosition?: string;\n  initialDates?: ImplementationDates;\n}\n\nexport interface UseImplementationDatesReturn {\n  dates: ImplementationDates;\n  template: ImplementationTemplate;\n  errors: {\n    startDate?: string;\n    endDate?: string;\n  };\n  isValid: boolean;\n  duration: number | null;\n  updateStartDate: (date: string) => void;\n  updateEndDate: (date: string) => void;\n  updateDates: (dates: ImplementationDates) => void;\n  getData: () => { startDate: string; endDate: string; pelaksanaan: string };\n  reset: () => void;\n}\n\n/**\n * Custom hook untuk mengelola tanggal pelaksanaan dan generate template otomatis\n * Hook ini menangani semua logic terkait tanggal pelaksanaan dengan clean separation of concerns\n */\nexport function useImplementationDates({\n  simjaNumber = '',\n  simjaDate = '',\n  sikaNumber = '',\n  sikaDate = '',\n  signerPosition = 'Sr Officer Security III',\n  initialDates = { startDate: '', endDate: '' }\n}: UseImplementationDatesOptions = {}): UseImplementationDatesReturn {\n  \n  const [dates, setDates] = useState<ImplementationDates>(initialDates);\n\n  // Validate individual date\n  const validateDate = useCallback((dateStr: string): string | undefined => {\n    if (!dateStr) return undefined;\n    \n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) {\n        return 'Format tanggal tidak valid';\n      }\n      \n      // Check if date is in the past (optional validation)\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      if (date < today) {\n        return 'Tanggal tidak boleh di masa lalu';\n      }\n      \n      return undefined;\n    } catch (error) {\n      return 'Format tanggal tidak valid';\n    }\n  }, []);\n\n  // Validate date range\n  const errors = useMemo(() => {\n    const result: { startDate?: string; endDate?: string } = {};\n    \n    // Validate start date\n    const startError = validateDate(dates.startDate);\n    if (startError) {\n      result.startDate = startError;\n    }\n    \n    // Validate end date\n    const endError = validateDate(dates.endDate);\n    if (endError) {\n      result.endDate = endError;\n    }\n    \n    // Validate range if both dates are valid\n    if (!startError && !endError && dates.startDate && dates.endDate) {\n      const startDate = new Date(dates.startDate);\n      const endDate = new Date(dates.endDate);\n      \n      if (endDate < startDate) {\n        result.endDate = 'Tanggal selesai harus setelah tanggal mulai';\n      }\n      \n      // Check if range is reasonable (not more than 1 year)\n      const diffTime = endDate.getTime() - startDate.getTime();\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n      \n      if (diffDays > 365) {\n        result.endDate = 'Periode pelaksanaan tidak boleh lebih dari 1 tahun';\n      }\n    }\n    \n    return result;\n  }, [dates, validateDate]);\n\n  // Check if dates are valid\n  const isValid = useMemo(() => {\n    return dates.startDate !== '' && \n           dates.endDate !== '' && \n           Object.keys(errors).length === 0;\n  }, [dates, errors]);\n\n  // Calculate duration in days\n  const duration = useMemo((): number | null => {\n    if (!dates.startDate || !dates.endDate || !isValid) {\n      return null;\n    }\n    \n    try {\n      const startDate = new Date(dates.startDate);\n      const endDate = new Date(dates.endDate);\n      \n      const diffTime = endDate.getTime() - startDate.getTime();\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both dates\n      \n      return diffDays > 0 ? diffDays : null;\n    } catch (error) {\n      return null;\n    }\n  }, [dates, isValid]);\n\n  // Format date for Indonesian locale\n  const formatDateIndonesian = useCallback((dateStr: string): string => {\n    if (!dateStr) return '[tanggal]';\n    \n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) return '[tanggal]';\n      \n      return date.toLocaleDateString('id-ID', {\n        day: 'numeric',\n        month: 'long',\n        year: 'numeric'\n      });\n    } catch (error) {\n      return '[tanggal]';\n    }\n  }, []);\n\n  // Generate pelaksanaan template\n  const pelaksanaanTemplate = useMemo((): string => {\n    if (!dates.startDate || !dates.endDate || !isValid) {\n      return '';\n    }\n    \n    const startDateFormatted = formatDateIndonesian(dates.startDate);\n    const endDateFormatted = formatDateIndonesian(dates.endDate);\n    \n    return `Terhitung mulai tanggal ${startDateFormatted} sampai ${endDateFormatted}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;\n  }, [dates, isValid, formatDateIndonesian]);\n\n  // Generate lain-lain template\n  const lainLainTemplate = useMemo((): string => {\n    if (!dates.startDate || !dates.endDate || !isValid) {\n      return '';\n    }\n\n    const templateParts: string[] = [];\n    \n    // Header\n    templateParts.push('Izin diberikan berdasarkan :');\n    \n    // SIMJA section\n    if (simjaNumber && simjaDate) {\n      const simjaDateFormatted = formatDateIndonesian(simjaDate);\n      templateParts.push(\n        '• <strong>SIMJA</strong> Ast. Man. Facility Management',\n        `  <strong>No. ${simjaNumber}</strong> <strong>Tanggal ${simjaDateFormatted}</strong>`\n      );\n    } else {\n      templateParts.push(\n        '• <strong>SIMJA</strong> Ast. Man. Facility Management',\n        '  <strong>No. [nomor]</strong> <strong>Tanggal [tanggal]</strong>'\n      );\n    }\n    \n    // SIKA section\n    if (sikaNumber && sikaDate) {\n      const sikaDateFormatted = formatDateIndonesian(sikaDate);\n      templateParts.push(\n        '• <strong>SIKA</strong> Pekerjaan Dingin',\n        `  <strong>No.${sikaNumber}</strong> <strong>Tgl. ${sikaDateFormatted}</strong>`\n      );\n    } else {\n      templateParts.push(\n        '• <strong>SIKA</strong> Pekerjaan Dingin',\n        '  <strong>No.[nomor]</strong> <strong>Tgl. [tanggal]</strong>'\n      );\n    }\n    \n    // Security approval section\n    const todayStr = new Date().toISOString().split('T')[0] || '';\n    const today = formatDateIndonesian(todayStr);\n    templateParts.push(\n      '',\n      `Diterima ${signerPosition}`,\n      `<strong>${today}</strong>`\n    );\n    \n    return templateParts.join('\\n');\n  }, [dates, isValid, simjaNumber, simjaDate, sikaNumber, sikaDate, signerPosition, formatDateIndonesian]);\n\n  // Template object\n  const template = useMemo((): ImplementationTemplate => ({\n    pelaksanaan: pelaksanaanTemplate,\n    lainLain: lainLainTemplate\n  }), [pelaksanaanTemplate, lainLainTemplate]);\n\n  // Update handlers\n  const updateStartDate = useCallback((date: string) => {\n    setDates(prev => ({ ...prev, startDate: date }));\n  }, []);\n\n  const updateEndDate = useCallback((date: string) => {\n    setDates(prev => ({ ...prev, endDate: date }));\n  }, []);\n\n  const updateDates = useCallback((newDates: ImplementationDates) => {\n    setDates(newDates);\n  }, []);\n\n  const reset = useCallback(() => {\n    setDates({ startDate: '', endDate: '' });\n  }, []);\n\n  const getData = useCallback(() => ({\n    startDate: dates.startDate,\n    endDate: dates.endDate,\n    pelaksanaan: template.pelaksanaan\n  }), [dates, template.pelaksanaan]);\n\n  return {\n    dates,\n    template,\n    errors,\n    isValid,\n    duration,\n    updateStartDate,\n    updateEndDate,\n    updateDates,\n    getData,\n    reset\n  };\n}"
        },
        {
          "type": "file",
          "name": "useModal.ts",
          "content": "import { useState } from 'react';\n\nexport const useModal = () => {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const openModal = () => setIsOpen(true);\n  const closeModal = () => setIsOpen(false);\n\n  return {\n    isOpen,\n    openModal,\n    closeModal,\n  };\n};"
        },
        {
          "type": "file",
          "name": "useRealTimeNotifications.ts",
          "content": "import { useEffect, useRef } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useNotificationsStore } from '@/store/notifications';\n\ninterface SSEMessage {\n  type: string;\n  data?: any;\n  message?: string;\n  timestamp?: string;\n}\n\nexport function useRealTimeNotifications() {\n  const { data: session } = useSession();\n  const eventSourceRef = useRef<EventSource | null>(null);\n  const { addItem, setUnreadCount, removeNotifications } = useNotificationsStore();\n\n  useEffect(() => {\n    if (!session?.user) {\n      // Clean up EventSource if user logs out\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n      return;\n    }\n\n    // Skip real-time notifications for verifiers\n    if (session.user.role === 'VERIFIER') {\n      return;\n    }\n\n    // Don't create multiple connections\n    if (eventSourceRef.current) {\n      return;\n    }\n\n    // Determine scope based on user role\n    let scope: string;\n    if ( session.user.role === 'SUPER_ADMIN') {\n      scope = 'admin';\n    } else if (session.user.role === 'REVIEWER') {\n      scope = 'reviewer';\n    } else if (session.user.role === 'APPROVER') {\n      scope = 'approver';\n    } else {\n      scope = 'vendor';\n    }\n\n    const params = new URLSearchParams({ scope });\n    \n    if (scope === 'vendor' && session.user.id) {\n      params.append('vendorId', session.user.id);\n    }\n\n    console.log('Establishing SSE connection for notifications...');\n    \n    const eventSource = new EventSource(`/api/notifications/stream?${params.toString()}`);\n    eventSourceRef.current = eventSource;\n\n    eventSource.onopen = () => {\n      console.log('SSE connection opened');\n    };\n\n    eventSource.onmessage = (event) => {\n      try {\n        const message: SSEMessage = JSON.parse(event.data);\n        console.log('SSE message received:', message);\n\n        switch (message.type) {\n          case 'connected':\n            console.log('Real-time notifications connected:', message.message);\n            break;\n\n          case 'notification:new':\n            if (message.data) {\n              console.log('New notification via SSE:', message.data);\n              \n              // Add notification to store with proper data\n              addItem({\n                id: message.data.id,\n                type: message.data.type || 'notification', // Use actual notification type\n                title: message.data.title,\n                message: message.data.message,\n                data: message.data.data || null, // Preserve the data field from server\n                createdAt: message.data.createdAt,\n                isRead: false\n              });\n            }\n            break;\n\n          case 'notification:unread_count':\n            if (message.data?.unreadCount !== undefined) {\n              console.log('Unread count update via SSE:', message.data.unreadCount);\n              setUnreadCount(message.data.unreadCount);\n            }\n            break;\n\n          case 'notification:removed':\n            if (message.data?.submissionId) {\n              console.log('Notification removal via SSE for submission:', message.data.submissionId);\n              removeNotifications(message.data.submissionId);\n            }\n            break;\n\n          case 'stats:update':\n            console.log('Stats update via SSE:', message.data);\n            // You can emit this to stats store if needed\n            break;\n\n          case 'heartbeat':\n            // Keep-alive message, no action needed\n            break;\n\n          default:\n            console.log('Unknown SSE message type:', message.type);\n        }\n      } catch (error) {\n        console.error('Error parsing SSE message:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('SSE connection error:', error);\n      \n      // Automatic reconnection will be handled by the browser\n      // but we can add custom logic here if needed\n      \n      if (eventSource.readyState === EventSource.CLOSED) {\n        console.log('SSE connection closed');\n        eventSourceRef.current = null;\n      }\n    };\n\n    // Cleanup on unmount\n    return () => {\n      if (eventSourceRef.current) {\n        console.log('Closing SSE connection');\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n    };\n  }, [session, addItem, setUnreadCount, removeNotifications]);\n\n  return {\n    isConnected: typeof window !== 'undefined' && eventSourceRef.current?.readyState === EventSource.OPEN,\n    eventSource: eventSourceRef.current\n  };\n}\n"
        },
        {
          "type": "file",
          "name": "useRobustTemplateGenerator.ts",
          "content": ""
        },
        {
          "type": "file",
          "name": "useToast.ts",
          "content": "'use client';\n\ninterface ToastOptions {\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n}\n\ndeclare global {\n  interface Window {\n    showToast?: (toast: ToastOptions) => void;\n  }\n}\n\nexport function useToast() {\n  const showToast = (toast: ToastOptions) => {\n    if (typeof window !== 'undefined' && window.showToast) {\n      window.showToast(toast);\n    }\n  };\n\n  const showSuccess = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'success', title, message, duration: duration || 5000 });\n  };\n\n  const showError = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'error', title, message, duration: duration || 5000 });\n  };\n\n  const showWarning = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'warning', title, message, duration: duration || 5000 });\n  };\n\n  const showInfo = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'info', title, message, duration: duration || 5000 });\n  };\n\n  return {\n    showToast,\n    showSuccess,\n    showError,\n    showWarning,\n    showInfo\n  };\n}\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "lib",
      "children": [
        {
          "type": "file",
          "name": "api-utils.ts",
          "content": "/**\n * Common utilities for API route handlers\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { ZodError, ZodSchema } from 'zod';\nimport type { ApiError, ApiSuccess } from '@/shared/dto';\n\n/**\n * Standard API response helpers\n */\nexport function apiError(\n  message: string, \n  status: number = 400, \n  code?: string\n): NextResponse<ApiError> {\n  return NextResponse.json(\n    {\n      error: 'API Error',\n      message,\n      ...(code && { code }),\n    },\n    { status }\n  );\n}\n\nexport function apiSuccess<T = any>(\n  data?: T, \n  message?: string,\n  status: number = 200\n): NextResponse<ApiSuccess> {\n  return NextResponse.json(\n    {\n      success: true,\n      ...(data !== undefined && { data }),\n      ...(message && { message }),\n    },\n    { status }\n  );\n}\n\n/**\n * Validate request body with Zod schema\n */\nexport async function validateRequestBody<T>(\n  request: NextRequest,\n  schema: ZodSchema<T>\n): Promise<{ data: T; error?: never } | { data?: never; error: string }> {\n  try {\n    const body = await request.json();\n    const data = schema.parse(body);\n    return { data };\n  } catch (error) {\n    if (error instanceof ZodError) {\n      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);\n      return { error: `Validation failed: ${messages.join(', ')}` };\n    }\n    return { error: 'Invalid JSON body' };\n  }\n}\n\n/**\n * Validate query parameters with Zod schema\n */\nexport function validateQueryParams<T>(\n  request: NextRequest,\n  schema: ZodSchema<T>\n): { data: T; error?: never } | { data?: never; error: string } {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const params = Object.fromEntries(searchParams.entries());\n    const data = schema.parse(params);\n    return { data };\n  } catch (error) {\n    if (error instanceof ZodError) {\n      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);\n      return { error: `Validation failed: ${messages.join(', ')}` };\n    }\n    return { error: 'Invalid query parameters' };\n  }\n}\n\n/**\n * Get authenticated session with role checking\n */\nexport async function getAuthenticatedSession(\n  allowedRoles?: string[]\n): Promise<\n  | { session: any; error?: never }\n  | { session?: never; error: NextResponse }\n> {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return { error: apiError('Authentication required', 401) };\n    }\n\n    if (allowedRoles && !allowedRoles.includes(session.user.role)) {\n      return { error: apiError('Insufficient permissions', 403) };\n    }\n\n    return { session };\n  } catch (error) {\n    console.error('Auth error:', error);\n    return { error: apiError('Authentication failed', 401) };\n  }\n}\n\n/**\n * Safe async route handler wrapper\n */\nexport function withErrorHandling<T extends any[]>(\n  handler: (...args: T) => Promise<NextResponse>\n) {\n  return async (...args: T): Promise<NextResponse> => {\n    try {\n      return await handler(...args);\n    } catch (error) {\n      console.error('API route error:', error);\n      \n      if (error instanceof Error) {\n        return apiError(error.message, 500);\n      }\n      \n      return apiError('Internal server error', 500);\n    }\n  };\n}\n\n/**\n * CORS headers for API routes\n */\nexport function addCorsHeaders(response: NextResponse): NextResponse {\n  response.headers.set('Access-Control-Allow-Origin', process.env.NEXTAUTH_URL || '*');\n  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n  response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  response.headers.set('Access-Control-Max-Age', '86400');\n  return response;\n}\n\n/**\n * Handle OPTIONS requests for CORS\n */\nexport function handleOptions(): NextResponse {\n  const response = new NextResponse(null, { status: 200 });\n  return addCorsHeaders(response);\n}\n"
        },
        {
          "type": "file",
          "name": "auth.ts",
          "content": "// app/lib/auth.ts\nimport Credentials from \"next-auth/providers/credentials\";\nimport { prisma } from \"./singletons\";\nimport bcrypt from \"bcryptjs\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport { JWT_CONFIG } from \"@/utils/jwt-config\";\nimport { TokenManager } from \"@/utils/token-manager\";\n\n\nexport const authOptions: NextAuthOptions = {\n  secret: process.env.NEXTAUTH_SECRET || 'fallback-secret-for-development',\n  debug: process.env.NODE_ENV === 'development',\n  logger: {\n    error(code, metadata) {\n      if (code === 'JWT_SESSION_ERROR') {\n        console.log('JWT Session Error - clearing invalid token');\n        // Don't log the full error in production\n        return;\n      }\n      console.error('NextAuth Error:', code, metadata);\n    },\n    warn(code) {\n      console.warn('NextAuth Warning:', code);\n    },\n  },\n  providers: [\n    Credentials({\n      credentials: { email: {}, password: {} },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n\n        const user = await prisma.user.findUnique({\n          where: { email: credentials.email },\n        });\n        if (!user || !user.password) return null;\n\n        // Check if user verification status is REJECTED\n        if (user.verification_status === 'REJECTED') {\n          throw new Error('ACCOUNT_REJECTED');\n        }\n\n        const ok = await bcrypt.compare(credentials.password, user.password);\n        if (!ok) return null;\n\n        // Generate refresh token and store it\n        // await prisma.refreshToken.create({\n        //   data: {\n        //     token: crypto.randomUUID(),\n        //     userId: user.id,\n        //     expiresAt: new Date(Date.now() + JWT_CONFIG.SESSION_MAX_AGE * 1000),\n        //   },\n        // });\n\n        console.log('Auth authorize - returning user:', { \n          id: user.id, \n          email: user.email, \n          role: user.role \n        }); // Debug log\n\n        // return the minimal shape Next-Auth expects\n        return {\n          id: user.id,\n          role: user.role,\n          name: user.officer_name,\n          email: user.email || null,\n          officer_name: user.officer_name,\n          vendor_name: user.vendor_name,\n          verified_at: user.verified_at,\n          verification_status: user.verification_status,\n          created_at: user.created_at,\n        };\n      },\n    }),\n  ],\n  session: { \n    strategy: \"jwt\",\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      try {\n        // Check if token is expired\n        const now = Date.now() / 1000; // Current time in seconds\n      \n      // user only exists on first sign-in, but we need to refresh verification status\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n        token.officer_name = user.officer_name;\n        token.vendor_name = user.vendor_name || null;\n        token.verified_at = user.verified_at || null;\n        token.verification_status = user.verification_status || 'PENDING';\n        if (user.created_at) {\n          token.created_at = user.created_at;\n        }\n        // Set issued at time and expiry using configured values\n        token.iat = now;\n        token.exp = now + JWT_CONFIG.JWT_EXPIRE_TIME;\n        console.log('JWT callback - storing user.id:', user.id);\n        console.log('JWT callback - token expires at:', new Date((now + JWT_CONFIG.JWT_EXPIRE_TIME) * 1000));\n      } else if (token.id) {\n        // Check if token is expired\n        if (token.exp && typeof token.exp === 'number') {\n          const now = Date.now() / 1000;\n          if (now >= token.exp) {\n            console.log('JWT callback - token expired, clearing session');\n            return {}; // Return empty object to clear token\n          }\n        }\n        \n        // Refresh user data from database to get latest verification status\n        try {\n          const latestUser = await prisma.user.findUnique({\n            where: { id: token.id as string },\n            select: { verified_at: true, role: true, verification_status: true }\n          });\n          \n          if (latestUser) {\n            token.verified_at = latestUser.verified_at;\n            token.verification_status = latestUser.verification_status || 'PENDING';\n            console.log('JWT callback - refreshed verified_at:', latestUser.verified_at);\n            console.log('JWT callback - refreshed verification_status:', latestUser.verification_status);\n          }\n        } catch (error) {\n          console.error('Error refreshing user verification status:', error);\n        }\n      }\n      return token;\n      } catch (error) {\n        console.error('JWT callback error:', error);\n        // Return empty token on error to force re-authentication\n        return {};\n      }\n    },\n    async session({ session, token }) {\n      if (token) {\n        session.user.id = token.id as string;\n        session.user.role = token.role as import(\"@prisma/client\").User_role;\n        session.user.officer_name = token.officer_name as string;\n        session.user.vendor_name = token.vendor_name as string | null;\n        session.user.verified_at = token.verified_at as Date | null;\n        session.user.verification_status = token.verification_status as import(\"@prisma/client\").VerificationStatus;\n        session.user.created_at = token.created_at as Date;\n\n        // Get active refresh token\n        // const activeRefreshToken = await prisma.refreshToken.findFirst({\n        //   where: {\n        //     userId: token.id as string,\n        //     expiresAt: { gt: new Date() }\n        //   },\n        //   orderBy: { expiresAt: 'desc' }\n        // });\n\n        // if (activeRefreshToken) {\n        //   (session.user as any).refreshToken = activeRefreshToken.token;\n        // }\n\n        // Update session in database for tracking\n        // await prisma.session.upsert({\n        //   where: {\n        //     sessionToken: activeRefreshToken?.token || 'temp-token',\n        //   },\n        //   create: {\n        //     sessionToken: activeRefreshToken?.token || 'temp-token',\n        //     userId: token.id as string,\n        //     expires: new Date(Date.now() + JWT_CONFIG.SESSION_MAX_AGE * 1000),\n        //   },\n        //   update: {\n        //     expires: new Date(Date.now() + JWT_CONFIG.SESSION_MAX_AGE * 1000),\n        //   },\n        // });\n        \n        console.log('Session callback - session.user.id:', session.user.id);\n      }\n      return session;\n    },\n  },\n  events: {\n    async signIn({ user }) {\n      console.log(`User ${user.email} signed in at ${new Date()}`);\n      // Clean up expired tokens on sign in\n      await TokenManager.cleanupExpiredTokens();\n    },\n    async signOut({ token }) {\n      if (token?.sub) {\n        // Invalidate all refresh tokens on signout\n        await TokenManager.invalidateAllUserTokens(token.sub);\n      }\n      console.log(`User signed out at ${new Date()}`);\n    },\n    async session({ token }) {\n      // Called whenever a session is checked\n      if (token.exp && typeof token.exp === 'number') {\n        const now = Date.now() / 1000;\n        if (now >= token.exp) {\n          console.log('Session expired, will be cleared');\n        }\n      }\n    }\n  },\n  pages: { signIn: \"/login\" },\n};"
        },
        {
          "type": "file",
          "name": "cache.ts",
          "content": "/** \n * Redis Cache Helper with namespacing and TTL support\n */\nimport { redisPub as redis } from './singletons';\n\nconst CACHE_PREFIX = 'app:v1';\n\ninterface CacheOptions {\n  ttl?: number; // TTL in seconds\n  namespace?: string;\n}\n\nexport class Cache {\n  private static getKey(key: string, namespace?: string): string {\n    const ns = namespace ? `:${namespace}` : '';\n    return `${CACHE_PREFIX}${ns}:${key}`;\n  }\n\n  /** Get JSON value from cache */\n  static async getJSON<T = any>(key: string, options: CacheOptions = {}): Promise<T | null> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const value = await redis.get(fullKey);\n      return value ? JSON.parse(value) : null;\n    } catch (error) {\n      console.warn('Cache.getJSON error:', error);\n      return null;\n    }\n  }\n\n  /** Set JSON value in cache with optional TTL */\n  static async setJSON(\n    key: string,\n    value: any,\n    options: CacheOptions = {}\n  ): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const serialized = JSON.stringify(value);\n      if (options.ttl) {\n        await redis.setex(fullKey, options.ttl, serialized);\n      } else {\n        await redis.set(fullKey, serialized);\n      }\n      return true;\n    } catch (error) {\n      console.warn('Cache.setJSON error:', error);\n      return false;\n    }\n  }\n\n  /** Get string value from cache */\n  static async get(key: string, options: CacheOptions = {}): Promise<string | null> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      return await redis.get(fullKey);\n    } catch (error) {\n      console.warn('Cache.get error:', error);\n      return null;\n    }\n  }\n\n  /** Set string value in cache with optional TTL */\n  static async set(\n    key: string,\n    value: string,\n    options: CacheOptions = {}\n  ): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      if (options.ttl) {\n        await redis.setex(fullKey, options.ttl, value);\n      } else {\n        await redis.set(fullKey, value);\n      }\n      return true;\n    } catch (error) {\n      console.warn('Cache.set error:', error);\n      return false;\n    }\n  }\n\n  /** Delete a key from cache */\n  static async del(key: string, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      await redis.del(fullKey);\n      return true;\n    } catch (error) {\n      console.warn('Cache.del error:', error);\n      return false;\n    }\n  }\n\n  /** Invalidate cache by prefix pattern */\n  static async invalidateByPrefix(prefix: string, namespace?: string): Promise<number> {\n    try {\n      const pattern = this.getKey(`${prefix}*`, namespace);\n      const keys = await redis.keys(pattern);\n      if (!keys || keys.length === 0) return 0;\n\n      // FIX di sini: sebelumnya salah \".keys\"\n      await redis.del(...keys);\n      return keys.length;\n    } catch (error) {\n      console.warn('Cache.invalidateByPrefix error:', error);\n      return 0;\n    }\n  }\n\n  /** Check if key exists */\n  static async exists(key: string, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.exists(fullKey);\n      return result === 1;\n    } catch (error) {\n      console.warn('Cache.exists error:', error);\n      return false;\n    }\n  }\n\n  /** Increment a numeric value (+ optional TTL for new key) */\n  static async incr(key: string, options: CacheOptions = {}): Promise<number> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.incr(fullKey);\n      if (options.ttl && result === 1) {\n        await redis.expire(fullKey, options.ttl);\n      }\n      return result;\n    } catch (error) {\n      console.warn('Cache.incr error:', error);\n      return 0;\n    }\n  }\n\n  /** Set TTL for existing key */\n  static async expire(key: string, ttl: number, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.expire(fullKey, ttl);\n      return result === 1;\n    } catch (error) {\n      console.warn('Cache.expire error:', error);\n      return false;\n    }\n  }\n}\n\n// Predefined namespaces for different features\nexport const CacheNamespaces = {\n  STATS: 'stats',\n  NOTIFICATIONS: 'notifications',\n  SUBMISSIONS: 'submissions',\n  VENDORS: 'vendors',\n  AUTH: 'auth',\n} as const;\n\n// Common TTL values (in seconds)\nexport const CacheTTL = {\n  SHORT: 60,      // 1 minute\n  MEDIUM: 300,    // 5 minutes\n  LONG: 900,      // 15 minutes\n  HOUR: 3600,     // 1 hour\n  DAY: 86400,     // 24 hours\n} as const;\n"
        },
        {
          "type": "file",
          "name": "db.ts",
          "content": "import { PrismaClient } from '@prisma/client';\n\nimport { config } from '@/lib/env';\n\n/**\n * Global variable for Prisma client to prevent multiple instances in development\n */\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\n/**\n * Database client configuration\n */\nconst createPrismaClient = () =>\n  new PrismaClient({\n    log: config.isDevelopment ? ['query', 'error', 'warn'] : ['error'],\n    datasources: {\n      db: {\n        url: config.database.url,\n      },\n    },\n  });\n\n/**\n * Prisma client instance\n * Uses global variable in development to prevent multiple instances during hot reload\n */\nexport const db = globalThis.__prisma ?? createPrismaClient();\n\nif (config.isDevelopment) {\n  globalThis.__prisma = db;\n}\n\n/**\n * Database connection utilities\n */\nexport const dbUtils = {\n  /**\n   * Test database connection\n   */\n  async testConnection(): Promise<boolean> {\n    try {\n      await db.$queryRaw`SELECT 1`;\n      return true;\n    } catch (error) {\n      console.error('Database connection failed:', error);\n      return false;\n    }\n  },\n\n  /**\n   * Gracefully disconnect from database\n   */\n  async disconnect(): Promise<void> {\n    await db.$disconnect();\n  },\n\n  /**\n   * Execute database transaction\n   */\n  async transaction<T>(\n    fn: (prisma: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use' | '$extends'>) => Promise<T>\n  ): Promise<T> {\n    try {\n      return await db.$transaction(fn);\n    } catch (error) {\n      console.error('Transaction error:', error);\n      throw new DatabaseError(\n        'Transaction failed',\n        error instanceof Error ? error.message : 'Unknown error'\n      );\n    }\n  },\n} as const;\n\n/**\n * Type helpers for Prisma\n */\nexport type DbTransaction = Parameters<Parameters<typeof db.$transaction>[0]>[0];\n\n/**\n * Database error handling\n */\nexport class DatabaseError extends Error {\n  constructor(\n    message: string,\n    public code?: string,\n    public meta?: unknown\n  ) {\n    super(message);\n    this.name = 'DatabaseError';\n  }\n}\n\n/**\n * Handle Prisma errors and convert to user-friendly messages\n */\nexport function handleDatabaseError(error: unknown): never {\n  if (error instanceof Error) {\n    // Prisma specific errors\n    if ('code' in error) {\n      const prismaError = error as { code: string; meta?: unknown };\n      \n      switch (prismaError.code) {\n        case 'P2002':\n          throw new DatabaseError('A record with this information already exists', prismaError.code, prismaError.meta);\n        case 'P2025':\n          throw new DatabaseError('Record not found', prismaError.code, prismaError.meta);\n        case 'P2003':\n          throw new DatabaseError('Invalid reference to related record', prismaError.code, prismaError.meta);\n        default:\n          throw new DatabaseError('Database operation failed', prismaError.code, prismaError.meta);\n      }\n    }\n    \n    throw new DatabaseError(error.message);\n  }\n  \n  throw new DatabaseError('Unknown database error occurred');\n}\n"
        },
        {
          "type": "file",
          "name": "env.ts",
          "content": "import { z } from 'zod';\n\n/**\n * Environment variables validation schema\n * Ensures all required environment variables are present and valid\n */\nconst envSchema = z.object({\n  // Database\n  DATABASE_URL: z.string().url('DATABASE_URL must be a valid URL'),\n\n  // NextAuth\n  NEXTAUTH_URL: z.string().url('NEXTAUTH_URL must be a valid URL'),\n  NEXTAUTH_SECRET: z.string().min(32, 'NEXTAUTH_SECRET must be at least 32 characters'),\n\n  // Node Environment\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n\n  // Optional: File uploads\n  UPLOAD_DIR: z.string().default('public/uploads'),\n  MAX_FILE_SIZE: z.string().default('5242880').transform(val => parseInt(val, 10)), // 5MB\n\n  // Optional: External services\n  SMTP_HOST: z.string().optional(),\n  SMTP_PORT: z.string().transform(val => parseInt(val, 10)).optional(),\n  SMTP_USER: z.string().optional(),\n  SMTP_PASS: z.string().optional(),\n});\n\n/**\n * Validated environment variables\n * Use this instead of process.env directly for type safety\n */\nexport const env = envSchema.parse(process.env);\n\n/**\n * Environment-specific configurations\n */\nexport const config = {\n  isDevelopment: env.NODE_ENV === 'development',\n  isProduction: env.NODE_ENV === 'production',\n  isTest: env.NODE_ENV === 'test',\n  \n  // Database\n  database: {\n    url: env.DATABASE_URL,\n  },\n\n  // Authentication\n  auth: {\n    url: env.NEXTAUTH_URL,\n    secret: env.NEXTAUTH_SECRET,\n  },\n\n  // File uploads\n  uploads: {\n    dir: env.UPLOAD_DIR,\n    maxFileSize: env.MAX_FILE_SIZE,\n    allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'application/pdf'],\n  },\n\n  // API\n  api: {\n    baseUrl: env.NEXTAUTH_URL,\n    timeout: 30000, // 30 seconds\n  },\n\n  // UI\n  ui: {\n    toastDuration: 5000,\n    modalAnimationDuration: 200,\n  },\n} as const;\n\nexport type Config = typeof config;\n"
        },
        {
          "type": "file",
          "name": "exportToExcel.ts",
          "content": "import * as XLSX from 'xlsx';\n\ninterface WorkerData {\n  id: string;\n  namaLengkap: string;\n  foto: string;\n  nik: string;\n  tempatLahir: string;\n  tanggalLahir: string;\n  jenisKelamin: string;\n  agama: string;\n  statusPerkawinan: string;\n  alamat: string;\n  noTelepon: string;\n  email: string;\n  pendidikanTerakhir: string;\n  jabatan: string;\n  pengalaman: string;\n  keahlianKhusus: string;\n  sertifikasi: string;\n  catatan: string;\n}\n\ninterface SubmissionData {\n  id: string;\n  nomorSurat: string;\n  perihal: string;\n  tujuan: string;\n  tempatPelaksanaan: string;\n  tanggalMulai: string;\n  tanggalSelesai: string;\n  statusApproval: string;\n  vendorName: string;\n  vendorCompany: string;\n  vendorEmail: string;\n  vendorPhone: string;\n  submittedAt: string;\n  approvedAt: string;\n  totalWorkers: number;\n  daftarPekerja: WorkerData[];\n  dokumenSika: string;\n  dokumenSimja: string;\n  catatan: string;\n  signerName: string;\n  signerTitle: string;\n  // Additional fields from current schema\n  jamKerja: string;\n  saranaKerja: string;\n  pelaksanaan: string;\n  lainLain: string;\n  nomorSimja: string;\n  tanggalSimja: string;\n  nomorSika: string;\n  tanggalSika: string;\n  nomorSimlok: string;\n  tanggalSimlok: string;\n  namaPerkerjaText: string;\n  content: string;\n  qrcode: string;\n  approvedBy: string;\n}\n\ninterface ExportOptions {\n  filename?: string;\n  sheetName?: string;\n  dateFrom?: string;\n  dateTo?: string;\n}\n\nexport const exportSubmissionsToExcel = (data: SubmissionData[], options: ExportOptions = {}) => {\n  try {\n    const {\n      filename = `submissions_export_${new Date().toISOString().split('T')[0]}.xlsx`,\n      sheetName = 'Submissions Data',\n      dateFrom,\n      dateTo\n    } = options;\n\n    // Filter data by date if provided\n    let filteredData = data;\n    if (dateFrom || dateTo) {\n      filteredData = data.filter(item => {\n        const itemDate = new Date(item.submittedAt);\n        const fromDate = dateFrom ? new Date(dateFrom) : null;\n        const toDate = dateTo ? new Date(dateTo) : null;\n\n        if (fromDate && toDate) {\n          // Set time to cover full day range\n          fromDate.setHours(0, 0, 0, 0);\n          toDate.setHours(23, 59, 59, 999);\n          return itemDate >= fromDate && itemDate <= toDate;\n        } else if (fromDate) {\n          fromDate.setHours(0, 0, 0, 0);\n          return itemDate >= fromDate;\n        } else if (toDate) {\n          toDate.setHours(23, 59, 59, 999);\n          return itemDate <= toDate;\n        }\n        return true;\n      });\n    }\n\n    // Transform submissions data for Excel export\n    const submissionsData = filteredData.map((item, index) => ({\n      'No': index + 1,\n      'Nomor SIMLOK': item.nomorSimlok || '-',\n      'Tanggal SIMLOK': item.tanggalSimlok || '-',\n      'ID Submission': item.id,\n      'Nomor Surat/Berdasarkan': item.nomorSurat,\n      'Perihal/Pekerjaan': item.perihal,\n      'Tujuan/Lokasi Kerja': item.tujuan,\n      'Tempat Pelaksanaan': item.tempatPelaksanaan,\n      'Pelaksanaan': item.pelaksanaan || '-',\n      'Jam Kerja': item.jamKerja,\n      'Sarana Kerja': item.saranaKerja,\n      'Lain-lain': item.lainLain || '-',\n      'Status Approval': item.statusApproval,\n      'Nama Vendor/Petugas': item.vendorName,\n      'Perusahaan Vendor': item.vendorCompany || '-',\n      'Email Vendor': item.vendorEmail,\n      'Telepon Vendor': item.vendorPhone || '-',\n      'Tanggal Submit': item.submittedAt,\n      'Approved By': item.approvedBy || '-',\n      'Total Pekerja': item.totalWorkers,\n      'Nomor SIMJA': item.nomorSimja || '-',\n      'Tanggal SIMJA': item.tanggalSimja || '-',\n      'Nomor SIKA': item.nomorSika || '-',\n      'Tanggal SIKA': item.tanggalSika || '-',\n      'Dokumen SIKA': item.dokumenSika || '-',\n      'Dokumen SIMJA': item.dokumenSimja || '-',\n      'Catatan': item.catatan || '-',\n      'Nama Penandatangan': item.signerName || '-',\n      'Jabatan Penandatangan': item.signerTitle || '-',\n      'QR Code': item.qrcode || '-',\n      'Daftar Pekerja': formatWorkerNames(item.namaPerkerjaText) || '-'\n    }));\n\n    // Create workbook\n    const wb = XLSX.utils.book_new();\n\n    // Add submissions sheet\n    const submissionsWs = XLSX.utils.json_to_sheet(submissionsData);\n    \n    // Set column widths for submissions\n    const submissionsColWidths = [\n      { wch: 5 },   // No\n      { wch: 15 },  // Nomor SIMLOK\n      { wch: 15 },  // Tanggal SIMLOK\n      { wch: 20 },  // ID Submission\n      { wch: 25 },  // Nomor Surat/Berdasarkan\n      { wch: 40 },  // Perihal/Pekerjaan\n      { wch: 25 },  // Tujuan/Lokasi Kerja\n      { wch: 25 },  // Tempat Pelaksanaan\n      { wch: 30 },  // Pelaksanaan\n      { wch: 15 },  // Jam Kerja\n      { wch: 30 },  // Sarana Kerja\n      { wch: 30 },  // Lain-lain\n      { wch: 15 },  // Status Approval\n      { wch: 25 },  // Nama Vendor/Petugas\n      { wch: 25 },  // Perusahaan Vendor\n      { wch: 25 },  // Email Vendor\n      { wch: 15 },  // Telepon Vendor\n      { wch: 15 },  // Tanggal Submit\n      { wch: 20 },  // Approved By\n      { wch: 12 },  // Total Pekerja\n      { wch: 15 },  // Nomor SIMJA\n      { wch: 15 },  // Tanggal SIMJA\n      { wch: 15 },  // Nomor SIKA\n      { wch: 15 },  // Tanggal SIKA\n      { wch: 20 },  // Dokumen SIKA\n      { wch: 20 },  // Dokumen SIMJA\n      { wch: 30 },  // Catatan\n      { wch: 25 },  // Nama Penandatangan\n      { wch: 25 },  // Jabatan Penandatangan\n      { wch: 15 },  // QR Code\n      { wch: 50 }   // Daftar Pekerja\n    ];\n    submissionsWs['!cols'] = submissionsColWidths;\n    \n    XLSX.utils.book_append_sheet(wb, submissionsWs, sheetName);\n\n    // Add workers detail sheet if there's worker data\n    const allWorkers: any[] = [];\n    filteredData.forEach((submission, _submissionIndex) => {\n      submission.daftarPekerja.forEach((worker, _workerIndex) => {\n        allWorkers.push({\n          'No': allWorkers.length + 1,\n          'ID Submission': submission.id,\n          'Nomor Surat': submission.nomorSurat,\n          'Vendor': submission.vendorName,\n          'Nama Lengkap': worker.namaLengkap,\n          'Foto Pekerja': worker.foto || '-',\n          // Note: Most detailed worker fields are not available in current schema\n        //   'NIK': worker.nik || '-',\n        //   'Tempat Lahir': worker.tempatLahir || '-',\n        //   'Tanggal Lahir': worker.tanggalLahir || '-',\n        //   'Jenis Kelamin': worker.jenisKelamin || '-',\n        //   'Agama': worker.agama || '-',\n        //   'Status Perkawinan': worker.statusPerkawinan || '-',\n        //   'Alamat': worker.alamat || '-',\n        //   'No Telepon': worker.noTelepon || '-',\n        //   'Email': worker.email || '-',\n        //   'Pendidikan Terakhir': worker.pendidikanTerakhir || '-',\n        //   'Jabatan': worker.jabatan || '-',\n        //   'Pengalaman': worker.pengalaman || '-',\n        //   'Keahlian Khusus': worker.keahlianKhusus || '-',\n        //   'Sertifikasi': worker.sertifikasi || '-',\n        //   'Catatan': worker.catatan || '-'\n        });\n      });\n    });\n\n    if (allWorkers.length > 0) {\n      const workersWs = XLSX.utils.json_to_sheet(allWorkers);\n      \n      // Set column widths for workers\n      const workersColWidths = [\n        { wch: 5 },   // No\n        { wch: 20 },  // ID Submission\n        { wch: 20 },  // Nomor Surat\n        { wch: 25 },  // Vendor\n        { wch: 25 },  // Nama Lengkap\n        { wch: 20 },  // Foto Pekerja\n        { wch: 20 },  // NIK\n        { wch: 15 },  // Tempat Lahir\n        { wch: 12 },  // Tanggal Lahir\n        { wch: 12 },  // Jenis Kelamin\n        { wch: 10 },  // Agama\n        { wch: 15 },  // Status Perkawinan\n        { wch: 40 },  // Alamat\n        { wch: 15 },  // No Telepon\n        { wch: 25 },  // Email\n        { wch: 20 },  // Pendidikan Terakhir\n        { wch: 20 },  // Jabatan\n        { wch: 30 },  // Pengalaman\n        { wch: 30 },  // Keahlian Khusus\n        { wch: 30 },  // Sertifikasi\n        { wch: 30 }   // Catatan\n      ];\n      workersWs['!cols'] = workersColWidths;\n      \n      XLSX.utils.book_append_sheet(wb, workersWs, 'Workers Detail');\n    }\n\n    // Add summary sheet\n    const summaryData = [\n      ['LAPORAN EXPORT SUBMISSIONS'],\n      [''],\n      ['Filter Tanggal:', dateFrom && dateTo ? `${formatDate(dateFrom)} - ${formatDate(dateTo)}` : \n        dateFrom ? `Dari: ${formatDate(dateFrom)}` : \n        dateTo ? `Sampai: ${formatDate(dateTo)}` : 'Semua Data'],\n      ['Total Submissions:', filteredData.length],\n      ['Total Pekerja:', allWorkers.length],\n      ['Export Time:', new Date().toLocaleString('id-ID')],\n      [''],\n      ['Status Summary:'],\n      ['APPROVED:', filteredData.filter(item => item.statusApproval === 'APPROVED').length],\n      ['PENDING:', filteredData.filter(item => item.statusApproval === 'PENDING').length],\n      ['REJECTED:', filteredData.filter(item => item.statusApproval === 'REJECTED').length]\n    ];\n    \n    const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);\n    XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');\n\n    // Write file\n    XLSX.writeFile(wb, filename);\n\n    return {\n      success: true,\n      message: `Data berhasil diexport ke ${filename}`,\n      totalData: filteredData.length\n    };\n\n  } catch (error) {\n    console.error('Error exporting to Excel:', error);\n    return {\n      success: false,\n      message: 'Gagal mengexport data ke Excel',\n      error: error instanceof Error ? error.message : 'Unknown error'\n    };\n  }\n};\n\n// Helper function to format date\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('id-ID', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  });\n};\n\n// Helper function to format worker names with bullet points\nconst formatWorkerNames = (namaPerkerjaText: string): string => {\n  if (!namaPerkerjaText) return '';\n  \n  const names = namaPerkerjaText\n    .split(/[\\n,]+/)\n    .map(name => name.trim())\n    .filter(name => name.length > 0);\n  \n  if (names.length === 0) return '';\n  \n  return names.map(name => `- ${name}`).join('\\n');\n};"
        },
        {
          "type": "file",
          "name": "fetchJson.ts",
          "content": "// src/lib/fetchJSON.ts\nexport async function fetchJSON<T>(\n  url: string,\n  init: RequestInit = {},\n  // tambahkan bust=true untuk mencegah cache antar-proxy\n  bust = true\n): Promise<T> {\n  const finalUrl = bust ? `${url}${url.includes(\"?\") ? \"&\" : \"?\"}t=${Date.now()}` : url;\n  const res = await fetch(finalUrl, {\n    cache: \"no-store\",\n    headers: { \"content-type\": \"application/json\", ...(init.headers || {}) },\n    ...init,\n  });\n  if (!res.ok) {\n    let msg = `Request failed: ${res.status}`;\n    try {\n      const j = await res.json();\n      msg = j?.error || msg;\n    } catch {}\n    throw new Error(msg);\n  }\n  return res.json() as Promise<T>;\n}\n"
        },
        {
          "type": "file",
          "name": "fileManager.ts",
          "content": "import { join } from 'path';\nimport { mkdir, rename, unlink, readdir, stat } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport crypto from 'crypto';\n\nexport interface FileInfo {\n  originalName: string;\n  newName: string;\n  path: string;\n  url: string;\n  size: number;\n  type: string;\n  category: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';\n}\n\nexport class FileManager {\n  private baseUploadDir: string;\n\n  constructor() {\n    this.baseUploadDir = join(process.cwd(), 'public', 'uploads');\n  }\n\n  /**\n   * Get organized folder structure for user files\n   */\n  private getUserFolderStructure(userId: string) {\n    const userBaseDir = join(this.baseUploadDir, userId);\n    return {\n      base: userBaseDir,\n      sika: join(userBaseDir, 'dokumen-sika'),\n      simja: join(userBaseDir, 'dokumen-simja'),\n      idCard: join(userBaseDir, 'id-card'),\n      other: join(userBaseDir, 'lainnya'),\n      workerPhoto: join(userBaseDir, 'foto-pekerja')\n    };\n  }\n\n  /**\n   * Determine file category based on field name or file content\n   */\n  private getFileCategory(fieldName?: string, fileName?: string): 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo' {\n    if (fieldName) {\n      if (fieldName.includes('sika')) return 'sika';\n      if (fieldName.includes('simja')) return 'simja';\n      if (fieldName.includes('worker') || fieldName.includes('pekerja')) return 'worker-photo';\n    }\n    \n    if (fileName) {\n      const lowerName = fileName.toLowerCase();\n      if (lowerName.includes('sika')) return 'sika';\n      if (lowerName.includes('simja')) return 'simja';\n      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';\n      if (lowerName.includes('worker') || lowerName.includes('pekerja') || lowerName.includes('foto')) return 'worker-photo';\n    }\n    \n    return 'other';\n  }\n\n  /**\n   * Generate a clean, descriptive filename\n   */\n  private generateFileName(originalName: string, category: string, _userId: string): string {\n    const timestamp = Date.now();\n    const randomString = crypto.randomBytes(4).toString('hex');\n    const extension = originalName.split('.').pop()?.toLowerCase() || '';\n    \n    // Clean original name\n    const cleanOriginalName = originalName\n      .replace(/\\.[^/.]+$/, '') // Remove extension\n      .replace(/[^a-zA-Z0-9\\-_]/g, '_') // Replace special chars\n      .substring(0, 30); // Limit length\n\n    // Create descriptive name based on category\n    const categoryPrefix = {\n      sika: 'SIKA',\n      simja: 'SIMJA', \n      other: 'Doc',\n      'worker-photo': 'Worker'\n    }[category] || 'Doc';\n\n    return `${categoryPrefix}_${timestamp}_${randomString}_${cleanOriginalName}.${extension}`;\n  }\n\n  /**\n   * Create all necessary directories\n   */\n  private async createDirectories(userId: string): Promise<void> {\n    const folders = this.getUserFolderStructure(userId);\n    \n    for (const folder of Object.values(folders)) {\n      if (!existsSync(folder)) {\n        await mkdir(folder, { recursive: true });\n      }\n    }\n  }\n\n  /**\n   * Save worker photo with worker's name as filename\n   */\n  async saveWorkerPhoto(\n    fileBuffer: Buffer,\n    originalName: string,\n    userId: string,\n    workerName: string\n  ): Promise<FileInfo> {\n    // Clean worker name for filename\n    const cleanWorkerName = workerName\n      .replace(/[^a-zA-Z0-9\\-_\\s]/g, '') // Remove special chars except space\n      .replace(/\\s+/g, '_') // Replace spaces with underscore\n      .substring(0, 50); // Limit length\n\n    // Get file extension\n    const extension = originalName.split('.').pop()?.toLowerCase() || 'jpg';\n    \n    // Generate filename with worker name\n    const timestamp = Date.now();\n    const newFileName = `${cleanWorkerName}_${timestamp}.${extension}`;\n    \n    // Create directories\n    await this.createDirectories(userId);\n    \n    // Get worker photo folder\n    const folders = this.getUserFolderStructure(userId);\n    const targetFolder = folders.workerPhoto;\n\n    // Save file\n    const filePath = join(targetFolder, newFileName);\n    const { writeFile } = await import('fs/promises');\n    await writeFile(filePath, fileBuffer);\n\n    // Get file stats\n    const stats = await stat(filePath);\n\n    return {\n      originalName,\n      newName: newFileName,\n      path: filePath,\n      url: `/api/files/${userId}/worker-photo/${newFileName}`,\n      size: stats.size,\n      type: this.getFileType(originalName),\n      category: 'worker-photo'\n    };\n  }\n\n  /**\n   * Save uploaded file with proper organization\n   */\n  async saveFile(\n    fileBuffer: Buffer,\n    originalName: string,\n    userId: string,\n    fieldName?: string\n  ): Promise<FileInfo> {\n    // Determine category and generate filename\n    const category = this.getFileCategory(fieldName, originalName);\n    const newFileName = this.generateFileName(originalName, category, userId);\n    \n    // Create directories\n    await this.createDirectories(userId);\n    \n    // Get target folder\n    const folders = this.getUserFolderStructure(userId);\n    const targetFolder = {\n      sika: folders.sika,\n      simja: folders.simja,\n      id_card: folders.idCard,\n      other: folders.other,\n      'worker-photo': folders.workerPhoto\n    }[category];\n\n    if (!targetFolder) {\n      throw new Error(`Invalid category: ${category}`);\n    }\n\n    // Save file\n    const filePath = join(targetFolder, newFileName);\n    const { writeFile } = await import('fs/promises');\n    await writeFile(filePath, fileBuffer);\n\n    // Get file stats\n    const stats = await stat(filePath);\n\n    return {\n      originalName,\n      newName: newFileName,\n      path: filePath,\n      url: `/api/files/${userId}/${category}/${newFileName}`,\n      size: stats.size,\n      type: this.getFileType(originalName),\n      category\n    };\n  }\n\n  /**\n   * Rename existing file\n   */\n  async renameFile(\n    userId: string,\n    oldFileName: string,\n    newName: string,\n    category?: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'\n  ): Promise<FileInfo | null> {\n    try {\n      const folders = this.getUserFolderStructure(userId);\n      \n      // Find the file in any category folder\n      let currentFilePath: string | null = null;\n      let currentCategory: string | null = null;\n\n      for (const [cat, folder] of Object.entries({\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      })) {\n        const testPath = join(folder, oldFileName);\n        if (existsSync(testPath)) {\n          currentFilePath = testPath;\n          currentCategory = cat;\n          break;\n        }\n      }\n\n      if (!currentFilePath || !currentCategory) {\n        throw new Error('File not found');\n      }\n\n      // Determine new category (use provided or keep current)\n      const targetCategory = category || currentCategory as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';\n      \n      // Generate new filename\n      const extension = oldFileName.split('.').pop()?.toLowerCase() || '';\n      const cleanNewName = newName.replace(/[^a-zA-Z0-9\\-_]/g, '_');\n      const timestamp = Date.now();\n      const randomString = crypto.randomBytes(4).toString('hex');\n      \n      const newFileName = `${targetCategory.toUpperCase()}_${timestamp}_${randomString}_${cleanNewName}.${extension}`;\n      \n      // Get target folder\n      const targetFolder = {\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      }[targetCategory];\n\n      if (!targetFolder) {\n        throw new Error(`Invalid target category: ${targetCategory}`);\n      }\n\n      const newFilePath = join(targetFolder, newFileName);\n\n      // Rename/move file\n      await rename(currentFilePath, newFilePath);\n\n      // Get file stats\n      const stats = await stat(newFilePath);\n\n      return {\n        originalName: oldFileName,\n        newName: newFileName,\n        path: newFilePath,\n        url: `/api/files/${userId}/${targetCategory}/${newFileName}`,\n        size: stats.size,\n        type: this.getFileType(newFileName),\n        category: targetCategory\n      };\n\n    } catch (error) {\n      console.error('Error renaming file:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Delete file\n   */\n  async deleteFile(userId: string, fileName: string): Promise<boolean> {\n    try {\n      const folders = this.getUserFolderStructure(userId);\n      \n      // Find and delete the file from any category folder\n      for (const folder of Object.values({\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      })) {\n        const filePath = join(folder, fileName);\n        if (existsSync(filePath)) {\n          await unlink(filePath);\n          return true;\n        }\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Error deleting file:', error);\n      return false;\n    }\n  }\n\n  /**\n   * List all files for a user\n   */\n  async listUserFiles(userId: string): Promise<{ [category: string]: FileInfo[] }> {\n    const folders = this.getUserFolderStructure(userId);\n    const result: { [category: string]: FileInfo[] } = {\n      sika: [],\n      simja: [],\n      id_card: [],\n      other: [],\n      'worker-photo': []\n    };\n\n    for (const [category, folder] of Object.entries({\n      sika: folders.sika,\n      simja: folders.simja,\n      id_card: folders.idCard,\n      other: folders.other,\n      'worker-photo': folders.workerPhoto\n    })) {\n      try {\n        if (existsSync(folder)) {\n          const files = await readdir(folder);\n          \n          for (const fileName of files) {\n            const filePath = join(folder, fileName);\n            const stats = await stat(filePath);\n            \n            if (result[category]) {\n              result[category].push({\n                originalName: fileName,\n                newName: fileName,\n                path: filePath,\n                url: `/api/files/${userId}/${category}/${fileName}`,\n                size: stats.size,\n                type: this.getFileType(fileName),\n                category: category as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'\n              });\n            }\n          }\n        }\n      } catch (error) {\n        console.error(`Error reading folder ${category}:`, error);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get file type from filename\n   */\n  private getFileType(filename: string): string {\n    const extension = filename.split('.').pop()?.toLowerCase();\n    \n    const types: { [key: string]: string } = {\n      pdf: 'application/pdf',\n      doc: 'application/msword',\n      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      jpg: 'image/jpeg',\n      jpeg: 'image/jpeg',\n      png: 'image/png',\n      gif: 'image/gif'\n    };\n\n    return types[extension || ''] || 'application/octet-stream';\n  }\n\n  /**\n   * Move existing files to organized structure (migration utility)\n   */\n  async migrateExistingFiles(userId: string): Promise<{ moved: number; errors: string[] }> {\n    const oldUserDir = join(this.baseUploadDir, userId);\n    const errors: string[] = [];\n    let moved = 0;\n\n    if (!existsSync(oldUserDir)) {\n      return { moved: 0, errors: ['User directory not found'] };\n    }\n\n    try {\n      // Create new organized structure\n      await this.createDirectories(userId);\n      \n      // Read files from old structure\n      const files = await readdir(oldUserDir);\n      \n      for (const fileName of files) {\n        const oldPath = join(oldUserDir, fileName);\n        const stats = await stat(oldPath);\n        \n        // Skip if it's a directory (already organized)\n        if (stats.isDirectory()) continue;\n        \n        try {\n          // Determine category from filename\n          const category = this.getFileCategory(undefined, fileName);\n          \n          // Get target folder\n          const folders = this.getUserFolderStructure(userId);\n          const targetFolder = {\n            sika: folders.sika,\n            simja: folders.simja,\n            id_card: folders.idCard,\n            other: folders.other,\n            'worker-photo': folders.workerPhoto\n          }[category];\n\n          if (!targetFolder) {\n            errors.push(`Invalid category ${category} for file ${fileName}`);\n            continue;\n          }\n\n          // Generate new organized filename\n          const newFileName = this.generateFileName(fileName, category, userId);\n          const newPath = join(targetFolder, newFileName);\n\n          // Move file\n          await rename(oldPath, newPath);\n          moved++;\n          \n        } catch (error) {\n          errors.push(`Failed to move ${fileName}: ${error}`);\n        }\n      }\n\n    } catch (error) {\n      errors.push(`Migration error: ${error}`);\n    }\n\n    return { moved, errors };\n  }\n}\n\n// Export singleton instance\nexport const fileManager = new FileManager();\n"
        },
        {
          "type": "file",
          "name": "fileUrlHelper.ts",
          "content": "/**\n * File URL utilities for handling legacy and new file URL formats\n */\n\nexport class FileUrlHelper {\n  /**\n   * Convert legacy file URL to new categorized format\n   * Legacy: /api/files/userId/filename\n   * New: /api/files/userId/category/filename\n   */\n  static convertLegacyUrl(url: string, fieldName?: string): string {\n    if (!url) return url;\n\n    // Check if it's already in new format (has category)\n    const urlParts = url.split('/');\n    if (urlParts.length >= 6) {\n      return url; // Already in new format\n    }\n\n    // Extract userId and filename from legacy format\n    const userId = urlParts[3];\n    const filename = urlParts[4];\n\n    if (!userId || !filename) {\n      return url; // Invalid URL, return as is\n    }\n\n    // Determine category from field name or filename\n    const category = this.getCategoryFromField(fieldName, filename);\n\n    return `/api/files/${userId}/${category}/${filename}`;\n  }\n\n  /**\n   * Determine file category from field name or filename\n   */\n  static getCategoryFromField(fieldName?: string, filename?: string): string {\n    if (fieldName) {\n      if (fieldName.includes('sika')) return 'sika';\n      if (fieldName.includes('simja')) return 'simja';\n    }\n    \n    if (filename) {\n      const lowerName = filename.toLowerCase();\n      if (lowerName.includes('sika')) return 'sika';\n      if (lowerName.includes('simja')) return 'simja';\n      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';\n    }\n    \n    return 'other';\n  }\n\n  /**\n   * Get display filename from full filename\n   */\n  static getDisplayFilename(filename: string): string {\n    if (!filename) return '';\n    \n    // Remove timestamp and random string prefix if present\n    // Format: CATEGORY_timestamp_random_originalname.ext\n    const parts = filename.split('_');\n    if (parts.length >= 4 && parts[0]?.match(/^(SIKA|SIMJA|DOC)$/i)) {\n      // Remove first 3 parts (category, timestamp, random)\n      return parts.slice(3).join('_');\n    }\n    \n    return filename;\n  }\n\n  /**\n   * Get file extension from filename\n   */\n  static getFileExtension(filename: string): string {\n    return filename.split('.').pop()?.toLowerCase() || '';\n  }\n\n  /**\n   * Check if file is an image\n   */\n  static isImage(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  }\n\n  /**\n   * Check if file is a PDF\n   */\n  static isPDF(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return extension === 'pdf';\n  }\n\n  /**\n   * Check if file is a document\n   */\n  static isDocument(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return ['doc', 'docx', 'pdf', 'txt', 'rtf'].includes(extension);\n  }\n\n  /**\n   * Get MIME type from filename\n   */\n  static getMimeType(filename: string): string {\n    const extension = this.getFileExtension(filename);\n    \n    const mimeTypes: { [key: string]: string } = {\n      pdf: 'application/pdf',\n      doc: 'application/msword',\n      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      jpg: 'image/jpeg',\n      jpeg: 'image/jpeg',\n      png: 'image/png',\n      gif: 'image/gif',\n      webp: 'image/webp',\n      txt: 'text/plain',\n      rtf: 'application/rtf'\n    };\n\n    return mimeTypes[extension] || 'application/octet-stream';\n  }\n\n  /**\n   * Format file size in human readable format\n   */\n  static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 B';\n    \n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n\n  /**\n   * Generate download filename for better user experience\n   */\n  static generateDownloadFilename(originalUrl: string, category: string, customName?: string): string {\n    if (customName) {\n      return customName;\n    }\n\n    const filename = originalUrl.split('/').pop() || 'download';\n    const extension = this.getFileExtension(filename);\n    \n    const categoryNames = {\n      sika: 'Dokumen_SIKA',\n      simja: 'Dokumen_SIMJA',\n      id_card: 'ID_Card',\n      other: 'Dokumen'\n    };\n\n    const prefix = categoryNames[category as keyof typeof categoryNames] || 'Dokumen';\n    const timestamp = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n    \n    return `${prefix}_${timestamp}.${extension}`;\n  }\n}\n\n// Export for easier imports\nexport const fileUrlHelper = FileUrlHelper;\n"
        },
        {
          "type": "file",
          "name": "notificationAudience.ts",
          "content": "// src/lib/notificationAudience.ts\nimport { NextRequest } from \"next/server\";\n\ntype Scope = \"admin\" | \"vendor\" | \"reviewer\" | \"approver\";\n\nexport type AudienceContext =\n  | { scope: Scope; readerKey: \"vendor\"; readerId: string }   // pakai NotificationRead.vendor_id\n  | { scope: Scope; readerKey: \"user\"; readerId: string };    // pakai NotificationRead.user_id\n\n/**\n * Tentukan scope dan pembaca (user/vendor) berdasarkan role & query.\n * - SUPER_ADMIN -> scope: 'admin' (readerKey: 'user')\n * - REVIEWER    -> scope: 'reviewer' (readerKey: 'user')\n * - APPROVER    -> scope: 'approver' (readerKey: 'user')\n * - VENDOR      -> scope: 'vendor' (readerKey: 'vendor')\n *\n * Catatan: untuk scope 'vendor', jika kamu menyimpan ID vendor berbeda dengan user.id,\n * kamu bisa kirimkan ?vendorId=xxx di query; fallback: session.user.id.\n */\nexport function resolveAudience(req: NextRequest, role: string, userId: string): AudienceContext {\n  const params = new URL(req.url).searchParams;\n  let scopeParam = (params.get(\"scope\") || \"\").toLowerCase() as Scope | \"\";\n  if (!scopeParam) {\n    scopeParam =\n      role === \"SUPER_ADMIN\" ? \"admin\" :\n      role === \"REVIEWER\"    ? \"reviewer\" :\n      role === \"APPROVER\"    ? \"approver\" :\n      \"vendor\";\n  }\n\n  if (scopeParam === \"vendor\") {\n    const vendorId = params.get(\"vendorId\") || userId; // sesuaikan kalau ID vendor ≠ userId\n    return { scope: \"vendor\", readerKey: \"vendor\", readerId: vendorId };\n  }\n  return { scope: scopeParam as Exclude<Scope, \"vendor\">, readerKey: \"user\", readerId: userId };\n}\n"
        },
        {
          "type": "file",
          "name": "notificationCleanup.ts",
          "content": "import { PrismaClient } from '@prisma/client';\nimport { notifyNotificationsRemoved } from '@/server/events';\n\nconst prisma = new PrismaClient();\n\n/**\n * Clean up notifications that reference deleted submissions\n * This function is used to maintain data integrity\n */\nexport async function cleanupOrphanedNotifications() {\n  try {\n    console.log('🧹 Starting cleanup of orphaned notifications...');\n    \n    // Find all notifications that reference submissions\n    const submissionNotifications = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: 'submissionId' } },\n          { data: { contains: 'submission_id' } },\n          { message: { contains: 'ID' } },\n          { title: { contains: 'ID' } }\n        ]\n      }\n    });\n    \n    const orphanedNotifications = [];\n    \n    // Check each notification\n    for (const notif of submissionNotifications) {\n      let submissionId = null;\n      \n      // Extract submission ID from data field\n      if (notif.data) {\n        try {\n          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;\n          submissionId = data.submissionId || data.submission_id;\n        } catch (e) {\n          // ignore parsing errors\n        }\n      }\n      \n      // Extract from message/title if not found in data\n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notif.message.match(idPattern);\n        const titleMatch = notif.title.match(idPattern);\n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n      }\n      \n      if (submissionId) {\n        // Check if submission exists\n        const submission = await prisma.submission.findUnique({\n          where: { id: submissionId }\n        });\n        \n        if (!submission) {\n          orphanedNotifications.push({\n            notification: notif,\n            submissionId: submissionId\n          });\n        }\n      }\n    }\n    \n    if (orphanedNotifications.length > 0) {\n      console.log(`Found ${orphanedNotifications.length} orphaned notifications to clean up`);\n      \n      // Delete orphaned notifications\n      for (const item of orphanedNotifications) {\n        // First delete NotificationRead records\n        await prisma.notificationRead.deleteMany({\n          where: { notification_id: item.notification.id }\n        });\n        \n        // Then delete the notification\n        await prisma.notification.delete({\n          where: { id: item.notification.id }\n        });\n        \n        console.log(`✅ Deleted orphaned notification ${item.notification.id} (${item.notification.type})`);\n      }\n      \n      console.log(`✅ Successfully cleaned up ${orphanedNotifications.length} orphaned notifications`);\n      return orphanedNotifications.length;\n    } else {\n      console.log('✅ No orphaned notifications found');\n      return 0;\n    }\n    \n  } catch (error) {\n    console.error('❌ Error during notification cleanup:', error);\n    throw error;\n  }\n}\n\n/**\n * Clean up notifications specifically for a deleted submission\n * This is called when a submission is deleted\n */\nexport async function cleanupSubmissionNotifications(submissionId: string) {\n  try {\n    console.log(`🧹 Cleaning up notifications for deleted submission: ${submissionId}`);\n    \n    // Find notifications that reference this specific submission\n    const notificationsToDelete = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: submissionId } },\n          { message: { contains: submissionId } },\n          { title: { contains: submissionId } }\n        ]\n      }\n    });\n    \n    console.log(`Found ${notificationsToDelete.length} notifications to delete for submission ${submissionId}`);\n    \n    // Delete NotificationRead records first (due to foreign key constraints)\n    for (const notification of notificationsToDelete) {\n      await prisma.notificationRead.deleteMany({\n        where: { notification_id: notification.id }\n      });\n    }\n    \n    // Delete the notifications\n    const deleteResult = await prisma.notification.deleteMany({\n      where: {\n        OR: [\n          { data: { contains: submissionId } },\n          { message: { contains: submissionId } },\n          { title: { contains: submissionId } }\n        ]\n      }\n    });\n    \n    console.log(`✅ Deleted ${deleteResult.count} notifications for submission ${submissionId}`);\n    \n    // Broadcast notification removal to all clients\n    await notifyNotificationsRemoved(submissionId);\n    \n    return deleteResult.count;\n    \n  } catch (error) {\n    console.error(`❌ Error cleaning notifications for submission ${submissionId}:`, error);\n    throw error;\n  }\n}\n"
        },
        {
          "type": "file",
          "name": "parseNumber.ts",
          "content": "export function numberToBahasa(n: number): string {\n    if (n === 0) return \"Nol\";\n\n    const satuan = [\n        \"\",\n        \"Satu\",\n        \"Dua\",\n        \"Tiga\",\n        \"Empat\",\n        \"Lima\",\n        \"Enam\",\n        \"Tujuh\",\n        \"Delapan\",\n        \"Sembilan\",\n        \"Sepuluh\",\n        \"Sebelas\",\n    ];\n\n    function toWords(x: number): string {\n        let str = \"\";\n        if (x < 12) {\n            str = satuan[x] ?? \"\";\n        } else if (x < 20) {\n            str = toWords(x - 10) + \" Belas\";\n        } else if (x < 100) {\n            str = toWords(Math.floor(x / 10)) + \" Puluh \" + toWords(x % 10);\n        } else if (x < 200) {\n            str = \"Seratus \" + toWords(x - 100);\n        } else if (x < 1000) {\n            str = toWords(Math.floor(x / 100)) + \" Ratus \" + toWords(x % 100);\n        } else if (x < 2000) {\n            str = \"Seribu \" + toWords(x - 1000);\n        } else if (x < 1_000_000) {\n            str = toWords(Math.floor(x / 1000)) + \" Ribu \" + toWords(x % 1000);\n        } else if (x < 1_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000)) + \" Juta \" + toWords(x % 1_000_000);\n        } else if (x < 1_000_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000_000)) + \" Miliar \" + toWords(x % 1_000_000_000);\n        } else if (x < 1_000_000_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000_000_000)) + \" Triliun \" + toWords(x % 1_000_000_000_000);\n        }\n        return str.trim();\n    }\n\n    return toWords(n).replace(/\\s+/g, \" \").trim();\n}"
        },
        {
          "type": "file",
          "name": "prisma.ts",
          "content": "/**\n * Legacy Prisma Client - Deprecated\n * Use prisma from @/lib/singletons instead\n */\n\nexport { prisma } from './singletons';\n"
        },
        {
          "type": "file",
          "name": "qr-security.ts",
          "content": "import crypto from 'crypto';\n\n// Salt untuk hashing - harus disimpan secure\nconst QR_SALT = process.env.QR_SECURITY_SALT || 'default-salt-change-in-production';\n\nexport interface QrPayload {\n  id: string;\n  start_date: string | null;\n  end_date: string | null;\n  timestamp: number;\n}\n\nexport interface SimpleQrData {\n  i: string;           // submission ID (shortened key)\n  e: number;          // Expiration timestamp (shortened key)\n  s: string;          // Short signature for verification (shortened key)\n}\n\n/**\n * Generate simple QR code data with minimal information\n */\nexport function generateSimpleQrData(submission: {\n  id: string;\n  implementation_start_date?: string | Date | null;\n  implementation_end_date?: string | Date | null;\n}): SimpleQrData {\n  // Use only submission ID and expiration\n  const expiration = Date.now() + (24 * 60 * 60 * 1000); // 24 hours from now\n  \n  // Create a signature using only essential data\n  const signatureData = `${submission.id}|${expiration}|${QR_SALT}`;\n  const fullHash = crypto.createHash('sha256').update(signatureData).digest('hex');\n  \n  // Use first 32 characters of hash for improved security\n  const signature = fullHash.substring(0, 32);\n\n  return {\n    i: submission.id,    // shortened key names for smaller JSON\n    e: expiration,\n    s: signature\n  };\n}\n\n/**\n * Verify simple QR data\n */\nexport function verifySimpleQrData(qrData: SimpleQrData): boolean {\n  try {\n    // Check expiration\n    if (Date.now() > qrData.e) {\n      console.error('QR code has expired');\n      return false;\n    }\n\n    // Verify signature\n    const signatureData = `${qrData.i}|${qrData.e}|${QR_SALT}`;\n    const expectedHash = crypto.createHash('sha256').update(signatureData).digest('hex');\n    const expectedSignature = expectedHash.substring(0, 32);\n\n    if (expectedSignature !== qrData.s) {\n      console.error('QR signature verification failed');\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error('QR verification failed:', error);\n    return false;\n  }\n}\n\n/**\n * Generate QR code string that can be encoded to QR image (ULTRA SIMPLIFIED)\n */\nexport function generateQrString(submission: {\n  id: string;\n  implementation_start_date?: string | Date | null;\n  implementation_end_date?: string | Date | null;\n}): string {\n  const qrData = generateSimpleQrData(submission);\n  \n  // Create extremely compact QR string - no JSON, direct concatenation\n  // Format: SL:submissionId:expiration:signature\n  return `SL:${qrData.i}:${qrData.e}:${qrData.s}`;\n}\n\n/**\n * Parse QR string and verify it (ULTRA SIMPLIFIED)\n */\nexport function parseQrString(qrString: string): QrPayload | null {\n  try {\n    // Check if it's just a submission ID (legacy format or manual QR)\n    if (!qrString.includes(':') && !qrString.includes('|')) {\n      // This might be a raw submission ID - attempt to handle gracefully\n      if (qrString.length > 20 && qrString.match(/^[a-zA-Z0-9]+$/)) {\n        console.warn('QR code appears to be a raw submission ID (unsecure format):', qrString);\n        // Return a basic payload with just the ID for backward compatibility\n        return {\n          id: qrString,\n          start_date: null,\n          end_date: null,\n          timestamp: Date.now() // Current time as timestamp\n        };\n      }\n    }\n    \n    // Handle old base64 format for backward compatibility\n    if (qrString.includes('|')) {\n      const parts = qrString.split('|');\n      \n      if (parts.length !== 2 || parts[0] !== 'SL') {\n        console.error('Invalid QR format. Expected \"SL|base64data\", got:', qrString);\n        throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');\n      }\n\n      const base64Part = parts[1];\n      if (!base64Part) {\n        throw new Error('Missing QR data');\n      }\n\n      // Decode base64 data\n      const dataString = Buffer.from(base64Part, 'base64').toString('utf8');\n      const qrData: any = JSON.parse(dataString);\n      \n      // Handle old format with full keys\n      const normalizedData: SimpleQrData = {\n        i: qrData.id || qrData.i,\n        e: qrData.exp || qrData.e, \n        s: qrData.sig || qrData.s\n      };\n      \n      if (!normalizedData.i || !normalizedData.e || !normalizedData.s) {\n        throw new Error('Invalid QR data structure');\n      }\n\n      // Verify the QR data\n      if (!verifySimpleQrData(normalizedData)) {\n        throw new Error('QR verification failed');\n      }\n\n      // Convert to QrPayload format for compatibility\n      const payload: QrPayload = {\n        id: normalizedData.i,\n        start_date: null,\n        end_date: null,\n        timestamp: normalizedData.e - (24 * 60 * 60 * 1000)\n      };\n\n      return payload;\n    }\n    \n    // Handle new colon-separated format: SL:submissionId:expiration:signature\n    const parts = qrString.split(':');\n    \n    if (parts.length !== 4 || parts[0] !== 'SL') {\n      console.error('Invalid QR format. Expected \"SL:id:exp:sig\", got:', qrString);\n      throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');\n    }\n\n    const [, submissionId, expirationStr, signature] = parts;\n    \n    if (!submissionId || !expirationStr || !signature) {\n      throw new Error('Missing QR data components');\n    }\n\n    const expiration = parseInt(expirationStr, 10);\n    if (isNaN(expiration)) {\n      throw new Error('Invalid expiration timestamp');\n    }\n\n    const qrData: SimpleQrData = {\n      i: submissionId,\n      e: expiration,\n      s: signature\n    };\n\n    // Verify the QR data\n    if (!verifySimpleQrData(qrData)) {\n      throw new Error('QR verification failed');\n    }\n\n    // Convert to QrPayload format for compatibility\n    const payload: QrPayload = {\n      id: qrData.i,\n      start_date: null, // We don't store dates in simple QR anymore\n      end_date: null,\n      timestamp: qrData.e - (24 * 60 * 60 * 1000) // Calculate original timestamp\n    };\n\n    return payload;\n  } catch (error) {\n    console.error('QR parsing failed:', error);\n    return null;\n  }\n}\n\n/**\n * Check if a QR payload is valid for the current date\n */\nexport function isQrValidForDate(payload: QrPayload, checkDate: Date = new Date()): boolean {\n  const startDate = payload.start_date ? new Date(payload.start_date) : null;\n  const endDate = payload.end_date ? new Date(payload.end_date) : null;\n\n  // If no implementation dates are set, QR is considered valid\n  if (!startDate && !endDate) {\n    return true;\n  }\n\n  // Check if current date is within implementation period\n  const now = checkDate.getTime();\n  \n  if (startDate && now < startDate.getTime()) {\n    return false; // Too early\n  }\n  \n  if (endDate && now > endDate.getTime()) {\n    return false; // Too late\n  }\n\n  return true;\n}\n"
        },
        {
          "type": "file",
          "name": "redis.ts",
          "content": "import Redis from 'ioredis';\n\ndeclare global {\n  var __redis_pub: Redis | undefined;\n  var __redis_sub: Redis | undefined;\n}\n\nlet pubClient: Redis;\nlet subClient: Redis;\n\nif (process.env.NODE_ENV === 'production') {\n  pubClient = new Redis(process.env.REDIS_URL!);\n  subClient = new Redis(process.env.REDIS_URL!);\n} else {\n  // In development, use globalThis to persist connections across hot reloads\n  if (!globalThis.__redis_pub) {\n    globalThis.__redis_pub = new Redis(process.env.REDIS_URL!);\n  }\n  if (!globalThis.__redis_sub) {\n    globalThis.__redis_sub = new Redis(process.env.REDIS_URL!);\n  }\n  \n  pubClient = globalThis.__redis_pub;\n  subClient = globalThis.__redis_sub;\n}\n\n// Error handling\npubClient.on('error', (err) => {\n  console.error('Redis pub client error:', err);\n});\n\nsubClient.on('error', (err) => {\n  console.error('Redis sub client error:', err);\n});\n\npubClient.on('connect', () => {\n  console.log('Redis pub client connected');\n});\n\nsubClient.on('connect', () => {\n  console.log('Redis sub client connected');\n});\n\nexport { pubClient, subClient };\n"
        },
        {
          "type": "file",
          "name": "session-cleanup.ts",
          "content": "import { prisma } from '@/lib/singletons';\n\nasync function cleanupExpiredSessions() {\n  const now = new Date();\n  \n  try {\n    // Cleanup expired refresh tokens\n    await prisma.refreshToken.deleteMany({\n      where: {\n        expiresAt: { lt: now }\n      }\n    });\n\n    // Cleanup expired sessions\n    await prisma.session.deleteMany({\n      where: {\n        expires: { lt: now }\n      }\n    });\n\n    console.log('Cleaned up expired sessions and tokens at:', now);\n  } catch (error) {\n    console.error('Error cleaning up expired sessions:', error);\n  }\n}\n\n// Run cleanup every hour\nsetInterval(cleanupExpiredSessions, 60 * 60 * 1000);\n\n// Export for manual triggers if needed\nexport { cleanupExpiredSessions };"
        },
        {
          "type": "file",
          "name": "singletons.ts",
          "content": "/**\n * Singletons for Prisma, Redis, and Socket.IO Server\n * Safe for Hot Module Replacement in development\n */\n\nimport { PrismaClient } from '@prisma/client';\nimport Redis from 'ioredis';\nimport { Server as SocketIOServer } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n  var __redis_pub: Redis | undefined;\n  var __redis_sub: Redis | undefined;\n  var __socket_io: SocketIOServer | undefined;\n}\n\n/**\n * Prisma Singleton\n */\nexport const prisma = globalThis.__prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n});\n\nif (process.env.NODE_ENV !== 'production') {\n  globalThis.__prisma = prisma;\n}\n\n/**\n * Redis Clients Singleton\n */\nfunction createRedisClient(prefix = ''): Redis {\n  const redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';\n  \n  const client = new Redis(redisUrl, {\n    lazyConnect: true,\n    enableReadyCheck: false,\n    maxRetriesPerRequest: null,\n    ...(prefix && { keyPrefix: `${prefix}:` }),\n  });\n\n  client.on('error', (err) => {\n    console.warn(`Redis client error (${prefix || 'default'}):`, err.message);\n  });\n\n  client.on('connect', () => {\n    console.log(`Redis client connected (${prefix || 'default'})`);\n  });\n\n  return client;\n}\n\nexport const redisPub = globalThis.__redis_pub ?? createRedisClient('pub');\nexport const redisSub = globalThis.__redis_sub ?? createRedisClient('sub');\n\nif (process.env.NODE_ENV !== 'production') {\n  globalThis.__redis_pub = redisPub;\n  globalThis.__redis_sub = redisSub;\n}\n\n/**\n * Socket.IO Server Singleton\n * Will be initialized when HTTP server is available\n */\nexport function getSocketIO(): SocketIOServer | null {\n  return globalThis.__socket_io || null;\n}\n\nexport function setSocketIO(io: SocketIOServer): void {\n  globalThis.__socket_io = io;\n}\n\n/**\n * Initialize Socket.IO with Redis adapter\n */\nexport function initializeSocketIO(httpServer: any): SocketIOServer {\n  if (globalThis.__socket_io) {\n    return globalThis.__socket_io;\n  }\n\n  const io = new SocketIOServer(httpServer, {\n    path: '/api/socket',\n    addTrailingSlash: false,\n    cors: {\n      origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n      methods: ['GET', 'POST'],\n    },\n    transports: ['websocket', 'polling'],\n  });\n\n  // Setup Redis adapter\n  try {\n    io.adapter(createAdapter(redisPub, redisSub));\n    console.log('Socket.IO Redis adapter initialized');\n  } catch (error) {\n    console.warn('Socket.IO Redis adapter failed, using memory adapter:', error);\n  }\n\n  setSocketIO(io);\n  return io;\n}\n"
        },
        {
          "type": "file",
          "name": "utils.ts",
          "content": "import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/**\n * Utility function to merge Tailwind CSS classes\n * Handles conflicts and ensures proper class precedence\n */\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n/**\n * Format date to Indonesian locale\n */\nexport function formatDate(\n  date: Date | string | null,\n  options: Intl.DateTimeFormatOptions = {}\n): string {\n  if (!date) return '-';\n  \n  const dateObject = typeof date === 'string' ? new Date(date) : date;\n  \n  const defaultOptions: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    ...options,\n  };\n  \n  return dateObject.toLocaleDateString('id-ID', defaultOptions);\n}\n\n/**\n * Format date to ISO string for input fields\n */\nexport function formatDateForInput(date: Date | string | null): string {\n  if (!date) return '';\n  \n  const dateObject = typeof date === 'string' ? new Date(date) : date;\n  return dateObject.toISOString().split('T')[0]!;\n}\n\n/**\n * Format currency to Indonesian Rupiah\n */\nexport function formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('id-ID', {\n    style: 'currency',\n    currency: 'IDR',\n    minimumFractionDigits: 0,\n  }).format(amount);\n}\n\n/**\n * Format file size in human readable format\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  \n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  \n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n}\n\n/**\n * Capitalize first letter of each word\n */\nexport function capitalize(str: string): string {\n  return str.replace(/\\w\\S*/g, txt => \n    txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n  );\n}\n\n/**\n * API response helpers for server actions and services\n */\nexport const actionResponse = {\n  success: <T>(data: T, message?: string) => ({\n    success: true as const,\n    data,\n    message,\n    error: null,\n  }),\n  \n  error: (message: string, error?: any) => {\n    console.error('Action Error:', message, error);\n    return {\n      success: false as const,\n      data: null,\n      message,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  },\n};\n\nexport const serviceResponse = {\n  success: <T>(data: T, message?: string) => ({\n    success: true as const,\n    data,\n    message,\n    error: null,\n  }),\n  \n  error: (message: string, error?: any) => {\n    console.error('Service Error:', message, error);\n    return {\n      success: false as const,\n      data: null,\n      message,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  },\n};\n\n/**\n * Generate a random string of specified length\n */\nexport function generateRandomString(length: number = 8): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n/**\n * Debounce function to limit function calls\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: NodeJS.Timeout;\n  \n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n}\n\n/**\n * Deep clone an object\n */\nexport function deepClone<T>(obj: T): T {\n  if (obj === null || typeof obj !== 'object') return obj;\n  if (obj instanceof Date) return new Date(obj.getTime()) as unknown as T;\n  if (obj instanceof Array) return obj.map(item => deepClone(item)) as unknown as T;\n  if (typeof obj === 'object') {\n    const cloned = {} as T;\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        cloned[key] = deepClone(obj[key]);\n      }\n    }\n    return cloned;\n  }\n  return obj;\n}\n\n/**\n * Sleep function for async operations\n */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Safe JSON parse with fallback\n */\nexport function safeJsonParse<T>(json: string, fallback: T): T {\n  try {\n    return JSON.parse(json) as T;\n  } catch {\n    return fallback;\n  }\n}\n\n/**\n * Check if value is empty (null, undefined, empty string, empty array, empty object)\n */\nexport function isEmpty(value: unknown): boolean {\n  if (value === null || value === undefined) return true;\n  if (typeof value === 'string') return value.trim().length === 0;\n  if (Array.isArray(value)) return value.length === 0;\n  if (typeof value === 'object') return Object.keys(value).length === 0;\n  return false;\n}\n\n/**\n * Create URL with query parameters\n */\nexport function createUrl(baseUrl: string, params: Record<string, string | number | boolean | null | undefined>): string {\n  const url = new URL(baseUrl, typeof window !== 'undefined' ? window.location.origin : 'http://localhost:3000');\n  \n  Object.entries(params).forEach(([key, value]) => {\n    if (value !== null && value !== undefined) {\n      url.searchParams.set(key, String(value));\n    }\n  });\n  \n  return url.toString();\n}\n\n/**\n * Extract initials from full name\n */\nexport function getInitials(name: string, maxLength: number = 2): string {\n  return name\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase())\n    .slice(0, maxLength)\n    .join('');\n}\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "middleware",
      "children": [
        {
          "type": "file",
          "name": "SessionValidation.ts",
          "content": "/**\n * Session Validation Middleware\n * Auto-logout when session ID doesn't exist in database\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getToken } from 'next-auth/jwt';\nimport { prisma } from '@/lib/prisma';\n\ninterface SessionValidationResult {\n  isValid: boolean;\n  userId?: string;\n  sessionExpired?: boolean;\n  shouldLogout?: boolean;\n  reason?: string;\n}\n\nexport class SessionValidationService {\n  private static readonly EXCLUDED_PATHS = [\n    '/api/auth',\n    '/api/health',\n    '/login',\n    '/register',\n    '/_next',\n    '/favicon.ico',\n  ];\n\n  /**\n   * Validate session against database\n   */\n  static async validateSession(request: NextRequest): Promise<SessionValidationResult> {\n    try {\n      // Get token from NextAuth\n      const token = await getToken({ \n        req: request,\n        secret: process.env.NEXTAUTH_SECRET || 'fallback-secret'\n      });\n\n      if (!token || !token.sub) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'No valid token found',\n        };\n      }\n\n      const userId = token.sub;\n\n      // Check if user exists in database\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: {\n          id: true,\n          isActive: true,\n          verified_at: true,\n          lastActiveAt: true,\n          sessionExpiry: true,\n        },\n      });\n\n      if (!user) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User not found in database',\n        };\n      }\n\n      if (!user.isActive) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User account is deactivated',\n        };\n      }\n\n      if (!user.verified_at) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User account is not verified',\n        };\n      }\n\n      // Check session expiry if set\n      if (user.sessionExpiry && new Date() > user.sessionExpiry) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          sessionExpired: true,\n          reason: 'Session has expired',\n        };\n      }\n\n      // Update last active timestamp\n      await prisma.user.update({\n        where: { id: userId },\n        data: { lastActiveAt: new Date() },\n      });\n\n      return {\n        isValid: true,\n        userId: userId,\n      };\n\n    } catch (error) {\n      console.error('Session validation error:', error);\n      return {\n        isValid: false,\n        shouldLogout: true,\n        reason: 'Session validation failed',\n      };\n    }\n  }\n\n  /**\n   * Check if path should be excluded from session validation\n   */\n  static shouldExcludePath(pathname: string): boolean {\n    return this.EXCLUDED_PATHS.some(path => pathname.startsWith(path));\n  }\n\n  /**\n   * Create logout response with proper cleanup\n   */\n  static createLogoutResponse(request: NextRequest, reason?: string): NextResponse {\n    const response = NextResponse.redirect(new URL('/login', request.url));\n    \n    // Clear NextAuth cookies\n    response.cookies.delete('next-auth.session-token');\n    response.cookies.delete('__Secure-next-auth.session-token');\n    response.cookies.delete('next-auth.csrf-token');\n    response.cookies.delete('__Host-next-auth.csrf-token');\n    response.cookies.delete('next-auth.callback-url');\n    response.cookies.delete('__Secure-next-auth.callback-url');\n\n    // Add logout reason as query parameter\n    if (reason) {\n      const url = new URL('/login', request.url);\n      url.searchParams.set('logout_reason', encodeURIComponent(reason));\n      return NextResponse.redirect(url);\n    }\n\n    return response;\n  }\n\n  /**\n   * Middleware function for automatic session validation\n   */\n  static async middleware(request: NextRequest): Promise<NextResponse> {\n    const { pathname } = request.nextUrl;\n\n    // Skip validation for excluded paths\n    if (this.shouldExcludePath(pathname)) {\n      return NextResponse.next();\n    }\n\n    // Validate session\n    const validation = await this.validateSession(request);\n\n    if (!validation.isValid && validation.shouldLogout) {\n      console.log(`Auto-logout triggered: ${validation.reason}`);\n      return this.createLogoutResponse(request, validation.reason);\n    }\n\n    // Add user ID to request headers for downstream use\n    if (validation.userId) {\n      const requestHeaders = new Headers(request.headers);\n      requestHeaders.set('x-user-id', validation.userId);\n      \n      return NextResponse.next({\n        request: {\n          headers: requestHeaders,\n        },\n      });\n    }\n\n    return NextResponse.next();\n  }\n\n  /**\n   * Force logout user by clearing their session\n   */\n  static async forceLogout(userId: string, reason: string = 'Admin action'): Promise<void> {\n    try {\n      \n      // Update user session expiry to force logout\n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          sessionExpiry: new Date(), // Set to current time to expire immediately\n        },\n      });\n\n      console.log(`Force logout applied to user ${userId}: ${reason}`);\n    } catch (error) {\n      console.error('Force logout error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Extend user session\n   */\n  static async extendSession(\n    userId: string, \n    extensionMinutes: number = 60\n  ): Promise<void> {\n    try {\n      const newExpiry = new Date(Date.now() + extensionMinutes * 60 * 1000);\n      \n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          sessionExpiry: newExpiry,\n        },\n      });\n\n      console.log(`Session extended for user ${userId} until ${newExpiry.toISOString()}`);\n    } catch (error) {\n      console.error('Session extension error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check if session is about to expire (within warning threshold)\n   */\n  static async checkSessionExpiry(userId: string): Promise<{\n    isExpiring: boolean;\n    minutesRemaining?: number;\n    expiryTime?: Date;\n  }> {\n    try {\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { sessionExpiry: true },\n      });\n\n      if (!user?.sessionExpiry) {\n        return { isExpiring: false };\n      }\n\n      const now = new Date();\n      const expiry = user.sessionExpiry;\n      const minutesRemaining = Math.floor((expiry.getTime() - now.getTime()) / (60 * 1000));\n\n      // Warn if session expires within 10 minutes\n      const isExpiring = minutesRemaining <= 10 && minutesRemaining > 0;\n\n      return {\n        isExpiring,\n        minutesRemaining: Math.max(0, minutesRemaining),\n        expiryTime: expiry,\n      };\n    } catch (error) {\n      console.error('Session expiry check error:', error);\n      return { isExpiring: false };\n    }\n  }\n\n  /**\n   * Get active sessions count for admin dashboard\n   */\n  static async getActiveSessionsCount(): Promise<number> {\n    try {\n      const fifteenMinutesAgo = new Date(Date.now() - 15 * 60 * 1000);\n      \n      const count = await prisma.user.count({\n        where: {\n          isActive: true,\n          lastActiveAt: {\n            gte: fifteenMinutesAgo,\n          },\n        },\n      });\n\n      return count;\n    } catch (error) {\n      console.error('Active sessions count error:', error);\n      return 0;\n    }\n  }\n}\n\n/**\n * API Route helper for session validation\n */\nexport async function validateApiSession(request: NextRequest): Promise<{\n  isValid: boolean;\n  userId?: string;\n  error?: string;\n}> {\n  const validation = await SessionValidationService.validateSession(request);\n  \n  if (!validation.isValid) {\n    return {\n      isValid: false,\n      error: validation.reason || 'Session invalid',\n    };\n  }\n\n  return {\n    isValid: true,\n    userId: validation.userId!,\n  };\n}\n\n/**\n * HOC for protecting API routes with session validation\n */\nexport function withSessionValidation(\n  handler: (request: NextRequest, context: any) => Promise<NextResponse>\n) {\n  return async (request: NextRequest, context: any): Promise<NextResponse> => {\n    const validation = await validateApiSession(request);\n    \n    if (!validation.isValid) {\n      return NextResponse.json(\n        { \n          error: 'Session invalid', \n          message: validation.error,\n          shouldLogout: true \n        },\n        { status: 401 }\n      );\n    }\n\n    // Add user ID to request for handler use\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set('x-user-id', validation.userId!);\n    \n    const enhancedRequest = new NextRequest(request.url, {\n      ...request,\n      headers: requestHeaders,\n    });\n\n    return handler(enhancedRequest, context);\n  };\n}"
        }
      ]
    },
    {
      "type": "directory",
      "name": "providers",
      "children": [
        {
          "type": "file",
          "name": "AppProvider.tsx",
          "content": "\"use client\";\n\nimport { SessionProvider } from \"next-auth/react\";\nimport { ThemeProvider } from \"@/context/ThemeContext\";\n// import SessionExpiryHandler from \"@/components/security/SessionExpiryHandler\";\nimport ToastContainer from \"@/components/ui/toast/ToastContainer\";\nimport { SocketProvider } from \"@/app/socket-provider\";\nimport { ReactNode } from \"react\";\n\nexport default function AppProviders({ children }: { children: ReactNode }) {\n  return (\n    <SessionProvider>\n      <ThemeProvider>\n        <SocketProvider>\n          {/* <SessionExpiryHandler> */}\n            {children}\n            <ToastContainer />\n          {/* </SessionExpiryHandler> */}\n        </SocketProvider>\n      </ThemeProvider>\n    </SessionProvider>\n  );\n}"
        }
      ]
    },
    {
      "type": "directory",
      "name": "server",
      "children": [
        {
          "type": "file",
          "name": "events.ts",
          "content": "import { prisma } from '@/lib/singletons';\nimport { eventsPublisher } from './eventsPublisher';\nimport { notificationsPublisher } from './notificationsPublisher';\nimport type {\n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent\n} from '../shared/events';// Helper to count unread notifications\nasync function getUnreadCount(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId?: string): Promise<number> {\n  if (scope === 'admin') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'admin',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'reviewer') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'reviewer',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'approver') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'approver',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'vendor' && vendorId) {\n    return await prisma.notification.count({\n      where: {\n        scope: 'vendor',\n        vendor_id: vendorId,\n        reads: {\n          none: {\n            vendor_id: vendorId\n          }\n        }\n      }\n    });\n  }\n  \n  return 0;\n}\n\nexport async function notifyAdminNewSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { user: true }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        type: 'new_submission',\n        title: 'Pengajuan Simlok Baru',\n        message: `Pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name}`,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name\n        })\n      }\n    });\n\n    // Emit events\n    const submissionEvent: AdminNewSubmissionEvent = {\n      submissionId,\n      createdAt: submission.created_at.toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'admin',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.adminNewSubmission(submissionEvent);\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count\n    const unreadCount = await getUnreadCount('admin');\n    const unreadCountEvent = {\n      scope: 'admin' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update stats\n    const totalPending = await prisma.submission.count({\n      where: { approval_status: 'PENDING' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'admin',\n      changes: {\n        pendingSubmissions: totalPending,\n        totalSubmissions: await prisma.submission.count()\n      }\n    });\n\n    // Also notify reviewers about new submission\n    await notifyReviewerNewSubmission(submissionId);\n\n    // Emit submission created event to reviewers\n    eventsPublisher.submissionCreated({\n      submissionId,\n      vendorName: submission.vendor_name,\n      officerName: submission.officer_name,\n      createdAt: submission.created_at.toISOString()\n    });\n\n  } catch (error) {\n    console.error('Error notifying admin new submission:', error);\n  }\n}\n\nexport async function notifyAdminNewVendor(vendorId: string) {\n  try {\n    // Get vendor details\n    const vendor = await prisma.user.findUnique({\n      where: { id: vendorId }\n    });\n\n    if (!vendor) {\n      throw new Error('Vendor not found');\n    }\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        type: 'new_vendor',\n        title: 'Pendaftaran Vendor Baru',\n        message: `Vendor baru mendaftar: ${vendor.vendor_name || vendor.officer_name}`,\n        data: JSON.stringify({\n          vendorId,\n          vendorName: vendor.vendor_name,\n          officerName: vendor.officer_name,\n          email: vendor.email\n        })\n      }\n    });\n\n    // Emit events\n    const vendorEvent: AdminNewVendorEvent = {\n      vendorId,\n      createdAt: vendor.created_at.toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'admin',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.adminNewVendor(vendorEvent);\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count\n    const unreadCount = await getUnreadCount('admin');\n    const unreadCountEvent = {\n      scope: 'admin' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update stats\n    const totalVendors = await prisma.user.count({\n      where: { role: 'VENDOR' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'admin',\n      changes: {\n        totalVendors\n      }\n    });\n\n  } catch (error) {\n    console.error('Error notifying admin new vendor:', error);\n  }\n}\n\nexport async function notifyVendorStatusChange(\n  vendorId: string, \n  submissionId: string, \n  status: 'PENDING' | 'APPROVED' | 'REJECTED'\n) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    const statusText = {\n      PENDING: 'Menunggu Persetujuan',\n      APPROVED: 'Disetujui',\n      REJECTED: 'Ditolak'\n    }[status];\n\n    // Truncate job description if too long\n    // const truncateText = (text: string, maxLength: number = 50) => {\n    //   return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n    // };\n\n    // const truncatedJobDescription = truncateText(submission.job_description);\n\n    // Create more informative title and message with submission ID\n    const title = status === 'APPROVED' \n      ? `Pengajuan Disetujui` \n      : status === 'REJECTED' \n        ? `Pengajuan Ditolak`\n        : `Pengajuan ${statusText}`;\n\n    const message = status === 'APPROVED'\n      ? `Selamat! Pengajuan Simlok Anda telah disetujui.`\n      : status === 'REJECTED'\n        ? `Pengajuan Simlok Anda ditolak. Silakan periksa keterangan pada pengajuan.`\n        : `Status pengajuan Simlok Anda berubah menjadi ${statusText.toLowerCase()}.`;\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'vendor',\n        vendor_id: vendorId,\n        type: 'status_change',\n        title: title,\n        message: message,\n        data: JSON.stringify({\n          submissionId,\n          status,\n          jobDescription: submission.job_description\n        })\n      }\n    });\n\n    // Emit events\n    const statusEvent: VendorSubmissionStatusChangedEvent = {\n      submissionId,\n      status,\n      updatedAt: new Date().toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'vendor',\n      vendorId,\n      createdAt: notification.created_at.toISOString()\n    };\n\n  eventsPublisher.vendorSubmissionStatusChanged(vendorId, statusEvent);\n  eventsPublisher.notificationNew(notificationEvent);\n  \n  // Emit specific submission finalized event\n  eventsPublisher.submissionFinalized(vendorId, {\n    submissionId,\n    finalStatus: status,\n    finalizedBy: 'Approver', // You might want to pass actual approver name\n    finalizedAt: new Date().toISOString()\n  });\n  \n  // Publish to real-time subscribers via Redis\n  await notificationsPublisher.publishNotification(notificationEvent);\n\n  // Update unread count\n  const unreadCount = await getUnreadCount('vendor', vendorId);\n  const unreadCountEvent = {\n    scope: 'vendor' as const,\n    vendorId,\n    unreadCount: unreadCount,\n    count: unreadCount\n  };\n  eventsPublisher.notificationUnreadCount(unreadCountEvent);\n  await notificationsPublisher.publishUnreadCount(unreadCountEvent);    // Update vendor stats\n    const vendorSubmissions = await prisma.submission.findMany({\n      where: { user_id: vendorId }\n    });\n\n    const stats = {\n      totalSubmissions: vendorSubmissions.length,\n      pendingSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'PENDING').length,\n      approvedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'APPROVED').length,\n      rejectedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'REJECTED').length\n    };\n\n    eventsPublisher.statsUpdate({\n      scope: 'vendor',\n      vendorId,\n      changes: stats\n    });\n\n  } catch (error) {\n    console.error('Error notifying vendor status change:', error);\n  }\n}\n\nexport async function notifyNotificationsRemoved(submissionId: string) {\n  try {\n    console.log(`Broadcasting notification removal for submission: ${submissionId}`);\n\n    // Create event for notification removal\n    const notificationRemovalEvent = {\n      submissionId,\n      timestamp: new Date().toISOString()\n    };\n\n    // Emit to Socket.io clients\n    eventsPublisher.notificationRemoved(notificationRemovalEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotificationRemoval(notificationRemovalEvent);\n\n    console.log(`✅ Broadcasted notification removal for submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error broadcasting notification removal:', error);\n  }\n}\n\nexport async function notifyReviewerNewUser(userId: string) {\n  try {\n    // Get user details\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    });\n\n    if (!user) {\n      throw new Error('User not found');\n    }\n\n    // Create notification record for reviewers\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'reviewer',\n        type: 'new_user_verification',\n        title: 'User Baru Perlu Verifikasi',\n        message: `User baru ${user.vendor_name || user.officer_name} perlu diverifikasi`,\n        data: JSON.stringify({\n          userId,\n          vendorName: user.vendor_name,\n          officerName: user.officer_name,\n          email: user.email,\n          phoneNumber: user.phone_number,\n          registrationDate: user.created_at.toISOString()\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'reviewer',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific user verification event\n    eventsPublisher.userVerificationNeeded({\n      userId,\n      vendorName: user.vendor_name || '',\n      officerName: user.officer_name,\n      email: user.email,\n      createdAt: user.created_at.toISOString()\n    });\n\n    // Update unread count for reviewers\n    const unreadCount = await getUnreadCount('reviewer');\n    const unreadCountEvent = {\n      scope: 'reviewer' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update reviewer stats\n    const totalPendingUsers = await prisma.user.count({\n      where: { \n        verified_at: null,\n        role: 'VENDOR' // Only vendor users need verification\n      }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingUserVerifications: totalPendingUsers\n      }\n    });\n\n    console.log(`✅ Notified reviewers about new user: ${userId}`);\n\n  } catch (error) {\n    console.error('Error notifying reviewer new user:', error);\n  }\n}\n\nexport async function notifyReviewerNewSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { user: true }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Create notification record for reviewers\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'reviewer',\n        type: 'new_submission_review',\n        title: 'Pengajuan Simlok Baru untuk Review',\n        message: `Ada pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name} yang perlu direview`,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name,\n          jobDescription: submission.job_description\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'reviewer',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count for reviewers\n    const unreadCount = await getUnreadCount('reviewer');\n    const unreadCountEvent = {\n      scope: 'reviewer' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update reviewer stats\n    const totalPendingReview = await prisma.submission.count({\n      where: { review_status: 'PENDING_REVIEW' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingReview: totalPendingReview,\n        totalSubmissions: await prisma.submission.count()\n      }\n    });\n\n    console.log(`✅ Notified reviewers about new submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error notifying reviewer new submission:', error);\n  }\n}\n\nexport async function notifyApproverReviewedSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { \n        user: true,\n        reviewed_by_user: {\n          select: {\n            officer_name: true\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Determine notification message and type based on review status\n    let notificationMessage: string;\n    let notificationType: string;\n    let notificationTitle: string;\n    \n    if (submission.review_status === 'MEETS_REQUIREMENTS') {\n      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan perlu persetujuan final`;\n      notificationType = 'reviewed_submission_approval';\n      notificationTitle = 'Pengajuan Simlok Perlu Persetujuan';\n    } else {\n      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan tidak memenuhi syarat`;\n      notificationType = 'reviewed_submission_rejection';\n      notificationTitle = 'Pengajuan Simlok Sudah Direview';\n    }\n\n    // Create notification record for approvers (for both meets and doesn't meet requirements)\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'approver',\n        type: notificationType,\n        title: notificationTitle,\n        message: notificationMessage,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name,\n          jobDescription: submission.job_description,\n          reviewedBy: submission.reviewed_by_user?.officer_name,\n          reviewStatus: submission.review_status,\n          reviewNote: submission.review_note\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'approver',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific submission reviewed event\n    eventsPublisher.submissionReviewed({\n      submissionId,\n      reviewStatus: submission.review_status,\n      reviewedBy: submission.reviewed_by_user?.officer_name || 'Unknown',\n      reviewedAt: new Date().toISOString()\n    });\n\n    // Update unread count for approvers\n    const unreadCount = await getUnreadCount('approver');\n    const unreadCountEvent = {\n      scope: 'approver' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update approver stats\n    const totalPendingFinal = await prisma.submission.count({\n      where: { \n        review_status: 'MEETS_REQUIREMENTS',\n        final_status: 'PENDING_APPROVAL'\n      }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'approver',\n      changes: {\n        pendingFinalApproval: totalPendingFinal,\n        totalReviewedSubmissions: await prisma.submission.count({\n          where: { review_status: { not: 'PENDING_REVIEW' } }\n        })\n      }\n    });\n\n    console.log(`✅ Notified approvers about reviewed submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error notifying approver reviewed submission:', error);\n  }\n}\n\nexport async function notifyUserVerificationResult(\n  userId: string, \n  verificationStatus: 'VERIFY' | 'REJECT',\n  note?: string\n) {\n  try {\n    // Get user details\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    });\n\n    if (!user) {\n      throw new Error('User not found');\n    }\n\n    const title = verificationStatus === 'VERIFY' \n      ? 'Akun Anda Telah Diverifikasi' \n      : 'Verifikasi Akun Ditolak';\n      \n    const message = verificationStatus === 'VERIFY'\n      ? 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.'\n      : `Maaf, akun vendor Anda tidak dapat diverifikasi. ${note || 'Silakan hubungi admin untuk informasi lebih lanjut.'}`;\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: `temp_${Date.now()}`, // Will be replaced when notification is created\n      type: verificationStatus === 'VERIFY' ? 'user_verified' : 'user_rejected',\n      title: title,\n      message: message,\n      data: JSON.stringify({\n        userId,\n        verificationStatus,\n        note\n      }),\n      scope: 'vendor',\n      vendorId: userId,\n      createdAt: new Date().toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific user verification result event\n    eventsPublisher.userVerificationResult(userId, {\n      userId,\n      status: verificationStatus,\n      verifiedAt: new Date().toISOString(),\n      note: note || ''\n    });\n\n    // Update unread count for the specific vendor\n    const unreadCount = await getUnreadCount('vendor', userId);\n    const unreadCountEvent = {\n      scope: 'vendor' as const,\n      vendorId: userId,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update vendor stats\n    const totalPendingUsers = await prisma.user.count({\n      where: { \n        verified_at: null,\n        role: 'VENDOR'\n      }\n    });\n\n    // Update reviewer stats  \n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingUserVerifications: totalPendingUsers\n      }\n    });\n\n    console.log(`✅ Notified user about verification result: ${userId} - ${verificationStatus}`);\n\n  } catch (error) {\n    console.error('Error notifying user verification result:', error);\n  }\n}\n\n// notifyReviewerFinalDecision function removed - reviewers no longer need notification when submissions are approved/rejected\n\nexport async function notifyReviewerSubmissionApproved(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { \n        user: true,\n        approved_by_final_user: true\n      }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Only notify if submission is approved\n    if (submission.final_status !== 'APPROVED') {\n      return;\n    }\n\n    const notificationTitle = 'Pengajuan Simlok Disetujui';\n    const notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} telah disetujui oleh Approver`;\n\n    // Create notification record for reviewers\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'reviewer',\n        type: 'submission_approved',\n        title: notificationTitle,\n        message: notificationMessage,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name,\n          jobDescription: submission.job_description,\n          approvedBy: submission.approved_by_final_user?.officer_name,\n          finalStatus: submission.final_status,\n          simlokNumber: submission.simlok_number,\n          approvedAt: submission.approved_at\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'reviewer',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count for reviewers\n    const unreadCount = await getUnreadCount('reviewer');\n    const unreadCountEvent = {\n      scope: 'reviewer' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update reviewer stats\n    const totalApproved = await prisma.submission.count({\n      where: { final_status: 'APPROVED' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        approvedSubmissions: totalApproved,\n        totalSubmissions: await prisma.submission.count()\n      }\n    });\n\n    console.log(`✅ Notified reviewers about approved submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error notifying reviewers about approved submission:', error);\n  }\n}\n"
        },
        {
          "type": "file",
          "name": "eventsPublisher.ts",
          "content": "/**\n * Events Publisher Service\n * Handles all business event emissions to Socket.IO rooms\n */\n\nimport { getSocketIO } from '@/lib/singletons';\nimport { EVENT_NAMES, ROOMS } from '@/shared/events';\nimport type {\n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent,\n  NotificationUnreadCountEvent,\n  StatsUpdateEvent,\n} from '@/shared/events';\n\nclass EventsPublisher {\n  private io = getSocketIO();\n\n  /**\n   * Get Socket.IO instance (refreshed each call for HMR safety)\n   */\n  private getIO() {\n    if (!this.io) {\n      this.io = getSocketIO();\n    }\n    return this.io;\n  }\n\n  /**\n   * Emit event to admin room\n   */\n  private emitToAdmin(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.ADMIN).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to admin room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to reviewer room\n   */\n  private emitToReviewer(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.REVIEWER).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to reviewer room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to approver room\n   */\n  private emitToApprover(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.APPROVER).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to approver room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to specific vendor room\n   */\n  private emitToVendor(vendorId: string, event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to vendor ${vendorId}:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit new submission event to admin\n   */\n  adminNewSubmission(payload: AdminNewSubmissionEvent) {\n    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);\n  }\n\n  /**\n   * Emit new vendor registration to admin\n   */\n  adminNewVendor(payload: AdminNewVendorEvent) {\n    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);\n  }\n\n  /**\n   * Emit submission status change to specific vendor\n   */\n  vendorSubmissionStatusChanged(vendorId: string, payload: VendorSubmissionStatusChangedEvent) {\n    this.emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);\n  }\n\n  /**\n   * Emit new notification\n   */\n  notificationNew(payload: NotificationNewEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);\n    }\n  }\n\n  /**\n   * Emit unread notification count update\n   */\n  notificationUnreadCount(payload: NotificationUnreadCountEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    }\n  }\n\n  /**\n   * Emit stats update\n   */\n  statsUpdate(payload: StatsUpdateEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.STATS_UPDATE, payload);\n    }\n  }\n\n  /**\n   * Emit notification removal (broadcast to all clients)\n   */\n  notificationRemoved(payload: { submissionId: string; timestamp: string }) {\n    this.broadcast(EVENT_NAMES.NOTIFICATION_REMOVED, payload);\n  }\n\n  /**\n   * Emit submission reviewed event to approvers\n   */\n  submissionReviewed(payload: { submissionId: string; reviewStatus: string; reviewedBy: string; reviewedAt: string }) {\n    this.emitToApprover('submission:reviewed', payload);\n  }\n\n  /**\n   * Emit submission created event to reviewers\n   */\n  submissionCreated(payload: { submissionId: string; vendorName: string; officerName: string; createdAt: string }) {\n    this.emitToReviewer('submission:created', payload);\n  }\n\n  /**\n   * Emit submission finalized event to vendor\n   */\n  submissionFinalized(vendorId: string, payload: { submissionId: string; finalStatus: string; finalizedBy: string; finalizedAt: string }) {\n    this.emitToVendor(vendorId, 'submission:finalized', payload);\n  }\n\n  /**\n   * Emit user verification needed event to reviewers\n   */\n  userVerificationNeeded(payload: { userId: string; vendorName: string; officerName: string; email: string; createdAt: string }) {\n    this.emitToReviewer('user:verification-needed', payload);\n  }\n\n  /**\n   * Emit user verification result event to specific vendor\n   */\n  userVerificationResult(vendorId: string, payload: { userId: string; status: string; verifiedAt: string; note: string }) {\n    this.emitToVendor(vendorId, 'user:verification-result', payload);\n  }\n\n  /**\n   * Emit to all connected clients (use sparingly)\n   */\n  broadcast(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.emit(event, payload);\n      console.log(`[Events] Broadcasted ${event}:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for broadcast: ${event}`);\n    }\n  }\n}\n\n// Export singleton instance\nexport const eventsPublisher = new EventsPublisher();\n"
        },
        {
          "type": "file",
          "name": "notificationsPublisher.ts",
          "content": "/**\n * Real-time Notifications Publisher using Redis\n * Publishes notifications to Redis channels for Server-Sent Events\n */\n\nimport { redisPub } from '@/lib/singletons';\nimport type { NotificationNewEvent, NotificationUnreadCountEvent } from '@/shared/events';\n\nexport class NotificationsPublisher {\n  /**\n   * Publish new notification to real-time subscribers\n   */\n  async publishNotification(notification: NotificationNewEvent) {\n    try {\n      let channelName: string;\n      \n      switch (notification.scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${notification.vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown notification scope: ${notification.scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'notification:new',\n        data: notification\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📡 Published notification to ${channelName}:`, notification.title);\n    } catch (error) {\n      console.error('❌ Error publishing notification:', error);\n    }\n  }\n\n  /**\n   * Publish unread count update to real-time subscribers\n   */\n  async publishUnreadCount(update: NotificationUnreadCountEvent) {\n    try {\n      let channelName: string;\n      \n      switch (update.scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${update.vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown notification scope: ${update.scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'notification:unread_count',\n        data: update\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📊 Published unread count to ${channelName}:`, update.unreadCount);\n    } catch (error) {\n      console.error('❌ Error publishing unread count:', error);\n    }\n  }\n\n  /**\n   * Publish stats update to real-time subscribers\n   */\n  async publishStatsUpdate(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, changes: Record<string, any>) {\n    try {\n      let channelName: string;\n      \n      switch (scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown stats scope: ${scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'stats:update',\n        data: { scope, vendorId, changes }\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📈 Published stats update to ${channelName}:`, changes);\n    } catch (error) {\n      console.error('❌ Error publishing stats update:', error);\n    }\n  }\n\n  /**\n   * Publish notification removal to all subscribers\n   */\n  async publishNotificationRemoval(removal: { submissionId: string; timestamp: string }) {\n    try {\n      // Publish to both admin and vendor channels since notifications can affect both\n      const channels = ['notifications:admin'];\n      \n      // Also publish to all vendor channels (we could make this more specific later)\n      // For now, we'll just publish to admin and let clients handle filtering\n      \n      const message = JSON.stringify({\n        type: 'notification:removed',\n        data: removal\n      });\n\n      for (const channelName of channels) {\n        await redisPub.publish(channelName, message);\n      }\n      \n      // Also publish to a general notification channel that all clients can subscribe to\n      await redisPub.publish('notifications:all', message);\n      \n      console.log(`🗑️ Published notification removal for submission ${removal.submissionId}`);\n    } catch (error) {\n      console.error('❌ Error publishing notification removal:', error);\n    }\n  }\n}\n\n// Export singleton instance\nexport const notificationsPublisher = new NotificationsPublisher();\n"
        },
        {
          "type": "file",
          "name": "socket.ts",
          "content": "import { Server } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\nimport { pubClient, subClient } from '../lib/redis';\nimport { EVENT_NAMES, ROOMS } from '../shared/events';\nimport type { \n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent,\n  NotificationUnreadCountEvent,\n  StatsUpdateEvent\n} from '../shared/events';\n\ndeclare global {\n  var __socket_io: Server | undefined;\n}\n\nlet io: Server;\n\n// Use global Socket.IO instance from custom server or create new one\nif (typeof globalThis !== 'undefined' && (globalThis as any).__socket_io) {\n  io = (globalThis as any).__socket_io;\n} else {\n  // Fallback for development or API routes\n  if (process.env.NODE_ENV === 'production') {\n    io = new Server({\n      cors: {\n        origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n        methods: ['GET', 'POST'],\n      },\n    });\n  } else {\n    if (!globalThis.__socket_io) {\n      globalThis.__socket_io = new Server({\n        cors: {\n          origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n          methods: ['GET', 'POST'],\n        },\n      });\n    }\n    io = globalThis.__socket_io;\n  }\n\n  // Set up Redis adapter only if not already set\n  if (!io.adapter || io.adapter.constructor.name === 'Adapter') {\n    try {\n      io.adapter(createAdapter(pubClient, subClient));\n      console.log('Redis adapter attached to Socket.IO');\n    } catch (error) {\n      console.error('Failed to attach Redis adapter:', error);\n    }\n  }\n}\n\n// Connection handler\nio.on('connection', (socket) => {\n  console.log('Client connected:', socket.id);\n\n  // Join rooms based on user role and vendor ID\n  socket.on('join', (data: { role: string; vendorId?: string }) => {\n    try {\n      const { role, vendorId } = data;\n      \n      if (role === 'ADMIN') {\n        socket.join(ROOMS.ADMIN);\n        console.log(`Socket ${socket.id} joined admin room`);\n      } else if (role === 'REVIEWER') {\n        socket.join(ROOMS.REVIEWER);\n        console.log(`Socket ${socket.id} joined reviewer room`);\n      } else if (role === 'APPROVER') {\n        socket.join(ROOMS.APPROVER);\n        console.log(`Socket ${socket.id} joined approver room`);\n      } else if (role === 'VENDOR' && vendorId) {\n        socket.join(ROOMS.VENDOR(vendorId));\n        console.log(`Socket ${socket.id} joined vendor room: ${vendorId}`);\n      }\n    } catch (error) {\n      console.error('Error joining room:', error);\n    }\n  });\n\n  socket.on('disconnect', () => {\n    console.log('Client disconnected:', socket.id);\n  });\n});\n\n// Helper functions for emitting events\nexport const emitToAdmin = (event: string, payload: any) => {\n  io.to(ROOMS.ADMIN).emit(event, payload);\n};\n\nexport const emitToReviewer = (event: string, payload: any) => {\n  io.to(ROOMS.REVIEWER).emit(event, payload);\n};\n\nexport const emitToApprover = (event: string, payload: any) => {\n  io.to(ROOMS.APPROVER).emit(event, payload);\n};\n\nexport const emitToVendor = (vendorId: string, event: string, payload: any) => {\n  io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);\n};\n\nexport const emitBroadcast = (event: string, payload: any) => {\n  io.emit(event, payload);\n};\n\n// Typed emit functions\nexport const emitAdminNewSubmission = (payload: AdminNewSubmissionEvent) => {\n  emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);\n};\n\nexport const emitAdminNewVendor = (payload: AdminNewVendorEvent) => {\n  emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);\n};\n\nexport const emitVendorSubmissionStatusChanged = (vendorId: string, payload: VendorSubmissionStatusChangedEvent) => {\n  emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);\n};\n\nexport const emitNotificationNew = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationNewEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);\n  }\n};\n\nexport const emitNotificationUnreadCount = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationUnreadCountEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  }\n};\n\nexport const emitStatsUpdate = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: StatsUpdateEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.STATS_UPDATE, payload);\n  }\n};\n\nexport { io };\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "services",
      "children": [
        {
          "type": "file",
          "name": "FileCompressionService.ts",
          "content": "/**\n * File Compression Service\n * Handles file compression with configurable quality and size limits\n */\n\nimport sharp from 'sharp';\nimport { writeFile, readFile } from 'fs/promises';\n\ninterface CompressionOptions {\n  maxSizeBytes: number;\n  quality: number;\n  format?: 'jpeg' | 'png' | 'webp';\n  maxWidth?: number;\n  maxHeight?: number;\n  outputDir?: string;\n}\n\ninterface CompressionResult {\n  success: boolean;\n  originalSize: number;\n  compressedSize: number;\n  compressionRatio: number;\n  filePath: string;\n  outputPath?: string;\n  error?: string;\n}\n\nexport class FileCompressionService {\n  private static readonly DEFAULT_QUALITY = 60;\n  private static readonly DEFAULT_MAX_SIZE = 2 * 1024 * 1024; // 2MB\n  private static readonly DEFAULT_MAX_WIDTH = 2048;\n  private static readonly DEFAULT_MAX_HEIGHT = 2048;\n\n  /**\n   * Compress an image file with specified options\n   */\n  static async compressImage(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    const config: CompressionOptions = {\n      maxSizeBytes: options.maxSizeBytes || this.DEFAULT_MAX_SIZE,\n      quality: options.quality || this.DEFAULT_QUALITY,\n      format: options.format || 'jpeg',\n      maxWidth: options.maxWidth || this.DEFAULT_MAX_WIDTH,\n      maxHeight: options.maxHeight || this.DEFAULT_MAX_HEIGHT,\n      outputDir: options.outputDir || '',\n    };\n\n    try {\n      // Read original file\n      const originalBuffer = await readFile(inputPath);\n      const originalSize = originalBuffer.length;\n\n      // If already within size limits, return as is\n      if (originalSize <= config.maxSizeBytes) {\n        return {\n          success: true,\n          originalSize,\n          compressedSize: originalSize,\n          compressionRatio: 1.0,\n          filePath: inputPath,\n          outputPath: inputPath,\n        };\n      }\n\n      // Get metadata\n      const metadata = await sharp(originalBuffer).metadata();\n      \n      // Determine output format\n      const outputFormat = config.format || this.getOutputFormat(metadata.format);\n      \n      // Calculate resize dimensions if needed\n      const { width, height } = this.calculateDimensions(\n        metadata.width || 0,\n        metadata.height || 0,\n        config.maxWidth!,\n        config.maxHeight!\n      );\n\n      // Start with initial quality\n      let currentQuality = config.quality;\n      let compressedBuffer: Buffer;\n      let iterations = 0;\n      const maxIterations = 5;\n\n      do {\n        // Apply compression\n        let sharpInstance = sharp(originalBuffer)\n          .resize(width, height, { \n            fit: 'inside',\n            withoutEnlargement: true \n          });\n\n        // Apply format-specific compression\n        switch (outputFormat) {\n          case 'jpeg':\n            sharpInstance = sharpInstance.jpeg({ \n              quality: currentQuality,\n              progressive: true,\n              mozjpeg: true\n            });\n            break;\n          case 'png':\n            sharpInstance = sharpInstance.png({ \n              quality: currentQuality,\n              compressionLevel: 9,\n              progressive: true\n            });\n            break;\n          case 'webp':\n            sharpInstance = sharpInstance.webp({ \n              quality: currentQuality,\n              effort: 6\n            });\n            break;\n        }\n\n        compressedBuffer = await sharpInstance.toBuffer();\n\n        // Check if size is acceptable\n        if (compressedBuffer.length <= config.maxSizeBytes || currentQuality <= 20) {\n          break;\n        }\n\n        // Reduce quality for next iteration\n        currentQuality = Math.max(20, currentQuality - 10);\n        iterations++;\n\n      } while (iterations < maxIterations);\n\n      // Generate output path\n      const outputPath = this.generateOutputPath(inputPath, outputFormat, config.outputDir);\n\n      // Save compressed file\n      await writeFile(outputPath, compressedBuffer);\n\n      const compressionRatio = compressedBuffer.length / originalSize;\n\n      console.log(`✅ Image compressed: ${this.formatFileSize(originalSize)} -> ${this.formatFileSize(compressedBuffer.length)} (${Math.round((1 - compressionRatio) * 100)}% reduction)`);\n\n      return {\n        success: true,\n        originalSize,\n        compressedSize: compressedBuffer.length,\n        compressionRatio,\n        filePath: inputPath,\n        outputPath,\n      };\n\n    } catch (error) {\n      console.error('Compression error:', error);\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: error instanceof Error ? error.message : 'Unknown compression error',\n      };\n    }\n  }\n\n  /**\n   * Compress a PDF file (placeholder - requires pdf-lib or similar)\n   */\n  static async compressPDF(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    try {\n      const originalBuffer = await readFile(inputPath);\n      const originalSize = originalBuffer.length;\n\n      // For now, just return the original if within limits\n      if (originalSize <= (options.maxSizeBytes || this.DEFAULT_MAX_SIZE)) {\n        return {\n          success: true,\n          originalSize,\n          compressedSize: originalSize,\n          compressionRatio: 1.0,\n          filePath: inputPath,\n          outputPath: inputPath,\n        };\n      }\n\n      // PDF compression would require additional libraries\n      console.warn('PDF compression not implemented yet');\n      return {\n        success: false,\n        originalSize,\n        compressedSize: originalSize,\n        compressionRatio: 1.0,\n        filePath: inputPath,\n        error: 'PDF compression not implemented',\n      };\n\n    } catch (error) {\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: error instanceof Error ? error.message : 'PDF compression failed',\n      };\n    }\n  }\n\n  /**\n   * Check if file type can be compressed\n   */\n  static canCompress(mimeType: string): boolean {\n    const compressibleTypes = [\n      'image/jpeg',\n      'image/jpg', \n      'image/png',\n      'image/webp',\n      'application/pdf'\n    ];\n    return compressibleTypes.includes(mimeType);\n  }\n\n  /**\n   * Generic file compression method\n   */\n  static async compressFile(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    // Detect file type from extension\n    const ext = inputPath.toLowerCase().split('.').pop();\n    \n    if (['jpg', 'jpeg', 'png', 'webp'].includes(ext || '')) {\n      return this.compressImage(inputPath, options);\n    } else if (ext === 'pdf') {\n      return this.compressPDF(inputPath, options);\n    } else {\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: `Unsupported file type: ${ext}`,\n      };\n    }\n  }\n\n  /**\n   * Calculate optimal dimensions while maintaining aspect ratio\n   */\n  private static calculateDimensions(\n    originalWidth: number,\n    originalHeight: number,\n    maxWidth: number,\n    maxHeight: number\n  ): { width: number; height: number } {\n    if (originalWidth <= maxWidth && originalHeight <= maxHeight) {\n      return { width: originalWidth, height: originalHeight };\n    }\n\n    const widthRatio = maxWidth / originalWidth;\n    const heightRatio = maxHeight / originalHeight;\n    const ratio = Math.min(widthRatio, heightRatio);\n\n    return {\n      width: Math.round(originalWidth * ratio),\n      height: Math.round(originalHeight * ratio),\n    };\n  }\n\n  /**\n   * Get appropriate output format based on input\n   */\n  private static getOutputFormat(inputFormat?: string): 'jpeg' | 'png' | 'webp' {\n    switch (inputFormat?.toLowerCase()) {\n      case 'png':\n        return 'png';\n      case 'webp':\n        return 'webp';\n      default:\n        return 'jpeg';\n    }\n  }\n\n  /**\n   * Generate output file path\n   */\n  private static generateOutputPath(\n    inputPath: string,\n    format: string,\n    outputDir?: string\n  ): string {\n    const pathParts = inputPath.split('/');\n    const fileName = pathParts.pop() || 'compressed';\n    const nameWithoutExt = fileName.split('.')[0];\n    const timestamp = Date.now();\n    \n    const outputFileName = `${nameWithoutExt}_compressed_${timestamp}.${format}`;\n    \n    if (outputDir) {\n      return `${outputDir}/${outputFileName}`;\n    }\n    \n    pathParts.push(outputFileName);\n    return pathParts.join('/');\n  }\n\n  /**\n   * Format file size for human display\n   */\n  static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 Bytes';\n    \n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  }\n}"
        },
        {
          "type": "file",
          "name": "FileValidationService.ts",
          "content": "/**\n * File Validation Service\n * Comprehensive file type validation with security checks\n */\n\nimport { readFile } from 'fs/promises';\n\ninterface FileValidationResult {\n  isValid: boolean;\n  mimeType: string;\n  actualExtension: string;\n  size: number;\n  error?: string;\n  securityChecks: {\n    hasValidSignature: boolean;\n    isSafeExtension: boolean;\n    hasNoMaliciousContent: boolean;\n  };\n}\n\ninterface ValidationOptions {\n  allowedTypes: string[];\n  allowedExtensions: string[];\n  maxSize: number;\n  checkMagicBytes: boolean;\n  scanForMalware: boolean;\n}\n\nexport class FileValidationService {\n  // File signatures (magic bytes) for validation\n  private static readonly FILE_SIGNATURES = {\n    'image/jpeg': [\n      [0xFF, 0xD8, 0xFF],\n    ],\n    'image/png': [\n      [0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A],\n    ],\n    'application/pdf': [\n      [0x25, 0x50, 0x44, 0x46], // %PDF\n    ],\n    'application/msword': [\n      [0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1], // .doc\n    ],\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': [\n      [0x50, 0x4B, 0x03, 0x04], // .docx (ZIP-based)\n      [0x50, 0x4B, 0x05, 0x06], // .docx (empty ZIP)\n      [0x50, 0x4B, 0x07, 0x08], // .docx (spanned ZIP)\n    ],\n  };\n\n  // Allowed file types for SIMLOK system\n  private static readonly DEFAULT_ALLOWED_TYPES = [\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  ];\n\n  private static readonly DEFAULT_ALLOWED_EXTENSIONS = [\n    '.jpg',\n    '.jpeg',\n    '.png', \n    '.pdf',\n    '.doc',\n    '.docx',\n  ];\n\n  // Dangerous file extensions that should never be allowed\n  private static readonly DANGEROUS_EXTENSIONS = [\n    '.exe', '.bat', '.cmd', '.com', '.pif', '.scr', '.vbs', '.js',\n    '.jar', '.app', '.deb', '.pkg', '.dmg', '.rpm', '.msi',\n    '.sh', '.bash', '.zsh', '.fish', '.ps1', '.psm1',\n  ];\n\n  // Malicious patterns to check for\n  private static readonly MALICIOUS_PATTERNS = [\n    /javascript:/gi,\n    /vbscript:/gi,\n    /onload=/gi,\n    /onerror=/gi,\n    /<script[^>]*>/gi,\n    /<iframe[^>]*>/gi,\n    /eval\\(/gi,\n    /document\\.write/gi,\n  ];\n\n  /**\n   * Comprehensive file validation\n   */\n  static async validateFile(\n    filePath: string,\n    originalName: string,\n    options: Partial<ValidationOptions> = {}\n  ): Promise<FileValidationResult> {\n    const config: ValidationOptions = {\n      allowedTypes: options.allowedTypes || this.DEFAULT_ALLOWED_TYPES,\n      allowedExtensions: options.allowedExtensions || this.DEFAULT_ALLOWED_EXTENSIONS,\n      maxSize: options.maxSize || 10 * 1024 * 1024, // 10MB default\n      checkMagicBytes: options.checkMagicBytes ?? true,\n      scanForMalware: options.scanForMalware ?? true,\n    };\n\n    try {\n      const fileBuffer = await readFile(filePath);\n      const fileSize = fileBuffer.length;\n      \n      // Extract extension from original filename\n      const extension = this.getFileExtension(originalName);\n      \n      // Basic size validation\n      if (fileSize > config.maxSize) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File size ${this.formatFileSize(fileSize)} exceeds maximum allowed size ${this.formatFileSize(config.maxSize)}`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Check for dangerous extensions\n      if (this.DANGEROUS_EXTENSIONS.includes(extension.toLowerCase())) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File extension '${extension}' is not allowed for security reasons`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Extension validation\n      const isSafeExtension = config.allowedExtensions.includes(extension.toLowerCase());\n      if (!isSafeExtension) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File extension '${extension}' is not allowed. Allowed extensions: ${config.allowedExtensions.join(', ')}`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Detect actual MIME type from file signature\n      const actualMimeType = this.detectMimeType(fileBuffer);\n      \n      // Magic bytes validation\n      let hasValidSignature = true;\n      if (config.checkMagicBytes && actualMimeType) {\n        hasValidSignature = this.validateFileSignature(fileBuffer, actualMimeType);\n        if (!hasValidSignature) {\n          return {\n            isValid: false,\n            mimeType: actualMimeType,\n            actualExtension: extension,\n            size: fileSize,\n            error: 'File signature does not match file extension (possible file tampering)',\n            securityChecks: {\n              hasValidSignature: false,\n              isSafeExtension: isSafeExtension,\n              hasNoMaliciousContent: false,\n            },\n          };\n        }\n      }\n\n      // MIME type validation\n      const mimeType = actualMimeType || this.getMimeTypeFromExtension(extension);\n      if (!config.allowedTypes.includes(mimeType)) {\n        return {\n          isValid: false,\n          mimeType,\n          actualExtension: extension,\n          size: fileSize,\n          error: `File type '${mimeType}' is not allowed. Allowed types: ${config.allowedTypes.join(', ')}`,\n          securityChecks: {\n            hasValidSignature,\n            isSafeExtension,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Malware/malicious content scan\n      let hasNoMaliciousContent = true;\n      if (config.scanForMalware) {\n        hasNoMaliciousContent = this.scanForMaliciousContent(fileBuffer);\n        if (!hasNoMaliciousContent) {\n          return {\n            isValid: false,\n            mimeType,\n            actualExtension: extension,\n            size: fileSize,\n            error: 'File contains potentially malicious content',\n            securityChecks: {\n              hasValidSignature,\n              isSafeExtension,\n              hasNoMaliciousContent: false,\n            },\n          };\n        }\n      }\n\n      return {\n        isValid: true,\n        mimeType,\n        actualExtension: extension,\n        size: fileSize,\n        securityChecks: {\n          hasValidSignature,\n          isSafeExtension,\n          hasNoMaliciousContent,\n        },\n      };\n\n    } catch (error) {\n      return {\n        isValid: false,\n        mimeType: '',\n        actualExtension: '',\n        size: 0,\n        error: error instanceof Error ? error.message : 'File validation failed',\n        securityChecks: {\n          hasValidSignature: false,\n          isSafeExtension: false,\n          hasNoMaliciousContent: false,\n        },\n      };\n    }\n  }\n\n  /**\n   * Detect MIME type from file signature (magic bytes)\n   */\n  private static detectMimeType(buffer: Buffer): string {\n    for (const [mimeType, signatures] of Object.entries(this.FILE_SIGNATURES)) {\n      for (const signature of signatures) {\n        if (this.checkSignature(buffer, signature)) {\n          return mimeType;\n        }\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Check if buffer starts with given signature\n   */\n  private static checkSignature(buffer: Buffer, signature: number[]): boolean {\n    if (buffer.length < signature.length) return false;\n    \n    for (let i = 0; i < signature.length; i++) {\n      if (buffer[i] !== signature[i]) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Validate file signature against expected MIME type\n   */\n  private static validateFileSignature(buffer: Buffer, mimeType: string): boolean {\n    const signatures = this.FILE_SIGNATURES[mimeType as keyof typeof this.FILE_SIGNATURES];\n    if (!signatures) return true; // Allow if no signature defined\n    \n    return signatures.some(signature => this.checkSignature(buffer, signature));\n  }\n\n  /**\n   * Get file extension from filename\n   */\n  private static getFileExtension(filename: string): string {\n    const lastDot = filename.lastIndexOf('.');\n    return lastDot !== -1 ? filename.substring(lastDot).toLowerCase() : '';\n  }\n\n  /**\n   * Get MIME type from file extension\n   */\n  private static getMimeTypeFromExtension(extension: string): string {\n    const mimeMap: Record<string, string> = {\n      '.jpg': 'image/jpeg',\n      '.jpeg': 'image/jpeg',\n      '.png': 'image/png',\n      '.pdf': 'application/pdf',\n      '.doc': 'application/msword',\n      '.docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    };\n    \n    return mimeMap[extension.toLowerCase()] || 'application/octet-stream';\n  }\n\n  /**\n   * Scan for malicious content patterns\n   */\n  private static scanForMaliciousContent(buffer: Buffer): boolean {\n    const content = buffer.toString('utf8', 0, Math.min(buffer.length, 8192)); // Check first 8KB\n    \n    return !this.MALICIOUS_PATTERNS.some(pattern => pattern.test(content));\n  }\n\n  /**\n   * Format file size for display\n   */\n  private static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 Bytes';\n    \n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  }\n\n  /**\n   * Validate specific file types for SIMLOK categories\n   */\n  static validateSIMLOKFile(\n    filePath: string,\n    originalName: string,\n    category: 'sika' | 'simja' | 'id_card' | 'other'\n  ): Promise<FileValidationResult> {\n    let allowedTypes: string[];\n    let allowedExtensions: string[];\n\n    switch (category) {\n      case 'id_card':\n        // ID Card should be images only\n        allowedTypes = ['image/jpeg', 'image/png'];\n        allowedExtensions = ['.jpg', '.jpeg', '.png'];\n        break;\n        \n      case 'sika':\n      case 'simja':\n        // Documents can be images or PDFs\n        allowedTypes = [\n          'image/jpeg',\n          'image/png', \n          'application/pdf',\n          'application/msword',\n          'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n        ];\n        allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'];\n        break;\n        \n      default:\n        allowedTypes = this.DEFAULT_ALLOWED_TYPES;\n        allowedExtensions = this.DEFAULT_ALLOWED_EXTENSIONS;\n    }\n\n    return this.validateFile(filePath, originalName, {\n      allowedTypes,\n      allowedExtensions,\n      maxSize: 10 * 1024 * 1024, // 10MB\n      checkMagicBytes: true,\n      scanForMalware: true,\n    });\n  }\n}"
        }
      ]
    },
    {
      "type": "directory",
      "name": "shared",
      "children": [
        {
          "type": "file",
          "name": "dto.ts",
          "content": "/**\n * Shared DTOs and validation schemas for API routes\n */\n\nimport { z } from 'zod';\n\n// Common response schemas\nexport const ApiErrorSchema = z.object({\n  error: z.string(),\n  message: z.string(),\n  code: z.string().optional(),\n});\n\nexport const ApiSuccessSchema = z.object({\n  success: z.boolean(),\n  data: z.any().optional(),\n  message: z.string().optional(),\n});\n\n// Pagination schemas\nexport const PaginationQuerySchema = z.object({\n  cursor: z.string().optional().nullable(),\n  limit: z.coerce.number().int().positive().max(100).default(10),\n});\n\nexport const PaginatedResponseSchema = z.object({\n  data: z.array(z.any()),\n  pagination: z.object({\n    nextCursor: z.string().nullable(),\n    hasMore: z.boolean(),\n    total: z.number().optional(),\n  }),\n});\n\n// Notification schemas\nexport const NotificationsQuerySchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n}).merge(PaginationQuerySchema);\n\nexport const NotificationSchema = z.object({\n  id: z.string(),\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().nullable(),\n  type: z.string(),\n  title: z.string(),\n  message: z.string(),\n  data: z.string().nullable(),\n  createdAt: z.string(),\n  isRead: z.boolean(),\n});\n\nexport const MarkAsReadSchema = z.object({\n  notificationId: z.string(),\n});\n\nexport const MarkAllAsReadSchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n});\n\n// Submission schemas\nexport const SubmissionStatusSchema = z.enum(['PENDING', 'APPROVED', 'REJECTED']);\n\nexport const CreateSubmissionSchema = z.object({\n  vendor_name: z.string().min(1),\n  based_on: z.string().min(1),\n  officer_name: z.string().min(1),\n  job_description: z.string().min(1),\n  work_location: z.string().min(1),\n  implementation: z.string().optional(),\n  working_hours: z.string().min(1),\n  other_notes: z.string().optional(),\n  work_facilities: z.string().min(1),\n  worker_names: z.string().min(1),\n  content: z.string().optional(),\n  notes: z.string().optional(),\n  signer_position: z.string().optional(),\n  signer_name: z.string().optional(),\n});\n\nexport const UpdateSubmissionStatusSchema = z.object({\n  status: SubmissionStatusSchema,\n  notes: z.string().optional(),\n});\n\n// User/Vendor schemas\nexport const CreateVendorSchema = z.object({\n  officer_name: z.string().min(1),\n  email: z.string().email(),\n  password: z.string().min(6),\n  vendor_name: z.string().min(1),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n});\n\nexport const UpdateVendorStatusSchema = z.object({\n  verified: z.boolean(),\n});\n\n// Stats schemas\nexport const StatsQuerySchema = z.object({\n  scope: z.enum(['admin', 'vendor']),\n  vendorId: z.string().optional().nullable(),\n  range: z.enum(['day', 'week', 'month', 'year']).default('month'),\n});\n\n// Type exports\nexport type ApiError = z.infer<typeof ApiErrorSchema>;\nexport type ApiSuccess = z.infer<typeof ApiSuccessSchema>;\nexport type PaginationQuery = z.infer<typeof PaginationQuerySchema>;\nexport type PaginatedResponse = z.infer<typeof PaginatedResponseSchema>;\nexport type NotificationsQuery = z.infer<typeof NotificationsQuerySchema>;\nexport type NotificationDto = z.infer<typeof NotificationSchema>;\nexport type CreateSubmissionDto = z.infer<typeof CreateSubmissionSchema>;\nexport type UpdateSubmissionStatusDto = z.infer<typeof UpdateSubmissionStatusSchema>;\nexport type CreateVendorDto = z.infer<typeof CreateVendorSchema>;\nexport type StatsQuery = z.infer<typeof StatsQuerySchema>;\n"
        },
        {
          "type": "file",
          "name": "events.ts",
          "content": "import { z } from 'zod';\n\n// Event schemas\nexport const AdminNewSubmissionEvent = z.object({\n  submissionId: z.string(),\n  createdAt: z.string(),\n});\n\nexport const AdminNewVendorEvent = z.object({\n  vendorId: z.string(),\n  createdAt: z.string(),\n});\n\nexport const VendorSubmissionStatusChangedEvent = z.object({\n  submissionId: z.string(),\n  status: z.enum(['PENDING', 'APPROVED', 'REJECTED']),\n  updatedAt: z.string(),\n});\n\nexport const NotificationNewEvent = z.object({\n  id: z.string(),\n  type: z.string(),\n  title: z.string(),\n  message: z.string(),\n  data: z.string().nullable().optional(),\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  createdAt: z.string(),\n});\n\nexport const NotificationUnreadCountEvent = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  unreadCount: z.number(),\n  count: z.number(), // Legacy field for backward compatibility\n});\n\nexport const GetNotificationsSchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n  cursor: z.string().optional().nullable(),\n  limit: z.number().int().positive().max(100).default(10).optional(),\n});\n\nexport const StatsUpdateEvent = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  changes: z.record(z.string(), z.union([z.number(), z.string()])),\n});\n\nexport const NotificationRemovedEvent = z.object({\n  submissionId: z.string(),\n  timestamp: z.string(),\n});\n\n// Event types\nexport type AdminNewSubmissionEvent = z.infer<typeof AdminNewSubmissionEvent>;\nexport type AdminNewVendorEvent = z.infer<typeof AdminNewVendorEvent>;\nexport type VendorSubmissionStatusChangedEvent = z.infer<typeof VendorSubmissionStatusChangedEvent>;\nexport type NotificationNewEvent = z.infer<typeof NotificationNewEvent>;\nexport type NotificationUnreadCountEvent = z.infer<typeof NotificationUnreadCountEvent>;\nexport type StatsUpdateEvent = z.infer<typeof StatsUpdateEvent>;\nexport type NotificationRemovedEvent = z.infer<typeof NotificationRemovedEvent>;\n\n// Event names\nexport const EVENT_NAMES = {\n  ADMIN_NEW_SUBMISSION: 'admin:new_submission',\n  ADMIN_NEW_VENDOR: 'admin:new_vendor',\n  VENDOR_SUBMISSION_STATUS_CHANGED: 'vendor:submission_status_changed',\n  NOTIFICATION_NEW: 'notification:new',\n  NOTIFICATION_UNREAD_COUNT: 'notification:unread_count',\n  NOTIFICATION_REMOVED: 'notification:removed',\n  STATS_UPDATE: 'stats:update',\n} as const;\n\n// Room names\nexport const ROOM_MAPPING = {\n  SUPER_ADMIN: 'admin',\n  REVIEWER: 'reviewer',\n  APPROVER: 'approver',\n  VENDOR: 'vendor',\n  VERIFIER: 'admin', // verifiers use admin room\n} as const;\n\n// Socket.IO room names\nexport const ROOMS = {\n  ADMIN: 'admin',\n  REVIEWER: 'reviewer', \n  APPROVER: 'approver',\n  VENDOR: (vendorId: string) => `vendor:${vendorId}`,\n} as const;\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "store",
      "children": [
        {
          "type": "file",
          "name": "lists.ts",
          "content": "import { create } from 'zustand';\n\nexport interface SubmissionListItem {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  approval_status: string;\n  created_at: string;\n  work_location: string;\n}\n\nexport interface VendorListItem {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  email: string;\n  created_at: string;\n  verified_at: string | null;\n}\n\ninterface ListsState {\n  submissions: SubmissionListItem[];\n  vendors: VendorListItem[];\n  submissionsLoading: boolean;\n  vendorsLoading: boolean;\n}\n\ninterface ListsActions {\n  setSubmissions: (submissions: SubmissionListItem[]) => void;\n  addSubmission: (submission: SubmissionListItem) => void;\n  updateSubmission: (id: string, updates: Partial<SubmissionListItem>) => void;\n  setVendors: (vendors: VendorListItem[]) => void;\n  addVendor: (vendor: VendorListItem) => void;\n  updateVendor: (id: string, updates: Partial<VendorListItem>) => void;\n  setSubmissionsLoading: (loading: boolean) => void;\n  setVendorsLoading: (loading: boolean) => void;\n  reset: () => void;\n}\n\nexport type ListsStore = ListsState & ListsActions;\n\nconst initialState: ListsState = {\n  submissions: [],\n  vendors: [],\n  submissionsLoading: false,\n  vendorsLoading: false,\n};\n\nexport const useListsStore = create<ListsStore>((set) => ({\n  ...initialState,\n\n  setSubmissions: (submissions) => set({ submissions }),\n\n  addSubmission: (submission) => set((state) => ({\n    submissions: [submission, ...state.submissions],\n  })),\n\n  updateSubmission: (id, updates) => set((state) => ({\n    submissions: state.submissions.map(item => \n      item.id === id ? { ...item, ...updates } : item\n    ),\n  })),\n\n  setVendors: (vendors) => set({ vendors }),\n\n  addVendor: (vendor) => set((state) => ({\n    vendors: [vendor, ...state.vendors],\n  })),\n\n  updateVendor: (id, updates) => set((state) => ({\n    vendors: state.vendors.map(item => \n      item.id === id ? { ...item, ...updates } : item\n    ),\n  })),\n\n  setSubmissionsLoading: (loading) => set({ submissionsLoading: loading }),\n\n  setVendorsLoading: (loading) => set({ vendorsLoading: loading }),\n\n  reset: () => set(initialState),\n}));\n"
        },
        {
          "type": "file",
          "name": "notifications.ts",
          "content": "// src/store/notifications.ts\n'use client';\n\nimport { create } from 'zustand';\n\nexport interface Notification {\n  id: string;\n  type: string;\n  title: string;\n  message: string;\n  data?: any;\n  createdAt: string;\n  isRead: boolean;\n}\n\ninterface NotificationsState {\n  items: Notification[];\n  unreadCount: number;\n  loading: boolean;\n  hasMore: boolean;\n  cursor: string | null;\n  markingAsRead: Set<string>; // Track notifications being marked as read\n}\n\ntype Scope = 'admin' | 'vendor' | 'reviewer' | 'approver';\n\ninterface ReloadParams {\n  scope?: Scope | undefined;\n  vendorId?: string | undefined;\n  cursor?: string | null;\n  pageSize?: number;\n  search?: string;\n  filter?: 'all' | 'unread' | 'read';\n}\n\ninterface MarkAllParams {\n  scope?: Scope | undefined;\n  vendorId?: string | undefined;\n  refetch?: boolean;\n}\n\ninterface MarkOneParams {\n  scope?: Scope | undefined;\n  vendorId?: string | undefined;\n  refetch?: boolean;\n}\n\ninterface NotificationsActions {\n  setItems: (items: Notification[]) => void;\n  addItem: (item: Notification) => void;\n  removeNotifications: (submissionId: string) => void;\n  setUnreadCount: (count: number) => void;\n  markAsRead: (id: string, params?: MarkOneParams) => Promise<void>;\n  markAllAsRead: (params?: MarkAllParams) => Promise<void>;\n  setLoading: (loading: boolean) => void;\n  setHasMore: (hasMore: boolean) => void;\n  setCursor: (cursor: string | null) => void;\n  reload: (params?: ReloadParams) => Promise<void>;\n  reset: () => void;\n}\n\nexport type NotificationsStore = NotificationsState & NotificationsActions;\n\n// ===== util fetch JSON (no-store + cache buster) =====\nasync function fetchJSON<T>(url: string, init: RequestInit = {}): Promise<T> {\n  const busted = `${url}${url.includes('?') ? '&' : '?'}t=${Date.now()}`;\n  const res = await fetch(busted, {\n    headers: {\n      'content-type': 'application/json',\n      ...(init.headers || {}),\n    },\n    ...init,\n  });\n  if (!res.ok) {\n    let msg = `Request failed: ${res.status}`;\n    try {\n      const j = await res.json();\n      msg = (j as any)?.error || msg;\n    } catch {}\n    throw new Error(msg);\n  }\n  return res.json() as Promise<T>;\n}\n\nconst initialState: NotificationsState = {\n  items: [],\n  unreadCount: 0,\n  loading: false,\n  hasMore: true,\n  cursor: null,\n  markingAsRead: new Set<string>(),\n};\n\nexport const useNotificationsStore = create<NotificationsStore>((set, get) => ({\n  ...initialState,\n\n  setItems: (items) => set({ items }),\n\n  addItem: (item) =>\n    set((state) => ({\n      items: [item, ...state.items],\n      unreadCount: item.isRead ? state.unreadCount : state.unreadCount + 1,\n    })),\n\n  removeNotifications: (submissionId) =>\n    set((state) => {\n      const filteredItems = state.items.filter((item) => {\n        if (item.data) {\n          try {\n            const data =\n              typeof item.data === 'string' ? JSON.parse(item.data) : item.data;\n            if (data.submissionId === submissionId || data.submission_id === submissionId) {\n              return false;\n            }\n          } catch {}\n        }\n        const hasIdInMessage = item.message.includes(submissionId);\n        const hasIdInTitle = item.title.includes(submissionId);\n        return !hasIdInMessage && !hasIdInTitle;\n      });\n\n      const removedUnreadCount = state.items.filter((item) => {\n        if (item.isRead) return false;\n        if (item.data) {\n          try {\n            const data =\n              typeof item.data === 'string' ? JSON.parse(item.data) : item.data;\n            if (data.submissionId === submissionId || data.submission_id === submissionId) {\n              return true;\n            }\n          } catch {}\n        }\n        const hasIdInMessage = item.message.includes(submissionId);\n        const hasIdInTitle = item.title.includes(submissionId);\n        return hasIdInMessage || hasIdInTitle;\n      }).length;\n\n      return {\n        items: filteredItems,\n        unreadCount: Math.max(0, state.unreadCount - removedUnreadCount),\n      };\n    }),\n\n  setUnreadCount: (count) => set({ unreadCount: count }),\n\n  // ====== READ SINGLE (optimistic + race condition protection) ======\n  markAsRead: async (id, params) => {\n    // Unused params untuk compatibility dengan existing calls\n    void params;\n\n    // Prevent race condition\n    const state = get();\n    if (state.markingAsRead.has(id)) {\n      console.log('⚠️ Already marking notification as read:', id);\n      return;\n    }\n\n    const before = state.items.find((n) => n.id === id);\n    if (!before) {\n      console.warn('⚠️ Notification not found:', id);\n      return;\n    }\n\n    if (before.isRead) {\n      console.log('ℹ️ Notification already read:', id);\n      return;\n    }\n\n    try {\n      // Mark as being processed\n      set((state) => ({\n        ...state,\n        markingAsRead: new Set([...state.markingAsRead, id])\n      }));\n\n      console.log('📤 Marking notification as read:', id);\n\n      // Optimistic update\n      set((state) => ({\n        items: state.items.map((item) =>\n          item.id === id ? { ...item, isRead: true } : item\n        ),\n        unreadCount: Math.max(0, state.unreadCount - 1),\n      }));\n\n      // API call\n      const result = await fetchJSON<{ success: boolean; data?: { unreadCount?: number } }>(\n        `/api/v1/notifications/${id}/read`,\n        { method: 'POST' }\n      );\n\n      console.log('✅ Successfully marked as read:', id);\n\n      // Update unread count from server if provided\n      if (result?.data?.unreadCount !== undefined) {\n        set({ unreadCount: Math.max(0, result.data.unreadCount) });\n      }\n\n    } catch (error) {\n      console.error('💥 Error markAsRead:', error);\n      \n      // Rollback optimistic update\n      set((state) => ({\n        items: state.items.map((item) =>\n          item.id === id ? { ...item, isRead: false } : item\n        ),\n        unreadCount: state.unreadCount + 1,\n      }));\n      \n      throw error; // Re-throw for caller to handle\n    } finally {\n      // Remove from processing set\n      set((state) => {\n        const newMarkingAsRead = new Set(state.markingAsRead);\n        newMarkingAsRead.delete(id);\n        return { ...state, markingAsRead: newMarkingAsRead };\n      });\n    }\n  },\n\n  // ====== READ ALL (optimistic without refetch) ======\n  markAllAsRead: async (params) => {\n    const { scope, vendorId } = params || {};\n\n    const state = get();\n    const unreadBefore = state.items.filter((n) => !n.isRead).length;\n    \n    if (unreadBefore === 0) {\n      console.log('ℹ️ No unread notifications to mark');\n      return;\n    }\n\n    try {\n      console.log('📤 Marking all notifications as read...');\n\n      // Optimistic update\n      set((state) => ({\n        items: state.items.map((item) => ({ ...item, isRead: true })),\n        unreadCount: 0,\n      }));\n\n      // API call\n      await fetchJSON<{ success: boolean; data?: { unreadCount?: number } }>(\n        `/api/v1/notifications/read-all`,\n        {\n          method: 'POST',\n          body: JSON.stringify({ scope, vendorId }),\n        }\n      );\n\n      console.log('✅ Successfully marked all as read');\n\n      // Ensure unread count is 0\n      set({ unreadCount: 0 });\n\n    } catch (error) {\n      console.error('💥 Error markAllAsRead:', error);\n      \n      // Rollback - reload current state\n      const currentItems = get().items;\n      const actualUnreadCount = currentItems.filter(n => !n.isRead).length;\n      set({ unreadCount: actualUnreadCount });\n      \n      throw error;\n    }\n  },\n\n  setLoading: (loading) => set({ loading }),\n\n  setHasMore: (hasMore) => set({ hasMore }),\n\n  setCursor: (cursor) => set({ cursor }),\n\n  // ====== Reload daftar (no-store + cache buster) + scoped ======\n  reload: async (params) => {\n    const {\n      scope = 'vendor',\n      vendorId,\n      cursor = null,\n      pageSize = 20,\n      search,\n      filter = 'all',\n    } = params || {};\n\n    try {\n      set({ loading: true });\n\n      const query = new URLSearchParams();\n      if (scope) query.set('scope', scope);\n      if (scope === 'vendor' && vendorId) query.set('vendorId', vendorId);\n      if (cursor) query.set('cursor', cursor);\n      if (pageSize) query.set('pageSize', String(pageSize));\n      if (search) query.set('search', search);\n      if (filter) query.set('filter', filter);\n\n      const res = await fetchJSON<{\n        success: boolean;\n        data: {\n          data: Notification[];\n          pagination?: { nextCursor?: string | null; hasMore?: boolean };\n        };\n      }>(`/api/v1/notifications?${query.toString()}`);\n\n      const list = res?.data?.data ?? [];\n      const nextCursor = res?.data?.pagination?.nextCursor ?? null;\n      const hasMore = !!res?.data?.pagination?.hasMore;\n\n      const newUnread = list.filter((n) => !n.isRead).length;\n\n      set({\n        items: list,\n        cursor: nextCursor,\n        hasMore,\n        unreadCount: newUnread,\n        loading: false,\n      });\n    } catch (e) {\n      console.error('💥 reload notifications failed:', e);\n      set({ loading: false });\n    }\n  },\n\n  reset: () => set({ ...initialState, markingAsRead: new Set<string>() }),\n}));\n"
        },
        {
          "type": "file",
          "name": "stats.ts",
          "content": "import { create } from 'zustand';\n\ninterface StatsState {\n  // Admin stats\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  totalVendors: number;\n  \n  // Vendor stats\n  vendorTotalSubmissions: number;\n  vendorPendingSubmissions: number;\n  vendorApprovedSubmissions: number;\n  vendorRejectedSubmissions: number;\n  \n  loading: boolean;\n}\n\ninterface StatsActions {\n  updateStats: (changes: Record<string, number | string>) => void;\n  setLoading: (loading: boolean) => void;\n  reset: () => void;\n}\n\nexport type StatsStore = StatsState & StatsActions;\n\nconst initialState: StatsState = {\n  totalSubmissions: 0,\n  pendingSubmissions: 0,\n  approvedSubmissions: 0,\n  rejectedSubmissions: 0,\n  totalVendors: 0,\n  vendorTotalSubmissions: 0,\n  vendorPendingSubmissions: 0,\n  vendorApprovedSubmissions: 0,\n  vendorRejectedSubmissions: 0,\n  loading: false,\n};\n\nexport const useStatsStore = create<StatsStore>((set) => ({\n  ...initialState,\n\n  updateStats: (changes) => set((state) => {\n    const newState = { ...state };\n    \n    Object.entries(changes).forEach(([key, value]) => {\n      if (typeof value === 'number' && key in newState) {\n        (newState as any)[key] = value;\n      }\n    });\n    \n    return newState;\n  }),\n\n  setLoading: (loading) => set({ loading }),\n\n  reset: () => set(initialState),\n}));\n"
        },
        {
          "type": "file",
          "name": "useStatsStore.ts",
          "content": "import { create } from 'zustand';\n\ninterface AdminStats {\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  totalUsers: number;\n  pendingUsers: number;\n  totalVendors: number;\n  totalVerifiers: number;\n  pendingVerificationVendors: number;\n  pendingVerificationSubmissions: number;\n}\n\ninterface VendorStats {\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  draftSubmissions: number;\n  totalApproved: number;\n  totalPending: number;\n  totalRejected: number;\n}\n\ninterface StatsStore {\n  adminStats: AdminStats | null;\n  vendorStats: VendorStats | null;\n  loading: boolean;\n  error: string | null;\n  \n  // Actions\n  setAdminStats: (stats: AdminStats) => void;\n  setVendorStats: (stats: VendorStats) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  fetchAdminStats: () => Promise<void>;\n  fetchVendorStats: () => Promise<void>;\n}\n\nexport const useStatsStore = create<StatsStore>((set) => ({\n  adminStats: null,\n  vendorStats: null,\n  loading: false,\n  error: null,\n\n  setAdminStats: (stats) => set({ adminStats: stats }),\n  setVendorStats: (stats) => set({ vendorStats: stats }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n\n  fetchAdminStats: async () => {\n    try {\n      set({ loading: true, error: null });\n      const response = await fetch('/api/admin/dashboard/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch admin stats');\n      }\n      const stats = await response.json();\n      set({ adminStats: stats, loading: false });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch stats',\n        loading: false \n      });\n    }\n  },\n\n  fetchVendorStats: async () => {\n    try {\n      set({ loading: true, error: null });\n      const response = await fetch('/api/vendor/dashboard/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor stats');\n      }\n      const stats = await response.json();\n      set({ vendorStats: stats, loading: false });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch stats',\n        loading: false \n      });\n    }\n  },\n}));\n"
        },
        {
          "type": "file",
          "name": "useSubmissionStore.ts",
          "content": "import { create } from 'zustand';\n\ninterface Submission {\n  id: string;\n  title: string;\n  status: string;\n  vendor_id: string;\n  created_at: string;\n  updated_at: string;\n  vendor?: {\n    company_name: string;\n  };\n  [key: string]: any;\n}\n\ninterface SubmissionStore {\n  submissions: Submission[];\n  loading: boolean;\n  error: string | null;\n  statistics: {\n    total: number;\n    pending: number;\n    approved: number;\n    rejected: number;\n  } | null;\n  allSubmissionsStats: {\n    total: number;\n    pending: number;\n    approved: number;\n    rejected: number;\n  } | null;\n  filteredTotal: number;\n  \n  // Search and filters\n  searchTerm: string;\n  sortField: string;\n  sortOrder: string;\n  currentPage: number;\n  totalPages: number;\n  \n  // Actions\n  setSubmissions: (submissions: Submission[]) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  setSearchTerm: (term: string) => void;\n  setSortField: (field: string) => void;\n  setSortOrder: (order: string) => void;\n  setCurrentPage: (page: number | ((prev: number) => number)) => void;\n  setTotalPages: (pages: number) => void;\n  setStatistics: (stats: any) => void;\n  setAllSubmissionsStats: (stats: any) => void;\n  \n  // Fetch functions\n  fetchSubmissions: (params?: any) => Promise<void>;\n  fetchVendorSubmissions: (params?: any) => Promise<void>;\n  fetchVendorStats: () => Promise<void>;\n  fetchAdminStats: () => Promise<void>;\n  fetchLatestSubmissions: () => Promise<void>;\n  \n  // CRUD operations\n  updateSubmissionStatus: (id: string, status: string) => Promise<void>;\n  deleteSubmission: (id: string) => Promise<void>;\n}\n\nexport const useSubmissionStore = create<SubmissionStore>((set, get) => ({\n  submissions: [],\n  loading: false,\n  error: null,\n  statistics: null,\n  allSubmissionsStats: null,\n  filteredTotal: 0,\n  \n  searchTerm: '',\n  sortField: 'created_at',\n  sortOrder: 'desc',\n  currentPage: 1,\n  totalPages: 1,\n  \n  setSubmissions: (submissions) => set({ submissions }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\n  setSortField: (sortField) => set({ sortField }),\n  setSortOrder: (sortOrder) => set({ sortOrder }),\n  setCurrentPage: (currentPage) => {\n    if (typeof currentPage === 'function') {\n      set((state) => ({ currentPage: currentPage(state.currentPage) }));\n    } else {\n      set({ currentPage });\n    }\n  },\n  setTotalPages: (totalPages) => set({ totalPages }),\n  setStatistics: (statistics) => set({ statistics }),\n  setAllSubmissionsStats: (allSubmissionsStats) => set({ allSubmissionsStats }),\n  \n  fetchSubmissions: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        sortBy: params.sortBy || 'created_at',\n        sortOrder: params.sortOrder || 'desc',\n        ...(params.search && { search: params.search }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/admin/submissions?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch submissions');\n      }\n      \n      const data = await response.json();\n      console.log('Admin submissions API response:', data); // Debug log\n      set({ \n        submissions: data.submissions || [],\n        totalPages: data.pagination?.pages || 1,\n        filteredTotal: data.pagination?.total || 0,\n        loading: false \n      });\n    } catch (error) {\n      console.error('Error fetching submissions:', error); // Debug log\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n\n  fetchAdminStats: async () => {\n    try {\n      // Fetch statistics without any filters\n      const response = await fetch('/api/admin/submissions/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch admin stats');\n      }\n      \n      const data = await response.json();\n      set({ \n        allSubmissionsStats: data.statistics || null\n      });\n    } catch (error) {\n      console.error('Error fetching admin stats:', error);\n    }\n  },\n  \n  fetchVendorSubmissions: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        sortBy: params.sortBy || 'created_at',\n        sortOrder: params.sortOrder || 'desc',\n        ...(params.search && { search: params.search }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/vendor/submissions?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor submissions');\n      }\n      \n      const data = await response.json();\n      set({ \n        submissions: data.submissions || [],\n        totalPages: data.pagination?.pages || 1,\n        filteredTotal: data.pagination?.total || 0,\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n\n  fetchVendorStats: async () => {\n    try {\n      // Fetch statistics without any filters\n      const response = await fetch('/api/vendor/submissions/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor stats');\n      }\n      \n      const data = await response.json();\n      set({ \n        allSubmissionsStats: data.statistics || null\n      });\n    } catch (error) {\n      console.error('Error fetching vendor stats:', error);\n    }\n  },\n  \n  fetchLatestSubmissions: async () => {\n    try {\n      set({ loading: true, error: null });\n      \n      const response = await fetch('/api/admin/dashboard/recent-submissions');\n      if (!response.ok) {\n        throw new Error('Failed to fetch latest submissions');\n      }\n      \n      const data = await response.json();\n      set({ \n        submissions: data.submissions || [],\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n  \n  updateSubmissionStatus: async (id: string, status: string) => {\n    try {\n      const response = await fetch(`/api/submissions/${id}/status`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ status }),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to update submission status');\n      }\n      \n      // Update local state\n      const submissions = get().submissions.map(sub => \n        sub.id === id ? { ...sub, status } : sub\n      );\n      set({ submissions });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to update submission'\n      });\n      throw error;\n    }\n  },\n  \n  deleteSubmission: async (id: string) => {\n    try {\n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete submission');\n      }\n      \n      // Remove from local state\n      const submissions = get().submissions.filter(sub => sub.id !== id);\n      set({ submissions });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete submission'\n      });\n      throw error;\n    }\n  },\n}));\n"
        },
        {
          "type": "file",
          "name": "useUserStore.ts",
          "content": "import { create } from 'zustand';\n\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  role: string;\n  company_name?: string;\n  status: string;\n  created_at: string;\n  updated_at: string;\n  [key: string]: any;\n}\n\ninterface UserStore {\n  users: User[];\n  pendingUsers: User[];\n  loading: boolean;\n  error: string | null;\n  \n  // Search and filters\n  searchTerm: string;\n  roleFilter: string;\n  statusFilter: string;\n  currentPage: number;\n  totalPages: number;\n  \n  // Actions\n  setUsers: (users: User[]) => void;\n  setPendingUsers: (users: User[]) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  setSearchTerm: (term: string) => void;\n  setRoleFilter: (role: string) => void;\n  setStatusFilter: (status: string) => void;\n  setCurrentPage: (page: number) => void;\n  setTotalPages: (pages: number) => void;\n  \n  // Fetch functions\n  fetchUsers: (params?: any) => Promise<void>;\n  fetchPendingUsers: () => Promise<void>;\n  \n  // CRUD operations\n  approveUser: (id: string) => Promise<void>;\n  rejectUser: (id: string) => Promise<void>;\n  updateUser: (id: string, data: Partial<User>) => Promise<void>;\n  deleteUser: (id: string) => Promise<void>;\n}\n\nexport const useUserStore = create<UserStore>((set, get) => ({\n  users: [],\n  pendingUsers: [],\n  loading: false,\n  error: null,\n  \n  searchTerm: '',\n  roleFilter: '',\n  statusFilter: '',\n  currentPage: 1,\n  totalPages: 1,\n  \n  setUsers: (users) => set({ users }),\n  setPendingUsers: (pendingUsers) => set({ pendingUsers }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\n  setRoleFilter: (roleFilter) => set({ roleFilter }),\n  setStatusFilter: (statusFilter) => set({ statusFilter }),\n  setCurrentPage: (currentPage) => set({ currentPage }),\n  setTotalPages: (totalPages) => set({ totalPages }),\n  \n  fetchUsers: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        ...(params.search && { search: params.search }),\n        ...(params.role && { role: params.role }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/admin/users?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch users');\n      }\n      \n      const data = await response.json();\n      set({ \n        users: data.users || [],\n        totalPages: data.pagination?.pages || 1,\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch users',\n        loading: false \n      });\n    }\n  },\n  \n  fetchPendingUsers: async () => {\n    try {\n      set({ loading: true, error: null });\n      \n      const response = await fetch('/api/admin/users/pending');\n      if (!response.ok) {\n        throw new Error('Failed to fetch pending users');\n      }\n      \n      const data = await response.json();\n      set({ \n        pendingUsers: data.users || [],\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch pending users',\n        loading: false \n      });\n    }\n  },\n  \n  approveUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}/approve`, {\n        method: 'POST',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to approve user');\n      }\n      \n      // Remove from pending users\n      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);\n      set({ pendingUsers });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to approve user'\n      });\n      throw error;\n    }\n  },\n  \n  rejectUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}/reject`, {\n        method: 'POST',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to reject user');\n      }\n      \n      // Remove from pending users\n      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);\n      set({ pendingUsers });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to reject user'\n      });\n      throw error;\n    }\n  },\n  \n  updateUser: async (id: string, data: Partial<User>) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to update user');\n      }\n      \n      // Update local state\n      const users = get().users.map(user => \n        user.id === id ? { ...user, ...data } : user\n      );\n      set({ users });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to update user'\n      });\n      throw error;\n    }\n  },\n  \n  deleteUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}`, {\n        method: 'DELETE',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete user');\n      }\n      \n      // Remove from local state\n      const users = get().users.filter(user => user.id !== id);\n      set({ users });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete user'\n      });\n      throw error;\n    }\n  },\n}));\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "styles",
      "children": [
        {
          "type": "file",
          "name": "auth.css",
          "content": "/* Auth Forms Custom Styles */\n\n/* Enhanced mobile responsiveness */\n@media (max-width: 1024px) {\n  .auth-container {\n    min-height: 100vh;\n    padding: 1rem;\n  }\n  \n  .auth-form {\n    max-width: 100%;\n    margin: 0;\n    border-radius: 1rem;\n  }\n}\n\n@media (max-width: 768px) {\n  .auth-grid {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n  }\n  \n  .auth-input {\n    height: 3rem;\n    font-size: 1rem;\n  }\n  \n  .auth-button {\n    height: 3rem;\n    font-size: 1rem;\n  }\n}\n\n/* Simple transitions - no bounce */\n.auth-input:focus {\n  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);\n}\n\n.auth-button:hover:not(:disabled) {\n  background-color: #1d4ed8;\n}\n\n/* Loading animation enhancement */\n.spinner-border {\n  display: inline-block;\n  width: 1rem;\n  height: 1rem;\n  vertical-align: text-bottom;\n  border: 2px solid currentColor;\n  border-right-color: transparent;\n  border-radius: 50%;\n  animation: spinner 0.75s linear infinite;\n}\n\n@keyframes spinner {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* Simple background - no animation */\n.bg-pattern {\n  background: transparent;\n}\n\n/* Form field enhancements */\n.form-field-wrapper {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n}\n\n.form-field-wrapper label {\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n  color: #374151;\n}\n\n.form-field-wrapper input:focus + label,\n.form-field-wrapper input:not(:placeholder-shown) + label {\n  transform: translateY(-0.5rem);\n  font-size: 0.875rem;\n  color: #3B82F6;\n}\n\n/* Enhanced error styling */\n.error-message {\n  background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);\n  border-left: 4px solid #EF4444;\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1.5rem;\n  animation: slideDown 0.3s ease-out;\n}\n\n@keyframes slideDown {\n  from {\n    opacity: 0;\n    transform: translateY(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* Logo styling - no animation */\n.logo-animation {\n  transition: opacity 0.3s ease;\n}"
        },
        {
          "type": "file",
          "name": "datepicker.css",
          "content": "/* Custom DatePicker Styles */\n#datepicker-portal {\n  z-index: 9999;\n  position: relative;\n}\n\n.react-datepicker-wrapper {\n  width: 100%;\n}\n\n.react-datepicker__input-container {\n  width: 100%;\n}\n\n.react-datepicker-popper {\n  z-index: 9999 !important;\n  position: fixed !important;\n}\n\n.react-datepicker-calendar {\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  font-family: inherit;\n  background: white;\n  z-index: 9999;\n}\n\n/* Ensure datepicker appears above modal overlays */\n.react-datepicker__tab-loop {\n  z-index: 9999 !important;\n  position: relative;\n}\n\n/* Fix for modal overflow issues */\n.fixed.inset-0.z-50.overflow-y-auto:has(.react-datepicker-popper) {\n  overflow: visible !important;\n}\n\n/* Alternative approach - ensure datepicker container is not clipped */\n.react-datepicker__tab-loop__div {\n  position: static !important;\n}\n\n/* Ensure proper layering in modals */\n.react-datepicker__month-container {\n  z-index: 9999;\n}\n\n/* Portal-specific styles */\n.react-datepicker__portal {\n  z-index: 9999 !important;\n  position: fixed !important;\n}\n\n.react-datepicker__portal .react-datepicker {\n  z-index: 9999 !important;\n  position: relative !important;\n}\n\n.react-datepicker__header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  border-radius: 0.5rem 0.5rem 0 0;\n  padding: 0.75rem;\n}\n\n.react-datepicker__current-month {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  margin-bottom: 0.5rem;\n}\n\n.react-datepicker__day-names {\n  margin-bottom: 0.25rem;\n}\n\n.react-datepicker__day-name {\n  color: #6b7280;\n  font-size: 0.75rem;\n  font-weight: 500;\n  width: 2rem;\n  line-height: 2rem;\n}\n\n.react-datepicker__month {\n  margin: 0.5rem;\n}\n\n.react-datepicker__day {\n  color: #374151;\n  font-size: 0.875rem;\n  width: 2rem;\n  line-height: 2rem;\n  border-radius: 0.375rem;\n  transition: all 0.15s ease-in-out;\n}\n\n.react-datepicker__day:hover {\n  background-color: #eff6ff;\n  color: #2563eb;\n}\n\n.react-datepicker__day--selected {\n  background-color: #2563eb;\n  color: white;\n}\n\n.react-datepicker__day--selected:hover {\n  background-color: #1d4ed8;\n}\n\n.react-datepicker__day--keyboard-selected {\n  background-color: #dbeafe;\n  color: #2563eb;\n}\n\n.react-datepicker__day--today {\n  background-color: #fef3c7;\n  color: #92400e;\n  font-weight: 600;\n}\n\n.react-datepicker__day--disabled {\n  color: #d1d5db;\n  cursor: not-allowed;\n}\n\n.react-datepicker__day--disabled:hover {\n  background-color: transparent;\n  color: #d1d5db;\n}\n\n.react-datepicker__day--outside-month {\n  color: #d1d5db;\n}\n\n.react-datepicker__navigation {\n  background: none;\n  border: none;\n  top: 0.75rem;\n  width: 2rem;\n  height: 2rem;\n  border-radius: 0.375rem;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__navigation:hover {\n  background-color: #f3f4f6;\n}\n\n.react-datepicker__navigation--previous {\n  left: 0.75rem;\n}\n\n.react-datepicker__navigation--next {\n  right: 0.75rem;\n}\n\n.react-datepicker__navigation-icon::before {\n  border-color: #6b7280;\n  border-width: 2px 2px 0 0;\n  width: 0.5rem;\n  height: 0.5rem;\n}\n\n.react-datepicker__today-button {\n  background-color: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  border-radius: 0 0 0.5rem 0.5rem;\n  color: #2563eb;\n  font-size: 0.875rem;\n  padding: 0.5rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__today-button:hover {\n  background-color: #f3f4f6;\n}\n\n/* Time picker styles */\n.react-datepicker__time-container {\n  border-left: 1px solid #e5e7eb;\n}\n\n.react-datepicker__time {\n  background: white;\n  border-radius: 0 0.5rem 0.5rem 0;\n}\n\n.react-datepicker__time-box {\n  width: 85px;\n}\n\n.react-datepicker__time-list {\n  height: 200px !important;\n}\n\n.react-datepicker__time-list-item {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.875rem;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__time-list-item:hover {\n  background-color: #eff6ff;\n  color: #2563eb;\n}\n\n.react-datepicker__time-list-item--selected {\n  background-color: #2563eb;\n  color: white;\n}\n\n.react-datepicker__time-list-item--selected:hover {\n  background-color: #1d4ed8;\n}\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "types",
      "children": [
        {
          "type": "file",
          "name": "next.auth.d.ts",
          "content": "import NextAuth, { DefaultSession, DefaultUser } from \"next-auth\";\nimport { Role, VerificationStatus } from \"@prisma/client\";\n\ndeclare module \"next-auth\" {\n  interface Session {\n    user: {\n      id: string;\n      role: Role;\n      officer_name: string;\n      vendor_name?: string | null;\n      verified_at?: Date | null;\n      verification_status?: VerificationStatus;\n      created_at?: Date;\n    } & DefaultSession[\"user\"];\n    accessToken?: string;\n  }\n\n  interface User extends DefaultUser {\n    role: Role;\n    officer_name: string;\n    vendor_name?: string | null;\n    verified_at?: Date | null;\n    verification_status?: VerificationStatus;\n    created_at?: Date;\n  }\n}\n\ndeclare module \"next-auth/jwt\" {\n  interface JWT {\n    id?: string;\n    role?: Role;\n    officer_name?: string;\n    vendor_name?: string | null;\n    verified_at?: Date | null;\n    verification_status?: VerificationStatus;\n    created_at?: Date;\n    accessToken?: string;\n  }\n}\n"
        },
        {
          "type": "file",
          "name": "submission.ts",
          "content": "export interface SubmissionData {\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation?: string; // akan diisi oleh admin saat approve\n  working_hours: string;\n  other_notes?: string; // akan diisi oleh admin saat approve\n  work_facilities: string;\n  worker_count?: number; // jumlah pekerja\n  simja_number?: string;\n  simja_date?: string;\n  sika_number?: string;\n  sika_date?: string;\n  worker_names: string;\n  content?: string; // akan diisi oleh admin saat approve\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n}\n\nexport interface SubmissionApprovalData {\n  approval_status: 'APPROVED' | 'REJECTED';\n  notes?: string;\n  simlok_number?: string;\n  simlok_date?: string;\n  implementation_start_date?: string;\n  implementation_end_date?: string;\n}\n\nexport interface WorkerList {\n  id: string;\n  worker_name: string;\n  worker_photo?: string | null;\n  submission_id: string;\n  created_at: Date;\n}\n\nexport type SubmissionStatus = 'PENDING' | 'APPROVED' | 'REJECTED';\n"
        },
        {
          "type": "file",
          "name": "user.ts",
          "content": "import { User_role as Role, VerificationStatus } from \"@prisma/client\";\n\nexport interface UserData {\n  id: string;\n  officer_name: string;\n  email: string;\n  role: Role;\n  address?: string | null;\n  phone_number?: string | null;\n  vendor_name?: string | null;\n  created_at: string | Date;\n  verified_at?: string | Date | null;\n  verified_by?: string | null;\n  verification_status?: VerificationStatus;\n  rejected_at?: string | Date | null;\n  rejected_by?: string | null;\n  rejection_reason?: string | null;\n  profile_photo?: string | null;\n}\n"
        }
      ]
    },
    {
      "type": "directory",
      "name": "utils",
      "children": [
        {
          "type": "file",
          "name": "file-validation.ts",
          "content": "/**\n * File validation utilities for consistent file size and type validation across the application\n */\n\n// File size constants\nexport const FILE_SIZE_LIMITS = {\n  DEFAULT: 8, // 8MB default limit\n  IMAGE: 8,   // 8MB for images\n  DOCUMENT: 8, // 8MB for documents\n} as const;\n\n// Allowed file types and extensions\nexport const ALLOWED_FILE_TYPES = {\n  DOCUMENTS: [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  ],\n  IMAGES: [\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'image/gif'\n  ],\n  ALL: [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'image/gif'\n  ]\n} as const;\n\nexport const ALLOWED_FILE_EXTENSIONS = {\n  DOCUMENTS: ['.pdf', '.doc', '.docx'],\n  IMAGES: ['.jpg', '.jpeg', '.png', '.gif'],\n  ALL: ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif']\n} as const;\n\nexport interface FileValidationOptions {\n  maxSizeMB?: number;\n  allowedTypes?: readonly string[];\n  allowedExtensions?: readonly string[];\n}\n\nexport interface FileValidationResult {\n  isValid: boolean;\n  error?: string;\n  size?: number;\n  type?: string;\n  extension?: string;\n}\n\n/**\n * Validates file size, type, and extension\n */\nexport function validateFile(\n  file: File, \n  options: FileValidationOptions = {}\n): FileValidationResult {\n  const {\n    maxSizeMB = FILE_SIZE_LIMITS.DEFAULT,\n    allowedTypes = ALLOWED_FILE_TYPES.ALL,\n    allowedExtensions = ALLOWED_FILE_EXTENSIONS.ALL\n  } = options;\n\n  // Check file size (convert MB to bytes)\n  const maxSizeBytes = maxSizeMB * 1024 * 1024;\n  if (file.size > maxSizeBytes) {\n    return {\n      isValid: false,\n      error: `Ukuran file terlalu besar. Maksimal ${maxSizeMB}MB`,\n      size: file.size\n    };\n  }\n\n  // Check file type\n  if (!allowedTypes.includes(file.type as any)) {\n    return {\n      isValid: false,\n      error: `Tipe file tidak didukung. Tipe yang diizinkan: ${allowedExtensions.join(', ')}`,\n      type: file.type\n    };\n  }\n\n  // Check file extension\n  const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n  if (!allowedExtensions.includes(fileExtension as any)) {\n    return {\n      isValid: false,\n      error: `Ekstensi file tidak didukung. Ekstensi yang diizinkan: ${allowedExtensions.join(', ')}`,\n      extension: fileExtension\n    };\n  }\n\n  return {\n    isValid: true,\n    size: file.size,\n    type: file.type,\n    extension: fileExtension\n  };\n}\n\n/**\n * Validates file for document uploads (PDF, DOC, DOCX)\n */\nexport function validateDocumentFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.DOCUMENT): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: [...ALLOWED_FILE_TYPES.DOCUMENTS],\n    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.DOCUMENTS]\n  });\n}\n\n/**\n * Validates file for image uploads (JPG, JPEG, PNG, GIF)\n */\nexport function validateImageFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: [...ALLOWED_FILE_TYPES.IMAGES],\n    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.IMAGES]\n  });\n}\n\n/**\n * Validates file for worker photo uploads (JPG, JPEG, PNG only)\n */\nexport function validateWorkerPhotoFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: ['image/jpeg', 'image/jpg', 'image/png'],\n    allowedExtensions: ['.jpg', '.jpeg', '.png']\n  });\n}\n\n/**\n * Format file size in human readable format\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * Convert MB to bytes\n */\nexport function mbToBytes(mb: number): number {\n  return mb * 1024 * 1024;\n}\n\n/**\n * Convert bytes to MB\n */\nexport function bytesToMB(bytes: number): number {\n  return bytes / (1024 * 1024);\n}"
        },
        {
          "type": "file",
          "name": "image-compression.ts",
          "content": "/**\n * Image Compression Utility\n * Kompres gambar untuk foto pekerja dengan tetap mempertahankan kualitas visual\n */\n\ninterface CompressionOptions {\n  maxWidth?: number;\n  maxHeight?: number;\n  quality?: number;\n  outputFormat?: 'jpeg' | 'webp' | 'png';\n  maxSizeKB?: number;\n}\n\ninterface CompressionResult {\n  file: File;\n  originalSize: number;\n  compressedSize: number;\n  compressionRatio: number;\n  format: string;\n}\n\nexport class ImageCompressor {\n  /**\n   * Compress image file for worker photos\n   */\n  static async compressWorkerPhoto(\n    file: File, \n    options: CompressionOptions = {}\n  ): Promise<CompressionResult> {\n    const defaultOptions: CompressionOptions = {\n      maxWidth: 800,\n      maxHeight: 600,\n      quality: 0.85, // 85% quality untuk menjaga ketajaman\n      outputFormat: 'jpeg',\n      maxSizeKB: 500 // Max 500KB untuk foto pekerja\n    };\n\n    const config = { ...defaultOptions, ...options };\n    const originalSize = file.size;\n\n    // Create canvas untuk kompresi\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (!ctx) throw new Error('Canvas context not available');\n\n    // Load image\n    const img = await this.loadImage(file);\n\n    // Calculate new dimensions\n    const { width, height } = this.calculateDimensions(\n      img.width, \n      img.height, \n      config.maxWidth!, \n      config.maxHeight!\n    );\n\n    // Set canvas size\n    canvas.width = width;\n    canvas.height = height;\n\n    // Enable image smoothing untuk kualitas yang lebih baik\n    ctx.imageSmoothingEnabled = true;\n    ctx.imageSmoothingQuality = 'high';\n\n    // Draw and compress\n    ctx.drawImage(img, 0, 0, width, height);\n\n    // Convert to blob dengan kualitas yang disesuaikan\n    let quality = config.quality!;\n    let compressedBlob: Blob;\n\n    do {\n      compressedBlob = await new Promise<Blob>((resolve) => {\n        canvas.toBlob(\n          (blob) => resolve(blob!),\n          `image/${config.outputFormat}`,\n          quality\n        );\n      });\n\n      // Jika masih terlalu besar, kurangi kualitas\n      if (compressedBlob.size > config.maxSizeKB! * 1024 && quality > 0.3) {\n        quality -= 0.1;\n      } else {\n        break;\n      }\n    } while (quality > 0.3);\n\n    // Create new file\n    const compressedFile = new File(\n      [compressedBlob], \n      this.generateFileName(file.name, config.outputFormat!),\n      { type: `image/${config.outputFormat}` }\n    );\n\n    return {\n      file: compressedFile,\n      originalSize,\n      compressedSize: compressedFile.size,\n      compressionRatio: Math.round((1 - compressedFile.size / originalSize) * 100),\n      format: config.outputFormat!\n    };\n  }\n\n  /**\n   * Load image from file\n   */\n  private static loadImage(file: File): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => resolve(img);\n      img.onerror = reject;\n      img.src = URL.createObjectURL(file);\n    });\n  }\n\n  /**\n   * Calculate optimal dimensions maintaining aspect ratio\n   */\n  private static calculateDimensions(\n    originalWidth: number,\n    originalHeight: number,\n    maxWidth: number,\n    maxHeight: number\n  ): { width: number; height: number } {\n    let { width, height } = { width: originalWidth, height: originalHeight };\n\n    if (width > maxWidth) {\n      height = (height * maxWidth) / width;\n      width = maxWidth;\n    }\n\n    if (height > maxHeight) {\n      width = (width * maxHeight) / height;\n      height = maxHeight;\n    }\n\n    return { width: Math.round(width), height: Math.round(height) };\n  }\n\n  /**\n   * Generate filename with new extension\n   */\n  private static generateFileName(originalName: string, format: string): string {\n    const nameWithoutExt = originalName.replace(/\\.[^/.]+$/, '');\n    return `${nameWithoutExt}_compressed.${format}`;\n  }\n\n  /**\n   * Validate if file is a valid image for worker photo\n   */\n  static validateWorkerPhoto(file: File): { isValid: boolean; error?: string } {\n    // Check file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\n    if (!allowedTypes.includes(file.type)) {\n      return {\n        isValid: false,\n        error: 'Hanya file gambar (JPG, JPEG, PNG) yang diperbolehkan untuk foto pekerja'\n      };\n    }\n\n    // Check file size (max 10MB before compression)\n    const maxSize = 10 * 1024 * 1024; // 10MB\n    if (file.size > maxSize) {\n      return {\n        isValid: false,\n        error: 'Ukuran file terlalu besar. Maksimal 10MB sebelum kompresi'\n      };\n    }\n\n    // Check file extension\n    const allowedExtensions = ['.jpg', '.jpeg', '.png'];\n    const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!allowedExtensions.includes(fileExt)) {\n      return {\n        isValid: false,\n        error: 'Ekstensi file tidak valid. Gunakan .jpg, .jpeg, atau .png'\n      };\n    }\n\n    return { isValid: true };\n  }\n\n  /**\n   * Validate document files (for SIKA/SIMJA)\n   */\n  static validateDocumentFile(file: File): { isValid: boolean; error?: string } {\n    // Allow both images and documents for SIKA/SIMJA\n    const allowedTypes = [\n      'image/jpeg', 'image/jpg', 'image/png',\n      'application/pdf', \n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n    ];\n\n    if (!allowedTypes.includes(file.type)) {\n      return {\n        isValid: false,\n        error: 'File harus berupa gambar (JPG, PNG) atau dokumen (PDF, DOC, DOCX)'\n      };\n    }\n\n    // Check file size (max 8MB)\n    const maxSize = 8 * 1024 * 1024; // 8MB\n    if (file.size > maxSize) {\n      return {\n        isValid: false,\n        error: 'Ukuran file terlalu besar. Maksimal 8MB'\n      };\n    }\n\n    const allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'];\n    const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!allowedExtensions.includes(fileExt)) {\n      return {\n        isValid: false,\n        error: 'Ekstensi file tidak valid'\n      };\n    }\n\n    return { isValid: true };\n  }\n}"
        },
        {
          "type": "file",
          "name": "input-validation.ts",
          "content": "/**\n * Enhanced Input Validation Utilities\n * Validasi yang lebih ketat untuk berbagai tipe input\n */\n\nexport interface ValidationResult {\n  isValid: boolean;\n  error?: string;\n  sanitizedValue?: string;\n}\n\nexport class InputValidator {\n  /**\n   * Validate name fields (only letters, spaces, and common name characters)\n   */\n  static validateName(value: string, fieldName: string = 'Nama'): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: `${fieldName} wajib diisi` };\n    }\n\n    const trimmedValue = value.trim();\n\n    // Check minimum length\n    if (trimmedValue.length < 2) {\n      return { isValid: false, error: `${fieldName} minimal 2 karakter` };\n    }\n\n    // Check maximum length\n    if (trimmedValue.length > 100) {\n      return { isValid: false, error: `${fieldName} maksimal 100 karakter` };\n    }\n\n    // Only allow letters, spaces, apostrophes, hyphens, and dots\n    const nameRegex = /^[a-zA-Z\\s.''-]+$/;\n    if (!nameRegex.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: `${fieldName} hanya boleh berisi huruf, spasi, tanda petik, tanda hubung, dan titik` \n      };\n    }\n\n    // Check for multiple consecutive spaces\n    if (/\\s{2,}/.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: `${fieldName} tidak boleh memiliki lebih dari satu spasi berturut-turut` \n      };\n    }\n\n    // Sanitize: capitalize first letter of each word\n    const sanitizedValue = trimmedValue\n      .toLowerCase()\n      .split(' ')\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ');\n\n    return { isValid: true, sanitizedValue };\n  }\n\n  /**\n   * Validate phone number (Indonesian format)\n   */\n  static validatePhoneNumber(value: string): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: 'Nomor telepon wajib diisi' };\n    }\n\n    const trimmedValue = value.trim();\n\n    // Remove all non-numeric characters for validation\n    const numbersOnly = trimmedValue.replace(/[^0-9]/g, '');\n\n    // Check if it's all numbers (after cleaning)\n    if (!/^[0-9+\\-\\s()]*$/.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: 'Nomor telepon hanya boleh berisi angka, +, -, (, ), dan spasi' \n      };\n    }\n\n    // Check length (Indonesian phone numbers)\n    if (numbersOnly.length < 10 || numbersOnly.length > 15) {\n      return { \n        isValid: false, \n        error: 'Nomor telepon harus 10-15 digit' \n      };\n    }\n\n    // Validate Indonesian phone number patterns\n    if (numbersOnly.startsWith('08')) {\n      // Mobile number format: 08xx-xxxx-xxxx\n      if (numbersOnly.length < 11 || numbersOnly.length > 13) {\n        return { \n          isValid: false, \n          error: 'Nomor HP Indonesia harus 11-13 digit (dimulai dengan 08)' \n        };\n      }\n    } else if (numbersOnly.startsWith('62')) {\n      // International format: +62xxx\n      if (numbersOnly.length < 12 || numbersOnly.length > 15) {\n        return { \n          isValid: false, \n          error: 'Nomor internasional (+62) harus 12-15 digit' \n        };\n      }\n    } else if (!numbersOnly.startsWith('0')) {\n      return { \n        isValid: false, \n        error: 'Nomor telepon harus dimulai dengan 08 (HP) atau 02/03/04/05/06/07 (telepon rumah)' \n      };\n    }\n\n    // Sanitize: format phone number\n    let sanitizedValue: string;\n    if (numbersOnly.startsWith('08')) {\n      // Format: 0812-3456-7890\n      sanitizedValue = numbersOnly.replace(/(\\d{4})(\\d{4})(\\d+)/, '$1-$2-$3');\n    } else if (numbersOnly.startsWith('62')) {\n      // Format: +62-812-3456-7890\n      sanitizedValue = `+${numbersOnly.replace(/(\\d{2})(\\d{3})(\\d{4})(\\d+)/, '$1-$2-$3-$4')}`;\n    } else {\n      sanitizedValue = trimmedValue;\n    }\n\n    return { isValid: true, sanitizedValue };\n  }\n\n  /**\n   * Validate address (letters, numbers, spaces, and common address characters)\n   */\n  static validateAddress(value: string): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: 'Alamat wajib diisi' };\n    }\n\n    const trimmedValue = value.trim();\n\n    // Check minimum length\n    if (trimmedValue.length < 10) {\n      return { isValid: false, error: 'Alamat minimal 10 karakter' };\n    }\n\n    // Check maximum length\n    if (trimmedValue.length > 500) {\n      return { isValid: false, error: 'Alamat maksimal 500 karakter' };\n    }\n\n    // Allow letters, numbers, spaces, and common address characters\n    const addressRegex = /^[a-zA-Z0-9\\s.,\\-\\/'#()]+$/;\n    if (!addressRegex.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: 'Alamat hanya boleh berisi huruf, angka, spasi, dan karakter .,\\-\\/\\'#()' \n      };\n    }\n\n    // Check for multiple consecutive spaces\n    if (/\\s{3,}/.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: 'Alamat tidak boleh memiliki lebih dari dua spasi berturut-turut' \n      };\n    }\n\n    // Sanitize: proper case and clean up spaces\n    const sanitizedValue = trimmedValue\n      .replace(/\\s+/g, ' ') // Replace multiple spaces with single space\n      .split(' ')\n      .map(word => {\n        // Don't capitalize prepositions and articles\n        const lowerCaseWords = ['di', 'ke', 'dari', 'jalan', 'jl', 'rt', 'rw', 'no', 'kel', 'kec'];\n        if (lowerCaseWords.includes(word.toLowerCase())) {\n          return word.toLowerCase();\n        }\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      })\n      .join(' ');\n\n    return { isValid: true, sanitizedValue };\n  }\n\n  /**\n   * Validate email\n   */\n  static validateEmail(value: string): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: 'Email wajib diisi' };\n    }\n\n    const trimmedValue = value.trim().toLowerCase();\n\n    // Basic email regex\n    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n    if (!emailRegex.test(trimmedValue)) {\n      return { isValid: false, error: 'Format email tidak valid' };\n    }\n\n    // Check length\n    if (trimmedValue.length > 254) {\n      return { isValid: false, error: 'Email terlalu panjang (maksimal 254 karakter)' };\n    }\n\n    // Check for common typos\n    const emailParts = trimmedValue.split('@');\n    if (emailParts.length === 2) {\n      const domain = emailParts[1];\n      if (domain && (domain.includes('gmial') || domain.includes('gmai'))) {\n        return { isValid: false, error: 'Mungkin Anda maksud gmail.com?' };\n      }\n    }\n\n    return { isValid: true, sanitizedValue: trimmedValue };\n  }\n\n  /**\n   * Validate vendor/company name\n   */\n  static validateVendorName(value: string): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: 'Nama vendor wajib diisi' };\n    }\n\n    const trimmedValue = value.trim();\n\n    // Check minimum length\n    if (trimmedValue.length < 2) {\n      return { isValid: false, error: 'Nama vendor minimal 2 karakter' };\n    }\n\n    // Check maximum length\n    if (trimmedValue.length > 150) {\n      return { isValid: false, error: 'Nama vendor maksimal 150 karakter' };\n    }\n\n    // Allow letters, numbers, spaces, and common company characters\n    const vendorRegex = /^[a-zA-Z0-9\\s.,\\-&()\\/']+$/;\n    if (!vendorRegex.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: 'Nama vendor hanya boleh berisi huruf, angka, spasi, dan karakter .,\\-&()\\/' \n      };\n    }\n\n    // Sanitize: proper case\n    const sanitizedValue = trimmedValue\n      .split(' ')\n      .map(word => {\n        // Keep certain abbreviations uppercase\n        const upperCaseWords = ['PT', 'CV', 'UD', 'PD', 'TBK', 'LLC', 'LTD', 'INC'];\n        if (upperCaseWords.includes(word.toUpperCase())) {\n          return word.toUpperCase();\n        }\n        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n      })\n      .join(' ');\n\n    return { isValid: true, sanitizedValue };\n  }\n\n  /**\n   * Validate job description\n   */\n  static validateJobDescription(value: string): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: 'Deskripsi pekerjaan wajib diisi' };\n    }\n\n    const trimmedValue = value.trim();\n\n    // Check minimum length\n    if (trimmedValue.length < 5) {\n      return { isValid: false, error: 'Deskripsi pekerjaan minimal 5 karakter' };\n    }\n\n    // Check maximum length\n    if (trimmedValue.length > 200) {\n      return { isValid: false, error: 'Deskripsi pekerjaan maksimal 200 karakter' };\n    }\n\n    // Allow letters, numbers, spaces, and common description characters\n    const jobRegex = /^[a-zA-Z0-9\\s.,\\-\\/()&+]+$/;\n    if (!jobRegex.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: 'Deskripsi pekerjaan hanya boleh berisi huruf, angka, spasi, dan karakter .,\\-\\/()&+' \n      };\n    }\n\n    // Sanitize: sentence case\n    const sanitizedValue = trimmedValue.charAt(0).toUpperCase() + trimmedValue.slice(1);\n\n    return { isValid: true, sanitizedValue };\n  }\n\n  /**\n   * Validate document number (SIKA, SIMJA, etc.)\n   */\n  static validateDocumentNumber(value: string, documentType: string = 'Dokumen'): ValidationResult {\n    if (!value || value.trim().length === 0) {\n      return { isValid: false, error: `Nomor ${documentType} wajib diisi` };\n    }\n\n    const trimmedValue = value.trim().toUpperCase();\n\n    // Allow letters, numbers, slashes, hyphens, and dots\n    const docNumberRegex = /^[A-Z0-9\\/\\-\\.]+$/;\n    if (!docNumberRegex.test(trimmedValue)) {\n      return { \n        isValid: false, \n        error: `Nomor ${documentType} hanya boleh berisi huruf besar, angka, /, -, dan .` \n      };\n    }\n\n    // Check length\n    if (trimmedValue.length < 3) {\n      return { isValid: false, error: `Nomor ${documentType} minimal 3 karakter` };\n    }\n\n    if (trimmedValue.length > 50) {\n      return { isValid: false, error: `Nomor ${documentType} maksimal 50 karakter` };\n    }\n\n    return { isValid: true, sanitizedValue: trimmedValue };\n  }\n\n  /**\n   * Validate number inputs\n   */\n  static validateNumber(\n    value: string | number, \n    min?: number, \n    max?: number, \n    fieldName: string = 'Angka'\n  ): ValidationResult {\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\n\n    if (isNaN(numValue)) {\n      return { isValid: false, error: `${fieldName} harus berupa angka` };\n    }\n\n    if (min !== undefined && numValue < min) {\n      return { isValid: false, error: `${fieldName} minimal ${min}` };\n    }\n\n    if (max !== undefined && numValue > max) {\n      return { isValid: false, error: `${fieldName} maksimal ${max}` };\n    }\n\n    return { isValid: true, sanitizedValue: numValue.toString() };\n  }\n}"
        },
        {
          "type": "file",
          "name": "jwt-config.ts",
          "content": "// src/utils/jwt-config.ts\n\n/**\n * JWT Configuration utilities\n * Allows customization of JWT expiry times through environment variables\n */\n\nexport const JWT_CONFIG = {\n  // Default: 24 hours (86400 seconds)\n  JWT_EXPIRE_TIME: parseInt(process.env.JWT_EXPIRE_TIME || '86400'),\n  \n  // Default: 24 hours (86400 seconds)\n  SESSION_MAX_AGE: parseInt(process.env.SESSION_MAX_AGE || '86400'),\n  \n  // Default: 1 hour (3600 seconds) - how often session gets updated when user is active\n  SESSION_UPDATE_AGE: parseInt(process.env.SESSION_UPDATE_AGE || '3600'),\n  \n  // Client-side warning time (in minutes before expiry)\n  WARNING_BEFORE_EXPIRY: parseInt(process.env.WARNING_BEFORE_EXPIRY || '5'),\n  \n  // Auto refresh interval (in minutes)\n  AUTO_REFRESH_INTERVAL: parseInt(process.env.AUTO_REFRESH_INTERVAL || '30'),\n} as const;\n\nexport const formatExpiryTime = (seconds: number): string => {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  \n  if (hours > 0) {\n    return `${hours}h ${minutes}m`;\n  }\n  return `${minutes}m`;\n};\n\nexport const getExpiryDate = (fromNow: number = JWT_CONFIG.JWT_EXPIRE_TIME): Date => {\n  return new Date(Date.now() + (fromNow * 1000));\n};\n\nexport const isTokenExpired = (exp: number): boolean => {\n  const now = Date.now() / 1000;\n  return now >= exp;\n};\n\nexport const getTimeUntilExpiry = (exp: number): number => {\n  const now = Date.now() / 1000;\n  return Math.max(0, exp - now);\n};\n"
        },
        {
          "type": "directory",
          "name": "pdf",
          "children": [
            {
              "type": "file",
              "name": "constants.ts",
              "content": "// Constants shared across photo loading and processing\nexport const MAX_IMAGE_SIZE = 800;\nexport const MAX_CONCURRENT_LOADS = 3;"
            },
            {
              "type": "file",
              "name": "imageLoader.ts",
              "content": "import { PDFDocument, PDFImage } from \"pdf-lib\";\nimport { optimizeImage } from \"./imageOptimizer\";\n\n// Ensure this module only runs on server-side\nif (typeof window !== 'undefined') {\n  throw new Error('imageLoader should only be used on server-side');\n}\n\nconst MAX_CACHE_SIZE = 20;\nconst MAX_BATCH_SIZE = 3;\nconst BATCH_DELAY = 100; // ms between batches\n\n// LRU Cache for processed images\nclass ImageCache {\n  private cache = new Map<string, {\n    image: PDFImage;\n    lastAccessed: number;\n  }>();\n\n  get(key: string): PDFImage | undefined {\n    const item = this.cache.get(key);\n    if (item) {\n      item.lastAccessed = Date.now();\n      return item.image;\n    }\n    return undefined;\n  }\n\n  set(key: string, image: PDFImage): void {\n    // Clean old entries if needed\n    if (this.cache.size >= MAX_CACHE_SIZE) {\n      // Sort by last accessed time and remove oldest\n      const entries = Array.from(this.cache.entries());\n      entries.sort((a, b) => a[1].lastAccessed - b[1].lastAccessed);\n      \n      // Remove oldest entries\n      const toRemove = entries.slice(0, entries.length - MAX_CACHE_SIZE + 1);\n      toRemove.forEach(([key]) => this.cache.delete(key));\n    }\n\n    this.cache.set(key, {\n      image,\n      lastAccessed: Date.now()\n    });\n  }\n\n  delete(key: string): void {\n    this.cache.delete(key);\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  has(key: string): boolean {\n    return this.cache.has(key);\n  }\n}\n\n// Singleton cache instance\nconst imageCache = new ImageCache();\n\n/**\n * Load and process image from base64 string\n */\nasync function loadBase64Image(\n  pdfDoc: PDFDocument,\n  base64Data: string,\n  isPng: boolean\n): Promise<PDFImage | null> {\n  try {\n    // Convert base64 to buffer\n    const imageBuffer = Buffer.from(base64Data, 'base64');\n    \n    // Optimize image\n    const optimizedBuffer = await optimizeImage(imageBuffer);\n    \n    // Embed in PDF\n    return isPng\n      ? await pdfDoc.embedPng(optimizedBuffer)\n      : await pdfDoc.embedJpg(optimizedBuffer);\n  } catch (error) {\n    console.warn('Failed to process base64 image:', error);\n    return null;\n  }\n}\n\n/**\n * Load and process image from filesystem\n */\nasync function loadFileImage(\n  pdfDoc: PDFDocument,\n  filePath: string,\n  isPng: boolean\n): Promise<PDFImage | null> {\n  try {\n    const fs = await import('fs');\n    if (!fs.existsSync(filePath)) {\n      console.warn('File does not exist:', filePath);\n      return null;\n    }\n\n    // Read and optimize image\n    const imageBuffer = fs.readFileSync(filePath);\n    const optimizedBuffer = await optimizeImage(imageBuffer);\n\n    // Embed in PDF\n    return isPng\n      ? await pdfDoc.embedPng(optimizedBuffer)\n      : await pdfDoc.embedJpg(optimizedBuffer);\n  } catch (error) {\n    console.warn('Failed to process file image:', error);\n    return null;\n  }\n}\n\n/**\n * Load worker photo with improved error handling and caching\n */\nexport async function loadWorkerPhoto(\n  pdfDoc: PDFDocument,\n  photoPath?: string | null\n): Promise<PDFImage | null> {\n  if (!photoPath) {\n    console.log('LoadWorkerPhoto: No photo path provided');\n    return null;\n  }\n\n  console.log('LoadWorkerPhoto: Loading photo from path:', photoPath);\n\n  try {\n    // Check cache first with validation\n    const cached = imageCache.get(photoPath);\n    if (cached) {\n      try {\n        // Validate cached image\n        const imgDims = cached.scale(1);\n        if (imgDims.width > 0 && imgDims.height > 0) {\n          console.log('LoadWorkerPhoto: Using cached image for:', photoPath);\n          return cached;\n        } else {\n          console.warn('LoadWorkerPhoto: Removing invalid cached image with zero dimensions');\n          imageCache.delete(photoPath);\n        }\n      } catch (error) {\n        console.warn('LoadWorkerPhoto: Invalid cached image, removing from cache:', error);\n        imageCache.delete(photoPath);\n      }\n    }\n\n    let resultImage: PDFImage | null = null;\n    const timestamp = Date.now();\n\n    if (photoPath.startsWith('data:image/') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {\n      console.log('LoadWorkerPhoto: Processing base64 image');\n      // Handle base64 data\n      const isPng = photoPath.includes('image/png');\n      let base64Data = photoPath;\n\n      if (photoPath.startsWith('data:')) {\n        const parts = photoPath.split(',');\n        base64Data = parts[parts.length - 1] || '';\n      }\n\n      resultImage = await loadBase64Image(pdfDoc, base64Data, isPng);\n    } else if (photoPath.startsWith('http://') || photoPath.startsWith('https://')) {\n      console.log('LoadWorkerPhoto: Processing remote URL with cache busting');\n      // Handle remote URLs with cache busting\n      try {\n        const response = await fetch(`${photoPath}?t=${timestamp}`);\n        if (!response.ok) throw new Error('Failed to fetch image');\n        const buffer = await response.arrayBuffer();\n        const isPng = photoPath.toLowerCase().endsWith('.png');\n        resultImage = isPng \n          ? await pdfDoc.embedPng(new Uint8Array(buffer))\n          : await pdfDoc.embedJpg(new Uint8Array(buffer));\n        console.log('LoadWorkerPhoto: Successfully loaded remote image');\n      } catch (error) {\n        console.warn('LoadWorkerPhoto: Failed to fetch remote image:', error);\n        return null;\n      }\n    } else {\n      console.log('LoadWorkerPhoto: Processing local file path');\n      // Handle local file path with improved path resolution\n      const path = await import('path');\n      const isPng = photoPath.toLowerCase().endsWith('.png');\n\n      // Determine final path based on input with proper error handling\n      let finalPath: string;\n      if (photoPath.startsWith('/api/files/')) {\n        // Parse API file path: /api/files/{userId}/{category}/{filename}\n        const apiParts = photoPath.split('/');\n        if (apiParts.length >= 5) {\n          const [, , , userId, category, ...filenameParts] = apiParts;\n          const filename = filenameParts.join('/');\n          \n          // Validate required parts exist\n          if (!userId || !category || !filename) {\n            console.warn('LoadWorkerPhoto: Invalid API path structure:', { userId, category, filename });\n            finalPath = path.join(process.cwd(), 'public', photoPath.replace('/api/files/', '/uploads/'));\n          } else {\n            // Map API categories to actual directory names\n            const categoryFolders: Record<string, string> = {\n              sika: 'dokumen-sika',\n              simja: 'dokumen-simja',\n              'id-card': 'id-card',\n              other: 'lainnya',\n              'worker-photo': 'foto-pekerja'  // This is the key mapping!\n            };\n            \n            const folderName = categoryFolders[category] || category;\n            finalPath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n          }\n        } else {\n          // Fallback to simple replacement for malformed paths\n          finalPath = path.join(process.cwd(), 'public', photoPath.replace('/api/files/', '/uploads/'));\n        }\n      } else if (photoPath.startsWith('/uploads/')) {\n        finalPath = path.join(process.cwd(), 'public', photoPath);\n      } else {\n        finalPath = path.join(process.cwd(), 'public', `/uploads/${photoPath}`);\n      }\n\n      console.log('LoadWorkerPhoto: Resolved file path:', finalPath);\n      resultImage = await loadFileImage(pdfDoc, finalPath, isPng);\n    }\n\n    // Validate and cache result\n    if (resultImage) {\n      try {\n        const imgDims = resultImage.scale(1);\n        if (imgDims.width > 0 && imgDims.height > 0) {\n          console.log('LoadWorkerPhoto: Successfully loaded and cached image:', photoPath);\n          imageCache.set(photoPath, resultImage);\n          return resultImage;\n        } else {\n          console.warn('LoadWorkerPhoto: Skipping invalid image with zero dimensions:', photoPath);\n          return null;\n        }\n      } catch (error) {\n        console.warn('LoadWorkerPhoto: Failed to validate image dimensions:', error);\n        return null;\n      }\n    }\n\n    console.warn('LoadWorkerPhoto: Failed to load image:', photoPath);\n    return null;\n  } catch (error) {\n    console.warn('LoadWorkerPhoto: Error loading worker photo:', error);\n    return null;\n  }\n}\n\n/**\n * Load worker photos in batches with improved error handling\n */\nexport async function preloadWorkerPhotos(\n  pdfDoc: PDFDocument,\n  workerList: Array<{ worker_photo?: string | null }>\n): Promise<void> {\n  // Filter out cached and null photos\n  const photosToLoad = workerList\n    .filter(w => w.worker_photo && !imageCache.has(w.worker_photo))\n    .map(w => w.worker_photo as string);\n\n  console.log(`Preloading ${photosToLoad.length} worker photos...`);\n\n  // Process in small batches\n  for (let i = 0; i < photosToLoad.length; i += MAX_BATCH_SIZE) {\n    const batch = photosToLoad.slice(i, i + MAX_BATCH_SIZE);\n    \n    try {\n      // Load batch in parallel with proper error handling\n      await Promise.all(batch.map(async (photo) => {\n        try {\n          await loadWorkerPhoto(pdfDoc, photo);\n        } catch (error) {\n          console.warn(`Failed to preload photo: ${photo}`, error);\n        }\n      }));\n      \n      // Small delay between batches\n      if (i + MAX_BATCH_SIZE < photosToLoad.length) {\n        await new Promise(resolve => setTimeout(resolve, BATCH_DELAY));\n      }\n    } catch (error) {\n      console.warn('Batch processing failed:', error);\n      // Continue with next batch\n    }\n  }\n\n  console.log('Worker photo preloading completed');\n}\n\n/**\n * Clear the image cache\n */\nexport function clearImageCache(): void {\n  imageCache.clear();\n}"
            },
            {
              "type": "file",
              "name": "imageOptimizer.ts",
              "content": "// Conditional import for server-side only\nlet sharp: any = null;\n\n// Only import sharp on server-side\nif (typeof window === 'undefined') {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    sharp = require('sharp');\n  } catch (error) {\n    console.warn('Sharp not available, using fallback image processing');\n  }\n}\n\nconst MAX_IMAGE_SIZE = 500; // Maximum dimension in pixels\nconst JPEG_QUALITY = 70;   // JPEG compression quality (0-100)\n\ninterface ImageDimensions {\n  width: number;\n  height: number;\n}\n\n/**\n * Compress and optimize image for PDF embedding\n * @param imageBuffer Original image buffer\n * @returns Optimized image buffer\n */\nexport async function optimizeImage(imageBuffer: Buffer): Promise<Buffer> {\n  // Return original buffer if not on server or sharp not available\n  if (typeof window !== 'undefined' || !sharp) {\n    console.log('Using original image buffer (client-side or sharp not available)');\n    return imageBuffer;\n  }\n\n  try {\n    // Get image info\n    const metadata = await sharp(imageBuffer).metadata();\n    if (!metadata.width || !metadata.height) {\n      throw new Error('Could not get image dimensions');\n    }\n\n    // Calculate new dimensions\n    const newDimensions = calculateDimensions({\n      width: metadata.width,\n      height: metadata.height\n    });\n\n    // Process image\n    return await sharp(imageBuffer)\n      // Resize while maintaining aspect ratio\n      .resize(newDimensions.width, newDimensions.height, {\n        fit: 'inside',\n        withoutEnlargement: true\n      })\n      // Convert to JPEG with compression\n      .jpeg({ \n        quality: JPEG_QUALITY,\n        mozjpeg: true, // Use mozjpeg for better compression\n        chromaSubsampling: '4:2:0' // Further reduce file size\n      })\n      // Optimize for web/pdf\n      .toBuffer();\n\n  } catch (error) {\n    console.warn('Image optimization failed:', error);\n    return imageBuffer; // Return original if optimization fails\n  }\n}\n\n/**\n * Calculate new dimensions while maintaining aspect ratio\n */\nfunction calculateDimensions(original: ImageDimensions): ImageDimensions {\n  const { width, height } = original;\n\n  if (width <= MAX_IMAGE_SIZE && height <= MAX_IMAGE_SIZE) {\n    return original;\n  }\n\n  if (width > height) {\n    return {\n      width: MAX_IMAGE_SIZE,\n      height: Math.round(height * MAX_IMAGE_SIZE / width)\n    };\n  } else {\n    return {\n      width: Math.round(width * MAX_IMAGE_SIZE / height),\n      height: MAX_IMAGE_SIZE\n    };\n  }\n}\n"
            },
            {
              "type": "file",
              "name": "imageProcessor.ts",
              "content": "import { type PDFDocument, type PDFImage } from \"pdf-lib\";\nimport sharp from 'sharp';\n\nconst MAX_IMAGE_SIZE = 500; // Maximum dimension in pixels\nconst MAX_CACHE_SIZE = 20; // Maximum number of images to keep in cache\n\n// Cache for processed images\nconst imageCache = new Map<string, PDFImage>();\n\n/**\n * Compresses and processes image data for PDF embedding\n */\nexport async function processImage(inputData: Buffer): Promise<Buffer> {\n  try {\n    // Server-side compression using Sharp\n    return await sharp(inputData)\n      .resize(MAX_IMAGE_SIZE, MAX_IMAGE_SIZE, {\n        fit: 'inside',\n        withoutEnlargement: true\n      })\n      .jpeg({ quality: 70 })\n      .toBuffer();\n  } catch (error) {\n    console.warn('Image compression failed:', error);\n    return inputData; // Return original if compression fails\n  }\n}\n\n/**\n * Cleans up the image cache if it exceeds the maximum size\n */\nfunction cleanupCache() {\n  if (imageCache.size > MAX_CACHE_SIZE) {\n    const keysToDelete = Array.from(imageCache.keys())\n      .slice(0, imageCache.size - MAX_CACHE_SIZE);\n    keysToDelete.forEach(key => imageCache.delete(key));\n  }\n}\n\n/**\n * Load and embed photo from file path or base64\n */\nexport async function loadWorkerPhoto(pdfDoc: PDFDocument, photoPath?: string | null): Promise<PDFImage | null> {\n  if (!photoPath) return null;\n\n  // Check cache first\n  if (imageCache.has(photoPath)) {\n    return imageCache.get(photoPath)!;\n  }\n\n  try {\n    let imageBuffer: Buffer | null = null;\n\n    if (photoPath.startsWith('data:image/') || photoPath.startsWith('data:') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {\n      // Handle base64 data\n      let base64Data: string | undefined;\n\n      \n      if (photoPath.startsWith('data:image/')) {\n        const base64Parts = photoPath.split(',');\n        base64Data = base64Parts[1];\n      } else if (photoPath.startsWith('data:')) {\n        const base64Parts = photoPath.split(',');\n        base64Data = base64Parts.length > 1 ? base64Parts[1] : photoPath.replace('data:', '');\n      } else {\n        base64Data = photoPath;\n      }\n      \n      if (base64Data) {\n        imageBuffer = Buffer.from(base64Data, 'base64');\n      }\n    } else {\n      // Handle file path\n      const fs = await import('fs');\n      const path = await import('path');\n      let fullPath: string;\n      \n      if (photoPath.startsWith('/api/files/')) {\n        const apiParts = photoPath.split('/');\n        if (apiParts.length >= 5) {\n          const [, , , userId, category, ...filenameParts] = apiParts;\n          const filename = filenameParts.join('/');\n          \n          if (!userId || !category || !filename) {\n            return null;\n          }\n          \n          const categoryFolders: Record<string, string> = {\n            sika: 'dokumen-sika',\n            simja: 'dokumen-simja',\n            id_card: 'id-card',\n            other: 'lainnya',\n            'worker-photo': 'foto-pekerja'\n          };\n          \n          const folderName = categoryFolders[category] || category;\n          fullPath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n        } else {\n          return null;\n        }\n      } else {\n        fullPath = path.join(process.cwd(), 'public', \n          photoPath.startsWith('/') ? photoPath : `/uploads/${photoPath}`);\n      }\n      \n      if (fs.existsSync(fullPath)) {\n        imageBuffer = fs.readFileSync(fullPath);\n      }\n    }\n\n    if (imageBuffer) {\n      // Process and compress image\n      const processedBuffer = await processImage(imageBuffer);\n      const isPng = photoPath.toLowerCase().includes('.png');\n      \n      // Embed processed image\n      const resultImage = isPng \n        ? await pdfDoc.embedPng(processedBuffer)\n        : await pdfDoc.embedJpg(processedBuffer);\n\n      // Cache the result\n      imageCache.set(photoPath, resultImage);\n      cleanupCache();\n\n      return resultImage;\n    }\n\n    return null;\n  } catch (error) {\n    console.warn('Failed to load and process image:', error);\n    return null;\n  }\n}\n\n/**\n * Load worker photos in batches\n */\nexport async function preloadWorkerPhotos(\n  pdfDoc: PDFDocument, \n  workerList: Array<{ worker_name: string; worker_photo?: string | null }>\n): Promise<void> {\n  // Filter out cached and null photos\n  const photosToLoad = workerList\n    .filter(worker => worker.worker_photo && !imageCache.has(worker.worker_photo))\n    .map(worker => worker.worker_photo as string);\n\n  // Process photos in batches\n  const batchSize = 3;\n  for (let i = 0; i < photosToLoad.length; i += batchSize) {\n    const batch = photosToLoad.slice(i, i + batchSize);\n    \n    // Load batch in parallel\n    await Promise.allSettled(\n      batch.map(photo => loadWorkerPhoto(pdfDoc, photo))\n    );\n    \n    // Small delay between batches to allow GC\n    if (i + batchSize < photosToLoad.length) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n  }\n}\n\n/**\n * Clear the image cache\n */\nexport function clearImageCache(): void {\n  imageCache.clear();\n}"
            },
            {
              "type": "file",
              "name": "newPhotoLoader.ts",
              "content": "import { PDFDocument, PDFImage } from 'pdf-lib';\n\nconst MAX_IMAGE_SIZE = 800; // Maximum size for either width or height\nconst MAX_CONCURRENT_LOADS = 3; // Maximum number of concurrent image loads\nconst imageCache = new Map<string, PDFImage>();\n\n// Semaphore for limiting concurrent image loads\nlet activeLoads = 0;\nconst loadQueue: (() => void)[] = [];\n\nfunction executeNextLoad() {\n  if (activeLoads < MAX_CONCURRENT_LOADS && loadQueue.length > 0) {\n    const nextLoad = loadQueue.shift();\n    if (nextLoad) nextLoad();\n  }\n}\n\nexport function clearImageCache() {\n  imageCache.clear();\n}\n\nasync function compressImage(imageData: ArrayBuffer): Promise<ArrayBuffer> {\n  if (typeof window !== 'undefined') {\n    // Client-side compression\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => {\n        const canvas = document.createElement('canvas');\n        let width = img.width;\n        let height = img.height;\n        \n        // Calculate new dimensions while maintaining aspect ratio\n        if (width > MAX_IMAGE_SIZE || height > MAX_IMAGE_SIZE) {\n          if (width > height) {\n            height = Math.round(height * MAX_IMAGE_SIZE / width);\n            width = MAX_IMAGE_SIZE;\n          } else {\n            width = Math.round(width * MAX_IMAGE_SIZE / height);\n            height = MAX_IMAGE_SIZE;\n          }\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n          reject(new Error('Could not get canvas context'));\n          return;\n        }\n        \n        ctx.drawImage(img, 0, 0, width, height);\n        \n        // Convert to blob\n        canvas.toBlob((blob) => {\n          if (!blob) {\n            reject(new Error('Could not convert to blob'));\n            return;\n          }\n          \n          // Convert blob to ArrayBuffer\n          const reader = new FileReader();\n          reader.onloadend = () => resolve(reader.result as ArrayBuffer);\n          reader.onerror = reject;\n          reader.readAsArrayBuffer(blob);\n        }, 'image/jpeg', 0.7); // Compress with 70% quality\n      };\n      \n      img.onerror = reject;\n      img.src = URL.createObjectURL(new Blob([imageData]));\n    });\n  } else {\n    // Server-side compression using Sharp\n    try {\n      const sharp = await import('sharp');\n      const buffer = Buffer.from(imageData);\n      \n      const processedBuffer = await sharp.default(buffer)\n        .resize(MAX_IMAGE_SIZE, MAX_IMAGE_SIZE, {\n          fit: 'inside',\n          withoutEnlargement: true\n        })\n        .jpeg({ quality: 70 })\n        .toBuffer();\n      \n      return processedBuffer.buffer as ArrayBuffer;\n    } catch (error) {\n      console.warn('Image compression failed:', error);\n      return imageData;\n    }\n  }\n}\n\nexport async function loadWorkerPhoto(pdfDoc: PDFDocument, photoPath?: string | null): Promise<PDFImage | null> {\n  if (!photoPath) {\n    return null;\n  }\n\n  // Check cache first\n  if (imageCache.has(photoPath)) {\n    return imageCache.get(photoPath)!;\n  }\n\n  // Wait for available slot if needed\n  if (activeLoads >= MAX_CONCURRENT_LOADS) {\n    await new Promise<void>(resolve => loadQueue.push(resolve));\n  }\n  activeLoads++;\n\n  try {\n    let resultImage: PDFImage | null = null;\n    let imageData: ArrayBuffer | null = null;\n    let retryCount = 0;\n    const maxRetries = 2;\n\n    while (retryCount <= maxRetries && !resultImage) {\n      try {\n        if (photoPath.startsWith('data:image/') || photoPath.startsWith('data:') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {\n          // Handle base64 data\n          let base64Data: string | undefined;\n          const isPng = photoPath.includes('image/png');\n          \n          if (photoPath.startsWith('data:image/')) {\n            const base64Parts = photoPath.split(',');\n            base64Data = base64Parts[1];\n          } else if (photoPath.startsWith('data:')) {\n            const base64Parts = photoPath.split(',');\n            base64Data = base64Parts.length > 1 ? base64Parts[1] : photoPath.replace('data:', '');\n          } else {\n            base64Data = photoPath;\n          }\n          \n          if (base64Data) {\n            const photoBytes = Buffer.from(base64Data, 'base64');\n            try {\n              const compressedData = await compressImage(photoBytes.buffer);\n              const compressedBuffer = Buffer.from(compressedData);\n              resultImage = isPng \n                ? await pdfDoc.embedPng(compressedBuffer)\n                : await pdfDoc.embedJpg(compressedBuffer);\n            } catch (err) {\n              console.warn('Using original image due to compression failure:', err);\n              resultImage = isPng \n                ? await pdfDoc.embedPng(photoBytes)\n                : await pdfDoc.embedJpg(photoBytes);\n            }\n          }\n        } else {\n          // Handle file path with API compatibility\n          const fullPath = photoPath.startsWith('/api/files/') \n            ? photoPath.replace('/api/files/', '/uploads/')\n            : photoPath.startsWith('/') ? photoPath : `/uploads/${photoPath}`;\n\n          if (typeof window !== 'undefined') {\n            // Client-side loading with timeout\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 5000);\n            \n            try {\n              const response = await fetch(\n                photoPath.startsWith('/api/files/') ? photoPath : fullPath,\n                { signal: controller.signal }\n              );\n              \n              if (response.ok) {\n                imageData = await response.arrayBuffer();\n              }\n            } catch (error) {\n              if (error instanceof Error && error.name === 'AbortError') {\n                console.warn('Image load timeout:', photoPath);\n              }\n              throw error;\n            } finally {\n              clearTimeout(timeoutId);\n            }\n          } else {\n            // Server-side loading with proper path resolution\n            try {\n              const fs = await import('fs');\n              const path = await import('path');\n              \n              let photoFilePath: string;\n              \n              if (photoPath.startsWith('/api/files/')) {\n                const apiParts = photoPath.split('/');\n                if (apiParts.length >= 5) {\n                  const [, , , userId, category, ...filenameParts] = apiParts;\n                  const filename = filenameParts.join('/');\n                  \n                  if (!userId || !category || !filename) {\n                    throw new Error('Invalid file path structure');\n                  }\n                  \n                  const categoryFolders: Record<string, string> = {\n                    sika: 'dokumen-sika',\n                    simja: 'dokumen-simja',\n                    id_card: 'id-card',\n                    other: 'lainnya',\n                    'worker-photo': 'foto-pekerja'\n                  };\n                  \n                  const folderName = categoryFolders[category] || category;\n                  photoFilePath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n                } else {\n                  throw new Error('Invalid API file path');\n                }\n              } else {\n                photoFilePath = path.join(process.cwd(), 'public', fullPath);\n              }\n              \n              if (!fs.existsSync(photoFilePath)) {\n                throw new Error('File not found: ' + photoFilePath);\n              }\n              \n              const fileBuffer = fs.readFileSync(photoFilePath);\n              imageData = fileBuffer.buffer;\n            } catch (error) {\n              console.warn('Server-side image load failed:', error);\n              throw error;\n            }\n          }\n\n          if (imageData) {\n            const isPng = fullPath.toLowerCase().includes('.png');\n            try {\n              const compressedData = await compressImage(imageData);\n              const compressedBuffer = Buffer.from(compressedData);\n              resultImage = isPng \n                ? await pdfDoc.embedPng(compressedBuffer)\n                : await pdfDoc.embedJpg(compressedBuffer);\n            } catch (err) {\n              console.warn('Using original image due to compression failure:', err);\n              const originalBuffer = Buffer.from(imageData);\n              resultImage = isPng \n                ? await pdfDoc.embedPng(originalBuffer)\n                : await pdfDoc.embedJpg(originalBuffer);\n            }\n          }\n        }\n\n        break; // Exit loop if successful\n      } catch (error) {\n        console.warn(`Attempt ${retryCount + 1} failed for ${photoPath}:`, error);\n        if (retryCount < maxRetries) {\n          retryCount++;\n          await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));\n        } else {\n          throw error;\n        }\n      }\n    }\n\n    if (resultImage) {\n      // Clean cache if too large (keep last 20 images)\n      if (imageCache.size > 20) {\n        const keysToDelete = Array.from(imageCache.keys()).slice(0, imageCache.size - 20);\n        keysToDelete.forEach(key => imageCache.delete(key));\n      }\n      imageCache.set(photoPath, resultImage);\n    }\n\n    return resultImage;\n  } catch (error) {\n    console.error('Failed to load worker photo:', error);\n    return null;\n  } finally {\n    activeLoads--;\n    executeNextLoad();\n  }\n}\n\nexport async function preloadWorkerPhotos(\n  pdfDoc: PDFDocument, \n  workerList: Array<{ worker_name: string; worker_photo?: string | null }>\n): Promise<void> {\n  // Filter out cached and null photos\n  const photosToLoad = workerList\n    .filter(worker => worker.worker_photo && !imageCache.has(worker.worker_photo))\n    .map(worker => worker.worker_photo as string);\n\n  // Process photos in batches\n  const batchSize = 3;\n  for (let i = 0; i < photosToLoad.length; i += batchSize) {\n    const batch = photosToLoad.slice(i, i + batchSize);\n    const batchPromises = batch.map(photo => loadWorkerPhoto(pdfDoc, photo));\n    \n    try {\n      await Promise.all(batchPromises);\n    } catch (error) {\n      console.warn('Error loading batch of photos:', error);\n    }\n    \n    // Small delay between batches\n    if (i + batchSize < photosToLoad.length) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n  }\n}"
            },
            {
              "type": "file",
              "name": "photoLoader.ts",
              "content": "//src/utils/pdf/photoLoader.ts - Wrapper untuk backward compatibility\nimport { clearImageCache, loadWorkerPhoto, preloadWorkerPhotos } from './imageLoader';\n\nexport { clearImageCache, loadWorkerPhoto, preloadWorkerPhotos };"
            },
            {
              "type": "file",
              "name": "simlokTemplate.ts",
              "content": "// simlok-pdf.ts\nimport {\n  PDFDocument,\n  StandardFonts,\n  rgb,\n  type PDFFont,\n  type RGB,\n  type PDFImage,\n} from \"pdf-lib\";\nimport * as QRCode from 'qrcode';\nimport { numberToBahasa } from \"@/lib/parseNumber\";\n/**\n * Load logo image for PDF generation\n * Works both on client-side (fetch) and server-side (fs)\n */\nasync function loadLogo(pdfDoc: PDFDocument): Promise<PDFImage | null> {\n  try {\n    const logoPath = '/assets/logo_pertamina.png';\n    \n    if (typeof window !== 'undefined') {\n      // Client-side: use fetch\n      const response = await fetch(logoPath);\n      if (response.ok) {\n        const logoBytes = await response.arrayBuffer();\n        return await pdfDoc.embedPng(new Uint8Array(logoBytes));\n      }\n    } else {\n      // Server-side: use file system\n      const fs = await import('fs');\n      const path = await import('path');\n      const logoFilePath = path.join(process.cwd(), 'public', logoPath);\n      \n      if (fs.existsSync(logoFilePath)) {\n        const fileBuffer = fs.readFileSync(logoFilePath);\n        return await pdfDoc.embedPng(fileBuffer);\n      }\n    }\n  } catch (error) {\n    console.warn('Failed to load logo:', error);\n  }\n  \n  return null;\n}\n\n/**\n * Generate QR code image for PDF\n */\nasync function generateQRImage(pdfDoc: PDFDocument, qrString: string): Promise<PDFImage | null> {\n  try {\n    // Generate QR code as PNG buffer\n    const qrBuffer = await QRCode.toBuffer(qrString, {\n      type: 'png',\n      width: 200,\n      margin: 2,\n      color: {\n        dark: '#000000',\n        light: '#FFFFFF'\n      }\n    });\n    \n    // Embed QR code image into PDF\n    return await pdfDoc.embedPng(qrBuffer);\n  } catch (error) {\n    console.warn('Failed to generate QR code image:', error);\n    return null;\n  }\n}\n\n/** Struktur data mengikuti placeholder di template kamu */\nexport interface SubmissionPDFData {\n  simlok_number?: string | null;\n  simlok_date?: string | Date | null | undefined;\n  implementation_start_date?: string | Date | null | undefined;\n  implementation_end_date?: string | Date | null | undefined;\n  vendor_name: string;\n  simja_number?: string | null;\n  simja_date?: string | Date | null | undefined;\n  sika_number?: string | null;\n  sika_date?: string | Date | null | undefined;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;            // contoh: \"08:30 - 06:30 WIB\"\n  other_notes?: string | null;\n  work_facilities: string;\n  worker_names?: string | null;\n  worker_count?: number | null;\n  content?: string | null;\n  signer_position?: string | null;\n  signer_name?: string | null;\n  qrcode?: string | null;  // QR code string for PDF\n  // Tambahkan untuk daftar pekerja dari tabel terpisah\n  final_status?: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED' | null;\n  workerList?: Array<{\n    worker_name: string;\n    worker_photo?: string | null;\n  }>;\n  // Support database field name\n  worker_list?: Array<{\n    worker_name: string;\n    worker_photo?: string | null;\n  }>;\n}\n\nexport type SIMLOKOptions = {\n  logoBase64?: string;     // opsional\n  primary?: RGB;           // warna judul\n  cityIssued?: string;     // default \"Jakarta\"\n  headTitle?: string;      // default \"Sr Officer Security III\"\n  headName?: string;       // default \"Juliarto Santoso\"\n  fontSize?: number;       // default 12\n  leftLabelWidth?: number; // default 190\n  lineGap?: number;        // default 15.5\n};\n\nconst A4 = { w: 595.28, h: 841.89 };\nconst MARGIN = 50;\nconst LEFT_LABEL_WIDTH_DEFAULT = 160;\nconst LINE_GAP_DEFAULT = 15.5;\n\nfunction toDate(d?: string | Date | null) {\n  if (!d) return null;\n  return typeof d === \"string\" ? new Date(d) : d;\n}\n\nfunction fmtDateID(d?: string | Date | null) {\n  const dd = toDate(d);\n  if (!dd || isNaN(+dd)) return \"-\";\n  return dd.toLocaleDateString(\"id-ID\", {\n    day: \"2-digit\",\n    month: \"long\",\n    year: \"numeric\",\n  });\n}\n\n/**\n * Ekstrak tanggal dari text pelaksanaan\n * Contoh: \"Terhitung mulai tanggal 01 Agustus 2025 sampai 15 Agustus 2025\"\n * Akan mengambil tanggal pertama: \"01 Agustus 2025\"\n */\nfunction extractDateFromPelaksanaan(pelaksanaan?: string | null): Date | null {\n  if (!pelaksanaan) return null;\n  \n  // Pattern untuk menangkap tanggal dalam format: DD Bulan YYYY\n  const datePattern = /(\\d{1,2})\\s+(Januari|Februari|Maret|April|Mei|Juni|Juli|Agustus|September|Oktober|November|Desember)\\s+(\\d{4})/i;\n  const match = pelaksanaan.match(datePattern);\n  \n  if (!match) return null;\n  \n  const [, day, month, year] = match;\n  \n  // Mapping bulan Indonesia ke nomor bulan\n  const monthMap: { [key: string]: number } = {\n    'januari': 0, 'februari': 1, 'maret': 2, 'april': 3,\n    'mei': 4, 'juni': 5, 'juli': 6, 'agustus': 7,\n    'september': 8, 'oktober': 9, 'november': 10, 'desember': 11\n  };\n  \n  const monthIndex = month ? monthMap[month.toLowerCase()] : undefined;\n  if (monthIndex === undefined || !year || !day) return null;\n  \n  return new Date(parseInt(year), monthIndex, parseInt(day));\n}\n\n/** Hapus newline ganda & spasi berlebih agar wrap presisi */\nfunction normalizeInline(s?: string | null) {\n  if (!s) return \"\";\n  return s.replace(/\\s+/g, \" \").trim();\n}\n\nclass PDFKit {\n  doc!: PDFDocument;\n  page: any;\n  font!: PDFFont;\n  bold!: PDFFont;\n\n  x = MARGIN;\n  y = A4.h - MARGIN;\n\n  fs = 12;\n  lineGap = LINE_GAP_DEFAULT;\n  leftLabelWidth = LEFT_LABEL_WIDTH_DEFAULT;\n  pageCount = 0;\n  submissionData?: SubmissionPDFData;\n\n  async init() {\n    this.doc = await PDFDocument.create();\n    this.page = this.doc.addPage([A4.w, A4.h]);\n    this.font = await this.doc.embedFont(StandardFonts.Helvetica);\n    this.bold = await this.doc.embedFont(StandardFonts.HelveticaBold);\n    this.pageCount = 1;\n  }\n\n  async addPage() {\n    this.page = this.doc.addPage([A4.w, A4.h]);\n    this.pageCount++;\n    this.x = MARGIN;\n    \n    // Add header to pages 2 and beyond\n    if (this.pageCount > 1 && this.submissionData) {\n      await this.addHeader();\n      this.y = A4.h - 140; // Start content below header\n    } else {\n      this.y = A4.h - MARGIN;\n    }\n  }\n\n  async addHeader() {\n    if (!this.submissionData) return;\n    \n    // Add logo - await untuk memastikan logo ter-load\n    const logoImage = await loadLogo(this.doc);\n    if (logoImage) {\n      const logoWidth = 120;\n      const logoHeight = 40;\n      const logoX = A4.w - logoWidth - 40;\n      const logoY = A4.h - 60;\n      \n      this.page.drawImage(logoImage, {\n        x: logoX,\n        y: logoY,\n        width: logoWidth,\n        height: logoHeight,\n      });\n    }\n    \n    // Add header dengan nomor SIMLOK\n    const simlokNumber = this.submissionData.simlok_number || \"[DRAFT]/XX/09/2025\";\n    this.text(`Lampiran Simlok No. ${simlokNumber}`, MARGIN, A4.h - 80, {\n      size: 12,\n      bold: true,\n      color: rgb(0, 0, 0),\n    });\n\n    // Add nama vendor di bawah lampiran\n    this.text(\"Nama petugas \", MARGIN, A4.h - 100, {\n      size: 11,\n      bold: false,\n      color: rgb(0, 0, 0),\n    });\n\n    // Hitung lebar text \"Nama petugas \" untuk positioning nama vendor\n    const namaPetugasWidth = this.measure(\"Nama petugas \", { size: 11, bold: false });\n    this.text(this.submissionData.vendor_name, MARGIN + namaPetugasWidth, A4.h - 100, {\n      size: 11,\n      bold: true,\n      color: rgb(0, 0, 0),\n    });\n\n    // // Add separator line\n    // const lineY = A4.h - 120;\n    // const lineStartX = MARGIN;\n    // const lineEndX = A4.w - MARGIN;\n    // this.page.drawLine({\n    //   start: { x: lineStartX, y: lineY },\n    //   end: { x: lineEndX, y: lineY },\n    //   thickness: 0.5,\n    //   color: rgb(0.7, 0.7, 0.7),\n    // });\n  }\n\n  measure(text: string, opts?: { size?: number; bold?: boolean }) {\n    const size = opts?.size ?? this.fs;\n    const f = opts?.bold ? this.bold : this.font;\n    return f.widthOfTextAtSize(text, size);\n  }\n\n  text(\n    t: string,\n    x: number,\n    y: number,\n    o?: { size?: number; bold?: boolean; color?: RGB }\n  ) {\n    this.page.drawText(t, {\n      x,\n      y,\n      size: o?.size ?? this.fs,\n      font: o?.bold ? this.bold : this.font,\n      color: o?.color ?? rgb(0, 0, 0),\n    });\n  }\n\n  center(t: string, y: number, o?: { size?: number; bold?: boolean; color?: RGB }) {\n    const w = this.measure(t, o);\n    const cx = (A4.w - w) / 2;\n    this.text(t, cx, y, o);\n  }\n\n  async wrap(\n    t: string,\n    x: number,\n    maxW: number,\n    o?: { size?: number; bold?: boolean }\n  ) {\n    const size = o?.size ?? this.fs;\n    const f = o?.bold ? this.bold : this.font;\n    const words = t.split(/\\s+/);\n    let line = \"\";\n    const lines: string[] = [];\n    for (const w of words) {\n      const test = line ? line + \" \" + w : w;\n      const width = f.widthOfTextAtSize(test, size);\n      if (width > maxW && line) {\n        lines.push(line);\n        line = w;\n      } else line = test;\n    }\n    if (line) lines.push(line);\n    for (const ln of lines) {\n      await this.pageBreak();\n      this.text(ln, x, this.y, { size, bold: o?.bold ?? false });\n      this.y -= this.lineGap;\n    }\n  }\n\n  async pageBreak(min = 60) {\n    if (this.y < MARGIN + min) await this.addPage();\n  }\n\n  /**\n   * Baris bernomor dengan label di kiri, titik dua di kolom tengah,\n   * dan value yang dibungkus di kolom kanan.\n   */\n  async numberedRow(\n    no: number,\n    label: string,\n    rawValue?: string | null,\n    opts?: { valueBold?: boolean }\n  ) {\n    const value = (rawValue ?? \"\").toString();\n    await this.pageBreak();\n\n    // Minimal spacing between rows for compactness\n    if (no > 1) {\n      this.y -= this.lineGap * 0.2; // Reduced from 0.5 to 0.2\n    }\n\n    // Label kiri (bold)\n    const left = `${no}. ${label}`;\n    this.text(left, this.x, this.y, { bold: false });\n\n    // Titik dua di kolom tengah agar align konsisten\n    const colonX = this.x + this.leftLabelWidth - this.measure(\":\", { size: this.fs }) - 2;\n    this.text(\":\", colonX, this.y);\n\n    // Value di kolom kanan (wrap)\n    const rightX = this.x + this.leftLabelWidth + 4;\n    const rightW = A4.w - MARGIN - rightX;\n    await this.wrap(normalizeInline(value) || \"-\", rightX, rightW, {\n      bold: !!opts?.valueBold,\n    });\n    \n    // Spacing after each numbered row for better readability\n    this.y -= this.lineGap * 0.4; // Increased spacing between points\n  }\n}\n\nexport async function generateSIMLOKPDF(submissionData: SubmissionPDFData): Promise<Uint8Array> {\n  const k = new PDFKit();\n  await k.init();\n  \n  // Store submission data for header generation\n  k.submissionData = submissionData;\n  \n  const { page } = k;\n  const { width, height } = page.getSize();\n\n  // Load and embed the Pertamina logo\n  const logoImage = await loadLogo(k.doc);\n\n  const s = submissionData;\n\n  // Set PDF metadata with SIMLOK information\n  const simlokNumber = s.simlok_number ? `${s.simlok_number}` : \"SIMLOK\";\n  const simlokTitle = `SIMLOK NO-${simlokNumber}`;\n  const currentDate = new Date();\n  \n  k.doc.setTitle(simlokTitle);\n  k.doc.setSubject(\"Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)\");\n  k.doc.setAuthor(\"PT PERTAMINA (PERSERO)\");\n  k.doc.setKeywords([\"SIMLOK\", \"Pertamina\", \"Izin Masuk\", simlokNumber, s.vendor_name]);\n  k.doc.setProducer(\"SIMLOK System\");\n  k.doc.setCreator(\"SIMLOK PDF Generator\");\n  k.doc.setCreationDate(currentDate);\n  k.doc.setModificationDate(currentDate);\n\n  // Set initial styling - optimized for single page\n  k.fs = 11; // Increased from 10 to 11\n  k.lineGap = 13; // Increased from 12 to 13\n  k.leftLabelWidth = 140; // Keep as 140 for compactness\n\n  // Add logo to top-right if available\n  if (logoImage) {\n    const logoWidth = 120;\n    const logoHeight = 40;\n    const logoX = width - logoWidth - 40; // 40 pixels from right edge\n    const logoY = height - 60; // 80 pixels from top (higher than title)\n    \n    page.drawImage(logoImage, {\n      x: logoX,\n      y: logoY,\n      width: logoWidth,\n      height: logoHeight,\n    });\n  }\n\n  // Add centered header\n  k.center(\"SURAT IZIN MASUK LOKASI\", height - 85, {\n    size: 14, // Reduced from 16 to 14\n    bold: true,\n    color: rgb(0, 0, 0),\n  });\n\n  // Add border bottom line under the title\n  const titleY = height - 70;\n  const lineY = titleY - 20; // Reduced spacing\n  const lineStartX = 185; // Start line position\n  const lineEndX = A4.w - 185; // End line position\n  page.drawLine({\n    start: { x: lineStartX, y: lineY },\n    end: { x: lineEndX, y: lineY },\n    thickness: 1,\n    color: rgb(0, 0, 0),\n  });\n\n  // SIMLOK number (centered)\n  const simlokNo = s.simlok_number ? `${s.simlok_number}` : \"\";\n  k.center(`SIMLOK NO-${simlokNo}`, height - 105, {\n    size: 12, // Reduced from 14 to 12\n  });\n\n  // Introduction text\n  k.text(\"Dengan ini di berikan izin memasuki lokasi PT PERTAMINA (PERSERO) kepada\", 50, height - 135, {\n    size: 11, // Match with content font size\n  });\n\n  // Move to content area and add numbered items with proper spacing\n  k.y = height - 160; // Added more spacing between intro text and point 1\n\n  await k.numberedRow(1, \"Nama\", s.vendor_name, { valueBold: false });\n\n  // Format berdasarkan (SIMJA info)\n  const berdasarkan = s.simja_number\n    ? `${normalizeInline(s.simja_number)} Tgl. ${fmtDateID(s.simja_date)}`\n    : \"\";\n  \n  await k.numberedRow(2, \"Berdasarkan\", berdasarkan);\n  await k.numberedRow(3, \"Pekerjaan\", s.job_description);\n  await k.numberedRow(4, \"Lokasi Kerja\", s.work_location);\n  \n  // Use provided pelaksanaan or generate template based on dates\n  let pelaksanaanText = s.implementation;\n  if (!pelaksanaanText || pelaksanaanText.trim().length === 0) {\n    if (s.implementation_start_date && s.implementation_end_date) {\n      pelaksanaanText = `Terhitung mulai tanggal ${fmtDateID(s.implementation_start_date)} sampai ${fmtDateID(s.implementation_end_date)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;\n    } else {\n      pelaksanaanText = \"Terhitung mulai tanggal [Tanggal Mulai] sampai [Tanggal Selesai]. Termasuk hari Sabtu, Minggu dan hari libur lainnya.\";\n    }\n  }\n  \n  await k.numberedRow(5, \"Pelaksanaan\", normalizeInline(pelaksanaanText));\n  await k.numberedRow(6, \"Jam Kerja\", `Mulai pukul ${s.working_hours}`);\n  \n  // Special handling for \"Lain-lain\" to show as bulleted list or template preview\n  if (s.other_notes && s.other_notes.trim().length > 0) {\n    await k.pageBreak();\n    \n    // Label kiri (bold)\n    const left = \"7. Lain-lain\";\n    k.text(left, k.x, k.y, { bold: false });\n\n    // Titik dua di kolom tengah\n    const colonX = k.x + k.leftLabelWidth - k.measure(\":\", { size: k.fs }) - 2;\n    k.text(\":\", colonX, k.y);\n\n    // Process lain-lain as bulleted list\n   const lines = s.other_notes.split('\\n').map((l: string) => l.trim()).filter(Boolean);\nconst rightX = k.x + k.leftLabelWidth + 4;\nconst rightW = A4.w - MARGIN - rightX;\n\nfor (let idx = 0; idx < lines.length; idx++) {\n  const line = lines[idx];\n  const isFirst = idx === 0;\n  const isLast  = idx === lines.length - 2;\n\n  if (isFirst) {\n    await k.wrap(` ${line}`, rightX, rightW);\n  } else {\n    // newline (spasi vertikal) sebelum baris terakhir\n    if (isLast) k.y -= k.lineGap;\n\n    await k.pageBreak();\n    await k.wrap(` ${line}`, rightX, rightW);\n  }\n}\n\n    // Add spacing after custom other_notes to match other numbered rows\n    k.y -= k.lineGap * 0.4;\n\n  } else {\n    // Generate template preview when no actual data\n    await k.pageBreak();\n    \n    // Label kiri (bold)\n    const left = \"7. Lain-lain\";\n    k.text(left, k.x, k.y, { bold: false });\n\n    // Titik dua di kolom tengah\n    const colonX = k.x + k.leftLabelWidth - k.measure(\":\", { size: k.fs }) - 2;\n    k.text(\":\", colonX, k.y);\n\n    // Generate template preview similar to reviewer\n    const rightX = k.x + k.leftLabelWidth + 4;\n    const rightW = A4.w - MARGIN - rightX;\n    \n    // Generate structured template with bold formatting\n    \n    // Line 1: Introduction\n    await k.wrap(\" Izin diberikan berdasarkan :\", rightX, rightW, { bold: false });\n    \n    // Minimal spacing before SIMJA section\n    k.y -= k.lineGap * 0.2; // Reduced spacing\n    \n    // SIMJA section with mixed formatting\n    if ((s.simja_number && s.simja_date) || s.simja_number || s.simja_date) {\n      await k.pageBreak();\n      \n      // Bullet point dengan SIMJA bold dan sisa text normal\n      const bulletX = rightX;\n      k.text(\" • \", bulletX, k.y, { bold: false });\n      const simjaX = bulletX + k.measure(\" • \", { bold: false });\n      k.text(\"SIMJA\", simjaX, k.y, { bold: true });\n      const restX = simjaX + k.measure(\"SIMJA\", { bold: true });\n      k.text(\" Ast. Man. Facility Management\", restX, k.y, { bold: false });\n      \n      // Move to next line\n      k.y -= k.lineGap;\n      \n      // Baris kedua dengan indentasi untuk No. dan Tanggal\n      await k.pageBreak();\n      const simjaNum = s.simja_number || '[Nomor SIMJA]';\n      const simjaDate = s.simja_date ? fmtDateID(s.simja_date) : '[Tanggal SIMJA]';\n      await k.wrap(`   No. ${simjaNum} Tanggal ${simjaDate}`, rightX, rightW, { bold: true });\n      \n      // Minimal spacing after SIMJA section\n      k.y -= k.lineGap * 0.2;\n    }\n    \n    // SIKA section with mixed formatting\n    if ((s.sika_number && s.sika_date) || s.sika_number || s.sika_date) {\n      await k.pageBreak();\n      \n      // Bullet point dengan SIKA bold dan sisa text normal\n      const bulletX = rightX;\n      k.text(\" • \", bulletX, k.y, { bold: false });\n      const sikaX = bulletX + k.measure(\" • \", { bold: false });\n      k.text(\"SIKA\", sikaX, k.y, { bold: true });\n      const restX = sikaX + k.measure(\"SIKA\", { bold: true });\n      k.text(\" Pekerjaan Dingin\", restX, k.y, { bold: false });\n      \n      // Move to next line\n      k.y -= k.lineGap;\n      \n      // Baris kedua dengan indentasi untuk No. dan Tanggal\n      await k.pageBreak();\n      const sikaNum = s.sika_number || '[Nomor SIKA]';\n      const sikaDate = s.sika_date ? fmtDateID(s.sika_date) : '[Tanggal SIKA]';\n      await k.wrap(`   No.${sikaNum} Tanggal. ${sikaDate}`, rightX, rightW, { bold: true });\n      \n      // Minimal spacing after SIKA section\n      k.y -= k.lineGap * 0.2;\n    }\n    \n    // Head of Security section with bold date\n    await k.pageBreak();\n    await k.wrap(\" \", rightX, rightW, { bold: false });\n    \n    await k.pageBreak();\n    await k.wrap(\"  Diterima Sr Officer III Security:\", rightX, rightW, { bold: false });\n    \n    await k.pageBreak();\n    const simlokDate = s.simlok_date ? fmtDateID(s.simlok_date) : fmtDateID(new Date());\n    await k.wrap(`  Tanggal ${simlokDate}`, rightX, rightW, { bold: true });\n  }\n  \n  // Add spacing after point 7 (Lain-lain) to match other numbered rows\n  k.y -= k.lineGap * 0.4; // Same spacing as numberedRow function\n  \n  // Get actual worker count from worker data if worker_count is null/0\n  const currentWorkerData = s.workerList || (s as any).worker_list;\n  const actualWorkerCount = s.worker_count || (currentWorkerData ? currentWorkerData.length : 0);\n  \n  await k.numberedRow(8, \"Sarana Kerja\", `${s.work_facilities}. Jumlah Pekerja ${actualWorkerCount} (${numberToBahasa(actualWorkerCount)}) Orang`);\n\n  // Add content paragraph - use provided content or default template\n  k.y -= 3; // Further reduced spacing\n  const contentText = s.content && s.content.trim().length > 0 \n    ? s.content \n    : \"Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.\";\n  \n  await k.pageBreak();\n  await k.wrap(normalizeInline(contentText), 50, A4.w - 2 * MARGIN, { size: 11 }); // Match with main content font size\n  k.y -= 3; // Further reduced spacing\n\n  // Add bottom text\n//   k.pageBreak();\n//   k.wrap(`Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan\n// tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan\n// kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka\n// kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan\n// SIMLOK 2 hari sebelum masa berlaku habis.`, 50, A4.w - 2 * MARGIN);\n\n  // Add signature section\n  k.y -= 8; // Further reduced spacing\n  const signatureY = k.y;\n\n  // Extract date from pelaksanaan or use tanggal_simlok as fallback\n  const dateFromPelaksanaan = extractDateFromPelaksanaan(s.implementation);\n  const displayDate = dateFromPelaksanaan || toDate(s.simlok_date);\n\n  // Right side - Location and Date (above Head title)\n  k.text(\"Dikeluarkan di : Jakarta\", A4.w - 230, signatureY, { size: 11 });\n  k.text(\"Pada tanggal : \" + fmtDateID(displayDate), A4.w - 230, signatureY - 15, { size: 11 });\n\n  // Right side - Head title and name (below location/date)\n  const jabatanSigner = s.signer_position || \"Head Or Security Region I\";\n  const namaSigner = s.signer_name || \"Julianto Santoso\";\n  \n  // Calculate precise positions for perfect centering - more compact\n  const jabatanY = signatureY - 40; // Reduced spacing\n  const namaY = signatureY - 145; // Reduced spacing\n  \n  // Draw jabatan\n  k.text(jabatanSigner, A4.w - 230, jabatanY, { size: 11 });\n  \n  // Add QR code if available - positioned with simple pixel values for easy maintenance\n  if (s.qrcode && s.final_status === 'APPROVED') {\n    const qrImage = await generateQRImage(k.doc, s.qrcode);\n    if (qrImage) {\n      const qrSize = 80; // Reduced QR code size\n      const qrX = 395; // Adjusted position\n      const qrY = signatureY - 130; // Adjusted position for more compact layout\n      \n      // Draw QR code at fixed pixel position\n      page.drawImage(qrImage, {\n        x: qrX,\n        y: qrY,\n        width: qrSize,\n        height: qrSize,\n      });\n    }\n  }\n  \n  // Draw nama\n  k.text(namaSigner, A4.w - 230, namaY, { bold: true, size: 11 });\n\n  // Add second page with worker photos if available\n  // Handle both workerList (interface) and worker_list (database)\n  const workerData = s.workerList || (s as any).worker_list;\n  if (workerData && workerData.length > 0) {\n    await addWorkerPhotosPage(k, workerData);\n  }\n\n  return k.doc.save();\n}\n\nimport { loadWorkerPhoto, preloadWorkerPhotos } from './imageLoader';\n\n/**\n * Add second page with worker photos\n */\nasync function addWorkerPhotosPage(\n  k: PDFKit, \n  workerList: Array<{ worker_name: string; worker_photo?: string | null }>\n) {\n  // Only proceed if there are workers\n  if (!workerList || workerList.length === 0) {\n    return;\n  }\n\n  // Preload all worker photos in batch for better performance\n  await preloadWorkerPhotos(k.doc, workerList);\n\n  // Add new page - header akan otomatis ditambahkan\n  await k.addPage();\n\n  // Calculate grid layout optimized for 3x3 photos\n  const photosPerRow = 3;\n  const photoWidth = 130;  // Optimized for better fit\n  const photoHeight = 170; // Optimized for better fit\n  const marginHorizontal = (A4.w - (photosPerRow * photoWidth)) / (photosPerRow + 1);\n  const marginVertical = 12; // Reduced vertical margin\n  const nameSpacing = 20; // Space for worker name below photo\n  \n  let currentRow = 0;\n  let currentCol = 0;\n  const startY = A4.h - 140; // Optimized start position to fit header\n\n  // Process each worker\n  for (let i = 0; i < workerList.length; i++) {\n    const worker = workerList[i];\n    if (!worker) continue; // Skip if worker is undefined\n    \n    // Calculate position\n    const x = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));\n    const y = startY - (currentRow * (photoHeight + marginVertical + nameSpacing)); // Use nameSpacing constant\n\n    // Check if we need a new page (optimized for 3x3 grid)\n    const bottomY = y - photoHeight;\n    const pageLimit = MARGIN + 30;\n    \n    // Check if we need a new page - either by space limit or by 3x3 grid limit (max 9 per page)\n    const workersOnCurrentPage = (currentRow * photosPerRow) + currentCol;\n    const needNewPageBySpace = bottomY < pageLimit;\n    const needNewPageByGrid = workersOnCurrentPage >= 9; // 3x3 = 9 workers max per page\n    \n    if (needNewPageBySpace || needNewPageByGrid) {\n      await k.addPage(); // Header akan otomatis ditambahkan oleh addPage()\n      \n      currentRow = 0;\n      currentCol = 0;\n      const newY = startY - (currentRow * (photoHeight + marginVertical + nameSpacing));\n      // Recalculate x for new page\n      const newX = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));\n      \n      // Draw on new page\n      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, newX, newY, photoWidth, photoHeight);\n    } else {\n      // Draw on current page\n      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, x, y, photoWidth, photoHeight);\n    }\n\n    // Move to next position\n    currentCol++;\n    if (currentCol >= photosPerRow) {\n      currentCol = 0;\n      currentRow++;\n    }\n  }\n}\n\n/**\n * Draw individual worker card with photo and name\n */\nasync function drawWorkerCard(\n  page: any,\n  doc: PDFDocument,\n  font: PDFFont,\n  boldFont: PDFFont,\n  worker: { worker_name: string; worker_photo?: string | null },\n  x: number,\n  y: number,\n  photoWidth: number,\n  photoHeight: number\n) {\n  // Draw photo frame\n  page.drawRectangle({\n    x: x,\n    y: y - photoHeight,\n    width: photoWidth,\n    height: photoHeight,\n    borderColor: rgb(0.8, 0.8, 0.8),\n    borderWidth: 1,\n    color: rgb(0.98, 0.98, 0.98),\n  });\n\n  // Load and draw photo if available\n  if (worker.worker_photo) {\n    const photoImage = await loadWorkerPhoto(doc, worker.worker_photo);\n    if (photoImage) {\n      // Calculate dimensions to maintain aspect ratio\n      const imgDims = photoImage.scale(1);\n      const imgAspectRatio = imgDims.width / imgDims.height;\n      const frameAspectRatio = photoWidth / photoHeight;\n      \n      let drawWidth = photoWidth - 10; // 5px padding on each side\n      let drawHeight = photoHeight - 10;\n      let drawX = x + 5;\n      let drawY = y - photoHeight + 5;\n      \n      // Adjust dimensions to fit within frame while maintaining aspect ratio\n      if (imgAspectRatio > frameAspectRatio) {\n        // Image is wider, fit to width\n        drawHeight = drawWidth / imgAspectRatio;\n        drawY = y - (photoHeight + drawHeight) / 2;\n      } else {\n        // Image is taller, fit to height\n        drawWidth = drawHeight * imgAspectRatio;\n        drawX = x + (photoWidth - drawWidth) / 2;\n      }\n      \n      page.drawImage(photoImage, {\n        x: drawX,\n        y: drawY,\n        width: drawWidth,\n        height: drawHeight,\n      });\n    } else {\n      // Draw placeholder text if photo couldn't be loaded\n      page.drawText(\"Foto tidak\", { \n        x: x + photoWidth/2 - 25, \n        y: y - photoHeight/2 + 10, \n        size: 10, \n        font: font,\n        color: rgb(0.6, 0.6, 0.6) \n      });\n      page.drawText(\"tersedia\", { \n        x: x + photoWidth/2 - 20, \n        y: y - photoHeight/2 - 5, \n        size: 10, \n        font: font,\n        color: rgb(0.6, 0.6, 0.6) \n      });\n    }\n  } else {\n    // Draw placeholder for no photo\n    page.drawText(\"Tidak ada\", { \n      x: x + photoWidth/2 - 25, \n      y: y - photoHeight/2 + 10, \n      size: 10, \n      font: font,\n      color: rgb(0.6, 0.6, 0.6) \n    });\n    page.drawText(\"foto\", { \n      x: x + photoWidth/2 - 10, \n      y: y - photoHeight/2 - 5, \n      size: 10, \n      font: font,\n      color: rgb(0.6, 0.6, 0.6) \n    });\n  }\n\n  // Draw worker name below photo with reduced spacing\n  const nameY = y - photoHeight - 15; // Reduced from 15 to 8\n  const maxNameWidth = photoWidth - 4; // Leave 2px margin on each side\n  let displayName = worker.worker_name;\n  let textWidth = boldFont.widthOfTextAtSize(displayName, 9);\n  \n  // Truncate name if too long to fit in photo width\n  if (textWidth > maxNameWidth) {\n    while (textWidth > maxNameWidth && displayName.length > 0) {\n      displayName = displayName.substring(0, displayName.length - 4) + '...';\n      textWidth = boldFont.widthOfTextAtSize(displayName, 9);\n    }\n  }\n  \n  const nameX = x + (photoWidth - textWidth) / 2; // Center the name\n  \n  page.drawText(displayName, { \n    x: nameX, \n    y: nameY, \n    size: 9, // Reduced font size from 10 to 9\n    // font: boldFont,\n    color: rgb(0, 0, 0)\n  });\n}\n"
            }
          ]
        },
        {
          "type": "file",
          "name": "token-manager.ts",
          "content": "import { prisma } from '@/lib/singletons';\nimport { JWT_CONFIG } from './jwt-config';\n\nexport class TokenManager {\n  /**\n   * Cleanup expired refresh tokens\n   */\n  static async cleanupExpiredTokens() {\n    try {\n      const now = new Date();\n      await prisma.refreshToken.deleteMany({\n        where: {\n          expiresAt: {\n            lt: now\n          }\n        }\n      });\n    } catch (error) {\n      console.error('Error cleaning up expired tokens:', error);\n    }\n  }\n\n  /**\n   * Rotate refresh token\n   */\n  static async rotateRefreshToken(userId: string, oldToken: string) {\n    try {\n      // Begin transaction\n      const result = await prisma.$transaction(async (tx) => {\n        // Invalidate old token\n        await tx.refreshToken.delete({\n          where: {\n            token: oldToken,\n            userId: userId\n          }\n        });\n\n        // Create new token\n        const newToken = await tx.refreshToken.create({\n          data: {\n            token: crypto.randomUUID(),\n            userId: userId,\n            expiresAt: new Date(Date.now() + JWT_CONFIG.SESSION_MAX_AGE * 1000)\n          }\n        });\n\n        return newToken;\n      });\n\n      return result;\n    } catch (error) {\n      console.error('Error rotating refresh token:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Invalidate all refresh tokens for a user\n   */\n  static async invalidateAllUserTokens(userId: string) {\n    try {\n      await prisma.refreshToken.deleteMany({\n        where: {\n          userId: userId\n        }\n      });\n    } catch (error) {\n      console.error('Error invalidating user tokens:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get valid refresh token\n   */\n  static async getValidRefreshToken(token: string) {\n    try {\n      const refreshToken = await prisma.refreshToken.findFirst({\n        where: {\n          token: token,\n          expiresAt: {\n            gt: new Date()\n          }\n        },\n        include: {\n          user: true\n        }\n      });\n\n      return refreshToken;\n    } catch (error) {\n      console.error('Error getting refresh token:', error);\n      return null;\n    }\n  }\n}"
        }
      ]
    }
  ]
}