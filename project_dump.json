{
  "meta": {
    "root": "/media/asmorodwi/DATA/apaaja/penting/simlok2",
    "generated_at_iso": "2025-09-28T16:51:03.747Z",
    "total_files": 248,
    "total_bytes": 1639839,
    "options": {
      "include_tests": false,
      "include_stories": false,
      "max_bytes": 0
    },
    "nextjs_hints": {
      "hasAppDir": true,
      "hasPagesDir": false,
      "hasMiddleware": true,
      "hasRouteHandlers": true,
      "hasLayout": true,
      "hasPage": true
    }
  },
  "files": [
    {
      "path": ".prettierrc",
      "lang": "txt",
      "size": 355,
      "lines": 16,
      "hash": "3f7a9b585a27ee41edba90aeb74a989d62d9337c618830b5e3cbffd0f91d60c5",
      "truncated": false,
      "content": "{\n  \"semi\": true,\n  \"trailingComma\": \"es5\",\n  \"singleQuote\": true,\n  \"printWidth\": 80,\n  \"tabWidth\": 2,\n  \"useTabs\": false,\n  \"bracketSpacing\": true,\n  \"bracketSameLine\": false,\n  \"arrowParens\": \"avoid\",\n  \"endOfLine\": \"lf\",\n  \"plugins\": [\"prettier-plugin-tailwindcss\"],\n  \"tailwindConfig\": \"./tailwind.config.ts\",\n  \"tailwindFunctions\": [\"clsx\", \"cn\"]\n}\n"
    },
    {
      "path": "BARCODE_SCANNER_IMPLEMENTATION.md",
      "lang": "md",
      "size": 5145,
      "lines": 173,
      "hash": "414c4a1ad2243dbd750fb7a82597e2ce2d120f4f224dd479902507cce715403d",
      "truncated": false,
      "content": "# Implementasi Barcode Scanner untuk Verifier SIMLOK\n\n## Fitur yang Diimplementasikan\n\n### 1. Komponen CameraQRScanner\n- **Location**: `src/components/scanner/CameraQRScanner.tsx`\n- **Library**: ZXing (Zebra Crossing JS) untuk membaca berbagai format barcode\n- **Format yang Didukung**:\n  - QR Code\n  - Code 128\n  - Code 39\n  - EAN (European Article Number)\n  - UPC (Universal Product Code)\n  - Dan format barcode standar lainnya\n\n### 2. Fitur Scanner\n- **Pemilihan Kamera**: Mendukung multiple kamera, dengan preferensi kamera belakang\n- **Auto-focus**: Scanner otomatis mendeteksi dan membaca barcode/QR code\n- **Real-time Preview**: Video preview dengan overlay guide untuk positioning\n- **Error Handling**: Penanganan error yang komprehensif\n- **Statistics**: Tracking jumlah scan attempt dan waktu scan terakhir\n\n### 3. Integrasi dengan Dashboard Verifier\n- **Location**: `src/components/dashboard/VerifierDashboard.tsx`\n- Scanner terintegrasi langsung dalam dashboard verifier\n- Button \"Mulai Scan Barcode/QR Code\" untuk membuka scanner\n- History scan real-time\n\n### 4. API Integration\n- **Endpoint**: `/api/qr/verify`\n- **Method**: POST\n- **Parameters**:\n  - `qr_data`: Data yang di-scan (QR code atau barcode)\n  - `scanner_type`: Jenis scanner (default: \"barcode_scanner\")\n  - `scanLocation`: Lokasi scan (opsional)\n  - `scanNotes`: Catatan scan (opsional)\n\n### 5. Modal Components\n- **QrScanResultModal**: Menampilkan hasil scan yang berhasil\n- **QrScanErrorModal**: Menampilkan error dan tips untuk troubleshooting\n\n## Cara Penggunaan\n\n### 1. Akses Scanner\n1. Login sebagai user dengan role VERIFIER atau ADMIN\n2. Buka Dashboard Verifier\n3. Klik tombol \"Mulai Scan Barcode/QR Code\"\n\n### 2. Menggunakan Scanner\n1. Berikan izin akses kamera ke browser\n2. Pilih kamera yang sesuai (jika ada multiple kamera)\n3. Arahkan kamera ke barcode atau QR code SIMLOK\n4. Scanner akan otomatis mendeteksi dan memverifikasi data\n5. Hasil scan akan ditampilkan dalam modal\n\n### 3. Tips untuk Scanning Optimal\n- Pastikan barcode/QR code terlihat jelas di dalam frame\n- Hindari cahaya yang terlalu terang atau gelap\n- Jaga jarak 10-30cm dari kamera\n- Pastikan barcode/QR code tidak terlipat atau rusak\n\n## Dependencies\n\n### Library yang Digunakan\n- `@zxing/browser`: ^0.1.5 - Browser interface untuk ZXing\n- `@zxing/library`: ^0.21.3 - Core ZXing library untuk barcode detection\n\n### Browser Compatibility\n- Chrome 90+\n- Firefox 88+\n- Safari 14+\n- Edge 90+\n\n### Permissions Required\n- Camera access (`navigator.mediaDevices.getUserMedia`)\n\n## Security Features\n\n### 1. Authorization\n- Hanya user dengan role VERIFIER dan ADMIN yang dapat menggunakan scanner\n- Session validation pada setiap scan\n\n### 2. Data Validation\n- Verifikasi QR code/barcode authenticity menggunakan cryptographic signature\n- Expiry check (default: 7 hari)\n- Tamper detection\n\n### 3. Audit Trail\n- Setiap scan dicatat dalam database (`qrScan` table)\n- Informasi yang disimpan:\n  - ID submission yang di-scan\n  - User yang melakukan scan\n  - Timestamp scan\n  - Catatan scan (location, notes)\n\n## Database Schema\n\n### QrScan Table\n```sql\nCREATE TABLE qrScan (\n  id TEXT PRIMARY KEY,\n  submission_id TEXT NOT NULL,\n  scanned_by TEXT NOT NULL,\n  scanner_name TEXT,\n  notes TEXT,\n  scanned_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (submission_id) REFERENCES submission(id),\n  FOREIGN KEY (scanned_by) REFERENCES user(id)\n);\n```\n\n## API Response Format\n\n### Success Response\n```json\n{\n  \"success\": true,\n  \"message\": \"QR code/barcode verified successfully\",\n  \"scan_id\": \"scan_record_id\",\n  \"scanned_at\": \"2024-01-01T10:00:00Z\",\n  \"scanned_by\": \"Officer Name\",\n  \"data\": {\n    \"submission\": {\n      \"id\": \"submission_id\",\n      \"number\": \"SIMLOK-2024-001\",\n      \"title\": \"Job Description\",\n      \"task\": \"Implementation details\",\n      \"workers\": [{\"name\": \"Worker 1\"}],\n      \"vendor\": {\"name\": \"Vendor Name\"},\n      \"location\": \"Work Location\",\n      \"implementation_start_date\": \"2024-01-01T00:00:00Z\",\n      \"implementation_end_date\": \"2024-01-31T23:59:59Z\",\n      \"status\": \"approved\"\n    }\n  }\n}\n```\n\n### Error Response\n```json\n{\n  \"success\": false,\n  \"message\": \"Error description\"\n}\n```\n\n## Troubleshooting\n\n### Common Issues\n1. **Camera Access Denied**: User perlu memberikan izin kamera di browser\n2. **Scanner Tidak Mendeteksi**: Pastikan lighting adequate dan barcode/QR code dalam kondisi baik\n3. **Invalid Barcode**: Pastikan barcode/QR code adalah yang dibuat oleh sistem SIMLOK\n\n### Error Types\n- `invalid`: Barcode/QR code tidak valid atau bukan dari sistem SIMLOK\n- `expired`: Barcode/QR code sudah kedaluwarsa\n- `network`: Masalah koneksi saat verifikasi\n- `unknown`: Error tidak diketahui\n\n## Future Enhancements\n\n### Possible Improvements\n1. **Offline Scanning**: Cache verification data untuk scanning offline\n2. **Batch Scanning**: Scan multiple barcode sekaligus\n3. **OCR Integration**: Backup manual input jika scanner gagal\n4. **Performance Analytics**: Statistik performa scanning\n5. **Mobile App**: Native mobile app untuk scanning yang lebih optimal\n\n---\n\n**Implementasi Date**: September 20, 2025\n**Developer**: Assistant AI\n**Version**: 1.0.0"
    },
    {
      "path": "LOGO_SECOND_PAGE.md",
      "lang": "md",
      "size": 3290,
      "lines": 91,
      "hash": "2b3dc64be405ad1da9c15517ed3a823f07334d7ca7c0ac33732caa17aec1ddb8",
      "truncated": false,
      "content": "# Logo Pertamina di Halaman Kedua PDF\n\n## Ringkasan Perubahan\n\n### ✅ Logo di Halaman Daftar Pekerja\n**File Modified:** `src/utils/pdf/simlokTemplate.ts`\n\n**Perubahan:**\n1. **Logo di Halaman Kedua:** Logo Pertamina sekarang muncul di halaman \"DAFTAR PEKERJA\"\n2. **Logo di Halaman Tambahan:** Ketika ada banyak pekerja yang memerlukan halaman tambahan, logo juga akan ditampilkan\n3. **Konsistensi Design:** Posisi dan ukuran logo sama dengan halaman pertama\n\n### 📍 Posisi Logo\n- **Lokasi:** Kanan atas setiap halaman\n- **Koordinat:** 40px dari tepi kanan, 60px dari atas\n- **Ukuran:** 120px x 40px\n- **Format:** PNG (logo_pertamina.png)\n\n### 🔧 Implementation Details\n\n#### 1. Halaman Kedua (addWorkerPhotosPage)\n```typescript\n// Load and add logo to the second page as well\nconst logoImage = await loadLogo(k.doc);\nif (logoImage) {\n  const logoWidth = 120;\n  const logoHeight = 40;\n  const logoX = A4.w - logoWidth - 40; // 40 pixels from right edge\n  const logoY = A4.h - 60; // 60 pixels from top\n  \n  k.page.drawImage(logoImage, {\n    x: logoX,\n    y: logoY,\n    width: logoWidth,\n    height: logoHeight,\n  });\n}\n```\n\n#### 2. Halaman Tambahan (Overflow Workers)\n```typescript\n// Add logo to the new page\nconst logoImage = await loadLogo(k.doc);\nif (logoImage) {\n  // Same positioning as other pages\n  k.page.drawImage(logoImage, { ... });\n}\n```\n\n### 🎯 Hasil\n- ✅ **Halaman 1:** Logo Pertamina di kanan atas (sudah ada sebelumnya)\n- ✅ **Halaman 2:** Logo Pertamina di kanan atas + \"DAFTAR PEKERJA\"\n- ✅ **Halaman 3+:** Logo Pertamina di setiap halaman tambahan daftar pekerja\n\n### 📱 Konsistensi Branding\n- Logo muncul di semua halaman PDF SIMLOK\n- Posisi dan ukuran konsisten\n- Tidak mengganggu konten utama\n- Professional appearance\n\n### 🧪 Testing\n- ✅ TypeScript compilation: No errors\n- ✅ Logo loading function: Reused existing `loadLogo()`\n- ✅ Page layout: Logo tidak overlap dengan konten\n\n### 📝 Notes\n- Menggunakan fungsi `loadLogo()` yang sama untuk konsistensi\n- Logo hanya ditampilkan jika file logo tersedia\n- Graceful fallback jika logo tidak dapat dimuat\n- Mempertahankan layout yang ada tanpa perubahan major\n\n## Visual Preview\n\n```\n┌─────────────────────────────────────────────────────┐\n│                                        [LOGO]       │\n│                                                     │\n│                 DAFTAR PEKERJA                      │\n│            ─────────────────────────                │\n│                                                     │\n│  [FOTO]     [FOTO]     [FOTO]                      │\n│  Worker1    Worker2    Worker3                      │\n│                                                     │\n│  [FOTO]     [FOTO]     [FOTO]                      │\n│  Worker4    Worker5    Worker6                      │\n│                                                     │\n└─────────────────────────────────────────────────────┘\n```\n\nSekarang logo Pertamina akan muncul di semua halaman PDF SIMLOK! 🎉\n"
    },
    {
      "path": "PDF_METADATA_ENHANCEMENT.md",
      "lang": "md",
      "size": 3528,
      "lines": 105,
      "hash": "0182d6491131266599a3fbb0a6ffbc21abdc1f557143c1025ee448a165883fd8",
      "truncated": false,
      "content": "# PDF Metadata Enhancement - SIMLOK Number Display\n\n## 🎯 Problem Solved\n\n**Issue:** PDF viewer menampilkan UUID internal `5d9c47e9-91ae-4485-9e39-33d15189d13a` sebagai identifier dokumen alih-alih nomor SIMLOK yang sebenarnya.\n\n**Solution:** Menambahkan PDF metadata yang komprehensif dengan informasi SIMLOK yang tepat.\n\n## ✅ Implementation\n\n### 1. PDF Metadata Enhancement\n**File Modified:** `src/utils/pdf/simlokTemplate.ts`\n\n**Added Metadata:**\n```typescript\n// Set PDF metadata with SIMLOK information\nconst simlokNumber = s.simlok_number ? `${s.simlok_number}` : \"SIMLOK\";\nconst simlokTitle = `SIMLOK NO-${simlokNumber}`;\nconst currentDate = new Date();\n\nk.doc.setTitle(simlokTitle);                    // PDF Title\nk.doc.setSubject(\"Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)\");\nk.doc.setAuthor(\"PT PERTAMINA (PERSERO)\");\nk.doc.setKeywords([\"SIMLOK\", \"Pertamina\", \"Izin Masuk\", simlokNumber, s.vendor_name]);\nk.doc.setProducer(\"SIMLOK System\");\nk.doc.setCreator(\"SIMLOK PDF Generator\");\nk.doc.setCreationDate(currentDate);\nk.doc.setModificationDate(currentDate);\n```\n\n### 2. Metadata Properties Explained\n\n| Property | Value | Description |\n|----------|--------|-------------|\n| **Title** | `SIMLOK NO-{nomor}` | Judul dokumen yang akan muncul di PDF viewer |\n| **Subject** | `Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)` | Deskripsi dokumen |\n| **Author** | `PT PERTAMINA (PERSERO)` | Pembuat dokumen |\n| **Keywords** | `[\"SIMLOK\", \"Pertamina\", \"Izin Masuk\", nomor, vendor]` | Tag pencarian |\n| **Producer** | `SIMLOK System` | Sistem yang membuat PDF |\n| **Creator** | `SIMLOK PDF Generator` | Generator yang digunakan |\n| **Creation Date** | Current timestamp | Tanggal pembuatan |\n| **Modification Date** | Current timestamp | Tanggal modifikasi |\n\n## 🎉 Results\n\n**Before:**\n```\nPDF Viewer Title: 5d9c47e9-91ae-4485-9e39-33d15189d13a\n```\n\n**After:**\n```\nPDF Viewer Title: SIMLOK NO-7/09/2025\nPDF Subject: Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)\nPDF Author: PT PERTAMINA (PERSERO)\n```\n\n## 📱 Browser/Viewer Impact\n\n### Chrome PDF Viewer\n- Tab title akan menampilkan: `SIMLOK NO-{nomor}`\n- Properties akan menunjukkan metadata lengkap\n\n### Adobe Reader\n- Document title: `SIMLOK NO-{nomor}`\n- Document properties lengkap tersedia\n\n### Download Filename\n- Browser akan menyarankan filename berdasarkan title\n- Format: `SIMLOK NO-{nomor}.pdf`\n\n## 🔍 Additional Benefits\n\n1. **Better SEO/Search:** Keywords membantu pencarian dokumen\n2. **Professional Appearance:** Metadata lengkap terlihat lebih profesional\n3. **Document Management:** Mudah diidentifikasi dalam file manager\n4. **Audit Trail:** Creation/modification date untuk tracking\n5. **Vendor Information:** Nama vendor juga disertakan dalam keywords\n\n## 🧪 Testing\n\n```typescript\n// Example output metadata:\n{\n  title: \"SIMLOK NO-7/09/2025\",\n  subject: \"Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)\",\n  author: \"PT PERTAMINA (PERSERO)\",\n  keywords: [\"SIMLOK\", \"Pertamina\", \"Izin Masuk\", \"7/09/2025\", \"PT. Vendor Name\"],\n  producer: \"SIMLOK System\",\n  creator: \"SIMLOK PDF Generator\",\n  creationDate: \"2025-09-07T10:30:00.000Z\",\n  modificationDate: \"2025-09-07T10:30:00.000Z\"\n}\n```\n\n## 💡 Future Enhancements\n\nBisa ditambahkan metadata lain seperti:\n- **Custom Properties:** Lokasi kerja, tanggal berlaku\n- **Security Settings:** Read-only, print permissions\n- **Language:** Bahasa Indonesia\n- **Version Info:** Versi sistem SIMLOK\n\nSekarang PDF SIMLOK akan menampilkan nomor yang benar di PDF viewer alih-alih UUID internal! 🎯\n"
    },
    {
      "path": "QR_DAILY_SCAN_FLOW.md",
      "lang": "md",
      "size": 4387,
      "lines": 123,
      "hash": "a83ff276e10364a7809bb486a44e6b9e5dacaa3048164def6335e3f849a29f62",
      "truncated": false,
      "content": "# Implementasi Flow QR Scanning Harian untuk Verifier\n\n## Overview\nSistem scanning QR code telah diperbarui untuk menerapkan aturan scanning harian yang mencegah duplikasi scan pada hari yang sama dan memberikan informasi yang jelas kepada verifikator tentang status scan.\n\n## Aturan Scanning\n\n### 1. **Satu Scan Per Verifikator Per Hari**\n- Setiap verifikator hanya dapat memindai SIMLOK yang sama **sekali dalam satu hari**\n- Jika verifikator yang sama mencoba scan lagi di hari yang sama, akan muncul pesan:\n  ```\n  \"Anda sudah melakukan scan untuk SIMLOK ini hari ini pada [waktu]. \n  Verifikator yang sama tidak dapat scan SIMLOK yang sama di hari yang sama.\"\n  ```\n\n### 2. **Verifikator Berbeda Dapat Scan SIMLOK yang Sama**\n- **PERUBAHAN BARU**: Verifikator yang berbeda DIPERBOLEHKAN memindai SIMLOK yang sama pada hari yang sama\n- Multiple verifikator dapat scan satu SIMLOK untuk kebutuhan verifikasi berbeda\n- Hanya verifikator yang sama yang tidak boleh scan ulang di hari yang sama\n\n### 3. **Scan Dapat Dilakukan Setiap Hari**\n- Verifikator dapat memindai SIMLOK yang sama di hari yang berbeda\n- Tidak ada batasan total scan sepanjang periode implementasi\n- Setiap scan dicatat dengan timestamp lengkap untuk audit trail\n\n## Implementasi Teknis\n\n### API Endpoint: `/api/qr/verify`\n- **Method**: POST\n- **Authentication**: VERIFIER, ADMIN roles only\n- **Validation**: \n  - QR code integrity check\n  - Date range validation (implementation period)\n  - Daily duplicate scan prevention\n\n### Database Logic\n```sql\n-- Check ONLY for same verifier scan today (NEW RULE)\nSELECT * FROM QrScan \nWHERE submission_id = ? \n  AND scanned_by = ? \n  AND scanned_at BETWEEN startOfDay AND endOfDay\n\n-- Note: No longer checking for other verifier scans on same day\n-- Different verifiers are now allowed to scan same SIMLOK same day\n```\n\n### Error Handling\n1. **`duplicate_scan_same_day`**: Same verifier, same day (PREVENTED)\n2. **Different verifier same day**: ALLOWED (no longer generates error)\n3. **Race condition protection**: Unique constraint violations\n\n## User Experience\n\n### Success Flow\n1. Verifikator membuka scanner QR\n2. Scan QR code SIMLOK yang valid\n3. Sistem menampilkan detail submission\n4. Scan tercatat dalam database dengan timestamp\n\n### Error Flow - Duplikasi Hari Ini\n1. Verifikator scan QR code yang sudah discan hari ini\n2. Sistem menampilkan pesan error yang informatif\n3. Detail scan sebelumnya ditampilkan (verifikator, waktu)\n4. Verifikator dapat menutup modal dan mencoba SIMLOK lain\n\n### Success Flow - Scan oleh Verifikator Berbeda\n1. Verifikator scan QR code yang sudah discan verifikator lain hari ini\n2. Sistem MENGIZINKAN scan karena verifikator berbeda\n3. Scan tercatat sebagai verifikasi tambahan dari verifikator lain\n4. Mendukung multiple verifikasi untuk kualitas yang lebih baik\n\n## Benefits\n\n### 1. **Koordinasi Tim**\n- Verifikator tahu siapa yang sudah melakukan scan\n- Mencegah duplikasi effort \n- Meningkatkan efisiensi kerja tim\n\n### 2. **Audit Trail**\n- Setiap scan tercatat lengkap dengan timestamp\n- Mudah tracking siapa scan kapan\n- Compliance untuk audit internal\n\n### 3. **Fleksibilitas**\n- Tetap bisa scan setiap hari untuk monitoring berkelanjutan\n- Tidak membatasi total scan dalam periode implementasi\n- Mendukung workflow monitoring harian\n\n### 4. **User Experience**\n- Pesan error yang jelas dan informatif\n- Informasi scan sebelumnya untuk konteks\n- UI yang konsisten dengan error handling\n\n## Testing Scenarios\n\n### Scenario 1: Normal Scan\n1. Login sebagai verifier A\n2. Scan QR code SIMLOK X (pertama kali hari ini)\n3. ✅ **Expected**: Scan berhasil, data submission ditampilkan\n\n### Scenario 2: Duplicate Same User\n1. Login sebagai verifier A  \n2. Scan QR code SIMLOK X (kedua kali di hari yang sama)\n3. ❌ **Expected**: Error \"Sudah melakukan scan hari ini\"\n\n### Scenario 3: Different User Same Day\n1. Login sebagai verifier B\n2. Scan QR code SIMLOK X (sudah discan verifier A hari ini)\n3. ✅ **Expected**: Scan berhasil - verifikator berbeda DIPERBOLEHKAN scan SIMLOK yang sama\n\n### Scenario 4: Next Day Scan\n1. Tunggu hingga hari berikutnya\n2. Login sebagai verifier A atau B\n3. Scan QR code SIMLOK X\n4. ✅ **Expected**: Scan berhasil (hari baru = reset)\n\n---\n\n**Implementation Date**: September 28, 2025\n**Developer**: Assistant AI  \n**Version**: 2.0.0 - Daily Scan Flow\n**Previous Version**: 1.0.0 - Basic QR Scanning"
    },
    {
      "path": "QR_SECURITY_IMPLEMENTATION.md",
      "lang": "md",
      "size": 4250,
      "lines": 155,
      "hash": "085c64591789e6a8f6543cb02c421cf5eb1ff1dde1f67ecf61b1c676088b4c07",
      "truncated": false,
      "content": "# Secure QR Code System - Testing Guide\n\n## Overview\nSistem QR Code baru menggunakan hashing dan enkripsi untuk mencegah manipulasi data. QR code berisi:\n- ID submission\n- Tanggal mulai dan selesai pelaksanaan  \n- Timestamp pembuatan\n- Hash verifikasi dengan salt\n\n## Features Implemented\n\n### 1. Secure QR Generation ✅\n- **Location**: `/api/submissions/[id]` (saat approval)\n- **Security**: AES-256 encryption + SHA-256 hash\n- **Expiry**: QR code expires after 24 hours\n- **Data**: ID + implementation dates + timestamp + salt\n\n### 2. QR Verification API ✅\n- **Endpoint**: `POST /api/qr/verify`\n- **Authentication**: Only VERIFIER and ADMIN roles\n- **Validation**: Hash verification, date range check, expiry check\n- **Response**: Full submission details if valid\n\n### 3. Scan Tracking ✅\n- **Table**: `QrScan` - tracks who scanned when\n- **Data**: scanner user, timestamp, location, notes\n- **Relations**: Links to User and Submission models\n\n### 4. Frontend Components ✅\n- **SecureQrScanner**: Modern QR scanner with verification\n- **ScanHistory**: View scan logs with filters\n- **VerifierDashboard**: Integrated scan functionality\n\n## How to Test\n\n### 1. Create Test Submission\n1. Login as vendor\n2. Create new submission\n3. Add worker data\n4. Submit for approval\n\n### 2. Approve with Implementation Dates  \n1. Login as admin\n2. Go to submission details\n3. Set approval to \"APPROVED\"\n4. **IMPORTANT**: Set implementation start & end dates\n5. Fill other required fields\n6. Save approval\n\n### 3. Test QR Scanning\n1. Login as verifier \n2. Click \"Scanner QR\" button\n3. Scan the QR code from approved submission\n4. Verify response shows correct data\n5. Check scan is recorded in history\n\n### 4. Test Security Features\n1. Try scanning expired QR (change system date)\n2. Try scanning modified QR data\n3. Try scanning with vendor account (should fail)\n4. Test date range validation\n\n## QR Code Format\n```\nSIMLOK|<encrypted_payload>|<hash>\n```\n\nWhere:\n- `encrypted_payload`: Base64 encoded encrypted JSON with IV\n- `hash`: SHA-256 hash of ID|start_date|end_date|timestamp|salt\n\n## Environment Variables\n```env\nQR_SECURITY_SALT=\"simlok_qr_security_salt_2025_super_secure\"\n```\n\n## API Endpoints\n\n### POST /api/qr/verify\n**Purpose**: Verify QR code and record scan\n**Auth**: VERIFIER, ADMIN only\n**Body**:\n```json\n{\n  \"qrString\": \"SIMLOK|payload|hash\",\n  \"scanLocation\": \"Pintu Masuk Area A\", \n  \"scanNotes\": \"Regular patrol scan\"\n}\n```\n\n**Response**:\n```json\n{\n  \"success\": true,\n  \"message\": \"QR code verified successfully\",\n  \"scan_id\": \"cm123...\",\n  \"scanned_at\": \"2025-09-15T13:45:00Z\",\n  \"submission\": { /* full submission data */ }\n}\n```\n\n### GET /api/qr/verify\n**Purpose**: Get scan history\n**Auth**: VERIFIER (own scans), ADMIN (all scans)\n**Query**: `?limit=20&offset=0&submission_id=cm123`\n\n## Database Schema\n\n### QrScan Table\n```sql\n- id: String (cuid)\n- submission_id: String (FK to Submission)\n- scanned_by: String (FK to User) \n- scanned_at: DateTime\n- scanner_name: String (optional)\n- notes: String (optional)\n```\n\n## Security Features\n\n1. **Encryption**: AES-256 with random IV\n2. **Hash Verification**: SHA-256 with secret salt\n3. **Expiry**: 24 hour time limit\n4. **Date Validation**: Check if current date within implementation period\n5. **Role-based Access**: Only verifiers/admins can scan\n6. **Audit Trail**: All scans logged with user and timestamp\n\n## Testing Scenarios\n\n### Valid QR Scan\n- ✅ QR from approved submission\n- ✅ Within implementation date range\n- ✅ Not expired (< 24 hours)\n- ✅ Scanned by verifier/admin\n\n### Invalid QR Scan\n- ❌ Modified QR data (hash mismatch)\n- ❌ Expired QR (> 24 hours old)\n- ❌ Outside implementation dates\n- ❌ Scanned by vendor (access denied)\n- ❌ QR from pending/rejected submission\n\n## Troubleshooting\n\n1. **\"Hash verification failed\"**: QR data modified or wrong salt\n2. **\"QR code has expired\"**: QR older than 24 hours\n3. **\"Not valid for current date\"**: Outside implementation period  \n4. **\"Access denied\"**: Non-verifier trying to scan\n5. **\"Submission not found\"**: Invalid submission ID in QR\n\n## Migration Applied\n- ✅ `20250915135300_add_qr_scan_tracking` - Added QrScan table\n- ✅ Database relations properly configured\n- ✅ Indexes added for performance\n"
    },
    {
      "path": "README.md",
      "lang": "md",
      "size": 22586,
      "lines": 657,
      "hash": "ee4c068c79d4b9c93112c9566b56dbcaa6b1e89fdd65d62851fd1502410c453d",
      "truncated": false,
      "content": "# SIMLOK2 - Sistem Izin Lokasi Kerja (Optimized)\n\n**Real-time Next.js application** untuk manajemen pengajuan SIMLOK (Surat Izin Lokasi Kerja) dengan fitur **Socket.IO realtime**, **Redis caching**, dan **clean architecture**. Aplikasi ini sudah dioptimasi untuk **performa tinggi**, **real-time updates**, dan **mudah di-maintenance**.\n\n## 🚀 Fitur Utama (OPTIMIZED)\n\n- **⚡ Real-time Updates**: Socket.IO + Redis untuk update instant tanpa refresh\n- **🔔 Smart Notifications**: Complete notification system dengan unread counts\n- **⚡ High Performance**: Redis caching dan optimized database queries\n- **🎯 Clean Architecture**: Singleton patterns, API v1 dengan DTO validation\n- **🛡️ Robust Security**: NextAuth.js, role-based access, input validation\n- **📊 Live Dashboard**: Real-time statistics dan submission updates\n- **🔄 Event-Driven**: Arsitektur berbasis events untuk scalability\n- **🎨 Modern UI**: Responsive design dengan TailwindCSS 4\n- **📁 File Management**: Upload, preview, dan manajemen dokumen\n- **📄 PDF Generation**: Auto-generate PDF SIMLOK dengan template\n\n## 🏗️ Tech Stack (Optimized)\n\n### Core Technologies\n- **Frontend**: Next.js 15 (App Router), React 19, TypeScript\n- **Backend**: Custom Socket.IO Server + Next.js API Routes  \n- **Database**: MySQL via Prisma 6.x ORM (with optimized indexing)\n- **Cache**: Redis (ioredis) with namespaced helpers\n- **Realtime**: Socket.IO 4.x + @socket.io/redis-adapter\n- **State Management**: Zustand stores\n- **Authentication**: NextAuth.js v4 + Prisma Adapter\n- **Styling**: TailwindCSS v4\n- **Validation**: Zod schemas for API endpoints and events\n\n### Performance Features\n- **🔄 Real-time Events**: Socket.IO dengan Redis pub/sub adapter\n- **⚡ Singleton Pattern**: HMR-safe database dan Redis connections\n- **🗃️ Smart Caching**: Redis dengan namespace-based cache invalidation\n- **📊 Optimized Queries**: Database indexing dan efficient Prisma queries\n- **🎯 API v1**: Modern REST API dengan DTO validation dan pagination\n- **🔔 Complete Notifications**: Real-time notification system\n\n## 📁 Struktur Proyek (Optimized Architecture)\n\n```\nsrc/\n├── app/                           # Next.js App Router\n│   ├── (auth)/                   # Auth routes (login, signup)\n│   ├── (dashboard)/              # Dashboard routes dengan real-time features\n│   ├── api/                      # API endpoints\n│   │   ├── v1/                   # API v1 dengan validasi DTO\n│   │   │   └── notifications/    # Modern notification endpoints\n│   │   ├── auth/                 # NextAuth endpoints\n│   │   ├── admin/                # Admin-specific endpoints\n│   │   ├── vendor/               # Vendor-specific endpoints\n│   │   └── submissions/          # CRUD submissions\n│   ├── globals.css              # Global styles\n│   ├── layout.tsx               # Root layout dengan providers\n│   └── socket-provider.tsx      # Socket.IO client provider dengan event handling\n├── components/                   # React components\n│   ├── ui/                      # Reusable UI components\n│   ├── admin/                   # Admin-specific components\n│   ├── vendor/                  # Vendor-specific components\n│   ├── notifications/           # Notification system components\n│   └── common/                  # Shared components\n├── features/                    # Feature-based modules (NEW)\n│   └── notifications/           # Complete notification feature\n│       ├── ui/                  # Notification UI components\n│       ├── data/                # Data services dengan API integration\n│       ├── types/               # TypeScript types\n│       └── server/              # Server-side notification logic\n├── lib/                         # Core utilities dan services\n│   ├── singletons.ts           # ⭐ Prisma, Redis, Socket.IO singletons (HMR-safe)\n│   ├── cache.ts                # ⭐ Redis cache helpers dengan namespacing\n│   ├── api-utils.ts            # ⭐ API utility functions dengan validation\n│   ├── auth.ts                 # NextAuth configuration\n│   └── db.ts                   # Database utilities\n├── server/                      # Server-side modules (NEW)\n│   ├── socket.ts               # Socket.IO server logic\n│   ├── events.ts               # Business event handlers\n│   └── eventsPublisher.ts      # ⭐ Centralized event publishing service\n├── shared/                      # Shared constants dan types (NEW)\n│   ├── events.ts               # ⭐ Socket.IO event schemas dengan validation\n│   ├── dto.ts                  # ⭐ API DTO schemas (Zod)\n│   └── constants.ts            # Application constants\n├── store/                       # Zustand stores\n│   ├── notifications.ts        # ⭐ Notification state management\n│   ├── stats.ts                # Statistics state\n│   └── lists.ts                # Lists state dengan real-time updates\n└── types/                       # TypeScript type definitions\n    ├── next-auth.d.ts          # NextAuth type extensions\n    ├── role.ts                 # Role definitions\n    └── submission.ts           # Submission types\n```\n\n### Key Architecture Improvements\n- **⭐ Singleton Pattern**: HMR-safe database dan Redis connections\n- **⭐ Event-Driven**: Centralized event publishing untuk real-time updates  \n- **⭐ Feature Modules**: Organized code dengan complete feature isolation\n- **⭐ API v1**: Modern REST API dengan DTO validation dan proper error handling\n- **⭐ Smart Caching**: Redis dengan namespace-based cache invalidation\n\n## 🛠️ Development Setup\n\n### Prerequisites\n- Node.js 18+ \n- MySQL 8.0+\n- Redis 6.0+ (untuk real-time features)\n\n### Quick Start - Complete Setup\n\n```bash\n# 1. Clone dan install dependencies\ngit clone <repository-url>\ncd simlok2\nnpm install\n\n# 2. Setup environment variables\ncp .env.example .env.local\n\n# 3. Generate NextAuth secret\nopenssl rand -base64 32\n# Copy hasil ke NEXTAUTH_SECRET di .env.local\n\n# 4. Edit .env.local dengan konfigurasi database dan Redis\n# DATABASE_URL=\"mysql://user:password@localhost:3306/simlok2\"\n# REDIS_URL=\"redis://localhost:6379\"\n# NEXTAUTH_SECRET=\"your-generated-secret\"\n# NEXTAUTH_URL=\"http://localhost:3000\"\n\n# 5. Setup database\nnpx prisma migrate dev\nnpm run seed\n\n# 6. Start Redis server (pastikan Redis running)\nredis-server\n\n# 7. Development dengan Socket.IO real-time features\nnpm run dev\n```\n\n### Production Deployment\n\n```bash\n# 1. Build aplikasi\nnpm run build\n\n# 2. Start production server dengan Socket.IO\nnpm run start\n```\n\n### Development Options\n\n```bash\n# Option 1: Full development dengan Socket.IO + Redis realtime\nnpm run dev              # Custom server dengan all features\n\n# Option 2: Next.js only (tanpa Socket.IO) untuk debugging\nnpm run dev:next         # Standard Next.js dev server\n\n# Type checking\nnpm run typecheck        # TypeScript validation\n```\n\n## 📋 Environment Variables\n\n### Required Variables\n```bash\n# Database MySQL\nDATABASE_URL=\"mysql://username:password@host:port/database\"\n\n# Redis (untuk real-time features)\nREDIS_URL=\"redis://localhost:6379\"\n\n# NextAuth Configuration\nNEXTAUTH_URL=\"http://localhost:3000\"  # atau domain production\nNEXTAUTH_SECRET=\"your-32-character-secret-key\"\n```\n\n### Optional Variables\n```bash\n# JWT Settings (defaults provided)\nJWT_EXPIRE_TIME=21600        # Session duration (6 hours)\nSESSION_MAX_AGE=21600        # Max session age  \nSESSION_UPDATE_AGE=1800      # Update interval (30 min)\n\n# Performance tuning\nREDIS_MAX_RETRIES=3          # Redis connection retries\nSOCKET_PING_TIMEOUT=30000    # Socket.IO ping timeout\n```\n\n### Complete .env.local Example\n```bash\n# Development Configuration\nDATABASE_URL=\"mysql://root:@localhost:3306/simlok2\"\nREDIS_URL=\"redis://localhost:6379\"\nNEXTAUTH_URL=\"http://localhost:3000\"\nNEXTAUTH_SECRET=\"development-secret-min-32-chars-example\"\n\n# Production Configuration  \n# DATABASE_URL=\"mysql://user:pass@production-host:3306/simlok_prod\"\n# REDIS_URL=\"redis://production-redis:6379\"\n# NEXTAUTH_URL=\"https://simlok.yourdomain.com\"\n# NEXTAUTH_SECRET=\"production-very-secure-secret-key\"\n```\n\n## 🔐 Data Default Setelah Seeding\n\nSetelah menjalankan `npm run seed`, Anda dapat login dengan akun berikut:\n\n| Peran     | Email                  | Password     | Status      |\n|-----------|------------------------|--------------|-------------|\n| Admin     | admin@example.com      | admin123     | Verified    |\n| Verifier  | verifier@example.com   | verifier123  | Verified    |\n| Vendor    | vendora@example.com    | vendor123    | Verified    |\n\n### Data Dummy yang Dibuat\n- **3 User**: 1 Admin, 1 Verifier, 1 Vendor (sudah terverifikasi)\n- **8+ Pengajuan SIMLOK**: Dengan berbagai status (PENDING, APPROVED, REJECTED)\n- **Dokumen Sample**: Nomor SIMJA, SIKA, dan SIMLOK yang realistis\n- **Riwayat Aktivitas**: Data created/updated dengan timestamp yang bervariasi\n\n## 🎯 Panduan Penggunaan\n\n### Flow Registrasi Vendor\n1. **Akses halaman signup** (`/signup`)\n2. **Isi form registrasi** dengan data lengkap vendor\n3. **Submit form** → Redirect ke halaman verification-pending\n4. **Admin verifikasi** akun di dashboard admin\n5. **Vendor dapat login** setelah diverifikasi\n\n### Flow Pengajuan SIMLOK\n1. **Vendor login** dan akses dashboard\n2. **Buat pengajuan baru** dengan upload dokumen\n3. **Admin review** pengajuan di dashboard admin\n4. **Admin approve/reject** dengan keterangan\n5. **PDF SIMLOK generate** otomatis jika approved\n\n### Management User (Admin)\n- **Dashboard Admin**: Statistik lengkap dan tabel user terbaru\n- **User Management**: Verifikasi, edit, delete user\n- **Pengajuan Management**: Approve/reject dengan modal detail\n\n## 📦 Available Scripts\n\n```bash\n# Development\nnpm run dev          # Start custom server dengan Socket.IO + Redis realtime\nnpm run dev:next     # Start Next.js dev server only (tanpa Socket.IO)\n\n# Production  \nnpm run build        # Build aplikasi untuk produksi (dengan optimizations)\nnpm run start        # Start production server dengan semua fitur real-time\n\n# Code Quality\nnpm run lint         # ESLint untuk code quality\nnpm run typecheck    # TypeScript type checking\n\n# Database\nnpm run seed         # Seed database dengan data lengkap\nnpm run seed:simple  # Seed database dengan data minimal\n```\n\n## 🔗 API Endpoints\n\n### Authentication\n- `POST /api/auth/signin` - Login with email/password\n- `POST /api/auth/signup` - Register vendor baru\n\n### Submissions (SIMLOK)\n- `GET /api/submissions` - List submissions dengan filtering\n- `POST /api/submissions` - Create submission dengan file upload\n- `GET /api/submissions/[id]` - Get submission detail\n- `PUT /api/submissions/[id]` - Update submission\n- `DELETE /api/submissions/[id]` - Delete submission\n\n### Admin Management\n- `GET /api/admin/submissions` - Admin submissions management\n- `GET /api/admin/users` - User management dan verification\n- `PUT /api/users/[id]/verify` - Verify vendor account\n\n### Notifications API (v1) ⭐ NEW\n- `GET /api/v1/notifications` - Get notifications dengan pagination\n- `POST /api/v1/notifications/[id]/read` - Mark notification sebagai read\n- `POST /api/v1/notifications/read-all` - Mark all notifications sebagai read\n- `GET /api/v1/notifications/unread-count` - Get unread notification count\n\n## � Real-time Features ⭐ NEW\n\n### Socket.IO Events\n\n**Client Connection:**\n```javascript\n// Auto-join room berdasarkan user role\nsocket.emit('join', { userId, role });\n```\n\n**Server → Client Events:**\n- `admin:new_submission` - Pengajuan baru untuk admin/verifier\n- `admin:new_vendor` - Pendaftaran vendor baru  \n- `vendor:submission_status_changed` - Update status pengajuan untuk vendor\n- `notification:new` - Notifikasi baru dengan data lengkap\n- `notification:unread_count` - Update realtime unread count\n- `stats:update` - Update statistik dashboard\n\n### Socket.IO Rooms\n- `admin` - Room untuk semua admin dan verifier\n- `vendor:{vendorId}` - Room spesifik untuk masing-masing vendor\n\n### Real-time Data Flow\n```\nUser Action → API Endpoint → Database Update → Event Publisher → Socket.IO → All Connected Clients\n```\n\n### Notification System ⭐ Complete\n- **⚡ Real-time Push**: Notifikasi langsung tanpa refresh\n- **🔔 Unread Badges**: Live update unread count  \n- **📋 Notification Panel**: Paginated notifications dengan mark as read\n- **🎯 Role-based**: Notifikasi sesuai dengan role user (admin/vendor)\n- **📱 Responsive**: Bell icon dengan dropdown panel\n\n### Cache Strategy ⭐ Optimized\n```javascript\n// Redis cache dengan namespace\nawait cache.set('stats', 'admin', data, 300); // 5 minutes TTL\nawait cache.get('notifications', userId);\nawait cache.invalidatePattern('submissions:*'); // Bulk invalidation\n```\n\n## �🗄️ Database Schema (Optimized)\n\n### Core Tables (Optimized)\n\n#### User Model\n```prisma\nmodel User {\n  id              String    @id @default(cuid())\n  nama_petugas    String\n  email           String    @unique\n  password        String?\n  nama_vendor     String?   # Untuk role VENDOR\n  alamat          String\n  no_telp         String\n  role            Role      @default(VENDOR)\n  verified_at     DateTime?\n  verified_by     String?\n  date_created_at DateTime  @default(now())\n  \n  submissions     Submission[]\n  notifications   Notification[]\n  notificationReads NotificationRead[]\n  \n  @@index([role])\n  @@index([verified_at])\n}\n```\n\n#### Notification Model ⭐ NEW\n```prisma\nmodel Notification {\n  id        String   @id @default(cuid())\n  title     String\n  message   String   @db.Text\n  type      NotificationType\n  userId    String   # Target user\n  createdAt DateTime @default(now())\n  \n  # Related data (optional)\n  submissionId String?\n  triggeredBy  String? # User yang trigger notifikasi\n  \n  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)\n  reads       NotificationRead[]\n  \n  @@index([userId, createdAt])\n  @@index([type])\n}\n\nmodel NotificationRead {\n  id             String       @id @default(cuid())\n  notificationId String\n  userId         String\n  readAt         DateTime     @default(now())\n  \n  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)\n  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)\n  \n  @@unique([notificationId, userId])\n  @@index([userId])\n}\n\nenum NotificationType {\n  SUBMISSION_CREATED\n  SUBMISSION_APPROVED  \n  SUBMISSION_REJECTED\n  VENDOR_REGISTERED\n  SYSTEM_UPDATE\n}\n```\n\n#### Submission Model (Enhanced Indexing)\n```prisma\nmodel Submission {\n  // ... existing fields ...\n  \n  @@index([userId])\n  @@index([status_approval_admin])\n  @@index([created_at])\n  @@index([status_approval_admin, created_at]) # Composite index\n}\n```\n\n## 🔒 Fitur Keamanan\n\n- **Password Hashing**: bcryptjs dengan salt rounds tinggi\n- **JWT Tokens**: Session management dengan expiry dan refresh\n- **CSRF Protection**: Built-in NextAuth.js CSRF protection\n- **Route Protection**: Middleware-based authentication dan authorization\n- **Role Validation**: Server-side role checking di setiap endpoint\n- **Input Validation**: Zod schema validation untuk semua input\n- **Rate Limiting**: Protection terhadap brute force attacks\n- **SQL Injection Prevention**: Prisma ORM dengan prepared statements\n\n## 🎯 Key Features (Complete Implementation)\n\n### 1. ⚡ Real-time Dashboard\n- ✅ Auto-update tanpa refresh halaman  \n- ✅ Live statistics updates via Socket.IO\n- ✅ Real-time submission list updates\n- ✅ Instant notification push\n\n### 2. 🔔 Complete Notification System ⭐ NEW\n- ✅ Push notifications untuk semua events penting\n- ✅ Unread count badge dengan live updates\n- ✅ Mark as read / mark all as read functionality\n- ✅ Notification panel dengan pagination\n- ✅ Role-based notification targeting\n\n### 3. 🛡️ Enhanced Security & Performance\n- ✅ Role-based access control (Admin/Verifier/Vendor)\n- ✅ NextAuth.js dengan JWT session management  \n- ✅ Redis caching untuk performa optimal\n- ✅ Optimized database queries dengan proper indexing\n- ✅ Input validation dengan Zod schemas\n\n### 4. � Advanced File Management\n- ✅ Upload documents (SIKA, SIMJA, ID Card)\n- ✅ Document preview dan download\n- ✅ Organized file storage per user/category\n- ✅ File size dan type validation\n\n### 5. 🏗️ Clean Architecture ⭐ REFACTORED\n- ✅ Singleton patterns untuk HMR safety\n- ✅ Feature-based code organization\n- ✅ API v1 dengan DTO validation\n- ✅ Event-driven architecture\n- ✅ Separation of concerns dengan proper modules\n\n## 🚀 Deployment (Production Ready)\n\n### Production Environment Setup\n```bash\n# Required environment variables\nNODE_ENV=production\nDATABASE_URL=\"mysql://user:password@host:3306/database\"\nREDIS_URL=\"redis://production-redis:6379\"\nNEXTAUTH_SECRET=\"secure-production-secret-key\"\nNEXTAUTH_URL=\"https://your-domain.com\"\n\n# Optional performance tuning\nREDIS_MAX_RETRIES=3\nSOCKET_PING_TIMEOUT=30000\n```\n\n### Production Deployment\n```bash\n# Build dan deploy\nnpm ci --only=production\nnpm run build\nnpm run start\n```\n\n### Docker Setup (Recommended)\n```yaml\nversion: '3.8'\nservices:\n  app:\n    build: .\n    ports:\n      - \"3000:3000\"\n    depends_on:\n      - mysql\n      - redis\n    environment:\n      - DATABASE_URL=mysql://user:password@mysql:3306/simlok\n      - REDIS_URL=redis://redis:6379\n      \n  mysql:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n      MYSQL_DATABASE: simlok\n      \n  redis:\n    image: redis:6.0-alpine\n    command: redis-server --appendonly yes\n```\n\n## �🚨 Troubleshooting (Updated)\n\n### Common Issues & Solutions\n\n1. **Redis Connection Error**\n   ```bash\n   # Start Redis locally\n   redis-server\n   \n   # Check Redis connection\n   redis-cli ping\n   # Should return \"PONG\"\n   ```\n\n2. **Socket.IO Not Working**\n   ```bash\n   # Pastikan menggunakan custom server (BUKAN dev:next)\n   npm run dev  # ✅ Correct - includes Socket.IO\n   # npm run dev:next  # ❌ Wrong - Next.js only\n   \n   # Check environment\n   echo $REDIS_URL\n   ```\n\n3. **Database Connection Error**\n   ```bash\n   # Reset database dengan migration\n   npx prisma migrate reset\n   npm run seed\n   \n   # Test connection\n   npx prisma db pull\n   ```\n\n4. **Build/TypeScript Errors**\n   ```bash\n   # Type checking\n   npm run typecheck\n   \n   # Fix linting issues\n   npm run lint\n   \n   # Clear build cache\n   rm -rf .next\n   npm run build\n   ```\n\n5. **Notification System Issues**\n   ```bash\n   # Check Redis connection untuk events\n   redis-cli monitor\n   \n   # Test Socket.IO connection di browser console\n   console.log(socket.connected);\n   ```\n\n6. **Performance Issues**\n   ```bash\n   # Check Redis cache status\n   redis-cli info memory\n   \n   # Monitor database queries\n   npx prisma studio\n   ```\n\n## 📚 Development Resources\n\n### Architecture Documentation\n- [Singleton Pattern Implementation](src/lib/singletons.ts) - HMR-safe database connections\n- [Event Publisher Service](src/server/eventsPublisher.ts) - Centralized Socket.IO events\n- [Cache Helper Functions](src/lib/cache.ts) - Redis namespace-based caching\n- [API v1 with DTO Validation](src/app/api/v1/) - Modern REST API design\n- [Notification Feature Module](src/features/notifications/) - Complete notification system\n\n### Socket.IO Integration\n- Custom server in [server.js](server.js) menggunakan singleton patterns\n- Event handling di [src/server/socket.ts](src/server/socket.ts)\n- Client provider di [src/app/socket-provider.tsx](src/app/socket-provider.tsx)\n\n### External Resources\n- [Next.js 15 Documentation](https://nextjs.org/docs)\n- [Socket.IO Documentation](https://socket.io/docs/v4/)\n- [Prisma Documentation](https://www.prisma.io/docs)\n- [Redis Documentation](https://redis.io/docs/)\n- [NextAuth.js Documentation](https://next-auth.js.org/)\n\n## 📊 Performance Benchmarks\n\n### Optimizations Implemented\n- **Database**: Proper indexing, optimized queries, connection pooling\n- **Cache**: Redis dengan TTL dan namespace-based invalidation\n- **Real-time**: Efficient Socket.IO dengan room-based targeting\n- **Frontend**: Code splitting, lazy loading, optimized bundle size\n- **Build**: TypeScript strict mode, ESLint optimizations\n\n### Key Metrics (After Optimization)\n- **Build Time**: ~14s (dengan type checking dan linting)\n- **Bundle Size**: Optimized dengan proper code splitting\n- **Database Queries**: Indexed dan cached untuk performa optimal\n- **Real-time Latency**: < 100ms untuk Socket.IO events\n- **Memory Usage**: Reduced dengan singleton patterns\n\n## 🤝 Contributing\n\n## 🤝 Contributing\n\n1. Fork repository\n2. Create feature branch (`git checkout -b feature/amazing-feature`)\n3. Run tests (`npm run typecheck && npm run lint`)\n4. Commit changes (`git commit -m 'feat: add amazing feature'`)\n5. Push to branch (`git push origin feature/amazing-feature`)\n6. Open Pull Request\n\n### Development Guidelines\n- Ikuti TypeScript strict mode\n- Gunakan singleton patterns untuk database/Redis connections\n- Implement proper error handling dengan Zod validation\n- Tulis tests untuk fitur baru\n- Update dokumentasi untuk API changes\n\n## 📄 License\n\nAplikasi ini untuk keperluan internal dan tidak untuk didistribusikan secara komersial.\n\n---\n\n## ✨ What's New in This Version\n\n### 🚀 Major Refactoring (2024)\n- **⚡ Real-time Architecture**: Complete Socket.IO + Redis implementation  \n- **🔔 Notification System**: Full-featured notification system dengan UI\n- **🏗️ Clean Code**: Singleton patterns, feature modules, API v1\n- **📊 Performance**: Redis caching, optimized queries, proper indexing\n- **🛡️ Robust Validation**: Zod schemas untuk semua API dan events\n- **🎯 Type Safety**: Complete TypeScript coverage dengan strict mode\n\n### 🔧 Technical Improvements\n- HMR-safe singleton patterns untuk development\n- Event-driven architecture dengan centralized publisher\n- Namespace-based Redis caching dengan smart invalidation\n- Modern API design dengan DTO validation dan pagination\n- Complete feature isolation dengan organized code structure\n\n---\n\n## 📞 Support\n\nUntuk pertanyaan teknis atau bug report:\n- Buat issue di repository ini dengan template yang sesuai\n- Include log errors dan reproduction steps\n- Mention environment details (OS, Node.js version, browser)\n\n**Dibuat dengan ❤️ dan dioptimasi untuk performa maksimal**"
    },
    {
      "path": "SCAN_HISTORY_IMPLEMENTATION.md",
      "lang": "md",
      "size": 4415,
      "lines": 133,
      "hash": "0c56700aeffefc37ce0ef29d09f6c0465cc1427272285f434232571ca63b6547",
      "truncated": false,
      "content": "# Scan History Feature\n\n## Overview\nHalaman Scan History memungkinkan **Reviewer** dan **Approver** untuk memantau aktivitas scan QR code yang dilakukan oleh **Verifikator**. Fitur ini memberikan transparansi dan monitoring pada proses verifikasi submission.\n\n## Features\n\n### 1. **Sidebar Navigation**\n- Menu \"Scan History\" ditambahkan ke sidebar untuk role REVIEWER dan APPROVER\n- Menggunakan QrCodeIcon untuk visualisasi yang jelas\n- Navigasi langsung ke halaman scan history\n\n### 2. **Filtering System**\n- **Date Range Filter**: Filter berdasarkan tanggal dari dan sampai\n- **Verifier Filter**: Cari berdasarkan nama verifikator\n- **Submission Filter**: Cari berdasarkan nomor SIMLOK\n- **Reset Function**: Reset semua filter dengan satu klik\n\n### 3. **Data Display**\n- **Submission Info**: Nomor SIMLOK, company name, project name\n- **Verifier Info**: Nama, email, dan role verifikator\n- **Scan Time**: Waktu scan dengan format relative time (e.g., \"2 jam yang lalu\")\n- **Status Tracking**: Review status dan final approval status\n- **Pagination**: Navigasi halaman untuk data yang banyak\n\n### 4. **Detail Modal**\n- Modal detail untuk setiap scan record\n- Informasi lengkap submission dan verifikator\n- Scan details termasuk timestamp dan notes (jika ada)\n- Current status submission\n\n## API Endpoints\n\n### GET /api/scan-history\n**Parameters:**\n- `page` (number): Halaman data (default: 1)\n- `limit` (number): Jumlah data per halaman (default: 20)\n- `dateFrom` (string): Filter tanggal mulai (format: YYYY-MM-DD)\n- `dateTo` (string): Filter tanggal akhir (format: YYYY-MM-DD)\n- `verifier` (string): Filter nama verifikator (case insensitive)\n- `submissionId` (string): Filter nomor SIMLOK (case insensitive)\n\n**Response:**\n```json\n{\n  \"scans\": [\n    {\n      \"id\": \"scan_id\",\n      \"submission_id\": \"submission_id\",\n      \"scanned_by\": \"user_id\",\n      \"scanned_at\": \"2025-09-27T10:30:00Z\",\n      \"scanner_name\": \"Optional scanner name\",\n      \"notes\": \"Optional notes\",\n      \"submission\": {\n        \"id\": \"submission_id\",\n        \"simlok_number\": \"SIMLOK-2025-001\",\n        \"company_name\": \"PT Example\",\n        \"project_name\": \"Project Name\",\n        \"review_status\": \"MEETS_REQUIREMENTS\",\n        \"final_status\": \"APPROVED\"\n      },\n      \"user\": {\n        \"id\": \"user_id\",\n        \"name\": \"Verifier Name\",\n        \"email\": \"verifier@example.com\",\n        \"role\": \"VERIFIER\"\n      }\n    }\n  ],\n  \"total\": 100,\n  \"page\": 1,\n  \"limit\": 20,\n  \"totalPages\": 5\n}\n```\n\n## Routes Structure\n\n```\n/reviewer/scan-history\n├── ScanHistoryPage component\n├── Filter panel\n├── Data table\n└── Detail modal\n\n/approver/scan-history\n├── ScanHistoryPage component\n├── Filter panel  \n├── Data table\n└── Detail modal\n```\n\n## Database Schema\nMenggunakan model `QrScan` yang sudah ada:\n```prisma\nmodel QrScan {\n  id            String     @id @default(cuid())\n  submission_id String\n  scanned_by    String\n  scanned_at    DateTime   @default(now())\n  scanner_name  String?    // Optional: name of scanner\n  notes         String?    // Optional: scan notes\n  submission    Submission @relation(\"SubmissionQrScans\")\n  user          User       @relation(\"QrScannedBy\")\n}\n```\n\n## Security & Access Control\n- **Authentication Required**: Harus login dengan session valid\n- **Role-Based Access**: Hanya REVIEWER, APPROVER, ADMIN, dan SUPER_ADMIN\n- **Data Isolation**: Setiap role hanya melihat data yang relevan\n\n## UI/UX Features\n- **Responsive Design**: Mobile-friendly layout\n- **Loading States**: Skeleton loading saat fetch data\n- **Empty States**: Pesan informatif saat tidak ada data\n- **Status Colors**: Color coding untuk berbagai status\n- **Search & Filter**: Real-time filtering dan pencarian\n- **Pagination**: Efficient data loading dengan pagination\n\n## Integration Points\n1. **Sidebar Menu**: Terintegrasi dengan SidebarLayout\n2. **API Routes**: RESTful API dengan parameter filtering\n3. **Database**: Menggunakan Prisma ORM dengan relasi\n4. **Authentication**: NextAuth session management\n5. **UI Components**: Menggunakan komponen UI yang konsisten\n\n## Future Enhancements\n1. **Export Functionality**: Export scan history ke Excel/PDF\n2. **Real-time Updates**: WebSocket untuk live scan monitoring\n3. **Advanced Analytics**: Charts dan statistik scan activity\n4. **Notification Integration**: Notifikasi untuk scan events\n5. **Audit Trail**: Detailed logging untuk compliance"
    },
    {
      "path": "SCAN_LOCATION_IMPLEMENTATION.md",
      "lang": "md",
      "size": 5206,
      "lines": 163,
      "hash": "a6e637d0c562a54ffeb056f27d79c9586c1aac7ad33500b911ee74f253619ee3",
      "truncated": false,
      "content": "# Implementasi Scan Location pada QR Scan\n\n## Overview\nFitur scan location telah ditambahkan ke sistem QR scanning untuk melacak lokasi dimana verifikator melakukan scan barcode/QR code. Lokasi diambil dari alamat verifikator yang tersimpan di database.\n\n## Perubahan Database\n\n### 1. **Schema Prisma** \n```prisma\nmodel QrScan {\n  id            String     @id @default(cuid())\n  submission_id String\n  scanned_by    String\n  scanned_at    DateTime   @default(now())\n  scanner_name  String?    // Optional: name of the person who scanned\n  scan_location String?    // NEW: Location where the scan was performed\n  notes         String?    // Optional: additional notes about the scan\n  // ... other fields\n}\n```\n\n### 2. **Migration**\n- **File**: `prisma/migrations/20250927182942_add_scan_location_to_qr_scan/migration.sql`\n- **Query**: `ALTER TABLE QrScan ADD COLUMN scan_location VARCHAR(191) NULL;`\n\n## Implementasi Backend\n\n### 1. **API QR Verify** (`/api/qr/verify/route.ts`)\n```typescript\n// Mengambil alamat user dari database\nconst userExists = await prisma.user.findUnique({\n  where: { id: session.user.id },\n  select: { \n    id: true, \n    email: true, \n    role: true, \n    officer_name: true, \n    address: true  // NEW: Include address\n  }\n});\n\n// Menyimpan scan_location dari alamat verifikator\nconst scanRecord = await prisma.qrScan.create({\n  data: {\n    submission_id: qrPayload.id,\n    scanned_by: session.user.id,\n    scanner_name: userExists.officer_name || session.user.officer_name,\n    scan_location: userExists.address || 'Lokasi tidak tersedia',  // NEW\n    notes: scanNotes || `Scanned via ${scanner_type || 'scanner'} at: ${scanLocation || 'Unknown location'}`,\n  },\n});\n```\n\n### 2. **API Response**\nSemua endpoint yang mengembalikan data `QrScan` sekarang otomatis menyertakan `scan_location`:\n- `/api/qr/verify` (GET) - Scan history\n- `/api/submissions/[id]/scans` - Scan history per submission\n\n## Implementasi Frontend\n\n### 1. **ScanHistory Component**\n**Location**: `src/components/scanner/ScanHistory.tsx`\n\n#### Interface Update:\n```typescript\ninterface ScanHistoryItem {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;  // NEW\n  notes?: string;\n  // ... other fields\n}\n```\n\n#### Display in List View:\n```tsx\n{/* Scan Location */}\n{scan.scan_location && (\n  <div className=\"flex items-center text-sm\">\n    <MapPinIcon className=\"h-4 w-4 text-orange-400 mr-2\" />\n    <div>\n      <span className=\"text-gray-600\">Lokasi Scan:</span>\n      <span className=\"ml-1 font-medium text-orange-600\">{scan.scan_location}</span>\n    </div>\n  </div>\n)}\n```\n\n#### Display in Detail Modal:\n```tsx\n{/* Scan Location */}\n{selectedScan.scan_location && (\n  <div className=\"pt-4 border-t border-gray-200\">\n    <div className=\"flex items-center\">\n      <MapPinIcon className=\"h-5 w-5 text-orange-500 mr-2\" />\n      <span className=\"block font-medium text-gray-600 mb-2\">Scan Location</span>\n    </div>\n    <div className=\"bg-orange-50 p-3 rounded-md text-sm text-orange-700 border-l-4 border-orange-200\">\n      {selectedScan.scan_location}\n    </div>\n  </div>\n)}\n```\n\n## User Experience\n\n### 1. **Data Source**\n- **Sumber**: Alamat verifikator dari field `User.address`\n- **Fallback**: \"Lokasi tidak tersedia\" jika alamat kosong\n- **Format**: Teks bebas sesuai input verifikator saat registrasi\n\n### 2. **Display**\n- **Icon**: MapPinIcon (Heroicons) dengan warna orange\n- **List View**: Tampil sebagai badge dengan icon di bawah informasi submission\n- **Detail Modal**: Section terpisah dengan background orange dan border kiri\n- **Conditional**: Hanya tampil jika `scan_location` tidak kosong\n\n### 3. **Visual Design**\n- **Color Scheme**: Orange (bg-orange-50, text-orange-600/700, border-orange-200)\n- **Icon**: MapPinIcon dari Heroicons\n- **Layout**: Konsisten dengan elemen UI lainnya (Notes, dll)\n\n## Benefits\n\n### 1. **Audit Trail**\n- Melacak lokasi fisik dimana scan dilakukan\n- Membantu verifikasi bahwa scan dilakukan di lokasi yang tepat\n- Audit compliance untuk keperluan pelaporan\n\n### 2. **Koordinasi Tim**\n- Team dapat mengetahui verifikator mana yang bertugas di area tertentu\n- Membantu planning dan scheduling verifikator\n- Menghindari duplikasi coverage area\n\n### 3. **Quality Assurance**\n- Memastikan verifikator berada di lokasi yang sesuai\n- Cross-reference dengan lokasi proyek SIMLOK\n- Deteksi anomali jika scan dilakukan dari lokasi yang tidak wajar\n\n## Technical Notes\n\n### 1. **Performance**\n- Kolom `scan_location` tidak diindex karena digunakan untuk display saja\n- Tidak mempengaruhi query performance yang ada\n- Backward compatible dengan scan records yang sudah ada\n\n### 2. **Data Privacy**\n- Menggunakan alamat dari user profile (data yang sudah tersedia)\n- Tidak menggunakan GPS/geolocation untuk privacy\n- User dapat update alamat di profile jika perlu\n\n### 3. **Fallback Handling**\n- Graceful degradation jika address user kosong\n- UI component tidak crash jika scan_location null/undefined\n- Conditional rendering untuk menghindari empty sections\n\n---\n\n**Implementation Date**: September 28, 2025  \n**Developer**: Assistant AI  \n**Version**: 3.0.0 - Scan Location Tracking  \n**Previous Version**: 2.0.0 - Daily Scan Flow  "
    },
    {
      "path": "SIMLOK_NUMBER_ANALYSIS.md",
      "lang": "md",
      "size": 1163,
      "lines": 39,
      "hash": "46065b65555d200d07d34f80aa6380d38721aabaf53d189eea89260641e7a37c",
      "truncated": false,
      "content": "# Analisis Generate Nomor SIMLOK\n\n## Status Implementasi Saat Ini: ✅ SUDAH BENAR\n\nFungsi `generateSimlokNumber()` di `/src/app/api/submissions/[id]/route.ts` sudah mengimplementasikan reset nomor per bulan/tahun dengan benar.\n\n### Cara Kerja:\n1. **Get tanggal saat ini**: `new Date()` untuk tahun dan bulan current\n2. **Format bulan/tahun**: MM/YYYY (09/2025, 10/2025, dst.)\n3. **Query nomor terakhir**: Cari submission dengan pattern `/${month}/${year}`\n4. **Auto-reset**: Jika tidak ada submission di bulan ini, mulai dari 1\n5. **Increment**: Jika ada, ambil nomor tertinggi + 1\n\n### Contoh Skenario:\n```\nSeptember 2025:\n- 1/09/2025 (submission pertama bulan ini)\n- 2/09/2025 (submission kedua)\n- ...\n- 50/09/2025 (submission ke-50)\n\nOktober 2025:\n- 1/10/2025 (RESET ke 1 di bulan baru)\n- 2/10/2025\n- dst.\n\nSeptember 2026:\n- 1/09/2026 (RESET ke 1 di tahun baru)\n```\n\n### Format Nomor SIMLOK: \n`{sequential_number}/{MM}/{YYYY}`\n\n### Dipanggil saat:\n- Admin/Verifier approve submission (status menjadi APPROVED)\n- Otomatis generate nomor SIMLOK baru\n\n## Kesimpulan: ✅ IMPLEMENTASI SUDAH BENAR\nSistem sudah reset nomor secara otomatis setiap ganti bulan/tahun."
    },
    {
      "path": "WORKER_PHOTO_IMPLEMENTATION.md",
      "lang": "md",
      "size": 3896,
      "lines": 123,
      "hash": "446fa23733a513abbc722997a461ae6138d65adfad40aa3775e77618b152b8f0",
      "truncated": false,
      "content": "# Worker Photo Storage Implementation\n\n## Ringkasan Perubahan\n\n### 1. FileManager Enhancement\n- **File:** `src/lib/fileManager.ts`\n- **Perubahan:**\n  - Menambah dukungan kategori `worker-photo` yang disimpan di folder `foto-pekerja`\n  - Menambah method `saveWorkerPhoto()` khusus untuk foto pekerja dengan naming convention nama pekerja\n  - Update semua interface dan type definitions untuk mendukung kategori baru\n\n### 2. PDF Template Optimization\n- **File:** `src/utils/pdf/simlokTemplate.ts`\n- **Perubahan:**\n  - Menghapus logic fallback path yang berlebihan\n  - Menggunakan single path resolution berdasarkan API structure\n  - Menambah mapping untuk kategori `worker-photo` → `foto-pekerja`\n\n### 3. API Endpoints\n- **File Baru:** `src/app/api/upload/worker-photo/route.ts`\n  - Endpoint khusus untuk upload foto pekerja\n  - Validasi khusus untuk file gambar saja\n  - Menggunakan nama pekerja sebagai basis filename\n\n- **File Updated:** `src/app/api/files/[userId]/[category]/[filename]/route.ts`\n  - Menambah support untuk serve files dari kategori `worker-photo`\n\n## Struktur Folder Storage\n\n```\npublic/uploads/\n└── {userId}/\n    ├── dokumen-sika/        # SIKA documents\n    ├── dokumen-simja/       # SIMJA documents  \n    ├── id-card/            # ID card photos\n    ├── lainnya/            # Other documents\n    └── foto-pekerja/       # Worker photos (NEW)\n        ├── John_Doe_1642123456789.jpg\n        ├── Jane_Smith_1642123456790.png\n        └── ...\n```\n\n## Filename Convention\n\n### Worker Photos\n- **Format:** `{CleanWorkerName}_{Timestamp}.{extension}`\n- **Contoh:** \n  - Input: \"John Doe\" → Output: \"John_Doe_1642123456789.jpg\"\n  - Input: \"Siti Nurhaliza\" → Output: \"Siti_Nurhaliza_1642123456790.png\"\n\n### Regular Files\n- **Format:** `{CategoryPrefix}_{Timestamp}_{RandomString}_{CleanOriginalName}.{extension}`\n- **Contoh:** \"SIKA_1642123456789_a1b2_document.pdf\"\n\n## API Usage\n\n### Upload Worker Photo\n```typescript\n// POST /api/upload/worker-photo\nconst formData = new FormData();\nformData.append('file', photoFile);\nformData.append('workerName', 'John Doe');\n\nconst response = await fetch('/api/upload/worker-photo', {\n  method: 'POST',\n  body: formData\n});\n\n// Response:\n{\n  \"success\": true,\n  \"url\": \"/api/files/user123/worker-photo/John_Doe_1642123456789.jpg\",\n  \"filename\": \"John_Doe_1642123456789.jpg\",\n  \"workerName\": \"John Doe\",\n  \"category\": \"worker-photo\"\n}\n```\n\n### Access Worker Photo\n```typescript\n// GET /api/files/{userId}/worker-photo/{filename}\nconst photoUrl = \"/api/files/user123/worker-photo/John_Doe_1642123456789.jpg\";\n```\n\n## PDF Integration\n\nSekarang PDF generator akan:\n1. ✅ Menggunakan single path resolution (tidak ada multiple fallback)\n2. ✅ Mendukung kategori `worker-photo` dengan mapping ke folder `foto-pekerja`\n3. ✅ Menampilkan foto pekerja pada halaman kedua PDF SIMLOK\n\n## Frontend Integration\n\nContoh penggunaan komponen tersedia di:\n- `examples/worker-photo-upload.tsx`\n\n## Migration Notes\n\nUntuk project yang sudah ada:\n1. Foto pekerja lama mungkin tersimpan di kategori `other` atau folder lain\n2. Gunakan method `fileManager.migrateExistingFiles()` jika diperlukan\n3. Atau manual move files ke folder `foto-pekerja` dengan naming convention baru\n\n## Benefits\n\n1. **Organized Storage:** Foto pekerja tersimpan terpisah di folder khusus\n2. **Meaningful Filenames:** Filename menggunakan nama pekerja, mudah diidentifikasi\n3. **Better Performance:** Single path resolution menghilangkan overhead pencarian\n4. **Type Safety:** Full TypeScript support untuk kategori baru\n5. **API Consistency:** Endpoint khusus dengan validasi sesuai kebutuhan\n\n## Testing\n\n```bash\n# Test upload foto pekerja\ncurl -X POST /api/upload/worker-photo \\\n  -F \"file=@john_photo.jpg\" \\\n  -F \"workerName=John Doe\"\n\n# Test akses foto\ncurl /api/files/user123/worker-photo/John_Doe_1642123456789.jpg\n```\n"
    },
    {
      "path": "check-all-submissions.ts",
      "lang": "ts",
      "size": 2804,
      "lines": 84,
      "hash": "2cbf4a0f90271b50e15251a427b458e0fb826797a6d2914c024308fc00377b51",
      "truncated": false,
      "content": "import { PrismaClient } from \"@prisma/client\";\n\nconst prisma = new PrismaClient();\n\nasync function checkSubmissionStatus() {\n  console.log(\"🔍 Mengecek status semua submission...\\n\");\n  \n  const submissions = await prisma.submission.findMany({\n    include: {\n      user: {\n        select: {\n          vendor_name: true,\n          officer_name: true,\n        }\n      }\n    },\n    orderBy: {\n      created_at: 'desc'\n    }\n  });\n\n  console.log(`📊 Total submissions: ${submissions.length}\\n`);\n\n  // Group by status\n  const statusCount = submissions.reduce((acc, sub) => {\n    acc[sub.approval_status] = (acc[sub.approval_status] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  console.log(\"📈 Status breakdown:\");\n  Object.entries(statusCount).forEach(([status, count]) => {\n    const emoji = status === 'PENDING' ? '⏳' : status === 'APPROVED' ? '✅' : '❌';\n    console.log(`   ${emoji} ${status}: ${count} submissions`);\n  });\n\n  console.log(\"\\n📋 Detail submissions:\");\n  submissions.forEach((sub, index) => {\n    const statusEmoji = sub.approval_status === 'PENDING' ? '⏳' : sub.approval_status === 'APPROVED' ? '✅' : '❌';\n    console.log(`   ${index + 1}. ${statusEmoji} ${sub.user.vendor_name} - ${sub.job_description}`);\n    console.log(`      Status: ${sub.approval_status}`);\n    console.log(`      Created: ${sub.created_at.toLocaleDateString('id-ID')}`);\n    console.log(`      QR Code: ${sub.qrcode}`);\n    console.log(\"\");\n  });\n\n  // Check specific fields for pending submissions\n  const pendingSubmissions = submissions.filter(sub => sub.approval_status === 'PENDING');\n  \n  if (pendingSubmissions.length > 0) {\n    console.log(\"🔍 Verifikasi submission pending:\");\n    console.log(`   ✓ Semua ${pendingSubmissions.length} submission berstatus PENDING`);\n    console.log(\"   ✓ Tidak ada approved_by yang terisi\");\n    console.log(\"   ✓ Tidak ada simlok_number yang terisi\");\n    console.log(\"   ✓ Tidak ada implementation_start_date yang terisi\");\n    console.log(\"   ✓ Tidak ada implementation_end_date yang terisi\");\n    \n    // Verify no approved fields are filled\n    const hasApprovedFields = pendingSubmissions.some(sub => \n      sub.approved_by || \n      sub.simlok_number || \n      sub.implementation_start_date || \n      sub.implementation_end_date ||\n      sub.implementation ||\n      sub.other_notes ||\n      sub.content\n    );\n    \n    if (hasApprovedFields) {\n      console.log(\"   ⚠️ Warning: Beberapa submission pending memiliki data approval!\");\n    } else {\n      console.log(\"   ✅ Semua submission pending tidak memiliki data approval\");\n    }\n  }\n}\n\ncheckSubmissionStatus()\n  .catch((e) => {\n    console.error(\"❌ Error:\", e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n"
    },
    {
      "path": "cleanup-orphaned-notifications.js",
      "lang": "js",
      "size": 3430,
      "lines": 103,
      "hash": "2f33572ff90a7aeea1fe9ccb5681948a19e3e933371280ab672f60dab8fe31a4",
      "truncated": false,
      "content": "const { PrismaClient } = require('@prisma/client');\nconst prisma = new PrismaClient();\n\nasync function cleanupOrphanedNotifications() {\n  try {\n    console.log('🧹 Starting cleanup of orphaned notifications...');\n    \n    // Find all notifications that reference submissions\n    const submissionNotifications = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: 'submissionId' } },\n          { data: { contains: 'submission_id' } },\n          { message: { contains: 'ID' } },\n          { title: { contains: 'ID' } }\n        ]\n      }\n    });\n    \n    console.log(`Found ${submissionNotifications.length} notifications that might reference submissions`);\n    \n    const orphanedNotifications = [];\n    \n    // Check each notification\n    for (const notif of submissionNotifications) {\n      let submissionId = null;\n      \n      // Extract submission ID from data field\n      if (notif.data) {\n        try {\n          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;\n          submissionId = data.submissionId || data.submission_id;\n        } catch (e) {\n          // ignore parsing errors\n        }\n      }\n      \n      // Extract from message/title if not found in data\n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notif.message.match(idPattern);\n        const titleMatch = notif.title.match(idPattern);\n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n      }\n      \n      if (submissionId) {\n        // Check if submission exists\n        const submission = await prisma.submission.findUnique({\n          where: { id: submissionId }\n        });\n        \n        if (!submission) {\n          orphanedNotifications.push({\n            notification: notif,\n            submissionId: submissionId\n          });\n        }\n      }\n    }\n    \n    console.log(`\\nFound ${orphanedNotifications.length} orphaned notifications:`);\n    \n    if (orphanedNotifications.length > 0) {\n      console.log('\\n📋 Orphaned notifications:');\n      orphanedNotifications.forEach((item, index) => {\n        console.log(`${index + 1}. ${item.notification.type} - ${item.notification.title}`);\n        console.log(`   Missing submission ID: ${item.submissionId}`);\n        console.log(`   Created: ${item.notification.created_at}`);\n      });\n      \n      console.log('\\n❓ Cleaning up orphaned notifications automatically...');\n      \n      // Delete orphaned notifications\n      console.log('\\n🗑️ Deleting orphaned notifications...');\n      \n      for (const item of orphanedNotifications) {\n        // First delete NotificationRead records\n        await prisma.notificationRead.deleteMany({\n          where: { notification_id: item.notification.id }\n        });\n        \n        // Then delete the notification\n        await prisma.notification.delete({\n          where: { id: item.notification.id }\n        });\n        \n        console.log(`✅ Deleted notification ${item.notification.id} (${item.notification.type})`);\n      }\n      \n      console.log(`\\n✅ Successfully cleaned up ${orphanedNotifications.length} orphaned notifications`);\n    } else {\n      console.log('✅ No orphaned notifications found!');\n    }\n    \n  } catch (error) {\n    console.error('❌ Error during cleanup:', error);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ncleanupOrphanedNotifications();\n"
    },
    {
      "path": "debug-camera-test.js",
      "lang": "js",
      "size": 1117,
      "lines": 31,
      "hash": "4beadda8ccf00cbeef01efeaeced23ec2584b33b193f5b475ce4a609376a614a",
      "truncated": false,
      "content": "// Quick camera test script\nconsole.log('🧪 Testing camera access...');\n\nasync function testCamera() {\n  try {\n    console.log('📱 Testing environment camera (back camera)...');\n    const envStream = await navigator.mediaDevices.getUserMedia({ \n      video: { facingMode: \"environment\" }\n    });\n    console.log('✅ Environment camera available:', envStream.getVideoTracks()[0].getSettings());\n    envStream.getTracks().forEach(track => track.stop());\n    \n    console.log('📱 Testing any camera...');\n    const anyStream = await navigator.mediaDevices.getUserMedia({ \n      video: true\n    });\n    console.log('✅ Any camera available:', anyStream.getVideoTracks()[0].getSettings());\n    anyStream.getTracks().forEach(track => track.stop());\n    \n    console.log('📱 Getting available devices...');\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const videoDevices = devices.filter(device => device.kind === 'videoinput');\n    console.log('📹 Available cameras:', videoDevices);\n    \n  } catch (error) {\n    console.error('❌ Camera test failed:', error);\n  }\n}\n\ntestCamera();\n"
    },
    {
      "path": "debug-scanner-video.js",
      "lang": "js",
      "size": 3168,
      "lines": 76,
      "hash": "9ace9f0f2af2db11f238de16b3447ebf3b480c5a757a8db03910624d7c57f28f",
      "truncated": false,
      "content": "// Test untuk debugging mobile scanner video visibility\nconsole.log('🔍 Testing scanner video visibility...\\n');\n\n// Simulate scanner initialization debugging\nconst debugScanner = () => {\n  console.log('📱 Mobile Scanner Video Debug Steps:');\n  console.log('1. Check if scanner element exists');\n  console.log('2. Look for video elements after initialization');\n  console.log('3. Verify CSS rules don\\'t hide video');\n  console.log('4. Check if camera permissions are granted');\n  console.log('5. Ensure video constraints are correct\\n');\n\n  // Video constraints for back camera\n  const videoConstraints = {\n    facingMode: \"environment\", // Force back camera\n    width: { ideal: 1280 },\n    height: { ideal: 720 }\n  };\n  \n  console.log('📹 Video Constraints:');\n  console.log(JSON.stringify(videoConstraints, null, 2));\n\n  // CSS rules that should ENSURE video visibility\n  console.log('\\n✅ CSS Rules to Force Video Visibility:');\n  console.log('video { display: block !important; }');\n  console.log('video { visibility: visible !important; }');\n  console.log('video { opacity: 1 !important; }');\n  console.log('video { width: 100% !important; }');\n  console.log('video { min-height: 250px !important; }');\n  console.log('video { position: relative !important; }');\n  console.log('video { z-index: 1 !important; }');\n\n  // Things that should be hidden\n  console.log('\\n🚫 Elements that should be hidden:');\n  console.log('- select (camera dropdown)');\n  console.log('- .html5-qrcode-camera-selection');\n  console.log('- button[title*=\"torch\"]');\n  console.log('- button[title*=\"camera\"]');\n  console.log('- input[type=\"range\"] (zoom)');\n  console.log('- .html5-qrcode-torch-button');\n\n  // Debug steps for user\n  console.log('\\n🛠️ If video still not showing:');\n  console.log('1. Check browser console for camera permission errors');\n  console.log('2. Verify camera is not being used by another app');\n  console.log('3. Check if HTTPS is enabled (required for camera)');\n  console.log('4. Test on different device/browser');\n  console.log('5. Inspect element to see if video tag exists');\n\n  // Scanner timing\n  console.log('\\n⏱️ Scanner Initialization Timing:');\n  console.log('- Wait 1000ms for element to be ready');\n  console.log('- Initialize scanner with back camera constraints');\n  console.log('- Wait 2000ms before cleaning up UI');\n  console.log('- Only run cleanup once (not repeatedly)');\n\n  console.log('\\n🎯 Expected Result:');\n  console.log('- Black video background with camera feed');\n  console.log('- QR detection overlay (canvas)');\n  console.log('- No camera selection dropdown');\n  console.log('- No torch/flash buttons');\n  console.log('- Stop Scanning button below video');\n};\n\ndebugScanner();\n\n// Browser compatibility check\nconsole.log('\\n🌐 Browser Compatibility:');\nconsole.log('- getUserMedia API: Required');\nconsole.log('- Camera permissions: Must be granted');\nconsole.log('- HTTPS: Required for camera access');\nconsole.log('- Modern browser: Chrome 60+, Firefox 55+, Safari 11+');\n\nconsole.log('\\n✅ Scanner debugging completed!');\nconsole.log('If video still not showing, check browser console for errors.');\n"
    },
    {
      "path": "eslint.config.js",
      "lang": "js",
      "size": 1137,
      "lines": 44,
      "hash": "3a9232ff7e382266f0e1243333924b09ca8f8b7e9fbfdd27e5c827de7405caab",
      "truncated": false,
      "content": "const { FlatCompat } = require(\"@eslint/eslintrc\");\nconst path = require(\"path\");\n\nconst compat = new FlatCompat({\n  baseDirectory: __dirname,\n});\n\nconst eslintConfig = [\n  ...compat.extends(\"next/core-web-vitals\", \"next/typescript\"),\n  {\n    rules: {\n      // Disable problematic rules for now\n      \"import/order\": \"off\",\n      \"react/jsx-sort-props\": \"off\",\n      \"@typescript-eslint/no-explicit-any\": \"off\",\n      \"@typescript-eslint/consistent-type-imports\": \"off\",\n      \"@typescript-eslint/no-unused-vars\": \"off\",\n      \"react/no-unescaped-entities\": \"off\",\n      \"react/self-closing-comp\": \"off\",\n      \"@next/next/no-img-element\": \"off\",\n      \"jsx-a11y/alt-text\": \"off\",\n      \"no-console\": \"off\",\n      \"react-hooks/exhaustive-deps\": \"off\",\n      \n      // Keep important rules\n      \"react/prop-types\": \"off\",\n      \"react/react-in-jsx-scope\": \"off\",\n      \"prefer-const\": \"error\",\n      \"no-var\": \"error\",\n      \"no-debugger\": \"error\"\n    },\n  },\n  {\n    files: [\"**/*.test.{ts,tsx}\", \"**/*.spec.{ts,tsx}\"],\n    languageOptions: {\n      globals: {\n        jest: true,\n      },\n    },\n  },\n];\n\nmodule.exports = eslintConfig;\n"
    },
    {
      "path": "extract.js",
      "lang": "js",
      "size": 7743,
      "lines": 267,
      "hash": "19ca47f7ba83e7f23437e2a454848e1abd3cb235ab255808b667c4935b32b626",
      "truncated": false,
      "content": "#!/usr/bin/env node\n/**\n * dump-nextjs.js\n * Ekstrak struktur & isi file kode proyek Next.js ke JSON yang mudah diproses.\n * Node.js >= 18\n *\n * Contoh:\n *   node dump-nextjs.js --root . --out project_dump.json --max-bytes 800000\n */\n\n/**\n * dump-nextjs.js (versi CommonJS)\n */\n\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst { createHash } = require(\"crypto\");\n\n\n// ---------- CLI PARSER SEDERHANA ----------\nconst args = Object.fromEntries(\n  process.argv.slice(2).map((a) => {\n    const [k, v] = a.startsWith(\"--\") ? a.slice(2).split(\"=\") : [a, true];\n    return [k, v ?? true];\n  })\n);\n\nconst ROOT = path.resolve(args.root || \".\");\nconst OUT = path.resolve(args.out || \"project_dump.json\");\nconst MAX_BYTES = Number(args[\"max-bytes\"] || 0); // 0 = tanpa batas\nconst INCLUDE_TESTS = Boolean(args[\"include-tests\"] || false);\nconst INCLUDE_STORIES = Boolean(args[\"include-stories\"] || false);\n\n// ---------- KONFIGURASI ----------\nconst DEFAULT_IGNORE_DIRS = new Set([\n  \"node_modules\",\n  \".git\",\n  \".hg\",\n  \".svn\",\n  \".next\",\n  \".vercel\",\n  \".turbo\",\n  \".cache\",\n  \".output\",\n  \"coverage\",\n  \"dist\",\n  \"build\",\n  \"out\",\n  \".pnpm-store\",\n  \".yarn\",\n  \".gradle\",\n  \".DS_Store\",\n]);\n\n// Hanya file kode/konfigurasi yang relevan\nconst EXT_WHITELIST = new Set([\n  \".ts\", \".tsx\", \".js\", \".jsx\",\n  \".mjs\", \".cjs\",\n  \".json\",\n  \".md\", \".mdx\",\n  \".yml\", \".yaml\",\n  \".css\", \".scss\",\n  \".env.example\", // contoh env (bukan rahasia)\n  \".config.js\", \".config.cjs\", \".config.mjs\", \".config.ts\",\n]);\nconst EXTRA_FILENAMES = new Set([\n  \"next.config.js\", \"next.config.mjs\", \"next.config.cjs\", \"next.config.ts\",\n  \"tsconfig.json\", \"jsconfig.json\",\n  \"package.json\", \"pnpm-workspace.yaml\",\n  \"tailwind.config.js\", \"tailwind.config.ts\",\n  \"postcss.config.js\", \"postcss.config.cjs\", \"postcss.config.mjs\",\n  \".eslintrc\", \".eslintrc.js\", \".eslintrc.cjs\", \".eslintrc.json\",\n  \".prettierrc\", \".prettierrc.js\", \".prettierrc.cjs\", \".prettierrc.json\",\n  \".npmrc\", \".nvmrc\",\n]);\n\n// Pola file yang biasanya tidak ingin diikutkan kecuali diminta\nconst TEST_PATTERNS = [\n  /\\.test\\.(ts|tsx|js|jsx|mjs|cjs)$/i,\n  /\\.spec\\.(ts|tsx|js|jsx|mjs|cjs)$/i,\n];\nconst STORY_PATTERNS = [/\\.stories\\.(ts|tsx|js|jsx|mdx)$/i];\n\n// ---------- UTIL ----------\nfunction isProbablyBinary(buf) {\n  // Heuristik sederhana: cek karakter kontrol non-whitespace\n  const text = buf.toString(\"utf8\");\n  const control = /[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/;\n  return control.test(text);\n}\n\nfunction sha256(str) {\n  return createHash(\"sha256\").update(str).digest(\"hex\");\n}\n\nfunction detectLang(filePath) {\n  const ext = path.extname(filePath).toLowerCase();\n  if (ext === \".ts\") return \"ts\";\n  if (ext === \".tsx\") return \"tsx\";\n  if (ext === \".js\") return \"js\";\n  if (ext === \".jsx\") return \"jsx\";\n  if (ext === \".mjs\") return \"mjs\";\n  if (ext === \".cjs\") return \"cjs\";\n  if (ext === \".json\") return \"json\";\n  if (ext === \".md\") return \"md\";\n  if (ext === \".mdx\") return \"mdx\";\n  if (ext === \".yml\" || ext === \".yaml\") return \"yaml\";\n  if (ext === \".css\") return \"css\";\n  if (ext === \".scss\") return \"scss\";\n  if (filePath.endsWith(\"next.config.js\")) return \"js\";\n  if (filePath.endsWith(\"next.config.ts\")) return \"ts\";\n  return ext.replace(/^\\./, \"\") || \"txt\";\n}\n\nfunction shouldIgnoreDir(dirName) {\n  return DEFAULT_IGNORE_DIRS.has(dirName);\n}\n\nfunction isWhitelistedFile(filePath) {\n  const base = path.basename(filePath);\n  if (EXTRA_FILENAMES.has(base)) return true;\n\n  // whitelist berbasis ekstensi (termasuk .env.example, .config.*)\n  const ext = path.extname(base).toLowerCase();\n  if (EXT_WHITELIST.has(ext)) return true;\n\n  // file seperti \"tailwind.config.js\" sudah tercakup oleh EXTRA_FILENAMES\n  // tambahkan pola config umum lain jika perlu\n\n  // Khusus Next.js route handlers / middleware dll akan punya ekstensi ts/js juga\n  return false;\n}\n\nfunction matchesAny(filePath, patterns) {\n  return patterns.some((re) => re.test(filePath));\n}\n\n// ---------- WALKER ----------\nasync function* walk(dir) {\n  const entries = await fs.promises.readdir(dir, { withFileTypes: true });\n  for (const ent of entries) {\n    const res = path.join(dir, ent.name);\n    if (ent.isDirectory()) {\n      if (shouldIgnoreDir(ent.name)) continue;\n      yield* walk(res);\n    } else if (ent.isFile()) {\n      yield res;\n    }\n  }\n}\n\n// ---------- MAIN ----------\nasync function run() {\n  const start = Date.now();\n\n  const files = [];\n  let totalBytes = 0;\n\n  for await (const absPath of walk(ROOT)) {\n    const relPath = path.relative(ROOT, absPath);\n\n    // Saring file non-whitelist, tapi izinkan source code umum\n    const ext = path.extname(absPath).toLowerCase();\n\n    const looksLikeCode =\n      [\".ts\", \".tsx\", \".js\", \".jsx\", \".mjs\", \".cjs\", \".json\", \".md\", \".mdx\", \".yml\", \".yaml\", \".css\", \".scss\"].includes(ext) ||\n      EXTRA_FILENAMES.has(path.basename(absPath)) ||\n      isWhitelistedFile(absPath);\n\n    if (!looksLikeCode) continue;\n\n    // Skip test/spec jika tidak diminta\n    if (!INCLUDE_TESTS && matchesAny(relPath, TEST_PATTERNS)) continue;\n\n    // Skip storybook jika tidak diminta\n    if (!INCLUDE_STORIES && matchesAny(relPath, STORY_PATTERNS)) continue;\n\n    // Hindari file .env asli (kecuali .env.example)\n    const base = path.basename(absPath).toLowerCase();\n    if (base === \".env\" || base.startsWith(\".env.\")) continue;\n\n    // Baca isi\n    const buf = await fs.promises.readFile(absPath);\n    // Skip binary\n    if (isProbablyBinary(buf)) continue;\n\n    const content = buf.toString(\"utf8\");\n    const size = Buffer.byteLength(content, \"utf8\");\n\n    // Batas total ukuran output (jika diset)\n    if (MAX_BYTES > 0 && totalBytes + size > MAX_BYTES) {\n      // Jika melebihi, simpan versi terpotong agar tetap terindeks\n      const allowance = Math.max(0, MAX_BYTES - totalBytes);\n      const truncated = content.slice(0, allowance);\n      files.push({\n        path: relPath,\n        lang: detectLang(relPath),\n        size,\n        lines: content.split(\"\\n\").length,\n        hash: sha256(content),\n        truncated: true,\n        content: truncated,\n      });\n      totalBytes += allowance;\n      break; // stop setelah batas tercapai\n    } else {\n      files.push({\n        path: relPath,\n        lang: detectLang(relPath),\n        size,\n        lines: content.split(\"\\n\").length,\n        hash: sha256(content),\n        truncated: false,\n        content,\n      });\n      totalBytes += size;\n    }\n  }\n\n  // Meta + heuristik Next.js\n  const meta = {\n    root: ROOT,\n    generated_at_iso: new Date().toISOString(),\n    total_files: files.length,\n    total_bytes: totalBytes,\n    options: {\n      include_tests: INCLUDE_TESTS,\n      include_stories: INCLUDE_STORIES,\n      max_bytes: MAX_BYTES,\n    },\n    nextjs_hints: detectNextHints(files.map((f) => f.path)),\n  };\n\n  const payload = { meta, files };\n\n  await fs.promises.writeFile(OUT, JSON.stringify(payload, null, 2), \"utf8\");\n\n  console.log(\n    `✅ Dump selesai: ${OUT}\\n` +\n      `   Files: ${files.length}\\n` +\n      `   Bytes: ${totalBytes}\\n` +\n      `   Waktu: ${((Date.now() - start) / 1000).toFixed(2)}s`\n  );\n}\n\nfunction detectNextHints(paths) {\n  const hasAppDir = paths.some((p) => p.split(path.sep).includes(\"app\"));\n  const hasPagesDir = paths.some((p) => p.split(path.sep).includes(\"pages\"));\n  const hasMiddleware = paths.some((p) => /(^|\\/)middleware\\.(t|j)s$/.test(p));\n  const hasRouteHandlers = paths.some((p) => /(^|\\/)route\\.(t|j)s$/.test(p));\n  const hasLayout = paths.some((p) => /(^|\\/)layout\\.(t|j)sx?$/.test(p));\n  const hasPage = paths.some((p) => /(^|\\/)page\\.(t|j)sx?$/.test(p));\n  return {\n    hasAppDir,\n    hasPagesDir,\n    hasMiddleware,\n    hasRouteHandlers,\n    hasLayout,\n    hasPage,\n  };\n}\n\nrun().catch((err) => {\n  console.error(\"❌ Error:\", err);\n  process.exit(1);\n});\n"
    },
    {
      "path": "middleware.ts",
      "lang": "ts",
      "size": 3467,
      "lines": 98,
      "hash": "532863993410c18d70dfac991627a1e45a40de9ee91df8fc547a8f12ce852577",
      "truncated": false,
      "content": "// middleware.ts\nimport { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { getToken } from \"next-auth/jwt\";\nimport { SessionValidationService } from \"@/middleware/SessionValidation\";\n\nconst roleHierarchy = {\n  SUPER_ADMIN: 6,\n  ADMIN: 5,\n  APPROVER: 4,\n  REVIEWER: 3,\n  VERIFIER: 2,\n  VENDOR: 1,\n} as const;\n\ntype Role = keyof typeof roleHierarchy;\n\n// mapping route prefix -> minimum role\nconst protectedRoutes: { prefix: string; minRole: Role }[] = [\n  { prefix: \"/super-admin\", minRole: \"SUPER_ADMIN\" },\n  { prefix: \"/admin\", minRole: \"ADMIN\" },\n  { prefix: \"/approver\", minRole: \"APPROVER\" },\n  { prefix: \"/reviewer\", minRole: \"REVIEWER\" },\n  { prefix: \"/verifier\", minRole: \"VERIFIER\" },\n  { prefix: \"/vendor\", minRole: \"VENDOR\" },\n  { prefix: \"/dashboard\", minRole: \"VENDOR\" }, // contoh: semua role bisa akses /dashboard, nanti UI berbeda\n];\n\nexport async function middleware(req: NextRequest) {\n  const { pathname } = req.nextUrl;\n\n  // Skip verification check for public paths\n  if (pathname === \"/verification-pending\" || \n      pathname === \"/login\" || \n      pathname === \"/signup\" || \n      pathname.startsWith(\"/api/auth\") ||\n      pathname === \"/\") {\n    return NextResponse.next();\n  }\n\n  // Session validation with auto-logout\n  if (!SessionValidationService.shouldExcludePath(pathname)) {\n    const sessionResult = await SessionValidationService.validateSession(req);\n    if (!sessionResult.isValid && sessionResult.shouldLogout) {\n      console.log(`Auto-logout triggered: ${sessionResult.reason}`);\n      return SessionValidationService.createLogoutResponse(req, sessionResult.reason);\n    }\n  }\n\n  // check if this path is protected\n  const matched = protectedRoutes.find((r) => pathname.startsWith(r.prefix));\n  if (!matched) return NextResponse.next();\n\n  // read token (jwt) from cookie (NEXTAUTH_TOKEN)\n  const token = await getToken({ \n    req, \n    secret: process.env.NEXTAUTH_SECRET || 'fallback-secret' \n  });\n  if (!token) {\n    const url = req.nextUrl.clone();\n    url.pathname = \"/login\";\n    url.searchParams.set(\"callbackUrl\", req.nextUrl.pathname);\n    return NextResponse.redirect(url);\n  }\n\n  // token may have role (set in callbacks.jwt)\n  const userRole = (token as any).role as string | undefined;\n  const verified_at = (token as any).verified_at as string | undefined;\n\n  console.log('Middleware - pathname:', pathname);\n  console.log('Middleware - userRole:', userRole);\n  console.log('Middleware - verified_at:', verified_at);\n\n  if (!userRole) {\n    // forbidden\n    return new NextResponse(\"Forbidden\", { status: 403 });\n  }\n\n  // Check if user is verified (except for admin, super admin, reviewer, and approver)\n  if (userRole !== \"ADMIN\" && userRole !== \"SUPER_ADMIN\" && userRole !== \"REVIEWER\" && userRole !== \"APPROVER\" && !verified_at) {\n    console.log('Middleware - User not verified, redirecting to verification-pending');\n    const url = req.nextUrl.clone();\n    url.pathname = \"/verification-pending\";\n    return NextResponse.redirect(url);\n  }\n\n  if (roleHierarchy[userRole as Role] < roleHierarchy[matched.minRole]) {\n    return new NextResponse(\"Forbidden\", { status: 403 });\n  }\n\n  return NextResponse.next();\n}\n\n// apply to all routes; tune matcher as needed\nexport const config = {\n  matcher: [\"/super-admin/:path*\", \"/admin/:path*\", \"/approver/:path*\", \"/reviewer/:path*\", \"/verifier/:path*\", \"/vendor/:path*\", \"/dashboard/:path*\", \"/verification-pending\"],\n};\n"
    },
    {
      "path": "next-env.d.ts",
      "lang": "ts",
      "size": 211,
      "lines": 6,
      "hash": "f2b3bca04d1bfe583daae1e1f798c92ec24bb6693bd88d0a09ba6802dee362a8",
      "truncated": false,
      "content": "/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.\n"
    },
    {
      "path": "next.config.ts",
      "lang": "ts",
      "size": 861,
      "lines": 36,
      "hash": "96149786bd50e2fc65acf1fb96c9f1616d39de6edd6d5209595dfb6295c7be27",
      "truncated": false,
      "content": "import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  /* config options here */\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: 'www.w3schools.com',\n        pathname: '/howto/**',\n      },\n    ],\n  },\n  typescript: {\n    // !! WARN !!\n    // Dangerously allow production builds to successfully complete even if\n    // your project has type errors.\n    // !! WARN !!\n    ignoreBuildErrors: true,\n  },\n  // Optional: Add bundle analyzer support\n  ...(process.env.ANALYZE === 'true' && {\n    webpack: (config: any) => {\n      if (typeof require !== 'undefined') {\n        const BundleAnalyzerPlugin = require('@next/bundle-analyzer')({\n          enabled: true,\n        });\n        config.plugins.push(new BundleAnalyzerPlugin());\n      }\n      return config;\n    },\n  }),\n};\n\nexport default nextConfig;\n"
    },
    {
      "path": "package.json",
      "lang": "json",
      "size": 1986,
      "lines": 71,
      "hash": "0b896692190c52729ac57ce508a1c6529364f382343d1b83e41de68715e2bfc2",
      "truncated": false,
      "content": "{\n  \"name\": \"simple-crud-auth\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"dev:server\": \"node server.js\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"start:server\": \"NODE_ENV=production node server.js\",\n    \"lint\": \"eslint .\",\n    \"typecheck\": \"tsc -p tsconfig.json --noEmit\",\n    \"seed\": \"npx prisma migrate reset && tsx prisma/seed.ts\",\n    \"seed:new\": \"npx prisma migrate reset && tsx prisma/new-seed.ts\",\n    \"analyze\": \"cross-env ANALYZE=true next build\"\n  },\n  \"prisma\": {\n    \"seed\": \"tsx prisma/seed.ts\"\n  },\n  \"dependencies\": {\n    \"@heroicons/react\": \"^2.2.0\",\n    \"@lexical/list\": \"^0.36.1\",\n    \"@lexical/react\": \"^0.36.1\",\n    \"@lexical/rich-text\": \"^0.36.1\",\n    \"@lexical/utils\": \"^0.36.1\",\n    \"@prisma/client\": \"^6.13.0\",\n    \"@socket.io/redis-adapter\": \"^8.3.0\",\n    \"@types/qrcode\": \"^1.5.5\",\n    \"@zxing/browser\": \"^0.1.5\",\n    \"@zxing/library\": \"^0.21.3\",\n    \"bcryptjs\": \"^3.0.2\",\n    \"class-variance-authority\": \"^0.7.1\",\n    \"clsx\": \"^2.1.1\",\n    \"date-fns\": \"^4.1.0\",\n    \"html5-qrcode\": \"^2.3.8\",\n    \"ioredis\": \"^5.7.0\",\n    \"lexical\": \"^0.36.1\",\n    \"lucide-react\": \"^0.539.0\",\n    \"next\": \"15.4.6\",\n    \"next-auth\": \"^4.24.11\",\n    \"pdf-lib\": \"^1.17.1\",\n    \"qrcode\": \"^1.5.4\",\n    \"react\": \"19.1.0\",\n    \"react-datepicker\": \"^8.4.0\",\n    \"react-dom\": \"19.1.0\",\n    \"react-webcam\": \"^7.2.0\",\n    \"socket.io\": \"^4.8.1\",\n    \"socket.io-client\": \"^4.8.1\",\n    \"tailwind-merge\": \"^3.3.1\",\n    \"xlsx\": \"^0.18.5\",\n    \"zod\": \"^4.0.17\",\n    \"zustand\": \"^5.0.8\"\n  },\n  \"devDependencies\": {\n    \"@eslint/eslintrc\": \"^3.3.1\",\n    \"@next/bundle-analyzer\": \"^15.5.2\",\n    \"@tailwindcss/postcss\": \"^4\",\n    \"@types/node\": \"^20.19.10\",\n    \"@types/react\": \"^19\",\n    \"@types/react-dom\": \"^19\",\n    \"cross-env\": \"^10.0.0\",\n    \"eslint\": \"^9.35.0\",\n    \"eslint-config-next\": \"^15.5.2\",\n    \"prisma\": \"^6.13.0\",\n    \"tailwindcss\": \"^4\",\n    \"ts-node\": \"^10.9.2\",\n    \"tsx\": \"^4.20.4\",\n    \"typescript\": \"^5.9.2\"\n  }\n}\n"
    },
    {
      "path": "postcss.config.mjs",
      "lang": "mjs",
      "size": 81,
      "lines": 6,
      "hash": "141ef24ca27a99d08962210fdf20212d3435fdcfa21b46cd88b44d22f751dfae",
      "truncated": false,
      "content": "const config = {\n  plugins: [\"@tailwindcss/postcss\"],\n};\n\nexport default config;\n"
    },
    {
      "path": "prisma/new-seed.ts",
      "lang": "ts",
      "size": 24232,
      "lines": 620,
      "hash": "3391e5b526725b339eaff184be44f68603fad7a690285915c91c6b7651969b8f",
      "truncated": false,
      "content": "import { PrismaClient, Role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\n\nconst prisma = new PrismaClient();\n\nasync function cleanDatabase() {\n  console.log(\"🧹 Membersihkan database sebelum seeding...\");\n  \n  try {\n    // Hapus data dengan urutan yang benar (child tables dulu, lalu parent tables)\n    await prisma.qrScan.deleteMany({});\n    console.log(\"   ✓ Semua data QR scans dihapus\");\n    \n    await prisma.notificationRead.deleteMany({});\n    console.log(\"   ✓ Semua data notification reads dihapus\");\n    \n    await prisma.notification.deleteMany({});\n    console.log(\"   ✓ Semua data notifications dihapus\");\n    \n    await prisma.workerList.deleteMany({});\n    console.log(\"   ✓ Semua data worker list dihapus\");\n    \n    await prisma.submission.deleteMany({});\n    console.log(\"   ✓ Semua data submission dihapus\");\n    \n    await prisma.refreshToken.deleteMany({});\n    console.log(\"   ✓ Semua data refresh tokens dihapus\");\n    \n    await prisma.session.deleteMany({});\n    console.log(\"   ✓ Semua data sessions dihapus\");\n    \n    await prisma.account.deleteMany({});\n    console.log(\"   ✓ Semua data accounts dihapus\");\n    \n    await prisma.user.deleteMany({});\n    console.log(\"   ✓ Semua data user dihapus\");\n    \n    console.log(\"🧹 Database berhasil dibersihkan\");\n  } catch (error) {\n    console.error(\"❌ Error saat membersihkan database:\", error);\n    throw error;\n  }\n}\n\nasync function main() {\n  // Bersihkan database terlebih dahulu\n  await cleanDatabase();\n\n  console.log(\"🌱 Memulai proses seeding...\");\n  \n  const users = [\n    {\n      officer_name: \"Super Admin\",\n      email: \"superadmin@example.com\",\n      password: \"superadmin123\",\n      role: Role.SUPER_ADMIN,\n      profile_photo: null,\n      address: \"Jl. Super Admin No. 1, Jakarta\",\n      phone_number: \"081234567888\",\n      vendor_name: null, // kosong untuk super admin\n      verified_at: new Date(), // super admin sudah terverifikasi\n      verified_by: \"SYSTEM\",\n    },\n    {\n      officer_name: \"Admin Utama\",\n      email: \"admin@example.com\",\n      password: \"admin123\",\n      role: Role.ADMIN,\n      profile_photo: null,\n      address: \"Jl. Admin No. 1, Jakarta\",\n      phone_number: \"081234567890\",\n      vendor_name: null, // kosong untuk admin\n      verified_at: new Date(), // admin sudah terverifikasi\n      verified_by: \"SUPER_ADMIN\",\n    },\n    {\n      officer_name: \"Verifier Utama\",\n      email: \"verifier@example.com\",\n      password: \"verifier123\",\n      role: Role.VERIFIER,\n      profile_photo: null,\n      address: \"Jl. Verifier No. 2, Jakarta\",\n      phone_number: \"081234567891\",\n      vendor_name: null, // kosong untuk verifier\n      verified_at: new Date(), // verifier sudah terverifikasi\n      verified_by: \"SUPER_ADMIN\",\n    },\n    {\n      officer_name: \"Verifier Kedua\",\n      email: \"verifier2@example.com\",\n      password: \"verifier123\",\n      role: Role.VERIFIER,\n      profile_photo: null,\n      address: \"Jl. Verifier No. 3, Bandung\",\n      phone_number: \"081234567899\",\n      vendor_name: null,\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor A Petugas\",\n      email: \"vendora@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor A No. 3, Jakarta\",\n      phone_number: \"081234567892\",\n      vendor_name: \"PT. AHMAD VENDOR SERVICES\",\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor B Petugas\",\n      email: \"vendorb@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor B No. 4, Bandung\",\n      phone_number: \"081234567893\",\n      vendor_name: \"PT. BUANA KONSTRUKSI\",\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor C Petugas\",\n      email: \"vendorc@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor C No. 5, Surabaya\",\n      phone_number: \"081234567894\",\n      vendor_name: \"CV. CIPTA MANDIRI\",\n      verified_at: null, // vendor belum terverifikasi\n      verified_by: null,\n    },\n    {\n      officer_name: \"Vendor D Petugas\",\n      email: \"vendord@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor D No. 6, Medan\",\n      phone_number: \"081234567895\",\n      vendor_name: \"PT. DELTA ENGINEERING\",\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n  ];\n\n  console.log(\"👥 Membuat users...\");\n  const createdUsers: { [key: string]: any } = {};\n\n  for (const user of users) {\n    const hashedPassword = await bcrypt.hash(user.password, 10);\n\n    const createdUser = await prisma.user.upsert({\n      where: { email: user.email },\n      update: {}, // tidak update kalau sudah ada\n      create: {\n        officer_name: user.officer_name,\n        email: user.email,\n        password: hashedPassword,\n        role: user.role,\n        profile_photo: user.profile_photo,\n        address: user.address,\n        phone_number: user.phone_number,\n        vendor_name: user.vendor_name,\n        verified_at: user.verified_at,\n        verified_by: user.verified_by,\n      },\n    });\n\n    createdUsers[user.email] = createdUser;\n  }\n\n  console.log(`   ✓ ${Object.keys(createdUsers).length} users berhasil dibuat`);\n\n  // Create sample submissions\n  console.log(\"📋 Membuat sample submissions...\");\n  const admin = createdUsers[\"admin@example.com\"];\n  const verifiers = Object.values(createdUsers).filter((user: any) => user.role === 'VERIFIER');\n  const vendorUsers = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR');\n\n  const submissionTemplates = [\n    {\n      based_on: \"Kontrak Kerja No. KK/2024/001\",\n      job_description: \"Maintenance Mesin Produksi\",\n      work_location: \"Pabrik Jakarta Plant 1\",\n      working_hours: \"08:00 - 17:00 WIB\",\n      work_facilities: \"Toolkit lengkap, APD standar, crane mobile\",\n      worker_names: \"Ahmad Suharto\\nBudi Santoso\\nCarlos Wijaya\\nDedi Pratama\\nEko Setiawan\",\n      signer_position: \"Manager Operasional\",\n      signer_name: \"Ir. Bambang Suryadi\",\n    },\n    {\n      based_on: \"SPK No. SPK/2024/002\",\n      job_description: \"Instalasi Sistem Keamanan\",\n      work_location: \"Gedung Kantor Pusat\",\n      working_hours: \"09:00 - 16:00 WIB\",\n      work_facilities: \"Kamera CCTV, kabel, tools instalasi\",\n      worker_names: \"Fajar Nugraha\\nGunawan Putra\\nHendro Saputra\",\n      signer_position: \"Kepala Security\",\n      signer_name: \"Drs. Agus Salim\",\n    },\n    {\n      based_on: \"Kontrak Pembangunan No. KB/2024/003\",\n      job_description: \"Renovasi Gudang\",\n      work_location: \"Gudang Distribusi Bandung\",\n      working_hours: \"07:00 - 16:00 WIB\",\n      work_facilities: \"Alat berat, material bangunan, scaffolding\",\n      worker_names: \"Irwan Budiman\\nJoko Susilo\\nKarim Abdullah\\nLutfi Rahman\\nMaman Suryadi\\nNando Pratama\\nOktavio Wijaya\\nPutra Ramadhan\\nQomar Yusuf\\nRizky Mahendra\",\n      signer_position: \"Project Manager\",\n      signer_name: \"Ir. Siti Nurhaliza, MT\",\n    },\n    {\n      based_on: \"Work Order No. WO/2024/004\",\n      job_description: \"Pemeliharaan Jaringan IT\",\n      work_location: \"Data Center Jakarta\",\n      working_hours: \"20:00 - 05:00 WIB\",\n      work_facilities: \"Server equipment, testing tools, laptop\",\n      worker_names: \"Sandi Kurniawan\\nTeguh Prasetyo\",\n      signer_position: \"IT Manager\",\n      signer_name: \"Ir. Made Wirawan\",\n    },\n    {\n      based_on: \"Kontrak Layanan No. KL/2024/005\",\n      job_description: \"Cleaning Service\",\n      work_location: \"Komplek Perkantoran\",\n      working_hours: \"18:00 - 06:00 WIB\",\n      work_facilities: \"Peralatan cleaning, chemical, vacuum cleaner\",\n      worker_names: \"Usman Hakim\\nVina Sari\\nWahyu Utomo\\nXenia Putri\\nYulianto Siswanto\\nZainal Abidin\\nAni Rahayu\\nBayu Setiawan\",\n      signer_position: \"Facility Manager\",\n      signer_name: \"Dra. Rina Kartika\",\n    },\n    {\n      based_on: \"SPK No. SPK/2024/006\",\n      job_description: \"Pengecatan Gedung\",\n      work_location: \"Gedung Perkantoran Tower A\",\n      working_hours: \"08:00 - 15:00 WIB\",\n      work_facilities: \"Cat, kuas, roller, scaffolding, drop cloth\",\n      worker_names: \"Candra Wijaya\\nDani Hartono\\nEdi Susanto\\nFarid Nugroho\\nGalih Pratama\\nHaris Setiawan\",\n      signer_position: \"Building Manager\",\n      signer_name: \"Ir. Hendra Kusuma\",\n    },\n    {\n      based_on: \"Kontrak Kerja No. KK/2024/007\",\n      job_description: \"Instalasi AC Central\",\n      work_location: \"Mall Jakarta Timur\",\n      working_hours: \"06:00 - 14:00 WIB\",\n      work_facilities: \"Unit AC, ducting, tools HVAC, crane\",\n      worker_names: \"Iman Santoso\\nJamal Abdurrahman\\nKurnia Sari\\nLanang Prasetyo\\nMuhammad Rizki\\nNurul Hidayah\\nOctavianus Putra\\nPratama Wijaya\",\n      signer_position: \"Technical Manager\",\n      signer_name: \"Ir. Yudi Prasetyo, MT\",\n    },\n    {\n      based_on: \"Work Order No. WO/2024/008\",\n      job_description: \"Perbaikan Jalan Akses\",\n      work_location: \"Area Industri Cikarang\",\n      working_hours: \"07:00 - 17:00 WIB\",\n      work_facilities: \"Aspal, alat berat, roller, marka jalan\",\n      worker_names: \"Qadri Mahfud\\nRayhan Saputra\\nSusilo Bambang\\nTaufik Hidayat\\nUmar Bakri\\nVandy Kurniawan\\nWawan Setiadi\\nXavier Gunawan\\nYogie Pratama\\nZidane Ahmad\\nAhmad Fauzi\\nBambang Sutrisno\",\n      signer_position: \"Site Manager\",\n      signer_name: \"Ir. Wahyu Santoso\",\n    },\n    {\n      based_on: \"SPK No. SPK/2024/009\",\n      job_description: \"Maintenance Elevator\",\n      work_location: \"Gedung Perkantoran 20 Lantai\",\n      working_hours: \"10:00 - 18:00 WIB\",\n      work_facilities: \"Tools elevator, spare parts, safety equipment\",\n      worker_names: \"Ali Rahman\\nBudi Gunawan\\nCahya Permana\\nDimas Pratama\",\n      signer_position: \"Building Maintenance Manager\",\n      signer_name: \"Ir. Joko Widodo\",\n    },\n    {\n      based_on: \"Kontrak Kerja No. KK/2024/010\",\n      job_description: \"Instalasi Fiber Optic\",\n      work_location: \"Kampus Universitas\",\n      working_hours: \"08:00 - 16:00 WIB\",\n      work_facilities: \"Kabel fiber optic, fusion splicer, OTDR\",\n      worker_names: \"Eko Prasetyo\\nFahmi Hidayat\\nGilang Ramadhan\\nHasan Abdullah\\nIrfan Maulana\",\n      signer_position: \"Network Manager\",\n      signer_name: \"Ir. Rudi Setiawan, MSc\",\n    },\n  ];\n\n  const statuses = ['PENDING', 'APPROVED', 'REJECTED'];\n  const currentDate = new Date();\n  const createdSubmissions: any[] = [];\n  \n  // Create multiple submissions for each vendor\n  let submissionCount = 0;\n  \n  for (const vendor of vendorUsers) {\n    const vendorData = vendor as any;\n    \n    // Each vendor gets 2-4 submissions\n    const numSubmissions = Math.floor(Math.random() * 3) + 2; // 2-4 submissions\n    \n    for (let i = 0; i < numSubmissions; i++) {\n      const template = submissionTemplates[submissionCount % submissionTemplates.length];\n      \n      if (!template) {\n        console.warn('Template is undefined, skipping submission');\n        continue;\n      }\n      \n      const status = statuses[submissionCount % 3];\n      \n      // Create date variations\n      const createdDate = new Date(currentDate);\n      createdDate.setDate(createdDate.getDate() - Math.floor(Math.random() * 60)); // Random date within last 60 days\n      \n      const submissionData: any = {\n        vendor_name: vendorData.vendor_name || `Vendor ${vendorData.officer_name}`,\n        based_on: `${template.based_on.split('No.')[0]}No. ${template.based_on.split('/')[1]}/2024/${String(submissionCount + 1).padStart(3, '0')}`,\n        officer_name: vendorData.officer_name,\n        job_description: template.job_description,\n        work_location: template.work_location,\n        implementation: null, // akan diisi admin saat approve\n        working_hours: template.working_hours,\n        other_notes: null, // akan diisi admin saat approve\n        work_facilities: template.work_facilities,\n        worker_names: template.worker_names,\n        content: null, // akan diisi admin saat approve\n        user_id: vendorData.id,\n        approval_status: status,\n        qrcode: `QR-${vendorData.id}-${Date.now()}-${submissionCount}`,\n        created_at: createdDate,\n        signer_position: template.signer_position,\n        signer_name: template.signer_name,\n        simja_number: submissionCount % 2 === 0 ? `SIMJA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,\n        simja_date: submissionCount % 2 === 0 ? new Date(createdDate.getTime() - Math.random() * 10 * 24 * 60 * 60 * 1000) : null,\n        sika_number: submissionCount % 3 === 0 ? `SIKA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,\n        sika_date: submissionCount % 3 === 0 ? new Date(createdDate.getTime() - Math.random() * 15 * 24 * 60 * 60 * 1000) : null,\n        implementation_start_date: null, // akan diisi admin saat approve\n        implementation_end_date: null, // akan diisi admin saat approve\n      };\n\n      // Add approval data for approved/rejected submissions\n      if (status === 'APPROVED') {\n        submissionData.approved_by = admin.id;\n        submissionData.simlok_number = `SIMLOK/2024/${String(submissionCount + 1).padStart(3, '0')}`;\n        submissionData.simlok_date = new Date(createdDate.getTime() + Math.random() * 5 * 24 * 60 * 60 * 1000);\n        \n        // Add implementation date range (7-30 days from approval)\n        const startDaysFromApproval = Math.floor(Math.random() * 7) + 1; // 1-7 days\n        const durationInDays = Math.floor(Math.random() * 14) + 7; // 7-20 days duration\n        \n        const implementationStart = new Date(submissionData.simlok_date);\n        implementationStart.setDate(implementationStart.getDate() + startDaysFromApproval);\n        \n        const implementationEnd = new Date(implementationStart);\n        implementationEnd.setDate(implementationEnd.getDate() + durationInDays);\n        \n        submissionData.implementation_start_date = implementationStart;\n        submissionData.implementation_end_date = implementationEnd;\n        \n        submissionData.notes = 'Pengajuan disetujui dengan catatan mengikuti prosedur K3 dan laporan harian';\n        // Admin mengisi implementation, other_notes, dan content saat approve\n        submissionData.implementation = `${implementationStart.toISOString().split('T')[0]} s/d ${implementationEnd.toISOString().split('T')[0]}`;\n        const otherNotesOptions = [\n          'Koordinasi dengan supervisor produksi',\n          'Bekerja di luar jam operasional kantor',\n          'Memerlukan izin kerja tinggi',\n          'Pekerjaan malam hari untuk minimal downtime',\n          'Pekerjaan shift malam',\n          'Memerlukan koordinasi dengan penghuni gedung',\n          'Pekerjaan sebelum jam operasional mall',\n          'Koordinasi dengan traffic management',\n          'Pemeliharaan berkala sesuai schedule',\n          'Instalasi diluar jam kuliah'\n        ];\n        submissionData.other_notes = otherNotesOptions[submissionCount % otherNotesOptions.length];\n        \n        // Admin mengisi content saat approve\n        const contentOptions = [\n          'Pemeliharaan rutin mesin produksi untuk memastikan kinerja optimal',\n          'Pemasangan sistem CCTV dan alarm keamanan di seluruh area kantor',\n          'Perbaikan struktur gudang dan peningkatan kapasitas penyimpanan',\n          'Update sistem dan maintenance server untuk performa optimal',\n          'Layanan kebersihan harian untuk seluruh area perkantoran',\n          'Pengecatan ulang eksterior dan interior gedung perkantoran',\n          'Pemasangan sistem AC central untuk seluruh area mall',\n          'Perbaikan dan penambalan jalan akses menuju area industri',\n          'Maintenance berkala elevator untuk keamanan pengguna',\n          'Instalasi backbone fiber optic untuk koneksi high-speed'\n        ];\n        submissionData.content = contentOptions[submissionCount % contentOptions.length];\n      } else if (status === 'REJECTED') {\n        submissionData.approved_by = admin.id;\n        const rejectionReasons = [\n          'Dokumen SIMJA belum lengkap, mohon dilengkapi terlebih dahulu',\n          'Sertifikat pelatihan K3 sudah expired, mohon diperbaharui',\n          'Jadwal pelaksanaan bertabrakan dengan kegiatan lain',\n          'Spesifikasi alat kerja tidak sesuai standar, mohon disesuaikan',\n          'Jumlah pekerja kurang memadai untuk scope pekerjaan ini',\n          'Dokumen SIKA belum tersedia, mohon dilengkapi',\n          'Koordinasi dengan pihak terkait belum dilakukan'\n        ];\n        submissionData.notes = rejectionReasons[submissionCount % rejectionReasons.length];\n      }\n\n      const createdSubmission = await prisma.submission.create({\n        data: submissionData,\n      });\n\n      createdSubmissions.push(createdSubmission);\n\n      // Create worker list for this submission\n      const workerNamesArray = template.worker_names.split('\\n');\n      for (const workerName of workerNamesArray) {\n        await prisma.workerList.create({\n          data: {\n            worker_name: workerName.trim(),\n            worker_photo: null, // akan diupload nanti\n            submission_id: createdSubmission.id,\n          },\n        });\n      }\n      \n      submissionCount++;\n    }\n  }\n\n  console.log(`   ✓ ${submissionCount} submissions berhasil dibuat`);\n\n  // Create QR scan history for approved submissions\n  console.log(\"📱 Membuat QR scan history...\");\n  const approvedSubmissions = createdSubmissions.filter(s => s.approval_status === 'APPROVED');\n  \n  let scanCount = 0;\n  for (const submission of approvedSubmissions) {\n    // Some submissions have been scanned by verifiers\n    const shouldHaveScans = Math.random() > 0.3; // 70% chance of having scans\n    \n    if (shouldHaveScans) {\n      const numScans = Math.floor(Math.random() * 3) + 1; // 1-3 scans per submission\n      \n      for (let i = 0; i < numScans; i++) {\n        const randomVerifier = verifiers[Math.floor(Math.random() * verifiers.length)] as any;\n        \n        // Create scan date after submission approval\n        const scanDate = new Date(submission.simlok_date || submission.created_at);\n        scanDate.setDate(scanDate.getDate() + Math.floor(Math.random() * 30)); // Random scan within 30 days after approval\n        \n        await prisma.qrScan.create({\n          data: {\n            submission_id: submission.id,\n            scanned_by: randomVerifier.id,\n            scanned_at: scanDate,\n            scanner_name: randomVerifier.officer_name,\n            notes: i === 0 ? 'Scan pertama - verifikasi awal pelaksanaan' : \n                   i === 1 ? 'Scan kedua - monitoring progress pekerjaan' : \n                   'Scan ketiga - verifikasi penyelesaian pekerjaan',\n          },\n        });\n        \n        scanCount++;\n      }\n    }\n  }\n\n  console.log(`   ✓ ${scanCount} QR scans berhasil dibuat`);\n\n  // Create sample notifications\n  console.log(\"🔔 Membuat sample notifications...\");\n  \n  // Create vendor registration notifications\n  const unverifiedVendors = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR' && !user.verified_at);\n  \n  for (const vendor of unverifiedVendors) {\n    const vendorData = vendor as any;\n    \n    // Create admin notification for new vendor registration\n    await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        vendor_id: null,\n        type: 'new_vendor',\n        title: 'Pendaftaran Vendor Baru',\n        message: `Vendor baru mendaftar: ${vendorData.vendor_name}`,\n        data: JSON.stringify({\n          vendorId: vendorData.id,\n          vendorName: vendorData.vendor_name,\n          officerName: vendorData.officer_name,\n        }),\n        created_at: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000), // Random dalam 7 hari terakhir\n      },\n    });\n  }\n\n  // Create submission notifications\n  const recentSubmissions = await prisma.submission.findMany({\n    where: {\n      created_at: {\n        gte: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000), // 14 hari terakhir\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  for (const submission of recentSubmissions.slice(0, 8)) { // Ambil 8 submission terbaru\n    // Create admin notification for new submission\n    await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        vendor_id: null,\n        type: 'new_submission',\n        title: 'Pengajuan Baru',\n        message: `Pengajuan baru dari ${submission.user.vendor_name || submission.user.officer_name}: ${submission.job_description}`,\n        data: JSON.stringify({\n          submissionId: submission.id,\n          vendorName: submission.user.vendor_name || submission.user.officer_name,\n          jobDescription: submission.job_description,\n        }),\n        created_at: submission.created_at,\n      },\n    });\n\n    // Create vendor notification for status changes (for approved/rejected submissions)\n    if (submission.approval_status !== 'PENDING') {\n      await prisma.notification.create({\n        data: {\n          scope: 'vendor',\n          vendor_id: submission.user_id,\n          type: 'status_change',\n          title: 'Status Pengajuan Diperbarui',\n          message: `Pengajuan Anda \"${submission.job_description}\" telah ${submission.approval_status === 'APPROVED' ? 'disetujui' : 'ditolak'}`,\n          data: JSON.stringify({\n            submissionId: submission.id,\n            newStatus: submission.approval_status,\n            jobDescription: submission.job_description,\n          }),\n          created_at: new Date(submission.created_at.getTime() + Math.random() * 2 * 24 * 60 * 60 * 1000), // 1-2 hari setelah submission\n        },\n      });\n    }\n  }\n\n  // Create QR scan notifications for verifiers\n  const recentScans = await prisma.qrScan.findMany({\n    where: {\n      scanned_at: {\n        gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 hari terakhir\n      },\n    },\n    include: {\n      submission: {\n        include: {\n          user: true,\n        },\n      },\n      user: true,\n    },\n    take: 5,\n  });\n\n  for (const scan of recentScans) {\n    // Create admin notification for QR scans\n    await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        vendor_id: null,\n        type: 'qr_scan',\n        title: 'QR Code Discan',\n        message: `${scan.user.officer_name} telah memindai QR submission \"${scan.submission.job_description}\"`,\n        data: JSON.stringify({\n          submissionId: scan.submission.id,\n          scannerId: scan.user.id,\n          scannerName: scan.user.officer_name,\n          jobDescription: scan.submission.job_description,\n          scanDate: scan.scanned_at,\n        }),\n        created_at: scan.scanned_at,\n      },\n    });\n  }\n\n  console.log(\"   ✓ Sample notifications berhasil dibuat\");\n\n  // Summary statistics\n  const stats = {\n    users: await prisma.user.count(),\n    submissions: await prisma.submission.count(),\n    workerList: await prisma.workerList.count(),\n    qrScans: await prisma.qrScan.count(),\n    notifications: await prisma.notification.count(),\n  };\n\n  console.log(\"\\n📊 Summary Statistics:\");\n  console.log(`   👥 Users: ${stats.users}`);\n  console.log(`   📋 Submissions: ${stats.submissions}`);\n  console.log(`   👷 Worker List: ${stats.workerList}`);\n  console.log(`   📱 QR Scans: ${stats.qrScans}`);\n  console.log(`   🔔 Notifications: ${stats.notifications}`);\n  \n  console.log(\"\\n✅ Seeding selesai dengan sukses!\");\n  console.log(\"\\n🔑 Login Credentials:\");\n  console.log(\"Super Admin: superadmin@example.com / superadmin123\");\n  console.log(\"Admin: admin@example.com / admin123\");\n  console.log(\"Verifier 1: verifier@example.com / verifier123\");\n  console.log(\"Verifier 2: verifier2@example.com / verifier123\");\n  console.log(\"Vendor A: vendora@example.com / vendor123\");\n  console.log(\"Vendor B: vendorb@example.com / vendor123\");\n  console.log(\"Vendor C: vendorc@example.com / vendor123 (belum terverifikasi)\");\n  console.log(\"Vendor D: vendord@example.com / vendor123\");\n}\n\nmain()\n  .catch((e) => {\n    console.error(e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n"
    },
    {
      "path": "prisma/seed.ts",
      "lang": "ts",
      "size": 19739,
      "lines": 539,
      "hash": "a81bb373ed03707cde3ecbbea0647506d1e3a302521ba990df26ca4dbc1992db",
      "truncated": false,
      "content": "import { PrismaClient, Role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\n\nconst prisma = new PrismaClient();\n\nasync function cleanDatabase() {\n  console.log(\"🧹 Membersihkan database sebelum seeding...\");\n  \n  try {\n    // Hapus data dengan urutan yang benar (child tables dulu, lalu parent tables)\n    await prisma.notificationRead.deleteMany({});\n    console.log(\"   ✓ Semua data notification reads dihapus\");\n    \n    await prisma.notification.deleteMany({});\n    console.log(\"   ✓ Semua data notifications dihapus\");\n    \n    await prisma.qrScan.deleteMany({});\n    console.log(\"   ✓ Semua data QR scans dihapus\");\n    \n    await prisma.workerList.deleteMany({});\n    console.log(\"   ✓ Semua data worker list dihapus\");\n    \n    await prisma.submission.deleteMany({});\n    console.log(\"   ✓ Semua data submission dihapus\");\n    \n    await prisma.refreshToken.deleteMany({});\n    console.log(\"   ✓ Semua data refresh tokens dihapus\");\n    \n    await prisma.session.deleteMany({});\n    console.log(\"   ✓ Semua data sessions dihapus\");\n    \n    await prisma.account.deleteMany({});\n    console.log(\"   ✓ Semua data accounts dihapus\");\n    \n    await prisma.user.deleteMany({});\n    console.log(\"   ✓ Semua data user dihapus\");\n    \n    console.log(\"🧹 Database berhasil dibersihkan\");\n  } catch (error) {\n    console.error(\"❌ Error saat membersihkan database:\", error);\n    throw error;\n  }\n}\n\nasync function main() {\n  // Bersihkan database terlebih dahulu\n  await cleanDatabase();\n\n  console.log(\"🌱 Memulai proses seeding...\");\n  \n  const users = [\n    {\n      officer_name: \"Admin Utama\",\n      email: \"admin@example.com\",\n      password: \"admin123\",\n      role: Role.ADMIN,\n      profile_photo: null,\n      address: \"Jl. Admin No. 1, Jakarta\",\n      phone_number: \"081234567890\",\n      vendor_name: null, // kosong untuk admin\n      verified_at: new Date(), // admin sudah terverifikasi\n      verified_by: \"SYSTEM\",\n    },\n    {\n      officer_name: \"Super Admin\",\n      email: \"superadmin@example.com\",\n      password: \"super123\", \n      role: Role.SUPER_ADMIN,\n      profile_photo: null,\n      address: \"Jl. Super Admin No. 1, Jakarta\",\n      phone_number: \"081234567889\",\n      vendor_name: null, // kosong untuk super admin\n      verified_at: new Date(), // super admin sudah terverifikasi\n      verified_by: \"SYSTEM\",\n    },\n    {\n      officer_name: \"Reviewer Utama\",\n      email: \"reviewer@example.com\",\n      password: \"reviewer123\",\n      role: Role.REVIEWER,\n      profile_photo: null,\n      address: \"Jl. Reviewer No. 2, Jakarta\",\n      phone_number: \"081234567888\",\n      vendor_name: null, // kosong untuk reviewer\n      verified_at: new Date(), // reviewer sudah terverifikasi\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Approver Utama\",\n      email: \"approver@example.com\",\n      password: \"approver123\",\n      role: Role.APPROVER,\n      profile_photo: null,\n      address: \"Jl. Approver No. 3, Jakarta\",\n      phone_number: \"081234567887\",\n      vendor_name: null, // kosong untuk approver\n      verified_at: new Date(), // approver sudah terverifikasi\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Verifier Utama\",\n      email: \"verifier@example.com\",\n      password: \"verifier123\",\n      role: Role.VERIFIER,\n      profile_photo: null,\n      address: \"Jl. Verifier No. 4, Jakarta\",\n      phone_number: \"081234567891\",\n      vendor_name: null, // kosong untuk verifier\n      verified_at: new Date(), // verifier sudah terverifikasi\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor A Petugas\",\n      email: \"vendora@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor A No. 5, Jakarta\",\n      phone_number: \"081234567892\",\n      vendor_name: \"PT. AHMAD VENDOR SERVICES\",\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor B Petugas\",\n      email: \"vendorb@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor B No. 6, Bandung\",\n      phone_number: \"081234567893\",\n      vendor_name: \"PT. BUANA KONSTRUKSI\",\n      verified_at: new Date(),\n      verified_by: \"ADMIN\",\n    },\n    {\n      officer_name: \"Vendor C Petugas\",\n      email: \"vendorc@example.com\",\n      password: \"vendor123\",\n      role: Role.VENDOR,\n      profile_photo: null,\n      address: \"Jl. Vendor C No. 7, Surabaya\",\n      phone_number: \"081234567894\",\n      vendor_name: \"CV. CIPTA MANDIRI\",\n      verified_at: null, // vendor belum terverifikasi\n      verified_by: null,\n    },\n  ];\n\n  console.log(\"👥 Membuat users...\");\n  const createdUsers: { [key: string]: any } = {};\n\n  for (const user of users) {\n    const hashedPassword = await bcrypt.hash(user.password, 10);\n\n    const createdUser = await prisma.user.upsert({\n      where: { email: user.email },\n      update: {}, // tidak update kalau sudah ada\n      create: {\n        officer_name: user.officer_name,\n        email: user.email,\n        password: hashedPassword,\n        role: user.role,\n        profile_photo: user.profile_photo,\n        address: user.address,\n        phone_number: user.phone_number,\n        vendor_name: user.vendor_name,\n        verified_at: user.verified_at,\n        verified_by: user.verified_by,\n      },\n    });\n\n    createdUsers[user.email] = createdUser;\n  }\n\n  console.log(`   ✓ ${Object.keys(createdUsers).length} users berhasil dibuat`);\n\n  // Create sample submissions\n  console.log(\"📋 Membuat sample submissions...\");\n  const vendorUsers = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR');\n\n  const submissionTemplates = [\n    {\n      based_on: \"Kontrak Kerja No. KK/2024/001\",\n      job_description: \"Maintenance Mesin Produksi\",\n      work_location: \"Pabrik Jakarta Plant 1\",\n      working_hours: \"08:00 - 17:00 WIB\",\n      work_facilities: \"Toolkit lengkap, APD standar, crane mobile\",\n      worker_names: \"Ahmad Suharto\\nBudi Santoso\\nCarlos Wijaya\\nDedi Pratama\\nEko Setiawan\",\n    },\n    {\n      based_on: \"SPK No. SPK/2024/002\",\n      job_description: \"Instalasi Sistem Keamanan\",\n      work_location: \"Gedung Kantor Pusat\",\n      working_hours: \"09:00 - 16:00 WIB\",\n      work_facilities: \"Kamera CCTV, kabel, tools instalasi\",\n      worker_names: \"Fajar Nugraha\\nGunawan Putra\\nHendro Saputra\",\n    },\n    {\n      based_on: \"Kontrak Pembangunan No. KB/2024/003\",\n      job_description: \"Renovasi Gudang\",\n      work_location: \"Gudang Distribusi Bandung\",\n      working_hours: \"07:00 - 16:00 WIB\",\n      work_facilities: \"Alat berat, material bangunan, scaffolding\",\n      worker_names: \"Irwan Budiman\\nJoko Susilo\\nKarim Abdullah\\nLutfi Rahman\\nMaman Suryadi\\nNando Pratama\\nOktavio Wijaya\\nPutra Ramadhan\\nQomar Yusuf\\nRizky Mahendra\",\n    },\n    {\n      based_on: \"Work Order No. WO/2024/004\",\n      job_description: \"Pemeliharaan Jaringan IT\",\n      work_location: \"Data Center Jakarta\",\n      working_hours: \"20:00 - 05:00 WIB\",\n      work_facilities: \"Server equipment, testing tools, laptop\",\n      worker_names: \"Sandi Kurniawan\\nTeguh Prasetyo\",\n    },\n    {\n      based_on: \"Kontrak Layanan No. KL/2024/005\",\n      job_description: \"Cleaning Service\",\n      work_location: \"Komplek Perkantoran\",\n      working_hours: \"18:00 - 06:00 WIB\",\n      work_facilities: \"Peralatan cleaning, chemical, vacuum cleaner\",\n      worker_names: \"Usman Hakim\\nVina Sari\\nWahyu Utomo\\nXenia Putri\\nYulianto Siswanto\\nZainal Abidin\\nAni Rahayu\\nBayu Setiawan\",\n    },\n    {\n      based_on: \"SPK No. SPK/2024/006\",\n      job_description: \"Pengecatan Gedung\",\n      work_location: \"Gedung Perkantoran Tower A\",\n      working_hours: \"08:00 - 15:00 WIB\",\n      work_facilities: \"Cat, kuas, roller, scaffolding, drop cloth\",\n      worker_names: \"Candra Wijaya\\nDani Hartono\\nEdi Susanto\\nFarid Nugroho\\nGalih Pratama\\nHaris Setiawan\",\n    },\n    {\n      based_on: \"Kontrak Kerja No. KK/2024/007\",\n      job_description: \"Instalasi AC Central\",\n      work_location: \"Mall Jakarta Timur\",\n      working_hours: \"06:00 - 14:00 WIB\",\n      work_facilities: \"Unit AC, ducting, tools HVAC, crane\",\n      worker_names: \"Iman Santoso\\nJamal Abdurrahman\\nKurnia Sari\\nLanang Prasetyo\\nMuhammad Rizki\\nNurul Hidayah\\nOctavianus Putra\\nPratama Wijaya\",\n    },\n    {\n      based_on: \"Work Order No. WO/2024/008\",\n      job_description: \"Perbaikan Jalan Akses\",\n      work_location: \"Area Industri Cikarang\",\n      working_hours: \"07:00 - 17:00 WIB\",\n      work_facilities: \"Aspal, alat berat, roller, marka jalan\",\n      worker_names: \"Qadri Mahfud\\nRayhan Saputra\\nSusilo Bambang\\nTaufik Hidayat\\nUmar Bakri\\nVandy Kurniawan\\nWawan Setiadi\\nXavier Gunawan\\nYogie Pratama\\nZidane Ahmad\\nAhmad Fauzi\\nBambang Sutrisno\",\n    },\n  ];\n\n  const currentDate = new Date();\n  \n  // Create multiple submissions for each vendor\n  let submissionCount = 0;\n  \n  for (const vendor of vendorUsers) {\n    const vendorData = vendor as any;\n    \n    // Each vendor gets 2-4 submissions\n    const numSubmissions = Math.floor(Math.random() * 3) + 2; // 2-4 submissions\n    \n    for (let i = 0; i < numSubmissions; i++) {\n      const template = submissionTemplates[submissionCount % submissionTemplates.length];\n      \n      if (!template) {\n        console.warn('Template is undefined, skipping submission');\n        continue;\n      }\n      \n      const status = 'PENDING'; // Semua submission pending\n      \n      // Create date variations\n      const createdDate = new Date(currentDate);\n      createdDate.setDate(createdDate.getDate() - Math.floor(Math.random() * 60)); // Random date within last 60 days\n      \n      const submissionData: any = {\n        vendor_name: vendorData.vendor_name,\n        based_on: `${template.based_on.split('No.')[0]}No. ${template.based_on.split('/')[1]}/2024/${String(submissionCount + 1).padStart(3, '0')}`,\n        officer_name: vendorData.officer_name,\n        job_description: template.job_description,\n        work_location: template.work_location,\n        implementation: null, // akan diisi admin saat approve\n        working_hours: template.working_hours,\n        other_notes: null, // akan diisi admin saat approve\n        work_facilities: template.work_facilities,\n        worker_names: template.worker_names,\n        content: null, // akan diisi admin saat approve\n        user_id: vendorData.id,\n        approval_status: status,\n        qrcode: '',\n        created_at: createdDate,\n        simja_number: submissionCount % 2 === 0 ? `SIMJA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,\n        simja_date: submissionCount % 2 === 0 ? new Date(createdDate.getTime() - Math.random() * 10 * 24 * 60 * 60 * 1000) : null,\n        sika_number: submissionCount % 3 === 0 ? `SIKA/2024/${String(submissionCount + 1).padStart(3, '0')}` : null,\n        sika_date: submissionCount % 3 === 0 ? new Date(createdDate.getTime() - Math.random() * 15 * 24 * 60 * 60 * 1000) : null,\n        implementation_start_date: null,\n        implementation_end_date: null,\n      };\n\n      // Semua submission pending - tidak ada approval data\n      // Admin akan mengisi data saat approve melalui UI\n\n      const createdSubmission = await prisma.submission.create({\n        data: submissionData,\n      });\n\n      // Create worker list for this submission\n      const workerNamesArray = template.worker_names.split('\\n');\n      for (const workerName of workerNamesArray) {\n        await prisma.workerList.create({\n          data: {\n            worker_name: workerName.trim(),\n            worker_photo: null, // akan diupload nanti\n            submission_id: createdSubmission.id,\n          },\n        });\n      }\n      \n      submissionCount++;\n    }\n  }\n\n  console.log(`   ✓ ${submissionCount} submissions berhasil dibuat`);\n\n  // Update some submissions to be APPROVED and add QR scans\n  console.log(\"📊 Mengupdate beberapa submissions menjadi APPROVED dan menambahkan QR scans...\");\n  \n  const approverUser = createdUsers['approver@example.com'];\n  const verifierUser = createdUsers['verifier@example.com'];\n  const reviewerUser = createdUsers['reviewer@example.com'];\n  \n  if (!approverUser || !verifierUser || !reviewerUser) {\n    console.error(\"❌ Required users not found for QR scan seeding\");\n    return;\n  }\n  \n  // Get all submissions\n  const allSubmissions = await prisma.submission.findMany({\n    orderBy: { created_at: 'asc' }\n  });\n  \n  // Update 60% of submissions to APPROVED status with SIMLOK numbers\n  const submissionsToApprove = allSubmissions.slice(0, Math.floor(allSubmissions.length * 0.6));\n  \n  for (let i = 0; i < submissionsToApprove.length; i++) {\n    const submission = submissionsToApprove[i];\n    if (!submission) continue;\n    \n    const simlokNumber = `SIMLOK/${new Date().getFullYear()}/${String(i + 1).padStart(4, '0')}`;\n    const simlokDate = new Date(submission.created_at.getTime() + Math.random() * 7 * 24 * 60 * 60 * 1000); // 0-7 days after creation\n    \n    // Create implementation dates\n    const implStartDate = new Date(simlokDate.getTime() + Math.random() * 3 * 24 * 60 * 60 * 1000); // 0-3 days after SIMLOK\n    const implEndDate = new Date(implStartDate.getTime() + (Math.random() * 14 + 1) * 24 * 60 * 60 * 1000); // 1-15 days duration\n    \n    await prisma.submission.update({\n      where: { id: submission.id },\n      data: {\n        approval_status: 'APPROVED',\n        simlok_number: simlokNumber,\n        simlok_date: simlokDate,\n        approved_by: approverUser.id,\n        reviewed_by_id: reviewerUser.id,\n        review_status: 'MEETS_REQUIREMENTS',\n        review_note: `Dokumen lengkap dan sesuai persyaratan untuk ${submission.job_description}`,\n        approved_by_final_id: approverUser.id,\n        final_status: 'APPROVED',\n        final_note: `Disetujui untuk pelaksanaan di ${submission.work_location}`,\n        implementation: `Pelaksanaan ${submission.job_description} sesuai dengan SPK yang telah disetujui`,\n        implementation_start_date: implStartDate,\n        implementation_end_date: implEndDate,\n        content: `Dokumen SIMLOK untuk ${submission.job_description} di ${submission.work_location}`,\n        qrcode: `{\"submissionId\":\"${submission.id}\",\"simlokNumber\":\"${simlokNumber}\",\"vendorName\":\"${submission.vendor_name}\",\"type\":\"SIMLOK_QR\"}`,\n      }\n    });\n  }\n  \n  console.log(`   ✓ ${submissionsToApprove.length} submissions diupdate ke status APPROVED`);\n  \n  // Add QR Scans for approved submissions\n  console.log(\"🔍 Menambahkan data QR scans untuk submissions yang sudah diapprove...\");\n  \n  const approvedSubmissions = await prisma.submission.findMany({\n    where: { approval_status: 'APPROVED' },\n    orderBy: { simlok_date: 'asc' }\n  });\n  \n  let qrScanCount = 0;\n  \n  // Create QR scans for 80% of approved submissions (some scanned multiple times)\n  const submissionsToScan = approvedSubmissions.slice(0, Math.floor(approvedSubmissions.length * 0.8));\n  \n  for (const submission of submissionsToScan) {\n    if (!submission.simlok_date || !submission.implementation_end_date) continue;\n    \n    // Create 1-3 QR scans per submission (simulate multiple scans)\n    const numScans = Math.floor(Math.random() * 3) + 1; // 1-3 scans\n    \n    for (let scanIndex = 0; scanIndex < numScans; scanIndex++) {\n      // Create scan dates between SIMLOK date and implementation end date\n      const scanDate = new Date(\n        submission.simlok_date.getTime() + \n        Math.random() * (submission.implementation_end_date.getTime() - submission.simlok_date.getTime())\n      );\n      \n      // Add some variation to scan locations\n      const scanLocations = [\n        'Pos Security Entrance',\n        'Area Kerja Utama', \n        'Site Office',\n        'Safety Checkpoint',\n        'Main Gate',\n        'Project Site',\n        'Supervisor Office',\n        'Quality Control Point'\n      ];\n      \n      const scanLocation = scanLocations[Math.floor(Math.random() * scanLocations.length)];\n      \n      const scanNotes = [\n        'Verifikasi rutin dokumen SIMLOK',\n        'Pemeriksaan saat masuk area kerja',\n        'Kontrol kualitas dokumen',\n        'Verifikasi sebelum mulai kerja',\n        'Pemeriksaan keamanan',\n        'Audit compliance dokumen',\n        'Verifikasi kelengkapan tim',\n        'Kontrol akses area restricted'\n      ];\n      \n      const selectedNote = scanNotes[Math.floor(Math.random() * scanNotes.length)];\n      \n      await prisma.qrScan.create({\n        data: {\n          submission_id: submission.id,\n          scanned_by: verifierUser.id,\n          scanned_at: scanDate,\n          scanner_name: verifierUser.officer_name,\n          scan_location: scanLocation || null,\n          notes: selectedNote || null,\n        }\n      });\n      \n      qrScanCount++;\n    }\n  }\n  \n  // Add some recent scans (within last 7 days) for dashboard stats\n  const recentApprovedSubmissions = approvedSubmissions.slice(0, 5);\n  for (const submission of recentApprovedSubmissions) {\n    const recentScanDate = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000); // Within last 7 days\n    \n    await prisma.qrScan.create({\n      data: {\n        submission_id: submission.id,\n        scanned_by: verifierUser.id,\n        scanned_at: recentScanDate,\n        scanner_name: verifierUser.officer_name,\n        scan_location: 'Mobile Verification',\n        notes: 'Verifikasi lapangan menggunakan aplikasi mobile',\n      }\n    });\n    \n    qrScanCount++;\n  }\n  \n  console.log(`   ✓ ${qrScanCount} QR scans berhasil dibuat`);\n\n  // Create sample notifications\n  console.log(\"🔔 Membuat sample notifications...\");\n  \n  // Create vendor registration notifications\n  const unverifiedVendors = Object.values(createdUsers).filter((user: any) => user.role === 'VENDOR' && !user.verified_at);\n  \n  for (const vendor of unverifiedVendors) {\n    const vendorData = vendor as any;\n    \n    // Create admin notification for new vendor registration\n    await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        vendor_id: null,\n        type: 'new_vendor',\n        title: 'Pendaftaran Vendor Baru',\n        message: `Vendor baru mendaftar: ${vendorData.vendor_name}`,\n        data: JSON.stringify({\n          vendorId: vendorData.id,\n          vendorName: vendorData.vendor_name,\n          officerName: vendorData.officer_name,\n        }),\n        created_at: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000), // Random dalam 7 hari terakhir\n      },\n    });\n  }\n\n  // Create submission notifications\n  const recentSubmissions = await prisma.submission.findMany({\n    where: {\n      created_at: {\n        gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 hari terakhir\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  for (const submission of recentSubmissions.slice(0, 5)) { // Ambil 5 submission terbaru\n    // Create admin notification for new submission\n    await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        vendor_id: null,\n        type: 'new_submission',\n        title: 'Pengajuan Baru',\n        message: `Pengajuan baru dari ${submission.vendor_name}: ${submission.job_description}`,\n        data: JSON.stringify({\n          submissionId: submission.id,\n          vendorName: submission.vendor_name,\n          jobDescription: submission.job_description,\n        }),\n        created_at: submission.created_at,\n      },\n    });\n\n    // Tidak ada status change notifications karena semua pending\n  }\n\n  console.log(\"   ✓ Sample notifications berhasil dibuat\");\n  console.log(\"✅ Seeding selesai dengan sukses!\");\n}\n\nmain()\n  .catch((e) => {\n    console.error(e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n"
    },
    {
      "path": "qr-comparison-analysis.js",
      "lang": "js",
      "size": 2285,
      "lines": 49,
      "hash": "53e6acf26553d8b32dfe8fe5c6ec3e19e567432f6119d02c96bbc579582cc5d4",
      "truncated": false,
      "content": "// Visual comparison of QR code complexity\nconsole.log('=== QR CODE OPTIMIZATION VISUAL COMPARISON ===\\n');\n\nconst submissionId = 'cmf9wfenv0002sid11tsws75w';\n\n// OLD FORMAT: Base64 encoded JSON\nconst oldQR = 'SL|eyJpZCI6ImNtZjl3ZmVudjAwMDJzaWQxMXRzd3M3NXciLCJleHAiOjE3NTgwNTAzODI2NzgsInNpZyI6IjQyOTc3MiJ9';\n\n// NEW FORMAT: Colon-separated direct data  \nconst newQR = 'SL:cmf9wfenv0002sid11tsws75w:1758050382678:429772';\n\nconsole.log('📊 LENGTH COMPARISON:');\nconsole.log(`OLD: ${oldQR} (${oldQR.length} chars)`);\nconsole.log(`NEW: ${newQR} (${newQR.length} chars)`);\nconsole.log(`REDUCTION: ${oldQR.length - newQR.length} characters (${Math.round(((oldQR.length - newQR.length) / oldQR.length) * 100)}% smaller)\\n`);\n\nconsole.log('🔍 PATTERN COMPLEXITY:');\nconsole.log('OLD FORMAT:');\nconsole.log('• Uses Base64 encoding (complex character set: A-Z, a-z, 0-9, +, /, =)');\nconsole.log('• Contains JSON structure with quotes and braces');\nconsole.log('• Mixed case letters create denser QR patterns');\nconsole.log('• Padding characters (=) add noise\\n');\n\nconsole.log('NEW FORMAT:');\nconsole.log('• Uses simple alphanumeric + colon separators');\nconsole.log('• Direct data, no encoding overhead');\nconsole.log('• Consistent character types');\nconsole.log('• Clean structure: prefix:id:timestamp:signature\\n');\n\nconsole.log('📱 SCANNING BENEFITS:');\nconsole.log('✅ Shorter length = Less dense QR code');\nconsole.log('✅ Simpler character set = Better camera recognition');\nconsole.log('✅ No mixed case = More uniform patterns');\nconsole.log('✅ Linear structure = Easier error correction');\nconsole.log('✅ Faster processing = Quicker verification\\n');\n\nconsole.log('🔐 SECURITY COMPARISON:');\nconsole.log('OLD: 8-char signature');\nconsole.log('NEW: 6-char signature (still cryptographically secure)');\nconsole.log('BOTH: SHA-256 based with salt protection');\nconsole.log('BOTH: Timestamp expiration (24h validity)\\n');\n\nconsole.log('🎯 REAL-WORLD IMPACT:');\nconsole.log('• Mobile cameras can focus faster on simpler patterns');\nconsole.log('• Less scanning attempts needed');\nconsole.log('• Better performance in poor lighting');\nconsole.log('• Reduced user frustration during verification');\nconsole.log('• Lower chance of scanning errors');\n"
    },
    {
      "path": "server.js",
      "lang": "js",
      "size": 2117,
      "lines": 71,
      "hash": "15996d6030d2dd1a5cb9c165ff216175ef82afafc5c88ff0ec32f381de209caa",
      "truncated": false,
      "content": "const { createServer } = require('http');\nconst { parse } = require('url');\nconst next = require('next');\n\nconst dev = process.env.NODE_ENV !== 'production';\nconst hostname = 'localhost';\nconst port = process.env.PORT || 3000;\n\nconst app = next({ dev, hostname, port });\nconst handle = app.getRequestHandler();\n\napp.prepare().then(() => {\n  const httpServer = createServer(async (req, res) => {\n    try {\n      const parsedUrl = parse(req.url, true);\n      await handle(req, res, parsedUrl);\n    } catch (err) {\n      console.error('Error occurred handling', req.url, err);\n      res.statusCode = 500;\n      res.end('internal server error');\n    }\n  });\n\n  // Initialize Socket.IO using singleton pattern\n  const { initializeSocketIO } = require('./src/lib/singletons');\n  const io = initializeSocketIO(httpServer);\n\n  // Store references globally for API routes\n  global.__socket_server = httpServer;\n\n  // Socket.IO connection handling\n  io.on('connection', (socket) => {\n    console.log('Client connected:', socket.id);\n\n    socket.on('join', (data) => {\n      try {\n        const { role, vendorId } = data;\n        \n        if (role === 'ADMIN') {\n          socket.join('admin');\n          console.log(`Socket ${socket.id} joined admin room`);\n        } else if (role === 'REVIEWER') {\n          socket.join('reviewer');\n          console.log(`Socket ${socket.id} joined reviewer room`);\n        } else if (role === 'APPROVER') {\n          socket.join('approver');\n          console.log(`Socket ${socket.id} joined approver room`);\n        } else if (role === 'VENDOR' && vendorId) {\n          socket.join(`vendor:${vendorId}`);\n          console.log(`Socket ${socket.id} joined vendor room: ${vendorId}`);\n        }\n      } catch (error) {\n        console.error('Error joining room:', error);\n      }\n    });\n\n    socket.on('disconnect', () => {\n      console.log('Client disconnected:', socket.id);\n    });\n  });\n\n  httpServer\n    .once('error', (err) => {\n      console.error(err);\n      process.exit(1);\n    })\n    .listen(port, () => {\n      console.log(`> Ready on http://${hostname}:${port}`);\n    });\n});\n"
    },
    {
      "path": "src/app/(auth)/login/metadata.ts",
      "lang": "ts",
      "size": 148,
      "lines": 6,
      "hash": "c1f2ac97d49324792fbab71ed3469f18da58ac1fc464d4b0ceccfebd4ac32a32",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\n\nexport const metadata: Metadata = {\n  title: \"Masuk - SIMLOK\",\n  description: \"Halaman masuk ke sistem SIMLOK\",\n};"
    },
    {
      "path": "src/app/(auth)/login/page.tsx",
      "lang": "tsx",
      "size": 1230,
      "lines": 50,
      "hash": "a230af4a2b3d01741b5daf4ae9479ed31c3b7774f15b0f50890127e86916d7b0",
      "truncated": false,
      "content": "\"use client\";\n\nimport { signIn } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport AuthRedirect from \"@/components/auth/AuthRedirect\";\nimport SignInForm from \"@/components/auth/SignInForm\";\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShow] = useState(false);\n  const [keepLoggedIn, setKeep] = useState(false);\n  const [error, setError] = useState(\"\");\n  const router = useRouter();\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(\"\");\n\n    const res = await signIn(\"credentials\", {\n      redirect: false,\n      email,\n      password,\n    });\n\n    if (res?.error) {\n      setError(res.error);\n    } else {\n      router.push(\"/\");\n    }\n  }\n\n  return (\n    <AuthRedirect>\n      <SignInForm\n        email={email}\n        password={password}\n        showPassword={showPassword}\n        keepLoggedIn={keepLoggedIn}\n        error={error}\n        setEmail={setEmail}\n        setPassword={setPassword}\n        setShow={setShow}\n        setKeep={setKeep}\n        handleSubmit={handleSubmit}\n      />\n    </AuthRedirect>\n  );\n}"
    },
    {
      "path": "src/app/(auth)/signup/metadata.ts",
      "lang": "ts",
      "size": 168,
      "lines": 6,
      "hash": "a9a26464ac658df7a4219bdae35deeab70426b2f40b5394b2dd5fbb887c9c567",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar - SIMLOK\",\n  description: \"Halaman pendaftaran akun baru untuk sistem SIMLOK\",\n};"
    },
    {
      "path": "src/app/(auth)/signup/page.tsx",
      "lang": "tsx",
      "size": 3923,
      "lines": 136,
      "hash": "252f7e951c6f4e834d1bbe296ed3b13cc050de6db218b27c80db0b279a069a23",
      "truncated": false,
      "content": "// src/app/(auth)/signup/page.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport AuthRedirect from \"@/components/auth/AuthRedirect\";\nimport SignUpForm from \"@/components/auth/SignUpForm\";\nimport { getCsrfToken } from \"next-auth/react\";\n\nexport default function SignupPage() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [nama_petugas, setNamaPetugas] = useState(\"\");\n  const [nama_vendor, setNamaVendor] = useState(\"\");\n  const [alamat, setAlamat] = useState(\"\");\n  const [no_telp, setNoTelp] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [agreed, setAgreed] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const router = useRouter();\n\n  const validateForm = () => {\n    if (!nama_petugas.trim()) {\n      setError(\"Nama petugas harus diisi\");\n      return false;\n    }\n    if (!email.trim()) {\n      setError(\"Email harus diisi\");\n      return false;\n    }\n    if (!no_telp.trim()) {\n      setError(\"Nomor telepon harus diisi\");\n      return false;\n    }\n    if (!alamat.trim()) {\n      setError(\"Alamat harus diisi\");\n      return false;\n    }\n    if (!nama_vendor.trim()) {\n      setError(\"Nama vendor harus diisi\");\n      return false;\n    }\n    if (password.length < 8) {\n      setError(\"Password minimal 8 karakter\");\n      return false;\n    }\n    if (password !== confirmPassword) {\n      setError(\"Password dan konfirmasi password tidak sama\");\n      return false;\n    }\n    if (!agreed) {\n      setError(\"Anda harus menyetujui syarat dan ketentuan\");\n      return false;\n    }\n    return true;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const csrf = await getCsrfToken();\n      \n      const res = await fetch(\"/api/auth/signup\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          csrfToken: csrf,\n          officer_name: nama_petugas.trim(),\n          email: email.trim().toLowerCase(),\n          password,\n          vendor_name: nama_vendor.trim(),\n          address: alamat.trim(),\n          phone_number: no_telp.trim(),\n        }),\n      });\n\n      const data = await res.json();\n      \n      if (!res.ok) {\n        setError(data.error || \"Terjadi kesalahan saat mendaftar\");\n      } else {\n        // Registration successful - redirect to verification pending page\n        router.push(\"/verification-pending\");\n      }\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      setError(\"Terjadi kesalahan jaringan. Silakan coba lagi.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthRedirect>\n      <SignUpForm\n        email={email}\n        password={password}\n        confirmPassword={confirmPassword}\n        nama_petugas={nama_petugas}\n        nama_vendor={nama_vendor}\n        alamat={alamat}\n        no_telp={no_telp}\n        showPassword={showPassword}\n        showConfirmPassword={showConfirmPassword}\n        agreeToTerms={agreed}\n        error={error}\n        isLoading={isLoading}\n        setEmail={setEmail}\n        setPassword={setPassword}\n        setConfirmPassword={setConfirmPassword}\n        setNamaPetugas={setNamaPetugas}\n        setNamaVendor={setNamaVendor}\n        setAlamat={setAlamat}\n        setNoTelp={setNoTelp}\n        setShowPassword={setShowPassword}\n        setShowConfirmPassword={setShowConfirmPassword}\n        setAgree={setAgreed}\n        handleSubmit={handleSubmit}\n      />\n    </AuthRedirect>\n  );\n}"
    },
    {
      "path": "src/app/(auth)/verification-pending/page.tsx",
      "lang": "tsx",
      "size": 12198,
      "lines": 318,
      "hash": "3f6cbdeb3fc04a50be2d714b0b9fc7a79d988a7d4434dddf61e04ba0fddaec80",
      "truncated": false,
      "content": "'use client';\n\nimport { useSession, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport { \n  ClockIcon, \n  ExclamationTriangleIcon, \n  UserIcon,\n  CheckCircleIcon,\n  ArrowRightIcon,\n  ShieldCheckIcon\n} from '@heroicons/react/24/outline';\n\nexport default function VerificationPendingPage() {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n  const [countdown, setCountdown] = useState(15);\n  const [autoRedirect, setAutoRedirect] = useState(true);\n\n  // Auto redirect to login after 15 seconds if not logged in\n  useEffect(() => {\n    if (status === 'unauthenticated' && autoRedirect && countdown > 0) {\n      const timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    } else if (status === 'unauthenticated' && autoRedirect && countdown === 0) {\n      router.push(\"/login\");\n    }\n    return undefined;\n  }, [countdown, autoRedirect, router, status]);\n\n  useEffect(() => {\n    // Redirect jika user sudah terverifikasi\n    if (session?.user?.verified_at) {\n      const role = session.user.role;\n      if (role === \"ADMIN\") {\n        router.push(\"/admin\");\n      } else if (role === \"VENDOR\") {\n        router.push(\"/vendor\");\n      } else if (role === \"VERIFIER\") {\n        router.push(\"/verifier\");\n      } else {\n        router.push('/dashboard');\n      }\n    }\n  }, [session, router]);\n\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const formatTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString('id-ID', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleLogout = async () => {\n    await signOut({ callbackUrl: '/login' });\n  };\n\n  const handleStopAutoRedirect = () => {\n    setAutoRedirect(false);\n  };\n\n  // If user is not logged in (just registered), show simplified version\n  if (status === 'unauthenticated') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md\">\n          <Card className=\"p-8 text-center shadow-xl\">\n            <div className=\"mb-6\">\n              <div className=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-4\">\n                <ClockIcon className=\"w-8 h-8 text-orange-600\" />\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Pendaftaran Berhasil!\n              </h1>\n              <p className=\"text-gray-600\">\n                Akun vendor Anda telah berhasil dibuat\n              </p>\n            </div>\n\n            <div className=\"space-y-6\">\n              {/* Status Steps */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center text-left bg-green-50 p-4 rounded-lg\">\n                  <CheckCircleIcon className=\"w-6 h-6 text-green-500 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-green-800\">Pendaftaran Selesai</p>\n                    <p className=\"text-sm text-green-600\">Data vendor telah tersimpan</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center text-left bg-orange-50 p-4 rounded-lg\">\n                  <ClockIcon className=\"w-6 h-6 text-orange-500 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-orange-800\">Menunggu Verifikasi</p>\n                    <p className=\"text-sm text-orange-600\">Admin sedang meninjau akun Anda</p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center text-left bg-gray-50 p-4 rounded-lg\">\n                  <ShieldCheckIcon className=\"w-6 h-6 text-gray-400 flex-shrink-0 mr-3\" />\n                  <div>\n                    <p className=\"font-medium text-gray-500\">Akun Aktif</p>\n                    <p className=\"text-sm text-gray-400\">Setelah verifikasi selesai</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Information Box */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start\">\n                  <ExclamationTriangleIcon className=\"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5 mr-3\" />\n                  <div className=\"text-left\">\n                    <h3 className=\"font-medium text-blue-900 mb-2\">Langkah Selanjutnya:</h3>\n                    <ul className=\"text-sm text-blue-800 space-y-1\">\n                      <li>• Admin akan meninjau data pendaftaran Anda</li>\n                      <li>• Proses verifikasi membutuhkan waktu 1-2 hari kerja</li>\n                      <li>• Anda akan menerima notifikasi setelah akun diverifikasi</li>\n                      <li>• Setelah diverifikasi, Anda dapat mengakses dashboard vendor</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"space-y-3\">\n                <Button\n                  onClick={() => router.push(\"/login\")}\n                  className=\"w-full\" \n                  size=\"md\"\n                >\n                  <ArrowRightIcon className=\"w-4 h-4 mr-2\" />\n                  Lanjut ke Halaman Login\n                </Button>\n                \n                {autoRedirect && (\n                  <button\n                    onClick={handleStopAutoRedirect}\n                    className=\"text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n                  >\n                    Auto redirect dalam {countdown} detik\n                    <br />\n                    <span className=\"underline\">Klik untuk membatalkan</span>\n                  </button>\n                )}\n              </div>\n\n              {/* Contact Information */}\n              <div className=\"pt-4 border-t border-gray-200\">\n                <p className=\"text-xs text-gray-500 mb-2\">\n                  Butuh bantuan?\n                </p>\n                <p className=\"text-xs text-gray-600\">\n                  Hubungi admin di{\" \"}\n                  <a href=\"mailto:admin@simlok.com\" className=\"text-blue-600 hover:text-blue-700\">\n                    admin@simlok.com\n                  </a>\n                  <br />\n                  atau telepon{\" \"}\n                  <a href=\"tel:+6281234567890\" className=\"text-blue-600 hover:text-blue-700\">\n                    +62 812-3456-7890\n                  </a>\n                </p>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // If user is logged in but not verified, show detailed version\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-lg\">\n        <Card className=\"p-8\">\n          {/* Icon and Status */}\n          <div className=\"flex flex-col items-center mb-8\">\n            <div className=\"w-20 h-20 bg-warning-100 rounded-full flex items-center justify-center mb-6\">\n              <ClockIcon className=\"w-10 h-10 text-warning-500\" />\n            </div>\n            \n            {/* Title */}\n            <h1 className=\"text-2xl font-semibold text-gray-900 mb-3 text-center\">\n              Menunggu Verifikasi\n            </h1>\n            \n            {/* Subtitle */}\n            <p className=\"text-gray-600 text-center mb-6\">\n              Akun Anda sedang dalam proses verifikasi oleh administrator\n            </p>\n          </div>\n\n          {/* User Info Card */}\n          <Card className=\"bg-gray-50 p-6 mb-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                <UserIcon className=\"w-6 h-6 text-brand-500\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-medium text-gray-900 mb-2\">\n                  Informasi Akun\n                </h3>\n                <div className=\"space-y-2 text-sm text-gray-600\">\n                  <div className=\"flex justify-between\">\n                    <span>Email:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.email}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Nama:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.officer_name || session?.user?.name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Vendor:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.vendor_name || 'N/A'}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Role:</span>\n                    <span className=\"font-medium text-gray-900 capitalize\">\n                      {session?.user?.role?.toLowerCase()}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Tanggal Daftar:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.created_at ? \n                        formatDate(session.user.created_at.toString()) : \n                        'N/A'\n                      }\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Waktu:</span>\n                    <span className=\"font-medium text-gray-900\">\n                      {session?.user?.created_at ? \n                        formatTime(session.user.created_at.toString()) : \n                        'N/A'\n                      }\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          {/* Info Alert */}\n          <div className=\"flex gap-3 p-4 bg-blue-light-50 border border-blue-light-200 rounded-xl mb-8\">\n            <ExclamationTriangleIcon className=\"w-5 h-5 text-blue-light-500 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm\">\n              <p className=\"text-blue-light-800 font-medium mb-1\">\n                Proses Verifikasi\n              </p>\n              <p className=\"text-blue-light-700\">\n                Administrator akan memverifikasi akun Anda dalam waktu 1-2 hari kerja. \n                Anda akan menerima notifikasi email setelah akun diverifikasi.\n              </p>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex flex-col gap-3\">\n            <Button \n              onClick={handleLogout}\n              variant=\"primary\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              Keluar\n            </Button>\n            \n            <Button \n              onClick={() => window.location.reload()}\n              variant=\"outline\"\n              size=\"md\"\n              className=\"w-full\"\n            >\n              Refresh Status\n            </Button>\n          </div>\n\n          {/* Footer Info */}\n          <div className=\"mt-8 pt-6 border-t border-gray-200\">\n            <p className=\"text-xs text-gray-500 text-center\">\n              Butuh bantuan? Hubungi administrator melalui email atau sistem support.\n            </p>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/admin/page.tsx",
      "lang": "tsx",
      "size": 608,
      "lines": 19,
      "hash": "49d425e44adfe105edc992bccfc3c85d02ab822fecee1366c41f7ea3914c0b99",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport AdminDashboard from \"@/components/dashboard/AdminDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Admin - SIMLOK\",\n  description: \"Halaman dashboard untuk administrator mengelola sistem dan pengguna\",\n};\n\nexport default function AdminPage() {\n  return (\n    <RoleGate allowedRoles={[\"ADMIN\"]}>\n      <SidebarLayout title=\"Admin Panel\" titlePage=\"Dashboard\">\n        <AdminDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/admin/submissions/page.tsx",
      "lang": "tsx",
      "size": 758,
      "lines": 27,
      "hash": "9194654fae79e4654a681f40fe793f5182585b3634f3874f38b68dd2266ce3bc",
      "truncated": false,
      "content": "import { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport SubmissionsManagement from '@/components/admin/SubmissionsManagement';\n\nexport default async function AdminSubmissionsPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'ADMIN') {\n    redirect('/');\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"ADMIN\"]}>\n      <SidebarLayout title=\"Admin Panel\" titlePage=\"Kelola Pengajuan\">\n        <SubmissionsManagement />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/admin/users/page.tsx",
      "lang": "tsx",
      "size": 5001,
      "lines": 157,
      "hash": "659629a50fb5864d29fafafc9d7be584600304bf9119c12e459353f42c1c2b4e",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { Role } from \"@prisma/client\";\nimport { redirect } from \"next/navigation\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport UsersTable from \"@/components/admin/UsersTable\";\nimport UserModal from \"@/components/admin/UserModal\";\nimport DeleteModal from \"@/components/admin/DeleteModal\";\nimport UserVerificationModal from \"@/components/admin/UserVerificationModal\";\nimport { UserData } from \"@/types/user\";\n\nexport default function ManageUsersPage() {\n  const { data: session, status } = useSession();\n  \n  // State untuk modals\n  const [isUserModalOpen, setIsUserModalOpen] = useState(false);\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\n  const [isVerificationModalOpen, setIsVerificationModalOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<UserData | null>(null);\n  const [modalMode, setModalMode] = useState<\"add\" | \"edit\">(\"add\");\n  \n  // State untuk refresh tabel\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  // Loading state\n  if (status === \"loading\") {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500\"></div>\n      </div>\n    );\n  }\n\n  // Redirect if not authenticated or not admin\n  if (!session || session.user.role !== Role.ADMIN) {\n    redirect(\"/login\");\n  }\n\n  const handleAddUser = () => {\n    setSelectedUser(null);\n    setModalMode(\"add\");\n    setIsUserModalOpen(true);\n  };\n\n  const handleEditUser = (user: UserData) => {\n    setSelectedUser(user);\n    setModalMode(\"edit\");\n    setIsUserModalOpen(true);\n  };\n\n  const handleDeleteUser = (user: UserData) => {\n    setSelectedUser(user);\n    setIsDeleteModalOpen(true);\n  };\n\n  const handleViewUser = (user: UserData) => {\n    setSelectedUser(user);\n    setIsVerificationModalOpen(true);\n  };\n\n  const handleModalClose = () => {\n    setIsUserModalOpen(false);\n    setIsDeleteModalOpen(false);\n    setIsVerificationModalOpen(false);\n    setSelectedUser(null);\n  };\n\n  const handleSaveSuccess = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleDeleteSuccess = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleUserUpdate = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleUserRemove = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  return (\n    <RoleGate allowedRoles={[\"ADMIN\"]}>\n      <SidebarLayout title=\"Admin Panel\" titlePage=\"Manajemen User\">\n        <div className=\"space-y-6\">\n          {/* Header Section */}\n          <div className=\"bg-white shadow-sm rounded-xl border border-gray-200/70\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h1 className=\"text-xl font-semibold text-gray-900\">\n                    Manajemen User\n                  </h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    Kelola dan verifikasi user dalam sistem\n                  </p>\n                </div>\n                <button\n                  onClick={handleAddUser}\n                  className=\"inline-flex items-center px-4 py-2 bg-brand-600 text-white text-sm font-medium rounded-lg hover:bg-brand-700 transition-colors\"\n                >\n                  <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                  </svg>\n                  Tambah User\n                </button>\n              </div>\n            </div>\n\n            {/* Table Section */}\n            <div className=\"p-6\">\n              <UsersTable\n                onEdit={handleEditUser}\n                onDelete={handleDeleteUser}\n                onView={handleViewUser}\n                onAdd={handleAddUser}\n                refreshTrigger={refreshTrigger}\n              />\n            </div>\n          </div>\n\n          {/* User Modal (Add/Edit) */}\n          <UserModal\n            isOpen={isUserModalOpen}\n            onClose={handleModalClose}\n            onSave={handleSaveSuccess}\n            user={selectedUser}\n            mode={modalMode}\n          />\n\n          {/* User Verification Modal */}\n          <UserVerificationModal\n            isOpen={isVerificationModalOpen}\n            onClose={handleModalClose}\n            user={selectedUser}\n            onUserUpdate={handleUserUpdate}\n            onUserRemove={handleUserRemove}\n          />\n\n          {/* Delete Modal */}\n          <DeleteModal\n            isOpen={isDeleteModalOpen}\n            onClose={handleModalClose}\n            onConfirm={handleDeleteSuccess}\n            user={selectedUser}\n          />\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/approver/page.tsx",
      "lang": "tsx",
      "size": 668,
      "lines": 19,
      "hash": "577d8f1a200b8947b7f7b9ac66a577cc34a7e9a370b8d17002f74a6807e6ef6e",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverDashboard from \"@/components/approver/ApproverDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Approver - SIMLOK\",\n  description: \"Halaman dashboard untuk approver mengelola persetujuan pengajuan Simlok\",\n};\n\nexport default function ApproverPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Dashboard Persetujuan\">\n        <ApproverDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/approver/scan-history/page.tsx",
      "lang": "tsx",
      "size": 679,
      "lines": 19,
      "hash": "a2981ba5c84845ec44c3b41630ff50907fbd477bb660f35d00eb446c89cc4460",
      "truncated": false,
      "content": "import { Metadata } from 'next';\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverScanHistoryContent from '@/components/approver/ApproverScanHistoryContent';\n\nexport const metadata: Metadata = {\n  title: 'Scan History - Approver Dashboard',\n  description: 'Monitor submission scan activities by verifiers',\n};\n\nexport default function ApproverScanHistoryPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Scan History\">\n        <ApproverScanHistoryContent />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/approver/submissions/page.tsx",
      "lang": "tsx",
      "size": 708,
      "lines": 19,
      "hash": "58babe0d271729946e8050b2fed4ad5c7123efa65769235848998ff809367508",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ApproverSubmissionsManagement from \"@/components/approver/ApproverSubmissionsManagement\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - Approver SIMLOK\",\n  description: \"Halaman untuk approver melihat dan menyetujui pengajuan Simlok\",\n};\n\nexport default function ApproverSubmissionsPage() {\n  return (\n    <RoleGate allowedRoles={[\"APPROVER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Approver Panel\" titlePage=\"Daftar Pengajuan\">\n        <ApproverSubmissionsManagement />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/dashboard/notifications/page.tsx",
      "lang": "tsx",
      "size": 29163,
      "lines": 766,
      "hash": "bebddb71e4224d0ddae1ba2be25b842d1ef57247561bd3a9e25cb31d7b8f210f",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport RoleGate from '@/components/security/RoleGate';\nimport { \n  BellIcon, \n  CheckIcon,\n  CheckCircleIcon,\n  ClockIcon,\n  DocumentPlusIcon,\n  UserPlusIcon,\n  ShieldCheckIcon,\n  MagnifyingGlassIcon,\n  InboxIcon,\n  XMarkIcon,\n  ArrowRightIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport AdminSubmissionDetailModal from '@/components/admin/AdminSubmissionDetailModal';\nimport SubmissionDetailModal from '@/components/vendor/SubmissionDetailModal';\nimport UserVerificationModal from '@/components/admin/UserVerificationModal';\nimport { UserData } from '@/types/user';\n\n// Interface untuk notification\ninterface Notification {\n  id: string;\n  type: string;\n  title: string;\n  message: string;\n  data?: any;\n  isRead: boolean;\n  createdAt: string;\n  scope: string;\n  vendorId?: string;\n}\n\n// Interface untuk submission (dari AdminSubmissionDetailModal)\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  implementation_notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approved_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\nexport default function NotificationsPage() {\n  const { data: session, status } = useSession();\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [selectedVendorUser, setSelectedVendorUser] = useState<UserData | null>(null);\n  const [filter, setFilter] = useState<'all' | 'unread' | 'read'>('all');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  // Fetch notifications based on user role\n  useEffect(() => {\n    const fetchNotifications = async () => {\n      if (!session?.user?.id) return;\n      \n      setLoading(true);\n      try {\n        const scope = session.user.role === 'ADMIN' ? 'admin' : 'vendor';\n        const response = await fetch(`/api/v1/notifications?scope=${scope}&limit=50`);\n        \n        if (response.ok) {\n          const data = await response.json();\n          console.log('📋 Notifications API v1 response:', data);\n          console.log('📅 First notification createdAt:', data.data?.data?.[0]?.createdAt);\n          // API v1 returns nested structure: {success: true, data: {data: [...], pagination: {...}}}\n          setNotifications(data.data?.data || []);\n        }\n      } catch (error) {\n        console.error('Error fetching notifications:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (status === 'authenticated') {\n      fetchNotifications();\n    }\n  }, [session?.user?.id, session?.user?.role, status]);\n\n  // Safely calculate unread count\n  const unreadCount = Array.isArray(notifications) ? notifications.filter(n => !n.isRead).length : 0;\n\n  const markAsRead = async (notificationId: string) => {\n    try {\n      const response = await fetch(`/api/v1/notifications/${notificationId}/read`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (response.ok) {\n        setNotifications(prev => prev.map(notification => \n          notification.id === notificationId ? { ...notification, isRead: true } : notification\n        ));\n      }\n    } catch (error) {\n      console.error('Error marking notification as read:', error);\n    }\n  };\n\n  const markAllAsRead = async () => {\n    try {\n      const scope = session?.user?.role === 'ADMIN' ? 'admin' : 'vendor';\n      const response = await fetch('/api/v1/notifications/read-all', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ scope }),\n      });\n\n      if (response.ok) {\n        setNotifications(prev => prev.map(notification => ({ ...notification, isRead: true })));\n      }\n    } catch (error) {\n      console.error('Error marking all notifications as read:', error);\n    }\n  };\n\n    const formatTimeAgo = (dateString: string): string => {\n    if (!dateString) {\n      return 'Tidak diketahui';\n    }\n\n    const date = new Date(dateString);\n    if (isNaN(date.getTime())) {\n      return 'Tanggal tidak valid';\n    }\n\n    const now = new Date();\n    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n    if (diffInSeconds < 60) {\n      return 'Baru saja';\n    } else if (diffInSeconds < 3600) {\n      const minutes = Math.floor(diffInSeconds / 60);\n      return `${minutes} menit yang lalu`;\n    } else if (diffInSeconds < 86400) {\n      const hours = Math.floor(diffInSeconds / 3600);\n      return `${hours} jam yang lalu`;\n    } else if (diffInSeconds < 604800) {\n      const days = Math.floor(diffInSeconds / 86400);\n      return `${days} hari yang lalu`;\n    } else {\n      return date.toLocaleDateString('id-ID', {\n        day: 'numeric',\n        month: 'long',\n        year: 'numeric'\n      });\n    }\n  };\n\n  const getNotificationIcon = (type: string) => {\n    const iconClass = \"w-5 h-5\";\n    switch (type) {\n      case 'submission_approved':\n        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'submission_rejected':\n        return <XMarkIcon className={`${iconClass} text-red-600`} />;\n      case 'submission_pending':\n        return <ClockIcon className={`${iconClass} text-amber-600`} />;\n      case 'status_change':\n        return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_submission':\n        return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_vendor':\n        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'vendor_verified':\n        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'user_registered':\n        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      default:\n        return <BellIcon className={`${iconClass} text-gray-600`} />;\n    }\n  };\n\n  const hasSubmissionData = (notification: Notification) => {\n    // Cek berdasarkan type notification\n    const submissionTypes = [\n      'submission_approved', \n      'submission_rejected', \n      'submission_pending',\n      'new_submission',\n      'status_change'\n    ];\n    \n    if (submissionTypes.includes(notification.type)) {\n      return true;\n    }\n    \n    // Cek di dalam data\n    if (notification.data) {\n      let parsedData;\n      if (typeof notification.data === 'string') {\n        try {\n          parsedData = JSON.parse(notification.data);\n        } catch {\n          return notification.data.includes('submissionId');\n        }\n      } else {\n        parsedData = notification.data;\n      }\n      \n      if (parsedData && parsedData.submissionId) {\n        return true;\n      }\n    }\n    \n    // Cek di message atau title\n    const submissionKeywords = ['pengajuan', 'submission', 'simlok'];\n    const text = `${notification.title} ${notification.message}`.toLowerCase();\n    \n    return submissionKeywords.some(keyword => text.includes(keyword));\n  };\n\n  const hasVendorData = (notification: Notification) => {\n    console.log('🔍 Checking hasVendorData for:', notification);\n    \n    // Cek berdasarkan type notification\n    const vendorTypes = [\n      'new_vendor',\n      'vendor_verified',\n      'vendor_registered'\n    ];\n    \n    if (vendorTypes.includes(notification.type)) {\n      console.log('✅ Found vendor type:', notification.type);\n      return true;\n    }\n    \n    // Cek di dalam data\n    if (notification.data) {\n      let parsedData;\n      if (typeof notification.data === 'string') {\n        try {\n          parsedData = JSON.parse(notification.data);\n          console.log('📊 Parsed vendor data:', parsedData);\n        } catch {\n          const hasVendorId = notification.data.includes('vendorId');\n          console.log('🔤 String contains vendorId:', hasVendorId);\n          return hasVendorId;\n        }\n      } else {\n        parsedData = notification.data;\n        console.log('📊 Direct vendor data:', parsedData);\n      }\n      \n      if (parsedData && parsedData.vendorId) {\n        console.log('🎯 Found vendorId in data:', parsedData.vendorId);\n        return true;\n      }\n    }\n    \n    // Cek di message atau title\n    const vendorKeywords = ['vendor', 'perusahaan', 'pendaftaran vendor'];\n    const text = `${notification.title} ${notification.message}`.toLowerCase();\n    const hasKeyword = vendorKeywords.some(keyword => text.includes(keyword));\n    \n    console.log('🔍 Text search result:', hasKeyword, 'for text:', text);\n    \n    return hasKeyword;\n  };\n\n  const handleViewDetail = async (notification: Notification) => {\n    console.log('🔍 handleViewDetail called with notification:', notification);\n    console.log('🔍 notification.type:', notification.type);\n    console.log('🔍 notification.data:', notification.data);\n    \n    // Mark as read when viewing\n    if (!notification.isRead) {\n      await markAsRead(notification.id);\n    }\n\n    // Check if it's a vendor notification\n    const isVendorNotification = hasVendorData(notification);\n    console.log('👤 Is vendor notification:', isVendorNotification);\n    \n    if (isVendorNotification) {\n      console.log('📋 Processing vendor notification.data:', notification.data);\n      \n      let vendorId = '';\n      \n      // Parse vendor ID from notification data\n      if (notification.data) {\n        let parsedData;\n        if (typeof notification.data === 'string') {\n          try {\n            parsedData = JSON.parse(notification.data);\n            console.log('✅ Parsed vendor data:', parsedData);\n          } catch {\n            // Jika tidak bisa parse JSON, coba extract dari string\n            const match = notification.data.match(/vendorId[:\\s]*([a-zA-Z0-9_-]+)/);\n            if (match && match[1]) vendorId = match[1];\n            console.log('🔤 String match result for vendor:', match);\n          }\n        } else {\n          parsedData = notification.data;\n          console.log('📊 Direct vendor data:', parsedData);\n        }\n        \n        if (parsedData && parsedData.vendorId) {\n          vendorId = parsedData.vendorId;\n          console.log('🎯 Found vendorId in parsedData:', vendorId);\n        }\n      }\n\n      if (vendorId) {\n        // Fetch vendor user data\n        try {\n          const response = await fetch(`/api/admin/users/${vendorId}`);\n          \n          if (!response.ok) {\n            throw new Error('Failed to fetch vendor details');\n          }\n          \n          const data = await response.json();\n          console.log('✅ Vendor user data fetched:', data);\n          \n          setSelectedVendorUser(data.user);\n          \n          console.log('🚀 Opening user verification modal for vendorId:', vendorId);\n        } catch (err) {\n          console.error('❌ Error fetching vendor details:', err);\n          alert('Gagal memuat detail vendor');\n        }\n      } else {\n        console.warn('⚠️ No vendor ID found in notification');\n      }\n      return;\n    }\n\n    // Handle submission notifications\n    if (!hasSubmissionData(notification)) {\n      console.log('❌ No submission data found');\n      return;\n    }\n    \n    try {\n      // Extract submission ID from notification data\n      let submissionId = '';\n      \n      console.log('📋 Processing submission notification.data:', notification.data);\n      \n      // Parse dari data JSON jika ada\n      if (notification.data) {\n        let parsedData;\n        if (typeof notification.data === 'string') {\n          try {\n            parsedData = JSON.parse(notification.data);\n            console.log('✅ Parsed submission data:', parsedData);\n          } catch {\n            // Jika tidak bisa parse JSON, coba extract dari string\n            const match = notification.data.match(/submissionId[:\\s]*([a-zA-Z0-9_-]+)/);\n            if (match && match[1]) submissionId = match[1];\n            console.log('🔤 String match result for submission:', match);\n          }\n        } else {\n          parsedData = notification.data;\n          console.log('📊 Direct submission data:', parsedData);\n        }\n        \n        if (parsedData && parsedData.submissionId) {\n          submissionId = parsedData.submissionId;\n          console.log('🎯 Found submissionId in parsedData:', submissionId);\n        }\n      }\n      \n      // Jika belum ketemu, coba extract dari message atau title\n      if (!submissionId) {\n        console.log('🔍 Trying to extract from message/title...');\n        const patterns = [\n          /ID[:\\s]*([a-zA-Z0-9_-]+)/,\n          /submission[:\\s]*([a-zA-Z0-9_-]+)/i,\n          /pengajuan[:\\s]*([a-zA-Z0-9_-]+)/i,\n          /([a-zA-Z0-9_-]{20,})/  // Pattern untuk ID yang panjang\n        ];\n        \n        for (const pattern of patterns) {\n          const messageMatch = notification.message.match(pattern);\n          const titleMatch = notification.title.match(pattern);\n          \n          console.log(`🔎 Pattern ${pattern} - Message match:`, messageMatch, 'Title match:', titleMatch);\n          \n          if (messageMatch && messageMatch[1]) {\n            submissionId = messageMatch[1];\n            console.log('✅ Found in message:', submissionId);\n            break;\n          }\n          if (titleMatch && titleMatch[1]) {\n            submissionId = titleMatch[1];\n            console.log('✅ Found in title:', submissionId);\n            break;\n          }\n        }\n      }\n\n      console.log('🔑 Final submission ID:', submissionId);\n\n      if (submissionId) {\n        console.log('🌐 Fetching submission details...');\n        // Fetch submission details\n        const response = await fetch(`/api/submissions/${submissionId}`);\n        if (response.ok) {\n          const submission = await response.json();\n          console.log('✅ Submission loaded:', submission);\n          setSelectedSubmission(submission);\n        } else {\n          console.error('❌ Failed to fetch submission:', response.statusText);\n          alert('Gagal memuat detail submission');\n        }\n      } else {\n        console.warn('⚠️ No submission ID found in notification');\n        alert('ID submission tidak ditemukan dalam notifikasi ini');\n      }\n    } catch (error) {\n      console.error('💥 Error handling notification detail:', error);\n      alert('Terjadi kesalahan saat memuat detail');\n    }\n  };\n\n  // Add truncate function\n  const truncateText = (text: string, maxLength: number = 100) => {\n    return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n  };\n\n  // Handle vendor user updates\n  const handleUserUpdate = (updatedUser: UserData) => {\n    setSelectedVendorUser(updatedUser);\n  };\n\n  // Handle vendor user removal\n  const handleUserRemove = () => {\n    setSelectedVendorUser(null);\n  };\n\n  // Filter notifications\n  const filteredNotifications = Array.isArray(notifications) ? notifications\n    .filter((notification: Notification) => {\n      if (filter === 'unread') return !notification.isRead;\n      if (filter === 'read') return notification.isRead;\n      return true;\n    })\n    .filter((notification: Notification) => {\n      if (!searchTerm) return true;\n      return notification.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n             notification.message.toLowerCase().includes(searchTerm.toLowerCase());\n    }) : [];\n\n  if (status === 'loading') {\n    return (\n      <SidebarLayout title=\"Notifikasi\" titlePage=\"Memuat...\">\n        <div className=\"max-w-5xl mx-auto px-3 md:px-6\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          </div>\n        </div>\n      </SidebarLayout>\n    );\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"ADMIN\", \"VENDOR\"]}>\n      <SidebarLayout title=\"Notifikasi\" titlePage=\"Semua Notifikasi\">\n        <div className=\"max-w-5xl mx-auto space-y-4 md:space-y-6 px-3 md:px-6\">\n          \n          {/* Header */}\n          <div className=\"flex items-center justify-between rounded-xl border bg-white p-3 md:p-4 shadow-sm\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"relative\">\n                <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <BellIcon className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                {unreadCount > 0 && (\n                  <div className=\"absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5\">\n                    {unreadCount > 99 ? '99+' : unreadCount}\n                  </div>\n                )}\n              </div>\n              <div>\n                <h1 className=\"text-base md:text-lg font-semibold text-gray-900\">\n                  {session?.user?.role === 'ADMIN' ? 'Notifikasi' : 'Notifikasi'}\n                </h1>\n                <p className=\"text-sm text-gray-500\">\n                  {loading ? 'Memuat...' : unreadCount > 0 ? `${unreadCount} belum dibaca` : 'Semua sudah dibaca'}\n                </p>\n              </div>\n            </div>\n            \n            {unreadCount > 0 && !loading && (\n              <Button\n                onClick={markAllAsRead}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"flex items-center space-x-2 hover:bg-blue-50 hover:border-blue-300 transition-colors\"\n                aria-label=\"Tandai semua notifikasi sebagai dibaca\"\n              >\n                <CheckIcon className=\"w-4 h-4\" />\n                <span className=\"hidden sm:inline\">Tandai semua dibaca</span>\n                <span className=\"sm:hidden\">Tandai semua</span>\n              </Button>\n            )}\n          </div>\n\n          {/* Toolbar */}\n          <div className=\"rounded-xl border bg-white p-3 md:p-4 shadow-sm\">\n            <div className=\"grid grid-cols-1 md:grid-cols-12 gap-3\">\n              {/* Search */}\n              <div className=\"md:col-span-7\">\n                <div className=\"relative\">\n                  <MagnifyingGlassIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                  <input\n                    type=\"text\"\n                    placeholder=\"Cari notifikasi…\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900 placeholder:text-gray-500\"\n                    aria-label=\"Cari notifikasi\"\n                  />\n                </div>\n              </div>\n\n              {/* Filters */}\n              <div className=\"md:col-span-5 flex gap-2 md:justify-end\">\n                {/* Read State Filter */}\n                <div className=\"flex rounded-lg border border-gray-300 bg-white p-1\">\n                  {(['all', 'unread', 'read'] as const).map((filterOption) => (\n                    <button\n                      key={filterOption}\n                      onClick={() => setFilter(filterOption)}\n                      className={`px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${\n                        filter === filterOption\n                          ? 'bg-blue-100 text-blue-700'\n                          : 'text-gray-600 hover:text-gray-900:text-gray-200'\n                      }`}\n                    >\n                      {filterOption === 'all' && 'Semua'}\n                      {filterOption === 'unread' && 'Belum Dibaca'}\n                      {filterOption === 'read' && 'Sudah Dibaca'}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Notifications List */}\n          <div className=\"rounded-xl border bg-white shadow-sm overflow-hidden\">\n            {filteredNotifications.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-16 px-6\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                  <InboxIcon className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  {searchTerm ? 'Tidak ada hasil' : 'Tidak ada notifikasi'}\n                </h3>\n                <p className=\"text-sm text-gray-500 text-center max-w-sm\">\n                  {searchTerm \n                    ? `Tidak ditemukan notifikasi yang cocok dengan \"${searchTerm}\"`\n                    : 'Anda akan melihat notifikasi baru di sini ketika ada aktivitas'\n                  }\n                </p>\n                {!searchTerm && (\n                  <Button\n                    onClick={() => window.location.href = '/dashboard'}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"mt-4\"\n                  >\n                    Kembali ke Dashboard\n                  </Button>\n                )}\n              </div>\n            ) : (\n              <div className=\"divide-y divide-gray-100\">\n                {filteredNotifications.map((notification: any) => {\n                  const isUnread = !notification.isRead;\n                  const fullTimestamp = new Date(notification.createdAt).toLocaleString('id-ID');\n                  \n                  return (\n                    <div\n                      key={notification.id}\n                      className={`relative flex items-start gap-3 p-3 md:p-4 transition-all duration-200 hover:bg-gray-50:bg-gray-800/50 focus-within:ring-2 focus-within:ring-blue-500/30 ${\n                        isUnread \n                          ? 'bg-blue-50/50 border-l-2 border-blue-500/50' \n                          : ''\n                      } ${\n                        hasSubmissionData(notification) || hasVendorData(notification) ? 'cursor-pointer' : ''\n                      }`}\n                      onClick={() => {\n                        console.log('🖱️ Notification clicked:', notification);\n                        console.log('📋 hasSubmissionData:', hasSubmissionData(notification));\n                        console.log('👤 hasVendorData:', hasVendorData(notification));\n                        \n                        if (hasSubmissionData(notification) || hasVendorData(notification)) {\n                          handleViewDetail(notification);\n                        } else {\n                          console.log('❌ No action taken - neither submission nor vendor data found');\n                        }\n                      }}\n                      role=\"listitem\"\n                    >\n                      {/* Unread indicator dot */}\n                      {isUnread && (\n                        <div className=\"absolute left-2 top-2.5 h-2 w-2 rounded-full bg-blue-600\"></div>\n                      )}\n\n                      {/* Icon */}\n                      <div className=\"shrink-0 h-9 w-9 rounded-full bg-gray-100 flex items-center justify-center ml-2\">\n                        {getNotificationIcon(notification.type)}\n                      </div>\n\n                      {/* Content */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1 min-w-0\">\n                            <h3 \n                              className={`text-sm md:text-base leading-tight ${\n                                isUnread \n                                  ? 'font-semibold text-gray-900' \n                                  : 'font-medium text-gray-800'\n                              }`}\n                              style={{ \n                                display: '-webkit-box',\n                                WebkitLineClamp: 2,\n                                WebkitBoxOrient: 'vertical',\n                                overflow: 'hidden'\n                              }}\n                            >\n                              {truncateText(notification.title, 80)}\n                            </h3>\n                            <p \n                              className=\"mt-0.5 text-xs md:text-sm text-gray-600 leading-relaxed\"\n                              style={{ \n                                display: '-webkit-box',\n                                WebkitLineClamp: 2,\n                                WebkitBoxOrient: 'vertical',\n                                overflow: 'hidden'\n                              }}\n                            >\n                              {truncateText(notification.message, 120)}\n                            </p>\n                          </div>\n                          \n                          <span \n                            className=\"text-[11px] md:text-xs text-gray-500 whitespace-nowrap ml-3\"\n                            title={fullTimestamp}\n                          >\n                            {formatTimeAgo(notification.createdAt)}\n                          </span>\n                        </div>\n\n                        {/* Actions */}\n                        {(hasSubmissionData(notification) || hasVendorData(notification)) && (\n                          <div className=\"mt-3 pt-3 border-t border-gray-100 flex items-center justify-between\">\n                            <button className=\"inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors\">\n                              {hasVendorData(notification) ? 'Lihat detail' : 'Lihat detail'}\n                              <ArrowRightIcon className=\"w-3 h-3 ml-1\" />\n                            </button>\n                            \n                            {isUnread && (\n                              <button\n                                onClick={async (e) => {\n                                  e.preventDefault();\n                                  e.stopPropagation();\n                                  await markAsRead(notification.id);\n                                }}\n                                className=\"inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50:bg-blue-900/20 transition-colors\"\n                                aria-label=\"Tandai sebagai dibaca\"\n                              >\n                                <CheckIcon className=\"w-3 h-3\" />\n                                <span className=\"ml-1 hidden sm:inline\">Tandai dibaca</span>\n                              </button>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n\n            {/* Footer */}\n            {filteredNotifications.length > 0 && (\n              <div className=\"flex items-center justify-between text-sm text-gray-500 p-3 border-t border-gray-100 bg-gray-50/50\">\n                <span>\n                  Menampilkan {filteredNotifications.length} dari {Array.isArray(notifications) ? notifications.length : 0} notifikasi\n                </span>\n                {/* Future: Load more functionality */}\n              </div>\n            )}\n          </div>\n        </div>\n\n      {/* Modals */}\n      {selectedSubmission && session?.user?.role === 'ADMIN' && (\n        <AdminSubmissionDetailModal\n          submission={selectedSubmission}\n          isOpen={!!selectedSubmission}\n          onClose={() => setSelectedSubmission(null)}\n        />\n      )}\n\n      {selectedSubmission && session?.user?.role === 'VENDOR' && (\n        <SubmissionDetailModal\n          submission={selectedSubmission}\n          isOpen={!!selectedSubmission}\n          onClose={() => setSelectedSubmission(null)}\n        />\n      )}\n\n      {/* User Verification Modal */}\n      {selectedVendorUser && (\n        <UserVerificationModal\n          isOpen={!!selectedVendorUser}\n          onClose={() => setSelectedVendorUser(null)}\n          user={selectedVendorUser}\n          onUserUpdate={handleUserUpdate}\n          onUserRemove={handleUserRemove}\n        />\n      )}\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/dashboard/page.tsx",
      "lang": "tsx",
      "size": 769,
      "lines": 28,
      "hash": "319805a54bd288170b57bf04e8423ebdaa4c5ee267f7ba8d2834b940a707f3d1",
      "truncated": false,
      "content": "import { redirect } from \"next/navigation\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport default async function DashboardPage() {\n  const session = await getServerSession(authOptions);\n  if (!session) redirect(\"/login\");\n\n  const { role } = session.user;\n\n  // Redirect to appropriate role-specific dashboard\n  if (role === \"SUPER_ADMIN\") {\n    redirect(\"/super-admin\");\n  } else if (role === \"ADMIN\") {\n    redirect(\"/admin\");\n  } else if (role === \"APPROVER\") {\n    redirect(\"/approver\");\n  } else if (role === \"REVIEWER\") {\n    redirect(\"/reviewer\");\n  } else if (role === \"VENDOR\") {\n    redirect(\"/vendor\");\n  } else if (role === \"VERIFIER\") {\n    redirect(\"/verifier\");\n  }\n\n  // Fallback\n  redirect(\"/login\");\n}"
    },
    {
      "path": "src/app/(dashboard)/files/page.tsx",
      "lang": "tsx",
      "size": 2237,
      "lines": 67,
      "hash": "ab3218f66cff829ae8908df2b763f9ac5689bf387c7c2651abfa0a23036134a6",
      "truncated": false,
      "content": "'use client';\n\nimport { useState } from 'react';\nimport FileManager from '@/components/files/FileManager';\nimport FileUpload from '@/components/form/FileUpload';\nimport Card from '@/components/ui/Card';\nimport { DocumentPlusIcon } from '@heroicons/react/24/outline';\n\nexport default function FilesPage() {\n  const [_uploadingCategory, setUploadingCategory] = useState<string>('');\n\n  const handleFileUpload = (category: string) => (url: string) => {\n    console.log(`File uploaded to ${category}:`, url);\n    // You can add notification here\n    setUploadingCategory('');\n    // Refresh the file manager (you might need to pass a refresh function)\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-6xl mx-auto px-4\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            Manajemen File\n          </h1>\n          <p className=\"text-gray-600\">\n            Kelola file dokumen Anda dengan struktur folder yang terorganisir\n          </p>\n        </div>\n\n        {/* Quick Upload Section */}\n        <Card className=\"p-6 mb-8\">\n          <div className=\"flex items-center space-x-3 mb-4\">\n            <DocumentPlusIcon className=\"h-6 w-6 text-blue-500\" />\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Upload File Baru\n            </h2>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <FileUpload\n              name=\"upload_doc_sika\"\n              label=\"Upload Dokumen SIKA\"\n              description=\"File akan disimpan di folder 'dokumen-sika'\"\n              onChange={handleFileUpload('sika')}\n              accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n              maxSize={8}\n            />\n            \n            <FileUpload\n              name=\"upload_doc_simja\"\n              label=\"Upload Dokumen SIMJA\"\n              description=\"File akan disimpan di folder 'dokumen-simja'\"\n              onChange={handleFileUpload('simja')}\n              accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n              maxSize={8}\n            />\n          </div>\n        </Card>\n\n        {/* File Manager */}\n        <FileManager />\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/profile/page.tsx",
      "lang": "tsx",
      "size": 1167,
      "lines": 44,
      "hash": "8df01f9044b021b7564bbd308416c9986e32eb9c376d90cdf387fc7a8829430b",
      "truncated": false,
      "content": "import UserInfoCard from \"@/components/user-profile/UserInfoCard\";\nimport ChangePasswordCard from \"@/components/user-profile/ChangePasswordCard\";\nimport { Metadata } from \"next\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/prisma\";\nimport { redirect } from \"next/navigation\";\n\nexport const metadata: Metadata = {\n  title: \"Ubah Profil - SIMLOK\",\n  description: \"Edit your profile information\",\n};\n\nexport default async function Profile() {\n  const session = await getServerSession(authOptions);\n  \n  if (!session) {\n    redirect('/login');\n  }\n\n  // Fetch complete user data\n  const user = await prisma.user.findUnique({\n    where: {\n      id: session.user.id\n    }\n  });\n\n  if (!user) {\n    redirect('/login');\n  }\n\n  return (\n    <SidebarLayout title=\"SIMLOK\" titlePage=\"Ubah Profil\">\n      <div className=\"rounded-2xl border border-gray-200 bg-white p-5 lg:p-6\">\n        <div className=\"space-y-6\">\n          <UserInfoCard user={user} />\n          <ChangePasswordCard />\n        </div>\n      </div>\n    </SidebarLayout>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/reviewer/page.tsx",
      "lang": "tsx",
      "size": 658,
      "lines": 19,
      "hash": "ec28d45dc18af2d5d8b41f92c15acc5610cf4f6950bc28897ad3127397368db4",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerDashboard from \"@/components/reviewer/ReviewerDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Reviewer - SIMLOK\",\n  description: \"Halaman dashboard untuk reviewer mengelola review pengajuan Simlok\",\n};\n\nexport default function ReviewerPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Dashboard Review\">\n        <ReviewerDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/reviewer/scan-history/page.tsx",
      "lang": "tsx",
      "size": 679,
      "lines": 19,
      "hash": "d634f2f5c9eb7abaa806bf9fb096d456573d554621529d050e8eaccc785917f8",
      "truncated": false,
      "content": "import { Metadata } from 'next';\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerScanHistoryContent from '@/components/reviewer/ReviewerScanHistoryContent';\n\nexport const metadata: Metadata = {\n  title: 'Scan History - Reviewer Dashboard',\n  description: 'Monitor submission scan activities by verifiers',\n};\n\nexport default function ReviewerScanHistoryPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Scan History\">\n        <ReviewerScanHistoryContent />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/reviewer/submissions/page.tsx",
      "lang": "tsx",
      "size": 707,
      "lines": 19,
      "hash": "35ee21d094e852b228d421f5d59ff46f6885385f55d6c39c65c0c8f87a907a94",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport ReviewerSubmissionsManagement from \"@/components/reviewer/ReviewerSubmissionsManagement\";\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - Reviewer SIMLOK\",\n  description: \"Halaman untuk reviewer melihat dan mengelola pengajuan Simlok\",\n};\n\nexport default function ReviewerSubmissionsPage() {\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Daftar Pengajuan\">\n        <ReviewerSubmissionsManagement />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/reviewer/users/page.tsx",
      "lang": "tsx",
      "size": 2047,
      "lines": 59,
      "hash": "ea0760768dc3efa5ce07700f232e973d888f44121066275cf7447d758f824f5c",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { Role } from \"@prisma/client\";\nimport { redirect } from \"next/navigation\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport UserVerificationManagement from \"@/components/reviewer/UserVerificationManagement\";\n\nexport default function UserVerificationPage() {\n  const { data: session, status } = useSession();\n  \n  // State untuk refresh tabel\n  const [refreshTrigger] = useState(0);\n\n  // Loading state\n  if (status === \"loading\") {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500\"></div>\n      </div>\n    );\n  }\n\n  // Redirect if not authenticated or not authorized\n  if (!session || ![\"REVIEWER\", \"ADMIN\", \"SUPER_ADMIN\"].includes(session.user.role as Role)) {\n    redirect(\"/login\");\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"REVIEWER\", \"ADMIN\", \"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Reviewer Panel\" titlePage=\"Verifikasi User\">\n        <div className=\"space-y-6\">\n          {/* Header Section */}\n          <div className=\"bg-white shadow-sm rounded-xl border border-gray-200/70\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h1 className=\"text-xl font-semibold text-gray-900\">\n                    Verifikasi User\n                  </h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    Kelola dan verifikasi user vendor dalam sistem\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* User Verification Management Component */}\n            <div className=\"p-6\">\n              <UserVerificationManagement refreshTrigger={refreshTrigger} />\n            </div>\n          </div>\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/super-admin/page.tsx",
      "lang": "tsx",
      "size": 12224,
      "lines": 267,
      "hash": "2ff4724d720924c8a4cf0d2877878fc9068ee54cbb66c1db0e9893dfc9b4ed56",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport Link from \"next/link\";\nimport { UserData } from \"@/types/user\";\nimport { UserIcon, CheckCircleIcon, ClockIcon } from \"@heroicons/react/24/outline\";\n\nexport default function SuperAdminDashboard() {\n  const [stats, setStats] = useState({\n    totalUsers: 0,\n    pendingVerifications: 0,\n    recentUsers: [] as UserData[]\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n\n  useEffect(() => {\n    async function fetchDashboardStats() {\n      try {\n        setLoading(true);\n        const response = await fetch('/api/admin/dashboard-stats');\n        if (!response.ok) {\n          throw new Error('Failed to fetch dashboard statistics');\n        }\n        const data = await response.json();\n        setStats({\n          totalUsers: data.totalUsers,\n          pendingVerifications: data.pendingVerifications,\n          recentUsers: data.recentUsers\n        });\n      } catch (err) {\n        console.error('Error fetching dashboard stats:', err);\n        setError('Gagal memuat statistik dashboard');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchDashboardStats();\n  }, []);\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <RoleGate allowedRoles={[\"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Super Admin Panel\" titlePage=\"Dashboard\">\n        <div className=\"space-y-6\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">\n              Selamat Datang di Super Admin Dashboard\n            </h1>\n            <p className=\"text-gray-600 mt-2\">\n              Kelola seluruh user sistem SIMLOK dengan fitur CRUD lengkap.\n            </p>\n          </div>\n          \n          {/* Statistik Dashboard */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 rounded-full bg-blue-100 mr-4\">\n                  <UserIcon className=\"h-6 w-6 text-blue-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Total User</p>\n                  {loading ? (\n                    <div className=\"h-6 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-gray-900\">{stats.totalUsers}</p>\n                  )}\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 rounded-full bg-green-100 mr-4\">\n                  <CheckCircleIcon className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">User Terverifikasi</p>\n                  {loading ? (\n                    <div className=\"h-6 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-gray-900\">{stats.totalUsers - stats.pendingVerifications}</p>\n                  )}\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"bg-white rounded-xl shadow-sm p-6 border border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"p-3 rounded-full bg-yellow-100 mr-4\">\n                  <ClockIcon className=\"h-6 w-6 text-yellow-600\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Menunggu Verifikasi</p>\n                  {loading ? (\n                    <div className=\"h-6 w-16 bg-gray-200 animate-pulse rounded mt-1\"></div>\n                  ) : (\n                    <p className=\"text-2xl font-bold text-gray-900\">{stats.pendingVerifications}</p>\n                  )}\n                </div>\n              </div>\n              {stats.pendingVerifications > 0 && (\n                <div className=\"mt-4\">\n                  <Link\n                    href=\"/super-admin/users?tab=pending\"\n                    className=\"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center\"\n                  >\n                    Verifikasi sekarang\n                    <svg className=\"ml-1 w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                    </svg>\n                  </Link>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* Tabel User Terbaru */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n              <h2 className=\"text-lg font-semibold text-gray-900\">User Terbaru</h2>\n              <p className=\"text-sm text-gray-600\">Daftar 5 user yang baru mendaftar</p>\n            </div>\n            \n            {loading ? (\n              <div className=\"p-6 space-y-4\">\n                {[...Array(5)].map((_, index) => (\n                  <div key={index} className=\"flex items-center space-x-4\">\n                    <div className=\"h-10 w-10 rounded-full bg-gray-200 animate-pulse\"></div>\n                    <div className=\"space-y-2 flex-1\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse w-1/4\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : error ? (\n              <div className=\"p-6 text-center text-red-500\">{error}</div>\n            ) : stats.recentUsers.length === 0 ? (\n              <div className=\"p-6 text-center text-gray-500\">Tidak ada user terbaru</div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Nama</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Email</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Role</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Tanggal Daftar</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Aksi</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {stats.recentUsers.map((user) => (\n                      <tr key={user.id}>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                          {user.vendor_name && (\n                            <div className=\"text-sm text-gray-500\">{user.vendor_name}</div>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {user.email}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className={`px-2 py-1 text-xs font-medium rounded-full ${\n                            user.role === 'ADMIN' ? 'bg-purple-100 text-purple-800' :\n                            user.role === 'VENDOR' ? 'bg-blue-100 text-blue-800' :\n                            user.role === 'VERIFIER' ? 'bg-green-100 text-green-800' : \n                            'bg-gray-100 text-gray-800'\n                          }`}>\n                            {user.role}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {formatDate(user.created_at)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          {user.verified_at ? (\n                            <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">\n                              Terverifikasi\n                            </span>\n                          ) : (\n                            <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800\">\n                              Menunggu\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                          <Link\n                            href={`/super-admin/users?view=${user.id}`}\n                            className=\"text-blue-600 hover:text-blue-900\"\n                          >\n                            Detail\n                          </Link>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n            \n            <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50\">\n              <Link\n                href=\"/super-admin/users\"\n                className=\"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center\"\n              >\n                Lihat semua user\n                <svg className=\"ml-1 w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                </svg>\n              </Link>\n            </div>\n          </div>\n          \n          {/* Card untuk akses cepat ke fitur */}\n          <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Link \n              href=\"/super-admin/users\" \n              className=\"bg-white border border-gray-200 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow\"\n            >\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Manajemen User</h2>\n              <p className=\"text-gray-600 mb-4\">\n                Kelola semua pengguna sistem SIMLOK\n              </p>\n              <ul className=\"list-disc ml-5 text-gray-600 mb-4\">\n                <li>Menambah user baru dengan berbagai role</li>\n                <li>Mengedit informasi user yang sudah ada</li>\n                <li>Menghapus user yang tidak diperlukan</li>\n              </ul>\n            </Link>\n\n            <Link \n              href=\"/super-admin/users?tab=pending\" \n              className=\"bg-white border border-gray-200 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow\"\n            >\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Approval Vendor Baru</h2>\n              <p className=\"text-gray-600 mb-4\">\n                Verifikasi pendaftaran vendor baru\n              </p>\n              <ul className=\"list-disc ml-5 text-gray-600 mb-4\">\n                <li>Melihat detail vendor yang mendaftar</li>\n                <li>Menyetujui pendaftaran yang valid</li>\n                <li>Menolak pendaftaran yang tidak sesuai</li>\n              </ul>\n            </Link>\n          </div>\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/super-admin/users/page.tsx",
      "lang": "tsx",
      "size": 7349,
      "lines": 212,
      "hash": "5322451828c2887a333573629bf9525920c3cdbb88f27da6da78f3f0141b40f4",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { Role } from \"@prisma/client\";\nimport { redirect } from \"next/navigation\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport UsersTable from \"@/components/admin/UsersTable\";\nimport UserModal from \"@/components/admin/UserModal\";\nimport DeleteModal from \"@/components/admin/DeleteModal\";\nimport UserVerificationModal from \"@/components/admin/UserVerificationModal\";\nimport { UserData } from \"@/types/user\";\n\nexport default function ManageUsersPage() {\n  const { data: session, status } = useSession();\n  \n  // State untuk modals\n  const [isUserModalOpen, setIsUserModalOpen] = useState(false);\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\n  const [isVerificationModalOpen, setIsVerificationModalOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<UserData | null>(null);\n  const [modalMode, setModalMode] = useState<\"add\" | \"edit\">(\"add\");\n  \n  // State untuk tab dan filter\n  const [activeTab, setActiveTab] = useState<\"all\" | \"pending\">(\"all\");\n  \n  // Effect untuk mengambil tab dari URL\n  useEffect(() => {\n    const searchParams = new URLSearchParams(window.location.search);\n    const tabParam = searchParams.get('tab');\n    if (tabParam === 'pending') {\n      setActiveTab('pending');\n    }\n  }, []);\n  \n  // State untuk refresh tabel\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  // Loading state\n  if (status === \"loading\") {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500\"></div>\n      </div>\n    );\n  }\n\n  // Redirect if not authenticated or not super admin\n  if (!session || session.user.role !== Role.SUPER_ADMIN) {\n    redirect(\"/login\");\n  }\n\n  const handleAddUser = () => {\n    setSelectedUser(null);\n    setModalMode(\"add\");\n    setIsUserModalOpen(true);\n  };\n\n  const handleEditUser = (user: UserData) => {\n    setSelectedUser(user);\n    setModalMode(\"edit\");\n    setIsUserModalOpen(true);\n  };\n\n  const handleDeleteUser = (user: UserData) => {\n    setSelectedUser(user);\n    setIsDeleteModalOpen(true);\n  };\n\n  const handleViewUser = (user: UserData) => {\n    setSelectedUser(user);\n    setIsVerificationModalOpen(true);\n  };\n\n  const handleModalClose = () => {\n    setIsUserModalOpen(false);\n    setIsDeleteModalOpen(false);\n    setIsVerificationModalOpen(false);\n    setSelectedUser(null);\n  };\n\n  const handleSaveSuccess = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleDeleteSuccess = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleUserUpdate = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleUserRemove = () => {\n    setRefreshTrigger(prev => prev + 1);\n  };\n\n  const handleTabChange = (tab: \"all\" | \"pending\") => {\n    setActiveTab(tab);\n    // Update URL with tab parameter without reloading the page\n    const url = new URL(window.location.href);\n    if (tab === \"all\") {\n      url.searchParams.delete(\"tab\");\n    } else {\n      url.searchParams.set(\"tab\", tab);\n    }\n    window.history.pushState({}, \"\", url.toString());\n  };\n\n  return (\n    <RoleGate allowedRoles={[\"SUPER_ADMIN\"]}>\n      <SidebarLayout title=\"Super Admin Panel\" titlePage=\"Manajemen User\">\n        <div className=\"space-y-6\">\n          {/* Header Section */}\n          <div className=\"bg-white shadow-sm rounded-xl border border-gray-200/70\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h1 className=\"text-xl font-semibold text-gray-900\">\n                    Manajemen User\n                  </h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">\n                    Kelola dan verifikasi user dalam sistem\n                  </p>\n                </div>\n                <button\n                  onClick={handleAddUser}\n                  className=\"inline-flex items-center px-4 py-2 bg-brand-600 text-white text-sm font-medium rounded-lg hover:bg-brand-700 transition-colors\"\n                >\n                  <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                  </svg>\n                  Tambah User\n                </button>\n              </div>\n            </div>\n\n            {/* Table Section */}\n            <div className=\"p-6\">\n              {/* Tabs Navigation */}\n              <div className=\"border-b border-gray-200 mb-6\">\n                <nav className=\"-mb-px flex space-x-8\">\n                  <button\n                    onClick={() => handleTabChange(\"all\")}\n                    className={`${\n                      activeTab === \"all\"\n                        ? \"border-brand-500 text-brand-600\"\n                        : \"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\"\n                    } whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm`}\n                  >\n                    Semua User\n                  </button>\n                  <button\n                    onClick={() => handleTabChange(\"pending\")}\n                    className={`${\n                      activeTab === \"pending\"\n                        ? \"border-brand-500 text-brand-600\"\n                        : \"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300\"\n                    } whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm flex items-center`}\n                  >\n                    Vendor Menunggu Verifikasi\n                    <span className=\"ml-2 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full px-2.5 py-0.5\">\n                      Butuh Persetujuan\n                    </span>\n                  </button>\n                </nav>\n              </div>\n              \n              <UsersTable\n                onEdit={handleEditUser}\n                onDelete={handleDeleteUser}\n                onView={handleViewUser}\n                onAdd={handleAddUser}\n                refreshTrigger={refreshTrigger}\n                filterByVerification={activeTab === \"pending\" ? true : null}\n                filterByRole={activeTab === \"pending\" ? Role.VENDOR : null}\n              />\n            </div>\n          </div>\n\n          {/* User Modal (Add/Edit) */}\n          <UserModal\n            isOpen={isUserModalOpen}\n            onClose={handleModalClose}\n            onSave={handleSaveSuccess}\n            user={selectedUser}\n            mode={modalMode}\n          />\n\n          {/* User Verification Modal */}\n          <UserVerificationModal\n            isOpen={isVerificationModalOpen}\n            onClose={handleModalClose}\n            user={selectedUser}\n            onUserUpdate={handleUserUpdate}\n            onUserRemove={handleUserRemove}\n          />\n\n          {/* Delete Modal */}\n          <DeleteModal\n            isOpen={isDeleteModalOpen}\n            onClose={handleModalClose}\n            onConfirm={handleDeleteSuccess}\n            user={selectedUser}\n          />\n        </div>\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/vendor/page.tsx",
      "lang": "tsx",
      "size": 759,
      "lines": 22,
      "hash": "5a0d764e55b45b864e17618d885e2b17c32bee193a00fffdfa1aa52b036de6e2",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport VendorDashboard from \"@/components/dashboard/VendorDashboard\";\nimport VerificationGuard from \"@/components/security/VerificationGuard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Vendor - SIMLOK\",\n  description: \"Halaman dashboard untuk vendor mengelola pengajuan dan melihat status pengajuan\",\n};\n\nexport default function VendorPage() {\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Dashboard\">\n          <VendorDashboard />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/vendor/submissions/create/page.tsx",
      "lang": "tsx",
      "size": 1006,
      "lines": 35,
      "hash": "edfb38d3bed2145a1f79f9d02145dd9c2cbf6f4707da3ad4370b3302e7f6f7ea",
      "truncated": false,
      "content": "import { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport SubmissionForm from '@/components/submissions/SubmissionForm';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport VerificationGuard from '@/components/security/VerificationGuard';\n\nexport default async function CreateSubmissionPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/');\n  }\n\n  // Check verification status on server side\n  if (!session.user.verified_at) {\n    redirect('/verification-pending');\n  }\n\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Buat Pengajuan Baru\">\n          <SubmissionForm />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/vendor/submissions/edit/[id]/page.tsx",
      "lang": "tsx",
      "size": 934,
      "lines": 37,
      "hash": "6b6c6e1f7b48a28d6de6161d5cb0f45997d19736838758afccc8d78b248b4913",
      "truncated": false,
      "content": "import { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport EditSubmissionForm from '../../../../../../components/vendor/EditSubmissionForm';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\n\ninterface EditSubmissionPageProps {\n  params: Promise<{\n    id: string;\n  }>;\n}\n\nexport default async function EditSubmissionPage({ params }: EditSubmissionPageProps) {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/admin');\n  }\n\n  // Await params as required by Next.js 15\n  const { id } = await params;\n\n  return (\n    <SidebarLayout title=\"Vendor Panel\" titlePage=\"Ubah Pengajuan SIMLOK\">\n      <div className=\"space-y-6\">\n      \n        \n        <EditSubmissionForm submissionId={id} />\n      </div>\n    </SidebarLayout>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/vendor/submissions/page.tsx",
      "lang": "tsx",
      "size": 1218,
      "lines": 41,
      "hash": "39a12e4a5cec30e8987706497d5d340784ef7f5c9ed1b0132a9606bc9a7d2f4a",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport { getServerSession } from 'next-auth';\nimport { redirect } from 'next/navigation';\nimport { authOptions } from '@/lib/auth';\nimport RoleGate from '@/components/security/RoleGate';\n\nexport const metadata: Metadata = {\n  title: \"Daftar Pengajuan - SIMLOK\",\n  description: \"Halaman untuk melihat dan mengelola daftar pengajuan vendor\",\n};\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport VendorSubmissionsContent from '@/components/vendor/VendorSubmissionsContent';\nimport VerificationGuard from '@/components/security/VerificationGuard';\n\nexport default async function VendorSubmissionsPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session?.user) {\n    redirect('/login');\n  }\n\n  if (session.user.role !== 'VENDOR') {\n    redirect('/');\n  }\n\n  // Check verification status on server side\n  if (!session.user.verified_at) {\n    redirect('/verification-pending');\n  }\n\n  return (\n    <VerificationGuard>\n      <RoleGate allowedRoles={[\"VENDOR\"]}>\n        <SidebarLayout title=\"Vendor Panel\" titlePage=\"Daftar Pengajuan\">\n          <VendorSubmissionsContent />\n        </SidebarLayout>\n      </RoleGate>\n    </VerificationGuard>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/verifier/page.tsx",
      "lang": "tsx",
      "size": 638,
      "lines": 19,
      "hash": "4844f3509b7f08a690f00479fc6f7290949384d68cc141f8171f17653ae3e17f",
      "truncated": false,
      "content": "import { Metadata } from \"next\";\nimport RoleGate from \"@/components/security/RoleGate\";\nimport SidebarLayout from \"@/components/layout/SidebarLayout\";\nimport VerifierDashboard from \"@/components/dashboard/VerifierDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Dashboard Verifikator - SIMLOK\",\n  description: \"Halaman dashboard untuk verifikator mengelola dan memverifikasi pengajuan\",\n};\n\nexport default function VerifierPage() {\n  return (\n    <RoleGate allowedRoles={[\"VERIFIER\"]}>\n      <SidebarLayout title=\"Verifier Panel\" titlePage=\"Dashboard\">\n        <VerifierDashboard />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}"
    },
    {
      "path": "src/app/(dashboard)/verifier/submissions/[id]/page.tsx",
      "lang": "tsx",
      "size": 1538,
      "lines": 61,
      "hash": "d032f69de102b8683db427767ec1995ef0291dc09291c04fad2e20abd7fa3e0d",
      "truncated": false,
      "content": "import { Metadata } from 'next';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { redirect, notFound } from 'next/navigation';\nimport { db } from '@/lib/db';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport SubmissionDetail from '@/components/verifier/SubmissionDetail';\n\ninterface Props {\n  params: Promise<{ id: string }>;\n}\n\nexport async function generateMetadata({ params }: Props): Promise<Metadata> {\n  const { id } = await params;\n  return {\n    title: `Detail SIMLOK - ${id}`,\n    description: 'Detail submission SIMLOK untuk verifier',\n  };\n}\n\nexport default async function VerifierSubmissionDetailPage({ params }: Props) {\n  const session = await getServerSession(authOptions);\n\n  if (!session) {\n    redirect('/auth/signin');\n  }\n\n  if (session.user.role !== 'VERIFIER') {\n    redirect('/dashboard');\n  }\n\n  const { id } = await params;\n\n  // Fetch submission data\n  const submission = await db.submission.findUnique({\n    where: { id: id },\n    include: {\n      worker_list: {\n        select: {\n          id: true,\n          worker_name: true,\n          worker_photo: true\n        }\n      }\n    }\n  });\n\n  if (!submission) {\n    notFound();\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"VERIFIER\"]}>\n      <SidebarLayout title={`SIMLOK ${submission.simlok_number || submission.id}`} titlePage=\"Detail\">\n        <SubmissionDetail submission={submission} />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/(dashboard)/verifier/submissions/page.tsx",
      "lang": "tsx",
      "size": 929,
      "lines": 33,
      "hash": "6e71051055ece28f23b3b622451bc22c42b6140435caf3f3bcd33dff8847dee9",
      "truncated": false,
      "content": "import { Metadata } from 'next';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { redirect } from 'next/navigation';\nimport RoleGate from '@/components/security/RoleGate';\nimport SidebarLayout from '@/components/layout/SidebarLayout';\nimport SubmissionsList from '@/components/verifier/SubmissionsList';\n\nexport const metadata: Metadata = {\n  title: 'Daftar SIMLOK - Verifier',\n  description: 'Daftar semua submission SIMLOK untuk verifier',\n};\n\nexport default async function VerifierSubmissionsPage() {\n  const session = await getServerSession(authOptions);\n\n  if (!session) {\n    redirect('/auth/signin');\n  }\n\n  if (session.user.role !== 'VERIFIER') {\n    redirect('/dashboard');\n  }\n\n  return (\n    <RoleGate allowedRoles={[\"VERIFIER\"]}>\n      <SidebarLayout title=\"Daftar SIMLOK\" titlePage=\"Verifier\">\n        <SubmissionsList />\n      </SidebarLayout>\n    </RoleGate>\n  );\n}\n"
    },
    {
      "path": "src/app/api/admin/cleanup-notifications/route.ts",
      "lang": "ts",
      "size": 1386,
      "lines": 48,
      "hash": "ffa20c86dae8c0c287d5ce5c3ec2ff60b583ad34b1800677195ff4ba54ee6e02",
      "truncated": false,
      "content": "/**\n * POST /api/admin/cleanup-notifications\n * Admin endpoint to clean up orphaned notifications\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { cleanupOrphanedNotifications } from '@/lib/notificationCleanup';\n\nexport async function POST(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only admin can run cleanup\n    if (session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Access denied. Admin role required.' }, { status: 403 });\n    }\n\n    console.log(`Admin ${session.user.id} initiated notification cleanup`);\n\n    const cleanedCount = await cleanupOrphanedNotifications();\n\n    return NextResponse.json({\n      message: 'Notification cleanup completed successfully',\n      result: {\n        notificationsCleaned: cleanedCount\n      }\n    });\n\n  } catch (error) {\n    console.error('Error in notification cleanup:', error);\n    return NextResponse.json({ \n      error: 'Internal server error during cleanup' \n    }, { status: 500 });\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({ \n    error: 'Method not allowed. Use POST to run cleanup.' \n  }, { status: 405 });\n}\n"
    },
    {
      "path": "src/app/api/admin/dashboard/recent-submissions/route.ts",
      "lang": "ts",
      "size": 1174,
      "lines": 43,
      "hash": "aa944c44d182742514f731b63e6116a1648a8a7e24e4ccfb30a63f9a97d14883",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get recent submissions (latest 10)\n    const submissions = await prisma.submission.findMany({\n      take: 10,\n      orderBy: { created_at: 'desc' },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true\n          }\n        }\n      }\n    });\n\n    return NextResponse.json({ submissions });\n  } catch (error) {\n    console.error('Error fetching recent submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/dashboard/stats/route.ts",
      "lang": "ts",
      "size": 1751,
      "lines": 54,
      "hash": "bb50503c2cd7c797be8057fc33822bec9dd28708e97934fd81df535dd22d4096",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get admin statistics\n    const [\n      totalSubmissions,\n      pendingSubmissions,\n      approvedSubmissions,\n      rejectedSubmissions,\n      totalUsers,\n      pendingUsers,\n      totalVendors,\n      totalVerifiers\n    ] = await Promise.all([\n      prisma.submission.count(),\n      prisma.submission.count({ where: { approval_status: 'PENDING' } }),\n      prisma.submission.count({ where: { approval_status: 'APPROVED' } }),\n      prisma.submission.count({ where: { approval_status: 'REJECTED' } }),\n      prisma.user.count({ where: { role: { in: ['VENDOR', 'VERIFIER'] } } }),\n      prisma.user.count({ where: { role: 'VENDOR', verified_at: null } }),\n      prisma.user.count({ where: { role: 'VENDOR' } }),\n      prisma.user.count({ where: { role: 'VERIFIER' } })\n    ]);\n\n    const stats = {\n      totalSubmissions,\n      pendingSubmissions,\n      approvedSubmissions,\n      rejectedSubmissions,\n      totalUsers,\n      pendingUsers,\n      totalVendors,\n      totalVerifiers,\n      pendingVerificationVendors: pendingUsers,\n      pendingVerificationSubmissions: pendingSubmissions\n    };\n\n    return NextResponse.json(stats);\n  } catch (error) {\n    console.error('Error fetching admin stats:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/dashboard-stats/route.ts",
      "lang": "ts",
      "size": 2507,
      "lines": 92,
      "hash": "a2970772ce73a08707e096bb8d1415d60d87cd40f6078d65eacbcdfea3f46ae9",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || (session.user.role !== \"ADMIN\" && session.user.role !== \"SUPER_ADMIN\")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Data untuk admin\n    if (session.user.role === \"ADMIN\") {\n      // Get total vendors (users with VENDOR role)\n      const totalVendors = await prisma.user.count({\n        where: {\n          role: \"VENDOR\"\n        }\n      });\n\n      // Get pending verification vendors (VENDOR role users without verified_at)\n      const pendingVerificationVendors = await prisma.user.count({\n        where: {\n          role: \"VENDOR\",\n          verified_at: null\n        }\n      });\n\n      // Get pending verification submissions (submissions with PENDING status)\n      const pendingVerificationSubmissions = await prisma.submission.count({\n        where: {\n          approval_status: \"PENDING\"\n        }\n      });\n\n      return NextResponse.json({\n        totalVendors,\n        pendingVerificationVendors,\n        pendingVerificationSubmissions\n      });\n    }\n    \n    // Data untuk super admin\n    if (session.user.role === \"SUPER_ADMIN\") {\n      // Dapatkan total user\n      const totalUsers = await prisma.user.count();\n\n      // Dapatkan jumlah user yang belum diverifikasi\n      const pendingVerifications = await prisma.user.count({\n        where: {\n          verified_at: null,\n        },\n      });\n\n      // Dapatkan 5 user terbaru\n      const recentUsers = await prisma.user.findMany({\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          role: true,\n          vendor_name: true,\n          created_at: true,\n          verified_at: true,\n        },\n        orderBy: {\n          created_at: \"desc\",\n        },\n        take: 5,\n      });\n\n      return NextResponse.json({\n        totalUsers,\n        pendingVerifications,\n        recentUsers,\n      });\n    }\n    \n    // Fallback jika tidak masuk ke salah satu condition di atas\n    return NextResponse.json({ error: \"Invalid role configuration\" }, { status: 400 });\n\n  } catch (error) {\n    console.error(\"Dashboard stats error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/latest-submissions/route.ts",
      "lang": "ts",
      "size": 987,
      "lines": 41,
      "hash": "31550c976b19c15aa9e47d62aa7ca61ffd6e760271dd944324339ec825a15ecd",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"ADMIN\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Get latest 5 submissions\n    const submissions = await prisma.submission.findMany({\n      select: {\n        id: true,\n        vendor_name: true,\n        job_description: true,\n        approval_status: true,\n        created_at: true\n      },\n      orderBy: {\n        created_at: \"desc\"\n      },\n      take: 5\n    });\n\n    return NextResponse.json({\n      submissions\n    });\n\n  } catch (error) {\n    console.error(\"Latest submissions error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/pending-vendors/route.ts",
      "lang": "ts",
      "size": 1191,
      "lines": 50,
      "hash": "398576f2ae47db20bf1ff4481b0aaf9a6696a27d8841545e1355fc94a4b443bf",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"ADMIN\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Get pending vendors (VENDOR role users without verified_at)\n    const vendors = await prisma.user.findMany({\n      where: {\n        role: \"VENDOR\",\n        verified_at: null\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        created_at: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        verified_at: true,\n        verified_by: true\n      },\n      orderBy: {\n        created_at: \"desc\"\n      },\n      take: 5\n    });\n\n    return NextResponse.json({\n      vendors\n    });\n\n  } catch (error) {\n    console.error(\"Pending vendors error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/simloks/[id]/workers/route.ts",
      "lang": "ts",
      "size": 1433,
      "lines": 55,
      "hash": "c361bc147699f9f5eb714a4e0f174d0c9cbdd00470223a5bdef56d45f762192e",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only ADMIN or SUPER_ADMIN can access this endpoint\n    if (!['ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    // Check if submission exists\n    const submission = await prisma.submission.findUnique({\n      where: { id: id }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers for admin:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/admin/submissions/export/route.ts",
      "lang": "ts",
      "size": 4584,
      "lines": 146,
      "hash": "b30a4f334cbbdc92328c40e1938dc6eb06822141f8dec2ccd42e4dcfd3486ce1",
      "truncated": false,
      "content": "import { NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    // Check if user is admin\n    if (session.user.role !== 'ADMIN') {\n      return NextResponse.json(\n        { error: 'Forbidden - Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Fetch all submissions with related data\n    const submissions = await prisma.submission.findMany({\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            vendor_name: true,\n            email: true,\n            phone_number: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      },\n      orderBy: {\n        created_at: 'desc'\n      }\n    });\n\n    // Transform data for export\n    const exportData = submissions.map(submission => ({\n      // Submission Info\n      id: submission.id,\n      nomorSurat: submission.based_on,\n      perihal: submission.job_description,\n      tujuan: submission.work_location,\n      tempatPelaksanaan: submission.work_location,\n      tanggalMulai: submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '',\n      tanggalSelesai: submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '',\n      statusApproval: submission.approval_status,\n      \n      // User Info\n      vendorName: submission.user.officer_name,\n      vendorCompany: submission.user.vendor_name || '',\n      vendorEmail: submission.user.email,\n      vendorPhone: submission.user.phone_number || '',\n      \n      // Submission dates\n      submittedAt: new Date(submission.created_at).toLocaleDateString('id-ID'),\n      approvedAt: '', // No approvedAt field in current schema\n      \n      // Workers count\n      totalWorkers: submission.worker_list.length,\n      \n      // Workers data (simplified structure)\n      daftarPekerja: submission.worker_list.map(worker => ({\n        id: worker.id,\n        namaLengkap: worker.worker_name,\n        foto: worker.worker_photo || '',\n        // Other fields not available in current schema\n        nik: '',\n        tempatLahir: '',\n        tanggalLahir: '',\n        jenisKelamin: '',\n        agama: '',\n        statusPerkawinan: '',\n        alamat: '',\n        noTelepon: '',\n        email: '',\n        pendidikanTerakhir: '',\n        jabatan: '',\n        pengalaman: '',\n        keahlianKhusus: '',\n        sertifikasi: '',\n        catatan: ''\n      })),\n      \n      // Documents info\n      dokumenSika: submission.sika_document_upload || '',\n      dokumenSimja: submission.simja_document_upload || '',\n      \n      // Additional info\n      catatan: submission.content || '',\n      signerName: submission.signer_name || '',\n      signerTitle: submission.signer_position || '',\n      \n      // Additional fields from schema\n      jamKerja: submission.working_hours,\n      saranaKerja: submission.work_facilities,\n      pelaksanaan: submission.implementation || '',\n      lainLain: submission.other_notes || '',\n      nomorSimja: submission.simja_number || '',\n      tanggalSimja: submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '',\n      nomorSika: submission.sika_number || '',\n      tanggalSika: submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '',\n      nomorSimlok: submission.simlok_number || '',\n      tanggalSimlok: submission.simlok_date ? new Date(submission.simlok_date).toLocaleDateString('id-ID') : '',\n      namaPerkerjaText: submission.worker_names,\n      content: submission.content || '',\n      qrcode: submission.qrcode || '',\n      approvedBy: submission.approved_by_user?.officer_name || ''\n    }));\n\n    return NextResponse.json({\n      success: true,\n      submissions: exportData,\n      total: submissions.length,\n      exportedAt: new Date().toISOString()\n    });\n\n  } catch (error) {\n    console.error('Export API error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/submissions/route.ts",
      "lang": "ts",
      "size": 3605,
      "lines": 126,
      "hash": "6a7b9e6c5400429b400ca55c2529e5114b5e40862750b19e7ab103bf4518e0ab",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/admin/submissions - Get all submissions for admin dashboard\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only ADMIN or SUPER_ADMIN can access this endpoint\n    if (session.user.role !== 'ADMIN' && session.user.role !== 'SUPER_ADMIN') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const status = searchParams.get('status');\n    const search = searchParams.get('search');\n    const vendorName = searchParams.get('vendor');\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {};\n\n    // Filter by status if provided\n    if (status) {\n      whereClause.approval_status = status;\n    }\n\n    // Filter by search term (vendor name, job description, or officer name)\n    if (search) {\n      whereClause.OR = [\n        {\n          vendor_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          job_description: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          officer_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        }\n      ];\n    }\n\n    // Filter by vendor name if provided (legacy support)\n    if (vendorName && !search) {\n      whereClause.vendor_name = {\n        contains: vendorName,\n        mode: 'insensitive'\n      };\n    }\n\n    const [submissions, total, statistics] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          },\n          approved_by_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          }\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n      // Get statistics\n      prisma.submission.groupBy({\n        by: ['approval_status'],\n        _count: {\n          approval_status: true\n        }\n      })\n    ]);\n\n    // Format statistics\n    const stats = {\n      total: total,\n      pending: statistics.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: statistics.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: statistics.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n    };\n\n    return NextResponse.json({\n      submissions,\n      statistics: stats,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching admin submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/submissions/stats/route.ts",
      "lang": "ts",
      "size": 1468,
      "lines": 45,
      "hash": "851393f003c5ae7e875720b61a1d05fb5d8848da79f6b6ca0b75708978d3599b",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only ADMIN can access this endpoint\n    if (session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    // Get statistics for all submissions (no filters)\n    const [total, statistics] = await Promise.all([\n      prisma.submission.count(),\n      prisma.submission.groupBy({\n        by: ['approval_status'],\n        _count: {\n          approval_status: true\n        }\n      })\n    ]);\n\n    const stats = {\n      total: total,\n      pending: statistics.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: statistics.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: statistics.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n    };\n\n    return NextResponse.json({\n      statistics: stats\n    });\n  } catch (error) {\n    console.error('Error fetching admin statistics:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/users/[id]/route.ts",
      "lang": "ts",
      "size": 3287,
      "lines": 144,
      "hash": "07e22616df57f977648fdbe6f9b8358c78b124bfee96e50bba23ef1c1a9fcf91",
      "truncated": false,
      "content": "// app/api/admin/users/[id]/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET(\n  _req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Check if user is authenticated and is admin\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    if (session.user.role !== 'ADMIN') {\n      return NextResponse.json(\n        { error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const { id } = resolvedParams;\n\n    if (!id) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // Get user details\n    const user = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        address: true,\n        phone_number: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n      },\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      user,\n    });\n\n  } catch (error) {\n    console.error('Error fetching user details:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PATCH(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    // Check if user is authenticated and is admin\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    if (session.user.role !== 'ADMIN') {\n      return NextResponse.json(\n        { error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const { id } = resolvedParams;\n\n    if (!id) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { status: 400 }\n      );\n    }\n\n    const body = await req.json();\n    const { verified_at } = body;\n\n    // Update user verification status\n    const updatedUser = await prisma.user.update({\n      where: { id },\n      data: {\n        verified_at: verified_at ? new Date(verified_at) : null,\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        address: true,\n        phone_number: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n      },\n    });\n\n    return NextResponse.json({\n      success: true,\n      user: updatedUser,\n      message: verified_at ? 'User berhasil diverifikasi' : 'Verifikasi user dibatalkan',\n    });\n\n  } catch (error) {\n    console.error('Error updating user:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/users/pending/route.ts",
      "lang": "ts",
      "size": 1203,
      "lines": 42,
      "hash": "b7c0dd27cf3e79460b191f85e034778605e771e9b5acc981304b3e5fcca484b8",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== 'ADMIN') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get pending vendors (users with role VENDOR and verified_at is null)\n    const users = await prisma.user.findMany({\n      where: {\n        role: 'VENDOR',\n        verified_at: null\n      },\n      orderBy: { created_at: 'desc' },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true\n      }\n    });\n\n    return NextResponse.json({ users });\n  } catch (error) {\n    console.error('Error fetching pending users:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/admin/users/search/route.ts",
      "lang": "ts",
      "size": 0,
      "lines": 1,
      "hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "truncated": false,
      "content": ""
    },
    {
      "path": "src/app/api/approver/simloks/[id]/final/route.ts",
      "lang": "ts",
      "size": 6535,
      "lines": 208,
      "hash": "274246f485242fb18c4e35497bb5127e22d206476cdd7054411bed5fbf4b5bf0",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\nimport { generateQrString } from '@/lib/qr-security';\n\n// Schema for validating final approval data\nconst finalApprovalSchema = z.object({\n  final_status: z.enum(['APPROVED', 'REJECTED']),\n  final_note: z.string().optional(),\n  simlok_number: z.string().optional(),\n  simlok_date: z.string().optional(),\n});\n\n// Function to generate simlok number - mengikuti sistem admin yang sudah ada\nasync function generateSimlokNumber(): Promise<string> {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n  // Get the last SIMLOK number for current month/year\n  const lastSubmission = await prisma.submission.findFirst({\n    where: {\n      simlok_number: {\n        contains: `/${month}/${year}`\n      }\n    },\n    orderBy: {\n      simlok_number: 'desc'\n    }\n  });\n\n  let nextNumber = 1;\n  \n  if (lastSubmission?.simlok_number) {\n    // Extract number from format: number/MM/YYYY\n    const match = lastSubmission.simlok_number.match(/^(\\d+)\\/\\d{2}\\/\\d{4}$/);\n    if (match && match[1]) {\n      nextNumber = parseInt(match[1]) + 1;\n    }\n  }\n\n  return `${nextNumber}/${month}/${year}`;\n}\n\n// PATCH /api/approver/simloks/[id]/final - Set final approval status\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    \n    // Check if submission exists and has been reviewed\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        review_status: true,\n        final_status: true,\n        user_id: true,\n        implementation_start_date: true,\n        implementation_end_date: true,\n        user: {\n          select: {\n            id: true,\n            vendor_name: true,\n            officer_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n          }\n        }\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Cannot finalize if not reviewed yet\n    if (existingSubmission.review_status === 'PENDING_REVIEW') {\n      return NextResponse.json({ \n        error: 'Cannot finalize submission that has not been reviewed yet' \n      }, { status: 400 });\n    }\n\n    // Cannot finalize if already finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Submission has already been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = finalApprovalSchema.parse(body);\n\n    // Generate simlok number only if approved\n    const updateData: any = {\n      final_status: validatedData.final_status,\n      final_note: validatedData.final_note || null,\n      approved_by_final_id: session.user.id,\n      approved_at: new Date(),\n    };\n\n    if (validatedData.final_status === 'APPROVED') {\n      // Use provided simlok number or generate one\n      updateData.simlok_number = validatedData.simlok_number?.trim() || await generateSimlokNumber();\n      \n      // Use provided date or current date\n      if (validatedData.simlok_date) {\n        updateData.simlok_date = new Date(validatedData.simlok_date);\n      } else {\n        updateData.simlok_date = new Date();\n      }\n      \n      // Auto-generate QR code when approved\n      const qrString = generateQrString({\n        id: resolvedParams.id,\n        implementation_start_date: existingSubmission.implementation_start_date || null,\n        implementation_end_date: existingSubmission.implementation_end_date || null\n      });\n      updateData.qrcode = qrString;\n      \n      updateData.approval_status = 'APPROVED'; // Update legacy field too\n    } else {\n      updateData.approval_status = 'REJECTED'; // Update legacy field too\n    }\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Log QR code generation for approved submissions\n    if (validatedData.final_status === 'APPROVED' && updateData.qrcode) {\n      console.log(`✅ QR Code auto-generated for approved submission ${resolvedParams.id}: ${updateData.qrcode.substring(0, 50)}...`);\n    }\n\n    // Import and use the event system for real-time notifications\n    const { notifyVendorStatusChange } = await import('@/server/events');\n    \n    // Notify vendor with real-time updates\n    const vendorStatus = validatedData.final_status === 'APPROVED' ? 'APPROVED' : 'REJECTED';\n    await notifyVendorStatusChange(\n      existingSubmission.user.id, \n      resolvedParams.id, \n      vendorStatus as 'APPROVED' | 'REJECTED'\n    );\n\n    // Note: Reviewer notification removed - only vendor should be notified about final decisions\n\n    return NextResponse.json({ \n      submission: updatedSubmission,\n      message: `Submission ${validatedData.final_status.toLowerCase()} successfully`\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error finalizing submission:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/approver/simloks/[id]/route.ts",
      "lang": "ts",
      "size": 2040,
      "lines": 72,
      "hash": "09c937fb63b7899f5b951adbd96975925711e2aa4c7bd2b1e96f89b4d52cc961",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/approver/simloks/[id] - Get single submission for final approval (read-only)\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const submission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          },\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ submission });\n  } catch (error) {\n    console.error('Error fetching submission for approval:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/approver/simloks/[id]/workers/route.ts",
      "lang": "ts",
      "size": 1462,
      "lines": 55,
      "hash": "5e388418781bb4ddac362704107d4006663bafe0b70c6da44482f48ef06863f3",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    // Check if submission exists\n    const submission = await prisma.submission.findUnique({\n      where: { id: id }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers for approver:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/approver/simloks/route.ts",
      "lang": "ts",
      "size": 4777,
      "lines": 167,
      "hash": "1c84b39fe563853d6a9c8646742569fcfeb23ab06469bd99e59b7d84ce6b8689",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/approver/simloks - Get reviewed submissions for approval\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only APPROVER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Approver access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const reviewStatus = searchParams.get('reviewStatus');\n    const finalStatus = searchParams.get('finalStatus');\n    const vendorId = searchParams.get('vendorId');\n    const search = searchParams.get('search');\n    const sortBy = searchParams.get('sortBy') || 'reviewed_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {\n      // Only show submissions that have been reviewed (not pending review)\n      review_status: {\n        not: 'PENDING_REVIEW'\n      }\n    };\n\n    // Filter by specific review status if provided\n    if (reviewStatus && ['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {\n      whereClause.review_status = reviewStatus;\n    }\n\n    // Filter by final status if provided\n    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {\n      whereClause.final_status = finalStatus;\n    }\n\n    // Filter by vendor if provided\n    if (vendorId) {\n      whereClause.user_id = vendorId;\n    }\n\n    // Filter by search term (vendor name, job description, or officer name)\n    if (search) {\n      whereClause.OR = [\n        {\n          vendor_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          job_description: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          officer_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        }\n      ];\n    }\n\n    const [submissions, total, statistics] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          },\n          reviewed_by_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          },\n          approved_by_final_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          },\n          worker_list: {\n            select: {\n              id: true,\n              worker_name: true,\n              worker_photo: true,\n            }\n          }\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n      // Get statistics for approver dashboard\n      Promise.all([\n        prisma.submission.count({\n          where: {\n            review_status: 'MEETS_REQUIREMENTS',\n            final_status: 'PENDING_APPROVAL'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            review_status: 'NOT_MEETS_REQUIREMENTS',\n            final_status: 'PENDING_APPROVAL'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            final_status: 'APPROVED'\n          }\n        }),\n        prisma.submission.count({\n          where: {\n            final_status: 'REJECTED'\n          }\n        }),\n      ])\n    ]);\n\n    // Format statistics\n    const [meetsCount, notMeetsCount, approvedCount, rejectedCount] = statistics;\n    const stats = {\n      total: total,\n      pending_approval_meets: meetsCount,\n      pending_approval_not_meets: notMeetsCount,\n      approved: approvedCount,\n      rejected: rejectedCount,\n    };\n\n    return NextResponse.json({\n      submissions,\n      statistics: stats,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching approver submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/auth/[...nextauth]/route.ts",
      "lang": "ts",
      "size": 198,
      "lines": 6,
      "hash": "3c2222c2f655b2de0f36933292f3f255e82d0b16f266a41f702ed17d9dcbd974",
      "truncated": false,
      "content": "// app/api/auth/[...nextauth]/route.ts\nimport NextAuth from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };"
    },
    {
      "path": "src/app/api/auth/signup/route.ts",
      "lang": "ts",
      "size": 6502,
      "lines": 210,
      "hash": "960ffcb7dd17fb8ef5ea0c451cc109aac1d1628c7e4f17119b413f77a38c42b5",
      "truncated": false,
      "content": "// app/api/auth/signup/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/singletons\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\nimport { notifyAdminNewVendor } from \"@/server/events\";\n\n// Validation schema for vendor registration\nconst vendorRegistrationSchema = z.object({\n  csrfToken: z.string().min(1, \"CSRF token is required\"),\n  officer_name: z.string()\n    .min(2, \"Nama petugas minimal 2 karakter\")\n    .max(100, \"Nama petugas maksimal 100 karakter\")\n    .trim(),\n  email: z.string()\n    .email(\"Format email tidak valid\")\n    .min(5, \"Email terlalu pendek\")\n    .max(100, \"Email terlalu panjang\")\n    .toLowerCase(),\n  password: z.string()\n    .min(8, \"Password minimal 8 karakter\")\n    .max(100, \"Password terlalu panjang\")\n    .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/, \"Password harus mengandung huruf besar, huruf kecil, dan angka\"),\n  vendor_name: z.string()\n    .min(2, \"Nama vendor minimal 2 karakter\")\n    .max(150, \"Nama vendor maksimal 150 karakter\")\n    .trim(),\n  address: z.string()\n    .min(10, \"Alamat minimal 10 karakter\")\n    .max(500, \"Alamat maksimal 500 karakter\")\n    .trim(),\n  phone_number: z.string()\n    .min(10, \"Nomor telepon minimal 10 digit\")\n    .max(15, \"Nomor telepon maksimal 15 digit\")\n    .regex(/^[0-9+\\-\\s]+$/, \"Nomor telepon hanya boleh berisi angka, +, -, dan spasi\")\n    .trim(),\n});\n\n// Rate limiting store (in production, use Redis)\nconst registrationAttempts = new Map<string, { count: number; lastAttempt: number }>();\n\nfunction checkRateLimit(ip: string): boolean {\n  const now = Date.now();\n  const windowMs = 15 * 60 * 1000; // 15 minutes\n  const maxAttempts = 5; // Maximum 5 registration attempts per 15 minutes\n\n  const attempts = registrationAttempts.get(ip);\n  \n  if (!attempts) {\n    registrationAttempts.set(ip, { count: 1, lastAttempt: now });\n    return true;\n  }\n\n  // Reset counter if window has passed\n  if (now - attempts.lastAttempt > windowMs) {\n    registrationAttempts.set(ip, { count: 1, lastAttempt: now });\n    return true;\n  }\n\n  // Check if limit exceeded\n  if (attempts.count >= maxAttempts) {\n    return false;\n  }\n\n  // Increment counter\n  attempts.count++;\n  attempts.lastAttempt = now;\n  return true;\n}\n\nfunction validateCsrfToken(req: NextRequest, csrfToken: string): boolean {\n  try {\n    const cookieHeader = req.headers.get(\"cookie\") || \"\";\n    const csrfCookie = cookieHeader\n      .split(\"; \")\n      .find((c) => c.startsWith(\"__Host-next-auth.csrf-token=\") || c.startsWith(\"next-auth.csrf-token=\"));\n\n    if (!csrfCookie) {\n      return false;\n    }\n\n    // Format cookie: token|hash, URL encoded %7C = |\n    const cookieValue = decodeURIComponent(csrfCookie.split(\"=\")[1] || '');\n    const [expectedToken] = cookieValue.split(\"|\");\n    \n    return expectedToken === csrfToken;\n  } catch (error) {\n    console.error(\"CSRF validation error:\", error);\n    return false;\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    // Get client IP for rate limiting\n    const clientIP = req.headers.get(\"x-forwarded-for\") || \n                     req.headers.get(\"x-real-ip\") || \n                     \"127.0.0.1\";\n\n    // Check rate limit\n    if (!checkRateLimit(clientIP)) {\n      return NextResponse.json(\n        { error: \"Terlalu banyak percobaan pendaftaran. Silakan coba lagi dalam 15 menit.\" }, \n        { status: 429 }\n      );\n    }\n\n    // Parse and validate request body\n    const body = await req.json();\n    \n    // Validate input using Zod schema\n    const validationResult = vendorRegistrationSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      const errors = validationResult.error.issues.map((err: any) => err.message).join(\", \");\n      return NextResponse.json({ error: errors }, { status: 400 });\n    }\n\n    const { csrfToken, officer_name, email, password, vendor_name, address, phone_number } = validationResult.data;\n\n    // Validate CSRF token\n    if (!validateCsrfToken(req, csrfToken)) {\n      return NextResponse.json({ error: \"Invalid CSRF token\" }, { status: 403 });\n    }\n\n    // Check if user already exists\n    const existingUser = await prisma.user.findUnique({ \n      where: { email },\n      select: { id: true, email: true }\n    });\n    \n    if (existingUser) {\n      return NextResponse.json({ error: \"Email sudah terdaftar\" }, { status: 409 });\n    }\n\n    // Check if vendor name already exists (case-insensitive)\n    const existingVendor = await prisma.user.findFirst({\n      where: { \n        vendor_name: {\n          equals: vendor_name,\n        }\n      },\n      select: { id: true, vendor_name: true }\n    });\n\n    if (existingVendor) {\n      return NextResponse.json({ error: \"Nama vendor sudah terdaftar\" }, { status: 409 });\n    }\n\n    // Hash password with strong settings\n    const saltRounds = 12;\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n\n    // Create new vendor user\n    const newUser = await prisma.user.create({\n      data: {\n        officer_name,\n        email,\n        password: hashedPassword,\n        vendor_name,\n        address,\n        phone_number,\n        role: \"VENDOR\", // Always VENDOR for this registration endpoint\n        verified_at: null, // Requires admin verification\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        vendor_name: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n      }\n    });\n\n    // Notify admin and reviewer about new vendor registration\n    await notifyAdminNewVendor(newUser.id);\n    \n    const { notifyReviewerNewUser } = await import('@/server/events');\n    await notifyReviewerNewUser(newUser.id);\n\n    // Log successful registration (for audit purposes)\n    console.log(`New vendor registered: ${email} (${vendor_name}) at ${new Date().toISOString()}`);\n\n    return NextResponse.json(\n      { \n        message: \"Pendaftiran berhasil! Akun Anda sedang menunggu verifikasi admin.\", \n        user: {\n          id: newUser.id,\n          officer_name: newUser.officer_name,\n          email: newUser.email,\n          vendor_name: newUser.vendor_name,\n          role: newUser.role,\n          verified: !!newUser.verified_at,\n        }\n      },\n      { status: 201 }\n    );\n\n  } catch (error) {\n    console.error(\"Registration error:\", error);\n    \n    // Don't expose internal errors to client\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan internal server. Silakan coba lagi.\" }, \n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/debug/vendor-notifications/route.ts",
      "lang": "ts",
      "size": 0,
      "lines": 1,
      "hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "truncated": false,
      "content": ""
    },
    {
      "path": "src/app/api/files/[userId]/[category]/[filename]/route.ts",
      "lang": "ts",
      "size": 3258,
      "lines": 108,
      "hash": "0053f360647a50ea0ab0eb8600d31ec037746adc8172fd91d944351a2b36ab2e",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { readFile } from 'fs/promises';\nimport { join } from 'path';\nimport { existsSync } from 'fs';\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ userId: string; category: string; filename: string }> }\n) {\n  try {\n    // Get session to check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Await params for Next.js 15 compatibility\n    const { userId, category, filename } = await params;\n\n    // Check if user can access this file\n    // Users can only access their own files, unless they're admin, reviewer, or approver\n    const canAccess = \n      session.user.role === 'ADMIN' || \n      session.user.role === 'REVIEWER' || \n      session.user.role === 'APPROVER' ||\n      session.user.id === userId;\n\n    // Debug logging\n    console.log('File access check:', {\n      requestedUserId: userId,\n      sessionUserId: session.user.id,\n      userRole: session.user.role,\n      category,\n      filename,\n      canAccess\n    });\n      \n    if (!canAccess) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n    }\n\n    // Map category to folder name\n    const categoryFolders = {\n      sika: 'dokumen-sika',\n      simja: 'dokumen-simja',\n      other: 'lainnya',\n      'worker-photo': 'foto-pekerja'\n    };\n\n    const folderName = categoryFolders[category as keyof typeof categoryFolders];\n    if (!folderName) {\n      return NextResponse.json({ error: 'Invalid category' }, { status: 400 });\n    }\n\n    // Construct file path\n    const filePath = join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n\n    // Check if file exists\n    if (!existsSync(filePath)) {\n      return NextResponse.json({ error: 'File not found' }, { status: 404 });\n    }\n\n    // Read file\n    const fileBuffer = await readFile(filePath);\n\n    // Determine content type based on file extension\n    const extension = filename.split('.').pop()?.toLowerCase();\n    let contentType = 'application/octet-stream';\n    \n    switch (extension) {\n      case 'pdf':\n        contentType = 'application/pdf';\n        break;\n      case 'jpg':\n      case 'jpeg':\n        contentType = 'image/jpeg';\n        break;\n      case 'png':\n        contentType = 'image/png';\n        break;\n      case 'gif':\n        contentType = 'image/gif';\n        break;\n      case 'doc':\n        contentType = 'application/msword';\n        break;\n      case 'docx':\n        contentType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';\n        break;\n    }\n\n    // Return file with proper headers\n    return new NextResponse(new Uint8Array(fileBuffer), {\n      headers: {\n        'Content-Type': contentType,\n        'Content-Disposition': `inline; filename=\"${filename}\"`,\n        'Cache-Control': 'private, max-age=3600', // Cache for 1 hour\n      },\n    });\n\n  } catch (error) {\n    console.error('File serving error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/files/manage/route.ts",
      "lang": "ts",
      "size": 3205,
      "lines": 125,
      "hash": "cc4fcb90adbf3d6c5c56b62557b857348b748421bdaba018523f876a0ab53964",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// GET /api/files/manage - List all user files\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const files = await fileManager.listUserFiles(session.user.id);\n    \n    return NextResponse.json({\n      success: true,\n      files\n    });\n\n  } catch (error) {\n    console.error('Error listing files:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n\n// POST /api/files/manage - Rename or move file\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { action, oldFileName, newName, category } = body;\n\n    if (action === 'rename') {\n      if (!oldFileName || !newName) {\n        return NextResponse.json({ \n          error: 'oldFileName and newName are required' \n        }, { status: 400 });\n      }\n\n      const result = await fileManager.renameFile(\n        session.user.id,\n        oldFileName,\n        newName,\n        category\n      );\n\n      if (!result) {\n        return NextResponse.json({ \n          error: 'Failed to rename file' \n        }, { status: 400 });\n      }\n\n      return NextResponse.json({\n        success: true,\n        file: result\n      });\n    }\n\n    if (action === 'migrate') {\n      const result = await fileManager.migrateExistingFiles(session.user.id);\n      \n      return NextResponse.json({\n        success: true,\n        migrated: result.moved,\n        errors: result.errors\n      });\n    }\n\n    return NextResponse.json({ \n      error: 'Invalid action' \n    }, { status: 400 });\n\n  } catch (error) {\n    console.error('Error managing files:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n\n// DELETE /api/files/manage - Delete file\nexport async function DELETE(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const fileName = searchParams.get('fileName');\n\n    if (!fileName) {\n      return NextResponse.json({ \n        error: 'fileName is required' \n      }, { status: 400 });\n    }\n\n    const success = await fileManager.deleteFile(session.user.id, fileName);\n\n    if (!success) {\n      return NextResponse.json({ \n        error: 'Failed to delete file' \n      }, { status: 400 });\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'File deleted successfully'\n    });\n\n  } catch (error) {\n    console.error('Error deleting file:', error);\n    return NextResponse.json({ \n      error: 'Internal server error' \n    }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/notifications/stream/route.ts",
      "lang": "ts",
      "size": 3563,
      "lines": 108,
      "hash": "d74efcefe1141abbbaa7e6cf6ef612ccbef051b3d049d99358819d71acc9f503",
      "truncated": false,
      "content": "import { NextRequest } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { redisPub } from '@/lib/singletons';\n\nexport const runtime = 'nodejs';\n\nexport async function GET(request: NextRequest) {\n  const session = await getServerSession(authOptions);\n  \n  if (!session?.user) {\n    return new Response('Unauthorized', { status: 401 });\n  }\n\n  const searchParams = request.nextUrl.searchParams;\n  const scope = searchParams.get('scope') || \n    (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN' ? 'admin' :\n     session.user.role === 'REVIEWER' ? 'reviewer' :\n     session.user.role === 'APPROVER' ? 'approver' : 'vendor');\n  const vendorId = searchParams.get('vendorId') || session.user.id;\n\n  // Create Server-Sent Events stream\n  const stream = new ReadableStream({\n    start(controller) {\n      console.log('🔥 SSE connection established for:', { scope, vendorId, role: session.user.role });\n\n      // Send initial connection message\n      const encoder = new TextEncoder();\n      controller.enqueue(encoder.encode(`data: ${JSON.stringify({ \n        type: 'connected', \n        message: 'Real-time notifications connected',\n        scope,\n        vendorId,\n        role: session.user.role\n      })}\\n\\n`));\n\n      // Subscribe to Redis channels for real-time updates\n      let channelName: string;\n      switch (scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${vendorId}`;\n          break;\n        default:\n          channelName = 'notifications:admin';\n      }\n      \n      // Create a Redis subscriber for this connection\n      const subscriber = redisPub.duplicate();\n      \n      subscriber.subscribe(channelName, (err, count) => {\n        if (err) {\n          console.error('Redis subscribe error:', err);\n          return;\n        }\n        console.log(`📡 Subscribed to Redis channel: ${channelName} (${count} channels)`);\n      });\n\n      subscriber.on('message', (channel, message) => {\n        try {\n          console.log(`📨 Received message on ${channel}:`, message);\n          const data = JSON.parse(message);\n          \n          // Send the notification data to client\n          controller.enqueue(encoder.encode(`data: ${JSON.stringify(data)}\\n\\n`));\n        } catch (error) {\n          console.error('Error processing Redis message:', error);\n        }\n      });\n\n      // Keep connection alive with heartbeat\n      const heartbeat = setInterval(() => {\n        controller.enqueue(encoder.encode(`data: ${JSON.stringify({ \n          type: 'heartbeat', \n          timestamp: new Date().toISOString() \n        })}\\n\\n`));\n      }, 30000); // Every 30 seconds\n\n      // Cleanup on connection close\n      request.signal.addEventListener('abort', () => {\n        console.log('🔌 SSE connection closed for:', { scope, vendorId });\n        clearInterval(heartbeat);\n        subscriber.unsubscribe();\n        subscriber.disconnect();\n        controller.close();\n      });\n    }\n  });\n\n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Headers': 'Cache-Control',\n    },\n  });\n}\n"
    },
    {
      "path": "src/app/api/qr/verify/route.ts",
      "lang": "ts",
      "size": 13264,
      "lines": 398,
      "hash": "590e065ec9a958ff081087e2b6e9ad3bba49a543ceccc19cc7cbe84ec1545997",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { parseQrString, type QrPayload } from '@/lib/qr-security';\n\n// POST /api/qr/verify - Verify QR code and return submission data\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only VERIFIER and ADMIN can scan QR codes/barcodes\n    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ \n        error: 'Access denied. Only verifiers and admins can scan QR codes/barcodes.' \n      }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const { qrData, qr_data, scanLocation, scanNotes, scanner_type } = body;\n\n    // Support both qrData and qr_data parameter names for compatibility\n    const qrString = qr_data || qrData;\n\n    console.log('=== QR VERIFY API ===');\n    console.log('Received qrString:', qrString);\n    console.log('qrString length:', qrString?.length);\n    console.log('scanner_type:', scanner_type);\n    console.log('session.user:', session.user);\n    console.log('session.user.id:', session.user.id);\n    console.log('session.user.role:', session.user.role);\n    console.log('====================');\n\n    if (!qrString) {\n      console.log('ERROR: No QR/Barcode string provided');\n      return NextResponse.json({ \n        success: false,\n        message: 'QR/Barcode string is required' \n      }, { status: 400 });\n    }\n\n    // Parse and verify QR code or barcode\n    const qrPayload: QrPayload | null = parseQrString(qrString);\n    \n    console.log('=== QR PARSING RESULT ===');\n    console.log('Parsed payload:', qrPayload);\n    console.log('========================');\n    \n    if (!qrPayload) {\n      console.log('ERROR: Failed to parse QR/Barcode');\n      return NextResponse.json({ \n        success: false,\n        message: 'Invalid QR code/barcode or data has been tampered with. Please make sure you are scanning a valid SIMLOK QR code or barcode generated by the system.' \n      }, { status: 400 });\n    }\n\n    // Check if QR/Barcode is valid for current date (simplified check)\n    const now = Date.now();\n    if (qrPayload.timestamp && now > qrPayload.timestamp + (7 * 24 * 60 * 60 * 1000)) { // 7 days validity\n      return NextResponse.json({ \n        success: false,\n        message: 'QR code/barcode has expired. Please generate a new one.' \n      }, { status: 400 });\n    }\n\n    // Fetch submission data\n    const submission = await prisma.submission.findUnique({\n      where: { id: qrPayload.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n          },\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ \n        success: false,\n        message: 'Submission not found' \n      }, { status: 404 });\n    }\n\n    // Check if submission is approved\n    if (submission.approval_status !== 'APPROVED') {\n      return NextResponse.json({ \n        success: false,\n        message: 'This submission is not approved yet' \n      }, { status: 400 });\n    }\n\n    // DEBUG: Check user session and database\n    console.log('=== USER SESSION DEBUG ===');\n    console.log('session.user:', JSON.stringify(session.user, null, 2));\n    console.log('session.user.id:', session.user.id);\n    \n    // Check if this user exists in database\n    const userExists = await prisma.user.findUnique({\n      where: { id: session.user.id },\n      select: { id: true, email: true, role: true, officer_name: true, address: true }\n    });\n    console.log('userExists in DB:', userExists);\n    \n    if (!userExists) {\n      console.log('ERROR: User not found in database');\n      return NextResponse.json({ \n        success: false,\n        message: 'User session is invalid. Please login again.' \n      }, { status: 401 });\n    }\n\n    // Check for duplicate scans - only prevent same verifier scanning same SIMLOK on same day\n    console.log('=== CHECKING FOR DUPLICATE SCAN BY SAME VERIFIER ON SAME DAY ===');\n    console.log('submission_id:', qrPayload.id);\n    console.log('scanned_by:', session.user.id);\n    \n    // Get today's date range (start and end of day)\n    const today = new Date();\n    const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);\n    const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);\n    \n    // Check if the same verifier has already scanned today\n    const existingTodayScanByUser = await prisma.qrScan.findFirst({\n      where: {\n        submission_id: qrPayload.id,\n        scanned_by: session.user.id,\n        scanned_at: {\n          gte: startOfDay,\n          lte: endOfDay,\n        }\n      },\n      include: {\n        user: {\n          select: {\n            officer_name: true,\n          },\n        },\n      },\n    });\n\n    console.log('existingTodayScanByUser found:', !!existingTodayScanByUser);\n\n    if (existingTodayScanByUser) {\n      console.log('=== DUPLICATE SCAN BY SAME USER TODAY DETECTED ===');\n      const scanDate = new Date(existingTodayScanByUser.scanned_at);\n      const formattedDate = scanDate.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: '2-digit', \n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n      });\n\n      return NextResponse.json({ \n        success: false, \n        error: 'duplicate_scan_same_day',\n        message: `Anda sudah melakukan scan untuk SIMLOK ini hari ini pada ${formattedDate}. Verifikator yang sama tidak dapat scan SIMLOK yang sama di hari yang sama.`,\n        previousScan: {\n          scanDate: existingTodayScanByUser.scanned_at,\n          scanId: existingTodayScanByUser.id,\n          scannerName: existingTodayScanByUser.user.officer_name,\n        }\n      }, { status: 409 });\n    }\n\n    // Note: Different verifiers CAN scan the same SIMLOK on the same day\n    // This is allowed per the new requirements\n\n    console.log('=== NO DUPLICATE FOUND, PROCEEDING TO CREATE SCAN RECORD ===');\n\n    console.log('User verified for scan record creation:', userExists);\n\n    // Record the scan in database\n    try {\n      const scanRecord = await prisma.qrScan.create({\n        data: {\n          submission_id: qrPayload.id,\n          scanned_by: session.user.id,\n          scanner_name: userExists.officer_name || session.user.officer_name,\n          scan_location: userExists.address || 'Lokasi tidak tersedia',\n          notes: scanNotes || `Scanned via ${scanner_type || 'scanner'} at: ${scanLocation || 'Unknown location'}`,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              role: true,\n            }\n          }\n        }\n      });\n\n      console.log('=== SCAN RECORD CREATED SUCCESSFULLY ===');\n      console.log('scanRecord.id:', scanRecord.id);\n\n      // Return verification result with submission data in the format expected by the modal\n      return NextResponse.json({\n        success: true,\n        message: 'QR code/barcode verified successfully',\n        scan_id: scanRecord.id,\n        scanned_at: scanRecord.scanned_at,\n        scanned_by: scanRecord.user.officer_name,\n        data: {\n          submission: {\n            id: submission.id,\n            number: submission.simlok_number,\n            title: submission.job_description,\n            task: submission.implementation || 'No task description',\n            workers: submission.worker_list.map(worker => ({ name: worker.worker_name })),\n            vendor: submission.vendor_name ? { name: submission.vendor_name } : undefined,\n            location: submission.work_location || undefined,\n            implementation_start_date: submission.implementation_start_date?.toISOString(),\n            implementation_end_date: submission.implementation_end_date?.toISOString(),\n            status: submission.approval_status.toLowerCase(),\n          }\n        }\n      });\n\n    } catch (createError: any) {\n      console.error('Error creating scan record:', createError);\n      \n      // Check if it's a unique constraint violation (in case of race condition)\n      if (createError?.code === 'P2002') {\n        console.log('=== UNIQUE CONSTRAINT VIOLATION DETECTED (RACE CONDITION) ===');\n        \n        // Check again for today's scans by same user only (race condition handling)\n        const today = new Date();\n        const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0);\n        const endOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999);\n        \n        const raceConditionScan = await prisma.qrScan.findFirst({\n          where: {\n            submission_id: qrPayload.id,\n            scanned_by: session.user.id, // Only check for same user\n            scanned_at: {\n              gte: startOfDay,\n              lte: endOfDay,\n            }\n          },\n          include: {\n            user: {\n              select: {\n                officer_name: true,\n              },\n            },\n          },\n        });\n\n        if (raceConditionScan) {\n          const scanDate = new Date(raceConditionScan.scanned_at);\n          const formattedDate = scanDate.toLocaleDateString('id-ID', {\n            day: '2-digit',\n            month: '2-digit', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n          });\n\n          return NextResponse.json({ \n            success: false, \n            error: 'duplicate_scan_same_day',\n            message: `Anda sudah melakukan scan untuk SIMLOK ini hari ini pada ${formattedDate}. Verifikator yang sama tidak dapat scan SIMLOK yang sama di hari yang sama.`\n          }, { status: 409 });\n        }\n\n        return NextResponse.json({ \n          success: false, \n          error: 'duplicate_scan',\n          message: 'QR Code ini sudah pernah discan hari ini (race condition detected)'\n        }, { status: 409 });\n      }\n      \n      throw createError; // Re-throw if it's not a constraint violation\n    }\n\n  } catch (error) {\n    console.error('QR/Barcode verification error:', error);\n    return NextResponse.json({ \n      success: false,\n      message: 'Internal server error during QR/Barcode verification' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/qr/verify - Get recent scan history (for admin/verifier dashboard)\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only VERIFIER and ADMIN can view scan history\n    if (!['VERIFIER', 'ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ \n        error: 'Access denied. Only verifiers and admins can view scan history.' \n      }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const limit = Math.min(parseInt(searchParams.get('limit') || '50'), 100);\n    const offset = parseInt(searchParams.get('offset') || '0');\n    const submissionId = searchParams.get('submission_id');\n\n    // Build where clause\n    const whereClause: any = {};\n    \n    if (submissionId) {\n      whereClause.submission_id = submissionId;\n    }\n\n    // For verifiers, only show their own scans\n    if (session.user.role === 'VERIFIER') {\n      whereClause.scanned_by = session.user.id;\n    }\n\n    // Fetch scan history\n    const scans = await prisma.qrScan.findMany({\n      where: whereClause,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        },\n        submission: {\n          select: {\n            id: true,\n            simlok_number: true,\n            vendor_name: true,\n            officer_name: true,\n            job_description: true,\n            work_location: true,\n            approval_status: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      },\n      take: limit,\n      skip: offset,\n    });\n\n    // Get total count\n    const totalCount = await prisma.qrScan.count({\n      where: whereClause,\n    });\n\n    return NextResponse.json({\n      scans,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount,\n      }\n    });\n\n  } catch (error) {\n    console.error('Scan history fetch error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error while fetching scan history' \n    }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/reviewer/simloks/[id]/review/route.ts",
      "lang": "ts",
      "size": 3260,
      "lines": 107,
      "hash": "a71586cbafd992c83e4906c7ce54b45079940fd5a09547ff3c99d2a4d2beb93b",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\nimport { notifyApproverReviewedSubmission } from '@/server/events';\n\n// Schema for validating review data\nconst reviewSchema = z.object({\n  review_status: z.enum(['MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS']),\n  review_note: z.string().optional(),\n});\n\n// PATCH /api/reviewer/simloks/[id]/review - Set review status and note\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still reviewable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        final_status: true,\n        user_id: true,\n        user: {\n          select: {\n            vendor_name: true,\n            officer_name: true,\n          }\n        }\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot review after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot review submission after it has been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = reviewSchema.parse(body);\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: {\n        review_status: validatedData.review_status,\n        review_note: validatedData.review_note || null,\n        reviewed_by_id: session.user.id,\n        reviewed_at: new Date(),\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Notify approvers about the review result (both meets and doesn't meet requirements)\n    await notifyApproverReviewedSubmission(resolvedParams.id);\n\n    return NextResponse.json({ \n      submission: updatedSubmission,\n      message: 'Review submitted successfully'\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error submitting review:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/simloks/[id]/route.ts",
      "lang": "ts",
      "size": 7023,
      "lines": 228,
      "hash": "ecb8adc33599187bfcafcea8090cd43c51e069872c27fda977dcdc8415d7fe15",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating submission updates\nconst updateSubmissionSchema = z.object({\n  vendor_name: z.string().optional(),\n  vendor_phone: z.string().optional(),\n  based_on: z.string().optional(),\n  officer_name: z.string().optional(),\n  job_description: z.string().optional(),\n  work_location: z.string().optional(),\n  implementation: z.string().optional(),\n  working_hours: z.string().optional(),\n  other_notes: z.string().optional(),\n  work_facilities: z.string().optional(),\n  worker_count: z.number().optional(),\n  simja_number: z.string().optional(),\n  simja_date: z.string().optional(),\n  sika_number: z.string().optional(),\n  sika_date: z.string().optional(),\n  implementation_start_date: z.string().optional(),\n  implementation_end_date: z.string().optional(),\n  worker_names: z.string().optional(),\n  content: z.string().optional(),\n  notes: z.string().optional(),\n  signer_position: z.string().optional(),\n  signer_name: z.string().optional(),\n});\n\n// GET /api/reviewer/simloks/[id] - Get single submission for review\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const submission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n            phone_number: true,\n            address: true,\n            role: true,\n            verified_at: true,\n            verified_by: true,\n            created_at: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        approved_by_final_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ submission });\n  } catch (error) {\n    console.error('Error fetching submission for review:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// PATCH /api/reviewer/simloks/[id] - Update submission content (only if not finalized)\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still editable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id: resolvedParams.id },\n      select: {\n        id: true,\n        final_status: true,\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot edit after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot edit submission after it has been finalized' \n      }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = updateSubmissionSchema.parse(body);\n\n    // Convert date strings to Date objects if provided and not empty\n    const updateData: any = { ...validatedData };\n    \n    // Remove empty date fields or convert to Date objects\n    if (validatedData.simja_date && validatedData.simja_date.trim() !== '') {\n      updateData.simja_date = new Date(validatedData.simja_date);\n    } else {\n      updateData.simja_date = null;\n    }\n    \n    if (validatedData.sika_date && validatedData.sika_date.trim() !== '') {\n      updateData.sika_date = new Date(validatedData.sika_date);\n    } else {\n      updateData.sika_date = null;\n    }\n    \n    if (validatedData.implementation_start_date && validatedData.implementation_start_date.trim() !== '') {\n      updateData.implementation_start_date = new Date(validatedData.implementation_start_date);\n    } else {\n      updateData.implementation_start_date = null;\n    }\n    \n    if (validatedData.implementation_end_date && validatedData.implementation_end_date.trim() !== '') {\n      updateData.implementation_end_date = new Date(validatedData.implementation_end_date);\n    } else {\n      updateData.implementation_end_date = null;\n    }\n\n    const updatedSubmission = await prisma.submission.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n            phone_number: true,\n            address: true,\n            role: true,\n            verified_at: true,\n            verified_by: true,\n            created_at: true,\n          }\n        },\n        reviewed_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          select: {\n            id: true,\n            worker_name: true,\n            worker_photo: true,\n            created_at: true,\n          }\n        }\n      }\n    });\n\n    console.log('Submission updated successfully by reviewer:', session.user.id);\n    \n    return NextResponse.json({\n      message: 'Submission updated successfully',\n      submission: updatedSubmission\n    });\n\n  } catch (error) {\n    console.error('Error updating submission:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json({\n        error: 'Invalid request data',\n        details: error.issues\n      }, { status: 400 });\n    }\n\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/simloks/[id]/workers/[workerId]/route.ts",
      "lang": "ts",
      "size": 3322,
      "lines": 99,
      "hash": "6754813485aa0df3698f52b0d39766b735c866f2e91e6f9abd04e32e16ef613c",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport fs from 'fs';\nimport path from 'path';\n\n// DELETE /api/reviewer/simloks/[id]/workers/[workerId] - Delete worker photo\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string; workerId: string }> }\n) {\n  try {\n    const resolvedParams = await params;\n    const { id, workerId } = resolvedParams;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if submission exists and is still editable\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        final_status: true,\n      }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Reviewer cannot edit after Approver has finalized\n    if (existingSubmission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot delete worker after submission has been finalized' \n      }, { status: 400 });\n    }\n\n    // Find the worker photo to delete\n    const workerPhoto = await prisma.workerList.findUnique({\n      where: { id: workerId },\n      select: {\n        id: true,\n        worker_photo: true,\n        submission_id: true,\n      }\n    });\n\n    if (!workerPhoto) {\n      return NextResponse.json({ error: 'Worker photo not found' }, { status: 404 });\n    }\n\n    // Verify the worker belongs to this submission\n    if (workerPhoto.submission_id !== id) {\n      return NextResponse.json({ error: 'Worker does not belong to this submission' }, { status: 400 });\n    }\n\n    // Delete the physical file if it exists\n    try {\n      const photoPath = workerPhoto.worker_photo;\n      // Extract the relative path from the URL (assuming it starts with /uploads/)\n      if (photoPath && photoPath.startsWith('/uploads/')) {\n        const relativePath = photoPath.substring(1); // Remove leading slash\n        const fullPath = path.join(process.cwd(), 'public', relativePath);\n        \n        if (fs.existsSync(fullPath)) {\n          fs.unlinkSync(fullPath);\n          console.log('Physical file deleted:', fullPath);\n        }\n      }\n    } catch (fileError) {\n      console.error('Error deleting physical file:', fileError);\n      // Continue with database deletion even if file deletion fails\n    }\n\n    // Delete the worker photo from database\n    await prisma.workerList.delete({\n      where: { id: workerId }\n    });\n\n    console.log('Worker photo deleted successfully by reviewer:', session.user.id);\n    \n    return NextResponse.json({\n      message: 'Worker photo deleted successfully'\n    });\n\n  } catch (error) {\n    console.error('Error deleting worker photo:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/simloks/[id]/workers/route.ts",
      "lang": "ts",
      "size": 1462,
      "lines": 55,
      "hash": "e5097c4c3c062d65b1e13a792a84905d96c13790039c62600d7c1a13ce7c4953",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    // Check if submission exists\n    const submission = await prisma.submission.findUnique({\n      where: { id: id }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers for reviewer:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/simloks/route.ts",
      "lang": "ts",
      "size": 4908,
      "lines": 158,
      "hash": "4adaa72bc92cb42f0cc95c1d0bfa6cab05840d72991d67d19eceec1551fdc4cc",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/reviewer/simloks - Get submissions for reviewer dashboard\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const reviewStatus = searchParams.get('reviewStatus');\n    const finalStatus = searchParams.get('finalStatus');\n    const vendorId = searchParams.get('vendorId');\n    const search = searchParams.get('search');\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {};\n\n    // Filter by review status if provided\n    if (reviewStatus && ['PENDING_REVIEW', 'MEETS_REQUIREMENTS', 'NOT_MEETS_REQUIREMENTS'].includes(reviewStatus)) {\n      whereClause.review_status = reviewStatus;\n    }\n\n    // Filter by final status if provided\n    if (finalStatus && ['PENDING_APPROVAL', 'APPROVED', 'REJECTED'].includes(finalStatus)) {\n      whereClause.final_status = finalStatus;\n    } else if (!finalStatus) {\n      // Default to showing only pending approval submissions if no final status filter is applied\n      whereClause.final_status = 'PENDING_APPROVAL';\n    }\n\n    // Filter by vendor if provided\n    if (vendorId) {\n      whereClause.user_id = vendorId;\n    }\n\n    // Filter by search term (vendor name, job description, or officer name)\n    if (search) {\n      whereClause.OR = [\n        {\n          vendor_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          job_description: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        },\n        {\n          officer_name: {\n            contains: search,\n            mode: 'insensitive'\n          }\n        }\n      ];\n    }\n\n    const [submissions, total, statistics, userStats] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        select: {\n          id: true,\n          approval_status: true,\n          review_status: true,\n          final_status: true,\n          vendor_name: true,\n          based_on: true,\n          officer_name: true,\n          job_description: true,\n          work_location: true,\n          implementation: true,\n          working_hours: true,\n          other_notes: true,\n          work_facilities: true,\n          created_at: true,\n          user: {\n            select: {\n              id: true,\n              vendor_name: true,\n              officer_name: true,\n            }\n          }\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n      // Get statistics for reviewer dashboard\n      prisma.submission.groupBy({\n        by: ['review_status'],\n        where: {\n          final_status: 'PENDING_APPROVAL'\n        },\n        _count: {\n          review_status: true\n        }\n      }),\n      // Get user verification statistics\n      Promise.all([\n        prisma.user.count({\n          where: { \n            role: 'VENDOR',\n            verified_at: null \n          }\n        }),\n        prisma.user.count({\n          where: { \n            role: 'VENDOR',\n            verified_at: { not: null }\n          }\n        })\n      ])\n    ]);\n\n    // Format statistics for frontend\n    const [pendingUserVerifications, totalVerifiedUsers] = userStats;\n    const stats = {\n      total: total,\n      pendingReview: statistics.find(s => s.review_status === 'PENDING_REVIEW')?._count.review_status || 0,\n      meetsRequirements: statistics.find(s => s.review_status === 'MEETS_REQUIREMENTS')?._count.review_status || 0,\n      notMeetsRequirements: statistics.find(s => s.review_status === 'NOT_MEETS_REQUIREMENTS')?._count.review_status || 0,\n      pendingUserVerifications,\n      totalVerifiedUsers\n    };\n\n    return NextResponse.json({\n      submissions,\n      stats,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching reviewer submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/users/[id]/route.ts",
      "lang": "ts",
      "size": 6092,
      "lines": 193,
      "hash": "aeb14b46385a32fea3e2bcd9b1cd5534f554ba33326b570f6dc3e4b5065d153d",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating user verification data\nconst userVerificationSchema = z.object({\n  status: z.enum(['VERIFY', 'REJECT']),\n  note: z.string().optional(),\n});\n\n// PATCH /api/reviewer/users/[id] - Verify or reject user\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    // Check if user exists and is a vendor\n    const existingUser = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        role: true,\n        verified_at: true,\n        created_at: true\n      }\n    });\n\n    if (!existingUser) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    if (existingUser.role !== 'VENDOR') {\n      return NextResponse.json({ error: 'Only vendor users can be verified' }, { status: 400 });\n    }\n\n    if (existingUser.verified_at) {\n      return NextResponse.json({ error: 'User has already been verified' }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = userVerificationSchema.parse(body);\n\n    let updatedUser;\n    let notificationTitle: string;\n    let notificationMessage: string;\n    let notificationType: string;\n\n    if (validatedData.status === 'VERIFY') {\n      // Verify the user\n      updatedUser = await prisma.user.update({\n        where: { id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n        },\n        include: {\n          submissions: {\n            select: { id: true }\n          }\n        }\n      });\n\n      notificationTitle = 'Akun Anda Telah Diverifikasi';\n      notificationMessage = 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.';\n      notificationType = 'user_verified';\n    } else {\n      // For rejection, we might want to add a rejected_at field in the future\n      // For now, we'll just create a notification\n      notificationTitle = 'Akun Anda Ditolak';\n      notificationMessage = `Maaf, akun vendor Anda tidak dapat diverifikasi. ${validatedData.note || 'Silakan hubungi admin untuk informasi lebih lanjut.'}`;\n      notificationType = 'user_rejected';\n      \n      updatedUser = existingUser;\n    }\n\n    // Create notification for the user\n    await prisma.notification.create({\n      data: {\n        scope: 'vendor',\n        vendor_id: id,\n        type: notificationType,\n        title: notificationTitle,\n        message: notificationMessage,\n        data: JSON.stringify({\n          userId: id,\n          verificationStatus: validatedData.status,\n          verifiedBy: session.user.officer_name,\n          verifiedAt: new Date().toISOString(),\n          note: validatedData.note\n        })\n      }\n    });\n\n    // Notify the user via real-time events\n    const { notifyUserVerificationResult } = await import('@/server/events');\n    await notifyUserVerificationResult(id, validatedData.status, validatedData.note);\n\n    return NextResponse.json({ \n      user: {\n        id: updatedUser.id,\n        email: updatedUser.email,\n        officer_name: updatedUser.officer_name,\n        vendor_name: updatedUser.vendor_name,\n        verified_at: validatedData.status === 'VERIFY' ? updatedUser.verified_at : null,\n        verified_by: validatedData.status === 'VERIFY' ? session.user.id : null\n      },\n      message: `User ${validatedData.status === 'VERIFY' ? 'verified' : 'rejected'} successfully`\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error verifying user:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// GET /api/reviewer/users/[id] - Get user details for verification\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { id },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        address: true,\n        phone_number: true,\n        profile_photo: true,\n        role: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        submissions: {\n          select: {\n            id: true,\n            job_description: true,\n            approval_status: true,\n            created_at: true\n          },\n          orderBy: { created_at: 'desc' },\n          take: 5 // Show recent submissions\n        }\n      }\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    return NextResponse.json({ user });\n  } catch (error) {\n    console.error('Error fetching user details:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/users/route.ts",
      "lang": "ts",
      "size": 3416,
      "lines": 114,
      "hash": "db9de1ff792e0d175dc572e85a1d9e95fafede0a2a02f7ad4d663fd277ad3246",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\n// GET /api/reviewer/users - Get pending user verifications\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const search = searchParams.get('search');\n    const status = searchParams.get('status'); // 'pending' | 'verified'\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {\n      role: 'VENDOR' // Only show vendor users for verification\n    };\n\n    // Filter by verification status\n    if (status === 'pending') {\n      whereClause.verified_at = null;\n    } else if (status === 'verified') {\n      whereClause.verified_at = { not: null };\n    }\n\n    // Search by name, vendor name, or email\n    if (search) {\n      whereClause.OR = [\n        { officer_name: { contains: search, mode: 'insensitive' } },\n        { vendor_name: { contains: search, mode: 'insensitive' } },\n        { email: { contains: search, mode: 'insensitive' } }\n      ];\n    }\n\n    // Get users with pagination\n    const [users, totalCount] = await Promise.all([\n      prisma.user.findMany({\n        where: whereClause,\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          address: true,\n          phone_number: true,\n          profile_photo: true,\n          created_at: true,\n          verified_at: true,\n          verified_by: true,\n          role: true\n        },\n        orderBy: { [sortBy]: sortOrder },\n        skip,\n        take: limit,\n      }),\n      prisma.user.count({ where: whereClause })\n    ]);\n\n    // Get verification stats\n    const stats = {\n      totalPending: await prisma.user.count({\n        where: { \n          role: 'VENDOR',\n          verified_at: null \n        }\n      }),\n      totalVerified: await prisma.user.count({\n        where: { \n          role: 'VENDOR',\n          verified_at: { not: null }\n        }\n      }),\n      totalUsers: await prisma.user.count({\n        where: { role: 'VENDOR' }\n      }),\n      todayRegistrations: await prisma.user.count({\n        where: {\n          role: 'VENDOR',\n          created_at: {\n            gte: new Date(new Date().setHours(0, 0, 0, 0))\n          }\n        }\n      })\n    };\n\n    return NextResponse.json({\n      users,\n      pagination: {\n        page,\n        limit,\n        total: totalCount,\n        totalPages: Math.ceil(totalCount / limit),\n      },\n      stats\n    });\n  } catch (error) {\n    console.error('Error fetching users for verification:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/vendors/[id]/approve/route.ts",
      "lang": "ts",
      "size": 3690,
      "lines": 124,
      "hash": "72c54916a8e70f80a5b629db9650c8718081a04ba2a6853921d922554cc667bd",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { z } from 'zod';\n\n// Schema for validating vendor approval\nconst approveVendorSchema = z.object({\n  approve: z.boolean(),\n});\n\n// PATCH /api/reviewer/vendors/[id]/approve - Approve or reject vendor registration\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can approve vendors\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const body = await request.json();\n    const { approve } = approveVendorSchema.parse(body);\n\n    // Find the vendor user\n    const vendor = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id,\n        role: 'VENDOR'\n      },\n      select: {\n        id: true,\n        email: true,\n        officer_name: true,\n        vendor_name: true,\n        verified_at: true,\n      }\n    });\n\n    if (!vendor) {\n      return NextResponse.json({ error: 'Vendor not found' }, { status: 404 });\n    }\n\n    if (vendor.verified_at) {\n      return NextResponse.json({ error: 'Vendor is already verified' }, { status: 400 });\n    }\n\n    if (approve) {\n      // Approve the vendor\n      const updatedVendor = await prisma.user.update({\n        where: { id: resolvedParams.id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n        },\n        select: {\n          id: true,\n          email: true,\n          officer_name: true,\n          vendor_name: true,\n          verified_at: true,\n        }\n      });\n\n      // Create notification for the vendor\n      await prisma.notification.create({\n        data: {\n          scope: 'vendor',\n          vendor_id: vendor.id,\n          type: 'vendor_approved',\n          title: 'Akun Vendor Disetujui',\n          message: 'Selamat! Akun vendor Anda telah disetujui dan dapat mulai mengajukan Simlok.',\n          data: JSON.stringify({\n            vendorId: vendor.id,\n            approvedBy: session.user.officer_name,\n          }),\n        }\n      });\n\n      return NextResponse.json({ \n        vendor: updatedVendor,\n        message: 'Vendor approved successfully'\n      });\n    } else {\n      // For rejection, we might want to delete the vendor or mark as rejected\n      // For now, let's just create a notification\n      await prisma.notification.create({\n        data: {\n          scope: 'vendor',\n          vendor_id: vendor.id,\n          type: 'vendor_rejected',\n          title: 'Akun Vendor Ditolak',\n          message: 'Maaf, akun vendor Anda ditolak. Silakan hubungi administrator untuk informasi lebih lanjut.',\n          data: JSON.stringify({\n            vendorId: vendor.id,\n            rejectedBy: session.user.officer_name,\n          }),\n        }\n      });\n\n      return NextResponse.json({ \n        message: 'Vendor registration rejected'\n      });\n    }\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ \n        error: 'Validation error', \n        details: error.issues \n      }, { status: 400 });\n    }\n    \n    console.error('Error processing vendor approval:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/reviewer/worker-photos/[photoId]/route.ts",
      "lang": "ts",
      "size": 2474,
      "lines": 78,
      "hash": "dad5b6833ef52a07ed9189d9d95bb01804b6066a60b3aa14f73a4d4e4e058c52",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport fs from 'fs/promises';\nimport path from 'path';\n\n// DELETE /api/reviewer/worker-photos/[photoId] - Delete worker photo\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ photoId: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only REVIEWER, ADMIN, or SUPER_ADMIN can access this endpoint\n    if (!['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Reviewer access required' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    \n    // Find the worker and check if the submission is still editable\n    const worker = await prisma.workerList.findUnique({\n      where: { id: resolvedParams.photoId },\n      include: {\n        submission: {\n          select: {\n            id: true,\n            final_status: true,\n          }\n        }\n      }\n    });\n\n    if (!worker) {\n      return NextResponse.json({ error: 'Worker not found' }, { status: 404 });\n    }\n\n    // Cannot delete photos after submission is finalized\n    if (worker.submission.final_status !== 'PENDING_APPROVAL') {\n      return NextResponse.json({ \n        error: 'Cannot delete worker photo after submission has been finalized' \n      }, { status: 400 });\n    }\n\n    // If worker has a photo, delete the file\n    if (worker.worker_photo) {\n      try {\n        const photoPath = path.join(process.cwd(), 'public', worker.worker_photo);\n        await fs.unlink(photoPath);\n      } catch (fileError) {\n        console.warn('Failed to delete photo file:', fileError);\n        // Continue with database deletion even if file deletion fails\n      }\n    }\n\n    // Update worker to remove photo reference\n    const updatedWorker = await prisma.workerList.update({\n      where: { id: params.photoId },\n      data: {\n        worker_photo: null,\n      }\n    });\n\n    return NextResponse.json({ \n      worker: updatedWorker,\n      message: 'Worker photo deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting worker photo:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/scan-history/route.ts",
      "lang": "ts",
      "size": 2908,
      "lines": 113,
      "hash": "40af42028055224dea76493e56db6e1234960fe4604db9dac628fcbcf1b649d4",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history\n    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const dateFrom = searchParams.get('dateFrom');\n    const dateTo = searchParams.get('dateTo');\n    const verifier = searchParams.get('verifier');\n    const submissionId = searchParams.get('submissionId');\n\n    const skip = (page - 1) * limit;\n\n    // Build filter conditions\n    const where: any = {};\n    \n    if (dateFrom || dateTo) {\n      where.scanned_at = {};\n      if (dateFrom) {\n        where.scanned_at.gte = new Date(dateFrom);\n      }\n      if (dateTo) {\n        // Add 1 day to include the entire date\n        const endDate = new Date(dateTo);\n        endDate.setDate(endDate.getDate() + 1);\n        where.scanned_at.lt = endDate;\n      }\n    }\n\n    if (verifier) {\n      where.user = {\n        officer_name: {\n          contains: verifier,\n          mode: 'insensitive'\n        }\n      };\n    }\n\n    if (submissionId) {\n      where.submission = {\n        simlok_number: {\n          contains: submissionId,\n          mode: 'insensitive'\n        }\n      };\n    }\n\n    // Get total count for pagination\n    const total = await prisma.qrScan.count({ where });\n\n    // Get scan history with related data\n    const scans = await prisma.qrScan.findMany({\n      where,\n      include: {\n        submission: {\n          select: {\n            id: true,\n            simlok_number: true,\n            vendor_name: true,\n            job_description: true,\n            review_status: true,\n            final_status: true,\n          }\n        },\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      },\n      skip,\n      take: limit,\n    });\n\n    return NextResponse.json({\n      scans,\n      total,\n      page,\n      limit,\n      totalPages: Math.ceil(total / limit)\n    });\n\n  } catch (error) {\n    console.error('Error fetching scan history:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/socket/route.ts",
      "lang": "ts",
      "size": 487,
      "lines": 22,
      "hash": "f101da92aab2b5a7850cff49e0239bd0b2edbde2a806ae5f18acb4b47647c30b",
      "truncated": false,
      "content": "import { io } from '@/server/socket';\nimport { NextRequest } from 'next/server';\n\nexport const runtime = 'nodejs';\n\nexport async function GET(_request: NextRequest) {\n  if (!io.httpServer) {\n    // Attach to global server if not attached\n    const server = (globalThis as any).__socket_server;\n    if (server) {\n      io.attach(server);\n    }\n  }\n  \n  return new Response('Socket.IO server is running', { \n    status: 200,\n    headers: {\n      'Content-Type': 'text/plain'\n    }\n  });\n}\n"
    },
    {
      "path": "src/app/api/submissions/[id]/route.ts",
      "lang": "ts",
      "size": 16349,
      "lines": 474,
      "hash": "3d81b9e257d5a494acea4ff5a44020c04631b94dce5a5543dfc6255771790bbb",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { generateSIMLOKPDF, type SubmissionPDFData } from '@/utils/pdf/simlokTemplate';\nimport { notifyVendorStatusChange } from '@/server/events';\nimport { cleanupSubmissionNotifications } from '@/lib/notificationCleanup';\nimport { generateQrString } from '@/lib/qr-security';\n\n// Function to generate auto SIMLOK number\nasync function generateSimlokNumber(): Promise<string> {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n  // Get the last SIMLOK number for current month/year\n  const lastSubmission = await prisma.submission.findFirst({\n    where: {\n      simlok_number: {\n        contains: `/${month}/${year}`\n      }\n    },\n    orderBy: {\n      simlok_number: 'desc'\n    }\n  });\n\n  let nextNumber = 1;\n  \n  if (lastSubmission?.simlok_number) {\n    // Extract number from format: number/MM/YYYY\n    const match = lastSubmission.simlok_number.match(/^(\\d+)\\/\\d{2}\\/\\d{4}$/);\n    if (match && match[1]) {\n      nextNumber = parseInt(match[1]) + 1;\n    }\n  }\n\n  return `${nextNumber}/${month}/${year}`;\n}\n\ninterface RouteParams {\n  params: Promise<{\n    id: string;\n  }>;\n}\n\n// GET /api/submissions/[id] - Get single submission with optional PDF generation\nexport async function GET(request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const { searchParams } = new URL(request.url);\n    const isPdfRequest = searchParams.get('format') === 'pdf';\n\n    // Fetch submission with user and approved by user details\n    const submission = await prisma.submission.findFirst({\n      where: { \n        id,\n        // Vendors can only see their own submissions\n        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        },\n        worker_list: {\n          orderBy: {\n            created_at: 'asc'\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Check permissions\n    if (session.user.role === 'VENDOR' && submission.user_id !== session.user.id) {\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n    }\n\n    // If PDF is requested, generate and return PDF\n    if (isPdfRequest) {\n      return generatePDF(submission);\n    }\n\n    // Return regular JSON response\n    const response = NextResponse.json(submission);\n    \n    // Add cache control for better performance\n    response.headers.set('Cache-Control', 'private, max-age=60, stale-while-revalidate=300');\n    \n    return response;\n  } catch (error) {\n    console.error('Error fetching submission:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// Helper function to generate PDF\nasync function generatePDF(submission: any) {\n  try {\n    console.log('PDF Generation Debug:', {\n      submissionId: submission.id,\n      approval_status: submission.approval_status,\n      final_status: submission.final_status,\n      simlok_number: submission.simlok_number,\n      has_simlok_number: !!submission.simlok_number\n    });\n\n    // Allow PDF generation for any submission\n    // If no simlok_number, use a placeholder or generate temporary one\n    const pdfData = { ...submission };\n    \n    if (!submission.simlok_number) {\n      console.log('PDF Generation: Using placeholder simlok_number');\n      // Create a temporary/placeholder SIMLOK number for PDF preview\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      pdfData.simlok_number = `[DRAFT]/XX/${month}/${year}`;\n      pdfData.simlok_date = now;\n    }\n\n    // Generate PDF using the template with potentially modified data\n    const pdfBytes = await generateSIMLOKPDF(pdfData as SubmissionPDFData);\n\n    // Generate filename based on simlok_number (including placeholder)\n    const filename = pdfData.simlok_number ? \n      `SIMLOK_${pdfData.simlok_number.replace(/[\\[\\]/\\\\]/g, '_')}.pdf` :\n      `SIMLOK_PREVIEW_${submission.id}.pdf`;\n\n    // Return PDF response\n    return new NextResponse(Buffer.from(pdfBytes), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': `inline; filename=\"${filename}\"`,\n      },\n    });\n\n  } catch (error) {\n    console.error('Error generating PDF:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate PDF' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT /api/submissions/[id] - Update submission (Admin for approval, Vendor for editing PENDING submissions)\nexport async function PUT(request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    console.log('PUT /api/submissions/[id] - Session:', {\n      userId: session?.user?.id,\n      role: session?.user?.role,\n      email: session?.user?.email\n    });\n    \n    if (!session?.user) {\n      console.log('PUT /api/submissions/[id] - No session found');\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    console.log('PUT /api/submissions/[id] - Submission ID:', id);\n\n    // First, fetch the existing submission\n    const existingSubmission = await prisma.submission.findFirst({\n      where: { \n        id,\n        // Vendors can only edit their own submissions\n        ...(session.user.role === 'VENDOR' ? { user_id: session.user.id } : {})\n      }\n    });\n\n    console.log('PUT /api/submissions/[id] - Existing submission:', {\n      found: !!existingSubmission,\n      status: existingSubmission?.approval_status,\n      userId: existingSubmission?.user_id\n    });\n\n    if (!existingSubmission) {\n      console.log('PUT /api/submissions/[id] - Submission not found or access denied');\n      return NextResponse.json({ error: 'Submission not found or access denied' }, { status: 404 });\n    }\n\n    // Check permissions based on role\n    if (session.user.role === 'VENDOR') {\n      // Vendors can only edit PENDING submissions and only their own\n      if (existingSubmission.user_id !== session.user.id) {\n        console.log('PUT /api/submissions/[id] - Access denied: not owner');\n        return NextResponse.json({ error: 'Access denied' }, { status: 403 });\n      }\n      \n      if (existingSubmission.approval_status !== 'PENDING') {\n        console.log('PUT /api/submissions/[id] - Cannot edit non-pending submission');\n        return NextResponse.json({ \n          error: 'Can only edit pending submissions' \n        }, { status: 400 });\n      }\n    }\n\n    const body = await request.json();\n    console.log('PUT /api/submissions/[id] - Request body keys:', Object.keys(body));\n\n    const updateData: any = {};\n    let statusChanged = false;\n    let newStatus: 'PENDING' | 'APPROVED' | 'REJECTED' | undefined;\n\n    // Handle different types of updates based on user role\n    if (session.user.role === 'ADMIN' || session.user.role === 'VERIFIER') {\n      // Admin/Verifier updating approval status\n      if (body.status_approval_admin && ['APPROVED', 'REJECTED'].includes(body.status_approval_admin)) {\n        console.log('PUT /api/submissions/[id] - Admin/Verifier approval update');\n        console.log('PUT /api/submissions/[id] - Session user ID:', session.user.id);\n        console.log('PUT /api/submissions/[id] - Session user role:', session.user.role);\n        \n        const approvalData: any = {\n          approval_status: body.status_approval_admin,\n          notes: body.keterangan,\n          simlok_date: body.tanggal_simlok ? new Date(body.tanggal_simlok) : undefined,\n        };\n\n        // Track status change for notification\n        if (existingSubmission.approval_status !== body.status_approval_admin) {\n          statusChanged = true;\n          newStatus = body.status_approval_admin;\n        }\n\n        // Only add fields that are provided and valid\n        Object.entries(approvalData).forEach(([key, value]) => {\n          if (value !== undefined && value !== null && value !== '') {\n            updateData[key] = value;\n          }\n        });\n\n        // If approving, add additional fields\n        if (body.status_approval_admin === 'APPROVED') {\n          // Generate auto SIMLOK number\n          const autoSimlokNumber = await generateSimlokNumber();\n          updateData.simlok_number = autoSimlokNumber;\n          \n          updateData.implementation = body.pelaksanaan;\n          updateData.other_notes = body.lain_lain;\n          updateData.content = body.content;\n          updateData.signer_position = body.jabatan_signer;\n          updateData.signer_name = body.nama_signer;\n          \n          // Add implementation date range if provided\n          if (body.implementation_start_date) {\n            updateData.implementation_start_date = new Date(body.implementation_start_date);\n          }\n          if (body.implementation_end_date) {\n            updateData.implementation_end_date = new Date(body.implementation_end_date);\n          }\n          \n          // Generate secure QR code with implementation dates\n          const qrString = generateQrString({\n            id: id,\n            implementation_start_date: body.implementation_start_date ? new Date(body.implementation_start_date) : null,\n            implementation_end_date: body.implementation_end_date ? new Date(body.implementation_end_date) : null,\n          });\n          updateData.qrcode = qrString;\n          \n          // Verify the user exists before setting approved_by\n          const adminUser = await prisma.user.findUnique({\n            where: { id: session.user.id }\n          });\n          \n          if (adminUser) {\n            updateData.approved_by = session.user.id;\n          } else {\n            console.log('PUT /api/submissions/[id] - Admin user not found:', session.user.id);\n            return NextResponse.json({ \n              error: 'Your session is no longer valid. Please log out and log back in to continue.',\n              code: 'INVALID_SESSION'\n            }, { status: 401 });\n          }\n        }\n      } else {\n        console.log('PUT /api/submissions/[id] - Invalid approval status:', body.status_approval_admin);\n        return NextResponse.json({ \n          error: 'Invalid approval status. Must be APPROVED or REJECTED' \n        }, { status: 400 });\n      }\n    } else if (session.user.role === 'VENDOR') {\n      // Vendor updating their submission\n      console.log('PUT /api/submissions/[id] - Vendor update');\n      \n      // Only allow vendor to update certain fields and only if submission is PENDING\n      const allowedFields = [\n        'vendor_name', 'based_on', 'officer_name', 'job_description', \n        'work_location', 'working_hours', 'work_facilities', 'worker_count',\n        'simja_number', 'simja_date', 'sika_number', 'sika_date', 'worker_names',\n        'sika_document_upload', 'simja_document_upload'\n      ];\n\n      allowedFields.forEach(field => {\n        if (body[field] !== undefined) {\n          updateData[field] = body[field];\n        }\n      });\n\n      // Handle date fields\n      if (body.simja_date) {\n        updateData.simja_date = new Date(body.simja_date);\n      }\n      if (body.sika_date) {\n        updateData.sika_date = new Date(body.sika_date);\n      }\n\n    }\n\n    // Perform the update\n    const updatedSubmission = await prisma.submission.update({\n      where: { id },\n      data: updateData,\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true,\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n          }\n        }\n      }\n    });\n\n    // Handle workers if provided (only for vendor updates)\n    if (session.user.role === 'VENDOR' && body.workers && Array.isArray(body.workers)) {\n      // Delete existing workers for this submission\n      await prisma.workerList.deleteMany({\n        where: {\n          submission_id: id\n        }\n      });\n\n      // Create new workers\n      const validWorkers = body.workers.filter((worker: any) => \n        worker.worker_name && worker.worker_name.trim() !== ''\n      );\n\n      if (validWorkers.length > 0) {\n        await prisma.workerList.createMany({\n          data: validWorkers.map((worker: any) => ({\n            worker_name: worker.worker_name.trim(),\n            worker_photo: worker.worker_photo || null,\n            submission_id: id\n          }))\n        });\n      }\n    }\n\n    // Notify vendor if status changed\n    if (statusChanged && newStatus && existingSubmission.user_id) {\n      await notifyVendorStatusChange(\n        existingSubmission.user_id,\n        id,\n        newStatus\n      );\n    }\n\n    console.log('PUT /api/submissions/[id] - Update successful');\n    return NextResponse.json(updatedSubmission);\n  } catch (error) {\n    console.error('PUT /api/submissions/[id] - Error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// DELETE /api/submissions/[id] - Delete submission \nexport async function DELETE(_request: NextRequest, { params }: RouteParams) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n\n    // Fetch the submission first to check permissions\n    const existingSubmission = await prisma.submission.findUnique({\n      where: { id }\n    });\n\n    if (!existingSubmission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Permission checks based on role\n    if (session.user.role === 'VENDOR') {\n      // Vendors can only delete their own PENDING submissions\n      if (existingSubmission.user_id !== session.user.id) {\n        return NextResponse.json({ \n          error: 'Access denied. You can only delete your own submissions.' \n        }, { status: 403 });\n      }\n      \n      if (existingSubmission.approval_status !== 'PENDING') {\n        return NextResponse.json({ \n          error: 'Can only delete pending submissions. Approved or rejected submissions cannot be deleted.' \n        }, { status: 400 });\n      }\n    } else if (session.user.role === 'ADMIN') {\n      // Admins can delete any submission, but warn about approved ones\n      if (existingSubmission.approval_status === 'APPROVED') {\n        return NextResponse.json({ \n          error: 'Cannot delete approved submissions. This would affect issued SIMLOK documents.' \n        }, { status: 400 });\n      }\n    } else if (session.user.role === 'VERIFIER') {\n      // Verifiers can delete pending and rejected submissions\n      if (existingSubmission.approval_status === 'APPROVED') {\n        return NextResponse.json({ \n          error: 'Cannot delete approved submissions.' \n        }, { status: 400 });\n      }\n    } else {\n      return NextResponse.json({ \n        error: 'Invalid role. Only admins, verifiers, and vendors can delete submissions.' \n      }, { status: 403 });\n    }\n\n    // Clean up related notifications before deleting submission\n    await cleanupSubmissionNotifications(id);\n\n    // Delete the submission\n    await prisma.submission.delete({\n      where: { id }\n    });\n\n    return NextResponse.json({ \n      message: 'Submission deleted successfully',\n      deletedId: id \n    });\n\n  } catch (error) {\n    console.error('Error deleting submission:', error);\n    return NextResponse.json({ \n      error: 'Internal server error. Please try again later.' \n    }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/submissions/[id]/scans/route.ts",
      "lang": "ts",
      "size": 1682,
      "lines": 65,
      "hash": "cffdc6fd9e1cafd4c0eac816fee861665978eedf025c824d7b5ecc9cce04260a",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Only allow REVIEWER, APPROVER, ADMIN, SUPER_ADMIN to access scan history\n    if (!['REVIEWER', 'APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\n    }\n\n    const resolvedParams = await params;\n    const submissionId = resolvedParams.id;\n\n    // Get scan history for the specific submission\n    const scans = await prisma.qrScan.findMany({\n      where: {\n        submission_id: submissionId\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            role: true,\n          }\n        }\n      },\n      orderBy: {\n        scanned_at: 'desc'\n      }\n    });\n\n    // Get total scan count\n    const totalScans = scans.length;\n    const lastScan = scans[0] || null;\n\n    return NextResponse.json({\n      scans,\n      totalScans,\n      lastScan,\n      hasBeenScanned: totalScans > 0\n    });\n\n  } catch (error) {\n    console.error('Error fetching submission scan history:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/submissions/[id]/workers/route.ts",
      "lang": "ts",
      "size": 1554,
      "lines": 62,
      "hash": "171feb2acd4ca8be50e9c91a2597988cc35e45ed2f3482d380f5718d888bebd9",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\n\ninterface Params {\n  id: string;\n}\n\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<Params> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n\n    // Get submission - allow admin/reviewer/approver to access any submission, vendor only their own\n    let submission;\n    \n    if (['ADMIN', 'SUPER_ADMIN', 'REVIEWER', 'APPROVER'].includes(session.user.role)) {\n      submission = await prisma.submission.findUnique({\n        where: { id: id }\n      });\n    } else {\n      submission = await prisma.submission.findFirst({\n        where: {\n          id: id,\n          user_id: session.user.id\n        }\n      });\n    }\n\n    if (!submission) {\n      return NextResponse.json({ error: 'Submission not found' }, { status: 404 });\n    }\n\n    // Get workers for this submission\n    const workers = await prisma.workerList.findMany({\n      where: {\n        submission_id: id\n      },\n      orderBy: {\n        created_at: 'asc'\n      }\n    });\n\n    return NextResponse.json({ workers });\n  } catch (error) {\n    console.error('Error fetching workers:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/submissions/route.ts",
      "lang": "ts",
      "size": 8367,
      "lines": 262,
      "hash": "e260d5dd262454b4362765e934ff5b77ff19c09aa25c40c28e03bac08d8f1c8d",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/singletons';\nimport { SubmissionData } from '@/types/submission';\nimport { notifyAdminNewSubmission } from '@/server/events';\n\n// GET /api/submissions - Get all submissions\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const status = searchParams.get('status');\n    const search = searchParams.get('search') || '';\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const vendorName = searchParams.get('vendor');\n    const includeStats = searchParams.get('stats') === 'true';\n    const skip = (page - 1) * limit;\n\n    const whereClause: any = {};\n\n    // Filter by role\n    if (session.user.role === 'VENDOR') {\n      whereClause.user_id = session.user.id;\n    }\n\n    // Filter by status if provided\n    if (status) {\n      whereClause.approval_status = status;\n    }\n\n    // Filter by vendor name if provided (admin/verifier only)\n    if (vendorName && session.user.role !== 'VENDOR') {\n      whereClause.vendor_name = {\n        contains: vendorName\n      };\n    }\n\n    // Add search functionality\n    if (search) {\n      const searchConditions = [\n        { vendor_name: { contains: search } },\n        { officer_name: { contains: search } },\n        { job_description: { contains: search } },\n        { work_location: { contains: search } },\n        { worker_names: { contains: search } }\n      ];\n      \n      whereClause.OR = searchConditions;\n    }\n\n    // Prepare orderBy\n    const orderBy: any = {};\n    orderBy[sortBy] = sortOrder;\n\n    const [submissions, total] = await Promise.all([\n      prisma.submission.findMany({\n        where: whereClause,\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          },\n          approved_by_user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n            }\n          }\n        },\n        orderBy: orderBy,\n        skip,\n        take: limit,\n      }),\n      prisma.submission.count({ where: whereClause }),\n    ]);\n\n    const response: any = {\n      submissions,\n      pagination: {\n        page,\n        limit,\n        total,\n        pages: Math.ceil(total / limit),\n      }\n    };\n\n    // Include statistics for admin requests\n    if (includeStats && session.user.role === 'ADMIN') {\n      const statistics = await prisma.submission.groupBy({\n        by: ['approval_status'],\n        _count: {\n          approval_status: true\n        }\n      });\n\n      response.statistics = {\n        total: total,\n        pending: statistics.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n        approved: statistics.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n        rejected: statistics.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n      };\n    }\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error('Error fetching submissions:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n\n// POST /api/submissions - Create new submission\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Debug logging\n    console.log('POST /api/submissions - Session user:', {\n      id: session.user.id,\n      email: session.user.email,\n      role: session.user.role\n    });\n\n    // Only VENDOR can create submissions\n    if (session.user.role !== 'VENDOR') {\n      return NextResponse.json({ error: 'Only vendors can create submissions' }, { status: 403 });\n    }\n\n    const body: SubmissionData = await request.json();\n    \n    // Debug logging for received data\n    console.log('POST /api/submissions - Received data:', {\n      ...body,\n      // Don't log sensitive data, just check if required fields exist\n      hasRequiredFields: {\n        vendor_name: !!body.vendor_name,\n        based_on: !!body.based_on,\n        officer_name: !!body.officer_name,\n        job_description: !!body.job_description,\n        work_location: !!body.work_location,\n        working_hours: !!body.working_hours,\n        work_facilities: !!body.work_facilities,\n        worker_names: !!body.worker_names\n      }\n    });\n\n    // Validate required fields\n    const requiredFields = [\n      'vendor_name', 'based_on', 'officer_name', 'job_description', \n      'work_location', 'working_hours', 'work_facilities', 'worker_names'\n    ];\n\n    for (const field of requiredFields) {\n      if (!body[field as keyof SubmissionData]) {\n        console.log(`POST /api/submissions - Missing required field: ${field}`);\n        return NextResponse.json({ \n          error: `Field ${field} is required` \n        }, { status: 400 });\n      }\n    }\n\n    // Validate session user ID\n    if (!session.user.id) {\n      console.log('POST /api/submissions - Session user ID is missing');\n      return NextResponse.json({ \n        error: 'User ID not found in session' \n      }, { status: 400 });\n    }\n\n    // Verify user exists in database\n    const userExists = await prisma.user.findUnique({\n      where: { id: session.user.id }\n    });\n\n    if (!userExists) {\n      console.log('POST /api/submissions - User not found in database:', session.user.id);\n      return NextResponse.json({ \n        error: 'User not found in database' \n      }, { status: 400 });\n    }\n\n    console.log('POST /api/submissions - User verified:', userExists.email);\n\n    // Extract workers data and remove it from body since it's not part of Submission model\n    const { workers, ...submissionData } = body as any;\n\n    // Generate QR Code (simple implementation)\n    const qrData = `${session.user.id}-${Date.now()}`;\n    \n    try {\n      // Create submission first\n      const submission = await prisma.submission.create({\n        data: {\n          ...submissionData,\n          user_id: session.user.id,\n          vendor_phone: userExists.phone_number, // Auto-fill dari data user\n          worker_count: submissionData.worker_count || null,\n          simja_date: submissionData.simja_date ? new Date(submissionData.simja_date) : null,\n          sika_date: submissionData.sika_date ? new Date(submissionData.sika_date) : null,\n          qrcode: qrData,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              officer_name: true,\n              email: true,\n              vendor_name: true,\n            }\n          }\n        }\n      });\n\n      // Create workers if they exist\n      if (workers && Array.isArray(workers) && workers.length > 0) {\n        const workersData = workers.map((worker: any) => ({\n          worker_name: worker.worker_name,\n          worker_photo: worker.worker_photo || null,\n          submission_id: submission.id,\n        }));\n\n        await prisma.workerList.createMany({\n          data: workersData,\n        });\n\n        console.log('POST /api/submissions - Workers created:', workersData.length);\n      }\n\n      // Notify admin about new submission\n      await notifyAdminNewSubmission(submission.id);\n\n      console.log('POST /api/submissions - Submission created successfully:', submission.id);\n      return NextResponse.json(submission, { status: 201 });\n    } catch (dbError) {\n      console.error('POST /api/submissions - Database error:', dbError);\n      return NextResponse.json({ \n        error: 'Failed to create submission in database' \n      }, { status: 500 });\n    }\n  } catch (error) {\n    console.error('POST /api/submissions - General error:', error);\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/test/notification/route.ts",
      "lang": "ts",
      "size": 1254,
      "lines": 39,
      "hash": "94146e421e3b0ef75b5485bf081575fcbb4fe3d937ad27eaf6b5f110dc079ce5",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { notifyAdminNewSubmission } from '@/server/events';\n\nexport async function POST(request: NextRequest) {\n  const session = await getServerSession(authOptions);\n  \n  if (!session?.user || session.user.role !== 'ADMIN') {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  try {\n    const body = await request.json();\n    const { submissionId } = body;\n\n    if (!submissionId) {\n      return NextResponse.json({ error: 'submissionId is required' }, { status: 400 });\n    }\n\n    console.log('🧪 Test: Triggering notification for submission:', submissionId);\n    \n    // Trigger the same notification system used for real submissions\n    await notifyAdminNewSubmission(submissionId);\n    \n    return NextResponse.json({ \n      success: true, \n      message: 'Test notification sent',\n      submissionId \n    });\n  } catch (error) {\n    console.error('❌ Test notification error:', error);\n    return NextResponse.json({ \n      error: 'Failed to send test notification',\n      details: error instanceof Error ? error.message : 'Unknown error'\n    }, { status: 500 });\n  }\n}\n"
    },
    {
      "path": "src/app/api/upload/enhanced/route.ts",
      "lang": "ts",
      "size": 6039,
      "lines": 186,
      "hash": "3cb353409fa866306e91ce6b16f0991cf7c251872275361d823c1c26dbe73e06",
      "truncated": false,
      "content": "/**\n * Enhanced File Upload API with Validation and Compression\n * Demonstrates integration of FileValidationService and FileCompressionService\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { writeFile, mkdir } from 'fs/promises';\nimport { join } from 'path';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { FileValidationService } from '@/services/FileValidationService';\nimport { FileCompressionService } from '@/services/FileCompressionService';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const category = formData.get('category') as string || 'other';\n    \n    if (!file) {\n      return NextResponse.json(\n        { error: 'No file provided' },\n        { status: 400 }\n      );\n    }\n\n    // Create uploads directory\n    const uploadsDir = join(process.cwd(), 'uploads', 'temp');\n    await mkdir(uploadsDir, { recursive: true });\n\n    // Save temporary file\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    \n    const originalName = file.name;\n    const tempFilePath = join(uploadsDir, `temp_${Date.now()}_${originalName}`);\n    await writeFile(tempFilePath, buffer);\n\n    try {\n      // Step 1: Validate file\n      console.log('🔍 Validating file:', originalName);\n      const validationResult = await FileValidationService.validateSIMLOKFile(\n        tempFilePath,\n        originalName,\n        category as 'sika' | 'simja' | 'id_card' | 'other'\n      );\n\n      if (!validationResult.isValid) {\n        return NextResponse.json(\n          { \n            error: 'File validation failed',\n            message: validationResult.error,\n            securityChecks: validationResult.securityChecks\n          },\n          { status: 400 }\n        );\n      }\n\n      // Step 2: Compress file if needed\n      console.log('🗜️ Compressing file if needed...');\n      let compressionApplied = false;\n      \n      if (FileCompressionService.canCompress(validationResult.mimeType)) {\n        const compressionResult = await FileCompressionService.compressFile(\n          tempFilePath,\n          {\n            quality: 60, // 40% compression for mobile optimization\n            maxSizeBytes: 2 * 1024 * 1024, // 2MB max\n            outputDir: uploadsDir,\n          }\n        );\n\n        if (compressionResult.success && compressionResult.outputPath) {\n          compressionApplied = true;\n          console.log(`✅ Compression successful: ${compressionResult.originalSize} -> ${compressionResult.compressedSize}`);\n        }\n      }\n\n      // Step 3: Move to permanent location (simulation)\n      const finalDir = join(process.cwd(), 'uploads', category, session.user.id);\n      await mkdir(finalDir, { recursive: true });\n      \n      const finalFileName = `${Date.now()}_${originalName}`;\n      const permanentPath = join(finalDir, finalFileName);\n      \n      // In a real implementation, you would move the file and save to database\n      console.log('📁 Final file path:', permanentPath);\n\n      // Step 4: Return success response\n      const response = {\n        success: true,\n        message: 'File uploaded successfully',\n        file: {\n          originalName,\n          finalName: finalFileName,\n          size: validationResult.size,\n          mimeType: validationResult.mimeType,\n          category,\n        },\n        validation: {\n          isValid: validationResult.isValid,\n          securityChecks: validationResult.securityChecks,\n        },\n        compression: compressionApplied ? {\n          applied: true,\n          originalSize: validationResult.size,\n          // In real implementation, get actual compressed size\n          compressedSize: Math.floor(validationResult.size * 0.6),\n          quality: 60,\n        } : {\n          applied: false,\n          reason: 'File type does not support compression or already within size limits'\n        },\n        paths: {\n          category,\n          fileName: finalFileName,\n          relativePath: `/uploads/${category}/${session.user.id}/${finalFileName}`,\n        }\n      };\n\n      return NextResponse.json(response, { status: 200 });\n\n    } catch (processingError) {\n      console.error('File processing error:', processingError);\n      return NextResponse.json(\n        { \n          error: 'File processing failed',\n          message: processingError instanceof Error ? processingError.message : 'Unknown processing error'\n        },\n        { status: 500 }\n      );\n    }\n\n  } catch (error) {\n    console.error('File upload error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Get upload limits and allowed types\nexport async function GET() {\n  const config = {\n    maxFileSize: '10MB',\n    allowedTypes: [\n      'image/jpeg',\n      'image/png',\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    ],\n    allowedExtensions: [\n      '.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'\n    ],\n    categories: [\n      { id: 'sika', name: 'SIKA Documents', allowedTypes: ['image/*', 'application/pdf'] },\n      { id: 'simja', name: 'SIMJA Documents', allowedTypes: ['image/*', 'application/pdf'] },\n      { id: 'id_card', name: 'ID Card', allowedTypes: ['image/*'] },\n      { id: 'other', name: 'Other Documents', allowedTypes: ['image/*', 'application/pdf'] },\n    ],\n    compression: {\n      enabled: true,\n      targetSize: '1-2MB',\n      quality: '60% (40% compression)',\n      supportedFormats: ['JPEG', 'PNG', 'PDF']\n    },\n    validation: {\n      magicBytesCheck: true,\n      malwareScanning: true,\n      fileSignatureValidation: true,\n    }\n  };\n\n  return NextResponse.json(config);\n}"
    },
    {
      "path": "src/app/api/upload/route.ts",
      "lang": "ts",
      "size": 2961,
      "lines": 101,
      "hash": "aee0482a870743b61fbb219bb6c21ccb05461cc3ac0412a7cc72097628b87eb8",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// Configure maximum file size (8MB)\nconst MAX_FILE_SIZE = 8 * 1024 * 1024;\n\n// Allowed file types\nconst ALLOWED_TYPES = [\n  'application/pdf',\n  'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'image/jpeg',\n  'image/jpg', \n  'image/png',\n  'image/gif'\n];\n\n// Allowed file extensions\nconst ALLOWED_EXTENSIONS = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif'];\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File | null;\n    const fieldName = formData.get('fieldName') as string | null; // Optional field to determine category\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });\n    }\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      return NextResponse.json({ \n        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` \n      }, { status: 400 });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return NextResponse.json({ \n        error: `File type not supported. Allowed types: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Validate file extension\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {\n      return NextResponse.json({ \n        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Convert file to buffer\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n\n    // Save file using FileManager\n    const fileInfo = await fileManager.saveFile(\n      buffer,\n      file.name,\n      session.user.id,\n      fieldName || undefined\n    );\n\n    return NextResponse.json({\n      success: true,\n      url: fileInfo.url,\n      filename: fileInfo.newName,\n      originalName: fileInfo.originalName,\n      size: fileInfo.size,\n      type: fileInfo.type,\n      category: fileInfo.category,\n      path: fileInfo.path\n    });\n\n  } catch (error) {\n    console.error('Upload error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error during file upload' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/upload - Get upload info (optional)\nexport async function GET() {\n  return NextResponse.json({\n    maxFileSize: MAX_FILE_SIZE,\n    allowedTypes: ALLOWED_TYPES,\n    allowedExtensions: ALLOWED_EXTENSIONS\n  });\n}\n"
    },
    {
      "path": "src/app/api/upload/worker-photo/route.ts",
      "lang": "ts",
      "size": 3042,
      "lines": 103,
      "hash": "def1364d87576726295e312a76878e1b69b0a327183bcb165d816ec463937da5",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { fileManager } from '@/lib/fileManager';\n\n// Configure maximum file size (8MB)\nconst MAX_FILE_SIZE = 8 * 1024 * 1024;\n\n// Allowed image types for worker photos\nconst ALLOWED_TYPES = [\n  'image/jpeg',\n  'image/jpg', \n  'image/png'\n];\n\n// Allowed image extensions\nconst ALLOWED_EXTENSIONS = ['.jpg', '.jpeg', '.png'];\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check authentication\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File | null;\n    const workerName = formData.get('workerName') as string | null;\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });\n    }\n\n    if (!workerName) {\n      return NextResponse.json({ error: 'Worker name is required' }, { status: 400 });\n    }\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      return NextResponse.json({ \n        error: `File size too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` \n      }, { status: 400 });\n    }\n\n    // Validate file type\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return NextResponse.json({ \n        error: `File type not supported. Only images are allowed: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Validate file extension\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    if (!ALLOWED_EXTENSIONS.includes(fileExtension)) {\n      return NextResponse.json({ \n        error: `File extension not supported. Allowed extensions: ${ALLOWED_EXTENSIONS.join(', ')}` \n      }, { status: 400 });\n    }\n\n    // Convert file to buffer\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n\n    // Save worker photo using special method\n    const fileInfo = await fileManager.saveWorkerPhoto(\n      buffer,\n      file.name,\n      session.user.id,\n      workerName\n    );\n\n    return NextResponse.json({\n      success: true,\n      url: fileInfo.url,\n      filename: fileInfo.newName,\n      originalName: fileInfo.originalName,\n      workerName: workerName,\n      size: fileInfo.size,\n      type: fileInfo.type,\n      category: fileInfo.category,\n      path: fileInfo.path\n    });\n\n  } catch (error) {\n    console.error('Worker photo upload error:', error);\n    return NextResponse.json({ \n      error: 'Internal server error during worker photo upload' \n    }, { status: 500 });\n  }\n}\n\n// GET /api/upload/worker-photo - Get upload info\nexport async function GET() {\n  return NextResponse.json({\n    maxFileSize: MAX_FILE_SIZE,\n    allowedTypes: ALLOWED_TYPES,\n    allowedExtensions: ALLOWED_EXTENSIONS,\n    description: 'Upload endpoint for worker photos with worker name as filename'\n  });\n}\n"
    },
    {
      "path": "src/app/api/user/change-password/route.ts",
      "lang": "ts",
      "size": 1450,
      "lines": 52,
      "hash": "d2f7a0d9b5cc528afd020b24f0757c0d2a89e29d94a87ea516d72e8c4071ab74",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport bcrypt from \"bcryptjs\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function PUT(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n    if (!session?.user) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    const body = await req.json();\n    const { currentPassword, newPassword } = body;\n\n    // Get user from database\n    const user = await prisma.user.findUnique({\n      where: {\n        id: session.user.id,\n      },\n    });\n\n    if (!user) {\n      return new NextResponse(\"User not found\", { status: 404 });\n    }\n\n    // Verify current password\n    const isValidPassword = await bcrypt.compare(currentPassword, user.password);\n    if (!isValidPassword) {\n      return new NextResponse(\"Invalid current password\", { status: 400 });\n    }\n\n    // Hash new password\n    const hashedPassword = await bcrypt.hash(newPassword, 10);\n\n    // Update password in database\n    await prisma.user.update({\n      where: {\n        id: session.user.id,\n      },\n      data: {\n        password: hashedPassword,\n      },\n    });\n\n    return new NextResponse(\"Password updated successfully\", { status: 200 });\n  } catch (error) {\n    console.error(\"[PASSWORD_CHANGE_ERROR]\", error);\n    return new NextResponse(\"Internal Server Error\", { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/users/[id]/route.ts",
      "lang": "ts",
      "size": 5858,
      "lines": 221,
      "hash": "0d98ae7f75dd637ec2a925ddd771d7585f811934e79bc9112f185e03810113e8",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\nimport { Role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\n\n// Schema validasi untuk update user\nconst updateUserSchema = z.object({\n  officer_name: z.string().min(1, \"Nama petugas wajib diisi\").optional(),\n  email: z.string().email(\"Email tidak valid\").optional(),\n  password: z.string().min(6, \"Password minimal 6 karakter\").optional(),\n  role: z.nativeEnum(Role).optional(),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n  vendor_name: z.string().optional(),\n  verified_at: z.string().datetime().optional(),\n});\n\n// GET - Mengambil detail user berdasarkan ID\nexport async function GET(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== Role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const user = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json(user);\n\n  } catch (error) {\n    console.error(\"Error fetching user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengambil data user\" },\n      { status: 500 }\n    );\n  }\n}\n\n  // PUT - Update user\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== Role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n    const body = await request.json();\n    const validation = updateUserSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Data tidak valid\", details: validation.error.issues },\n        { status: 400 }\n      );\n    }\n\n    // Cek apakah user existe\n    const existingUser = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      }\n    });    if (!existingUser) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    const updateData: any = { ...validation.data };\n\n    // Hash password jika ada\n    if (updateData.password) {\n      updateData.password = await bcrypt.hash(updateData.password, 10);\n    }\n\n    // Handle vendor_name berdasarkan role\n    if (updateData.role === Role.VERIFIER || updateData.role === Role.ADMIN) {\n      updateData.vendor_name = null;\n    }\n\n    // Parse verified_at jika ada\n    if (updateData.verified_at) {\n      updateData.verified_at = new Date(updateData.verified_at);\n    }\n\n    // Cek email unik jika email diubah\n    if (updateData.email && updateData.email !== existingUser.email) {\n      const emailExists = await prisma.user.findUnique({\n        where: { email: updateData.email }\n      });\n\n      if (emailExists) {\n        return NextResponse.json(\n          { error: \"Email sudah digunakan\" },\n          { status: 400 }\n        );\n      }\n    }\n\n    const updatedUser = await prisma.user.update({\n      where: { id: resolvedParams.id },\n      data: updateData,\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    return NextResponse.json(updatedUser);\n\n  } catch (error) {\n    console.error(\"Error updating user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengupdate user\" },\n      { status: 500 }\n    );\n  }\n}\n\n  // DELETE - Hapus user\nexport async function DELETE(\n  _request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== Role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const resolvedParams = await params;\n\n    // Cek apakah user existe\n    const existingUser = await prisma.user.findUnique({\n      where: { \n        id: resolvedParams.id\n      }\n    });    if (!existingUser) {\n      return NextResponse.json(\n        { error: \"User tidak ditemukan\" },\n        { status: 404 }\n      );\n    }\n\n    await prisma.user.delete({\n      where: { id: resolvedParams.id }\n    });\n\n    return NextResponse.json(\n      { message: \"User berhasil dihapus\" },\n      { status: 200 }\n    );\n\n  } catch (error) {\n    console.error(\"Error deleting user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat menghapus user\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/users/[id]/verify/route.ts",
      "lang": "ts",
      "size": 2189,
      "lines": 79,
      "hash": "d36da6f932a6a5b0f5c57255f85248c7efc6733819e4c0baf7ae21520bdbd5e5",
      "truncated": false,
      "content": "// app/api/users/[id]/verify/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/singletons\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport async function PUT(\n  request: NextRequest,\n  context: { params: Promise<{ id: string }> }\n) {\n  try {\n    const params = await context.params;\n    const { id } = params;\n    const { action } = await request.json(); // \"approve\" or \"reject\"\n\n    // Check session\n    const session = await getServerSession(authOptions);\n    if (!session || (session.user.role !== \"ADMIN\" && session.user.role !== \"SUPER_ADMIN\")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    // Find user\n    const user = await prisma.user.findUnique({\n      where: { id },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 });\n    }\n\n    let updatedUser;\n\n    if (action === \"approve\") {\n      // Approve user\n      updatedUser = await prisma.user.update({\n        where: { id },\n        data: {\n          verified_at: new Date(),\n          verified_by: session.user.id,\n        },\n        select: {\n          id: true,\n          officer_name: true,\n          email: true,\n          role: true,\n          vendor_name: true,\n          verified_at: true,\n          created_at: true,\n        },\n      });\n    } else if (action === \"reject\") {\n      // For now, we'll just delete the user. You might want to keep them with a \"rejected\" status\n      await prisma.user.delete({\n        where: { id },\n      });\n      \n      return NextResponse.json({ \n        message: \"User rejected and removed from system\",\n        success: true \n      });\n    } else {\n      return NextResponse.json({ error: \"Invalid action\" }, { status: 400 });\n    }\n\n    return NextResponse.json({\n      message: `User ${action === \"approve\" ? \"approved\" : \"rejected\"} successfully`,\n      user: updatedUser,\n      success: true\n    });\n\n  } catch (error) {\n    console.error(\"Error in user verification:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/users/profile/route.ts",
      "lang": "ts",
      "size": 1108,
      "lines": 40,
      "hash": "512e2bce5853ed5c03d6885d3563dd0a81a0d5bff54231ad0448977803659344",
      "truncated": false,
      "content": "import { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport async function PUT(req: Request) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session) {\n      return new NextResponse(\"Unauthorized\", { status: 401 });\n    }\n\n    const body = await req.json();\n    const { officer_name, vendor_name, phone_number, address } = body;\n\n    // Basic validation\n    if (!officer_name?.trim()) {\n      return new NextResponse(\"Officer name is required\", { status: 400 });\n    }\n\n    // Update user profile\n    const updatedUser = await prisma.user.update({\n      where: {\n        id: session.user.id,\n      },\n      data: {\n        officer_name,\n        vendor_name: vendor_name || null,\n        phone_number: phone_number || null,\n        address: address || null,\n      },\n    });\n\n    return NextResponse.json(updatedUser);\n  } catch (error) {\n    console.error(\"[PROFILE_UPDATE]\", error);\n    return new NextResponse(\"Internal Server Error\", { status: 500 });\n  }\n}"
    },
    {
      "path": "src/app/api/users/route.ts",
      "lang": "ts",
      "size": 5939,
      "lines": 208,
      "hash": "4c68e56401a0de24319ec1290ac50b3523681bf476946bddca7e6e600727a119",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\nimport { Role } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\nimport { z } from \"zod\";\n\nconst userSchema = z.object({\n  officer_name: z.string().min(1, \"Nama petugas wajib diisi\"),\n  email: z.string().email(\"Email tidak valid\"),\n  password: z.string().min(6, \"Password minimal 6 karakter\").optional(),\n  role: z.nativeEnum(Role),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n  vendor_name: z.string().optional(),\n});\n\n// GET - Mengambil daftar user dengan pagination, search, dan sort\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== Role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    // Get search params\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n    const search = searchParams.get(\"search\") || \"\";\n    const sortBy = searchParams.get(\"sortBy\") || \"created_at\";\n    const sortOrder = searchParams.get(\"sortOrder\") || \"desc\";\n    const role = searchParams.get(\"role\") || \"\";\n    const verificationStatus = searchParams.get(\"verificationStatus\") || \"\"; // \"pending\", \"verified\", \"all\"\n\n    console.log(\"API received params:\", { \n      page, \n      limit, \n      search, \n      sortBy, \n      sortOrder, \n      role, \n      verificationStatus \n    });\n\n    const skip = (page - 1) * limit;\n\n    // Build where clause\n    const where: any = {};\n\n    // Filter by role if specified\n    if (role && (role === Role.VENDOR || role === Role.VERIFIER || role === Role.ADMIN)) {\n      where.role = role;\n    }\n\n    // Filter by verification status\n    if (verificationStatus === \"pending\") {\n      where.verified_at = null;\n      console.log(\"Filtering for pending verification (verified_at is null)\");\n    } else if (verificationStatus === \"verified\") {\n      where.verified_at = { not: null };\n      console.log(\"Filtering for verified users (verified_at is not null)\");\n    } else {\n      console.log(\"No verification filter applied (showing all)\");\n    }\n    // \"all\" shows both pending and verified\n\n    console.log(\"Final query where clause:\", JSON.stringify(where, null, 2));\n\n    // Search functionality\n    if (search) {\n      where.OR = [\n        { officer_name: { contains: search } },\n        { email: { contains: search } },\n        { vendor_name: { contains: search } },\n        { phone_number: { contains: search } },\n      ];\n    }\n\n    // Get total count\n    const total = await prisma.user.count({ where });\n\n    // Get users with pagination and sorting\n    const users = await prisma.user.findMany({\n      where,\n      skip,\n      take: limit,\n      orderBy: {\n        [sortBy]: sortOrder as \"asc\" | \"desc\"\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n        profile_photo: true,\n      }\n    });\n\n    return NextResponse.json({\n      users,\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit)\n      }\n    });\n\n  } catch (error) {\n    console.error(\"Error fetching users:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat mengambil data user\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Membuat user baru\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    // Cek apakah user adalah super admin\n    if (!session || session.user.role !== Role.SUPER_ADMIN) {\n      return NextResponse.json(\n        { error: \"Akses ditolak. Hanya super admin yang dapat mengakses endpoint ini.\" },\n        { status: 403 }\n      );\n    }\n\n    const body = await request.json();\n    const validation = userSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Data tidak valid\", details: validation.error.issues },\n        { status: 400 }\n      );\n    }\n\n    const { officer_name, email, password, role, address, phone_number, vendor_name } = validation.data;\n\n    // Cek apakah email sudah ada\n    const existingUser = await prisma.user.findUnique({\n      where: { email }\n    });\n\n    if (existingUser) {\n      return NextResponse.json(\n        { error: \"Email sudah digunakan\" },\n        { status: 400 }\n      );\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(password || \"password123\", 10);\n\n    // Buat user baru\n    const newUser = await prisma.user.create({\n      data: {\n        officer_name,\n        email,\n        password: hashedPassword,\n        role,\n        address: address || null,\n        phone_number: phone_number || null,\n        vendor_name: role === Role.VENDOR ? (vendor_name || null) : null,\n        verified_by: session.user.officer_name,\n        verified_at: new Date(),\n      },\n      select: {\n        id: true,\n        officer_name: true,\n        email: true,\n        role: true,\n        address: true,\n        phone_number: true,\n        vendor_name: true,\n        created_at: true,\n        verified_at: true,\n        verified_by: true,\n      }\n    });\n\n    return NextResponse.json(newUser, { status: 201 });\n\n  } catch (error) {\n    console.error(\"Error creating user:\", error);\n    return NextResponse.json(\n      { error: \"Terjadi kesalahan saat membuat user\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/v1/notifications/[id]/read/route.ts",
      "lang": "ts",
      "size": 3245,
      "lines": 115,
      "hash": "9ca5acd6d82ff23ba44803a6aad0cd0e6363f2238fe39d39dc50154d76ac7fb5",
      "truncated": false,
      "content": "/**\n * POST /api/v1/notifications/[id]/read\n * Mark a specific notification as read\n */\n\nimport { NextRequest } from 'next/server';\nimport { prisma } from '@/lib/singletons';\nimport { Cache, CacheNamespaces } from '@/lib/cache';\nimport { eventsPublisher } from '@/server/eventsPublisher';\nimport { \n  withErrorHandling, \n  apiSuccess, \n  apiError,\n  getAuthenticatedSession,\n  handleOptions,\n} from '@/lib/api-utils';\n\nasync function markAsRead(\n  _req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const notificationId = id;\n\n  // Check authentication\n  const { session, error: authError } = await getAuthenticatedSession();\n  if (authError) return authError;\n\n  // Get notification\n  const notification = await prisma.notification.findUnique({\n    where: { id: notificationId },\n  });\n\n  if (!notification) {\n    return apiError('Notification not found', 404);\n  }\n\n  // Check permissions\n  if (notification.scope === 'admin' && !['ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (notification.scope === 'vendor') {\n    if (session.user.role !== 'VENDOR' || notification.vendor_id !== session.user.id) {\n      return apiError('Access denied', 403);\n    }\n  }\n\n  if (notification.scope === 'reviewer' && !['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (notification.scope === 'approver' && !['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  // Check if already read\n  const existingRead = await prisma.notificationRead.findFirst({\n    where: {\n      notification_id: notificationId,\n      ...(notification.scope === 'vendor' \n        ? { vendor_id: session.user.id }\n        : { user_id: session.user.id } // For admin, reviewer, approver\n      ),\n    },\n  });\n\n  if (existingRead) {\n    return apiSuccess({ message: 'Already marked as read' });\n  }\n\n  // Mark as read\n  await prisma.notificationRead.create({\n    data: {\n      notification_id: notificationId,\n      ...(notification.scope === 'vendor' \n        ? { vendor_id: session.user.id }\n        : { user_id: session.user.id } // For admin, reviewer, approver\n      ),\n    },\n  });\n\n  // Invalidate cache\n  await Cache.invalidateByPrefix('notifications', CacheNamespaces.NOTIFICATIONS);\n\n  // Get updated unread count and emit event\n  const unreadCount = await prisma.notification.count({\n    where: {\n      scope: notification.scope,\n      ...(notification.scope === 'vendor' ? { vendor_id: session.user.id } : {}),\n      reads: {\n        none: notification.scope === 'vendor' \n          ? { vendor_id: session.user.id }\n          : { user_id: session.user.id }, // For admin, reviewer, approver\n      },\n    },\n  });\n\n  // Emit unread count update\n  eventsPublisher.notificationUnreadCount({\n    scope: notification.scope,\n    vendorId: notification.scope === 'vendor' ? session.user.id : undefined,\n    unreadCount,\n    count: unreadCount,\n  });\n\n  return apiSuccess({\n    message: 'Notification marked as read',\n    unreadCount,\n  });\n}\n\nexport const POST = withErrorHandling(markAsRead);\nexport const OPTIONS = handleOptions;\n"
    },
    {
      "path": "src/app/api/v1/notifications/read-all/route.ts",
      "lang": "ts",
      "size": 3196,
      "lines": 104,
      "hash": "14098de46a00eccb09aa8ff2f0218400da60f01dd46e014eedfdc1d138c03cd6",
      "truncated": false,
      "content": "/**\n * POST /api/v1/notifications/read-all\n * Mark all notifications as read for current user/scope\n */\n\nimport { NextRequest } from 'next/server';\nimport { prisma } from '@/lib/singletons';\nimport { Cache, CacheNamespaces } from '@/lib/cache';\nimport { eventsPublisher } from '@/server/eventsPublisher';\nimport { \n  withErrorHandling, \n  apiSuccess, \n  apiError,\n  validateRequestBody,\n  getAuthenticatedSession,\n  handleOptions,\n} from '@/lib/api-utils';\nimport { MarkAllAsReadSchema } from '@/shared/dto';\n\nasync function markAllAsRead(req: NextRequest) {\n  // Validate request body\n  const { data: body, error: validationError } = await validateRequestBody(req, MarkAllAsReadSchema);\n  if (validationError || !body) {\n    return apiError(validationError || 'Invalid request body', 400);\n  }\n\n  // Check authentication\n  const { session, error: authError } = await getAuthenticatedSession();\n  if (authError) return authError;\n\n  // Check permissions\n  if (body.scope === 'admin' && !['ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (body.scope === 'vendor' && session.user.role !== 'VENDOR') {\n    return apiError('Access denied', 403);\n  }\n\n  if (body.scope === 'reviewer' && !['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (body.scope === 'approver' && !['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  // For vendor scope, use session user ID if vendorId not provided\n  const vendorId = body.scope === 'vendor' \n    ? (body.vendorId || session.user.id)\n    : body.vendorId;\n\n  // Get all unread notifications for this scope/user\n  const unreadNotifications = await prisma.notification.findMany({\n    where: {\n      scope: body.scope,\n      ...(body.scope === 'vendor' && vendorId ? { vendor_id: vendorId } : {}),\n      reads: {\n        none: body.scope === 'vendor'\n          ? { vendor_id: vendorId }\n          : { user_id: session.user.id }, // For admin, reviewer, approver\n      },\n    },\n    select: { id: true },\n  });\n\n  if (unreadNotifications.length === 0) {\n    return apiSuccess({ message: 'No unread notifications' });\n  }\n\n  // Mark all as read in bulk\n  const readRecords = unreadNotifications.map(notification => ({\n    notification_id: notification.id,\n    ...(body.scope === 'vendor' \n      ? { vendor_id: vendorId }\n      : { user_id: session.user.id } // For admin, reviewer, approver\n    ),\n  }));\n\n  await prisma.notificationRead.createMany({\n    data: readRecords,\n    skipDuplicates: true,\n  });\n\n  // Invalidate cache\n  await Cache.invalidateByPrefix('notifications', CacheNamespaces.NOTIFICATIONS);\n\n  // Emit unread count update (should be 0 now)\n  eventsPublisher.notificationUnreadCount({\n    scope: body.scope,\n    vendorId: body.scope === 'vendor' ? vendorId : undefined,\n    unreadCount: 0,\n    count: 0,\n  });\n\n  return apiSuccess({\n    message: `Marked ${unreadNotifications.length} notifications as read`,\n    markedCount: unreadNotifications.length,\n  });\n}\n\nexport const POST = withErrorHandling(markAllAsRead);\nexport const OPTIONS = handleOptions;\n"
    },
    {
      "path": "src/app/api/v1/notifications/route.ts",
      "lang": "ts",
      "size": 5362,
      "lines": 176,
      "hash": "ebd2dffb5ce8031e08151e5ae99cb20d7cd6cd9dcebfe902ed11131b980be73c",
      "truncated": false,
      "content": "/**\n * GET /api/v1/notifications\n * Get paginated notifications for admin or vendor\n */\n\nimport { NextRequest } from 'next/server';\nimport { prisma } from '@/lib/singletons';\nimport { Cache, CacheNamespaces, CacheTTL } from '@/lib/cache';\nimport { \n  withErrorHandling, \n  apiSuccess, \n  apiError, \n  validateQueryParams,\n  getAuthenticatedSession,\n  handleOptions,\n} from '@/lib/api-utils';\nimport { NotificationsQuerySchema, NotificationDto } from '@/shared/dto';\n\nasync function getNotifications(req: NextRequest) {\n  // Validate query parameters\n  const { data: query, error: validationError } = validateQueryParams(req, NotificationsQuerySchema);\n  if (validationError || !query) {\n    return apiError(validationError || 'Invalid query parameters', 400);\n  }\n\n  // Check authentication\n  const { session, error: authError } = await getAuthenticatedSession();\n  if (authError) return authError;\n\n  // Validate permissions\n  if (query.scope === 'admin' && !['ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (query.scope === 'vendor' && !['VENDOR', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (query.scope === 'reviewer' && !['REVIEWER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  if (query.scope === 'approver' && !['APPROVER', 'ADMIN', 'SUPER_ADMIN'].includes(session.user.role)) {\n    return apiError('Access denied', 403);\n  }\n\n  // For vendor scope, use session user ID if vendorId not provided\n  const vendorId = query.scope === 'vendor' \n    ? (query.vendorId || session.user.id)\n    : query.vendorId;\n\n  // Build cache key\n  const cacheKey = `notifications:${query.scope}:${vendorId || 'all'}:${query.cursor || 'start'}:${query.limit}`;\n\n  // Try to get from cache first\n  const cached = await Cache.getJSON<{ notifications: NotificationDto[]; hasMore: boolean; nextCursor: string | null }>(\n    cacheKey, \n    { namespace: CacheNamespaces.NOTIFICATIONS, ttl: CacheTTL.SHORT }\n  );\n\n  if (cached) {\n    return apiSuccess({\n      data: cached.notifications,\n      pagination: {\n        nextCursor: cached.nextCursor,\n        hasMore: cached.hasMore,\n      }\n    });\n  }\n\n  // Build where clause\n  const whereClause: any = {\n    scope: query.scope,\n  };\n\n  if (query.scope === 'vendor' && vendorId) {\n    whereClause.vendor_id = vendorId;\n  }\n\n  // Handle cursor pagination\n  if (query.cursor) {\n    whereClause.id = {\n      lt: query.cursor, // Get notifications before this cursor\n    };\n  }\n\n  // Get notifications with read status\n  const notifications = await prisma.notification.findMany({\n    where: whereClause,\n    include: {\n      reads: {\n        where: query.scope === 'vendor' \n          ? { vendor_id: vendorId }\n          : { user_id: session.user.id }, // For admin, reviewer, approver\n      },\n    },\n    orderBy: {\n      created_at: 'desc',\n    },\n    take: query.limit + 1, // Get one extra to check if there are more\n  });\n\n  // Filter out notifications that reference non-existent submissions\n  const validNotifications = [];\n  for (const notification of notifications) {\n    let isValid = true;\n    \n    // Check if notification data contains a submissionId\n    if (notification.data) {\n      try {\n        const data = JSON.parse(notification.data);\n        if (data.submissionId) {\n          // Verify that the submission still exists\n          const submissionExists = await prisma.submission.findUnique({\n            where: { id: data.submissionId },\n            select: { id: true }\n          });\n          \n          if (!submissionExists) {\n            isValid = false;\n            // Optionally clean up this orphaned notification\n            console.log(`Found orphaned notification ${notification.id} for deleted submission ${data.submissionId}`);\n          }\n        }\n      } catch (error) {\n        // If data parsing fails, keep the notification (might not be submission-related)\n        console.warn(`Failed to parse notification data for notification ${notification.id}:`, error);\n      }\n    }\n    \n    if (isValid) {\n      validNotifications.push(notification);\n    }\n  }\n\n  // Check if there are more notifications\n  const hasMore = validNotifications.length > query.limit;\n  const notificationsList = hasMore ? validNotifications.slice(0, -1) : validNotifications;\n  const nextCursor = hasMore ? notificationsList[notificationsList.length - 1]?.id : null;\n\n  // Format response\n  const formattedNotifications: NotificationDto[] = notificationsList.map(notification => ({\n    id: notification.id,\n    scope: notification.scope,\n    vendorId: notification.vendor_id,\n    type: notification.type,\n    title: notification.title,\n    message: notification.message,\n    data: notification.data,\n    createdAt: notification.created_at.toISOString(),\n    isRead: notification.reads.length > 0,\n  }));\n\n  // Cache the result\n  await Cache.setJSON(\n    cacheKey,\n    {\n      notifications: formattedNotifications,\n      hasMore,\n      nextCursor,\n    },\n    { namespace: CacheNamespaces.NOTIFICATIONS, ttl: CacheTTL.SHORT }\n  );\n\n  return apiSuccess({\n    data: formattedNotifications,\n    pagination: {\n      nextCursor,\n      hasMore,\n    }\n  });\n}\n\nexport const GET = withErrorHandling(getNotifications);\nexport const OPTIONS = handleOptions;\n"
    },
    {
      "path": "src/app/api/vendor/dashboard/stats/route.ts",
      "lang": "ts",
      "size": 1830,
      "lines": 52,
      "hash": "905bd4d73cd6db46c522ed657039c7a111b4060f70b530043701dc1a74ddb727",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get submission statistics for current vendor\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    // Get total count\n    const totalCount = await prisma.submission.count({\n      where: { user_id: userId }\n    });\n\n    // Format statistics\n    const vendorStats = {\n      totalSubmissions: totalCount,\n      pendingSubmissions: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approvedSubmissions: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejectedSubmissions: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0,\n      draftSubmissions: 0, // Assuming no draft status in current schema\n      totalApproved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      totalPending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      totalRejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json(vendorStats);\n\n  } catch (error) {\n    console.error(\"Vendor dashboard stats error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/vendor/dashboard-stats/route.ts",
      "lang": "ts",
      "size": 1275,
      "lines": 52,
      "hash": "35ccfc701c824a54b3f2780f514d59dc3493d5528fdb8f521067893fdde92305",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get statistics for current vendor\n    const [totalApproved, totalPending, totalRejected] = await Promise.all([\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"APPROVED\"\n        }\n      }),\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"PENDING\"\n        }\n      }),\n      prisma.submission.count({\n        where: {\n          user_id: userId,\n          approval_status: \"REJECTED\"\n        }\n      })\n    ]);\n\n    return NextResponse.json({\n      totalApproved,\n      totalPending,\n      totalRejected\n    });\n\n  } catch (error) {\n    console.error(\"Vendor dashboard stats error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/vendor/latest-submissions/route.ts",
      "lang": "ts",
      "size": 1436,
      "lines": 60,
      "hash": "1d4c20a3347ce5118ede06a7ddbf8c381b8ecccfd2ae116e222b6959e526b8db",
      "truncated": false,
      "content": "import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get latest 5 submissions for current vendor\n    const submissions = await prisma.submission.findMany({\n      where: {\n        user_id: userId\n      },\n      select: {\n        id: true,\n        job_description: true,\n        work_location: true,\n        approval_status: true,\n        simlok_number: true,\n        created_at: true,\n        vendor_name: true,\n        officer_name: true,\n        based_on: true,\n        working_hours: true,\n        implementation: true,\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true\n          }\n        }\n      },\n      orderBy: {\n        created_at: \"desc\"\n      },\n      take: 5\n    });\n\n    return NextResponse.json({\n      submissions\n    });\n\n  } catch (error) {\n    console.error(\"Vendor latest submissions error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/vendor/simloks/[id]/workers/route.ts",
      "lang": "ts",
      "size": 1291,
      "lines": 57,
      "hash": "7359311e27e30f912e41f3101b2120dd9eb7727a49b154cd5bd903d1c55bae2a",
      "truncated": false,
      "content": "/**\n * GET /api/vendor/simloks/[id]/workers\n * Get workers for a vendor's own submission\n */\n\nimport { NextRequest } from 'next/server';\nimport { prisma } from '@/lib/singletons';\nimport { \n  withErrorHandling, \n  apiSuccess, \n  apiError,\n  getAuthenticatedSession,\n  handleOptions,\n} from '@/lib/api-utils';\n\nasync function getVendorSubmissionWorkers(\n  _req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  \n  // Check authentication\n  const { session, error: authError } = await getAuthenticatedSession();\n  if (authError) return authError;\n\n  // Only vendors can access this endpoint\n  if (session.user.role !== 'VENDOR') {\n    return apiError('Access denied', 403);\n  }\n\n  // Check if submission belongs to this vendor\n  const submission = await prisma.submission.findFirst({\n    where: {\n      id: id,\n      user_id: session.user.id,\n    },\n  });\n\n  if (!submission) {\n    return apiError('Submission not found', 404);\n  }\n\n  // Get workers\n  const workers = await prisma.workerList.findMany({\n    where: {\n      submission_id: id,\n    },\n    orderBy: {\n      created_at: 'asc',\n    },\n  });\n\n  return apiSuccess({ workers });\n}\n\nexport const GET = withErrorHandling(getVendorSubmissionWorkers);\nexport const OPTIONS = handleOptions;"
    },
    {
      "path": "src/app/api/vendor/submissions/route.ts",
      "lang": "ts",
      "size": 3869,
      "lines": 137,
      "hash": "43c498b3fa0b6f290d1a198d86fd0f7d00a3a61f3e3c8e16d0b633b1c4f7324f",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n    const { searchParams } = new URL(request.url);\n    \n    // Extract query parameters\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '10');\n    const sortBy = searchParams.get('sortBy') || 'created_at';\n    const sortOrder = searchParams.get('sortOrder') || 'desc';\n    const search = searchParams.get('search');\n    const status = searchParams.get('status');\n\n    // Build where clause\n    const where: any = {\n      user_id: userId\n    };\n\n    if (search) {\n      where.OR = [\n        { job_description: { contains: search, mode: 'insensitive' } },\n        { work_location: { contains: search, mode: 'insensitive' } },\n        { vendor_name: { contains: search, mode: 'insensitive' } },\n        { officer_name: { contains: search, mode: 'insensitive' } },\n        { simlok_number: { contains: search, mode: 'insensitive' } }\n      ];\n    }\n\n    if (status) {\n      where.approval_status = status;\n    }\n\n    // Get total count for pagination\n    const totalCount = await prisma.submission.count({ where });\n    const totalPages = Math.ceil(totalCount / limit);\n    const skip = (page - 1) * limit;\n\n    // Get submissions without updated_at field\n    const submissions = await prisma.submission.findMany({\n      where,\n      select: {\n        id: true,\n        job_description: true,\n        work_location: true,\n        approval_status: true,\n        simlok_number: true,\n        simlok_date: true,\n        created_at: true,\n        vendor_name: true,\n        officer_name: true,\n        based_on: true,\n        working_hours: true,\n        implementation: true,\n        work_facilities: true,\n        worker_names: true,\n        content: true,\n        notes: true,\n        simja_number: true,\n        simja_date: true,\n        sika_number: true,\n        sika_date: true,\n        other_notes: true,\n        sika_document_upload: true,\n        simja_document_upload: true,\n        qrcode: true,\n        signer_position: true,\n        signer_name: true,\n        user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true,\n            vendor_name: true\n          }\n        },\n        approved_by_user: {\n          select: {\n            id: true,\n            officer_name: true,\n            email: true\n          }\n        }\n      },\n      orderBy: {\n        [sortBy]: sortOrder as 'asc' | 'desc'\n      },\n      skip,\n      take: limit\n    });\n\n    // Get statistics\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    const statistics = {\n      total: totalCount,\n      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        page,\n        limit,\n        total: totalCount,\n        pages: totalPages\n      },\n      statistics\n    });\n\n  } catch (error) {\n    console.error(\"Vendor submissions error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/vendor/submissions/stats/route.ts",
      "lang": "ts",
      "size": 1410,
      "lines": 48,
      "hash": "45f3fca362172777e8e9e25c5014e254d82edc49d9b72dc8b55bc8651bb37229",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth/next\";\nimport { authOptions } from \"@/lib/auth\";\nimport { prisma } from \"@/lib/singletons\";\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user || session.user.role !== \"VENDOR\") {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const userId = session.user.id;\n\n    // Get statistics for all submissions (no filters)\n    const totalCount = await prisma.submission.count({ \n      where: { user_id: userId } \n    });\n\n    const stats = await prisma.submission.groupBy({\n      by: ['approval_status'],\n      where: { user_id: userId },\n      _count: {\n        approval_status: true\n      }\n    });\n\n    const statistics = {\n      total: totalCount,\n      pending: stats.find(s => s.approval_status === 'PENDING')?._count.approval_status || 0,\n      approved: stats.find(s => s.approval_status === 'APPROVED')?._count.approval_status || 0,\n      rejected: stats.find(s => s.approval_status === 'REJECTED')?._count.approval_status || 0\n    };\n\n    return NextResponse.json({\n      statistics\n    });\n\n  } catch (error) {\n    console.error(\"Vendor statistics error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/verifier/dashboard/stats/route.ts",
      "lang": "ts",
      "size": 2097,
      "lines": 88,
      "hash": "77017c81cf506bfe3d95a17e9de2e4abbef92f5090f7155cb8f5ae4de83f50ea",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { db } from '@/lib/db';\n\nexport async function GET(_request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session || session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    // Get today's date for filtering\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Fetch statistics\n    const [\n      totalSubmissions,\n      pendingSubmissions,\n      approvedSubmissions,\n      rejectedSubmissions,\n      todayVerified\n    ] = await Promise.all([\n      // Total submissions\n      db.submission.count(),\n      \n      // Pending submissions\n      db.submission.count({\n        where: { approval_status: 'PENDING' }\n      }),\n      \n      // Approved submissions\n      db.submission.count({\n        where: { approval_status: 'APPROVED' }\n      }),\n      \n      // Rejected submissions\n      db.submission.count({\n        where: { approval_status: 'REJECTED' }\n      }),\n      \n      // Today's verified submissions (approved or rejected)\n      db.submission.count({\n        where: {\n          AND: [\n            {\n              OR: [\n                { approval_status: 'APPROVED' },\n                { approval_status: 'REJECTED' }\n              ]\n            },\n            {\n              created_at: {\n                gte: today,\n                lt: tomorrow\n              }\n            }\n          ]\n        }\n      })\n    ]);\n\n    const stats = {\n      totalSubmissions,\n      pendingSubmissions,\n      approvedSubmissions,\n      rejectedSubmissions,\n      todayVerified\n    };\n\n    return NextResponse.json(stats);\n\n  } catch (error) {\n    console.error('Error fetching verifier stats:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch statistics' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/verifier/dashboard-stats/route.ts",
      "lang": "ts",
      "size": 3255,
      "lines": 123,
      "hash": "4d6a8f4bfe4a128baa700369e11c45bb3516e04d6751f05805f8c9941bf618bf",
      "truncated": false,
      "content": "/**\n * API Route for Verifier Dashboard Statistics\n * Returns dashboard stats for mobile-optimized verifier interface\n */\n\nimport { NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session?.user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    if (session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Forbidden - Verifier access required' },\n        { status: 403 }\n      );\n    }\n\n    const userId = session.user.id;\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // Get today's scans count\n    const todayScans = await prisma.qrScan.count({\n      where: {\n        scanned_by: userId,\n        scanned_at: {\n          gte: today,\n        },\n      },\n    });\n\n    // Get total verified submissions by this verifier\n    const totalVerified = await prisma.submission.count({\n      where: {\n        approval_status: 'APPROVED',\n        // Add verifier tracking if available in your schema\n        // verifiedBy: userId,\n      },\n    });\n\n    // Get pending reviews count\n    const pendingReviews = await prisma.submission.count({\n      where: {\n        approval_status: 'PENDING',\n      },\n    });\n\n    // Get recent activity for this verifier\n    const recentScans = await prisma.qrScan.findMany({\n      where: {\n        scanned_by: userId,\n      },\n      include: {\n        submission: {\n          select: {\n            simlok_number: true,\n            vendor_name: true,\n          },\n        },\n      },\n      orderBy: {\n        scanned_at: 'desc',\n      },\n      take: 10,\n    });\n\n    const recentActivity = recentScans.map((scan: any) => ({\n      id: scan.id,\n      type: 'scan' as const,\n      message: scan.submission?.simlok_number \n        ? `Scan SIMLOK ${scan.submission.simlok_number} dari ${scan.submission.vendor_name}`\n        : `Scan QR Code - ${scan.qr_data?.substring(0, 20)}...`,\n      timestamp: scan.scanned_at.toISOString(),\n    }));\n\n    // Add some mock verified activities if needed\n    const mockVerifiedActivities = [\n      {\n        id: 'verify-1',\n        type: 'verify' as const,\n        message: 'Verifikasi dokumen SIMLOK berhasil',\n        timestamp: new Date(Date.now() - 1000 * 60 * 30).toISOString(), // 30 minutes ago\n      },\n      {\n        id: 'verify-2', \n        type: 'verify' as const,\n        message: 'Update status submission ke APPROVED',\n        timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), // 2 hours ago\n      },\n    ];\n\n    const allActivity = [...recentActivity, ...mockVerifiedActivities]\n      .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n      .slice(0, 5);\n\n    const stats = {\n      todayScans,\n      totalVerified,\n      pendingReviews,\n      recentActivity: allActivity,\n    };\n\n    return NextResponse.json(stats);\n\n  } catch (error) {\n    console.error('Dashboard stats error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"
    },
    {
      "path": "src/app/api/verifier/recent-submissions/route.ts",
      "lang": "ts",
      "size": 1646,
      "lines": 64,
      "hash": "d54ac2af0762c55e0212221eda3d42625bf43173bc5e19e2d4c20ae9e0349aac",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { db } from '@/lib/db';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session || session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const url = new URL(request.url);\n    const limit = parseInt(url.searchParams.get('limit') || '10');\n    const offset = parseInt(url.searchParams.get('offset') || '0');\n\n    // Fetch recent submissions with related data\n    const submissions = await db.submission.findMany({\n      take: limit,\n      skip: offset,\n      orderBy: {\n        created_at: 'desc'\n      },\n      select: {\n        id: true,\n        vendor_name: true,\n        officer_name: true,\n        job_description: true,\n        work_location: true,\n        implementation: true,\n        approval_status: true,\n        simlok_number: true,\n        simlok_date: true,\n        created_at: true,\n        qrcode: true\n      }\n    });\n\n    // Get total count for pagination\n    const totalCount = await db.submission.count();\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount\n      }\n    });\n\n  } catch (error) {\n    console.error('Error fetching recent submissions:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch recent submissions' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/verifier/search/route.ts",
      "lang": "ts",
      "size": 3033,
      "lines": 130,
      "hash": "e3f45f81d1ad49f6b7b3faebaa8fcee3fc2497007b2e2f82bd9c9aadcc262a8d",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { db } from '@/lib/db';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session || session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const url = new URL(request.url);\n    const query = url.searchParams.get('q');\n    const limit = parseInt(url.searchParams.get('limit') || '20');\n    const offset = parseInt(url.searchParams.get('offset') || '0');\n\n    if (!query || query.trim().length < 2) {\n      return NextResponse.json({\n        submissions: [],\n        pagination: {\n          total: 0,\n          limit,\n          offset,\n          hasMore: false\n        }\n      });\n    }\n\n    const searchTerm = query.trim();\n\n    // Build search conditions\n    const whereConditions = {\n      OR: [\n        {\n          simlok_number: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          vendor_name: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          officer_name: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          job_description: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          work_location: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          id: {\n            contains: searchTerm,\n            mode: 'insensitive' as const\n          }\n        }\n      ]\n    };\n\n    // Search submissions\n    const [submissions, totalCount] = await Promise.all([\n      db.submission.findMany({\n        where: whereConditions,\n        take: limit,\n        skip: offset,\n        orderBy: [\n          {\n            approval_status: 'asc' // Show pending first\n          },\n          {\n            created_at: 'desc'\n          }\n        ],\n        select: {\n          id: true,\n          vendor_name: true,\n          officer_name: true,\n          job_description: true,\n          work_location: true,\n          implementation: true,\n          approval_status: true,\n          simlok_number: true,\n          simlok_date: true,\n          created_at: true,\n          qrcode: true\n        }\n      }),\n      db.submission.count({\n        where: whereConditions\n      })\n    ]);\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount\n      },\n      query: searchTerm\n    });\n\n  } catch (error) {\n    console.error('Error searching submissions:', error);\n    return NextResponse.json(\n      { error: 'Failed to search submissions' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/api/verifier/submissions/route.ts",
      "lang": "ts",
      "size": 3742,
      "lines": 153,
      "hash": "3a7be2dd462476825eeca4edebd4c52d22f04021a0c13d182f0d2e1e188d9b9b",
      "truncated": false,
      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { db } from '@/lib/db';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session || session.user.role !== 'VERIFIER') {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const url = new URL(request.url);\n    const limit = parseInt(url.searchParams.get('limit') || '20');\n    const offset = parseInt(url.searchParams.get('offset') || '0');\n    const status = url.searchParams.get('status') || 'ALL';\n    const dateRange = url.searchParams.get('dateRange') || 'ALL';\n    const search = url.searchParams.get('search') || '';\n\n    // Build where conditions\n    const whereConditions: any = {};\n\n    // Status filter\n    if (status !== 'ALL') {\n      whereConditions.approval_status = status;\n    }\n\n    // Date range filter\n    if (dateRange !== 'ALL') {\n      const now = new Date();\n      let startDate: Date;\n      \n      switch (dateRange) {\n        case 'TODAY':\n          startDate = new Date(now);\n          startDate.setHours(0, 0, 0, 0);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n        case 'WEEK':\n          startDate = new Date(now);\n          startDate.setDate(now.getDate() - 7);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n        case 'MONTH':\n          startDate = new Date(now);\n          startDate.setDate(now.getDate() - 30);\n          whereConditions.created_at = {\n            gte: startDate\n          };\n          break;\n      }\n    }\n\n    // Search filter\n    if (search.trim()) {\n      whereConditions.OR = [\n        {\n          simlok_number: {\n            contains: search,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          vendor_name: {\n            contains: search,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          officer_name: {\n            contains: search,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          job_description: {\n            contains: search,\n            mode: 'insensitive' as const\n          }\n        },\n        {\n          work_location: {\n            contains: search,\n            mode: 'insensitive' as const\n          }\n        }\n      ];\n    }\n\n    // Fetch submissions with pagination\n    const [submissions, totalCount] = await Promise.all([\n      db.submission.findMany({\n        where: whereConditions,\n        take: limit,\n        skip: offset,\n        orderBy: [\n          {\n            approval_status: 'asc' // Show pending first\n          },\n          {\n            created_at: 'desc'\n          }\n        ],\n        select: {\n          id: true,\n          vendor_name: true,\n          officer_name: true,\n          job_description: true,\n          work_location: true,\n          implementation: true,\n          approval_status: true,\n          simlok_number: true,\n          simlok_date: true,\n          created_at: true\n        }\n      }),\n      db.submission.count({\n        where: whereConditions\n      })\n    ]);\n\n    return NextResponse.json({\n      submissions,\n      pagination: {\n        total: totalCount,\n        limit,\n        offset,\n        hasMore: offset + limit < totalCount\n      },\n      filters: {\n        status,\n        dateRange,\n        search\n      }\n    });\n\n  } catch (error) {\n    console.error('Error fetching submissions:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch submissions' },\n      { status: 500 }\n    );\n  }\n}\n"
    },
    {
      "path": "src/app/globals.css",
      "lang": "css",
      "size": 22858,
      "lines": 780,
      "hash": "8359e459f4cafa2d07d799f8c10452758c5afb0e1ca686a99451051fcc33bd90",
      "truncated": false,
      "content": "@import \"tailwindcss\";\n@import \"../styles/datepicker.css\";\n\n\n@custom-variant dark (&:is(.dark *));\n\n@theme {\n  --font-*: initial;\n  --font-outfit: Outfit, sans-serif;\n\n  --breakpoint-*: initial;\n  --breakpoint-2xsm: 375px;\n  --breakpoint-xsm: 425px;\n  --breakpoint-3xl: 2000px;\n  --breakpoint-sm: 640px;\n  --breakpoint-md: 768px;\n  --breakpoint-lg: 1024px;\n  --breakpoint-xl: 1280px;\n  --breakpoint-2xl: 1536px;\n\n  --text-title-2xl: 72px;\n  --text-title-2xl--line-height: 90px;\n  --text-title-xl: 60px;\n  --text-title-xl--line-height: 72px;\n  --text-title-lg: 48px;\n  --text-title-lg--line-height: 60px;\n  --text-title-md: 36px;\n  --text-title-md--line-height: 44px;\n  --text-title-sm: 30px;\n  --text-title-sm--line-height: 38px;\n  --text-theme-xl: 20px;\n  --text-theme-xl--line-height: 30px;\n  --text-theme-sm: 14px;\n  --text-theme-sm--line-height: 20px;\n  --text-theme-xs: 12px;\n  --text-theme-xs--line-height: 18px;\n\n  --color-current: currentColor;\n  --color-transparent: transparent;\n  --color-white: #ffffff;\n  --color-black: #101828;\n\n  --color-brand-25: #f2f7ff;\n  --color-brand-50: #ecf3ff;\n  --color-brand-100: #dde9ff;\n  --color-brand-200: #c2d6ff;\n  --color-brand-300: #9cb9ff;\n  --color-brand-400: #7592ff;\n  --color-brand-500: #465fff;\n  --color-brand-600: #3641f5;\n  --color-brand-700: #2a31d8;\n  --color-brand-800: #252dae;\n  --color-brand-900: #262e89;\n  --color-brand-950: #161950;\n\n  --color-blue-light-25: #f5fbff;\n  --color-blue-light-50: #f0f9ff;\n  --color-blue-light-100: #e0f2fe;\n  --color-blue-light-200: #b9e6fe;\n  --color-blue-light-300: #7cd4fd;\n  --color-blue-light-400: #36bffa;\n  --color-blue-light-500: #0ba5ec;\n  --color-blue-light-600: #0086c9;\n  --color-blue-light-700: #026aa2;\n  --color-blue-light-800: #065986;\n  --color-blue-light-900: #0b4a6f;\n  --color-blue-light-950: #062c41;\n\n  --color-gray-25: #fcfcfd;\n  --color-gray-50: #f9fafb;\n  --color-gray-100: #f2f4f7;\n  --color-gray-200: #e4e7ec;\n  --color-gray-300: #d0d5dd;\n  --color-gray-400: #98a2b3;\n  --color-gray-500: #667085;\n  --color-gray-600: #475467;\n  --color-gray-700: #344054;\n  --color-gray-800: #1d2939;\n  --color-gray-900: #101828;\n  --color-gray-950: #0c111d;\n  --color-gray-dark: #1a2231;\n\n  --color-orange-25: #fffaf5;\n  --color-orange-50: #fff6ed;\n  --color-orange-100: #ffead5;\n  --color-orange-200: #fddcab;\n  --color-orange-300: #feb273;\n  --color-orange-400: #fd853a;\n  --color-orange-500: #fb6514;\n  --color-orange-600: #ec4a0a;\n  --color-orange-700: #c4320a;\n  --color-orange-800: #9c2a10;\n  --color-orange-900: #7e2410;\n  --color-orange-950: #511c10;\n\n  --color-success-25: #f6fef9;\n  --color-success-50: #ecfdf3;\n  --color-success-100: #d1fadf;\n  --color-success-200: #a6f4c5;\n  --color-success-300: #6ce9a6;\n  --color-success-400: #32d583;\n  --color-success-500: #12b76a;\n  --color-success-600: #039855;\n  --color-success-700: #027a48;\n  --color-success-800: #05603a;\n  --color-success-900: #054f31;\n  --color-success-950: #053321;\n\n  --color-error-25: #fffbfa;\n  --color-error-50: #fef3f2;\n  --color-error-100: #fee4e2;\n  --color-error-200: #fecdca;\n  --color-error-300: #fda29b;\n  --color-error-400: #f97066;\n  --color-error-500: #f04438;\n  --color-error-600: #d92d20;\n  --color-error-700: #b42318;\n  --color-error-800: #912018;\n  --color-error-900: #7a271a;\n  --color-error-950: #55160c;\n\n  --color-warning-25: #fffcf5;\n  --color-warning-50: #fffaeb;\n  --color-warning-100: #fef0c7;\n  --color-warning-200: #fedf89;\n  --color-warning-300: #fec84b;\n  --color-warning-400: #fdb022;\n  --color-warning-500: #f79009;\n  --color-warning-600: #dc6803;\n  --color-warning-700: #b54708;\n  --color-warning-800: #93370d;\n  --color-warning-900: #7a2e0e;\n  --color-warning-950: #4e1d09;\n\n  --color-theme-pink-500: #ee46bc;\n\n  --color-theme-purple-500: #7a5af8;\n\n  --shadow-theme-md:\n    0px 4px 8px -2px rgba(16, 24, 40, 0.1),\n    0px 2px 4px -2px rgba(16, 24, 40, 0.06);\n  --shadow-theme-lg:\n    0px 12px 16px -4px rgba(16, 24, 40, 0.08),\n    0px 4px 6px -2px rgba(16, 24, 40, 0.03);\n  --shadow-theme-sm:\n    0px 1px 3px 0px rgba(16, 24, 40, 0.1),\n    0px 1px 2px 0px rgba(16, 24, 40, 0.06);\n  --shadow-theme-xs: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);\n  --shadow-theme-xl:\n    0px 20px 24px -4px rgba(16, 24, 40, 0.08),\n    0px 8px 8px -4px rgba(16, 24, 40, 0.03);\n  --shadow-datepicker: -5px 0 0 #262d3c, 5px 0 0 #262d3c;\n  --shadow-focus-ring: 0px 0px 0px 4px rgba(70, 95, 255, 0.12);\n  --shadow-slider-navigation:\n    0px 1px 2px 0px rgba(16, 24, 40, 0.1), 0px 1px 3px 0px rgba(16, 24, 40, 0.1);\n  --shadow-tooltip:\n    0px 4px 6px -2px rgba(16, 24, 40, 0.05),\n    -8px 0px 20px 8px rgba(16, 24, 40, 0.05);\n\n  --drop-shadow-4xl:\n    0 35px 35px rgba(0, 0, 0, 0.25), 0 45px 65px rgba(0, 0, 0, 0.15);\n\n  --z-index-1: 1;\n  --z-index-9: 9;\n  --z-index-99: 99;\n  --z-index-999: 999;\n  --z-index-9999: 9999;\n  --z-index-99999: 99999;\n  --z-index-999999: 999999;\n}\n\n/*\n  The default border color has changed to `currentColor` in Tailwind CSS v4,\n  so we've added these compatibility styles to make sure everything still\n  looks the same as it did with Tailwind CSS v3.\n\n  If we ever want to remove these styles, we need to add an explicit border\n  color utility to any element that depends on these defaults.\n*/\n@layer base {\n  *,\n  ::after,\n  ::before,\n  ::backdrop,\n  ::file-selector-button {\n    border-color: var(--color-gray-200, currentColor);\n  }\n  button:not(:disabled),\n  [role=\"button\"]:not(:disabled) {\n    cursor: pointer;\n  }\n  body {\n    @apply relative font-normal font-outfit z-1 bg-gray-50;\n  }\n}\n\n@utility menu-item {\n  @apply relative flex items-center w-full gap-3 px-3 py-2 font-medium rounded-lg text-theme-sm;\n}\n\n@utility menu-item-active {\n  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;\n}\n\n@utility menu-item-inactive {\n  @apply text-gray-700 hover:bg-gray-100 group-hover:text-gray-700 dark:text-gray-300 dark:hover:bg-white/5 dark:hover:text-gray-300;\n}\n\n@utility menu-item-icon {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400;\n}\n\n@utility menu-item-icon-active {\n  @apply text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-item-icon-inactive {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;\n}\n\n@utility menu-item-arrow {\n  @apply relative;\n}\n\n@utility menu-item-arrow-active {\n  @apply rotate-180 text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-item-arrow-inactive {\n  @apply text-gray-500 group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-300;\n}\n\n@utility menu-dropdown-item {\n  @apply relative flex items-center gap-3 rounded-lg px-3 py-2.5 text-theme-sm font-medium;\n}\n\n@utility menu-dropdown-item-active {\n  @apply bg-brand-50 text-brand-500 dark:bg-brand-500/[0.12] dark:text-brand-400;\n}\n\n@utility menu-dropdown-item-inactive {\n  @apply text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-white/5;\n}\n\n@utility menu-dropdown-badge {\n  @apply block rounded-full px-2.5 py-0.5 text-xs font-medium uppercase text-brand-500 dark:text-brand-400;\n}\n\n@utility menu-dropdown-badge-active {\n  @apply bg-brand-100 dark:bg-brand-500/20;\n}\n\n@utility menu-dropdown-badge-inactive {\n  @apply bg-brand-50 group-hover:bg-brand-100 dark:bg-brand-500/15 dark:group-hover:bg-brand-500/20;\n}\n\n@utility no-scrollbar {\n  /* Chrome, Safari and Opera */\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n@utility custom-scrollbar {\n  &::-webkit-scrollbar {\n    @apply size-1.5;\n  }\n\n  &::-webkit-scrollbar-track {\n    @apply rounded-full;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    @apply bg-gray-200 rounded-full dark:bg-gray-700;\n  }\n}\n\n.dark .custom-scrollbar::-webkit-scrollbar-thumb {\n  background-color: #344054;\n}\n\n\n\n@layer utilities {\n  /* For Remove Date Icon */\n  input[type=\"date\"]::-webkit-inner-spin-button,\n  input[type=\"time\"]::-webkit-inner-spin-button,\n  input[type=\"date\"]::-webkit-calendar-picker-indicator,\n  input[type=\"time\"]::-webkit-calendar-picker-indicator {\n    display: none;\n    -webkit-appearance: none;\n  }\n}\n\n/* third-party libraries CSS */\n.apexcharts-legend-text {\n  @apply !text-gray-700 dark:!text-gray-400;\n}\n\n.apexcharts-text {\n  @apply !fill-gray-700 dark:!fill-gray-400;\n}\n\n.apexcharts-tooltip.apexcharts-theme-light {\n  @apply gap-1 !rounded-lg !border-gray-200 p-3 !shadow-theme-sm dark:!border-gray-800 dark:!bg-gray-900;\n}\n\n.apexcharts-legend-text {\n  @apply pl-5! !text-gray-700 dark:!text-gray-400;\n}\n.apexcharts-tooltip-series-group {\n  @apply !p-0;\n}\n.apexcharts-tooltip-y-group {\n  @apply !p-0;\n}\n.apexcharts-tooltip-title {\n  @apply !mb-0 !border-b-0 !bg-transparent !p-0 !text-[10px] !leading-4 !text-gray-800 dark:!text-white/90;\n}\n.apexcharts-tooltip-text {\n  @apply !text-theme-xs !text-gray-700 dark:!text-white/90;\n}\n.apexcharts-tooltip-text-y-value {\n  @apply !font-medium;\n}\n\n.apexcharts-gridline {\n  @apply !stroke-gray-100 dark:!stroke-gray-800;\n}\n\n.flatpickr-wrapper {\n  @apply w-full;\n}\n.flatpickr-calendar {\n  @apply mt-2 !bg-white !rounded-xl !p-5 !border !border-gray-200 dark:!border-gray-800 !text-gray-500 dark:!bg-gray-dark dark:!text-gray-400 dark:!shadow-theme-xl 2xsm:!w-auto;\n}\n\n.flatpickr-months .flatpickr-prev-month:hover svg,\n.flatpickr-months .flatpickr-next-month:hover svg {\n  @apply stroke-brand-500;\n}\n.flatpickr-calendar.arrowTop:before,\n.flatpickr-calendar.arrowTop:after {\n  @apply hidden;\n}\n\n.flatpickr-current-month {\n  @apply !p-0;\n}\n.flatpickr-current-month .cur-month,\n.flatpickr-current-month input.cur-year {\n  @apply !h-auto !pt-0 !text-lg !font-medium !text-gray-800 dark:!text-white/90;\n}\n\n.flatpickr-prev-month,\n.flatpickr-next-month {\n  @apply !p-0;\n}\n\n.flatpickr-weekdays {\n  @apply h-auto mt-6 mb-4 !bg-transparent;\n}\n\n.flatpickr-weekday {\n  @apply !text-theme-sm !font-medium !text-gray-500 dark:!text-gray-400 !bg-transparent;\n}\n\n.flatpickr-day {\n  @apply !flex !items-center !text-theme-sm !font-medium !text-gray-800 dark:!text-white/90 dark:hover:!border-gray-300 dark:hover:!bg-gray-900;\n}\n.flatpickr-day.nextMonthDay,\n.flatpickr-day.prevMonthDay {\n  @apply !text-gray-400;\n}\n\n.flatpickr-months > .flatpickr-month {\n  background: none !important;\n}\n.flatpickr-month .flatpickr-current-month .flatpickr-monthDropdown-months {\n  background: none !important;\n  appearance: none;\n  background-image: none !important;\n  font-weight: 500;\n}\n.flatpickr-month\n.flatpickr-current-month\n.flatpickr-monthDropdown-months:focus {\n  outline: none !important;\n  border: 0 !important;\n}\n.flatpickr-months .flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month {\n  @apply !top-7 dark:!fill-white dark:!text-white !bg-transparent;\n}\n.flatpickr-months .flatpickr-prev-month.flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month.flatpickr-prev-month {\n  @apply !left-7;\n}\n.flatpickr-months .flatpickr-prev-month.flatpickr-next-month,\n.flatpickr-months .flatpickr-next-month.flatpickr-next-month {\n  @apply !right-7;\n}\n.flatpickr-days {\n  @apply !border-0;\n}\nspan.flatpickr-weekday,\n.flatpickr-months .flatpickr-month {\n  @apply dark:!fill-white dark:!text-white !bg-none;\n}\n.flatpickr-innerContainer {\n  @apply !border-b-0;\n}\n.flatpickr-months .flatpickr-month {\n  @apply !bg-none;\n}\n.flatpickr-day.inRange {\n  box-shadow: -5px 0 0 #f9fafb, 5px 0 0 #f9fafb !important;\n  @apply dark:!shadow-datepicker;\n}\n.flatpickr-day.inRange,\n.flatpickr-day.prevMonthDay.inRange,\n.flatpickr-day.nextMonthDay.inRange,\n.flatpickr-day.today.inRange,\n.flatpickr-day.prevMonthDay.today.inRange,\n.flatpickr-day.nextMonthDay.today.inRange,\n.flatpickr-day:hover,\n.flatpickr-day.prevMonthDay:hover,\n.flatpickr-day.nextMonthDay:hover,\n.flatpickr-day:focus,\n.flatpickr-day.prevMonthDay:focus,\n.flatpickr-day.nextMonthDay:focus {\n  @apply !border-gray-50 !bg-gray-50 dark:!border-0 dark:!border-white/5 dark:!bg-white/5;\n}\n.flatpickr-day.selected,\n.flatpickr-day.startRange,\n.flatpickr-day.selected,\n.flatpickr-day.endRange {\n  @apply !text-white dark:!text-white;\n}\n.flatpickr-day.selected,\n.flatpickr-day.startRange,\n.flatpickr-day.endRange,\n.flatpickr-day.selected.inRange,\n.flatpickr-day.startRange.inRange,\n.flatpickr-day.endRange.inRange,\n.flatpickr-day.selected:focus,\n.flatpickr-day.startRange:focus,\n.flatpickr-day.endRange:focus,\n.flatpickr-day.selected:hover,\n.flatpickr-day.startRange:hover,\n.flatpickr-day.endRange:hover,\n.flatpickr-day.selected.prevMonthDay,\n.flatpickr-day.startRange.prevMonthDay,\n.flatpickr-day.endRange.prevMonthDay,\n.flatpickr-day.selected.nextMonthDay,\n.flatpickr-day.startRange.nextMonthDay,\n.flatpickr-day.endRange.nextMonthDay {\n  background: #465fff;\n  @apply !border-brand-500 !bg-brand-500 hover:!border-brand-50 hover:!bg-brand-500;\n}\n.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n + 1)),\n.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n + 1)),\n.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n + 1)) {\n  box-shadow: -10px 0 0 #465fff;\n}\n\n.flatpickr-months .flatpickr-prev-month svg,\n.flatpickr-months .flatpickr-next-month svg,\n.flatpickr-months .flatpickr-prev-month,\n.flatpickr-months .flatpickr-next-month {\n  @apply hover:!fill-none;\n}\n.flatpickr-months .flatpickr-prev-month:hover svg,\n.flatpickr-months .flatpickr-next-month:hover svg {\n  fill: none !important;\n}\n\n.flatpickr-calendar.static {\n  @apply right-0;\n}\n\n.fc .fc-view-harness {\n  @apply max-w-full overflow-x-auto custom-scrollbar;\n}\n.fc-dayGridMonth-view.fc-view.fc-daygrid {\n  @apply min-w-[718px];\n}\n.fc .fc-scrollgrid-section > * {\n  border-right-width: 0;\n  border-bottom-width: 0;\n}\n.fc .fc-scrollgrid {\n  border-left-width: 0;\n}\n.fc .fc-toolbar.fc-header-toolbar {\n  @apply flex-col gap-4 px-6 pt-6 sm:flex-row;\n}\n.fc-button-group {\n  @apply gap-2;\n}\n.fc-button-group .fc-button {\n  @apply flex h-10 w-10 items-center justify-center !rounded-lg border border-gray-200 bg-transparent hover:border-gray-200 hover:bg-gray-50 focus:shadow-none active:!border-gray-200 active:!bg-transparent active:!shadow-none dark:border-gray-800 dark:hover:border-gray-800 dark:hover:bg-gray-900 dark:active:border-gray-800!;\n}\n\n.fc-button-group .fc-button.fc-prev-button:before {\n  @apply inline-block mt-1;\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.fc-button-group .fc-button.fc-next-button:before {\n  @apply inline-block mt-1;\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%23344054' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.dark .fc-button-group .fc-button.fc-prev-button:before {\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M16.0068 6L9.75684 12.25L16.0068 18.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.dark .fc-button-group .fc-button.fc-next-button:before {\n  content: url(\"data:image/svg+xml,%3Csvg width='25' height='24' viewBox='0 0 25 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.50684 19L15.7568 12.75L9.50684 6.5' stroke='%2398A2B3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E%0A\");\n}\n.fc-button-group .fc-button .fc-icon {\n  @apply hidden;\n}\n.fc-addEventButton-button {\n  @apply !rounded-lg !border-0 !bg-brand-500 !px-4 !py-2.5 !text-sm !font-medium hover:!bg-brand-600 focus:!shadow-none;\n}\n.fc-toolbar-title {\n  @apply !text-lg !font-medium text-gray-800 dark:text-white/90;\n}\n.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child {\n  @apply rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900;\n}\n.fc-header-toolbar.fc-toolbar .fc-toolbar-chunk:last-child .fc-button {\n  @apply !h-auto !w-auto rounded-md !border-0 bg-transparent !px-5 !py-2 text-sm font-medium text-gray-500 hover:text-gray-700 focus:shadow-none! dark:text-gray-400;\n}\n.fc-header-toolbar.fc-toolbar\n  .fc-toolbar-chunk:last-child\n  .fc-button.fc-button-active {\n  @apply text-gray-900 bg-white dark:bg-gray-800 dark:text-white;\n}\n.fc-theme-standard th {\n  @apply !border-x-0 border-t !border-gray-200 bg-gray-50 !text-left dark:!border-gray-800 dark:bg-gray-900;\n}\n.fc-theme-standard td,\n.fc-theme-standard .fc-scrollgrid {\n  @apply !border-gray-200 dark:!border-gray-800;\n}\n.fc .fc-col-header-cell-cushion {\n  @apply !px-5 !py-4 text-sm font-medium uppercase text-gray-400;\n}\n.fc .fc-daygrid-day.fc-day-today {\n  @apply bg-transparent;\n}\n.fc .fc-daygrid-day {\n  @apply p-2;\n}\n.fc .fc-daygrid-day.fc-day-today .fc-scrollgrid-sync-inner {\n  @apply rounded-sm bg-gray-100 dark:bg-white/[0.03];\n}\n.fc .fc-daygrid-day-number {\n  @apply !p-3 text-sm font-medium text-gray-700 dark:text-gray-400;\n}\n.fc .fc-daygrid-day-top {\n  @apply !flex-row;\n}\n.fc .fc-day-other .fc-daygrid-day-top {\n  opacity: 1;\n}\n.fc .fc-day-other .fc-daygrid-day-top .fc-daygrid-day-number {\n  @apply text-gray-400 dark:text-white/30;\n}\n.event-fc-color {\n  @apply rounded-lg py-2.5 pl-4 pr-3;\n}\n.event-fc-color .fc-event-title {\n  @apply p-0 text-sm font-normal text-gray-700;\n}\n.fc-daygrid-event-dot {\n  @apply w-1 h-5 ml-0 mr-3 border-none rounded-sm;\n}\n.fc-event {\n  @apply focus:shadow-none;\n}\n.fc-daygrid-event.fc-event-start {\n  @apply !ml-3;\n}\n.event-fc-color.fc-bg-success {\n  @apply border-success-50 bg-success-50;\n}\n.event-fc-color.fc-bg-danger {\n  @apply border-error-50 bg-error-50;\n}\n.event-fc-color.fc-bg-primary {\n  @apply border-brand-50 bg-brand-50;\n}\n.event-fc-color.fc-bg-warning {\n  @apply border-orange-50 bg-orange-50;\n}\n.event-fc-color.fc-bg-success .fc-daygrid-event-dot {\n  @apply bg-success-500;\n}\n.event-fc-color.fc-bg-danger .fc-daygrid-event-dot {\n  @apply bg-error-500;\n}\n.event-fc-color.fc-bg-primary .fc-daygrid-event-dot {\n  @apply bg-brand-500;\n}\n.event-fc-color.fc-bg-warning .fc-daygrid-event-dot {\n  @apply bg-orange-500;\n}\n.fc-direction-ltr .fc-timegrid-slot-label-frame {\n  @apply px-3 py-1.5 text-left text-sm font-medium text-gray-500 dark:text-gray-400;\n}\n.fc .fc-timegrid-axis-cushion {\n  @apply text-sm font-medium text-gray-500 dark:text-gray-400;\n}\n.custom-calendar .fc-h-event {\n  background-color: transparent;\n  border: none;\n  color: black;\n}\n.fc.fc-media-screen {\n  @apply min-h-screen;\n}\n\n.input-date-icon::-webkit-inner-spin-button,\n.input-date-icon::-webkit-calendar-picker-indicator {\n  opacity: 0;\n  -webkit-appearance: none;\n}\n\n.stocks-slider-outer .swiper-button-next:after,\n.stocks-slider-outer .swiper-button-prev:after {\n  @apply hidden;\n}\n\n.stocks-slider-outer .swiper-button-next,\n.stocks-slider-outer .swiper-button-prev {\n  @apply !static mt-0 h-8 w-9 rounded-full border dark:hover:bg-white/[0.05] border-gray-200 !text-gray-700 transition hover:bg-gray-100 dark:border-white/[0.03] dark:bg-gray-800 dark:!text-gray-400  dark:hover:!text-white/90;\n}\n\n.stocks-slider-outer .swiper-button-next.swiper-button-disabled,\n.stocks-slider-outer .swiper-button-prev.swiper-button-disabled {\n  @apply bg-white opacity-50 dark:bg-gray-900;\n}\n\n.stocks-slider-outer .swiper-button-next svg,\n.stocks-slider-outer .swiper-button-prev svg {\n  @apply !h-auto !w-auto;\n}\n\n.swiper-button-prev svg,\n.swiper-button-next svg {\n  @apply !h-auto !w-auto;\n}\n\n.carouselTwo .swiper-button-next:after,\n.carouselTwo .swiper-button-prev:after,\n.carouselFour .swiper-button-next:after,\n.carouselFour .swiper-button-prev:after {\n  @apply hidden;\n}\n.carouselTwo .swiper-button-next.swiper-button-disabled,\n.carouselTwo .swiper-button-prev.swiper-button-disabled,\n.carouselFour .swiper-button-next.swiper-button-disabled,\n.carouselFour .swiper-button-prev.swiper-button-disabled {\n  @apply bg-white/60 !opacity-100;\n}\n.carouselTwo .swiper-button-next,\n.carouselTwo .swiper-button-prev,\n.carouselFour .swiper-button-next,\n.carouselFour .swiper-button-prev {\n  @apply h-10 w-10 rounded-full border-[0.5px] border-white/10 bg-white/90 !text-gray-700 shadow-slider-navigation backdrop-blur-[10px];\n}\n\n.carouselTwo .swiper-button-prev,\n.carouselFour .swiper-button-prev {\n  @apply !left-3 sm:!left-4;\n}\n\n.carouselTwo .swiper-button-next,\n.carouselFour .swiper-button-next {\n  @apply !right-3 sm:!right-4;\n}\n\n.carouselThree .swiper-pagination,\n.carouselFour .swiper-pagination {\n  @apply !bottom-3 !left-1/2 inline-flex !w-auto -translate-x-1/2 items-center gap-1.5 rounded-[40px] border-[0.5px] border-white/10 bg-white/60 px-2 py-1.5 shadow-slider-navigation backdrop-blur-[10px] sm:!bottom-5;\n}\n\n.carouselThree .swiper-pagination-bullet,\n.carouselFour .swiper-pagination-bullet {\n  @apply !m-0 h-2.5 w-2.5 bg-white opacity-100 shadow-theme-xs duration-200 ease-in-out;\n}\n\n.carouselThree .swiper-pagination-bullet-active,\n.carouselFour .swiper-pagination-bullet-active {\n  @apply w-6.5 rounded-xl;\n}\n\n.jvectormap-container {\n  @apply !bg-gray-50 dark:!bg-gray-900;\n}\n.jvectormap-region.jvectormap-element {\n  @apply !fill-gray-300 hover:!fill-brand-500 dark:!fill-gray-700 dark:hover:!fill-brand-500;\n}\n.jvectormap-marker.jvectormap-element {\n  @apply !stroke-gray-200 dark:!stroke-gray-800;\n}\n.jvectormap-tip {\n  @apply !bg-brand-500 !border-none !px-2 !py-1;\n}\n.jvectormap-zoomin,\n.jvectormap-zoomout {\n  @apply !hidden;\n}\n\n.form-check-input:checked ~ span {\n  @apply border-[6px] border-brand-500 bg-brand-500 dark:border-brand-500;\n}\n\n.taskCheckbox:checked ~ .box span {\n  @apply opacity-100 bg-brand-500;\n}\n.taskCheckbox:checked ~ p {\n  @apply text-gray-400 line-through;\n}\n.taskCheckbox:checked ~ .box {\n  @apply border-brand-500 bg-brand-500 dark:border-brand-500;\n}\n\n.task {\n  transition: all 0.2s ease; /* Smooth transition for visual effects */\n}\n\n.task {\n  border-radius: 0.75rem;\n  box-shadow: 0 1px 3px 0 rgba(16, 24, 40, 0.1),\n    0 1px 2px 0 rgba(16, 24, 40, 0.06);\n  opacity: 0.8;\n  cursor: grabbing; /* Changes the cursor to indicate dragging */\n}\n\n/* React PDF Styles - Force Light Theme for PDF Viewer */\n.react-pdf__Document {\n  @apply bg-white;\n}\n\n.react-pdf__Page {\n  @apply bg-white border border-gray-200 shadow-sm;\n}\n\n.react-pdf__Page__canvas {\n  @apply bg-white;\n  /* Force white background to override any dark theme interference */\n  background-color: white !important;\n  color: black !important;\n}\n\n.react-pdf__Page__textContent {\n  @apply bg-white;\n  color: black !important;\n}\n\n.react-pdf__Page__annotations {\n  @apply bg-white;\n}\n\n/* Ensure PDF viewer container always has white background */\n.pdf-viewer-container {\n  @apply bg-white;\n  background-color: white !important;\n  color: black !important;\n}\n\n/* Fallback for any PDF rendering issues */\n.pdf-viewer-container * {\n  color: black !important;\n}\n"
    },
    {
      "path": "src/app/layout.tsx",
      "lang": "tsx",
      "size": 527,
      "lines": 21,
      "hash": "3bfb1e29a5acf5fa66bd7d268952e922deebc71ab64ef2e3c417d7b17a6e07bc",
      "truncated": false,
      "content": "// src/app/layout.tsx\nimport { Outfit } from \"next/font/google\";\nimport \"./globals.css\";\nimport AppProviders from \"@/providers/AppProvider\"; // provider tunggal\n\nconst outfit = Outfit({ subsets: [\"latin\"] });\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <body className={outfit.className} suppressHydrationWarning={true}>\n        <AppProviders>{children}</AppProviders>\n        <div id=\"datepicker-portal\"></div>\n      </body>\n    </html>\n  );\n}"
    },
    {
      "path": "src/app/page.tsx",
      "lang": "tsx",
      "size": 1056,
      "lines": 34,
      "hash": "be2288a9c174764ded69d44bd7dfb25d3c6681414779943431dd5e5cebb2472c",
      "truncated": false,
      "content": "// app/page.tsx\nimport { redirect } from \"next/navigation\";\nimport { getServerSession } from \"next-auth\";   // ✅ helper Next-Auth\nimport { authOptions } from \"@/lib/auth\";  // ✅ kita sudah punya\n\nexport default async function Home() {\n  const session = await getServerSession(authOptions); // ✅\n  if (!session) redirect(\"/login\");\n\n  const { role, verified_at } = session.user;\n  \n  // Check if user needs verification (except admin and super admin)\n  if (role !== \"ADMIN\" && role !== \"SUPER_ADMIN\" && !verified_at) {\n    redirect(\"/verification-pending\");\n  }\n\n  // Redirect to appropriate dashboard based on role\n  if (role === \"SUPER_ADMIN\") {\n    redirect(\"/super-admin\");\n  } else if (role === \"ADMIN\") {\n    redirect(\"/admin\");\n  } else if (role === \"APPROVER\") {\n    redirect(\"/approver\");\n  } else if (role === \"REVIEWER\") {\n    redirect(\"/reviewer\");\n  } else if (role === \"VENDOR\") {\n    redirect(\"/vendor\");\n  } else if (role === \"VERIFIER\") {\n    redirect(\"/verifier\");\n  }\n\n  // Fallback redirect to dashboard\n  redirect(\"/dashboard\");\n}"
    },
    {
      "path": "src/app/socket-provider.tsx",
      "lang": "tsx",
      "size": 7744,
      "lines": 212,
      "hash": "0057d15451758638c7d9dfeb1e94da7672f9014366d50354307ca2ce10696e02",
      "truncated": false,
      "content": "'use client';\n\nimport { createContext, useContext, useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { useSession } from 'next-auth/react';\nimport { useNotificationsStore } from '../store/notifications';\nimport { useStatsStore } from '../store/stats';\nimport { useListsStore } from '../store/lists';\nimport { EVENT_NAMES } from '../shared/events';\nimport type {\n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent,\n  NotificationUnreadCountEvent,\n  StatsUpdateEvent,\n  NotificationRemovedEvent\n} from '../shared/events';\n\ninterface SocketContextType {\n  socket: Socket | null;\n  isConnected: boolean;\n}\n\nconst SocketContext = createContext<SocketContextType>({\n  socket: null,\n  isConnected: false,\n});\n\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within SocketProvider');\n  }\n  return context;\n};\n\nexport function SocketProvider({ children }: { children: React.ReactNode }) {\n  const { data: session } = useSession();\n  const socketRef = useRef<Socket | null>(null);\n  const isConnectedRef = useRef(false);\n  \n  const { addItem: addNotification, setUnreadCount, removeNotifications } = useNotificationsStore();\n  const { updateStats } = useStatsStore();\n  const { addSubmission, updateSubmission, addVendor } = useListsStore();\n\n  // Disable Socket.IO in favor of Server-Sent Events\n  const SOCKET_ENABLED = false;\n\n  useEffect(() => {\n    if (!session?.user || !SOCKET_ENABLED) {\n      // Clean up socket if user logs out or Socket.IO is disabled\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n        socketRef.current = null;\n        isConnectedRef.current = false;\n      }\n      return;\n    }\n\n    // Initialize socket connection only once\n    if (!socketRef.current) {\n      console.log('Initializing Socket.IO connection...');\n      \n      socketRef.current = io({\n        path: '/api/socket',\n        transports: ['websocket', 'polling'],\n        timeout: 10000,\n        forceNew: true,\n        autoConnect: true,\n      });\n\n      const socket = socketRef.current;\n\n      socket.on('connect', () => {\n        console.log('Socket connected:', socket.id);\n        isConnectedRef.current = true;\n        \n        // Join appropriate room based on user role\n        const joinData = {\n          role: session.user.role,\n          ...(session.user.role === 'VENDOR' ? { vendorId: session.user.id } : {})\n        };\n        \n        console.log('Joining room with data:', joinData);\n        socket.emit('join', joinData);\n      });\n\n      socket.on('disconnect', (reason) => {\n        console.log('Socket disconnected:', reason);\n        isConnectedRef.current = false;\n      });\n\n      socket.on('connect_error', (error) => {\n        console.error('Socket connection error:', error);\n        isConnectedRef.current = false;\n        // Don't retry if connection fails multiple times\n        if (error.message.includes('timeout')) {\n          console.log('Socket connection timeout - disabling auto-reconnect');\n          socket.disconnect();\n        }\n      });\n\n      // Event listeners\n      socket.on(EVENT_NAMES.ADMIN_NEW_SUBMISSION, (payload: AdminNewSubmissionEvent) => {\n        console.log('New submission event:', payload);\n        // Refresh submissions list or trigger refetch\n        if (session.user.role === 'ADMIN') {\n          updateStats({ totalSubmissions: 'increment', pendingSubmissions: 'increment' });\n        }\n      });\n\n      socket.on(EVENT_NAMES.ADMIN_NEW_VENDOR, (payload: AdminNewVendorEvent) => {\n        console.log('New vendor event:', payload);\n        // Refresh vendors list or trigger refetch\n        if (session.user.role === 'ADMIN') {\n          updateStats({ totalVendors: 'increment' });\n        }\n      });\n\n      socket.on(EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, (payload: VendorSubmissionStatusChangedEvent) => {\n        console.log('Submission status changed:', payload);\n        \n        // Update submission in the list\n        updateSubmission(payload.submissionId, {\n          approval_status: payload.status\n        });\n      });\n\n      socket.on(EVENT_NAMES.NOTIFICATION_NEW, (payload: NotificationNewEvent) => {\n        console.log('🔔 New notification received via Socket.IO:', payload);\n        \n        // Add notification to store (it will show as unread by default)\n        addNotification({\n          id: payload.id,\n          type: 'notification',\n          title: payload.title,\n          message: payload.message,\n          data: null,\n          createdAt: payload.createdAt,\n          isRead: false\n        });\n        \n        // Note: addNotification already increments unreadCount\n        console.log('✅ Notification added to store');\n      });\n\n      socket.on(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, (payload: NotificationUnreadCountEvent) => {\n        console.log('Unread count update:', payload);\n        setUnreadCount(payload.count);\n      });\n\n      socket.on(EVENT_NAMES.STATS_UPDATE, (payload: StatsUpdateEvent) => {\n        console.log('Stats update:', payload);\n        updateStats(payload.changes as Record<string, number | string>);\n      });\n\n      socket.on(EVENT_NAMES.NOTIFICATION_REMOVED, (payload: NotificationRemovedEvent) => {\n        console.log('🗑️ Notification removal event received:', payload);\n        \n        // Remove notifications related to the deleted submission\n        removeNotifications(payload.submissionId);\n        \n        console.log('✅ Notifications removed from store for submission:', payload.submissionId);\n      });\n\n      // Listen for submission reviewed event (for real-time dashboard updates)\n      socket.on('submission:reviewed', (payload: any) => {\n        console.log('📝 Submission reviewed event received:', payload);\n        // This will trigger dashboard refreshes in ApproverDashboard and ApproverSubmissionsManagement\n      });\n\n      // Listen for submission created event (for real-time dashboard updates)\n      socket.on('submission:created', (payload: any) => {\n        console.log('📋 Submission created event received:', payload);\n        // This will trigger dashboard refreshes in ReviewerDashboard and ReviewerSubmissionsManagement\n      });\n\n      // Listen for submission finalized event (for real-time vendor dashboard updates)\n      socket.on('submission:finalized', (payload: any) => {\n        console.log('🏁 Submission finalized event received:', payload);\n        // This will trigger dashboard refreshes in VendorDashboard and VendorSubmissionsManagement\n      });\n\n      // Listen for user verification needed event (for real-time reviewer dashboard updates)\n      socket.on('user:verification-needed', (payload: any) => {\n        console.log('👤 User verification needed event received:', payload);\n        // This will trigger dashboard refreshes in ReviewerDashboard and user verification components\n      });\n\n      // Listen for user verification result event (for real-time vendor notifications)\n      socket.on('user:verification-result', (payload: any) => {\n        console.log('✅ User verification result event received:', payload);\n        // This will trigger updates in VendorDashboard and vendor notifications\n      });\n    }\n\n    return () => {\n      // Don't disconnect on unmount, keep connection alive for the app\n    };\n  }, [session, addNotification, setUnreadCount, removeNotifications, updateStats, addSubmission, updateSubmission, addVendor]);\n\n  return (\n    <SocketContext.Provider value={{ \n      socket: socketRef.current, \n      isConnected: isConnectedRef.current \n    }}>\n      {children}\n    </SocketContext.Provider>\n  );\n}\n"
    },
    {
      "path": "src/app/test-qr/page.tsx",
      "lang": "tsx",
      "size": 121,
      "lines": 5,
      "hash": "e6a1523c12798f49c1202703ee0951cb8237eb9f2e5bb4fbdae0d46163aef45b",
      "truncated": false,
      "content": "import QRTestPage from '@/components/test/QRTestPage';\n\nexport default function TestQRPage() {\n  return <QRTestPage />;\n}"
    },
    {
      "path": "src/components/admin/AdminSubmissionDetailModal.tsx",
      "lang": "tsx",
      "size": 50032,
      "lines": 1129,
      "hash": "e98207966a7efed0ddc1c483cd834439338c6aac35ee16477ca3030079de6553",
      "truncated": false,
      "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { XMarkIcon, EyeIcon, DocumentIcon, BuildingOfficeIcon, UserIcon, BriefcaseIcon, CalendarIcon, CheckCircleIcon, XCircleIcon, ClockIcon as PendingIcon } from '@heroicons/react/24/outline';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport DatePicker from '@/components/form/DatePicker';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport WorkersList from '@/components/common/WorkersList';\nimport DetailSection from '@/components/common/DetailSection';\nimport InfoCard from '@/components/common/InfoCard';\nimport Alert from '@/components/ui/alert/Alert';\nimport Button from '@/components/ui/button/Button';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  // tembusan?: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  implementation_start_date?: string | null;\n  implementation_end_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  implementation_notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approved_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\ninterface AdminSubmissionDetailModalProps {\n  submission: Submission | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmissionUpdate?: (updatedSubmission: Submission) => void;\n}\n\nexport default function AdminSubmissionDetailModal({\n  submission,\n  isOpen,\n  onClose,\n  onSubmissionUpdate\n}: AdminSubmissionDetailModalProps) {\n  const [activeTab, setActiveTab] = useState('details');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [validationErrors, setValidationErrors] = useState({\n    pelaksanaan: '',\n    keterangan: '',\n    // tembusan: ''\n  });\n  const [showErrorAlert, setShowErrorAlert] = useState(false);\n  const [errorMessage, setErrorMessage] = useState('');\n  const [approvalForm, setApprovalForm] = useState({\n    status: 'APPROVED' as 'APPROVED' | 'REJECTED',\n    keterangan: '',\n    // tembusan: '',\n    tanggal_simlok: '',\n    pelaksanaan: '',\n    lain_lain: '',\n    content: '',\n    jabatan_signer: 'Sr Officer Security III',\n    nama_signer: 'Julianto Santoso'\n  });\n\n  // Template helper fields (tidak disimpan ke database)\n  const [templateFields, setTemplateFields] = useState({\n    tanggal_dari: '',\n    tanggal_sampai: '',\n    tanggal_simlok: submission?.simlok_date || '',\n  });\n\n  // Preview modal state\n  const [previewModal, setPreviewModal] = useState<{\n    isOpen: boolean;\n    fileUrl: string;\n    fileName: string;\n  }>({\n    isOpen: false,\n    fileUrl: '',\n    fileName: ''\n  });\n\n  // SIMLOK PDF modal state\n  const [simlokPdfModal, setSimlokPdfModal] = useState<{\n    isOpen: boolean;\n  }>({\n    isOpen: false\n  });\n\n  // Format date function - defined before useEffect to avoid hoisting issues\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return '-';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  // Main useEffect for modal state management\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n      // Reset approval form when modal opens\n      if (submission) {\n        // Function to format date in local timezone for input fields\n        const formatDateForInput = (dateString: string | null | undefined): string => {\n          if (!dateString) {\n            // Return today's date in local timezone\n            const today = new Date();\n            const todayYear = today.getFullYear();\n            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');\n            const todayDay = String(today.getDate()).padStart(2, '0');\n            return `${todayYear}-${todayMonth}-${todayDay}`;\n          }\n          \n          const date = new Date(dateString);\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        };\n\n        setApprovalForm({\n          status: 'APPROVED',\n          keterangan: submission.other_notes || '',\n          // tembusan: submission.tembusan || '',\n          tanggal_simlok: formatDateForInput(submission.simlok_date),\n          pelaksanaan: submission.implementation || '',\n          lain_lain: submission.other_notes || '',\n          content: submission.content || 'Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.',\n          jabatan_signer: submission.signer_position || 'Sr Officer Security III',\n          nama_signer: submission.signer_name || 'Julianto Santoso'\n        });\n\n        // Reset template fields\n        setTemplateFields({\n          tanggal_dari: submission.implementation_start_date ? formatDateForInput(submission.implementation_start_date) : '',\n          tanggal_sampai: submission.implementation_end_date ? formatDateForInput(submission.implementation_end_date) : '',\n          tanggal_simlok: submission?.simlok_date || '',\n        });\n\n        // Reset validation errors\n        setValidationErrors({\n          pelaksanaan: '',\n          keterangan: '',\n          // tembusan: ''\n        });\n        setShowErrorAlert(false);\n      }\n    } else {\n      document.body.style.overflow = 'unset';\n    }\n\n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, submission]);\n\n// templaet pelaksanaan\n  useEffect(() => {\n    if (templateFields.tanggal_dari && templateFields.tanggal_sampai) {\n      const template = `Terhitung mulai tanggal ${formatDate(templateFields.tanggal_dari)} sampai ${formatDate(templateFields.tanggal_sampai)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;\n      setApprovalForm(prev => ({ ...prev, pelaksanaan: template }));\n    }\n  }, [templateFields.tanggal_dari, templateFields.tanggal_sampai]);\n\n// Template generator untuk lain-lain\n  useEffect(() => {\n    const generateLainLainTemplate = () => {\n      const templateParts = [];\n      \n      // Header template\n      templateParts.push(\"Izin diberikan berdasarkan :\");\n      \n      // SIMJA section\n      if (submission?.simja_number && submission?.simja_date) {\n        templateParts.push(\n          `• SIMJA Ast. Man. Facility Management`,\n          `  No. ${submission.simja_number} Tanggal ${formatDate(submission.simja_date)}`\n        );\n      }\n      \n      // SIKA section  \n      if (submission?.sika_number && submission?.sika_date) {\n        templateParts.push(\n          `• **SIKA** Pekerjaan Dingin`,\n          `  **No.**${submission.sika_number} **Tgl.** ${formatDate(submission.sika_date)}`\n        );\n      }\n      \n      // Head of Security section\n      const tanggalDiterima = approvalForm.tanggal_simlok;\n      if (tanggalDiterima) {\n        templateParts.push(\n          ` `,\n          ` Diterima ${submission?.signer_position || approvalForm.jabatan_signer || '[Jabatan akan diisi saat approval]'}`,\n          `  <strong>${formatDate(tanggalDiterima)}</strong>`\n        );\n      }\n      \n      return templateParts.join('\\n');\n    };\n\n    // Update template jika ada data yang diperlukan\n    const shouldUpdate = approvalForm.tanggal_simlok ||\n                        (submission?.simja_number && submission?.sika_number);\n    \n    if (shouldUpdate) {\n      const newTemplate = generateLainLainTemplate();\n      setApprovalForm(prev => ({ ...prev, lain_lain: newTemplate }));\n    }\n  }, [approvalForm.tanggal_simlok, submission?.simja_number, submission?.simja_date, submission?.sika_number, submission?.sika_date, submission?.signer_position, approvalForm.jabatan_signer]);\n\n  if (!isOpen || !submission) return null;\n\n  // Function to format and display tembusan as list\n  // const formatTembusanDisplay = (tembusan: string) => {\n  //   if (!tembusan) return [];\n  //   return tembusan\n  //     .split(/[\\n,]+/) // Split by newlines or commas\n  //     .map(item => item.trim())\n  //     .filter(item => item.length > 0);\n  // };\n\n \n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      PENDING: { label: 'Menunggu Review', className: 'bg-yellow-100 text-yellow-800' },\n      APPROVED: { label: 'Disetujui', className: 'bg-green-100 text-green-800' },\n      REJECTED: { label: 'Ditolak', className: 'bg-red-100 text-red-800' }\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || { label: status, className: 'bg-gray-100 text-gray-800' };\n\n    return (\n      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${config.className}`}>\n        {config.label}\n      </span>\n    );\n  };\n\n  const handleFileView = (fileUrl: string, fileName: string) => {\n    if (fileUrl) {\n      // Convert legacy URL to new format if needed\n      const convertedUrl = fileUrlHelper.convertLegacyUrl(fileUrl, fileName);\n      setPreviewModal({\n        isOpen: true,\n        fileUrl: convertedUrl,\n        fileName\n      });\n    }\n  };\n\n  const handleClosePreview = () => {\n    setPreviewModal({\n      isOpen: false,\n      fileUrl: '',\n      fileName: ''\n    });\n  };\n\n  const handleCloseSilmokPdf = () => {\n    setSimlokPdfModal({ isOpen: false });\n  };\n\n  const validateForm = () => {\n    const errors = {\n      pelaksanaan: '',\n      keterangan: '',\n      tembusan: ''\n    };\n\n    let hasErrors = false;\n\n    // Validasi pelaksanaan wajib diisi HANYA untuk APPROVED\n    if (approvalForm.status === 'APPROVED' && !approvalForm.pelaksanaan.trim()) {\n      errors.pelaksanaan = 'Pelaksanaan harus diisi untuk menyetujui submission';\n      hasErrors = true;\n    }\n\n    // Validasi keterangan wajib diisi untuk semua status\n    if (!approvalForm.keterangan.trim()) {\n      errors.keterangan = 'Keterangan harus diisi';\n      hasErrors = true;\n    }\n\n    // Validasi tembusan wajib diisi\n    // if (!approvalForm.tembusan.trim()) {\n    //   errors.tembusan = 'Tembusan harus diisi';\n    //   hasErrors = true;\n    // }\n\n    setValidationErrors(errors);\n\n    if (hasErrors) {\n      setErrorMessage('Mohon lengkapi semua field yang wajib diisi');\n      setShowErrorAlert(true);\n      // Auto hide after 5 seconds\n      setTimeout(() => setShowErrorAlert(false), 5000);\n    }\n\n    return !hasErrors;\n  };\n\n  const clearFieldError = (fieldName: keyof typeof validationErrors) => {\n    if (validationErrors[fieldName]) {\n      setValidationErrors(prev => ({ ...prev, [fieldName]: '' }));\n    }\n  };\n\n  const handleViewPDF = async () => {\n    if (!submission) return;\n    \n    try {\n      // Generate PDF URL with correct submission ID  \n      const pdfUrl = `/api/submissions/${submission.id}?format=pdf`;\n      \n      // Test if PDF can be generated first\n      const response = await fetch(pdfUrl, { method: 'HEAD' });\n      \n      if (!response.ok) {\n        setErrorMessage('Gagal memuat PDF. Pastikan semua data sudah lengkap.');\n        setShowErrorAlert(true);\n        setTimeout(() => setShowErrorAlert(false), 5000);\n        return;\n      }\n      \n      // Open SIMLOK PDF modal instead of new tab\n      setSimlokPdfModal({ isOpen: true });\n    } catch (error) {\n      console.error('Error viewing PDF:', error);\n      setErrorMessage('Terjadi kesalahan saat membuka PDF');\n      setShowErrorAlert(true);\n      setTimeout(() => setShowErrorAlert(false), 5000);\n    }\n  };\n\n  const handleApprovalSubmit = async () => {\n    if (!submission) return;\n\n    // Validasi form\n    if (!validateForm()) {\n      return;\n    }\n\n    setIsProcessing(true);\n    setShowErrorAlert(false);\n\n    try {\n      const requestBody: any = {\n        status_approval_admin: approvalForm.status,\n        keterangan: approvalForm.keterangan,\n        pelaksanaan: approvalForm.pelaksanaan,\n        lain_lain: approvalForm.lain_lain,\n        content: approvalForm.content,\n        jabatan_signer: approvalForm.jabatan_signer,\n        nama_signer: approvalForm.nama_signer,\n      };\n\n      // Hanya tambahkan tanggal jika di-approve (nomor akan auto-generate)\n      if (approvalForm.status === 'APPROVED') {\n        requestBody.tanggal_simlok = approvalForm.tanggal_simlok;\n        \n        // Tambahkan tanggal pelaksanaan dari - sampai\n        if (templateFields.tanggal_dari) {\n          requestBody.implementation_start_date = templateFields.tanggal_dari;\n        }\n        if (templateFields.tanggal_sampai) {\n          requestBody.implementation_end_date = templateFields.tanggal_sampai;\n        }\n      }\n\n      const response = await fetch(`/api/submissions/${submission.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        \n        if (errorData.code === 'INVALID_SESSION') {\n          throw new Error('Your session has expired. Please refresh the page and log in again.');\n        }\n        \n        throw new Error(errorData.error || 'Failed to update submission');\n      }\n\n      const updatedSubmission = await response.json();\n\n      // Update parent component if callback provided\n      if (onSubmissionUpdate) {\n        onSubmissionUpdate(updatedSubmission);\n      }\n\n      // Show success message - using custom notification instead of alert\n      setErrorMessage(`Submission berhasil ${approvalForm.status === 'APPROVED' ? 'disetujui' : 'ditolak'}`);\n      setShowErrorAlert(true);\n      setTimeout(() => {\n        setShowErrorAlert(false);\n        onClose();\n      }, 2000);\n    } catch (error) {\n      console.error('Error updating submission:', error);\n      setErrorMessage('Terjadi kesalahan saat memproses approval');\n      setShowErrorAlert(true);\n      setTimeout(() => setShowErrorAlert(false), 5000);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <>\n      <style jsx>{`\n        @keyframes shake {\n          0%, 100% { transform: translateX(0); }\n          10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }\n          20%, 40%, 60%, 80% { transform: translateX(5px); }\n        }\n        .shake {\n          animation: shake 0.5s ease-in-out;\n        }\n      `}</style>\n\n      <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n        {/* Alert Notification */}\n        {showErrorAlert && (\n          <div className=\"fixed top-4 right-4 z-[100] max-w-md animate-bounce\">\n            <Alert\n              variant={errorMessage.includes('berhasil') ? 'success' : 'error'}\n              title={errorMessage.includes('berhasil') ? 'Berhasil!' : 'Validasi Error'}\n              message={errorMessage}\n            />\n          </div>\n        )}\n\n        {/* Backdrop */}\n        <div\n          className=\"fixed inset-0 bg-black/30 transition-opacity\"\n          onClick={onClose}\n        />\n\n        {/* Modal */}\n        <div className=\"flex min-h-full items-center justify-center p-4 pb-20\">\n          <div className=\"relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n\n            {/* Header - Fixed */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0\">\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  Detail Submission - {submission.vendor_name}\n                </h2>\n                <div className=\"flex items-center space-x-4 mt-2\">\n                  {getStatusBadge(submission.approval_status)}\n                  <span className=\"text-sm text-gray-500\">\n                    {formatDate(submission.created_at)}\n                  </span>\n                </div>\n              </div>\n              <button\n                onClick={onClose}\n                className=\"text-gray-400 hover:text-gray-600 transition-colors p-3 hover:bg-gray-100 rounded-full flex-shrink-0 ml-4\"\n                title=\"Tutup Modal\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n            </div>\n\n            {/* Tab Navigation - Fixed */}\n            <div className=\"border-b border-gray-200 flex-shrink-0\">\n              <nav className=\"flex space-x-8 px-6\" aria-label=\"Tabs\">\n                <button\n                  onClick={() => setActiveTab('details')}\n                  className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'details'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    }`}\n                >\n                  Detail Submission\n                </button>\n                <button\n                  onClick={() => setActiveTab('approval')}\n                  className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'approval'\n                      ? 'border-blue-500 text-blue-600'\n                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    }`}\n                >\n                  Status Approval\n                </button>\n              </nav>\n            </div>\n\n            {/* Tab Content - Scrollable with bottom padding */}\n            <div className=\"flex-1 overflow-y-auto min-h-0\">\n              <div className=\"p-6 pb-8\">{/* Extra padding bottom to ensure content doesn't get hidden */}\n\n                {/* Tab 1: Details */}\n                {activeTab === 'details' && (\n                  <div className=\"space-y-6\">\n                    {/* Informasi Vendor */}\n                    <DetailSection \n                      title=\"Informasi Vendor\" \n                      icon={<BuildingOfficeIcon className=\"h-5 w-5 text-blue-500\" />}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <InfoCard\n                          label=\"Nama Vendor\"\n                          value={submission.vendor_name}\n                        />\n                        <InfoCard\n                          label=\"Nama Petugas\"\n                          value={submission.officer_name}\n                          icon={<UserIcon className=\"h-4 w-4 text-gray-500\" />}\n                        />\n                        <InfoCard\n                          label=\"Email\"\n                          value={submission.user.email}\n                        />\n                        <InfoCard\n                          label=\"Berdasarkan\"\n                          value={submission.based_on}\n                        />\n                      </div>\n                    </DetailSection>\n {/* Nomor Dokumen */}\n                    <DetailSection \n                      title=\"Informasi Dokumen\" \n                      icon={<DocumentIcon className=\"h-5 w-5 text-orange-500\" />}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        {submission.simja_number && (\n                          <InfoCard\n                            label=\"Nomor SIMJA\"\n                            value={submission.simja_number}\n                          />\n                        )}\n                        {submission.simja_date && (\n                          <InfoCard\n                            label=\"Tanggal SIMJA\"\n                            value={formatDate(submission.simja_date)}\n                            icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                        {submission.sika_number && (\n                          <InfoCard\n                            label=\"Nomor SIKA\"\n                            value={submission.sika_number}\n                          />\n                        )}\n                        {submission.sika_date && (\n                          <InfoCard\n                            label=\"Tanggal SIKA\"\n                            value={formatDate(submission.sika_date)}\n                            icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                        {/* Nomor SIMLOK - hanya muncul jika sudah APPROVED */}\n                        {submission.approval_status === 'APPROVED' && submission.simlok_number && (\n                          <InfoCard\n                            label=\"Nomor SIMLOK\"\n                            value={submission.simlok_number}\n                          />\n                        )}\n                        {submission.approval_status === 'APPROVED' && submission.simlok_date && (\n                          <InfoCard\n                            label=\"Tanggal SIMLOK\"\n                            value={formatDate(submission.simlok_date)}\n                            icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                        {submission.approval_status === 'APPROVED' && submission.implementation_start_date && (\n                          <InfoCard\n                            label=\"Tanggal Mulai Pelaksanaan\"\n                            value={formatDate(submission.implementation_start_date)}\n                            icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                        {submission.approval_status === 'APPROVED' && submission.implementation_end_date && (\n                          <InfoCard\n                            label=\"Tanggal Selesai Pelaksanaan\"\n                            value={formatDate(submission.implementation_end_date)}\n                            icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                      </div>\n                    </DetailSection>\n\n                    {/* Detail Pekerjaan */}\n                    <DetailSection \n                      title=\"Informasi Pekerjaan\" \n                      icon={<BriefcaseIcon className=\"h-5 w-5 text-green-500\" />}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <InfoCard\n                          label=\"Pekerjaan\"\n                          value={submission.job_description}\n                        />\n                        <InfoCard\n                          label=\"Lokasi Kerja\"\n                          value={submission.work_location}\n                        />\n                        <InfoCard\n                          label=\"Pelaksanaan\"\n                          value={submission.implementation || 'Belum diisi'}\n                        />\n                        <InfoCard\n                          label=\"Jam Kerja\"\n                          value={submission.working_hours}\n                        />\n                        <InfoCard\n                          label=\"Sarana Kerja\"\n                          value={submission.work_facilities}\n                          className=\"md:col-span-2\"\n                        />\n                      </div>\n\n                      {submission.other_notes && (\n                        <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                          <InfoCard\n                            label=\"Lain-lain\"\n                            value={\n                              <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                                {submission.other_notes}\n                              </div>\n                            }\n                          />\n                        </div>\n                      )}\n                      \n                      <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                        <InfoCard\n                          label=\"Content\"\n                          value={\n                            <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                              {submission.content}\n                            </div>\n                          }\n                        />\n                      </div>\n                    </DetailSection>\n\n                    {/* Daftar Pekerja */}\n                    <DetailSection \n                      title=\"Daftar Pekerja\" \n                      icon={<UserIcon className=\"h-5 w-5 text-purple-500\" />}\n                    >\n                      <WorkersList\n                        submissionId={submission.id}\n                        fallbackWorkers={submission.worker_names}\n                        layout=\"grid\"\n                        showPhotos={true}\n                        maxDisplayCount={6}\n                      />\n                    </DetailSection>\n\n                   \n\n                    {/* Informasi Penandatangan */}\n                    <DetailSection \n                      title=\"Informasi Penandatangan\" \n                      icon={<UserIcon className=\"h-5 w-5 text-indigo-500\" />}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <InfoCard\n                          label=\"Jabatan Penandatangan\"\n                          value={submission.signer_position || '-'}\n                        />\n                        <InfoCard\n                          label=\"Nama Penandatangan\"\n                          value={submission.signer_name || '-'}\n                        />\n                      </div>\n                    </DetailSection>\n\n                    {/* Dokumen Upload dalam Detail */}\n                    <DetailSection \n                      title=\"Dokumen Upload\" \n                      icon={<DocumentIcon className=\"h-5 w-5 text-blue-500\" />}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        {/* Dokumen SIKA */}\n                        {submission.sika_document_upload && (\n                          <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                            <div className=\"flex items-center space-x-3\">\n                              <DocumentIcon className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\n                              <div>\n                                <p className=\"font-medium text-gray-900\">Dokumen SIKA</p>\n                                <p className=\"text-sm text-gray-500\">File tersedia</p>\n                              </div>\n                            </div>\n                            <button\n                              onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}\n                              className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                            >\n                              <EyeIcon className=\"w-4 h-4\" />\n                              <span>Lihat</span>\n                            </button>\n                          </div>\n                        )}\n\n                        {/* Dokumen SIMJA */}\n                        {submission.simja_document_upload && (\n                          <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                            <div className=\"flex items-center space-x-3\">\n                              <DocumentIcon className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\n                              <div>\n                                <p className=\"font-medium text-gray-900\">Dokumen SIMJA</p>\n                                <p className=\"text-sm text-gray-500\">File tersedia</p>\n                              </div>\n                            </div>\n                            <button\n                              onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}\n                              className=\"flex items-center space-x-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors\"\n                            >\n                              <EyeIcon className=\"w-4 h-4\" />\n                              <span>Lihat</span>\n                            </button>\n                          </div>\n                        )}\n\n                        {/* Message if no documents */}\n                        {!submission.sika_document_upload && !submission.simja_document_upload && (\n                          <div className=\"col-span-2 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n                            <DocumentIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                            <h3 className=\"text-sm font-medium text-gray-900 mb-1\">Tidak ada dokumen</h3>\n                            <p className=\"text-sm text-gray-500\">Belum ada dokumen yang diupload</p>\n                          </div>\n                        )}\n                      </div>\n                    </DetailSection>\n                  </div>\n                )}\n\n                {/* Tab 2: Approval */}\n                {activeTab === 'approval' && (\n                  <div className=\"space-y-6\">\n                    {/* Status Saat Ini */}\n                    <DetailSection \n                      title=\"Status Approval\" \n                      icon={\n                        submission.approval_status === 'APPROVED' ? (\n                          <CheckCircleIcon className=\"h-5 w-5 text-green-500\" />\n                        ) : submission.approval_status === 'REJECTED' ? (\n                          <XCircleIcon className=\"h-5 w-5 text-red-500\" />\n                        ) : (\n                          <PendingIcon className=\"h-5 w-5 text-yellow-500\" />\n                        )\n                      }\n                      badge={getStatusBadge(submission.approval_status)}\n                    >\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                        <InfoCard\n                          label=\"Status Saat Ini\"\n                          value={getStatusBadge(submission.approval_status)}\n                        />\n                        {submission.approved_by_user && (\n                          <InfoCard\n                            label=\"Disetujui Oleh\"\n                            value={submission.approved_by_user.officer_name}\n                            icon={<UserIcon className=\"h-4 w-4 text-gray-500\" />}\n                          />\n                        )}\n                        {submission.notes && (\n                          <InfoCard\n                            label=\"Keterangan\"\n                            value={\n                              <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                                {submission.notes}\n                              </div>\n                            }\n                            className=\"md:col-span-2\"\n                          />\n                        )}\n                      </div>\n                    </DetailSection>\n\n                    {/* Approval Form - Only show if status is PENDING */}\n                    {submission.approval_status === 'PENDING' && (\n                      <DetailSection \n                        title=\"Proses Approval\" \n                        icon={<DocumentIcon className=\"h-5 w-5 text-blue-500\" />}\n                      >\n                        <div className=\"space-y-6\">\n                          {/* Status Dropdown */}\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Status Keputusan <span className=\"text-red-500\">*</span>\n                            </label>\n                            <select\n                              value={approvalForm.status}\n                              onChange={(e) => setApprovalForm(prev => ({\n                                ...prev,\n                                status: e.target.value as 'APPROVED' | 'REJECTED'\n                              }))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                            >\n                              <option value=\"APPROVED\">Setujui</option>\n                              <option value=\"REJECTED\">Tolak</option>\n                            </select>\n                          </div>\n\n                          {/* Nomor SIMLOK - Only show if APPROVED */}\n                          {approvalForm.status === 'APPROVED' && (\n                            <>\n                              \n                              <div>\n                                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                  Tanggal SIMLOK <span className=\"text-red-500\">*</span>\n                                </label>\n                                <DatePicker\n                                  value={approvalForm.tanggal_simlok}\n                                  onChange={(value) => setApprovalForm(prev => ({ ...prev, tanggal_simlok: value }))}\n                                  placeholder=\"Pilih tanggal SIMLOK\"\n                                  required\n                                />\n                              </div>\n                            </>\n                          )}\n\n                          {/* Fields khusus untuk APPROVED */}\n                          {approvalForm.status === 'APPROVED' && (\n                            <>\n                              {/* Tanggal Pelaksanaan - Admin mengisi */}\n                          <div className=\"space-y-4\">\n                            <label className=\"block text-sm font-medium text-gray-700\">\n                              Tanggal Pelaksanaan <span className=\"text-red-500\">*</span>\n                              <span className=\"text-xs text-gray-500 ml-1\">(Jadwal pelaksanaan kegiatan)</span>\n                            </label>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                              <div>\n                                <label className=\"block text-sm text-gray-600 mb-2\">Tanggal Mulai:</label>\n                                <DatePicker\n                                  value={templateFields.tanggal_dari}\n                                  onChange={(value) => setTemplateFields(prev => ({ ...prev, tanggal_dari: value }))}\n                                  placeholder=\"Pilih tanggal mulai\"\n                                  className=\"w-full\"\n                                />\n                              </div>\n                              <div>\n                                <label className=\"block text-sm text-gray-600 mb-2\">Tanggal Selesai:</label>\n                                <DatePicker\n                                  value={templateFields.tanggal_sampai}\n                                  onChange={(value) => setTemplateFields(prev => ({ ...prev, tanggal_sampai: value }))}\n                                  placeholder=\"Pilih tanggal selesai\"\n                                  className=\"w-full\"\n                                />\n                              </div>\n                            </div>\n\n                            {/* Keterangan Pelaksanaan */}\n                            <div>\n                              <label className=\"block text-sm text-gray-600 mb-2\">Keterangan Pelaksanaan:</label>\n                              <textarea\n                                value={approvalForm.pelaksanaan}\n                                onChange={(e) => {\n                                  setApprovalForm(prev => ({ ...prev, pelaksanaan: e.target.value }));\n                                  clearFieldError('pelaksanaan');\n                                }}\n                                rows={3}\n                                className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-all duration-200 ${validationErrors.pelaksanaan\n                                    ? 'border-red-300 focus:ring-red-500 focus:border-red-500 shake'\n                                    : 'border-gray-300 focus:ring-blue-500 focus:border-transparent'\n                                  }`}\n                                placeholder=\"Contoh: Terhitung mulai tanggal 15 Januari 2024 sampai 20 Januari 2024. Termasuk hari Sabtu, Minggu dan hari libur lainnya.\"\n                              />\n                              {validationErrors.pelaksanaan && (\n                                <p className=\"mt-1 text-sm text-red-600 animate-pulse\">{validationErrors.pelaksanaan}</p>\n                              )}\n                            </div>\n                          </div>\n {/* Jabatan Signer - Admin mengisi */}\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Jabatan Penandatangan\n                              <span className=\"text-xs text-gray-500 ml-1\">(Jabatan yang menandatangani dokumen)</span>\n                            </label>\n                            <input\n                              type=\"text\"\n                              value={approvalForm.jabatan_signer}\n                              onChange={(e) => setApprovalForm(prev => ({ ...prev, jabatan_signer: e.target.value }))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                              placeholder=\"Contoh: Sr Officer Security III, Manager Operations, dll\"\n                            />\n                          </div>\n\n                          {/* Nama Signer - Admin mengisi */}\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Nama Penandatangan\n                              <span className=\"text-xs text-gray-500 ml-1\">(Nama yang menandatangani dokumen)</span>\n                            </label>\n                            <input\n                              type=\"text\"\n                              value={approvalForm.nama_signer}\n                              onChange={(e) => setApprovalForm(prev => ({ ...prev, nama_signer: e.target.value }))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                              placeholder=\"Masukkan nama penandatangan\"\n                            />\n                          </div>\n\n                          {/* Lain-lain - Admin mengisi */}\n                          <div className=\"space-y-3\">\n                            <label className=\"block text-sm font-medium text-gray-700\">\n                              Lain-lain\n                              <span className=\"text-xs text-gray-500 ml-1\">(Catatan tambahan)</span>\n                            </label>\n\n                            <RichTextEditor\n                              value={approvalForm.lain_lain}\n                              onChange={(value) => setApprovalForm(prev => ({ ...prev, lain_lain: value }))}\n                              placeholder=\"Izin diberikan berdasarkan:\\n• Simja Ast Man Facility Management\\n  [nomor] Tgl. [tanggal]\\n• SIKA Pekerjaan Dingin\\n  [nomor] Tgl. [tanggal]\\n  Diterima Head Of Security Region 1\\n  [tanggal]\"\n                            />\n                          </div>\n\n                          {/* Content - Admin mengisi */}\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Content\n                              <span className=\"text-xs text-gray-500 ml-1\">(Isi surat izin masuk lokasi)</span>\n                            </label>\n                            <textarea\n                              value={approvalForm.content}\n                              onChange={(e) => setApprovalForm(prev => ({ ...prev, content: e.target.value }))}\n                              rows={4}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                              placeholder=\"Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.\"\n                            />\n                          </div>\n\n                         \n                          {/* <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Tembusan <span className=\"text-red-500\">*</span>\n                              <span className=\"text-xs text-gray-500 ml-1\">(Wajib diisi)</span>\n                            </label>\n                            <textarea\n                              value={approvalForm.tembusan}\n                              onChange={(e) => {\n                                setApprovalForm(prev => ({ ...prev, tembusan: e.target.value }));\n                                clearFieldError('tembusan');\n                              }}\n                              rows={3}\n                              className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-all duration-200 ${validationErrors.tembusan\n                                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500 shake'\n                                  : 'border-gray-300 focus:ring-blue-500 focus:border-transparent'\n                                }`}\n                              placeholder=\"Masukkan tembusan (pisahkan dengan enter atau koma)&#10;Contoh:&#10;Kepala Bagian&#10;Manager&#10;atau: Kepala Bagian, Manager, Koordinator\"\n                            />\n                            <p className=\"text-sm text-gray-500 mt-1\">\n                              Tip: Pisahkan tembusan dengan enter atau koma. Akan ditampilkan satu item per baris.\n                            </p>\n                            {approvalForm.tembusan && (\n                              <div className=\"mt-2 p-3 bg-green-50 border border-green-200 rounded\">\n                                <p className=\"text-sm text-green-700 font-medium mb-2\">Preview tampilan:</p>\n                                <div className=\"text-sm text-green-800 space-y-1\">\n                                  {formatTembusanDisplay(approvalForm.tembusan).map((item, index) => (\n                                    <div key={index} className=\"flex items-center\">\n                                      <span className=\"w-4 text-green-600\">{index + 1}.</span>\n                                      <span className=\"ml-2\">{item}</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n                            {validationErrors.tembusan && (\n                              <p className=\"mt-1 text-sm text-red-600 animate-pulse\">{validationErrors.tembusan}</p>\n                            )}\n                          </div> */}\n                            </>\n                          )}\n\n                          {/* Keterangan - selalu tampil untuk APPROVED dan REJECTED */}\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                              Keterangan <span className=\"text-red-500\">*</span>\n                              <span className=\"text-xs text-gray-500 ml-1\">(Wajib diisi)</span>\n                            </label>\n                            <textarea\n                              value={approvalForm.keterangan}\n                              onChange={(e) => {\n                                setApprovalForm(prev => ({ ...prev, keterangan: e.target.value }));\n                                clearFieldError('keterangan');\n                              }}\n                              rows={3}\n                              className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 transition-all duration-200 ${validationErrors.keterangan\n                                  ? 'border-red-300 focus:ring-red-500 focus:border-red-500 shake'\n                                  : 'border-gray-300 focus:ring-blue-500 focus:border-transparent'\n                                }`}\n                              placeholder={\n                                approvalForm.status === 'APPROVED'\n                                  ? \"Tambahkan catatan approval...\"\n                                  : \"Alasan penolakan...\"\n                              }\n                            />\n                            {validationErrors.keterangan && (\n                              <p className=\"mt-1 text-sm text-red-600 animate-pulse\">{validationErrors.keterangan}</p>\n                            )}\n                          </div>\n\n                          <div className=\"pt-4\">\n                            <Button\n                              onClick={handleApprovalSubmit}\n                              disabled={isProcessing}\n                              variant={approvalForm.status === 'APPROVED' ? 'primary' : 'destructive'}\n                              size=\"md\"\n                              className=\"w-full\"\n                            >\n                              {isProcessing ? 'Memproses...' : 'Simpan Perubahan'}\n                            </Button>\n                          </div>\n\n                          {/* Validation hints */}\n                          <div className=\"text-xs text-gray-500 bg-gray-50 p-3 rounded-md\">\n                            <p className=\"font-medium mb-1\">Catatan:</p>\n                            <ul className=\"list-disc list-inside space-y-1\">\n                              {approvalForm.status === 'APPROVED' ? (\n                                <>\n                                  <li>Nomor SIMLOK akan dibuat otomatis saat di-approve</li>\n                                  <li>Tanggal SIMLOK, Pelaksanaan dan Keterangan wajib diisi</li>\n                                </>\n                              ) : (\n                                <>\n                                  <li>Hanya Keterangan yang wajib diisi</li>\n                                  <li>Jelaskan alasan penolakan secara detail di keterangan</li>\n                                </>\n                              )}\n                              <li>Semua field bertanda * wajib diisi</li>\n                            </ul>\n                          </div>\n                        </div>\n                      </DetailSection>\n                    )}\n\n                    {/* Document Actions if approved */}\n                  </div>\n                )}\n\n              </div>\n            </div>\n\n            {/* Footer - Always visible with better positioning */}\n            <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-white flex-shrink-0 sticky bottom-0 z-10 shadow-lg\">\n              \n              {/* Tombol PDF - hanya muncul jika sudah APPROVED */}\n              <div className=\"flex items-center space-x-3\">\n                {submission.approval_status === 'APPROVED' && (\n                  <Button\n                    onClick={handleViewPDF}\n                    variant=\"primary\"\n                    size=\"sm\"\n                    className=\"flex items-center\"\n                    title=\"Lihat PDF\"\n                  >\n                    <DocumentIcon className=\"h-4 w-4 mr-2\" />\n                    Lihat PDF\n                  </Button>\n                )}\n              </div>\n\n              <div className=\"flex-1\"></div>\n              \n              <Button\n                onClick={onClose}\n                variant=\"secondary\"\n                size=\"sm\"\n                className=\"flex-shrink-0\"\n              >\n                Tutup\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* SIMLOK PDF Modal */}\n      <SimlokPdfModal\n        isOpen={simlokPdfModal.isOpen}\n        onClose={handleCloseSilmokPdf}\n        submissionId={submission.id}\n        submissionName={submission.vendor_name}\n        nomorSimlok={submission.simlok_number || ''}\n      />\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={previewModal.isOpen}\n        onClose={handleClosePreview}\n        fileUrl={previewModal.fileUrl}\n        fileName={previewModal.fileName}\n      />\n    </>\n  );\n}\n"
    },
    {
      "path": "src/components/admin/DeleteModal.tsx",
      "lang": "tsx",
      "size": 4231,
      "lines": 120,
      "hash": "e8eb1d9f5771c74174e087252925086ed43b8ba6d51b91048c2a6244d2759899",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { UserData } from \"@/types/user\";\nimport { ExclamationTriangleIcon, XMarkIcon } from \"@heroicons/react/24/outline\";\n\ninterface DeleteModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  user?: UserData | null;\n}\n\nexport default function DeleteModal({ isOpen, onClose, onConfirm, user }: DeleteModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const handleDelete = async () => {\n    if (!user) return;\n    \n    setLoading(true);\n    setError(\"\");\n\n    try {\n      const response = await fetch(`/api/users/${user.id}`, {\n        method: \"DELETE\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Gagal menghapus user\");\n      }\n\n      onConfirm();\n      onClose();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen || !user) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center\">\n              <ExclamationTriangleIcon className=\"w-6 h-6 text-red-500 mr-2\" />\n              <h3 className=\"text-lg font-medium text-gray-900\">Konfirmasi Hapus</h3>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100\"\n            >\n              <XMarkIcon className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            {/* Error Message */}\n            {error && (\n              <div className=\"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded\">\n                {error}\n              </div>\n            )}\n\n            <p className=\"text-sm text-gray-600 mb-4\">\n              Apakah Anda yakin ingin menghapus user berikut? Tindakan ini tidak dapat dibatalkan.\n            </p>\n            \n            {/* User Info */}\n            <div className=\"bg-gray-50 p-4 rounded-lg\">\n              <div className=\"text-sm\">\n                <div className=\"font-medium text-gray-900\">{user.officer_name}</div>\n                <div className=\"text-gray-600\">{user.email}</div>\n                <div className=\"text-gray-600 capitalize\">{user.role.toLowerCase()}</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-end space-x-3 p-6 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              disabled={loading}\n              className=\"inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 hover:text-gray-800 hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 transition-all duration-200\"\n            >\n              Batal\n            </button>\n            <button\n              type=\"button\"\n              onClick={handleDelete}\n              disabled={loading}\n              className=\"inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-red-600 border border-red-600 rounded-md hover:bg-red-700 hover:border-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200\"\n            >\n              {loading ? \"Menghapus...\" : \"Hapus\"}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/admin/ExportModal.tsx",
      "lang": "tsx",
      "size": 7617,
      "lines": 222,
      "hash": "6b9c0f49ed9e081c04147e96034c643e9f4fe667636c8c8b052785ba1357f483",
      "truncated": false,
      "content": "'use client';\n\nimport { useState } from 'react';\nimport { \n  XMarkIcon, \n  ArrowDownTrayIcon, \n  CalendarIcon,\n  DocumentArrowDownIcon \n} from '@heroicons/react/24/outline';\nimport { exportSubmissionsToExcel } from '@/lib/exportToExcel';\nimport Button from '@/components/ui/button/Button';\nimport DatePicker from '@/components/form/DatePicker';\n\ninterface ExportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function ExportModal({ isOpen, onClose }: ExportModalProps) {\n  const [dateFrom, setDateFrom] = useState('');\n  const [dateTo, setDateTo] = useState('');\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportMessage, setExportMessage] = useState('');\n  const [exportStatus, setExportStatus] = useState<'success' | 'error' | null>(null);\n\n  const handleExport = async () => {\n    setIsExporting(true);\n    setExportMessage('');\n    setExportStatus(null);\n\n    try {\n      // Fetch submissions data\n      const response = await fetch('/api/admin/submissions/export');\n      if (!response.ok) {\n        throw new Error('Failed to fetch submissions data');\n      }\n\n      const data = await response.json();\n      \n      // Export to Excel\n      const result = exportSubmissionsToExcel(data.submissions, {\n        dateFrom: dateFrom || '',\n        dateTo: dateTo || '',\n        filename: `submissions_export_${dateFrom || 'all'}_${dateTo || 'all'}_${new Date().toISOString().split('T')[0]}.xlsx`\n      });\n\n      if (result.success) {\n        setExportStatus('success');\n        setExportMessage(`${result.message}. Total data: ${result.totalData} submissions.`);\n      } else {\n        setExportStatus('error');\n        setExportMessage(result.message);\n      }\n\n    } catch (error) {\n      console.error('Export error:', error);\n      setExportStatus('error');\n      setExportMessage('Gagal mengexport data. Silakan coba lagi.');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const resetForm = () => {\n    setDateFrom('');\n    setDateTo('');\n    setExportMessage('');\n    setExportStatus(null);\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={handleClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full\">\n          \n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center space-x-3\">\n              <DocumentArrowDownIcon className=\"h-6 w-6 text-blue-500\" />\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Export Data Submissions\n              </h3>\n            </div>\n            <button\n              onClick={handleClose}\n              className=\"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full\"\n              title=\"Tutup Modal\"\n            >\n              <XMarkIcon className=\"w-5 h-5\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            <div className=\"space-y-4\">\n              <div>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Pilih rentang tanggal untuk filter data submissions. Kosongkan untuk export semua data.\n                </p>\n              </div>\n\n              {/* Date Range Picker */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Tanggal Dari\n                  </label>\n                  <div className=\"relative\">\n                    <DatePicker\n                      value={dateFrom}\n                      onChange={setDateFrom}\n                      placeholder=\"Pilih tanggal dari\"\n                      className=\"w-full\"\n                    />\n                    <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none\" />\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Tanggal Sampai\n                  </label>\n                  <div className=\"relative\">\n                    <DatePicker\n                      value={dateTo}\n                      onChange={setDateTo}\n                      placeholder=\"Pilih tanggal sampai\"\n                      className=\"w-full\"\n                    />\n                    <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none\" />\n                  </div>\n                </div>\n              </div>\n\n              {/* Info */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n                <div className=\"flex items-start\">\n                  <DocumentArrowDownIcon className=\"h-5 w-5 text-blue-500 mt-0.5 mr-2 flex-shrink-0\" />\n                  <div className=\"text-sm text-blue-700\">\n                    <p className=\"font-medium mb-1\">Format Export:</p>\n                    <ul className=\"text-xs space-y-1\">\n                      <li>• File Excel (.xlsx)</li>\n                      <li>• Data lengkap submissions</li>\n                      <li>• Summary sheet dengan info filter</li>\n                      <li>• Auto-download ke folder Downloads</li>\n                    </ul>\n                  </div>\n                </div>\n              </div>\n\n              {/* Export Message */}\n              {exportMessage && (\n                <div className={`p-3 rounded-lg ${\n                  exportStatus === 'success' \n                    ? 'bg-green-50 border border-green-200 text-green-700' \n                    : 'bg-red-50 border border-red-200 text-red-700'\n                }`}>\n                  <p className=\"text-sm\">{exportMessage}</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50 rounded-b-lg\">\n            {/* <div className=\"text-sm text-gray-500\">\n              {dateFrom || dateTo ? (\n                <>Filter: {dateFrom || '...'} s/d {dateTo || '...'}</>\n              ) : (\n                'Export semua data'\n              )}\n            </div> */}\n            \n              <Button\n                onClick={resetForm}\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={isExporting}\n              >\n                Reset\n              </Button>\n              \n              <Button\n                onClick={handleExport}\n                variant=\"primary\"\n                size=\"sm\"\n                disabled={isExporting}\n                className=\"flex items-center\"\n              >\n                {isExporting ? (\n                  <>\n                    <div className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2\"></div>\n                    Exporting...\n                  </>\n                ) : (\n                  <>\n                    <ArrowDownTrayIcon className=\"h-4 w-4 mr-2\" />\n                    Export Excel\n                  </>\n                )}\n              </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/admin/SubmissionsManagement.tsx",
      "lang": "tsx",
      "size": 27231,
      "lines": 696,
      "hash": "869e7d57dd4f620eae457d8800d1f6876603326cc06cf080e29bad7edf80fb39",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  ArrowDownTrayIcon\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport ConfirmModal from '@/components/ui/modal/ConfirmModal';\nimport AdminSubmissionDetailModal from './AdminSubmissionDetailModal';\nimport ExportModal from './ExportModal';\nimport { useSubmissionStore } from '@/store/useSubmissionStore';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  // tembusan?: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\n// Types already defined in store\n\n// Custom hook untuk debounced value\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n  useEffect(() => {\n    const handler = setTimeout(() => setDebouncedValue(value), delay);\n    return () => clearTimeout(handler);\n  }, [value, delay]);\n  return debouncedValue;\n}\n\n// Statistics interface removed (using store types)\n\nexport default function SubmissionsManagement() {\n  // Use Zustand store for realtime submissions data\n  const {\n    submissions,\n    loading,\n    statistics,\n    allSubmissionsStats,\n    filteredTotal,\n    searchTerm,\n    sortField,\n    sortOrder,\n    currentPage,\n    totalPages,\n    fetchSubmissions,\n    fetchAdminStats,\n    setSearchTerm,\n    setSortField,\n    setSortOrder,\n    setCurrentPage\n  } = useSubmissionStore();\n\n  // Initialize Socket.IO connection\n  useSocket();\n\n  const [error] = useState(\"\");\n\n  // Alert state\n  const [alert, setAlert] = useState<{\n    show: boolean;\n    variant: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n  }>({\n    show: false,\n    variant: 'success',\n    title: '',\n    message: ''\n  });\n\n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    isOpen: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n  }>({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: () => { }\n  });\n\n  // Modal detail state\n  const [selectedDetailSubmission, setSelectedDetailSubmission] = useState<Submission | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  const [showExportModal, setShowExportModal] = useState(false);\n\n  // Status filter (this is not in store yet, keep local)\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [limit] = useState(10);\n\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  // Fetch submissions when filters change\n  useEffect(() => {\n    const params = {\n      page: currentPage,\n      limit,\n      search: debouncedSearchTerm,\n      sortBy: sortField,\n      sortOrder,\n      stats: true,\n      ...(statusFilter && { status: statusFilter }),\n    };\n\n    console.log('Admin fetching submissions with params:', params); // Debug log\n    fetchSubmissions(params);\n  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchSubmissions]);\n\n  // Debug log for statistics\n  useEffect(() => {\n    console.log('Admin statistics updated:', statistics);\n  }, [statistics]);\n\n  // Fetch admin statistics once when component mounts\n  useEffect(() => {\n    fetchAdminStats();\n  }, [fetchAdminStats]);\n\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  const handleSort = useCallback((field: string) => {\n    if (sortField === field) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortOrder(\"asc\");\n    }\n  }, [sortField, sortOrder, setSortField, setSortOrder]);\n\n  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  };\n\n  const handleStatusFilterChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    setStatusFilter(e.target.value);\n  };\n\n  const handleViewDetail = useCallback((submission: Submission) => {\n    setSelectedDetailSubmission(submission);\n    setIsDetailModalOpen(true);\n  }, []);\n\n  const handleCloseDetailModal = useCallback(() => {\n    setIsDetailModalOpen(false);\n    setSelectedDetailSubmission(null);\n  }, []);\n\n  const handleSubmissionUpdate = useCallback((updatedSubmission: Submission) => {\n    // Update selected submission jika masih dipilih\n    if (selectedDetailSubmission?.id === updatedSubmission.id) {\n      setSelectedDetailSubmission(updatedSubmission);\n    }\n\n    // Refresh data dari server untuk update real-time\n    const params = {\n      page: currentPage,\n      limit,\n      search: debouncedSearchTerm,\n      sortBy: sortField,\n      sortOrder,\n      stats: true,\n      ...(statusFilter && { status: statusFilter }),\n    };\n\n    fetchSubmissions(params);\n  }, [selectedDetailSubmission, fetchSubmissions, currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter]);\n\n  const handleDelete = (id: string) => {\n    setConfirmModal({\n      isOpen: true,\n      title: 'Hapus Submission',\n      message: 'Apakah Anda yakin ingin menghapus submission ini? Tindakan ini tidak dapat dibatalkan.',\n      onConfirm: () => performDelete(id)\n    });\n  };\n\n  const performDelete = async (id: string) => {\n    setConfirmModal(prev => ({ ...prev, isOpen: false }));\n\n    try {\n      const response = await fetch(`/api/submissions/${id}`, { method: 'DELETE' });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to delete submission');\n      }\n\n      // Refresh submissions after successful deletion\n      await fetchSubmissions();\n\n      // Show success message\n      setAlert({\n        show: true,\n        variant: 'success',\n        title: 'Berhasil!',\n        message: 'Submission berhasil dihapus'\n      });\n\n      // Auto hide after 3 seconds\n      setTimeout(() => {\n        setAlert(prev => ({ ...prev, show: false }));\n      }, 3000);\n\n    } catch (error) {\n      console.error('Error deleting submission:', error);\n\n      // Show error message\n      setAlert({\n        show: true,\n        variant: 'error',\n        title: 'Gagal Menghapus',\n        message: error instanceof Error ? error.message : 'Gagal menghapus submission. Silahkan coba lagi.'\n      });\n\n      // Auto hide after 5 seconds\n      setTimeout(() => {\n        setAlert(prev => ({ ...prev, show: false }));\n      }, 5000);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING': return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'APPROVED': return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED': return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default: return <Badge>{status}</Badge>;\n    }\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortField !== field) return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n    return sortOrder === \"asc\"\n      ? <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      : <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />;\n  };\n\n  const formatDate = (dateString: string) =>\n    new Date(dateString).toLocaleDateString(\"id-ID\", { year: \"numeric\", month: \"short\", day: \"numeric\" });\n\n  // Function to format nama_pekerja for table display\n  const formatNamaPekerjaPreview = (names: string, maxDisplay: number = 2): string => {\n    if (!names) return '';\n    const namesList = names\n      .split(/[\\n,]+/)\n      .map(name => name.trim())\n      .filter(name => name.length > 0);\n\n    if (namesList.length <= maxDisplay) {\n      return namesList.join(', ');\n    }\n\n    return `${namesList.slice(0, maxDisplay).join(', ')} +${namesList.length - maxDisplay} lainnya`;\n  };\n\n\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-3 md:px-6 space-y-6\">\n      {/* Alert Notification */}\n      {alert.show && (\n        <div className=\"fixed top-4 right-4 z-50 max-w-md\">\n          <Alert\n            variant={alert.variant}\n            title={alert.title}\n            message={alert.message}\n          />\n        </div>\n      )}\n\n      {/* Statistics */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Total</h3>\n          <p className=\"text-2xl font-bold text-blue-600 mt-1\">{allSubmissionsStats?.total || 0}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Menunggu</h3>\n          <p className=\"text-2xl font-bold text-yellow-600 mt-1\">{allSubmissionsStats?.pending || 0}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n          <p className=\"text-2xl font-bold text-green-600 mt-1\">{allSubmissionsStats?.approved || 0}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n          <p className=\"text-2xl font-bold text-red-600 mt-1\">{allSubmissionsStats?.rejected || 0}</p>\n        </div>\n      </div>\n\n      {/* Header */}\n      <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <div>\n            <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Kelola Pengajuan</h1>\n            {/* <p className=\"text-sm text-gray-500 mt-1\">Manajemen Pengajuan SIMLOK ({statistics?.total || 0} pengajuan)</p> */}\n          </div>\n\n          <Button\n            onClick={() => setShowExportModal(true)}\n            variant=\"outline\"\n            size=\"md\"\n            startIcon={<ArrowDownTrayIcon className=\"w-4 h-4\" />}\n            className=\"bg-green-50 border-green-200 text-green-700 hover:bg-green-100 whitespace-nowrap\"\n          >\n            Export Excel\n          </Button>\n        </div>\n\n        {/* Toolbar - Search and Filters */}\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n          <div className=\"relative w-full md:w-80\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              ref={searchInputRef}\n              type=\"text\"\n              placeholder=\"Cari vendor, petugas, atau pekerjaan…\"\n              value={searchTerm}\n              onChange={handleSearchChange}\n              onBlur={() => setIsInputFocused(false)}\n              onFocus={() => setIsInputFocused(true)}\n              className=\"block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n            />\n          </div>\n\n          <select\n            value={statusFilter}\n            onChange={handleStatusFilterChange}\n            className=\"w-44 px-3 py-2.5 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n          >\n            <option value=\"\">Semua</option>\n            <option value=\"APPROVED\">Disetujui</option>\n            <option value=\"REJECTED\">Ditolak</option>\n            <option value=\"PENDING\">Menunggu</option>\n          </select>\n        </div>\n\n      </div>\n      {/* Content */}\n      {error ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Gagal memuat data pengajuan</h3>\n          <p className=\"text-gray-500 mb-4\">Periksa koneksi atau coba ulang</p>\n          <Button\n            onClick={fetchSubmissions}\n            variant=\"primary\"\n            size=\"md\"\n          >\n            Coba Lagi\n          </Button>\n        </div>\n      ) : submissions.length === 0 && !loading ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2h16a2 2 0 002-2v-5m0 0V9a2 2 0 00-2-2H6a2 2 0 00-2 2v4\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Tidak ada pengajuan</h3>\n          <p className=\"text-gray-500\">Tidak ada pengajuan yang ditemukan dengan filter saat ini</p>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm\">\n          {/* Loading Skeleton */}\n          {loading ? (\n            <div className=\"divide-y\">\n              {/* Header skeleton */}\n              <div className=\"bg-gray-50/50 p-3\">\n                <div className=\"grid grid-cols-6 gap-4\">\n                  {Array.from({ length: 6 }).map((_, i) => (\n                    <div key={i} className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                  ))}\n                </div>\n              </div>\n              {/* Rows skeleton */}\n              {Array.from({ length: 5 }).map((_, i) => (\n                <div key={i} className=\"p-3\">\n                  <div className=\"grid grid-cols-6 gap-4 items-center\">\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse w-3/4\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-2/3\"></div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                    <div className=\"h-6 bg-gray-200 rounded-full animate-pulse w-20\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded animate-pulse w-16\"></div>\n                    <div className=\"flex space-x-2\">\n                      <div className=\"h-8 bg-gray-200 rounded animate-pulse w-16\"></div>\n                      <div className=\"h-8 bg-gray-200 rounded animate-pulse w-16\"></div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <>\n              {/* Desktop Table View */}\n              <div className=\"hidden md:block\">\n                <table className=\"min-w-full\">\n                  <thead>\n                    <tr className=\"bg-gray-50/50 border-b border-gray-200\">\n                      <th\n                        onClick={() => handleSort(\"vendor_name\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Nama Vendor</span>\n                          {getSortIcon(\"vendor_name\")}\n                        </div>\n                      </th>\n                      <th\n                        onClick={() => handleSort(\"job_description\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Pekerjaan</span>\n                          {getSortIcon(\"job_description\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Lokasi & Waktu\n                      </th>\n                      <th\n                        onClick={() => handleSort(\"approval_status\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Status</span>\n                          {getSortIcon(\"approval_status\")}\n                        </div>\n                      </th>\n                      <th\n                        onClick={() => handleSort(\"created_at\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Tanggal</span>\n                          {getSortIcon(\"created_at\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Aksi\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {submissions.map((s: any) => (\n                      <tr\n                        key={s.id}\n                        className=\"hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                        onClick={() => handleViewDetail(s)}\n                      >\n                        <td className=\"p-3 align-top\">\n                          <div className=\"font-medium text-gray-900\">{s.vendor_name}</div>\n                          <div className=\"text-sm text-gray-500\">{s.officer_name}</div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm text-gray-900 max-w-[200px] break-words leading-snug\">\n                            {s.job_description}\n                          </div>\n                          {/* <div className=\"text-xs text-gray-500 mt-1\" title={s.worker_names}>\n                            {formatNamaPekerjaPreview(s.worker_names)}\n                          </div> */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"whitespace-pre-line break-words max-w-[280px] text-sm text-gray-800 leading-snug\">\n                            <div className=\"font-medium\">{s.work_location}</div>\n                            {s.working_hours && (\n                              <div className=\"text-xs text-gray-600 mt-1\">{s.working_hours}</div>\n                            )}\n                          </div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          {getStatusBadge(s.approval_status)}\n                          {/* {s.simlok_number && (\n                            <div className=\"text-xs text-gray-500 mt-1\">\n                              SIMLOK: {s.simlok_number}\n                            </div>\n                          )} */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-xs text-gray-500 whitespace-nowrap\">{formatDate(s.created_at)}</div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"flex items-center space-x-1\" onClick={(e) => e.stopPropagation()}>\n                            <Button\n                              onClick={() => handleViewDetail(s)}\n                              variant=\"info\"\n                              size=\"sm\"\n                              title=\"Lihat detail submission\"\n                              className=\"text-xs\"\n                            >\n                              Lihat\n                            </Button>\n\n                            <Button\n                              onClick={() => handleDelete(s.id)}\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              title=\"Hapus submission ini\"\n                              className=\"text-xs\"\n                            >\n                              Hapus\n                            </Button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Mobile Card View */}\n              <div className=\"md:hidden divide-y divide-gray-200\">\n                {submissions.map((s: any) => (\n                  <div\n                    key={s.id}\n                    className=\"p-4 hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                    onClick={() => handleViewDetail(s)}\n                  >\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-medium text-gray-900\">{s.vendor_name}</h3>\n                        <p className=\"text-sm text-gray-500\">{s.officer_name}</p>\n                      </div>\n                      {getStatusBadge(s.approval_status)}\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-900\">{s.job_description}</p>\n                        <p className=\"text-xs text-gray-500\">{formatNamaPekerjaPreview(s.worker_names)}</p>\n                      </div>\n\n                      <div>\n                        <p className=\"text-sm text-gray-800 whitespace-pre-line break-words leading-snug\">\n                          {s.work_location}\n                          {s.working_hours && ` • ${s.working_hours}`}\n                          {s.implementation && ` • ${s.implementation}`}\n                        </p>\n                      </div>\n\n                      <div className=\"flex justify-between items-center text-xs text-gray-500\">\n                        <span>{formatDate(s.created_at)}</span>\n                        {s.simlok_number && (\n                          <span>SIMLOK: {s.simlok_number}</span>\n                        )}\n                      </div>\n\n                      <div className=\"flex items-center space-x-2 pt-2\" onClick={(e) => e.stopPropagation()}>\n                        <Button\n                          onClick={() => handleViewDetail(s)}\n                          variant=\"info\"\n                          size=\"sm\"\n                          className=\"text-xs flex-1\"\n                        >\n                          Lihat Detail\n                        </Button>\n                        <Button\n                          onClick={() => handleDelete(s.id)}\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          className=\"text-xs\"\n                        >\n                          Hapus\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n\n          {/* Footer with Pagination */}\n          {totalPages > 1 && !loading && (\n            <div className=\"flex items-center justify-between text-sm text-gray-500 p-3 border-t\">\n              <span>{((currentPage - 1) * limit) + 1} - {Math.min(currentPage * limit, filteredTotal)} dari {filteredTotal}</span>\n\n              <div className=\"flex items-center space-x-1\">\n                <button\n                  onClick={() => setCurrentPage((p: number) => Math.max(p - 1, 1))}\n                  disabled={currentPage === 1}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  ←\n                </button>\n\n                <span className=\"px-3 py-1.5 text-gray-700\">Halaman {currentPage} dari {totalPages}</span>\n\n                <button\n                  onClick={() => setCurrentPage((p: number) => Math.min(p + 1, totalPages))}\n                  disabled={currentPage === totalPages}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  →\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Modal Detail */}\n      <AdminSubmissionDetailModal\n        submission={selectedDetailSubmission}\n        isOpen={isDetailModalOpen}\n        onClose={handleCloseDetailModal}\n        onSubmissionUpdate={handleSubmissionUpdate}\n      />\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.isOpen}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        onConfirm={confirmModal.onConfirm}\n        onClose={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))}\n        variant=\"danger\"\n      />\n\n      {/* Export Modal */}\n      <ExportModal\n        isOpen={showExportModal}\n        onClose={() => setShowExportModal(false)}\n      />\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/admin/UserModal.tsx",
      "lang": "tsx",
      "size": 16882,
      "lines": 446,
      "hash": "0132c58c3e4ae02db164a1a0c54b8ae3586d0c29b876dea968709d76ac36efa2",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Role } from \"@prisma/client\";\nimport { UserData } from \"@/types/user\";\nimport Card from \"@/components/ui/Card\";\nimport Button from \"@/components/ui/button/Button\";\nimport Input from \"@/components/form/Input\";\nimport Label from \"@/components/form/Label\";\nimport { \n  XMarkIcon,\n  UserPlusIcon,\n  PencilIcon,\n  UserIcon,\n  EnvelopeIcon,\n  LockClosedIcon,\n  IdentificationIcon,\n  PhoneIcon,\n  BuildingOfficeIcon,\n  MapPinIcon,\n  ShieldCheckIcon\n} from \"@heroicons/react/24/outline\";\n\ninterface UserModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: () => void;\n  user?: UserData | null;\n  mode: \"add\" | \"edit\";\n}\n\ninterface FormData {\n  nama_petugas: string;\n  email: string;\n  password: string;\n  role: Role;\n  alamat: string;\n  no_telp: string;\n  nama_vendor: string;\n  verified_at: string;\n}\n\nexport default function UserModal({ isOpen, onClose, onSave, user, mode }: UserModalProps) {\n  const [formData, setFormData] = useState<FormData>({\n    nama_petugas: \"\",\n    email: \"\",\n    password: \"\",\n    role: Role.VENDOR,\n    alamat: \"\",\n    no_telp: \"\",\n    nama_vendor: \"\",\n    verified_at: \"\",\n  });\n  \n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  useEffect(() => {\n    if (isOpen) {\n      if (mode === \"edit\" && user) {\n        setFormData({\n          nama_petugas: user.officer_name,\n          email: user.email,\n          password: \"\",\n          role: user.role,\n          alamat: user.address || \"\",\n          no_telp: user.phone_number || \"\",\n          nama_vendor: user.vendor_name || \"\",\n          verified_at: user.verified_at ? new Date(user.verified_at).toISOString().slice(0, 16) : \"\",\n        });\n      } else {\n        setFormData({\n          nama_petugas: \"\",\n          email: \"\",\n          password: \"\",\n          role: Role.VENDOR,\n          alamat: \"\",\n          no_telp: \"\",\n          nama_vendor: \"\",\n          verified_at: \"\",\n        });\n      }\n      setError(\"\");\n    }\n  }, [isOpen, mode, user]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      // Konversi nama bidang dari format form ke format API\n      const submitData: any = {\n        officer_name: formData.nama_petugas,\n        email: formData.email,\n        password: formData.password,\n        role: formData.role,\n        address: formData.alamat,\n        phone_number: formData.no_telp,\n        vendor_name: formData.nama_vendor,\n        verified_at: formData.verified_at\n      };\n      \n      // Remove empty password for edit mode\n      if (mode === \"edit\" && !submitData.password) {\n        delete submitData.password;\n      }\n\n      // Handle verified_at\n      if (submitData.verified_at) {\n        submitData.verified_at = new Date(submitData.verified_at).toISOString();\n      } else {\n        delete submitData.verified_at;\n      }\n\n      // Remove vendor_name if role is not VENDOR\n      if (submitData.role !== Role.VENDOR) {\n        submitData.vendor_name = \"\";\n      }\n\n      console.log(\"Mengirim data ke API:\", submitData);\n\n      const url = mode === \"add\" ? \"/api/users\" : `/api/users/${user?.id}`;\n      const method = mode === \"add\" ? \"POST\" : \"PUT\";\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(submitData),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Terjadi kesalahan\");\n      }\n\n      onSave();\n      onClose();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (field: keyof FormData, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n      <div className=\"max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n        <Card className=\"shadow-2xl\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center\">\n              <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4\">\n                {mode === \"add\" ? (\n                  <UserPlusIcon className=\"w-6 h-6 text-brand-600\" />\n                ) : (\n                  <PencilIcon className=\"w-6 h-6 text-brand-600\" />\n                )}\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  {mode === \"add\" ? \"Tambah User Baru\" : \"Edit User\"}\n                </h2>\n                <p className=\"text-sm text-gray-500\">\n                  {mode === \"add\" \n                    ? \"Buat akun user baru dengan informasi lengkap\" \n                    : \"Ubah informasi user yang sudah ada\"\n                  }\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6 max-h-[calc(90vh-200px)] overflow-y-auto\">\n            {/* Error Message */}\n            {error && (\n              <Card className=\"bg-red-50 border border-red-200 mb-6\">\n                <div className=\"p-4\">\n                  <div className=\"flex items-start\">\n                    <div className=\"w-5 h-5 text-red-400 mt-0.5 mr-3\">⚠️</div>\n                    <div className=\"text-sm text-red-800\">{error}</div>\n                  </div>\n                </div>\n              </Card>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-8\">\n              {/* Personal Information Section */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                  <UserIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                  Informasi Personal\n                </h3>\n                \n                <Card className=\"bg-gray-50\">\n                  <div className=\"p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      {/* Nama Petugas */}\n                      <div>\n                        <div className=\"flex items-center mb-2\">\n                          <UserIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                          <Label>Nama Petugas <span className=\"text-red-500\">*</span></Label>\n                        </div>\n                        <Input\n                          type=\"text\"\n                          required\n                          value={formData.nama_petugas}\n                          onChange={(e) => handleInputChange(\"nama_petugas\", e.target.value)}\n                          placeholder=\"Masukkan nama lengkap petugas\"\n                          className=\"w-full\"\n                        />\n                      </div>\n\n                      {/* Email */}\n                      <div>\n                        <div className=\"flex items-center mb-2\">\n                          <EnvelopeIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                          <Label>Email <span className=\"text-red-500\">*</span></Label>\n                        </div>\n                        <Input\n                          type=\"email\"\n                          required\n                          value={formData.email}\n                          onChange={(e) => handleInputChange(\"email\", e.target.value)}\n                          placeholder=\"example@company.com\"\n                          className=\"w-full\"\n                        />\n                      </div>\n\n                      {/* No Telepon */}\n                      <div>\n                        <div className=\"flex items-center mb-2\">\n                          <PhoneIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                          <Label>No. Telepon</Label>\n                        </div>\n                        <Input\n                          type=\"tel\"\n                          value={formData.no_telp}\n                          onChange={(e) => handleInputChange(\"no_telp\", e.target.value)}\n                          placeholder=\"08xxxxxxxxxx\"\n                          className=\"w-full\"\n                        />\n                      </div>\n\n                      {/* Role */}\n                      <div>\n                        <div className=\"flex items-center mb-2\">\n                          <IdentificationIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                          <Label>Role <span className=\"text-red-500\">*</span></Label>\n                        </div>\n                        <select\n                          required\n                          value={formData.role}\n                          onChange={(e) => handleInputChange(\"role\", e.target.value)}\n                          className=\"w-full px-4 py-2.5 border border-gray-300 rounded-lg \n                                   focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 \n                                   bg-white text-gray-900                                   transition-colors duration-200\"\n                        >\n                          <option value={Role.VENDOR}>Vendor</option>\n                          <option value={Role.VERIFIER}>Verifier</option>\n                          <option value={Role.ADMIN}>Admin</option>\n                          <option value={Role.SUPER_ADMIN}>Super Admin</option>\n                        </select>\n                      </div>\n                    </div>\n\n                    {/* Alamat */}\n                    <div className=\"mt-6\">\n                      <div className=\"flex items-center mb-2\">\n                        <MapPinIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                        <Label>Alamat Lengkap</Label>\n                      </div>\n                      <textarea\n                        rows={3}\n                        value={formData.alamat}\n                        onChange={(e) => handleInputChange(\"alamat\", e.target.value)}\n                        placeholder=\"Masukkan alamat lengkap termasuk kode pos\"\n                        className=\"w-full px-4 py-2.5 border border-gray-300 rounded-lg \n                                 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 \n                                 bg-white text-gray-900                                 transition-colors duration-200 resize-none\"\n                      />\n                    </div>\n                  </div>\n                </Card>\n              </div>\n\n              {/* Account Information Section */}\n              <div>\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                  <ShieldCheckIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                  Informasi Akun\n                </h3>\n                \n                <Card className=\"bg-gray-50\">\n                  <div className=\"p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      {/* Password */}\n                      <div>\n                        <div className=\"flex items-center mb-2\">\n                          <LockClosedIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                          <Label>\n                            Password {mode === \"add\" ? <span className=\"text-red-500\">*</span> : \"(kosongkan jika tidak diubah)\"}\n                          </Label>\n                        </div>\n                        <Input\n                          type=\"password\"\n                          required={mode === \"add\"}\n                          value={formData.password}\n                          onChange={(e) => handleInputChange(\"password\", e.target.value)}\n                          placeholder={mode === \"add\" ? \"Minimal 6 karakter\" : \"Kosongkan jika tidak diubah\"}\n                          minLength={mode === \"add\" ? 6 : undefined}\n                          className=\"w-full\"\n                        />\n                        {mode === \"edit\" && (\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            Biarkan kosong untuk mempertahankan password yang ada\n                          </p>\n                        )}\n                      </div>\n\n                      {/* Nama Vendor (hanya untuk role VENDOR) */}\n                      {formData.role === Role.VENDOR && (\n                        <div>\n                          <div className=\"flex items-center mb-2\">\n                            <BuildingOfficeIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                            <Label>Nama Vendor</Label>\n                          </div>\n                          <Input\n                            type=\"text\"\n                            value={formData.nama_vendor}\n                            onChange={(e) => handleInputChange(\"nama_vendor\", e.target.value)}\n                            placeholder=\"Masukkan nama perusahaan vendor\"\n                            className=\"w-full\"\n                          />\n                        </div>\n                      )}\n\n                      {/* Verified At (hanya untuk edit mode) */}\n                      {mode === \"edit\" && (\n                        <div>\n                          <div className=\"flex items-center mb-2\">\n                            <ShieldCheckIcon className=\"w-4 h-4 text-gray-500 mr-2\" />\n                            <Label>Tanggal Verifikasi</Label>\n                          </div>\n                          <Input\n                            type=\"datetime-local\"\n                            value={formData.verified_at}\n                            onChange={(e) => handleInputChange(\"verified_at\", e.target.value)}\n                            className=\"w-full\"\n                          />\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            Kosongkan jika user belum diverifikasi\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </Card>\n              </div>\n\n              {/* Role-specific Information */}\n              {formData.role === Role.VENDOR && (\n                <Card className=\"bg-blue-50 border border-blue-200\">\n                  <div className=\"p-4\">\n                    <div className=\"flex items-start\">\n                      <BuildingOfficeIcon className=\"w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0\" />\n                      <div className=\"text-sm\">\n                        <p className=\"font-medium text-blue-800 mb-1\">\n                          Informasi Vendor\n                        </p>\n                        <p className=\"text-blue-700\">\n                          User dengan role Vendor akan memiliki akses untuk mengelola produk, \n                          submission, dan dapat mengisi nama vendor sebagai identitas perusahaan.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </Card>\n              )}\n            </form>\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-end space-x-3 p-6 border-t border-gray-200\">\n            <Button\n              type=\"button\"\n              onClick={onClose}\n              variant=\"outline\"\n              size=\"md\"\n              disabled={loading}\n            >\n              Batal\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={loading}\n              variant=\"primary\"\n              size=\"md\"\n            >\n              {loading ? (\n                <span className=\"flex items-center\">\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                  {mode === \"add\" ? \"Menambah...\" : \"Menyimpan...\"}\n                </span>\n              ) : (\n                <>\n                  {mode === \"add\" ? (\n                    <>\n                      <UserPlusIcon className=\"w-4 h-4 mr-2\" />\n                      Tambah User\n                    </>\n                  ) : (\n                    <>\n                      <PencilIcon className=\"w-4 h-4 mr-2\" />\n                      Simpan Perubahan\n                    </>\n                  )}\n                </>\n              )}\n            </Button>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/admin/UserVerificationModal.tsx",
      "lang": "tsx",
      "size": 18363,
      "lines": 443,
      "hash": "36bfb3d7818f7eecef5c518fb865a74935dfb23fc3004979631989e533f4af8d",
      "truncated": false,
      "content": "'use client';\n\nimport { useState } from 'react';\nimport { UserData } from '@/types/user';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport { \n  XMarkIcon, \n  CheckCircleIcon, \n  XCircleIcon,\n  ExclamationTriangleIcon,\n  UserIcon,\n  EnvelopeIcon,\n  BuildingOfficeIcon,\n  PhoneIcon,\n  MapPinIcon,\n  ClockIcon,\n  ShieldCheckIcon,\n  IdentificationIcon\n} from '@heroicons/react/24/outline';\n\ninterface UserVerificationModalProps {\n  user: UserData | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUserUpdate?: (updatedUser: UserData) => void;\n  onUserRemove?: (userId: string) => void;\n  userRole?: string | undefined; // Add userRole prop to determine which API to use\n}\n\nexport default function UserVerificationModal({\n  user,\n  isOpen,\n  onClose,\n  onUserUpdate,\n  onUserRemove,\n  userRole\n}: UserVerificationModalProps) {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);\n\n  if (!isOpen || !user) return null;\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const isVerified = !!user.verified_at;\n\n  const handleVerifyUser = async (action: 'approve' | 'reject') => {\n    setIsProcessing(true);\n    try {\n      // Determine API endpoint based on user role\n      let apiEndpoint = `/api/users/${user.id}/verify`;\n      let method = 'PUT';\n      let body = JSON.stringify({ action });\n\n      if (userRole === 'REVIEWER') {\n        apiEndpoint = `/api/reviewer/users/${user.id}`;\n        method = 'PATCH';\n        body = JSON.stringify({ \n          status: action === 'approve' ? 'VERIFY' : 'REJECT'\n        });\n      }\n\n      const response = await fetch(apiEndpoint, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body,\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        \n        if (action === 'approve' && result.user) {\n          onUserUpdate?.(result.user);\n        } else if (action === 'reject') {\n          onUserRemove?.(user.id);\n        }\n        \n        setShowConfirmModal(null);\n        onClose();\n      } else {\n        const error = await response.json();\n        alert(error.error || `Gagal ${action === 'approve' ? 'menyetujui' : 'menolak'} user`);\n      }\n    } catch (error) {\n      console.error('Error:', error);\n      alert(`Terjadi kesalahan saat ${action === 'approve' ? 'menyetujui' : 'menolak'} user`);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const ConfirmModal = () => {\n    if (!showConfirmModal) return null;\n\n    const isApprove = showConfirmModal === 'approve';\n\n    return (\n      <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]\">\n        <Card className=\"max-w-md w-full mx-4\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center mb-4\">\n              <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                isApprove ? 'bg-green-100' : 'bg-red-100'\n              }`}>\n                {isApprove ? (\n                  <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                ) : (\n                  <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n                )}\n              </div>\n              <div className=\"ml-4\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">\n                  Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}\n                </h3>\n              </div>\n            </div>\n\n            <p className=\"text-gray-600 mb-6\">\n              Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}\n              <strong className=\"text-gray-900\">{user.officer_name}</strong>?\n            </p>\n\n            {!isApprove && (\n              <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 mb-6\">\n                <div className=\"flex items-start\">\n                  <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" />\n                  <div className=\"text-sm\">\n                    <p className=\"font-medium text-red-800 mb-1\">Peringatan!</p>\n                    <p className=\"text-red-700\">\n                      User akan dihapus dari sistem dan tidak dapat login lagi.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex justify-end space-x-3\">\n              <Button\n                onClick={() => setShowConfirmModal(null)}\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={isProcessing}\n              >\n                Batal\n              </Button>\n              <Button\n                onClick={() => handleVerifyUser(showConfirmModal)}\n                disabled={isProcessing}\n                variant={isApprove ? \"primary\" : \"destructive\"}\n                size=\"sm\"\n              >\n                {isProcessing ? (\n                  <span className=\"flex items-center\">\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                    Memproses...\n                  </span>\n                ) : (\n                  `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`\n                )}\n              </Button>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  };\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n        <div className=\"max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n          <Card className=\"shadow-2xl\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4\">\n                  <UserIcon className=\"w-6 h-6 text-brand-600\" />\n                </div>\n                <div>\n                  <h2 className=\"text-xl font-semibold text-gray-900\">\n                    Detail User\n                  </h2>\n                  <p className=\"text-sm text-gray-500\">\n                    Informasi lengkap dan status verifikasi\n                  </p>\n                </div>\n              </div>\n              <Button\n                onClick={onClose}\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"p-2\"\n              >\n                <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n              </Button>\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6 max-h-[calc(90vh-200px)] overflow-y-auto\">\n              <div className=\"space-y-8\">\n                {/* Status Section */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${\n                      isVerified \n                        ? 'bg-green-100 text-green-800' \n                        : 'bg-warning-100 text-warning-800'\n                    }`}>\n                      {isVerified ? (\n                        <CheckCircleIcon className=\"w-4 h-4\" />\n                      ) : (\n                        <ClockIcon className=\"w-4 h-4\" />\n                      )}\n                      {isVerified ? 'Terverifikasi' : 'Menunggu Verifikasi'}\n                    </div>\n                    <div className={`px-3 py-1 rounded-full text-sm font-medium ${\n                      user.role === 'VENDOR' \n                        ? 'bg-blue-100 text-blue-800' \n                        : user.role === 'VERIFIER'\n                        ? 'bg-purple-100 text-purple-800'\n                        : 'bg-gray-100 text-gray-800'\n                    }`}>\n                      <IdentificationIcon className=\"w-4 h-4 inline mr-1\" />\n                      {user.role}\n                    </div>\n                  </div>\n                </div>\n\n                {/* User Info Grid */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                  {/* Personal Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <UserIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Personal\n                      </h3>\n                      \n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <UserIcon className=\"w-5 h-5 text-blue-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.officer_name}\n                            </p>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <EnvelopeIcon className=\"w-5 h-5 text-green-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Email</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.email}\n                            </p>\n                          </div>\n                        </div>\n\n                        {user.phone_number && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <PhoneIcon className=\"w-5 h-5 text-orange-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">No. Telepon</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {user.phone_number}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        {user.address && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <MapPinIcon className=\"w-5 h-5 text-blue-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {user.address}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n\n                  {/* System Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <ShieldCheckIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Sistem\n                      </h3>\n\n                      <div className=\"space-y-4\">\n                        {user.vendor_name && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <BuildingOfficeIcon className=\"w-5 h-5 text-indigo-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {user.vendor_name}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <ClockIcon className=\"w-5 h-5 text-gray-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Tanggal Daftar</p>\n                            <p className=\"text-base font-medium text-gray-900\">\n                              {formatDate(user.created_at)}\n                            </p>\n                          </div>\n                        </div>\n\n                        {isVerified && user.verified_at && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <ShieldCheckIcon className=\"w-5 h-5 text-green-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Diverifikasi Pada</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {formatDate(user.verified_at)}\n                              </p>\n                              {user.verified_by && (\n                                <p className=\"text-sm text-gray-600 mt-1\">\n                                  oleh: {user.verified_by}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n\n                {/* Actions for Unverified Users */}\n                {!isVerified && (\n                  <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                        <CheckCircleIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n                        Tindakan Verifikasi\n                      </h3>\n                      <p className=\"text-sm text-gray-600 mb-6\">\n                        Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, \n                        sedangkan penolakan akan menghapus user dari sistem.\n                      </p>\n                      <div className=\"flex flex-col sm:flex-row gap-4\">\n                        <Button\n                          onClick={() => setShowConfirmModal('approve')}\n                          disabled={isProcessing}\n                          variant=\"primary\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <CheckCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Setujui User\n                        </Button>\n                        <Button\n                          onClick={() => setShowConfirmModal('reject')}\n                          disabled={isProcessing}\n                          variant=\"destructive\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <XCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Tolak User\n                        </Button>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n\n                {/* Verification Status Info */}\n                {isVerified && (\n                  <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n                    <div className=\"p-6\">\n                      <div className=\"flex items-start\">\n                        <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                          <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                        </div>\n                        <div>\n                          <h4 className=\"text-lg font-semibold text-green-900 mb-2\">\n                            User Sudah Terverifikasi\n                          </h4>\n                          <p className=\"text-green-700\">\n                            User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan \n                            memiliki akses penuh ke fitur yang tersedia.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n              </div>\n            </div>\n\n            {/* Footer */}\n            <div className=\"flex justify-end p-6 border-t border-gray-200\">\n              <Button onClick={onClose} variant=\"outline\" size=\"md\">\n                Tutup\n              </Button>\n            </div>\n          </Card>\n        </div>\n      </div>\n\n      {/* Confirmation Modal */}\n      <ConfirmModal />\n    </>\n  );\n}\n"
    },
    {
      "path": "src/components/admin/UsersTable.tsx",
      "lang": "tsx",
      "size": 20907,
      "lines": 580,
      "hash": "0cf7825abba8ff8b0edd280895d3802235a9eaeab102beed816a859c521c9396",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { Role } from \"@prisma/client\";\nimport { UserData } from \"@/types/user\";\nimport { \n\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n} from \"@heroicons/react/24/outline\";\nimport Button from \"@/components/ui/button/Button\";\n\ninterface UsersTableProps {\n  onEdit: (user: UserData) => void;\n  onDelete: (user: UserData) => void;\n  onView: (user: UserData) => void;\n  onAdd?: () => void;\n  refreshTrigger: number;\n  filterByRole?: Role | null;\n  filterByVerification?: boolean | null;\n}\n\ntype SortField = keyof UserData;\ntype SortOrder = \"asc\" | \"desc\";\n\n// Custom hook untuk debounced value\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n\nexport default function UsersTable({ \n  onEdit, \n  onDelete, \n  onView, \n  refreshTrigger,\n  filterByRole,\n  filterByVerification\n}: UsersTableProps) {\n  const [users, setUsers] = useState<UserData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  \n  // Pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalUsers, setTotalUsers] = useState(0);\n  const [limit] = useState(10);\n  \n  // Search & Filter\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState<Role | \"\">(\"\");\n  const [verificationFilter, setVerificationFilter] = useState<\"all\" | \"pending\" | \"verified\">(\"all\");\n  \n  // Sorting\n  const [sortField, setSortField] = useState<SortField>(\"created_at\");\n  const [sortOrder, setSortOrder] = useState<SortOrder>(\"desc\");\n\n  // Ref untuk search input\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  // Debounced search term - akan menunggu 500ms setelah user berhenti mengetik\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  const fetchUsers = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(\"\");\n      \n      // Bangun parameter URL untuk API\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: limit.toString(),\n        sortBy: sortField,\n        sortOrder: sortOrder,\n      });\n      \n      // Tambahkan search term jika tidak kosong\n      if (debouncedSearchTerm) {\n        params.append(\"search\", debouncedSearchTerm);\n      }\n      \n      // Tambahkan role filter jika tidak kosong\n      if (roleFilter) {\n        params.append(\"role\", roleFilter);\n      }\n      \n      // Tambahkan verification status filter jika tidak \"all\"\n      if (verificationFilter !== \"all\") {\n        params.append(\"verificationStatus\", verificationFilter);\n      }\n\n      console.log(\"Fetching users with params:\", {\n        page: currentPage,\n        limit,\n        search: debouncedSearchTerm,\n        sortBy: sortField,\n        sortOrder,\n        role: roleFilter || \"(not set)\",\n        verificationStatus: verificationFilter\n      });\n\n      const response = await fetch(`/api/users?${params}`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Gagal mengambil data user\");\n      }\n\n      const data = await response.json();\n      console.log(\"API response:\", {\n        totalUsers: data.pagination.total,\n        usersCount: data.users.length,\n        firstUser: data.users[0]\n      });\n      \n      setUsers(data.users);\n      setTotalPages(data.pagination.totalPages);\n      setTotalUsers(data.pagination.total);\n      \n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n      console.error(\"Error fetching users:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, debouncedSearchTerm, roleFilter, verificationFilter, sortField, sortOrder, limit]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers, refreshTrigger]);\n\n  // Effect untuk menangani perubahan props filterByVerification dan filterByRole\n  useEffect(() => {\n    console.log(\"Filter props changed:\", { filterByRole, filterByVerification });\n    \n    // Atur filter role dari props\n    if (filterByRole !== undefined && filterByRole !== null) {\n      console.log(\"Setting role filter to:\", filterByRole);\n      setRoleFilter(filterByRole);\n    } else {\n      console.log(\"Clearing role filter\");\n      setRoleFilter(\"\");\n    }\n    \n    // Atur filter verifikasi dari props\n    if (filterByVerification !== undefined && filterByVerification !== null) {\n      // Jika filterByVerification adalah true, set ke \"pending\"\n      // Jika filterByVerification adalah false, set ke \"verified\"\n      const newVerificationFilter = filterByVerification === true ? \"pending\" : \"verified\";\n      console.log(\"Setting verification filter to:\", newVerificationFilter);\n      setVerificationFilter(newVerificationFilter);\n    } else {\n      console.log(\"Setting verification filter to all\");\n      setVerificationFilter(\"all\");\n    }\n\n    // Reset ke halaman 1 setiap kali filter berubah dari props\n    setCurrentPage(1);\n    \n    // Tidak perlu memanggil fetchUsers() di sini karena perubahan state di atas\n    // akan memicu useEffect yang memantau dependensi fetchUsers\n  }, [filterByRole, filterByVerification]);\n\n  // Kembalikan fokus ke search input setelah data reload\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  // Reset semua filter dan kembali ke halaman 1\n  const resetFilters = useCallback(() => {\n    setSearchTerm(\"\");\n    setRoleFilter(\"\");\n    setVerificationFilter(\"all\");\n    setCurrentPage(1);\n    setSortField(\"created_at\");\n    setSortOrder(\"desc\");\n  }, []);\n  \n  // Effect untuk memberikan kejelasan UI dengan log\n  useEffect(() => {\n    console.log(\"Current filter state:\", {\n      searchTerm: debouncedSearchTerm,\n      roleFilter,\n      verificationFilter,\n      currentPage,\n      sortField,\n      sortOrder\n    });\n  }, [debouncedSearchTerm, roleFilter, verificationFilter, currentPage, sortField, sortOrder]);\n\n  const handleSort = useCallback((field: SortField) => {\n    if (sortField === field) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortOrder(\"asc\");\n    }\n  }, [sortField, sortOrder]);\n\n  // Reset ke halaman 1 saat search term berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, roleFilter, sortField, sortOrder]);\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const paginationInfo = useMemo(() => ({\n    currentPage,\n    totalPages,\n    totalUsers,\n    limit,\n    startItem: ((currentPage - 1) * limit) + 1,\n    endItem: Math.min(currentPage * limit, totalUsers)\n  }), [currentPage, totalPages, totalUsers, limit]);\n\n  const getSortIcon = useCallback((field: SortField) => {\n    if (sortField !== field) {\n      return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n    }\n    return sortOrder === \"asc\" \n      ? <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      : <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />;\n  }, [sortField, sortOrder]);\n\n  const formatDate = useCallback((dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString(\"id-ID\", {\n      year: \"numeric\",\n      month: \"short\", \n      day: \"numeric\"\n    });\n  }, []);\n\n  const getRoleBadge = useCallback((role: Role) => {\n    const colors: Record<Role, string> = {\n      [Role.VENDOR]: \"bg-green-100 text-green-800\",\n      [Role.VERIFIER]: \"bg-blue-100 text-blue-800\",\n      [Role.REVIEWER]: \"bg-yellow-100 text-yellow-800\",\n      [Role.APPROVER]: \"bg-orange-100 text-orange-800\",\n      [Role.ADMIN]: \"bg-purple-100 text-purple-800\",\n      [Role.SUPER_ADMIN]: \"bg-red-100 text-red-800\"\n    };\n    \n    return (\n      <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[role]}`}>\n        {role}\n      </span>\n    );\n  }, []);\n\n  const getVerificationStatus = useCallback((verified_at?: string | Date | null) => {\n    if (verified_at) {\n      return (\n        <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">\n          Terverifikasi\n        </span>\n      );\n    }\n    return (\n      <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-warning-100 text-warning-800\">\n        Menunggu Verifikasi\n      </span>\n    );\n  }, []);\n\n  // Memoize tabel content untuk hanya reload bagian ini\n  const tableContent = useMemo(() => {\n    if (error) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n            <div className=\"text-red-800\">{error}</div>\n            <Button \n              onClick={fetchUsers}\n              variant=\"destructive\"\n              size=\"sm\"\n              className=\"mt-2\"\n            >\n              Coba Lagi\n            </Button>\n          </div>\n        </div>\n      );\n    }\n\n    if (users.length === 0 && !loading) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-500\">Tidak ada user yang ditemukan</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th \n                  onClick={() => handleSort(\"officer_name\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Nama Petugas</span>\n                    {getSortIcon(\"officer_name\")}\n                  </div>\n                </th>\n                <th \n                  onClick={() => handleSort(\"email\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Email</span>\n                    {getSortIcon(\"email\")}\n                  </div>\n                </th>\n                <th \n                  onClick={() => handleSort(\"role\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Role</span>\n                    {getSortIcon(\"role\")}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Vendor/Kontak\n                </th>\n                <th \n                  onClick={() => handleSort(\"created_at\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tgl Dibuat</span>\n                    {getSortIcon(\"created_at\")}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {users.map((user) => (\n                <tr key={user.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                    {user.address && (\n                      <div className=\"text-sm text-gray-500 truncate max-w-xs\">{user.address}</div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.email}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    {getRoleBadge(user.role)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">\n                      {user.vendor_name || \"-\"}\n                    </div>\n                    {user.phone_number && (\n                      <div className=\"text-sm text-gray-500\">{user.phone_number}</div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{formatDate(user.created_at)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    {getVerificationStatus(user.verified_at)}\n                    {user.verified_by && (\n                      <div className=\"text-xs text-gray-500 mt-1\">\n                        oleh: {user.verified_by}\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <div className=\"flex items-center justify-end space-x-2\">\n                      <Button\n                        onClick={() => onView(user)}\n                        variant=\"info\"\n                        size=\"sm\"\n                        className=\"px-3 py-1.5\"\n                      >\n                        Lihat\n                      </Button>\n                      <Button\n                        onClick={() => onEdit(user)}\n                        variant=\"warning\"\n                        size=\"sm\"\n                        className=\"px-3 py-1.5\"\n                      >\n                        Ubah\n                      </Button>\n                      <Button\n                        onClick={() => onDelete(user)}\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"px-3 py-1.5\"\n                      >\n                        Hapus\n                      </Button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n        \n        {loading && (\n          <div className=\"flex justify-center items-center h-32\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n          </div>\n        )}\n      </div>\n    );\n  }, [users, loading, error, handleSort, getSortIcon, formatDate, getRoleBadge, getVerificationStatus, onEdit, onDelete, onView, fetchUsers]);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header dengan Search dan Filter */}\n      \n\n      {/* Search dan Filter */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari nama, email, vendor, atau nomor telepon...\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n        \n        <select\n          value={roleFilter}\n          onChange={(e) => {\n            console.log(\"Role dropdown changed to:\", e.target.value);\n            const newValue = e.target.value as Role | \"\";\n            setRoleFilter(newValue);\n            // Reset ke halaman 1 saat filter berubah\n            setCurrentPage(1);\n          }}\n          className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n        >\n          <option value=\"\">Semua Role</option>\n          <option value={Role.VENDOR}>Vendor</option>\n          <option value={Role.VERIFIER}>Verifier</option>\n          <option value={Role.ADMIN}>Admin</option>\n          <option value={Role.SUPER_ADMIN}>Super Admin</option>\n        </select>\n\n        <select\n          value={verificationFilter}\n          onChange={(e) => {\n            console.log(\"Verification dropdown changed to:\", e.target.value);\n            const newValue = e.target.value as \"all\" | \"pending\" | \"verified\";\n            setVerificationFilter(newValue);\n            // Reset ke halaman 1 saat filter berubah\n            setCurrentPage(1);\n          }}\n          className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n        >\n          <option value=\"all\">Semua Status</option>\n          <option value=\"pending\">Belum Verifikasi</option>\n          <option value=\"verified\">Sudah Verifikasi</option>\n        </select>\n        \n        <Button\n          onClick={resetFilters}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"px-3 py-2\"\n        >\n          Reset Filter\n        </Button>\n      </div>\n\n      {/* Tabel dengan loading overlay */}\n      <div className=\"relative\">\n        {tableContent}\n      </div>\n\n      {/* Pagination */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-gray-700\">\n            Menampilkan {paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.totalUsers} user\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n              disabled={currentPage === 1}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Sebelumnya\n            </button>\n            \n            <div className=\"flex items-center space-x-1\">\n              {[...Array(totalPages)].map((_, index) => {\n                const page = index + 1;\n                if (\n                  page === 1 ||\n                  page === totalPages ||\n                  (page >= currentPage - 1 && page <= currentPage + 1)\n                ) {\n                  return (\n                    <button\n                      key={page}\n                      onClick={() => setCurrentPage(page)}\n                      className={`px-3 py-2 border text-sm font-medium rounded-md ${\n                        currentPage === page\n                          ? \"bg-blue-500 border-blue-500 text-white\"\n                          : \"border-gray-300 text-gray-700 bg-white hover:bg-gray-50\"\n                      }`}\n                    >\n                      {page}\n                    </button>\n                  );\n                } else if (\n                  page === currentPage - 2 ||\n                  page === currentPage + 2\n                ) {\n                  return <span key={page} className=\"text-gray-500\">...</span>;\n                }\n                return null;\n              })}\n            </div>\n            \n            <button\n              onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Selanjutnya\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/approver/ApproverDashboard.tsx",
      "lang": "tsx",
      "size": 14540,
      "lines": 390,
      "hash": "b99f56df9804e58ecbb29e7539abf1d03c07514290698023b369bc800d1f425f",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  EyeIcon,\n  ClipboardDocumentListIcon,\n  CheckCircleIcon,\n  ChartBarIcon,\n  ClockIcon\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';\nimport Link from 'next/link';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  updated_at?: string;\n  reviewed_at?: string | null;\n  approved_at?: string | null;\n  reviewed_by?: string | null;\n  approved_by?: string | null;\n  workers: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface DashboardStats {\n  total: number;\n  pending_approval_meets: number;\n  pending_approval_not_meets: number;\n  approved: number;\n  rejected: number;\n}\n\nexport default function ApproverDashboard() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [stats, setStats] = useState<DashboardStats>({\n    total: 0,\n    pending_approval_meets: 0,\n    pending_approval_not_meets: 0,\n    approved: 0,\n    rejected: 0,\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const fetchDashboardData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      // Fetch stats dan 10 submission terakhir untuk dashboard\n      const response = await fetch('/api/approver/simloks?page=1&limit=10&sortBy=reviewed_at&sortOrder=desc');\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data dashboard');\n      }\n      \n      const data = await response.json();\n      setSubmissions(data.submissions);\n      setStats(data.statistics);\n      setError(null);\n    } catch (err) {\n      console.error('Error fetching dashboard data:', err);\n      setError('Gagal memuat data dashboard');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, [fetchDashboardData]);\n\n  // Socket untuk real-time updates\n  const socket = useSocket();\n  \n  useEffect(() => {\n    if (!socket) return;\n\n    // Join approver room\n    socket.emit('join', { role: 'APPROVER' });\n\n    const handleNotificationNew = (notification: any) => {\n      console.log('New notification received for approver:', notification);\n      if (notification.type === 'reviewed_submission_approval') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleStatsUpdate = (statsUpdate: any) => {\n      console.log('Stats update received for approver:', statsUpdate);\n      if (statsUpdate.scope === 'approver') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleSubmissionReviewed = () => {\n      console.log('Submission reviewed - updating approver dashboard');\n      fetchDashboardData();\n    };\n\n    // Listen for new notifications (including reviewed submissions)\n    socket.on('notification:new', handleNotificationNew);\n    // Listen for stats updates\n    socket.on('stats:update', handleStatsUpdate);\n    // Listen for specific submission review events\n    socket.on('submission:reviewed', handleSubmissionReviewed);\n\n    return () => {\n      socket.off('notification:new', handleNotificationNew);\n      socket.off('stats:update', handleStatsUpdate);\n      socket.off('submission:reviewed', handleSubmissionReviewed);\n    };\n  }, [socket, fetchDashboardData]);\n\n  const handleViewDetail = (submissionId: string) => {\n    setSelectedSubmission(submissionId);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleApprovalSubmitted = () => {\n    fetchDashboardData();\n    handleCloseModal();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;\n        case 'MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <span className={`${baseClasses} bg-amber-100 text-amber-800`}>Menunggu Persetujuan</span>;\n        case 'APPROVED':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;\n        case 'REJECTED':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        {/* Loading Statistics Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <div key={i} className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-gray-200 rounded w-24 mb-3\"></div>\n              <div className=\"h-8 bg-gray-200 rounded w-16\"></div>\n            </div>\n          ))}\n        </div>\n        \n        {/* Loading Table */}\n        <div className=\"bg-white shadow rounded-lg overflow-hidden animate-pulse\">\n          <div className=\"p-6\">\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-32\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-48\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} className=\"mb-6\" />\n      )}\n\n      {/* Statistics Cards - Dashboard Design */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total Pengajuan</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.total}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <ClipboardDocumentListIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Persetujuan</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">\n                {stats.pending_approval_meets + stats.pending_approval_not_meets}\n              </p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.approved}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n              <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats.rejected}</p>\n            </div>\n            <div className=\"p-3 bg-red-100 rounded-full\">\n              <ChartBarIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Submissions */}\n      <div className=\"bg-white rounded-xl border shadow-sm\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between\">\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Pengajuan Terbaru</h2>\n              <p className=\"text-sm text-gray-500 mt-1\">10 pengajuan terakhir untuk persetujuan</p>\n            </div>\n            <Link \n              href=\"/approver/submissions\"\n              className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors\"\n            >\n              Lihat Semua Pengajuan\n            </Link>\n          </div>\n        </div>\n        \n        {submissions.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <ClipboardDocumentListIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Tidak ada pengajuan</h3>\n            <p className=\"mt-1 text-sm text-gray-500\">Belum ada pengajuan yang perlu disetujui</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Vendor\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Deskripsi Pekerjaan\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status Review\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status Persetujuan\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Tanggal\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Aksi\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {submissions.map((submission) => (\n                  <tr key={submission.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {submission.vendor_name}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {submission.officer_name}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"text-sm text-gray-900 max-w-xs truncate\">\n                        {submission.job_description}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {submission.work_location}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      {getStatusBadge(submission.review_status, 'review')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      {getStatusBadge(submission.final_status, 'final')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {new Date(submission.created_at).toLocaleDateString('id-ID')}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                      <Button\n                        onClick={() => handleViewDetail(submission.id)}\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"text-blue-600 hover:text-blue-700\"\n                      >\n                        <EyeIcon className=\"h-4 w-4 mr-1\" />\n                        Detail\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n\n      {/* Modal */}\n      {selectedSubmission && (\n        <ApproverSubmissionDetailModal\n          submissionId={selectedSubmission}\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n          onApprovalSubmitted={handleApprovalSubmitted}\n        />\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/approver/ApproverScanHistoryContent.tsx",
      "lang": "tsx",
      "size": 21534,
      "lines": 525,
      "hash": "27edb5eca374c0999638a181deaddbdb9ae239dfdc26cf6e0ef7611fcd203512",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  FunnelIcon,\n  QrCodeIcon,\n  UserIcon,\n  DocumentTextIcon,\n  ClockIcon,\n  EyeIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport { formatDistanceToNow, format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    job_description: string;\n    review_status: string;\n    final_status: string;\n  };\n  user: {\n    id: string;\n    full_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface FilterState {\n  dateFrom: string;\n  dateTo: string;\n  verifier: string;\n  submissionId: string;\n}\n\nexport default function ApproverScanHistoryContent() {\n  const [scans, setScans] = useState<QrScan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n  const [filters, setFilters] = useState<FilterState>({\n    dateFrom: '',\n    dateTo: '',\n    verifier: '',\n    submissionId: ''\n  });\n  const [showFilters, setShowFilters] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const pageSize = 15;\n\n  const fetchScanHistory = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: pageSize.toString(),\n        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),\n        ...(filters.dateTo && { dateTo: filters.dateTo }),\n        ...(filters.verifier && { verifier: filters.verifier }),\n        ...(filters.submissionId && { submissionId: filters.submissionId }),\n        ...(searchTerm && { search: searchTerm })\n      });\n\n      const response = await fetch(`/api/scan-history?${params}`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data = await response.json();\n      setScans(data.scans || []);\n      setTotalPages(Math.ceil((data.total || 0) / pageSize));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchScanHistory();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [currentPage, searchTerm]);\n\n  const handleFilterSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const resetFilters = () => {\n    setFilters({\n      dateFrom: '',\n      dateTo: '',\n      verifier: '',\n      submissionId: ''\n    });\n    setSearchTerm('');\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <Badge variant=\"warning\">Menunggu Review</Badge>;\n        case 'MEETS_REQUIREMENTS':\n          return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n        default:\n          return null;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n        case 'APPROVED':\n          return <Badge variant=\"success\">Disetujui</Badge>;\n        case 'REJECTED':\n          return <Badge variant=\"destructive\">Ditolak</Badge>;\n        default:\n          return null;\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Search and Filters */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"p-2 bg-green-100 rounded-lg\">\n              <QrCodeIcon className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">Manajemen Riwayat Scan</h2>\n              <p className=\"text-sm text-gray-500\">Pantau aktivitas scan QR code oleh verifikator</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-3\">\n            <Button\n              onClick={() => setShowFilters(!showFilters)}\n              variant={showFilters ? 'secondary' : 'primary'}\n              className=\"flex items-center space-x-2\"\n            >\n              <FunnelIcon className=\"h-4 w-4\" />\n              <span>Filter</span>\n            </Button>\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"relative mb-4\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            placeholder=\"Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator...\"\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n          />\n        </div>\n\n        {/* Advanced Filters */}\n        {showFilters && (\n          <div className=\"border-t border-gray-200 pt-4\">\n            <form onSubmit={handleFilterSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Dari\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateFrom}\n                    onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Sampai\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateTo}\n                    onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Verifikator\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.verifier}\n                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nama verifikator...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nomor Simlok\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.submissionId}\n                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nomor simlok...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3\">\n                <Button type=\"submit\" className=\"flex items-center space-x-2\">\n                  <MagnifyingGlassIcon className=\"h-4 w-4\" />\n                  <span>Terapkan Filter</span>\n                </Button>\n                \n                <Button \n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={resetFilters}\n                >\n                  Reset\n                </Button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Scan History Table */}\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8\">\n            <div className=\"animate-pulse space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-gray-200 rounded-lg\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                  </div>\n                  <div className=\"w-20 h-8 bg-gray-200 rounded\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ) : scans.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <QrCodeIcon className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No scan history found</h3>\n            <p className=\"text-gray-500\">No QR code scans match your current filters.</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pengajuan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Verifikator\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Waktu Scan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {scans.map((scan) => (\n                    <tr key={scan.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-2 bg-green-100 rounded-lg mr-3\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-green-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.submission.simlok_number}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {scan.submission.vendor_name}\n                            </div>\n                            <div className=\"text-xs text-gray-400 truncate max-w-xs\">\n                              {scan.submission.job_description}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-1.5 bg-blue-100 rounded-full mr-3\">\n                            <UserIcon className=\"h-4 w-4 text-blue-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.user.full_name}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {scan.user.email}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center text-sm text-gray-900\">\n                          <ClockIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <div>\n                            <div className=\"font-medium\">\n                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"space-y-1\">\n                          {getStatusBadge(scan.submission.review_status, 'review')}\n                          {getStatusBadge(scan.submission.final_status, 'final')}\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          className=\"flex items-center space-x-1\"\n                        >\n                          <EyeIcon className=\"h-4 w-4\" />\n                          <span>Detail</span>\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"bg-white px-4 py-3 border-t border-gray-200 sm:px-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <p className=\"text-sm text-gray-700\">\n                      Menampilkan halaman <span className=\"font-medium\">{currentPage}</span> dari{' '}\n                      <span className=\"font-medium\">{totalPages}</span>\n                    </p>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <ChevronLeftIcon className=\"h-4 w-4\" />\n                      <span>Sebelumnya</span>\n                    </Button>\n                    \n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}\n                      disabled={currentPage === totalPages}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <span>Selanjutnya</span>\n                      <ChevronRightIcon className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Informasi Detail Scan</h3>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <span className=\"sr-only\">Close</span>\n                  ✕\n                </button>\n              </div>\n            </div>\n            \n            <div className=\"p-6 space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Pengajuan</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nomor Simlok:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.simlok_number}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Perusahaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.vendor_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Deskripsi Pekerjaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.job_description}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Verifikator</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nama:</span>\n                      <span className=\"font-medium\">{selectedScan.user.full_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Email:</span>\n                      <span className=\"font-medium\">{selectedScan.user.email}</span>\n                    </div>\n                    \n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Detail Scan</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-500\">Waktu Scan:</span>\n                    <span className=\"font-medium\">\n                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}\n                    </span>\n                  </div>\n                  {selectedScan.scanner_name && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Scanner Name:</span>\n                      <span className=\"font-medium\">{selectedScan.scanner_name}</span>\n                    </div>\n                  )}\n                  {selectedScan.notes && (\n                    <div className=\"col-span-2\">\n                      <span className=\"text-gray-500\">Notes:</span>\n                      <p className=\"mt-1 font-medium\">{selectedScan.notes}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Current Status</h4>\n                <div className=\"flex flex-wrap gap-3\">\n                  {getStatusBadge(selectedScan.submission.review_status, 'review')}\n                  {getStatusBadge(selectedScan.submission.final_status, 'final')}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/approver/ApproverSubmissionDetailModal.tsx",
      "lang": "tsx",
      "size": 54363,
      "lines": 1120,
      "hash": "62da2acf6b4b044189a3b7532e10efd7f4061d4eb39537dae5684c021d85d096",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  XMarkIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  DocumentTextIcon,\n  UserGroupIcon,\n  ClipboardDocumentCheckIcon,\n  QrCodeIcon,\n  ClockIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { useToast } from '@/hooks/useToast';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\n\ninterface SubmissionDetail {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  officer_email?: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  worker_count: number | null;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  implementation_start_date?: string | null;\n  implementation_end_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  reviewed_by_name?: string;\n  reviewed_by_email?: string;\n  final_note?: string;\n  approved_by_name?: string;\n  approved_by_email?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n    created_at: string;\n  }>;\n}\n\ninterface QrScan {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  notes?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface ScanHistory {\n  scans: QrScan[];\n  totalScans: number;\n  lastScan?: QrScan;\n  hasBeenScanned: boolean;\n}\n\ninterface ApproverSubmissionDetailModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  onApprovalSubmitted: () => void;\n}\n\nconst ApproverSubmissionDetailModal: React.FC<ApproverSubmissionDetailModalProps> = ({\n  isOpen,\n  onClose,\n  submissionId,\n  onApprovalSubmitted\n}) => {\n  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'approval'>('details');\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n  const [scanHistory, setScanHistory] = useState<ScanHistory | null>(null);\n  const [loadingScanHistory, setLoadingScanHistory] = useState(false);\n  const { showSuccess, showError } = useToast();\n\n  // Function to generate auto SIMLOK number - mengikuti sistem admin yang sudah ada\n  const generateSimlokNumber = async () => {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0'); // MM format\n\n    try {\n      // Call API untuk mendapatkan nomor terakhir (untuk demo, kita gunakan format sederhana)\n      // Server akan handle logic yang sebenarnya saat approve\n      \n      // Fallback format client-side: auto-increment berdasarkan bulan/tahun saat ini\n      // Format: sequential_number/MM/YYYY (contoh: 1/09/2025, 2/09/2025)\n      const timestamp = Date.now();\n      const fallbackNumber = timestamp % 1000; // Simple fallback\n      return `${fallbackNumber}/${month}/${year}`;\n    } catch (error) {\n      // Fallback jika error\n      const fallbackNumber = Math.floor(Math.random() * 1000) + 1;\n      return `${fallbackNumber}/${month}/${year}`;\n    }\n  };\n\n  // Function to get current date in YYYY-MM-DD format\n  const getCurrentDate = () => {\n    const now = new Date();\n    return now.toISOString().split('T')[0];\n  };\n\n  // Approval form state\n  const [approvalData, setApprovalData] = useState({\n    final_status: '' as 'APPROVED' | 'REJECTED' | '',\n    simlok_number: '',\n    simlok_date: ''\n  });\n\n  const fetchSubmissionDetail = async () => {\n    if (!submissionId) return;\n    \n    try {\n      setLoading(true);\n      \n      const response = await fetch(`/api/approver/simloks/${submissionId}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil detail pengajuan');\n      }\n      \n      const data = await response.json();\n      setSubmission(data.submission);\n      \n      // Initialize approval data\n      setApprovalData({\n        final_status: data.submission.final_status === 'PENDING_APPROVAL' ? '' : data.submission.final_status,\n        simlok_number: data.submission.simlok_number || '',\n        simlok_date: (data.submission.simlok_date \n          ? new Date(data.submission.simlok_date).toISOString().split('T')[0] \n          : '') as string\n      });\n      \n      // Auto-fill SIMLOK data jika status APPROVED dan belum ada nomor SIMLOK\n      if (data.submission.final_status === 'APPROVED' && !data.submission.simlok_number) {\n        const simlokNumber = await generateSimlokNumber();\n        setApprovalData(prev => ({\n          ...prev,\n          simlok_number: simlokNumber,\n          simlok_date: getCurrentDate() as string\n        }));\n      }\n      \n    } catch (err) {\n      console.error('Error fetching submission:', err);\n      showError('Error', 'Gagal memuat detail pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchScanHistory = async () => {\n    if (!submissionId) return;\n    \n    try {\n      setLoadingScanHistory(true);\n      const response = await fetch(`/api/submissions/${submissionId}/scans`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data: ScanHistory = await response.json();\n      setScanHistory(data);\n    } catch (err) {\n      console.error('Error fetching scan history:', err);\n      // Don't show error for scan history as it's not critical\n    } finally {\n      setLoadingScanHistory(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen && submissionId) {\n      fetchSubmissionDetail();\n      fetchScanHistory();\n    }\n  }, [isOpen, submissionId]);\n\n  const handleViewPdf = () => {\n    setIsPdfModalOpen(true);\n  };\n\n  const handleSubmitApproval = async () => {\n    if (!approvalData.final_status) {\n      showError('Error', 'Pilih status persetujuan terlebih dahulu');\n      return;\n    }\n\n    if (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) {\n      showError('Error', 'Nomor SIMLOK wajib diisi untuk approval');\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      const response = await fetch(`/api/approver/simloks/${submissionId}/final`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          final_status: approvalData.final_status,\n          simlok_number: approvalData.final_status === 'APPROVED' ? approvalData.simlok_number.trim() : undefined,\n          simlok_date: approvalData.final_status === 'APPROVED' && approvalData.simlok_date ? approvalData.simlok_date : undefined,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal mengirim persetujuan');\n      }\n\n      const data = await response.json();\n      setSubmission(data.submission);\n      showSuccess('Berhasil', `Pengajuan berhasil ${approvalData.final_status === 'APPROVED' ? 'disetujui' : 'ditolak'}`);\n      onApprovalSubmitted();\n      \n    } catch (err: any) {\n      console.error('Error submitting approval:', err);\n      showError('Error', err.message || 'Gagal menyimpan persetujuan');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const canApprove = submission && submission.final_status === 'PENDING_APPROVAL';\n\n  // Handle status change with auto-fill\n  const handleStatusChange = async (status: 'APPROVED' | 'REJECTED') => {\n    if (status === 'APPROVED') {\n      // Auto-fill nomor SIMLOK dan tanggal jika belum ada\n      const simlokNumber = await generateSimlokNumber();\n      setApprovalData(prev => ({\n        ...prev,\n        final_status: status,\n        simlok_number: prev.simlok_number || simlokNumber,\n        simlok_date: prev.simlok_date || getCurrentDate() as string\n      }));\n    } else {\n      // Reset SIMLOK fields jika status REJECTED\n      setApprovalData(prev => ({\n        ...prev,\n        final_status: status,\n        simlok_number: '',\n        simlok_date: ''\n      }));\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_REVIEW':\n        return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">Detail & Approval Pengajuan</h2>\n            {submission && (\n              <div className=\"text-sm text-gray-500 mt-1 space-y-1\">\n                <p>\n                  <span className=\"font-medium\">{submission.vendor_name}</span> - {submission.officer_name}\n                </p>\n                {submission.simlok_number && (\n                  <p className=\"text-xs\">\n                    <span className=\"font-medium\">No. SIMLOK:</span> {submission.simlok_number}\n                    {submission.simlok_date && (\n                      <span className=\"ml-2\">• <span className=\"font-medium\">Tanggal:</span> {new Date(submission.simlok_date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</span>\n                    )}\n                  </p>\n                )}\n                <p className=\"text-xs\">\n                  <span className=\"font-medium\">ID Pengajuan:</span> {submission.id}\n                </p>\n                \n                {/* Scan Status */}\n                <div className=\"mt-2 pt-2 border-t border-gray-100\">\n                  {loadingScanHistory ? (\n                    <div className=\"flex items-center text-xs text-gray-500\">\n                      <ClockIcon className=\"h-3 w-3 mr-1 animate-spin\" />\n                      Memuat status scan...\n                    </div>\n                  ) : scanHistory ? (\n                    <div className=\"space-y-1\">\n                      {scanHistory.hasBeenScanned ? (\n                        <div className=\"flex items-center text-xs text-green-600\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span className=\"font-medium\">SIMLOK telah discan</span>\n                          <span className=\"ml-2\">({scanHistory.totalScans}x)</span>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span>SIMLOK belum discan</span>\n                        </div>\n                      )}\n                      \n                      {scanHistory.lastScan && (\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <ClockIcon className=\"h-3 w-3 mr-1\" />\n                          <span>Terakhir discan: {new Date(scanHistory.lastScan.scanned_at).toLocaleDateString('id-ID', {\n                            day: 'numeric',\n                            month: 'short',\n                            year: 'numeric',\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}</span>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center text-xs text-gray-400\">\n                      <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                      <span>Status scan tidak tersedia</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n          <Button\n            onClick={onClose}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-gray-400 hover:text-gray-600\"\n          >\n            <XMarkIcon className=\"h-6 w-6\" />\n          </Button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200 flex-shrink-0\">\n          <nav className=\"flex space-x-8 px-6\">\n            <button\n              onClick={() => setActiveTab('details')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'details'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <DocumentTextIcon className=\"h-5 w-5 inline mr-2\" />\n              Detail SIMLOK\n            </button>\n            <button\n              onClick={() => setActiveTab('workers')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'workers'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <UserGroupIcon className=\"h-5 w-5 inline mr-2\" />\n              Data Pekerja\n            </button>\n            <button\n              onClick={() => setActiveTab('approval')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'approval'\n                  ? 'border-blue-500 text-blue-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <ClipboardDocumentCheckIcon className=\"h-5 w-5 inline mr-2\" />\n              Proses Approval\n            </button>\n          </nav>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n            </div>\n          )}\n\n          {submission && (\n            <>\n              {/* Details Tab */}\n              {activeTab === 'details' && (\n                <div className=\"space-y-8\">\n                  {/* Header with Status */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Informasi SIMLOK</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"text-sm text-gray-500\">Review:</span>\n                      {getStatusBadge(submission.review_status)}\n                      <span className=\"text-sm text-gray-500\">Status:</span>\n                      {getStatusBadge(submission.final_status)}\n                    </div>\n                  </div>\n\n                  {/* Data Vendor */}\n                  <div className=\"bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-6\">Data Vendor & Penanggung Jawab</h4>\n                    \n                    <div className=\"space-y-6\">\n                      {/* Informasi Vendor */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-6\">Informasi Vendor</h5>\n                        \n                        {/* Informasi Perusahaan */}\n                        <div className=\"mb-6\">\n                          <h6 className=\"text-sm font-medium text-gray-800 mb-4 pb-2 border-b border-gray-200\">Informasi Perusahaan</h6>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nama Perusahaan Vendor\n                              </label>\n                              <p className=\"text-gray-900 py-2 font-medium\">{submission.vendor_name}</p>\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nomor Telepon Vendor\n                              </label>\n                              <p className=\"text-gray-900 py-2\">\n                                {submission.vendor_phone || (\n                                  <span className=\"text-gray-400 italic\">Belum diisi</span>\n                                )}\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Informasi Penanggung Jawab */}\n                        <div>\n                          <h6 className=\"text-sm font-medium text-gray-800 mb-4 pb-2 border-b border-gray-200\">Informasi Penanggung Jawab</h6>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nama Penanggung Jawab\n                              </label>\n                              <p className=\"text-gray-900 py-2 font-medium\">{submission.officer_name}</p>\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Email Penanggung Jawab\n                              </label>\n                              <p className=\"text-gray-900 py-2\">{submission.officer_email || '-'}</p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Dokumen Dasar */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-4\">Berdasarkan</h5>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                            Dokumen Dasar / Referensi\n                          </label>\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <p className=\"text-gray-900 whitespace-pre-line leading-relaxed\">{submission.based_on}</p>\n                          </div>\n                          <p className=\"text-xs text-gray-500 mt-3\">\n                            Dokumen kontrak, SPK, Work Order, atau referensi lain yang menjadi dasar pengajuan SIMLOK\n                          </p>\n                        </div>\n                      </div>\n\n                      {/* Status Pengajuan */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-4\">Status Pengajuan</h5>\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Tanggal Pengajuan</div>\n                            <div className=\"text-base font-semibold text-gray-900\">\n                              {new Date(submission.created_at).toLocaleDateString('id-ID')}\n                            </div>\n                          </div>\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Status Review</div>\n                            <div>{getStatusBadge(submission.review_status)}</div>\n                          </div>\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Status Persetujuan</div>\n                            <div>{getStatusBadge(submission.final_status)}</div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Informasi Pekerjaan */}\n                  <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Informasi Pekerjaan</h4>\n                    <div className=\"space-y-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Deskripsi Pekerjaan\n                        </label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900 whitespace-pre-line\">{submission.job_description}</p>\n                        </div>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Lokasi Kerja\n                          </label>\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">{submission.work_location}</p>\n                          </div>\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Jam Kerja\n                          </label>\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">{submission.working_hours || 'Tidak ditentukan'}</p>\n                          </div>\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Jumlah Pekerja\n                          </label>\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-bold text-lg\">{submission.worker_count || 0} <span className=\"text-sm font-normal\">orang</span></p>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Informasi Tambahan */}\n                      {(submission.work_facilities || submission.implementation || submission.other_notes) && (\n                        <div className=\"border-t border-gray-200 pt-4 space-y-4\">\n                          {submission.work_facilities && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Fasilitas Kerja\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm\">{submission.work_facilities}</p>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {submission.implementation && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Keterangan Pelaksanaan\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm whitespace-pre-line\">{submission.implementation}</p>\n                              </div>\n                            </div>\n                          )}\n\n                          {submission.other_notes && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Catatan Lainnya\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm whitespace-pre-line\">{submission.other_notes}</p>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Dokumen Pendukung */}\n                  <div className=\"bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Dokumen Pendukung</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nomor SIMJA</label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">{submission.simja_number || '-'}</p>\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal SIMJA</label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">\n                            {submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '-'}\n                          </p>\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nomor SIKA</label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">{submission.sika_number || '-'}</p>\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal SIKA</label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">\n                            {submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '-'}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Jadwal Pelaksanaan */}\n                  <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Jadwal Pelaksanaan</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal Mulai Pelaksanaan\n                        </label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">\n                            {submission.implementation_start_date ? new Date(submission.implementation_start_date).toLocaleDateString('id-ID') : '-'}\n                          </p>\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal Selesai Pelaksanaan\n                        </label>\n                        <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                          <p className=\"text-gray-900\">\n                            {submission.implementation_end_date ? new Date(submission.implementation_end_date).toLocaleDateString('id-ID') : '-'}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Final Status Information */}\n                  {submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className=\"bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                      <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Status</h4>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center\">\n                          <span className=\"text-sm text-gray-600 mr-2\">Status:</span>\n                          {getStatusBadge(submission.final_status)}\n                        </div>\n                        {submission.simlok_number && (\n                          <p className=\"text-sm text-gray-700\">\n                            <strong>Nomor SIMLOK:</strong> {submission.simlok_number}\n                          </p>\n                        )}\n                        {submission.simlok_date && (\n                          <p className=\"text-sm text-gray-700\">\n                            <strong>Tanggal SIMLOK:</strong> {new Date(submission.simlok_date).toLocaleDateString('id-ID')}\n                          </p>\n                        )}\n                        {submission.final_note && (\n                          <p className=\"text-sm text-gray-700\">\n                            <strong>Catatan:</strong> {submission.final_note}\n                          </p>\n                        )}\n                        {submission.approved_by_name && (\n                          <p className=\"text-xs text-gray-500\">\n                            Diproses oleh: {submission.approved_by_name}\n                            {submission.approved_at && (\n                              <span> pada {new Date(submission.approved_at).toLocaleDateString('id-ID')}</span>\n                            )}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Workers Tab */}\n              {activeTab === 'workers' && (\n                <div className=\"space-y-6\">\n                  {/* Header dengan jumlah pekerja */}\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-lg font-medium text-gray-900\">Data Pekerja</h3>\n                    <div className=\"flex items-center space-x-3\">\n                      <span className=\"bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full\">\n                        Total: {submission.worker_count || \n                          (submission.worker_names ? submission.worker_names.split('\\n').filter(name => name.trim()).length : submission.worker_list.length)\n                        } pekerja\n                      </span>\n                      {/* <span className=\"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full\">\n                        Foto: {submission.worker_list.length}\n                      </span> */}\n                    </div>\n                  </div>\n\n                  {submission.worker_list.length === 0 ? (\n                    <div className=\"text-center py-16\">\n                      <UserGroupIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada foto pekerja</h3>\n                      <p className=\"text-gray-500 max-w-md mx-auto\">\n                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                      {submission.worker_list.map((worker) => (\n                        <div\n                          key={worker.id}\n                          className=\"bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group\"\n                        >\n                          {/* Photo Section */}\n                          <div className=\"relative p-4 pb-2\">\n                            <div className=\"relative\">\n                              {worker.worker_photo ? (\n                                <img\n                                  src={worker.worker_photo ? fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`) : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo='}\n                                  alt={`Foto ${worker.worker_name}`}\n                                  className=\"w-full h-48 rounded-lg object-cover shadow-sm\"\n                                  onLoad={() => console.log('Approver tab - Image loaded successfully for:', worker.worker_name)}\n                                  onError={(e) => {\n                                    console.log('Approver tab - Image load error for worker:', worker.worker_name, 'URL:', worker.worker_photo);\n                                    if (worker.worker_photo) {\n                                      console.log('Approver tab - Processed URL:', fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`));\n                                    }\n                                    const target = e.target as HTMLImageElement;\n                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';\n                                  }}\n                                />\n                              ) : (\n                                <div className=\"w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm\">\n                                  <div className=\"text-center text-gray-500\">\n                                    <svg className=\"w-12 h-12 mx-auto mb-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                      <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\n                                    </svg>\n                                    <p className=\"text-sm\">Tidak ada foto</p>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Info Section */}\n                          <div className=\"px-4 pb-4\">\n                            <h4 className=\"font-semibold text-gray-900 text-sm mb-1 truncate\">\n                              {worker.worker_name}\n                            </h4>\n                            \n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Approval Tab */}\n              {activeTab === 'approval' && (\n                <div className=\"space-y-6\">\n                  <h3 className=\"text-lg font-medium text-gray-900\">Proses Approval Final</h3>\n                  {/* Review Information */}\n                  {submission.review_note && (\n                    <div className=\"bg-blue-50 rounded-lg p-6\">\n                      <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Catatan Review</h4>\n                      <p className=\"text-gray-700 whitespace-pre-line\">{submission.review_note}</p>\n                      {submission.reviewed_by_name && (\n                        <p className=\"text-sm text-gray-500 mt-2\">\n                          Direview oleh: {submission.reviewed_by_name}\n                          {submission.reviewed_at && (\n                            <span> pada {new Date(submission.reviewed_at).toLocaleDateString('id-ID')}</span>\n                          )}\n                        </p>\n                      )}\n                    </div>\n                  )}\n\n                  {submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className={`\n                      rounded-xl p-6 mb-6 border-2\n                      ${submission.final_status === 'APPROVED' \n                        ? 'bg-green-50 border-green-200' \n                        : 'bg-red-50 border-red-200'\n                      }\n                    `}>\n                      <div className=\"flex items-start space-x-4\">\n                        <div className={`\n                          flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center\n                          ${submission.final_status === 'APPROVED' \n                            ? 'bg-green-100' \n                            : 'bg-red-100'\n                          }\n                        `}>\n                          {submission.final_status === 'APPROVED' ? (\n                            <CheckCircleIcon className=\"h-6 w-6 text-green-600\" />\n                          ) : (\n                            <XCircleIcon className=\"h-6 w-6 text-red-600\" />\n                          )}\n                        </div>\n                        <div className=\"flex-1\">\n                          <h4 className={`\n                            text-lg font-semibold mb-2\n                            ${submission.final_status === 'APPROVED' \n                              ? 'text-green-900' \n                              : 'text-red-900'\n                            }\n                          `}>\n                            {submission.final_status === 'APPROVED' ? 'Pengajuan Disetujui' : 'Pengajuan Ditolak'}\n                          </h4>\n                          <div className=\"space-y-2 text-sm\">\n                            <div className=\"flex items-center space-x-2\">\n                              <span className=\"font-medium text-gray-700\">Status:</span>\n                              {getStatusBadge(submission.final_status)}\n                            </div>\n                            {submission.final_note && (\n                              <div>\n                                <span className=\"font-medium text-gray-700\">Catatan:</span>\n                                <p className=\"mt-1 text-gray-600\">{submission.final_note}</p>\n                              </div>\n                            )}\n                            {submission.approved_by_name && (\n                              <div className=\"pt-2 border-t border-gray-200\">\n                                <span className=\"font-medium text-gray-700\">Diproses oleh:</span>\n                                <p className=\"text-gray-600\">\n                                  {submission.approved_by_name} pada{' '}\n                                  {new Date(submission.approved_at!).toLocaleDateString('id-ID', {\n                                    weekday: 'long',\n                                    year: 'numeric',\n                                    month: 'long',\n                                    day: 'numeric'\n                                  })}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {canApprove && (\n                    <div className=\"space-y-8\">\n                      {/* Status Selection Card */}\n                      <div className=\"bg-gray-50 rounded-xl p-6 border border-gray-200\">\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                          <ClipboardDocumentCheckIcon className=\"h-5 w-5 text-blue-600 mr-2\" />\n                          Keputusan Persetujuan\n                        </h3>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          {/* Approve Option */}\n                          <label className={`\n                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                            ${approvalData.final_status === 'APPROVED' \n                              ? 'border-green-500 bg-green-50 shadow-md' \n                              : 'border-gray-200 bg-white hover:border-green-300 hover:bg-green-50'\n                            }\n                          `}>\n                            <input\n                              type=\"radio\"\n                              name=\"final_status\"\n                              value=\"APPROVED\"\n                              checked={approvalData.final_status === 'APPROVED'}\n                              onChange={(e) => {\n                                handleStatusChange(e.target.value as 'APPROVED');\n                              }}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                ${approvalData.final_status === 'APPROVED' \n                                  ? 'border-green-500 bg-green-500' \n                                  : 'border-gray-300'\n                                }\n                              `}>\n                                {approvalData.final_status === 'APPROVED' && (\n                                  <CheckCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Setujui Pengajuan</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan akan disetujui dan nomor SIMLOK dibuat</div>\n                              </div>\n                            </div>\n                          </label>\n\n                          {/* Reject Option */}\n                          <label className={`\n                            relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                            ${approvalData.final_status === 'REJECTED' \n                              ? 'border-red-500 bg-red-50 shadow-md' \n                              : 'border-gray-200 bg-white hover:border-red-300 hover:bg-red-50'\n                            }\n                          `}>\n                            <input\n                              type=\"radio\"\n                              name=\"final_status\"\n                              value=\"REJECTED\"\n                              checked={approvalData.final_status === 'REJECTED'}\n                              onChange={(e) => {\n                                handleStatusChange(e.target.value as 'REJECTED');\n                              }}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                ${approvalData.final_status === 'REJECTED' \n                                  ? 'border-red-500 bg-red-500' \n                                  : 'border-gray-300'\n                                }\n                              `}>\n                                {approvalData.final_status === 'REJECTED' && (\n                                  <XCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Tolak Pengajuan</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan akan ditolak dengan alasan</div>\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n                      </div>\n\n                      {approvalData.final_status === 'APPROVED' && (\n                        <div className=\"bg-white border border-gray-200 rounded-xl p-6\">\n                          <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-blue-600 mr-2\" />\n                            Informasi SIMLOK\n                          </h3>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nomor SIMLOK\n                                <span className=\"text-red-500 ml-1\">*</span>\n                              </label>\n                              <div className=\"relative\">\n                                <input\n                                  type=\"text\"\n                                  value={approvalData.simlok_number}\n                                  onChange={(e) => setApprovalData({ ...approvalData, simlok_number: e.target.value })}\n                                  className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm\"\n                                  placeholder=\"Dibuat otomatis\"\n                                  required\n                                />\n                                <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                                  <CheckCircleIcon className=\"h-5 w-5 text-blue-500\" />\n                                </div>\n                              </div>\n                              <p className=\"text-xs text-gray-600 mt-2 flex items-center\">\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></span>\n                                Nomor otomatis dibuat berdasarkan urutan bulanan\n                              </p>\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Tanggal Penerbitan Simlok\n                              </label>\n                              <input\n                                type=\"date\"\n                                value={approvalData.simlok_date}\n                                onChange={(e) => setApprovalData({ ...approvalData, simlok_date: e.target.value })}\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm\"\n                              />\n                              <p className=\"text-xs text-gray-600 mt-2 flex items-center\">\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></span>\n                                Tanggal dapat disesuaikan sesuai kebutuhan\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n\n\n\n                      {/* Submit Button */}\n                      <div className=\"flex justify-end pt-4 border-t border-gray-200\">\n                        <Button\n                          onClick={handleSubmitApproval}\n                          disabled={\n                            !approvalData.final_status || \n                            (approvalData.final_status === 'APPROVED' && !approvalData.simlok_number.trim()) ||\n                            saving\n                          }\n                          className={`\n                            px-8 py-3 rounded-lg font-medium transition-all duration-200 min-w-[160px]\n                            ${approvalData.final_status === 'APPROVED'\n                              ? 'bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl'\n                              : approvalData.final_status === 'REJECTED'\n                              ? 'bg-red-600 hover:bg-red-700 text-white shadow-lg hover:shadow-xl'\n                              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                            }\n                          `}\n                        >\n                          {saving ? (\n                            <div className=\"flex items-center\">\n                              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                              Memproses\n                            </div>\n                          ) : (\n                            <div className=\"flex items-center\">\n                              {approvalData.final_status === 'APPROVED' ? (\n                                <>\n                                  <CheckCircleIcon className=\"h-5 w-5 mr-2\" />\n                                  Setujui Pengajuan\n                                </>\n                              ) : approvalData.final_status === 'REJECTED' ? (\n                                <>\n                                  <XCircleIcon className=\"h-5 w-5 mr-2\" />\n                                  Tolak Pengajuan\n                                </>\n                              ) : (\n                                'Pilih Status'\n                              )}\n                            </div>\n                          )}\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n\n                  {!canApprove && submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-6\">\n                      <div className=\"text-center\">\n                        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4\">\n                          <ClipboardDocumentCheckIcon className=\"h-6 w-6 text-blue-600\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-blue-900 mb-2\">Pengajuan Sudah Difinalisasi</h3>\n                        <p className=\"text-sm text-blue-700\">\n                          Status persetujuan tidak dapat diubah karena pengajuan telah selesai diproses.\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200 flex-shrink-0 bg-white\">\n          <div className=\"flex items-center space-x-3\">\n            {/* Debug info untuk development */}\n            {/* {submission && (\n              <div className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">\n                Status: {submission.final_status} | SIMLOK: {submission.simlok_number || 'Belum ada'}\n              </div>\n            )} */}\n            \n            {/* Tampilkan tombol PDF - approver bisa lihat di semua status */}\n            {submission && (\n              <Button onClick={handleViewPdf} variant=\"primary\" size=\"sm\">\n                <DocumentTextIcon className=\"w-4 h-4 mr-2\" />\n                Lihat PDF\n              </Button>\n            )}\n          </div>\n          <Button onClick={onClose} variant=\"outline\">\n            Tutup\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submissionId}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n    </div>\n  );\n};\n\nexport default ApproverSubmissionDetailModal;"
    },
    {
      "path": "src/components/approver/ApproverSubmissionsManagement.tsx",
      "lang": "tsx",
      "size": 23292,
      "lines": 613,
      "hash": "e143f757042afdbfb391757222da69729ae2ffd93f2d0dca899d8b9a5c3f14ed",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  EyeIcon,\n  XMarkIcon,\n  ClipboardDocumentListIcon,\n  CheckCircleIcon,\n  UserGroupIcon,\n  DocumentCheckIcon,\n  UserIcon,\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport ApproverSubmissionDetailModal from './ApproverSubmissionDetailModal';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  approved_by_final_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface SubmissionsResponse {\n  submissions: Submission[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    pages: number;\n  };\n}\n\n// Empty State Component\nfunction EmptyState({ hasFilters, onClearFilters }: { hasFilters: boolean; onClearFilters: () => void }) {\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n      <div className=\"px-6 py-12 text-center\">\n        <div className=\"mx-auto h-24 w-24 text-gray-300 mb-6\">\n          <DocumentCheckIcon className=\"h-full w-full\" />\n        </div>\n        \n        {hasFilters ? (\n          <>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n              Tidak ada data yang sesuai dengan filter\n            </h3>\n            <p className=\"text-gray-500 mb-6 max-w-md mx-auto\">\n              Tidak ditemukan pengajuan yang sesuai dengan kriteria pencarian atau filter yang Anda terapkan.\n            </p>\n            <Button\n              onClick={onClearFilters}\n              variant=\"outline\"\n              className=\"mx-auto\"\n            >\n              <XMarkIcon className=\"h-4 w-4 mr-2\" />\n              Hapus Filter\n            </Button>\n          </>\n        ) : (\n          <>\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n              Belum ada pengajuan untuk disetujui\n            </h3>\n            <p className=\"text-gray-500 mb-6 max-w-md mx-auto\">\n              Saat ini belum ada pengajuan Simlok yang telah direview dan memerlukan persetujuan final dari Anda.\n            </p>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto\">\n              <div className=\"bg-blue-50 p-4 rounded-lg text-center\">\n                <ClipboardDocumentListIcon className=\"h-8 w-8 text-blue-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-blue-900\">Vendor Submit</p>\n                <p className=\"text-xs text-blue-600\">Pengajuan masuk</p>\n              </div>\n              <div className=\"bg-yellow-50 p-4 rounded-lg text-center\">\n                <UserGroupIcon className=\"h-8 w-8 text-yellow-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-yellow-900\">Reviewer Check</p>\n                <p className=\"text-xs text-yellow-600\">Proses review</p>\n              </div>\n              <div className=\"bg-green-50 p-4 rounded-lg text-center\">\n                <CheckCircleIcon className=\"h-8 w-8 text-green-500 mx-auto mb-2\" />\n                <p className=\"text-sm font-medium text-green-900\">Approver Final</p>\n                <p className=\"text-xs text-green-600\">Menunggu Anda</p>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Loading State Component  \nfunction LoadingState() {\n  return (\n    <div className=\"space-y-6\">\n      {/* Loading Filters */}\n      <div className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"flex-1 h-10 bg-gray-200 rounded\"></div>\n          <div className=\"sm:w-48 h-10 bg-gray-200 rounded\"></div>\n        </div>\n      </div>\n      \n      {/* Loading Table */}\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"p-6\">\n          <div className=\"space-y-4\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"flex items-center space-x-4\">\n                <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-32\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-48\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n                <div className=\"h-8 bg-gray-200 rounded w-16\"></div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function ApproverSubmissionsManagement() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  \n  // Filters and pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');\n  const [finalStatusFilter, setFinalStatusFilter] = useState<string>('');\n  const [sortBy, setSortBy] = useState('reviewed_at');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    pages: 0,\n  });\n\n  // Socket connection\n  const socket = useSocket();\n\n  const fetchSubmissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: '10',\n        sortBy,\n        sortOrder,\n      });\n\n      if (searchTerm) params.append('search', searchTerm);\n      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);\n      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);\n\n      const response = await fetch(`/api/approver/simloks?${params}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data pengajuan');\n      }\n\n      const data: SubmissionsResponse = await response.json();\n      setSubmissions(data.submissions);\n      setPagination(data.pagination);\n    } catch (err) {\n      console.error('Error fetching submissions:', err);\n      setError('Gagal memuat data pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [fetchSubmissions]);\n\n  // Socket listeners for real-time updates\n  useEffect(() => {\n    if (!socket) return;\n\n    // Join approver room\n    socket.emit('join', { role: 'APPROVER' });\n\n    const handleSubmissionUpdate = () => {\n      console.log('Submission update received, refreshing approver submissions');\n      fetchSubmissions();\n    };\n\n    socket.on('submission:reviewed', handleSubmissionUpdate);\n    socket.on('submission:approved', handleSubmissionUpdate);\n    socket.on('submission:rejected', handleSubmissionUpdate);\n\n    return () => {\n      socket.off('submission:reviewed', handleSubmissionUpdate);\n      socket.off('submission:approved', handleSubmissionUpdate);\n      socket.off('submission:rejected', handleSubmissionUpdate);\n    };\n  }, [socket, fetchSubmissions]);\n\n  const handleSort = (field: string) => {\n    if (sortBy === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortBy(field);\n      setSortOrder('desc');\n    }\n    setCurrentPage(1);\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortBy !== field) return <ChevronUpDownIcon className=\"h-4 w-4\" />;\n    return sortOrder === 'asc' \n      ? <ChevronUpIcon className=\"h-4 w-4\" />\n      : <ChevronDownIcon className=\"h-4 w-4\" />;\n  };\n\n  const getReviewStatusBadge = (status: string) => {\n    switch (status) {\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const getFinalStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const handleViewDetails = (submission: Submission) => {\n    setSelectedSubmission(submission);\n    setShowDetailModal(true);\n  };\n\n  const clearFilters = () => {\n    setSearchTerm('');\n    setReviewStatusFilter('');\n    setFinalStatusFilter('');\n    setCurrentPage(1);\n  };\n\n  const handleCloseModal = () => {\n    setShowDetailModal(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleApprovalSubmitted = () => {\n    fetchSubmissions(); // Refresh data after approval\n  };\n\n  const hasFilters = searchTerm || reviewStatusFilter || finalStatusFilter;\n\n  if (loading && submissions.length === 0) {\n    return <LoadingState />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header and Filters - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <div>\n            <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Persetujuan Pengajuan</h1>\n            <p className=\"text-sm text-gray-500 mt-1\">Kelola dan setujui pengajuan SIMLOK</p>\n          </div>\n        </div>\n\n        {/* Toolbar - Search and Filters */}\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n          <div className=\"relative w-full md:w-80\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              placeholder=\"Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas...\"\n              value={searchTerm}\n              onChange={(e) => {\n                setSearchTerm(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n            />\n          </div>\n          <div className=\"flex gap-2 md:w-auto\">\n            <select\n              value={reviewStatusFilter}\n              onChange={(e) => {\n                setReviewStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Review</option>\n              <option value=\"MEETS_REQUIREMENTS\">Memenuhi Syarat</option>\n              <option value=\"NOT_MEETS_REQUIREMENTS\">Tidak Memenuhi Syarat</option>\n            </select>\n            <select\n              value={finalStatusFilter}\n              onChange={(e) => {\n                setFinalStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Akhir</option>\n              <option value=\"PENDING_APPROVAL\">Menunggu Persetujuan</option>\n              <option value=\"APPROVED\">Disetujui</option>\n              <option value=\"REJECTED\">Ditolak</option>\n            </select>\n            {hasFilters && (\n              <Button\n                onClick={clearFilters}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-gray-600 border-gray-300 hover:bg-gray-50\"\n              >\n                <XMarkIcon className=\"h-4 w-4 mr-1\" />\n                Reset\n              </Button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Show empty state if no submissions */}\n      {!loading && submissions.length === 0 ? (\n        <EmptyState hasFilters={hasFilters ? true : false} onClearFilters={clearFilters} />\n      ) : (\n        <div>\n          {/* Submissions Table - Unified Design */}\n          <div className=\"bg-white rounded-xl border shadow-sm overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th \n                  className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors\"\n                  onClick={() => handleSort('reviewed_at')}\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tanggal Review</span>\n                    {getSortIcon('reviewed_at')}\n                  </div>\n                </th>\n                <th \n                  className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors\"\n                  onClick={() => handleSort('vendor_name')}\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Vendor & PJ</span>\n                    {getSortIcon('vendor_name')}\n                  </div>\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Pekerjaan & Lokasi\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status Review\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status Final\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Reviewer\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {submissions.map((submission) => (\n                <tr key={submission.id} className=\"hover:bg-gray-50 transition-colors\">\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {submission.reviewed_at \n                        ? new Date(submission.reviewed_at).toLocaleDateString('id-ID', {\n                            day: '2-digit',\n                            month: 'short',\n                            year: 'numeric'\n                          })\n                        : '-'\n                      }\n                    </div>\n                    {submission.reviewed_at && (\n                      <div className=\"text-xs text-gray-500\">\n                        {new Date(submission.reviewed_at).toLocaleTimeString('id-ID', {\n                          hour: '2-digit',\n                          minute: '2-digit'\n                        })}\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"max-w-44\">\n                      <div className=\"text-sm font-medium text-gray-900 truncate\" title={submission.vendor_name}>\n                        {submission.vendor_name}\n                      </div>\n                      <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-1\">\n                        <UserIcon className=\"h-3 w-3 flex-shrink-0\" />\n                        <span className=\"truncate\" title={submission.officer_name}>{submission.officer_name}</span>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"max-w-52\">\n                      <div className=\"text-sm font-medium text-gray-900 truncate\" title={submission.job_description}>\n                        {submission.job_description}\n                      </div>\n                      <div className=\"text-xs text-gray-500 mt-1 truncate\" title={submission.work_location}>\n                        📍 {submission.work_location}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    {getReviewStatusBadge(submission.review_status)}\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    {getFinalStatusBadge(submission.final_status)}\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900 max-w-28\">\n                      <span className=\"truncate block\" title={submission.reviewed_by_user?.officer_name || '-'}>\n                        {submission.reviewed_by_user?.officer_name || '-'}\n                      </span>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium\">\n                    <Button\n                      onClick={() => handleViewDetails(submission)}\n                      size=\"sm\"\n                      variant={submission.final_status === 'PENDING_APPROVAL' ? 'primary' : 'outline'}\n                      className=\"inline-flex items-center\"\n                    >\n                      <EyeIcon className=\"h-4 w-4 mr-1\" />\n                      {submission.final_status === 'PENDING_APPROVAL' ? 'Setujui' : 'Lihat'}\n                    </Button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>        {/* Enhanced Pagination */}\n        {pagination.pages > 1 && (\n          <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200\">\n            <div className=\"flex-1 flex justify-between sm:hidden\">\n              <Button\n                onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                disabled={currentPage === 1}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                Sebelumnya\n              </Button>\n              <Button\n                onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                disabled={currentPage === pagination.pages}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                Selanjutnya\n              </Button>\n            </div>\n            <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-700\">\n                  Menampilkan{' '}\n                  <span className=\"font-medium\">\n                    {(currentPage - 1) * pagination.limit + 1}\n                  </span>{' '}\n                  sampai{' '}\n                  <span className=\"font-medium\">\n                    {Math.min(currentPage * pagination.limit, pagination.total)}\n                  </span>{' '}\n                  dari{' '}\n                  <span className=\"font-medium\">{pagination.total}</span> pengajuan\n                </p>\n              </div>\n              <div>\n                <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\" aria-label=\"Pagination\">\n                  <Button\n                    onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                    disabled={currentPage === 1}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-r-none\"\n                  >\n                    Sebelumnya\n                  </Button>\n                  \n                  {Array.from({ length: Math.min(5, pagination.pages) }, (_, i) => {\n                    const pageNum = i + 1;\n                    return (\n                      <Button\n                        key={pageNum}\n                        onClick={() => setCurrentPage(pageNum)}\n                        variant={currentPage === pageNum ? \"primary\" : \"outline\"}\n                        size=\"sm\"\n                        className=\"rounded-none\"\n                      >\n                        {pageNum}\n                      </Button>\n                    );\n                  })}\n                  \n                  <Button\n                    onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                    disabled={currentPage === pagination.pages}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-l-none\"\n                  >\n                    Selanjutnya\n                  </Button>\n                </nav>\n              </div>\n            </div>\n          </div>\n        )}\n        </div>\n        </div>\n      )}\n\n      {/* New Detail Modal */}\n      <ApproverSubmissionDetailModal\n        isOpen={showDetailModal}\n        onClose={handleCloseModal}\n        submissionId={selectedSubmission?.id || ''}\n        onApprovalSubmitted={handleApprovalSubmitted}\n      />\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/auth/AuthRedirect.tsx",
      "lang": "tsx",
      "size": 1055,
      "lines": 45,
      "hash": "a393cc31f4c3933192d60416d43fd6dc7be9469baa6b7ea1dd515c1315934434",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function AuthRedirect({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === \"loading\") return; // tunggu dulu\n\n    if (session?.user?.role) {\n      switch (session.user.role) {\n        case \"ADMIN\":\n          router.replace(\"/admin\");\n          break;\n        case \"VENDOR\":\n          router.replace(\"/vendor\");\n          break;\n        case \"VERIFIER\":\n          router.replace(\"/verifier\");\n          break;\n        default:\n          router.replace(\"/\"); // fallback\n      }\n    }\n  }, [session, status, router]);\n\n  if (status === \"loading\") {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  // hanya render children kalau memang BELUM login\n  return <>{!session ? children : null}</>;\n}"
    },
    {
      "path": "src/components/auth/SignInForm.tsx",
      "lang": "tsx",
      "size": 3556,
      "lines": 119,
      "hash": "60f7540f2809da7ba252743630522ff7444927e6f383ccd55bcce9e232478949",
      "truncated": false,
      "content": "\"use client\";\n\nimport Checkbox from \"@/components/form/Checkbox\";\nimport Input from \"@/components/form/Input\";\nimport Label from \"@/components/form/Label\";\nimport Button from \"@/components/ui/button/Button\";\nimport { EyeIcon, EyeSlashIcon } from \"@heroicons/react/24/outline\";\nimport Link from \"next/link\";\nimport type { FC } from \"react\";\n\ninterface Props {\n  email: string;\n  password: string;\n  showPassword: boolean;\n  keepLoggedIn: boolean;\n  error: string;\n  setEmail: (v: string) => void;\n  setPassword: (v: string) => void;\n  setShow: (v: boolean) => void;\n  setKeep: (v: boolean) => void;\n  handleSubmit: (e: React.FormEvent) => void;\n}\n\nconst SignInForm: FC<Props> = ({\n  email,\n  password,\n  showPassword,\n  keepLoggedIn,\n  error,\n  setEmail,\n  setPassword,\n  setShow,\n  setKeep,\n  handleSubmit,\n}) => (\n  <div className=\"flex flex-col w-full items-center justify-center my-auto min-h-screen bg-blue-900\">\n    <div className=\"flex flex-col justify-center w-full max-w-md mx-auto bg-white p-10 border border-gray-200 rounded-lg shadow-lg\">\n      <div>\n        <div className=\"mb-5 sm:mb-8\">\n          <h1 className=\"mb-2 font-semibold text-gray-800 text-2xl\">\n            Sign In\n          </h1>\n          <p className=\"text-sm text-gray-500\">\n            Enter your email and password to sign in!\n          </p>\n        </div>\n\n        {error && (\n          <p className=\"mb-3 text-sm text-center text-red-600\">{error}</p>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div>\n            <Label>Email <span className=\"text-red-500\">*</span></Label>\n            <Input\n              type=\"email\"\n              placeholder=\"info@gmail.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              required\n            />\n          </div>\n\n          <div>\n            <Label>Password <span className=\"text-red-500\">*</span></Label>\n            <div className=\"relative\">\n              <Input\n                type={showPassword ? \"text\" : \"password\"}\n                placeholder=\"Enter your password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n              />\n              <span\n                onClick={() => setShow(!showPassword)}\n                className=\"absolute z-30 -translate-y-1/2 cursor-pointer right-4 top-1/2\"\n              >\n                {showPassword ? (\n                  <EyeSlashIcon className=\"w-5 h-5 text-gray-500\" />\n                ) : (\n                  <EyeIcon className=\"w-5 h-5 text-gray-500\" />\n                )}\n              </span>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <Checkbox\n              checked={keepLoggedIn}\n              onChange={setKeep}\n              label=\"Keep me logged in\"\n            />\n            <Link\n              href=\"/reset-password\"\n              className=\"text-sm text-blue-500 hover:text-blue-600\"\n            >\n              Forgot password?\n            </Link>\n          </div>\n\n          <Button className=\"w-full\" size=\"sm\" type=\"submit\">\n            Sign in\n          </Button>\n        </form>\n\n        <div className=\"mt-5\">\n          <p className=\"text-sm text-center text-gray-700\">\n            Don&apos;t have an account?{\" \"}\n            <Link href=\"/signup\" className=\"text-blue-500 hover:text-blue-600\">\n              Sign Up\n            </Link>\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nexport default SignInForm;"
    },
    {
      "path": "src/components/auth/SignUpForm.tsx",
      "lang": "tsx",
      "size": 9317,
      "lines": 276,
      "hash": "7f914aa7b47ea6ffce04dc0b21f0b0dc22cce27b7f6f09fb1dea97f88fb7fc26",
      "truncated": false,
      "content": "\"use client\";\n\nimport Checkbox from \"@/components/form/Checkbox\";\nimport Input from \"@/components/form/Input\";\nimport Label from \"@/components/form/Label\";\nimport Button from \"@/components/ui/button/Button\";\nimport { EyeIcon, EyeSlashIcon } from \"@heroicons/react/24/outline\";\nimport Link from \"next/link\";\nimport type { FC } from \"react\";\n\ninterface Props {\n  email: string;\n  password: string;\n  confirmPassword: string;\n  nama_petugas: string;\n  nama_vendor: string;\n  alamat: string;\n  no_telp: string;\n  showPassword: boolean;\n  showConfirmPassword: boolean;\n  agreeToTerms: boolean;\n  error: string;\n  isLoading: boolean;\n  setEmail: (v: string) => void;\n  setPassword: (v: string) => void;\n  setConfirmPassword: (v: string) => void;\n  setNamaPetugas: (v: string) => void;\n  setNamaVendor: (v: string) => void;\n  setAlamat: (v: string) => void;\n  setNoTelp: (v: string) => void;\n  setShowPassword: (v: boolean) => void;\n  setShowConfirmPassword: (v: boolean) => void;\n  setAgree: (v: boolean) => void;\n  handleSubmit: (e: React.FormEvent) => void;\n}\n\nconst SignUpForm: FC<Props> = ({\n  email,\n  password,\n  confirmPassword,\n  nama_petugas,\n  nama_vendor,\n  alamat,\n  no_telp,\n  showPassword,\n  showConfirmPassword,\n  agreeToTerms,\n  error,\n  isLoading,\n  setEmail,\n  setPassword,\n  setConfirmPassword,\n  setNamaPetugas,\n  setNamaVendor,\n  setAlamat,\n  setNoTelp,\n  setShowPassword,\n  setShowConfirmPassword,\n  setAgree,\n  handleSubmit,\n}) => (\n  <div className=\"flex flex-col w-full items-center justify-center my-auto min-h-screen bg-blue-900 py-8\">\n    <div className=\"flex flex-col justify-center w-full max-w-2xl mx-4 bg-white p-8 border border-gray-200 rounded-lg shadow-lg\">\n      <div>\n        <div className=\"mb-6\">\n          <h1 className=\"mb-2 font-semibold text-gray-800 text-2xl\">\n            Daftar Akun Vendor\n          </h1>\n          <p className=\"text-sm text-gray-500\">\n            Buat akun vendor untuk mengakses sistem SIMLOK\n          </p>\n        </div>\n\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md\">\n            <p className=\"text-sm text-red-600\">{error}</p>\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Personal Information */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 border-b pb-2\">\n              Informasi Personal\n            </h3>\n            \n            <div>\n              <Label>Nama Lengkap Petugas <span className=\"text-red-500\">*</span></Label>\n              <Input\n                type=\"text\"\n                placeholder=\"Contoh: Ahmad Budi Santoso\"\n                value={nama_petugas}\n                onChange={(e) => setNamaPetugas(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Nama petugas yang akan bertanggung jawab\n              </p>\n            </div>\n\n            <div>\n              <Label>Email <span className=\"text-red-500\">*</span></Label>\n              <Input\n                type=\"email\"\n                placeholder=\"email@perusahaan.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n            </div>\n\n            <div>\n              <Label>No. Telepon <span className=\"text-red-500\">*</span></Label>\n              <Input\n                type=\"tel\"\n                placeholder=\"08123456789\"\n                value={no_telp}\n                onChange={(e) => setNoTelp(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n            </div>\n\n            <div>\n              <Label>Alamat Lengkap <span className=\"text-red-500\">*</span></Label>\n              <textarea\n                placeholder=\"Alamat lengkap perusahaan\"\n                value={alamat}\n                onChange={(e) => setAlamat(e.target.value)}\n                required\n                disabled={isLoading}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              />\n            </div>\n          </div>\n\n          {/* Company Information */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 border-b pb-2\">\n              Informasi Vendor\n            </h3>\n            \n            <div>\n              <Label>Nama Vendor/Perusahaan <span className=\"text-red-500\">*</span></Label>\n              <Input\n                type=\"text\"\n                placeholder=\"PT. Nama Perusahaan\"\n                value={nama_vendor}\n                onChange={(e) => setNamaVendor(e.target.value)}\n                required\n                disabled={isLoading}\n              />\n            </div>\n          </div>\n\n          {/* Security Information */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-medium text-gray-900 border-b pb-2\">\n              Keamanan Akun\n            </h3>\n            \n            <div>\n              <Label>Password <span className=\"text-red-500\">*</span></Label>\n              <div className=\"relative\">\n                <Input\n                  type={showPassword ? \"text\" : \"password\"}\n                  placeholder=\"Masukkan password (min. 8 karakter)\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  minLength={8}\n                  disabled={isLoading}\n                />\n                <span\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute z-30 -translate-y-1/2 cursor-pointer right-4 top-1/2\"\n                >\n                  {showPassword ? (\n                    <EyeSlashIcon className=\"w-5 h-5 text-gray-500\" />\n                  ) : (\n                    <EyeIcon className=\"w-5 h-5 text-gray-500\" />\n                  )}\n                </span>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Password minimal 8 karakter, kombinasi huruf, angka dan simbol\n              </p>\n            </div>\n\n            <div>\n              <Label>Konfirmasi Password <span className=\"text-red-500\">*</span></Label>\n              <div className=\"relative\">\n                <Input\n                  type={showConfirmPassword ? \"text\" : \"password\"}\n                  placeholder=\"Ulangi password\"\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  required\n                  minLength={8}\n                  disabled={isLoading}\n                />\n                <span\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                  className=\"absolute z-30 -translate-y-1/2 cursor-pointer right-4 top-1/2\"\n                >\n                  {showConfirmPassword ? (\n                    <EyeSlashIcon className=\"w-5 h-5 text-gray-500\" />\n                  ) : (\n                    <EyeIcon className=\"w-5 h-5 text-gray-500\" />\n                  )}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Terms Agreement */}\n          <div className=\"flex items-start gap-3 pt-4\">\n            <Checkbox\n              checked={agreeToTerms}\n              onChange={setAgree}\n              label=\"\"\n              disabled={isLoading}\n            />\n            <span className=\"text-sm text-gray-700 -mt-1\">\n              Saya menyetujui{\" \"}\n              <Link href=\"/terms\" className=\"text-blue-500 hover:text-blue-600 underline\">\n                Syarat dan Ketentuan\n              </Link>{\" \"}\n              serta{\" \"}\n              <Link href=\"/privacy\" className=\"text-blue-500 hover:text-blue-600 underline\">\n                Kebijakan Privasi\n              </Link>{\" \"}\n              yang berlaku. <span className=\"text-red-500\">*</span>\n            </span>\n          </div>\n\n          <Button \n            className=\"w-full\" \n            size=\"md\" \n            type=\"submit\"\n            disabled={isLoading || !agreeToTerms || password !== confirmPassword}\n          >\n            {isLoading ? (\n              <div className=\"flex items-center justify-center\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                Mendaftar...\n              </div>\n            ) : (\n              \"Daftar Sekarang\"\n            )}\n          </Button>\n\n          {password !== confirmPassword && confirmPassword && (\n            <p className=\"text-sm text-red-600 text-center\">\n              Password dan konfirmasi password tidak sama\n            </p>\n          )}\n        </form>\n\n        <div className=\"mt-6 pt-4 border-t border-gray-200\">\n          <p className=\"text-sm text-center text-gray-700\">\n            Sudah memiliki akun?{\" \"}\n            <Link href=\"/login\" className=\"text-blue-500 hover:text-blue-600 font-medium\">\n              Masuk di sini\n            </Link>\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nexport default SignUpForm;"
    },
    {
      "path": "src/components/common/DetailSection.tsx",
      "lang": "tsx",
      "size": 1646,
      "lines": 61,
      "hash": "a28f01f9a8e52e600302bcad39a5a6e4895ac5772a90c19ded9172377189850d",
      "truncated": false,
      "content": "'use client';\n\nimport { ReactNode } from 'react';\nimport { ChevronDownIcon, ChevronRightIcon } from '@heroicons/react/24/outline';\nimport { useState } from 'react';\n\ninterface DetailSectionProps {\n  title: string;\n  children: ReactNode;\n  icon?: ReactNode;\n  defaultOpen?: boolean;\n  collapsible?: boolean;\n  badge?: ReactNode;\n  className?: string;\n}\n\nexport default function DetailSection({\n  title,\n  children,\n  icon,\n  defaultOpen = true,\n  collapsible = false,\n  badge,\n  className = ''\n}: DetailSectionProps) {\n  const [isOpen, setIsOpen] = useState(defaultOpen);\n\n  return (\n    <div className={`bg-white border border-gray-200 rounded-lg shadow-sm ${className}`}>\n      <div \n        className={`flex items-center justify-between p-4 ${\n          collapsible ? 'cursor-pointer hover:bg-gray-50' : ''\n        } border-b border-gray-100`}\n        onClick={collapsible ? () => setIsOpen(!isOpen) : undefined}\n      >\n        <div className=\"flex items-center space-x-3\">\n          {icon && <div className=\"flex-shrink-0\">{icon}</div>}\n          <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\n          {badge && <div className=\"flex-shrink-0\">{badge}</div>}\n        </div>\n        \n        {collapsible && (\n          <div className=\"flex-shrink-0\">\n            {isOpen ? (\n              <ChevronDownIcon className=\"h-5 w-5 text-gray-500\" />\n            ) : (\n              <ChevronRightIcon className=\"h-5 w-5 text-gray-500\" />\n            )}\n          </div>\n        )}\n      </div>\n      \n      {(!collapsible || isOpen) && (\n        <div className=\"p-4\">\n          {children}\n        </div>\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/common/DocumentPreviewModal.tsx",
      "lang": "tsx",
      "size": 8591,
      "lines": 266,
      "hash": "eafe3378b12cf378568b44a5b586b33c41e90c171e4e083bd5841682aaed1f25",
      "truncated": false,
      "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { XMarkIcon, ArrowTopRightOnSquareIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';\n\ninterface DocumentPreviewModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  fileUrl: string;\n  fileName: string;\n  fileType?: string;\n}\n\nexport default function DocumentPreviewModal({ \n  isOpen, \n  onClose, \n  fileUrl, \n  fileName, \n  fileType \n}: DocumentPreviewModalProps) {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Handle escape key press\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  // Reset states when modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setLoading(true);\n      setError(null);\n    }\n  }, [isOpen, fileUrl]);\n\n  if (!isOpen) return null;\n\n  // Determine file type from URL or provided type\n  const determineFileType = (url: string, type?: string): string => {\n    if (type) return type.toLowerCase();\n    \n    const extension = url.split('.').pop()?.toLowerCase() || '';\n    \n    if (['pdf'].includes(extension)) return 'pdf';\n    if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension)) return 'image';\n    if (['doc', 'docx'].includes(extension)) return 'document';\n    \n    return 'unknown';\n  };\n\n  const detectedFileType = determineFileType(fileUrl, fileType);\n\n  const handleDownload = () => {\n    const link = document.createElement('a');\n    link.href = fileUrl;\n    link.download = fileName;\n    link.target = '_blank';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const handleOpenInNewTab = () => {\n    window.open(fileUrl, '_blank');\n  };\n\n  const renderPreviewContent = () => {\n    if (error) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"text-red-500 text-lg mb-2\">!</div>\n            <p className=\"text-gray-600\">{error}</p>\n            <button\n              onClick={handleOpenInNewTab}\n              className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n            >\n              Buka di Tab Baru\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    switch (detectedFileType) {\n      case 'pdf':\n        return (\n          <div className=\"flex-1 relative\">\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-gray-50\">\n                <div className=\"text-center\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n                  <p className=\"text-gray-600\">Memuat dokumen...</p>\n                </div>\n              </div>\n            )}\n            <iframe\n              src={fileUrl}\n              className=\"w-full h-full border-0\"\n              title={fileName}\n              onLoad={() => setLoading(false)}\n              onError={() => {\n                setLoading(false);\n                setError('Gagal memuat dokumen PDF');\n              }}\n            />\n          </div>\n        );\n\n      case 'image':\n        return (\n          <div className=\"flex-1 flex items-center justify-center p-4 bg-gray-50\">\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n                  <p className=\"text-gray-600\">Memuat gambar...</p>\n                </div>\n              </div>\n            )}\n            <img\n              src={fileUrl}\n              alt={fileName}\n              className=\"max-w-full max-h-full object-contain\"\n              onLoad={() => setLoading(false)}\n              onError={() => {\n                setLoading(false);\n                setError('Gagal memuat gambar');\n              }}\n            />\n          </div>\n        );\n\n      case 'document':\n        return (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">📄</div>\n              <p className=\"text-gray-600 mb-4\">\n                Dokumen Word tidak dapat ditampilkan langsung.\n              </p>\n              <div className=\"space-x-4\">\n                <button\n                  onClick={handleDownload}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\n                >\n                  Download Dokumen\n                </button>\n                <button\n                  onClick={handleOpenInNewTab}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                >\n                  Buka di Tab Baru\n                </button>\n              </div>\n            </div>\n          </div>\n        );\n\n      default:\n        return (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">📎</div>\n              <p className=\"text-gray-600 mb-4\">\n                File ini tidak dapat ditampilkan langsung.\n              </p>\n              <div className=\"space-x-4\">\n                <button\n                  onClick={handleDownload}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors\"\n                >\n                  Download File\n                </button>\n                <button\n                  onClick={handleOpenInNewTab}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                >\n                  Buka di Tab Baru\n                </button>\n              </div>\n            </div>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-hidden\">\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black/50 transition-opacity\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-2\">\n        <div className=\"relative bg-white rounded-lg shadow-xl w-full max-w-7xl h-[95vh] flex flex-col\">\n          \n          {/* Header - Fixed */}\n          <div className=\"bg-white flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0\">\n            <div className=\"flex items-center space-x-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900 truncate max-w-md\">\n                {fileName}\n              </h3>\n              <span className=\"text-sm text-gray-500 capitalize\">\n                {detectedFileType}\n              </span>\n            </div>\n            \n            {/* Action buttons */}\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={handleDownload}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Download\"\n              >\n                <ArrowDownTrayIcon className=\"w-5 h-5\" />\n              </button>\n              \n              <button\n                onClick={handleOpenInNewTab}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Buka di Tab Baru\"\n              >\n                <ArrowTopRightOnSquareIcon className=\"w-5 h-5\" />\n              </button>\n              \n              <button\n                onClick={onClose}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-full hover:bg-gray-100\"\n                title=\"Tutup\"\n              >\n                <XMarkIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content - Scrollable */}\n          <div className=\"bg-white flex-1 overflow-hidden flex flex-col\">\n            {renderPreviewContent()}\n          </div>\n\n\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/common/InfoCard.tsx",
      "lang": "tsx",
      "size": 1643,
      "lines": 62,
      "hash": "b920555f242a93f83c78ed732906033719123bba0485781b9c4b04d8163ecdc8",
      "truncated": false,
      "content": "'use client';\n\nimport { ReactNode } from 'react';\n\ninterface InfoCardProps {\n  label: string;\n  value: string | ReactNode;\n  icon?: ReactNode;\n  copyable?: boolean;\n  className?: string;\n  valueClassName?: string;\n}\n\nexport default function InfoCard({\n  label,\n  value,\n  icon,\n  copyable = false,\n  className = '',\n  valueClassName = ''\n}: InfoCardProps) {\n  const handleCopy = async () => {\n    if (copyable && typeof value === 'string') {\n      try {\n        await navigator.clipboard.writeText(value);\n        // You could add a toast notification here\n      } catch (err) {\n        console.error('Failed to copy:', err);\n      }\n    }\n  };\n\n  return (\n    <div className={`space-y-1 ${className}`}>\n      <div className=\"flex items-center space-x-2\">\n        {icon && <div className=\"flex-shrink-0\">{icon}</div>}\n        <label className=\"text-sm font-medium text-gray-700\">\n          {label}\n        </label>\n      </div>\n      \n      <div className={`group relative ${copyable ? 'cursor-pointer' : ''}`} onClick={copyable ? handleCopy : undefined}>\n        {typeof value === 'string' ? (\n          <p className={`text-sm text-gray-900 ${copyable ? 'hover:text-blue-600' : ''} ${valueClassName}`}>\n            {value || '-'}\n          </p>\n        ) : (\n          <div className={valueClassName}>\n            {value}\n          </div>\n        )}\n        \n        {copyable && typeof value === 'string' && value && (\n          <span className=\"absolute top-0 left-full ml-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-500\">\n            Klik untuk copy\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/common/RealtimeUpdates.tsx",
      "lang": "tsx",
      "size": 2533,
      "lines": 85,
      "hash": "94a0ec3349cd6ee4c2cf1344f877c56950b8100e4a2edd2dd68613629a12b807",
      "truncated": false,
      "content": "import { useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\n\nlet socket: Socket | null = null;\n\n// Temporarily disable Socket.IO until server is properly configured\nconst SOCKET_ENABLED = process.env.NODE_ENV === 'development' && false; // Disabled for now\n\nexport const initSocket = () => {\n  if (!socket && SOCKET_ENABLED) {\n    socket = io(process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3000', {\n      path: '/api/socket',\n      addTrailingSlash: false,\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: 5,\n      timeout: 20000,\n      transports: ['websocket', 'polling'], // Fallback to polling if websocket fails\n    });\n  }\n  return socket;\n};\n\nexport const getSocket = () => socket;\n\nexport const useSocket = () => {\n  const socketRef = useRef<Socket | null>(null);\n\n  useEffect(() => {\n    if (!SOCKET_ENABLED) {\n      return;\n    }\n\n    if (!socketRef.current) {\n      socketRef.current = initSocket();\n    }\n\n    const currentSocket = socketRef.current;\n    if (!currentSocket) return;\n\n    const handleConnect = () => {\n      console.log('Connected to socket server');\n    };\n\n    const handleDisconnect = (reason: string) => {\n      console.log('Disconnected from socket server:', reason);\n    };\n\n    const handleError = (error: any) => {\n      console.error('Socket error:', error);\n    };\n\n    const handleConnectError = (error: any) => {\n      console.error('Socket connection error:', error);\n    };\n\n    const handleReconnect = (attemptNumber: number) => {\n      console.log('Socket reconnected after', attemptNumber, 'attempts');\n    };\n\n    const handleReconnectError = (error: any) => {\n      console.error('Socket reconnection error:', error);\n    };\n\n    currentSocket.on('connect', handleConnect);\n    currentSocket.on('disconnect', handleDisconnect);\n    currentSocket.on('error', handleError);\n    currentSocket.on('connect_error', handleConnectError);\n    currentSocket.on('reconnect', handleReconnect);\n    currentSocket.on('reconnect_error', handleReconnectError);\n\n    return () => {\n      if (!currentSocket) return;\n      currentSocket.off('connect', handleConnect);\n      currentSocket.off('disconnect', handleDisconnect);\n      currentSocket.off('error', handleError);\n      currentSocket.off('connect_error', handleConnectError);\n      currentSocket.off('reconnect', handleReconnect);\n      currentSocket.off('reconnect_error', handleReconnectError);\n    };\n  }, []);\n\n  return SOCKET_ENABLED ? socketRef.current : null;\n};\n"
    },
    {
      "path": "src/components/common/SimlokPdfModal.tsx",
      "lang": "tsx",
      "size": 11485,
      "lines": 323,
      "hash": "1baa69a9019eef89f62cb767b18456aa460e88747786eefd21340d5dd22269d4",
      "truncated": false,
      "content": "'use client';\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { XMarkIcon, ArrowDownTrayIcon } from '@heroicons/react/24/outline';\n\ninterface SimlokPdfModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  submissionName: string;\n  nomorSimlok?: string;\n}\n\nexport default function SimlokPdfModal({\n  isOpen,\n  onClose,\n  submissionId,\n  submissionName,\n  nomorSimlok,\n}: SimlokPdfModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null); // <-- ubah: null, bukan \"\"\n  const objectUrlRef = useRef<string | null>(null); // untuk blob URL cleanup\n\n  // Cleanup object URL ketika modal ditutup/unmount\n  useEffect(() => {\n    return () => {\n      if (objectUrlRef.current) {\n        URL.revokeObjectURL(objectUrlRef.current);\n        objectUrlRef.current = null;\n      }\n    };\n  }, []);\n\n  // Esc key + body scroll lock\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') onClose();\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  // Siapkan URL/pdf saat modal dibuka, cleanup saat ditutup\n  useEffect(() => {\n    let cancelled = false;\n\n    async function prepare() {\n      if (!isOpen || !submissionId) {\n        // Reset state when modal is closed\n        setPdfUrl(null);\n        setError(null);\n        setLoading(true);\n        return;\n      }\n\n      setLoading(true);\n      setError(null);\n\n      // bersihkan object URL lama\n      if (objectUrlRef.current) {\n        URL.revokeObjectURL(objectUrlRef.current);\n        objectUrlRef.current = null;\n      }\n      setPdfUrl(null);\n\n      try {\n        // Pakai timestamp supaya bypass cache\n        const t = Date.now();\n        const apiUrl = `/api/submissions/${encodeURIComponent(\n          submissionId\n        )}?format=pdf&t=${t}`;\n\n        // Kalau endpoint protected, pakai credentials: 'include'\n        // dan mode 'same-origin' (default) supaya cookie terkirim\n        const res = await fetch(apiUrl, {\n          method: 'GET',\n          credentials: 'include',\n        });\n\n        if (!res.ok) {\n          // Try to get error details from response\n          try {\n            const errorData = await res.json();\n            throw new Error(errorData.error || `Gagal memuat PDF (${res.status})`);\n          } catch (jsonError) {\n            throw new Error(`Gagal memuat PDF (${res.status})`);\n          }\n        }\n\n        // Gunakan blob -> object URL agar:\n        // - lebih stabil di berbagai browser\n        // - bisa di-print/download tanpa kebijakan CORS aneh\n        const blob = await res.blob();\n        const url = URL.createObjectURL(blob);\n        objectUrlRef.current = url;\n\n        if (!cancelled) {\n          setPdfUrl(url);\n          setLoading(false);\n          setError(null);\n        }\n      } catch (e: any) {\n        if (!cancelled) {\n          setError(e?.message || 'Gagal memuat dokumen PDF SIMLOK.');\n          setLoading(false);\n        }\n      }\n    }\n\n    prepare();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [isOpen, submissionId]);\n\n  // Generate filename (must be before early return to avoid hook order issues)\n  const filename = useMemo(() => {\n    if (nomorSimlok) return `SIMLOK_${nomorSimlok.replace(/[/\\\\]/g, '_')}.pdf`;\n    return `SIMLOK_${submissionName.replace(/[/\\\\]/g, '_')}.pdf`;\n  }, [nomorSimlok, submissionName]);\n\n  if (!isOpen) return null;\n\n  const handleDownload = async () => {\n    try {\n      setError(null);\n\n      // Jika kita sudah punya blob URL, kita bisa fetch ulang BLOB-nya dari URL asli\n      // atau langsung pakai fetch API lagi supaya dapat file fresh.\n      // Lebih konsisten: refetch dari endpoint (agar bukan blob object sementara).\n      const t = Date.now();\n      const apiUrl = `/api/submissions/${encodeURIComponent(\n        submissionId\n      )}?format=pdf&t=${t}`;\n\n      const res = await fetch(apiUrl, {\n        method: 'GET',\n        credentials: 'include',\n      });\n      if (!res.ok) throw new Error('Gagal mendownload PDF');\n\n      const blob = await res.blob();\n      const url = URL.createObjectURL(blob);\n\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n\n      URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error(err);\n      setError('Gagal mendownload PDF SIMLOK');\n    }\n  };\n\n  // Optional: print (bisa gunakan blob URL langsung)\n  // const handlePrint = () => {\n  //   if (!pdfUrl) return;\n  //   const w = window.open(pdfUrl, '_blank');\n  //   if (w) {\n  //     w.addEventListener('load', () => w.print());\n  //   }\n  // };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-hidden\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/60 transition-opacity backdrop-blur-sm\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-2\">\n        <div className=\"relative bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[95vh] flex flex-col\">\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white flex items-center justify-between p-4 rounded-t-lg flex-shrink-0\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"bg-white/20 rounded-lg p-2\">\n                <svg className=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path\n                    fillRule=\"evenodd\"\n                    d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z\"\n                    clipRule=\"evenodd\"\n                  />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold\">Dokumen SIMLOK</h3>\n                <p className=\"text-sm text-blue-100\">\n                  {nomorSimlok ? `No: ${nomorSimlok}` : submissionName}\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              {/* <button\n                onClick={handlePrint}\n                disabled={Boolean(loading || error || !pdfUrl)}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Print PDF\"\n              >\n                <PrinterIcon className=\"w-5 h-5\" />\n              </button> */}\n              <button\n                onClick={handleDownload}\n                disabled={Boolean(loading || error)}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Download PDF\"\n              >\n                <ArrowDownTrayIcon className=\"w-5 h-5\" />\n              </button>\n\n              <div className=\"w-px h-6 bg-white/20 mx-2\" />\n\n              <button\n                onClick={onClose}\n                className=\"p-2 text-white/80 hover:text-white hover:bg-white/20 transition-colors rounded-full\"\n                title=\"Tutup\"\n              >\n                <XMarkIcon className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 relative bg-gray-100\">\n            {/* Overlay loading */}\n            {loading && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-white/90 z-10\">\n                <div className=\"text-center\">\n                  <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4\" />\n                  <p className=\"text-gray-700 font-medium\">Memuat dokumen SIMLOK...</p>\n                  <p className=\"text-sm text-gray-500 mt-2\">Mohon tunggu sebentar</p>\n                </div>\n              </div>\n            )}\n\n            {/* Error state */}\n            {error && (\n              <div className=\"absolute inset-0 flex items-center justify-center bg-gray-50\">\n                <div className=\"text-center p-8\">\n                  <div className=\"text-red-500 text-6xl mb-4\">!</div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Gagal Memuat PDF</h3>\n                  <p className=\"text-gray-600 mb-4\">{error}</p>\n                  <div className=\"space-x-4\">\n                    <button\n                      onClick={() => {\n                        // trigger ulang effect dengan toggle isOpen sebentar\n                        setError(null);\n                        // force reload dengan ganti submissionId param waktu\n                        // (cukup biarkan effect di atas jalan otomatis saat error==null + isOpen true)\n                        const t = Date.now();\n                        const apiUrl = `/api/submissions/${encodeURIComponent(\n                          submissionId\n                        )}?format=pdf&t=${t}`;\n                        setLoading(true);\n                        fetch(apiUrl, { credentials: 'include' })\n                          .then(r => {\n                            if (!r.ok) throw new Error('Gagal memuat ulang');\n                            return r.blob();\n                          })\n                          .then(b => {\n                            if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current);\n                            const url = URL.createObjectURL(b);\n                            objectUrlRef.current = url;\n                            setPdfUrl(url);\n                            setLoading(false);\n                          })\n                          .catch(e => {\n                            setLoading(false);\n                            setError(e?.message || 'Gagal memuat ulang dokumen');\n                          });\n                      }}\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                    >\n                      Coba Lagi\n                    </button>\n                    <button\n                      onClick={onClose}\n                      className=\"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors\"\n                    >\n                      Tutup\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Hanya render iframe saat pdfUrl siap */}\n            {!error && pdfUrl && pdfUrl.trim() !== '' && (\n              <iframe\n                key={pdfUrl} // re-mount saat URL berubah\n                src={pdfUrl}\n                className=\"w-full h-full border-0\"\n                title={`SIMLOK - ${submissionName}`}\n                onLoad={() => {\n                  // sebagian browser tidak memanggil ini untuk blob URL; tidak masalah\n                  setLoading(false);\n                }}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/common/WorkersList.tsx",
      "lang": "tsx",
      "size": 15732,
      "lines": 411,
      "hash": "e2bd72c37502d381bda5cce73b30740ed4ba825b38575fdf65467bb142d20a3d",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  UserIcon, \n  PhotoIcon, \n  EyeIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  XMarkIcon \n} from '@heroicons/react/24/outline';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\n\ninterface Worker {\n  id: string;\n  worker_name: string;\n  worker_photo: string | null;\n  submission_id: string;\n  created_at: string;\n}\n\ninterface WorkersListProps {\n  submissionId: string;\n  fallbackWorkers?: string;\n  layout?: 'grid' | 'list';\n  showPhotos?: boolean;\n  maxDisplayCount?: number;\n  verificationMode?: boolean;\n  className?: string;\n  // Context for different API endpoints\n  context?: 'vendor' | 'reviewer' | 'admin' | 'approver';\n}\n\nexport default function WorkersList({ \n  submissionId, \n  fallbackWorkers = '', \n  layout = 'grid',\n  showPhotos = true,\n  maxDisplayCount = 6,\n  verificationMode = false,\n  className = '',\n  context = 'vendor',\n}: WorkersListProps) {\n  const [workers, setWorkers] = useState<Worker[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [imageErrors, setImageErrors] = useState<Set<string>>(new Set());\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  useEffect(() => {\n    const fetchWorkers = async () => {\n      if (!submissionId) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        // Choose the correct API endpoint based on context\n        let apiUrl = '';\n        switch (context) {\n          case 'approver':\n            apiUrl = `/api/approver/simloks/${submissionId}/workers`;\n            break;\n          case 'reviewer':\n            apiUrl = `/api/reviewer/simloks/${submissionId}/workers`;\n            break;\n          case 'admin':\n            apiUrl = `/api/admin/simloks/${submissionId}/workers`;\n            break;\n          case 'vendor':\n          default:\n            apiUrl = `/api/submissions/${submissionId}/workers`;\n            break;\n        }\n\n        const response = await fetch(apiUrl);\n        if (!response.ok) {\n          throw new Error('Failed to fetch workers');\n        }\n        const data = await response.json();\n        setWorkers(data.workers || []);\n      } catch (err) {\n        console.error('Error fetching workers:', err);\n        setError(err instanceof Error ? err.message : 'Unknown error');\n        \n        // Fallback: parse fallback workers string\n        if (fallbackWorkers) {\n          const fallbackWorkersList = fallbackWorkers.split(',').map((name, index) => ({\n            id: `fallback-${index}`,\n            worker_name: name.trim(),\n            worker_photo: null,\n            submission_id: submissionId,\n            created_at: new Date().toISOString(),\n          }));\n          setWorkers(fallbackWorkersList);\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchWorkers();\n  }, [submissionId, fallbackWorkers, context]);\n\n  const handleImageError = (workerId: string) => {\n    setImageErrors(prev => new Set([...prev, workerId]));\n  };\n\n  const handleImageClick = (imageUrl: string) => {\n    if (imageUrl) {\n      setSelectedImage(imageUrl);\n    }\n  };\n\n  const closeModal = () => {\n    setSelectedImage(null);\n  };\n\n  if (loading) {\n    return (\n      <div className={`animate-pulse ${className}`}>\n        <div className=\"flex items-center space-x-3 mb-3\">\n          <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n          <div className=\"h-4 bg-gray-200 rounded w-16\"></div>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className=\"bg-gray-50 rounded-lg p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"h-12 w-12 bg-gray-200 rounded-full\"></div>\n                <div className=\"flex-1\">\n                  <div className=\"h-4 bg-gray-200 rounded mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-3/4\"></div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (error && workers.length === 0) {\n    return (\n      <div className={`text-center py-6 ${className}`}>\n        <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n        <p className=\"text-gray-500\">Gagal memuat data pekerja</p>\n        <p className=\"text-sm text-gray-400 mt-1\">{error}</p>\n      </div>\n    );\n  }\n\n  if (workers.length === 0) {\n    return (\n      <div className={`text-center py-6 ${className}`}>\n        <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n        <p className=\"text-gray-500\">Belum ada data pekerja</p>\n      </div>\n    );\n  }\n\n  const displayedWorkers = showAll || !maxDisplayCount ? workers : workers.slice(0, maxDisplayCount);\n  const remainingCount = workers.length - (maxDisplayCount || 0);\n\n  return (\n    <div className={className}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-2\">\n          <span className=\"text-sm font-medium text-gray-700\">\n            Jumlah pekerja ({workers.length} orang)\n          </span>\n          {verificationMode && (\n            <span className=\"bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n              Mode Verifikasi\n            </span>\n          )}\n        </div>\n        \n        {maxDisplayCount && workers.length > maxDisplayCount && (\n          <button\n            onClick={() => setShowAll(!showAll)}\n            className=\"text-blue-600 hover:text-blue-700 text-sm font-medium\"\n          >\n            {showAll ? 'Tampilkan Lebih Sedikit' : `Lihat Semua (+${remainingCount})`}\n          </button>\n        )}\n      </div>\n\n      {/* Workers Display */}\n      {layout === 'grid' ? (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6\">\n          {displayedWorkers.map((worker) => (\n            <div\n              key={worker.id}\n              className={`bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border ${\n                verificationMode \n                  ? 'border-purple-200 hover:border-purple-300' \n                  : 'border-gray-100 hover:border-gray-200'\n              }`}\n            >\n              {/* Photo Section - Large and prominent */}\n              <div className=\"relative p-4 pb-2\">\n                {showPhotos && (\n                  <div className=\"relative\">\n                    {worker.worker_photo && !imageErrors.has(worker.id) ? (\n                      <img\n                        src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}\n                        alt={`Foto ${worker.worker_name}`}\n                        className=\"w-full h-48 rounded-lg object-cover cursor-pointer hover:scale-105 transition-transform duration-200 shadow-sm\"\n                        onError={() => handleImageError(worker.id)}\n                        onClick={() => handleImageClick(worker.worker_photo!)}\n                        title=\"Klik untuk memperbesar\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-48 rounded-lg bg-gray-100 flex flex-col items-center justify-center shadow-sm\">\n                        {worker.worker_photo ? (\n                          <>\n                            <PhotoIcon className=\"h-12 w-12 text-gray-400 mb-2\" />\n                            <span className=\"text-xs text-gray-500\">Gagal memuat foto</span>\n                          </>\n                        ) : (\n                          <>\n                            <UserIcon className=\"h-12 w-12 text-gray-400 mb-2\" />\n                            <span className=\"text-xs text-gray-500\">Tidak ada foto</span>\n                          </>\n                        )}\n                      </div>\n                    )}\n                    \n                    {/* Status indicator */}\n                    <div className={`absolute top-2 right-2 w-3 h-3 rounded-full border-2 border-white ${\n                      worker.worker_photo && !imageErrors.has(worker.id)\n                        ? 'bg-green-500' \n                        : 'bg-orange-500'\n                    }`}></div>\n                    \n                    {/* Verification badge */}\n                    {verificationMode && (\n                      <div className=\"absolute top-2 left-2 w-6 h-6 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center\">\n                        <EyeIcon className=\"h-3 w-3 text-white\" />\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Content Section - Name and details below photo */}\n              <div className=\"p-4 pt-2\">\n                <h2 className=\"font-semibold text-gray-900 text-base mb-1\">\n                  {worker.worker_name}\n                </h2>\n\n                {/* Verification Actions */}\n                {verificationMode && (\n                  <div className=\"flex justify-center space-x-2 pt-3 border-t border-gray-100\">\n                    <button \n                      className=\"flex items-center justify-center w-8 h-8 text-green-600 hover:bg-green-50 rounded-full transition-colors\"\n                      title=\"Verifikasi Valid\"\n                    >\n                      <CheckCircleIcon className=\"h-5 w-5\" />\n                    </button>\n                    <button \n                      className=\"flex items-center justify-center w-8 h-8 text-red-600 hover:bg-red-50 rounded-full transition-colors\"\n                      title=\"Perlu Koreksi\"\n                    >\n                      <XCircleIcon className=\"h-5 w-5\" />\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {displayedWorkers.map((worker, index) => (\n            <div\n              key={worker.id}\n              className={`flex items-center space-x-4 p-4 bg-white border rounded-xl hover:shadow-md transition-all duration-200 ${\n                verificationMode \n                  ? 'border-purple-200 hover:border-purple-300' \n                  : 'border-gray-100 hover:border-gray-200'\n              }`}\n            >\n              {/* Number */}\n              <div className=\"flex-shrink-0 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center\">\n                <span className=\"text-sm font-medium text-gray-600\">\n                  {index + 1}\n                </span>\n              </div>\n              \n              {/* Photo */}\n              {showPhotos && (\n                <div className=\"flex-shrink-0 relative\">\n                  {worker.worker_photo && !imageErrors.has(worker.id) ? (\n                    <img\n                      src={fileUrlHelper.convertLegacyUrl(worker.worker_photo, `foto_pekerja_${worker.id}`)}\n                      alt={`Foto ${worker.worker_name}`}\n                      className=\"h-12 w-12 rounded-lg object-cover border-2 border-gray-200 cursor-pointer hover:border-blue-400 transition-colors shadow-sm\"\n                      onError={() => handleImageError(worker.id)}\n                      onClick={() => handleImageClick(worker.worker_photo!)}\n                      title=\"Klik untuk memperbesar\"\n                    />\n                  ) : (\n                    <div className=\"h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-gray-200\">\n                      {worker.worker_photo ? (\n                        <PhotoIcon className=\"h-6 w-6 text-gray-400\" />\n                      ) : (\n                        <UserIcon className=\"h-6 w-6 text-gray-400\" />\n                      )}\n                    </div>\n                  )}\n                  \n                  {/* Status indicator */}\n                  <div className={`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${\n                    worker.worker_photo && !imageErrors.has(worker.id)\n                      ? 'bg-green-500' \n                      : 'bg-orange-500'\n                  }`}></div>\n                  \n                  {verificationMode && (\n                    <div className=\"absolute -top-1 -left-1 w-4 h-4 bg-purple-500 border-2 border-white rounded-full flex items-center justify-center\">\n                      <EyeIcon className=\"h-2.5 w-2.5 text-white\" />\n                    </div>\n                  )}\n                </div>\n              )}\n              \n              {/* Worker Info */}\n              <div className=\"flex-1 min-w-0\">\n                <h3 className=\"text-base font-medium text-gray-900 truncate\">\n                  {worker.worker_name}\n                </h3>\n                <p className=\"text-sm text-gray-500\">\n                  Pekerja #{index + 1}\n                </p>\n              </div>\n              \n              {/* Status Badge */}\n              <div className=\"flex-shrink-0\">\n                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                  worker.worker_photo && !imageErrors.has(worker.id)\n                    ? 'bg-green-100 text-green-800' \n                    : 'bg-orange-100 text-orange-800'\n                }`}>\n                  <div className={`w-2 h-2 rounded-full mr-1.5 ${\n                    worker.worker_photo && !imageErrors.has(worker.id)\n                      ? 'bg-green-400' \n                      : 'bg-orange-400'\n                  }`}></div>\n                  {worker.worker_photo && !imageErrors.has(worker.id) \n                    ? 'Foto Tersedia' \n                    : 'Tanpa Foto'}\n                </span>\n              </div>\n\n              {/* Verification Actions */}\n              {verificationMode && (\n                <div className=\"flex space-x-2 flex-shrink-0\">\n                  <button \n                    className=\"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors\"\n                    title=\"Verifikasi Valid\"\n                  >\n                    <CheckCircleIcon className=\"h-5 w-5\" />\n                  </button>\n                  <button \n                    className=\"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors\"\n                    title=\"Perlu Koreksi\"\n                  >\n                    <XCircleIcon className=\"h-5 w-5\" />\n                  </button>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Photo Modal for worker photos */}\n      {selectedImage && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          {/* Backdrop */}\n          <div\n            className=\"fixed inset-0 bg-black/75 transition-opacity\"\n            onClick={closeModal}\n          />\n          \n          {/* Modal */}\n          <div className=\"flex min-h-full items-center justify-center p-4\">\n            <div className=\"relative max-w-4xl max-h-[90vh] bg-white rounded-lg overflow-hidden\">\n              <button\n                onClick={closeModal}\n                className=\"absolute top-2 right-2 z-10 bg-white hover:bg-gray-100 rounded-full p-2 shadow-lg transition-colors\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n              <img\n                src={selectedImage}\n                alt=\"Preview\"\n                className=\"max-w-full max-h-[90vh] object-contain\"\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/dashboard/AdminDashboard.tsx",
      "lang": "tsx",
      "size": 12923,
      "lines": 361,
      "hash": "234d0e9c9d3b47766c0da042639eef1e083e194b760555e1e314a5791f5d5b91",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { \n  UserGroupIcon, \n  ClipboardDocumentCheckIcon, \n  ClockIcon,\n  EyeIcon\n} from \"@heroicons/react/24/outline\";\nimport Card from \"../ui/Card\";\nimport { Badge } from \"../ui/Badge\";\nimport Button from \"../ui/button/Button\";\nimport Alert from \"../ui/alert/Alert\";\nimport ConfirmModal from \"../ui/modal/ConfirmModal\";\nimport UserVerificationModal from \"../admin/UserVerificationModal\";\nimport { UserData } from \"@/types/user\";\nimport { useStatsStore } from \"@/store/useStatsStore\";\nimport { useSubmissionStore } from \"@/store/useSubmissionStore\";\nimport { useUserStore } from \"@/store/useUserStore\";\nimport { useSocket } from \"@/components/common/RealtimeUpdates\";\n\nexport default function AdminDashboard() {\n  const { data: session } = useSession();\n  \n  // Use Zustand stores for realtime data\n  const { \n    adminStats,\n    loading: statsLoading,\n    fetchAdminStats \n  } = useStatsStore();\n  \n  const { \n    submissions,\n    loading: submissionsLoading,\n    fetchLatestSubmissions \n  } = useSubmissionStore();\n  \n  const { \n    pendingUsers,\n    loading: usersLoading,\n    fetchPendingUsers \n  } = useUserStore();\n  \n  // Initialize Socket.IO connection\n  useSocket();\n  \n  // Modal states\n  const [selectedVendor, setSelectedVendor] = useState<UserData | null>(null);\n  const [isVerificationModalOpen, setIsVerificationModalOpen] = useState(false);\n\n  // Alert state\n  const [alert, _setAlert] = useState<{\n    show: boolean;\n    variant: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n  }>({\n    show: false,\n    variant: 'info',\n    title: '',\n    message: ''\n  });\n\n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    isOpen: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n  }>({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: () => {}\n  });\n\n  useEffect(() => {\n    // Initialize data fetching\n    fetchAdminStats();\n    fetchLatestSubmissions();\n    fetchPendingUsers();\n  }, [fetchAdminStats, fetchLatestSubmissions, fetchPendingUsers]);\n\n  const handleOpenVerificationModal = (vendor: UserData) => {\n    setSelectedVendor(vendor);\n    setIsVerificationModalOpen(true);\n  };\n\n  const handleCloseVerificationModal = () => {\n    setIsVerificationModalOpen(false);\n    setSelectedVendor(null);\n  };\n\n  const handleUserUpdate = (_updatedUser: any) => {\n    // Refresh data after user update\n    fetchPendingUsers();\n    fetchAdminStats();\n  };\n\n  const handleUserRemove = (_userId: string) => {\n    // Refresh data after user removal\n    fetchPendingUsers();\n    fetchAdminStats();\n  };\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING': return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'APPROVED': return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED': return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default: return <Badge>{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Alert Notification */}\n      {alert.show && (\n        <div className=\"fixed top-4 right-4 z-50 max-w-md\">\n          <Alert\n            variant={alert.variant}\n            title={alert.title}\n            message={alert.message}\n          />\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n        <h1 className=\"text-2xl font-semibold text-gray-900\">\n          Selamat datang di dashboard admin, {session?.user.officer_name ?? session?.user.name ?? \"Admin\"}\n        </h1>\n        <p className=\"text-gray-600 mt-1\">\n          Kelola sistem dan monitor aktivitas pengguna\n        </p>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Vendor</p>\n              <p className=\"text-3xl font-bold text-gray-900 mt-2\">\n                {statsLoading ? '...' : adminStats?.totalVendors || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n              <UserGroupIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Menunggu Verifikasi Vendor</p>\n              <p className=\"text-3xl font-bold text-orange-600 mt-2\">\n                {statsLoading ? '...' : adminStats?.pendingVerificationVendors || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\n              <ClockIcon className=\"w-6 h-6 text-orange-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Menunggu Verifikasi Pengajuan SIMLOK</p>\n              <p className=\"text-3xl font-bold text-red-600 mt-2\">\n                {statsLoading ? '...' : adminStats?.pendingVerificationSubmissions || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center\">\n              <ClipboardDocumentCheckIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Tables Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Latest Submissions Table */}\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Pengajuan Terbaru</h3>\n            <Link href=\"/admin/submissions\" className=\"text-sm text-blue-600 hover:text-blue-500\">\n              Lihat Semua\n            </Link>\n          </div>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead>\n                <tr>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Vendor\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Pekerjaan\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Tanggal\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {submissionsLoading ? (\n                  <tr>\n                    <td colSpan={4} className=\"px-3 py-4 text-center text-gray-500\">\n                      Loading...\n                    </td>\n                  </tr>\n                ) : submissions.length === 0 ? (\n                  <tr>\n                    <td colSpan={4} className=\"px-3 py-4 text-center text-gray-500\">\n                      Belum ada pengajuan\n                    </td>\n                  </tr>\n                ) : (\n                  submissions.slice(0, 5).map((submission: any) => (\n                    <tr key={submission.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-3 py-4 text-sm text-gray-900\">\n                        {submission.vendor_name}\n                      </td>\n                      <td className=\"px-3 py-4 text-sm text-gray-600 truncate max-w-xs\">\n                        {submission.job_description}\n                      </td>\n                      <td className=\"px-3 py-4\">\n                        {getStatusBadge(submission.approval_status)}\n                      </td>\n                      <td className=\"px-3 py-4 text-sm text-gray-500\">\n                        {formatDate(submission.created_at)}\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n        </Card>\n\n        {/* Pending Vendors Table */}\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Vendor Yang Perlu Di Verifikasi</h3>\n            <Link href=\"/admin/users?filter=pending\" className=\"text-sm text-blue-600 hover:text-blue-500\">\n              Lihat Semua\n            </Link>\n          </div>\n          \n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead>\n                <tr>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Nama\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Email\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Tanggal Daftar\n                  </th>\n                  <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Aksi\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-200\">\n                {usersLoading ? (\n                  <tr>\n                    <td colSpan={4} className=\"px-3 py-4 text-center text-gray-500\">\n                      Loading...\n                    </td>\n                  </tr>\n                ) : pendingUsers.length === 0 ? (\n                  <tr>\n                    <td colSpan={4} className=\"px-3 py-4 text-center text-gray-500\">\n                      Tidak ada vendor yang perlu diverifikasi\n                    </td>\n                  </tr>\n                ) : (\n                  pendingUsers.slice(0, 5).map((vendor: any) => (\n                    <tr key={vendor.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-3 py-4\">\n                        <div>\n                          <div className=\"text-sm font-medium text-gray-900\">\n                            {vendor.officer_name}\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {vendor.vendor_name}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-4 text-sm text-gray-600\">\n                        {vendor.email}\n                      </td>\n                      <td className=\"px-3 py-4 text-sm text-gray-500\">\n                        {formatDate(vendor.created_at)}\n                      </td>\n                      <td className=\"px-3 py-4\">\n                        <div className=\"flex space-x-2\">\n                          <Button\n                            onClick={() => handleOpenVerificationModal(vendor)}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"!px-3 !py-1\"\n                          >\n                            <EyeIcon className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n        </Card>\n      </div>\n\n      {/* User Verification Modal */}\n      <UserVerificationModal\n        user={selectedVendor}\n        isOpen={isVerificationModalOpen}\n        onClose={handleCloseVerificationModal}\n        onUserUpdate={handleUserUpdate}\n        onUserRemove={handleUserRemove}\n      />\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.isOpen}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        onConfirm={confirmModal.onConfirm}\n        onClose={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))}\n      />\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/dashboard/DashboardMainContent.tsx",
      "lang": "tsx",
      "size": 5528,
      "lines": 142,
      "hash": "4371482bedbdc58bd7c518f1750497fc297706e35f2d2ef6ed219c4c98910960",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { PlusIcon, ChartPieIcon, ClockIcon, ArrowTrendingUpIcon } from \"@heroicons/react/24/outline\";\nimport Card from \"../ui/Card\";\nimport { SectionTitle } from \"../ui/SectionTitle\";\nimport { Stat } from \"../ui/Stat\";\nimport { ActivityList } from \"../ui/ActivityList\";\nimport PageHeader from \"../layout/PageHeader\";\n\nexport default function DashboardMainContent() {\n  const { data: session } = useSession();\n  const role = session?.user.role ?? \"VENDOR\";\n\n  const stats = [\n    { label: \"Products\", value: 42, icon: ChartPieIcon },\n    { label: \"Orders\", value: 128, icon: ClockIcon },\n    { label: \"Earnings\", value: \"$3,210\", icon: ArrowTrendingUpIcon },\n    { label: \"Pending\", value: \"$450\", icon: PlusIcon },\n  ];\n\n  const activities = [\n    { id: 1, txt: \"Order #1234 confirmed\", time: \"1 m ago\" },\n    { id: 2, txt: \"Charlie left review\", time: \"1 h ago\" },\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\n      {/* Debug info - remove in production */}\n      {/* {process.env.NODE_ENV === 'development' && (\n        <div className=\"lg:col-span-3 mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n          <h3 className=\"font-semibold text-yellow-800\">Debug Session Info:</h3>\n          <pre className=\"text-sm text-yellow-700 mt-2\">\n            {JSON.stringify({\n              userId: session?.user?.id,\n              nama_petugas: session?.user?.nama_petugas,\n              nama_vendor: session?.user?.nama_vendor,\n              role: session?.user?.role,\n              email: session?.user?.email,\n              isVerified: session?.user?.verified_at ? true : false,\n            }, null, 2)}\n          </pre>\n        </div>\n      )} */}\n      \n      {/* Main column */}\n      <div className=\"space-y-6 lg:col-span-2\">\n        {/* Header */}\n        <PageHeader\n          title={`Welcome back, ${session?.user.officer_name ?? session?.user.name ?? \"User\"}!`}\n          subtitle={\n            role === \"VENDOR\" && session?.user.vendor_name \n              ? `${session.user.vendor_name} - You are logged in as ${role.toLowerCase()}.`\n              : `You are logged in as ${role.toLowerCase()}.`\n          }\n          cta={\n            <div className=\"flex gap-2\">\n              {[\"Add Product\", \"View Orders\", \"Analytics\", \"Support\"].map((a) => (\n                <button\n                  key={a}\n                  className=\"rounded-full bg-white px-4 py-2 text-sm font-medium text-slate-800 shadow-sm transition hover:bg-slate-100 \"\n                >\n                  {a}\n                </button>\n              ))}\n            </div>\n          }\n        />\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-2 gap-4 md:grid-cols-4\">\n          {stats.map((s, i) => (\n            <Stat key={i} label={s.label} value={s.value} icon={s.icon as any} />\n          ))}\n        </div>\n\n        {/* Simple placeholder for chart */}\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle right={<ChartPieIcon className=\"h-5 w-5 text-slate-500\" />}>\n            Sales Trend\n          </SectionTitle>\n          <div className=\"mt-4 h-48 bg-gray-50 rounded-lg flex items-center justify-center\">\n            <div className=\"text-center\">\n              <ChartPieIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-2\" />\n              <p className=\"text-gray-500\">Chart will be displayed here</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Sidebar column */}\n      <div className=\"space-y-6\">\n        {/* Vendor Info - only show for VENDOR role */}\n        {role === \"VENDOR\" && (\n          <Card className=\"p-6 bg-white border border-slate-200\">\n            <SectionTitle>Informasi Vendor</SectionTitle>\n            <div className=\"space-y-3 mt-4\">\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Nama Vendor</span>\n                <p className=\"text-sm text-gray-900 font-semibold\">\n                  {session?.user.vendor_name || \"Belum diisi\"}\n                </p>\n              </div>\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Nama Petugas</span>\n                <p className=\"text-sm text-gray-900\">\n                  {session?.user.officer_name || session?.user.name || \"Belum diisi\"}\n                </p>\n              </div>\n              <div>\n                <span className=\"text-sm font-medium text-gray-500\">Email</span>\n                <p className=\"text-sm text-gray-900\">\n                  {session?.user.email || \"Belum diisi\"}\n                </p>\n              </div>\n            </div>\n          </Card>\n        )}\n\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle>Recent Activity</SectionTitle>\n          <ActivityList items={activities} />\n        </Card>\n\n        <Card className=\"p-6 bg-white border border-slate-200\">\n          <SectionTitle>Quick Stats</SectionTitle>\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-slate-700\">Conversion</span>\n              <span className=\"font-bold text-slate-900\">12%</span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-slate-700\">Avg. Order</span>\n              <span className=\"font-bold text-slate-900\">$89</span>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/dashboard/VendorDashboard.tsx",
      "lang": "tsx",
      "size": 16610,
      "lines": 479,
      "hash": "8ad043091c67f7dba7df20707e3c25a0edabef2aa42f5e1317b241a54dcc5129",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { \n  ClockIcon,\n  PlusIcon,\n  CheckCircleIcon,\n  XCircleIcon\n} from \"@heroicons/react/24/outline\";\nimport Card from \"../ui/Card\";\nimport { Badge } from \"../ui/Badge\";\nimport Button from \"../ui/button/Button\";\nimport Alert from \"../ui/alert/Alert\";\nimport ConfirmModal from \"../ui/modal/ConfirmModal\";\nimport SubmissionDetailModal from \"../vendor/SubmissionDetailModal\";\nimport { useStatsStore } from \"@/store/useStatsStore\";\nimport { useSubmissionStore } from \"@/store/useSubmissionStore\";\nimport { useSocket } from \"@/components/common/RealtimeUpdates\";\n\ninterface VendorSubmission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\nexport default function VendorDashboard() {\n  const { data: session } = useSession();\n  \n  // Use Zustand stores for realtime data\n  const { \n    vendorStats,\n    loading: statsLoading,\n    fetchVendorStats \n  } = useStatsStore();\n  \n  const { \n    submissions,\n    loading: submissionsLoading,\n    fetchVendorSubmissions \n  } = useSubmissionStore();\n  \n  // Initialize Socket.IO connection\n  useSocket();\n\n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<VendorSubmission | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  // Alert state\n  const [alert, setAlert] = useState<{\n    show: boolean;\n    variant: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n  }>({\n    show: false,\n    variant: 'info',\n    title: '',\n    message: ''\n  });\n\n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    show: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n    isLoading: boolean;\n  }>({\n    show: false,\n    title: '',\n    message: '',\n    onConfirm: () => {},\n    isLoading: false\n  });\n\n  useEffect(() => {\n    // Initialize data fetching\n    if (session?.user?.id) {\n      fetchVendorStats();\n      fetchVendorSubmissions();\n    }\n  }, [session?.user?.id, fetchVendorStats, fetchVendorSubmissions]);\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'short',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING': return <Badge variant=\"warning\">Menunggu</Badge>;\n      case 'APPROVED': return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED': return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default: return <Badge>{status}</Badge>;\n    }\n  };\n\n  const handleDelete = useCallback((id: string) => {\n    setConfirmModal({\n      show: true,\n      title: 'Konfirmasi Hapus',\n      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',\n      onConfirm: () => performDelete(id),\n      isLoading: false\n    });\n  }, []);\n\n  const performDelete = async (id: string) => {\n    try {\n      setConfirmModal(prev => ({ ...prev, isLoading: true }));\n\n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal menghapus pengajuan');\n      }\n\n      // Close confirm modal\n      setConfirmModal(prev => ({ ...prev, show: false, isLoading: false }));\n\n      // Refresh data setelah berhasil menghapus\n      await fetchVendorSubmissions();\n      await fetchVendorStats();\n      \n      // Show success message\n      setAlert({\n        show: true,\n        variant: 'success',\n        title: 'Berhasil!',\n        message: 'Pengajuan berhasil dihapus'\n      });\n      \n      // Auto hide after 3 seconds\n      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 3000);\n    } catch (error) {\n      setConfirmModal(prev => ({ ...prev, isLoading: false }));\n      \n      console.error('Error deleting submission:', error);\n      setAlert({\n        show: true,\n        variant: 'error',\n        title: 'Gagal Menghapus',\n        message: error instanceof Error ? error.message : 'Gagal menghapus pengajuan'\n      });\n      \n      // Auto hide after 5 seconds\n      setTimeout(() => setAlert(prev => ({ ...prev, show: false })), 5000);\n    }\n  };\n\n  const handleViewDetail = useCallback(async (submission: VendorSubmission) => {\n    try {\n      // Fetch full submission data from API\n      const response = await fetch(`/api/submissions/${submission.id}`);\n      if (response.ok) {\n        const fullSubmissionData = await response.json();\n        setSelectedSubmission(fullSubmissionData);\n        setIsModalOpen(true);\n      } else {\n        console.error('Failed to fetch submission details');\n        setAlert({\n          show: true,\n          variant: 'error',\n          title: 'Error',\n          message: 'Gagal memuat detail pengajuan'\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching submission details:', error);\n      setAlert({\n        show: true,\n        variant: 'error',\n        title: 'Error',\n        message: 'Terjadi kesalahan saat memuat detail pengajuan'\n      });\n    }\n  }, []);\n\n  const handleCloseModal = useCallback(() => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  }, []);\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Alert Notification */}\n      {alert.show && (\n        <div className=\"fixed top-4 right-4 z-50 max-w-md\">\n          <Alert\n            variant={alert.variant}\n            title={alert.title}\n            message={alert.message}\n          />\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"bg-white rounded-xl border border-gray-200 p-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-semibold text-gray-900\">\n              Selamat datang di dashboard vendor, {session?.user.officer_name ?? session?.user.name ?? \"Vendor\"}\n            </h1>\n            <p className=\"text-gray-600 mt-1\">\n              {session?.user.vendor_name && `${session.user.vendor_name} - `}\n              Kelola pengajuan SIMLOK Anda\n            </p>\n          </div>\n          <div className=\"mt-4 sm:mt-0\">\n            <Link href=\"/vendor/submissions/create\">\n              <Button variant=\"primary\" size=\"md\">\n                <PlusIcon className=\"w-5 h-5 mr-2\" />\n                Buat pengajuan\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Disetujui</p>\n              <p className=\"text-3xl font-bold text-green-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalApproved || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Menunggu</p>\n              <p className=\"text-3xl font-bold text-orange-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalPending || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\n              <ClockIcon className=\"w-6 h-6 text-orange-600\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600\">Total Ditolak</p>\n              <p className=\"text-3xl font-bold text-red-600 mt-2\">\n                {statsLoading ? '...' : vendorStats?.totalRejected || 0}\n              </p>\n            </div>\n            <div className=\"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center\">\n              <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Recent Submissions Table */}\n      <Card className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">Pengajuan Terbaru</h3>\n          <Link href=\"/vendor/submissions\" className=\"text-sm text-blue-600 hover:text-blue-500\">\n            Lihat Semua\n          </Link>\n        </div>\n        \n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead>\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Pekerjaan\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Lokasi Kerja\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  No. SIMLOK\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Tanggal\n                </th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {submissionsLoading ? (\n                <tr>\n                  <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\n                    <div className=\"flex items-center justify-center\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\n                      <span className=\"ml-2\">Loading...</span>\n                    </div>\n                  </td>\n                </tr>\n              ) : submissions.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\n                    <div className=\"text-center\">\n                      <ClockIcon className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                      <h3 className=\"text-sm font-medium text-gray-900\">Belum ada pengajuan</h3>\n                      <p className=\"text-sm text-gray-500 mt-1\">\n                        Mulai dengan membuat pengajuan SIMLOK pertama Anda\n                      </p>\n                      <Link href=\"/vendor/submissions/create\" className=\"mt-4 inline-block\">\n                        <Button variant=\"primary\" size=\"sm\">\n                          <PlusIcon className=\"w-4 h-4 mr-2\" />\n                          Buat Pengajuan Pertama\n                        </Button>\n                      </Link>\n                    </div>\n                  </td>\n                </tr>\n              ) : (\n                submissions.slice(0, 5).map((submission: any) => (\n                  <tr key={submission.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-4 text-sm text-gray-900\">\n                      <div className=\"max-w-xs truncate\" title={submission.job_description}>\n                        {submission.job_description}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-600\">\n                      <div className=\"max-w-xs truncate\" title={submission.work_location}>\n                        {submission.work_location}\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-4\">\n                      {getStatusBadge(submission.approval_status)}\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-600\">\n                      {submission.simlok_number || '-'}\n                    </td>\n                    <td className=\"px-4 py-4 text-sm text-gray-500\">\n                      {formatDate(submission.created_at)}\n                    </td>\n                    <td className=\"px-4 py-4\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          onClick={() => handleViewDetail(submission)}\n                          variant=\"info\"\n                          size=\"sm\"\n                          title=\"Lihat Detail\"\n                        >\n                          Lihat\n                        </Button>\n                        {submission.approval_status === 'PENDING' && (\n                          <>\n                            <Link href={`/vendor/submissions/edit/${submission.id}`}>\n                              <Button\n                                variant=\"warning\"\n                                size=\"sm\"\n                                title=\"Ubah Pengajuan\"\n                                className=\"mr-2\"\n                              >\n                                Ubah\n                              </Button>\n                            </Link>\n                            <Button\n                              onClick={() => handleDelete(submission.id)}\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              title=\"Hapus Pengajuan\"\n                            >\n                              Hapus\n                            </Button>\n                          </>\n                        )}\n                        {submission.approval_status !== 'PENDING' && (\n                          <span className=\"text-gray-400 text-xs\">Tidak dapat diubah</span>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Quick Actions Footer */}\n        {/* {!loading && submissions.length > 0 && (\n          <div className=\"mt-6 pt-4 border-t border-gray-200\">\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Link href=\"/vendor/submissions/create\">\n                <Button variant=\"primary\" size=\"sm\" className=\"w-full sm:w-auto\">\n                  <PlusIcon className=\"w-4 h-4 mr-2\" />\n                  Buat Pengajuan Baru\n                </Button>\n              </Link>\n              <Link href=\"/vendor/submissions\">\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full sm:w-auto\">\n                  Kelola Semua Pengajuan\n                </Button>\n              </Link>\n            </div>\n          </div>\n        )} */}\n      </Card>\n\n      {/* Modal Detail */}\n      {selectedSubmission && (\n        <SubmissionDetailModal\n          submission={selectedSubmission}\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n        />\n      )}\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.show}\n        onClose={() => setConfirmModal(prev => ({ ...prev, show: false }))}\n        onConfirm={confirmModal.onConfirm}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        variant=\"danger\"\n        confirmText=\"Hapus\"\n        cancelText=\"Batal\"\n        isLoading={confirmModal.isLoading}\n      />\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/dashboard/VerifierDashboard.tsx",
      "lang": "tsx",
      "size": 3749,
      "lines": 100,
      "hash": "3a8615f88daff0cc47c80b82bacc9b95fb24428cb4dadb915b91718cb89264a5",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useRef } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { CameraIcon } from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\nimport ScanHistory from '../scanner/ScanHistory';\n\nexport default function VerifierDashboard() {\n  const { data: session } = useSession();\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"py-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">\n                  Dashboard Verifier\n                </h1>\n                <p className=\"mt-2 text-gray-600\">\n                  Selamat datang, {session?.user?.officer_name}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Quick Scan Actions */}\n        <div className=\"mb-8\">\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-semibold text-gray-900 mb-4\">\n                Barcode & QR Code Scanner\n              </h2>\n              <p className=\"text-gray-600 mb-6\">\n                Scan barcode atau QR code SIMLOK untuk verifikasi. Scanner mendukung berbagai format: QR Code, Code 128, Code 39, EAN, UPC. Pastikan browser mengizinkan akses kamera.\n              </p>\n              \n              <div className=\"flex justify-center space-x-4\">\n                <Button\n                  onClick={() => {\n                    console.log('Opening barcode scanner from verifier dashboard');\n                    // Close any open detail modals from scan history\n                    if (scanHistoryRef.current?.closeDetailModal) {\n                      scanHistoryRef.current.closeDetailModal();\n                    }\n                    setScannerOpen(true);\n                  }}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                  size=\"lg\"\n                >\n                  <CameraIcon className=\"w-6 h-6 mr-2\" />\n                  Mulai Scan Barcode/QR Code\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Scan History */}\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n              Riwayat Scan Barcode & QR Code\n            </h3>\n          </div>\n          <ScanHistory \n            ref={scanHistoryRef}\n            className=\"border-0 shadow-none bg-transparent\" \n          />\n        </div>\n      </div>\n\n      {/* Barcode & QR Code Scanner Modal */}\n      <CameraQRScanner\n        isOpen={scannerOpen}\n        onClose={() => {\n          console.log('Closing barcode scanner from verifier dashboard');\n          setScannerOpen(false);\n        }}\n        onScan={(result: string) => {\n          console.log('Barcode/QR Scanned in verifier:', result);\n          // Scanner will handle the verification automatically\n          // Just close the scanner after successful scan\n          setScannerOpen(false);\n        }}\n        title=\"Scan Barcode/QR Code SIMLOK\"\n        description=\"Arahkan kamera ke barcode atau QR code SIMLOK untuk memverifikasi\"\n      />\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/files/FileManager.tsx",
      "lang": "tsx",
      "size": 10311,
      "lines": 325,
      "hash": "f1428819616a52d59abc928fc49c74451a5caa9152fc43d5022f930f58a8bb42",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  FolderIcon, \n  DocumentIcon, \n  PhotoIcon, \n  PencilIcon, \n  TrashIcon,\n  ArrowPathIcon,\n  EyeIcon\n} from '@heroicons/react/24/outline';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\nimport Button from '@/components/ui/button/Button';\nimport Card from '@/components/ui/Card';\n\ninterface FileInfo {\n  originalName: string;\n  newName: string;\n  path: string;\n  url: string;\n  size: number;\n  type: string;\n  category: 'sika' | 'simja' | 'id_card' | 'other';\n}\n\ninterface FilesByCategory {\n  sika: FileInfo[];\n  simja: FileInfo[];\n  id_card: FileInfo[];\n  other: FileInfo[];\n}\n\nexport default function FileManager() {\n  const [files, setFiles] = useState<FilesByCategory>({\n    sika: [],\n    simja: [],\n    id_card: [],\n    other: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [renaming, setRenaming] = useState<string | null>(null);\n  const [newName, setNewName] = useState('');\n  const [migrating, setMigrating] = useState(false);\n\n  const [previewModal, setPreviewModal] = useState<{\n    isOpen: boolean;\n    fileUrl: string;\n    fileName: string;\n  }>({\n    isOpen: false,\n    fileUrl: '',\n    fileName: ''\n  });\n\n  const categoryNames = {\n    sika: 'Dokumen SIKA',\n    simja: 'Dokumen SIMJA', \n    id_card: 'ID Card',\n    other: 'Lainnya'\n  };\n\n  const handleClosePreview = () => {\n    setPreviewModal({\n      isOpen: false,\n      fileUrl: '',\n      fileName: ''\n    });\n  };\n\n  const categoryIcons = {\n    sika: <DocumentIcon className=\"h-6 w-6 text-blue-500\" />,\n    simja: <DocumentIcon className=\"h-6 w-6 text-green-500\" />,\n    id_card: <PhotoIcon className=\"h-6 w-6 text-purple-500\" />,\n    other: <FolderIcon className=\"h-6 w-6 text-gray-500\" />\n  };\n\n  useEffect(() => {\n    loadFiles();\n  }, []);\n\n  const loadFiles = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/files/manage');\n      const data = await response.json();\n      \n      if (data.success) {\n        setFiles(data.files);\n      }\n    } catch (error) {\n      console.error('Error loading files:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRename = async (oldFileName: string, category: string) => {\n    if (!newName.trim()) return;\n\n    try {\n      const response = await fetch('/api/files/manage', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          action: 'rename',\n          oldFileName,\n          newName: newName.trim(),\n          category\n        })\n      });\n\n      const data = await response.json();\n      \n      if (data.success) {\n        await loadFiles(); // Reload files\n        setRenaming(null);\n        setNewName('');\n      } else {\n        alert(data.error || 'Failed to rename file');\n      }\n    } catch (error) {\n      console.error('Error renaming file:', error);\n      alert('Error renaming file');\n    }\n  };\n\n  const handleDelete = async (fileName: string) => {\n    if (!confirm('Are you sure you want to delete this file?')) return;\n\n    try {\n      const response = await fetch(`/api/files/manage?fileName=${encodeURIComponent(fileName)}`, {\n        method: 'DELETE'\n      });\n\n      const data = await response.json();\n      \n      if (data.success) {\n        await loadFiles(); // Reload files\n      } else {\n        alert(data.error || 'Failed to delete file');\n      }\n    } catch (error) {\n      console.error('Error deleting file:', error);\n      alert('Error deleting file');\n    }\n  };\n\n  const handleMigrate = async () => {\n    if (!confirm('This will organize your existing files into folders. Continue?')) return;\n\n    try {\n      setMigrating(true);\n      const response = await fetch('/api/files/manage', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ action: 'migrate' })\n      });\n\n      const data = await response.json();\n      \n      if (data.success) {\n        alert(`Migration completed! ${data.migrated} files moved.${data.errors.length > 0 ? ` ${data.errors.length} errors occurred.` : ''}`);\n        await loadFiles(); // Reload files\n      } else {\n        alert(data.error || 'Migration failed');\n      }\n    } catch (error) {\n      console.error('Error migrating files:', error);\n      alert('Error migrating files');\n    } finally {\n      setMigrating(false);\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const getFileIcon = (type: string) => {\n    if (type.startsWith('image/')) {\n      return <PhotoIcon className=\"h-5 w-5 text-blue-500\" />;\n    }\n    return <DocumentIcon className=\"h-5 w-5 text-gray-500\" />;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center py-8\">\n        <ArrowPathIcon className=\"h-8 w-8 animate-spin text-blue-500\" />\n        <span className=\"ml-2\">Loading files...</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">File Manager</h2>\n        <Button\n          onClick={handleMigrate}\n          disabled={migrating}\n          variant=\"outline\"\n          className=\"flex items-center space-x-2\"\n        >\n          <ArrowPathIcon className={`h-4 w-4 ${migrating ? 'animate-spin' : ''}`} />\n          <span>{migrating ? 'Migrating...' : 'Organize Files'}</span>\n        </Button>\n      </div>\n\n      {Object.entries(files).map(([category, categoryFiles]) => (\n        <Card key={category} className=\"p-6\">\n          <div className=\"flex items-center space-x-3 mb-4\">\n            {categoryIcons[category as keyof typeof categoryIcons]}\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              {categoryNames[category as keyof typeof categoryNames]}\n            </h3>\n            <span className=\"text-sm text-gray-500\">\n              ({categoryFiles.length} files)\n            </span>\n          </div>\n\n          {categoryFiles.length === 0 ? (\n            <p className=\"text-gray-500 italic\">No files in this category</p>\n          ) : (\n            <div className=\"space-y-2\">\n              {categoryFiles.map((file: FileInfo) => (\n                <div\n                  key={file.newName}\n                  className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100\"\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    {getFileIcon(file.type)}\n                    <div>\n                      {renaming === file.newName ? (\n                        <div className=\"flex items-center space-x-2\">\n                          <input\n                            type=\"text\"\n                            value={newName}\n                            onChange={(e) => setNewName(e.target.value)}\n                            className=\"px-2 py-1 border border-gray-300 rounded text-sm\"\n                            placeholder=\"New name\"\n                            autoFocus\n                          />\n                          <button\n                            onClick={() => handleRename(file.newName, category)}\n                            className=\"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700\"\n                          >\n                            Save\n                          </button>\n                          <button\n                            onClick={() => {\n                              setRenaming(null);\n                              setNewName('');\n                            }}\n                            className=\"px-2 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600\"\n                          >\n                            Cancel\n                          </button>\n                        </div>\n                      ) : (\n                        <>\n                          <div className=\"font-medium text-gray-900\">\n                            {file.originalName}\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {formatFileSize(file.size)} • {file.newName}\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center space-x-2\">\n                    <button\n                      onClick={() => setPreviewModal({\n                        isOpen: true,\n                        fileUrl: file.url,\n                        fileName: file.originalName\n                      })}\n                      className=\"p-2 text-gray-400 hover:text-blue-600 rounded-full hover:bg-blue-50\"\n                      title=\"Preview\"\n                    >\n                      <EyeIcon className=\"h-4 w-4\" />\n                    </button>\n                    \n                    <button\n                      onClick={() => {\n                        setRenaming(file.newName);\n                        setNewName(file.originalName.replace(/\\.[^/.]+$/, '')); // Remove extension\n                      }}\n                      className=\"p-2 text-gray-400 hover:text-yellow-600 rounded-full hover:bg-yellow-50\"\n                      title=\"Rename\"\n                    >\n                      <PencilIcon className=\"h-4 w-4\" />\n                    </button>\n                    \n                    <button\n                      onClick={() => handleDelete(file.newName)}\n                      className=\"p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50\"\n                      title=\"Delete\"\n                    >\n                      <TrashIcon className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </Card>\n      ))}\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={previewModal.isOpen}\n        onClose={handleClosePreview}\n        fileUrl={previewModal.fileUrl}\n        fileName={previewModal.fileName}\n      />\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/form/Checkbox.tsx",
      "lang": "tsx",
      "size": 835,
      "lines": 25,
      "hash": "c08d24507b27825a10f9c2690a7b436ce8c2d1a4d021a181ba867a70ff648079",
      "truncated": false,
      "content": "import React from \"react\";\n\ninterface CheckboxProps {\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  label?: string;\n  className?: string;\n  disabled?: boolean;\n}\n\nexport default function Checkbox({ checked, onChange, label, className = \"\", disabled = false }: CheckboxProps) {\n  return (\n    <label className={`flex items-center ${disabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'} ${className}`}>\n      <input\n        type=\"checkbox\"\n        checked={checked}\n        onChange={(e) => onChange(e.target.checked)}\n        disabled={disabled}\n        className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n      />\n      {label && <span className=\"ml-2 text-sm text-gray-700\">{label}</span>}\n    </label>\n  );\n}\n"
    },
    {
      "path": "src/components/form/DatePicker.tsx",
      "lang": "tsx",
      "size": 5901,
      "lines": 209,
      "hash": "a7db648266677f4465bdd494718b240c429979e8f72b0eedddc75c4ad4bc803d",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback, forwardRef } from 'react';\nimport { CalendarIcon } from '@heroicons/react/24/outline';\n\ninterface DatePickerProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  required?: boolean;\n  disabled?: boolean;\n  showTimeSelect?: boolean;\n  timeIntervals?: number;\n  dateFormat?: string;\n  className?: string;\n}\n\n// Safe React DatePicker component with fallback\nfunction SafeReactDatePicker({\n  id,\n  name,\n  value,\n  onChange,\n  placeholder = \"Pilih tanggal\",\n  required = false,\n  disabled = false,\n  className\n}: DatePickerProps) {\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [hasError, setHasError] = useState(false);\n\n  // Update selectedDate when value prop changes\n  useEffect(() => {\n    try {\n      if (value) {\n        const [year, month, day] = value.split('-').map(Number);\n        if (year && month && day && !isNaN(year) && !isNaN(month) && !isNaN(day)) {\n          setSelectedDate(new Date(year, month - 1, day));\n        }\n      } else {\n        setSelectedDate(null);\n      }\n    } catch (error) {\n      console.warn('DatePicker: Error parsing date value:', error);\n      setHasError(true);\n    }\n  }, [value]);\n\n  const handleDateChange = useCallback((date: Date | null) => {\n    try {\n      setSelectedDate(date);\n      if (onChange) {\n        if (date) {\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          const localDateString = `${year}-${month}-${day}`;\n          onChange(localDateString);\n        } else {\n          onChange('');\n        }\n      }\n    } catch (error) {\n      console.warn('DatePicker: Error handling date change:', error);\n      setHasError(true);\n    }\n  }, [onChange]);\n\n  // Custom input component\n  const CustomInput = forwardRef<HTMLInputElement, any>(({ value, onClick, placeholder, disabled, className }, ref) => (\n    <div className=\"relative\">\n      <input\n        ref={ref}\n        value={value}\n        onClick={onClick}\n        placeholder={placeholder}\n        readOnly\n        disabled={disabled}\n        className={`w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${\n          disabled ? 'bg-gray-50 cursor-not-allowed' : 'cursor-pointer'\n        } ${className || ''}`}\n      />\n      <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n    </div>\n  ));\n\n  CustomInput.displayName = 'CustomInput';\n\n  // Use native input if React DatePicker fails\n  if (hasError) {\n    return (\n      <NativeDateInput\n        id={id}\n        name={name}\n        value={value}\n        onChange={onChange}\n        placeholder={placeholder}\n        required={required}\n        disabled={disabled}\n        className={className}\n      />\n    );\n  }\n\n  try {\n    const ReactDatePicker = require('react-datepicker');\n    require('react-datepicker/dist/react-datepicker.css');\n\n    return (\n      <ReactDatePicker.default\n        id={id}\n        name={name}\n        selected={selectedDate}\n        onChange={handleDateChange}\n        dateFormat=\"dd/MM/yyyy\"\n        placeholderText={placeholder}\n        disabled={disabled}\n        required={required}\n        customInput={<CustomInput className={className} />}\n        popperClassName=\"react-datepicker-popper\"\n        calendarClassName=\"react-datepicker-calendar\"\n        showPopperArrow={false}\n        popperPlacement=\"bottom-start\"\n        withPortal={false}\n      />\n    );\n  } catch (error) {\n    console.warn('DatePicker: Failed to load react-datepicker, using native input:', error);\n    return (\n      <NativeDateInput\n        id={id}\n        name={name}\n        value={value}\n        onChange={onChange}\n        placeholder={placeholder}\n        required={required}\n        disabled={disabled}\n        className={className}\n      />\n    );\n  }\n}\n\n// Native HTML date input fallback\nfunction NativeDateInput({\n  id,\n  name,\n  value,\n  onChange,\n  placeholder = \"Pilih tanggal\",\n  required = false,\n  disabled = false,\n  className\n}: DatePickerProps) {\n  const [inputValue, setInputValue] = useState<string>('');\n\n  // Update input value when prop changes\n  useEffect(() => {\n    if (value) {\n      setInputValue(value);\n    } else {\n      setInputValue('');\n    }\n  }, [value]);\n\n  const handleInputChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = event.target.value;\n    setInputValue(newValue);\n    \n    if (onChange) {\n      onChange(newValue);\n    }\n  }, [onChange]);\n\n  return (\n    <div className=\"relative\">\n      <input\n        id={id}\n        name={name}\n        type=\"date\"\n        value={inputValue}\n        onChange={handleInputChange}\n        placeholder={placeholder}\n        required={required}\n        disabled={disabled}\n        className={`w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${\n          disabled ? 'bg-gray-50 cursor-not-allowed' : 'cursor-pointer'\n        } ${className || ''}`}\n      />\n      <CalendarIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n    </div>\n  );\n}\n\n// Main DatePicker component with feature detection\nexport default function DatePicker(props: DatePickerProps) {\n  // Prefer react-datepicker if available and stable, otherwise use native input\n  const useReactDatePicker = typeof window !== 'undefined' && \n                           !navigator.userAgent.includes('TestRunner');\n\n  if (useReactDatePicker) {\n    return <SafeReactDatePicker {...props} />;\n  }\n\n  return <NativeDateInput {...props} />;\n}\n"
    },
    {
      "path": "src/components/form/FileUpload.tsx",
      "lang": "tsx",
      "size": 8030,
      "lines": 294,
      "hash": "1aebfe06ccbc30fdb3ea3520c6a23b6be1cb8024ce866c1904ee7226f3b5631b",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useRef } from 'react';\nimport { DocumentIcon, XMarkIcon, CloudArrowUpIcon } from '@heroicons/react/24/outline';\n\ninterface FileUploadProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (url: string) => void;\n  onFileChange?: (file: File | null) => void;\n  accept?: string;\n  multiple?: boolean;\n  maxSize?: number; // in MB - default is now 8MB\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n  label?: string;\n  description?: string;\n}\n\nexport default function FileUpload({\n  id,\n  name,\n  value,\n  onChange,\n  onFileChange,\n  accept = \".pdf,.doc,.docx,.jpg,.jpeg,.png\",\n  multiple = false,\n  maxSize = 8, // 8MB default\n  required = false,\n  disabled = false,\n  className,\n  label,\n  description\n}: FileUploadProps) {\n  const [dragActive, setDragActive] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const validateFileInput = (file: File): string | null => {\n    // Check file size first\n    if (file.size > maxSize * 1024 * 1024) {\n      return `Ukuran file terlalu besar. Maksimal ${maxSize}MB`;\n    }\n\n    // Check file type based on accept prop\n    const acceptedTypes = accept.split(',').map(type => type.trim());\n    const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n    \n    const isValidType = acceptedTypes.some(type => {\n      if (type.startsWith('.')) {\n        return type === fileExtension;\n      }\n      return file.type.match(type);\n    });\n\n    if (!isValidType) {\n      return `Tipe file tidak didukung. Tipe yang diizinkan: ${accept}`;\n    }\n\n    return null;\n  };\n\n  const uploadFile = async (file: File): Promise<string> => {\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    // Add field name to help categorize the file\n    if (name) {\n      formData.append('fieldName', name);\n    }\n\n    const response = await fetch('/api/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Upload failed');\n    }\n\n    const data = await response.json();\n    return data.url;\n  };\n\n  const handleFileSelect = async (files: FileList | null) => {\n    if (!files || files.length === 0) return;\n\n    const file = files[0];\n    if (!file) return;\n    \n    setError(null);\n\n    // Validate file\n    const validationError = validateFileInput(file);\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    try {\n      setUploading(true);\n      setUploadProgress(0);\n\n      // Simulate progress for better UX\n      const progressInterval = setInterval(() => {\n        setUploadProgress(prev => Math.min(prev + 10, 90));\n      }, 100);\n\n      const fileUrl = await uploadFile(file);\n      \n      clearInterval(progressInterval);\n      setUploadProgress(100);\n\n      // Notify parent components\n      if (onChange) {\n        onChange(fileUrl);\n      }\n      if (onFileChange) {\n        onFileChange(file);\n      }\n\n      setTimeout(() => {\n        setUploading(false);\n        setUploadProgress(0);\n      }, 500);\n\n    } catch (error) {\n      setError(error instanceof Error ? error.message : 'Upload failed');\n      setUploading(false);\n      setUploadProgress(0);\n    }\n  };\n\n  const handleDragEnter = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (disabled) return;\n\n    const files = e.dataTransfer.files;\n    handleFileSelect(files);\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    handleFileSelect(e.target.files);\n  };\n\n  const handleClick = () => {\n    if (disabled) return;\n    fileInputRef.current?.click();\n  };\n\n  const removeFile = () => {\n    if (onChange) {\n      onChange('');\n    }\n    if (onFileChange) {\n      onFileChange(null);\n    }\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    setError(null);\n  };\n\n  const getFileName = () => {\n    if (value) {\n      return value.split('/').pop() || 'Uploaded file';\n    }\n    return null;\n  };\n\n  return (\n    <div className={`space-y-2 ${className || ''}`}>\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700\">\n          {label}\n          {required && <span className=\"text-red-500 ml-1\">*</span>}\n        </label>\n      )}\n\n      {description && (\n        <p className=\"text-sm text-gray-500\">{description}</p>\n      )}\n\n      <div\n        className={`relative border-2 border-dashed rounded-lg p-6 transition-colors ${\n          dragActive \n            ? 'border-blue-400 bg-blue-50' \n            : disabled \n            ? 'border-gray-200 bg-gray-50' \n            : 'border-gray-300 hover:border-gray-400'\n        } ${\n          !disabled ? 'cursor-pointer' : 'cursor-not-allowed'\n        }`}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        onClick={handleClick}\n      >\n        <input\n          ref={fileInputRef}\n          id={id}\n          name={name}\n          type=\"file\"\n          accept={accept}\n          multiple={multiple}\n          required={required}\n          disabled={disabled}\n          onChange={handleInputChange}\n          className=\"hidden\"\n        />\n\n        {uploading ? (\n          <div className=\"text-center\">\n            <CloudArrowUpIcon className=\"mx-auto h-12 w-12 text-blue-500 animate-pulse\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">Uploading...</div>\n              <div className=\"mt-2 w-full bg-gray-200 rounded-full h-2\">\n                <div \n                  className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                  style={{ width: `${uploadProgress}%` }}\n                />\n              </div>\n              <div className=\"text-xs text-gray-500 mt-1\">{uploadProgress}%</div>\n            </div>\n          </div>\n        ) : value ? (\n          <div className=\"text-center\">\n            <DocumentIcon className=\"mx-auto h-12 w-12 text-green-500\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">{getFileName()}</div>\n              <div className=\"text-xs text-gray-500 mt-1\">File uploaded successfully</div>\n              <button\n                type=\"button\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  removeFile();\n                }}\n                className=\"mt-2 inline-flex items-center px-3 py-1 text-xs font-medium text-red-600 bg-red-50 rounded-md hover:bg-red-100\"\n              >\n                <XMarkIcon className=\"h-4 w-4 mr-1\" />\n                Remove\n              </button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"text-center\">\n            <CloudArrowUpIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <div className=\"mt-4\">\n              <div className=\"text-sm font-medium text-gray-900\">\n                {dragActive ? 'Drop file here' : 'Click to upload or drag and drop'}\n              </div>\n              <div className=\"text-xs text-gray-500 mt-1\">\n                {accept} up to {maxSize}MB\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {error && (\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-200 rounded-md p-2\">\n          {error}\n        </div>\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/form/Input.tsx",
      "lang": "tsx",
      "size": 413,
      "lines": 15,
      "hash": "071a23e0d19e6b25921e872f4264e5ec95f6028215f13c3064ea7cd24c5ff0a0",
      "truncated": false,
      "content": "import React from \"react\";\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  className?: string;\n}\n\nexport default function Input({ className = \"\", ...props }: InputProps) {\n  return (\n    <input\n      className={`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 ${className}`}\n      {...props}\n    />\n  );\n}\n"
    },
    {
      "path": "src/components/form/Label.tsx",
      "lang": "tsx",
      "size": 595,
      "lines": 28,
      "hash": "9fc245318d16f84f3df3b8a2a1db329527eea781b563c4c1af66ca07f733f001",
      "truncated": false,
      "content": "import React, { FC, ReactNode } from \"react\";\nimport { twMerge } from \"tailwind-merge\";\n\ninterface LabelProps {\n  htmlFor?: string;\n  children: ReactNode;\n  className?: string;\n}\n\nconst Label: FC<LabelProps> = ({ htmlFor, children, className }) => {\n  return (\n    <label\n      htmlFor={htmlFor}\n      className={twMerge(\n        // Default classes that apply by default\n        \"mb-1.5 block text-sm font-medium text-gray-700\",\n\n        // User-defined className that can override the default margin\n        className\n      )}\n    >\n      {children}\n    </label>\n  );\n};\n\nexport default Label;\n"
    },
    {
      "path": "src/components/form/TimePicker.tsx",
      "lang": "tsx",
      "size": 10897,
      "lines": 308,
      "hash": "0525ea4023ba22319ff555f6a7e8adadbe539c1aa935afeb92fcd08d3b601e2f",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { ClockIcon, ChevronDownIcon } from '@heroicons/react/24/outline';\n\ninterface TimePickerProps {\n  id?: string;\n  name?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  required?: boolean;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport default function TimePicker({\n  id,\n  name,\n  value,\n  onChange,\n  placeholder = \"Pilih waktu\",\n  required = false,\n  disabled = false,\n  className\n}: TimePickerProps) {\n  const [startTime, setStartTime] = useState('');\n  const [endTime, setEndTime] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [timeError, setTimeError] = useState('');\n\n  // Generate time options (00:00 to 23:30 with 30 min intervals)\n  const generateTimeOptions = () => {\n    const times = [];\n    for (let hour = 0; hour < 24; hour++) {\n      for (let minute = 0; minute < 60; minute += 30) {\n        const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n        times.push(timeString);\n      }\n    }\n    return times;\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Generate filtered end time options (only times >= startTime)\n  const getEndTimeOptions = () => {\n    if (!startTime) return timeOptions;\n    \n    return timeOptions.filter(time => compareTime(time, startTime));\n  };\n\n  // Function to compare times (returns true if time1 >= time2)\n  const compareTime = (time1: string, time2: string) => {\n    if (!time1 || !time2) return true;\n    \n    const time1Parts = time1.split(':').map(Number);\n    const time2Parts = time2.split(':').map(Number);\n    \n    const [hours1, minutes1] = time1Parts;\n    const [hours2, minutes2] = time2Parts;\n    \n    if (hours1 === undefined || minutes1 === undefined || \n        hours2 === undefined || minutes2 === undefined) return true;\n    \n    const totalMinutes1 = hours1 * 60 + minutes1;\n    const totalMinutes2 = hours2 * 60 + minutes2;\n    \n    return totalMinutes1 >= totalMinutes2;\n  };\n\n  // Validate time range\n  const validateTimeRange = (start: string, end: string) => {\n    if (start && end && !compareTime(end, start)) {\n      setTimeError('Waktu selesai harus lebih dari atau sama dengan waktu mulai');\n      return false;\n    }\n    setTimeError('');\n    return true;\n  };\n\n  // Parse existing value if any\n  useEffect(() => {\n    if (value) {\n      if (value.includes(' - ')) {\n        const parts = value.split(' - ');\n        if (parts.length >= 2 && parts[0] && parts[1]) {\n          setStartTime(parts[0].trim());\n          setEndTime(parts[1].replace(' WIB', '').trim());\n        }\n      } else if (value.includes(' s/d ')) {\n        const parts = value.split(' s/d ');\n        if (parts.length >= 2 && parts[0] && parts[1]) {\n          setStartTime(parts[0].trim());\n          setEndTime(parts[1].replace(' WIB', '').trim());\n        }\n      }\n    }\n  }, [value]);\n\n  const handleStartTimeChange = (time: string) => {\n    setStartTime(time);\n    \n    // Reset end time if it's now invalid (less than new start time)\n    if (endTime && !compareTime(endTime, time)) {\n      setEndTime('');\n      setTimeError('');\n      // Clear the value since time range is no longer valid\n      if (onChange) {\n        onChange('');\n      }\n    } else {\n      // Clear any existing error\n      setTimeError('');\n    }\n    \n    // Don't automatically update the value here, wait for user to click Apply\n  };\n\n  const handleEndTimeChange = (time: string) => {\n    setEndTime(time);\n    \n    // Validate time range\n    if (startTime && time) {\n      validateTimeRange(startTime, time);\n    } else {\n      setTimeError('');\n    }\n    \n    // Don't automatically update the value here, wait for user to click Apply\n  };\n\n  const handleApply = () => {\n    if (startTime && endTime) {\n      const isValid = validateTimeRange(startTime, endTime);\n      if (isValid) {\n        const timeRange = `${startTime} WIB - ${endTime} WIB`;\n        if (onChange) {\n          onChange(timeRange);\n        }\n        setIsOpen(false);\n      }\n    }\n  };\n\n  const handleReset = () => {\n    setStartTime('');\n    setEndTime('');\n    setTimeError('');\n    if (onChange) {\n      onChange('');\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <div \n        className={`w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 ${\n          disabled ? 'bg-gray-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'\n        } ${className || ''}`}\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n      >\n        <input\n          id={id}\n          name={name}\n          type=\"text\"\n          value={value || ''}\n          placeholder={placeholder}\n          readOnly\n          required={required}\n          disabled={disabled}\n          className=\"w-full bg-transparent outline-none cursor-pointer\"\n        />\n        <ClockIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n      </div>\n\n      {isOpen && !disabled && (\n        <>\n          {/* Overlay to close dropdown when clicking outside */}\n          <div \n            className=\"fixed inset-0 z-40\" \n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Dropdown content */}\n          <div className=\"absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-xl min-w-[350px]\">\n            <div className=\"p-4 space-y-4\">\n              <div className=\"text-sm font-medium text-gray-900 mb-3\">\n                Pilih Rentang Waktu Kerja\n              </div>\n              \n              {/* Start Time Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Waktu Mulai\n                </label>\n                <div className=\"relative\">\n                  <select\n                    value={startTime}\n                    onChange={(e) => handleStartTimeChange(e.target.value)}\n                    className=\"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white\"\n                  >\n                    <option value=\"\">-- Pilih Waktu Mulai --</option>\n                    {timeOptions.map((time) => (\n                      <option key={`start-${time}`} value={time}>\n                        {time}\n                      </option>\n                    ))}\n                  </select>\n                  <ChevronDownIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                </div>\n              </div>\n\n              {/* End Time Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Waktu Selesai\n                  {startTime && (\n                    <span className=\"text-xs text-gray-500 ml-1\">\n                      (minimum: {startTime})\n                    </span>\n                  )}\n                </label>\n                <div className=\"relative\">\n                  <select\n                    value={endTime}\n                    onChange={(e) => handleEndTimeChange(e.target.value)}\n                    disabled={!startTime}\n                    className={`w-full px-3 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 appearance-none bg-white ${\n                      !startTime \n                        ? 'bg-gray-50 cursor-not-allowed text-gray-400'\n                        : timeError \n                          ? 'border-red-300 focus:ring-red-500 focus:border-red-500' \n                          : 'border-gray-300 focus:ring-blue-500 focus:border-blue-500'\n                    }`}\n                  >\n                    <option value=\"\">\n                      {!startTime ? '-- Pilih waktu mulai terlebih dahulu --' : '-- Pilih Waktu Selesai --'}\n                    </option>\n                    {getEndTimeOptions().map((time) => (\n                      <option key={`end-${time}`} value={time}>\n                        {time}\n                      </option>\n                    ))}\n                  </select>\n                  <ChevronDownIcon className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                </div>\n                {timeError && (\n                  <p className=\"mt-1 text-sm text-red-600\">{timeError}</p>\n                )}\n              </div>\n\n              {/* Preview */}\n              {startTime && endTime && !timeError && (\n                <div className=\"p-3 bg-blue-50 rounded-md border border-blue-200\">\n                  <div className=\"text-sm text-blue-800\">\n                    <strong>Preview:</strong> {startTime} - {endTime} WIB\n                  </div>\n                </div>\n              )}\n\n              {/* Error Message */}\n              {timeError && (\n                <div className=\"p-3 bg-red-50 rounded-md border border-red-200\">\n                  <div className=\"text-sm text-red-800 flex items-center\">\n                    <svg className=\"w-4 h-4 mr-2 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                    </svg>\n                    {timeError}\n                  </div>\n                </div>\n              )}\n\n              {/* Action Buttons */}\n              <div className=\"flex justify-between space-x-2 pt-2 border-t border-gray-200\">\n                <button\n                  type=\"button\"\n                  onClick={handleReset}\n                  className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50\"\n                >\n                  Reset\n                </button>\n                <div className=\"flex space-x-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setIsOpen(false)}\n                    className=\"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50\"\n                  >\n                    Batal\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={handleApply}\n                    disabled={!startTime || !endTime || !!timeError}\n                    className=\"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\"\n                  >\n                    Terapkan\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/form/input/InputField.tsx",
      "lang": "tsx",
      "size": 680,
      "lines": 26,
      "hash": "32f2192e9260d0ed96c3d11a417c8557c281756fec9177a8bad8144d41a9fa94",
      "truncated": false,
      "content": "\"use client\";\nimport React from \"react\";\n\ninterface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  error?: string;\n}\n\nconst InputField: React.FC<InputFieldProps> = ({ error, ...props }) => {\n  return (\n    <div className=\"relative\">\n      <input\n        {...props}\n        className={`w-full rounded-lg border bg-white px-4 py-3 text-sm text-gray-800 outline-none transition focus:border-gray-900 ${\n          error\n            ? \"border-red-500 focus:border-red-500\"\n            : \"border-gray-300\"\n        }`}\n      />\n      {error && (\n        <p className=\"mt-1 text-xs text-red-500\">{error}</p>\n      )}\n    </div>\n  );\n};\n\nexport default InputField;"
    },
    {
      "path": "src/components/form/textarea/TextArea.tsx",
      "lang": "tsx",
      "size": 1036,
      "lines": 36,
      "hash": "8322b65f71bc3490f9fdcccf04c512422530d9e7951f3222297c07e794e1ee7a",
      "truncated": false,
      "content": "import React, { forwardRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  className?: string;\n  error?: string;\n}\n\nconst TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(\n  ({ className, error, ...props }, ref) => {\n    return (\n      <div>\n        <textarea\n          className={cn(\n            \"flex min-h-[100px] w-full rounded-md border bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50\",\n            error\n              ? \"border-red-500 focus:border-red-500 focus:ring-red-500\"\n              : \"border-gray-300 focus:border-blue-500 focus:ring-blue-500\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        />\n        {error && (\n          <p className=\"mt-1 text-sm text-red-500\">\n            {error}\n          </p>\n        )}\n      </div>\n    );\n  }\n);\n\nTextArea.displayName = \"TextArea\";\n\nexport default TextArea;"
    },
    {
      "path": "src/components/layout/PageHeader.tsx",
      "lang": "tsx",
      "size": 613,
      "lines": 23,
      "hash": "11ca70466500b098f0b747bbcd7cc24d121eeefddf47ca9ba6d740d262114db7",
      "truncated": false,
      "content": "\"use client\";\n\nexport default function PageHeader({\n  title,\n  subtitle,\n  cta,\n}: {\n  title: string;\n  subtitle?: string;\n  cta?: React.ReactNode;\n}) {\n  return (\n    <div className=\"rounded-3xl bg-gradient-to-r from-blue-600 to-blue-800 p-8 text-white shadow-lg\">\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <h1 className=\"text-2xl font-bold md:text-3xl\">{title}</h1>\n          {subtitle && <p className=\"mt-2 text-blue-100 opacity-90\">{subtitle}</p>}\n        </div>\n        {cta && <div className=\"flex-shrink-0\">{cta}</div>}\n      </div>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/layout/SidebarLayout.tsx",
      "lang": "tsx",
      "size": 6842,
      "lines": 173,
      "hash": "26088ba4c3b5a8834d6bbe081d6f086374fa452c86477719a27ceea61740015d",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { signOut, useSession } from \"next-auth/react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport NotificationsBell from \"@/components/notifications/NotificationsBell\";\n\nimport {\n  HomeIcon,\n  UsersIcon,\n  ClipboardDocumentListIcon,\n  ClockIcon,\n  QrCodeIcon,\n  Bars3Icon,\n  XMarkIcon,\n} from \"@heroicons/react/24/outline\";\n\ninterface Props {\n  children: React.ReactNode;\n  title: string;\n  titlePage?: string;\n}\n\nexport default function SidebarLayout({ children, title, titlePage}: Props) {\n  const { data: session } = useSession();\n  const pathname = usePathname();\n  const [sidebarOpen, setSidebarOpen] = useState(false); // Start with false for mobile-first\n\n  const handleLinkClick = () => {\n    // Close sidebar on mobile after clicking a link\n    if (window.innerWidth < 768) {\n      setSidebarOpen(false);\n    }\n  };\n\n  const menu = {\n    SUPER_ADMIN: [\n      { label: \"Dashboard\", href: \"/super-admin\", icon: HomeIcon },\n      { label: \"User Management\", href: \"/super-admin/users\", icon: UsersIcon },\n    ],\n    ADMIN: [\n      { label: \"Dashboard\", href: \"/admin\", icon: HomeIcon },\n      { label: \"Users\", href: \"/admin/users\", icon: UsersIcon },\n      { label: \"Submissions\", href: \"/admin/submissions\", icon: ClipboardDocumentListIcon },\n      // { label: \"Settings\", href: \"/admin/settings\", icon: CogIcon },\n    ],\n    REVIEWER: [\n      { label: \"Dashboard\", href: \"/reviewer\", icon: HomeIcon },\n      { label: \"Review Pengajuan\", href: \"/reviewer/submissions\", icon: ClipboardDocumentListIcon },\n      { label: \"Verifikasi User\", href: \"/reviewer/users\", icon: UsersIcon },\n      { label: \"Scan History\", href: \"/reviewer/scan-history\", icon: QrCodeIcon },\n    ],\n    APPROVER: [\n      { label: \"Dashboard\", href: \"/approver\", icon: HomeIcon },\n      { label: \"Persetujuan\", href: \"/approver/submissions\", icon: ClipboardDocumentListIcon },\n      { label: \"Scan History\", href: \"/approver/scan-history\", icon: QrCodeIcon },\n    ],\n    VENDOR: [\n      { label: \"Dashboard\", href: \"/vendor\", icon: HomeIcon },\n      { label: \"Submissions\", href: \"/vendor/submissions\", icon: ClipboardDocumentListIcon },\n    ],\n    VERIFIER: [\n      { label: \"Dashboard\", href: \"/verifier\", icon: HomeIcon },\n      // { label: \"Documents\", href: \"/verifier/docs\", icon: DocumentTextIcon },\n      { label: \"History\", href: \"/verifier/history\", icon: ClockIcon },\n    ],\n  }[session?.user.role ?? \"ADMIN\"];\n\n  return (\n    <div className=\"flex h-screen bg-gray-50\">\n      {/* Mobile backdrop */}\n      {sidebarOpen && (\n        <div className=\"fixed inset-0 z-20 bg-black/30 md:hidden\" onClick={() => setSidebarOpen(false)} />\n      )}\n\n      {/* Sidebar */}\n      <aside\n        className={`fixed inset-y-0 left-0 z-30 h-full flex-col border-r border-slate-200 bg-white shadow-sm transition-all duration-300 ease-in-out md:relative md:flex ${\n          sidebarOpen ? \"flex w-64\" : \"hidden md:flex md:w-20\"\n        }`}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-slate-200 px-4 py-4\">\n          {sidebarOpen && <h1 className=\"text-lg font-bold\">{title}</h1>}\n          <button\n            onClick={() => setSidebarOpen(!sidebarOpen)}\n            className={`rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${\n              sidebarOpen ? \"ml-auto md:ml-auto\" : \"mx-auto\"\n            }`}\n            aria-label=\"Toggle sidebar\"\n          >\n            {sidebarOpen ? <XMarkIcon className=\"h-6 w-6\" /> : <Bars3Icon className=\"h-6 w-6\" />}\n          </button>\n        </div>\n\n        {/* Navigation */}\n        <nav className=\"flex-1 space-y-2 px-2 py-6\">\n          {menu.map((item) => {\n            const active = pathname === item.href;\n            const Icon = item.icon;\n            return (\n              <Link\n                key={item.href}\n                href={item.href}\n                onClick={handleLinkClick}\n                title={item.label}\n                className={`group relative flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium outline-none transition-colors hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 ${\n                  active\n                    ? \"bg-blue-100 text-blue-700\"\n                    : \"text-slate-700\"\n                } ${!sidebarOpen ? \"justify-center\" : \"\"}`}\n              >\n                <Icon className=\"h-5 w-5 flex-shrink-0\" />\n                {sidebarOpen && <span>{item.label}</span>}\n              </Link>\n            );\n          })}\n        </nav>\n\n        {/* Profile & Logout */}\n        <div className=\"border-t border-slate-200 p-4\">\n          <Link \n            href=\"/profile\" \n            className={`mb-4 flex items-center gap-3 ${!sidebarOpen && \"justify-center\"} hover:bg-slate-100 p-2 rounded-md transition-colors`}\n            onClick={handleLinkClick}\n          >\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-slate-300 text-sm font-bold text-white\">\n              {session?.user.name?.charAt(0).toUpperCase()}\n            </div>\n            {sidebarOpen && (\n              <div>\n                <p className=\"truncate text-sm font-medium\">{session?.user.name}</p>\n              </div>\n            )}\n          </Link>\n          <button\n            onClick={() => signOut({ callbackUrl: \"/\" })}\n            className={`w-full rounded-md bg-red-600 py-2 text-sm font-medium text-white outline-none transition hover:bg-red-700 focus-visible:ring-2 focus-visible:ring-red-500 ${\n              !sidebarOpen ? \"px-0 flex justify-center\" : \"\"\n            }`}\n          >\n            {sidebarOpen ? \"Logout\" : <span className=\"text-xs\">⏻</span>}\n          </button>\n        </div>\n      </aside>\n\n      {/* Main wrapper */}\n      <div className={`flex min-w-0 flex-1 flex-col transition-all duration-300 ${\n        sidebarOpen ? \"md:ml-0\" : \"md:ml-0\"\n      }`}>\n        {/* Top bar */}\n        <header className=\"flex items-center justify-between border-b border-slate-200 px-3 py-3 bg-white md:px-6\">\n          <button\n            onClick={() => setSidebarOpen(true)}\n            className=\"rounded-md p-1 text-slate-600 outline-none transition hover:bg-slate-100 focus-visible:ring-2 focus-visible:ring-sky-500 md:hidden\"\n            aria-label=\"Open sidebar\"\n          >\n            <Bars3Icon className=\"h-6 w-6\" />\n          </button>\n          <div className=\"text-xl font-semibold\">{titlePage}</div>\n          <NotificationsBell /> \n        </header>\n\n        {/* Content area */}\n        <main className=\"min-h-0 flex-1 overflow-y-auto bg-gray-50 p-4 md:p-8 \">\n          <div className=\"mx-auto w-full max-w-7xl\">{children}</div>\n        </main>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/notifications/NotificationsBell.tsx",
      "lang": "tsx",
      "size": 4690,
      "lines": 146,
      "hash": "8e680ef9caf9d98e6cdfb06aa55329a67a6c3af2cd957e953a59fce50479d43b",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { BellIcon } from '@heroicons/react/24/outline';\nimport { useSession } from 'next-auth/react';\nimport { useNotificationsStore } from '../../store/notifications';\nimport { useRealTimeNotifications } from '../../hooks/useRealTimeNotifications';\nimport NotificationsPanel from './NotificationsPanel';\n\nexport default function NotificationsBell() {\n  const { data: session } = useSession();\n  const [isOpen, setIsOpen] = useState(false);\n  const { \n    items: notifications,\n    unreadCount,\n    setItems,\n    setUnreadCount,\n    setCursor,\n    setHasMore\n  } = useNotificationsStore();\n\n  // Enable real-time notifications via SSE\n  const { isConnected } = useRealTimeNotifications();\n\n  console.log('NotificationsBell - Current store state (v3-SSE):', { \n    notifications: notifications?.length, \n    unreadCount,\n    isConnected\n  });\n\n  // Load initial notifications and unread count\n  useEffect(() => {\n    if (session?.user) {\n      loadNotifications();\n    }\n  }, [session]);\n\n  // Sync unread count with store items changes\n  useEffect(() => {\n    if (notifications.length > 0) {\n      const calculatedUnreadCount = notifications.filter(n => !n.isRead).length;\n      if (calculatedUnreadCount !== unreadCount) {\n        setUnreadCount(calculatedUnreadCount);\n      }\n    }\n  }, [notifications, unreadCount, setUnreadCount]);\n\n  const loadNotifications = async () => {\n    if (!session?.user) return;\n\n    // Skip notifications for verifier role\n    if (session.user.role === 'VERIFIER') {\n      return;\n    }\n\n    try {\n      // Determine scope based on user role\n      let scope: string;\n      if (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN') {\n        scope = 'admin';\n      } else if (session.user.role === 'REVIEWER') {\n        scope = 'reviewer';\n      } else if (session.user.role === 'APPROVER') {\n        scope = 'approver';\n      } else {\n        scope = 'vendor';\n      }\n\n      const params = new URLSearchParams({\n        scope,\n        limit: '10'\n      });\n\n      // Add vendorId only for vendor scope\n      if (scope === 'vendor' && session.user.id) {\n        params.append('vendorId', session.user.id);\n      }\n\n      console.log('Loading notifications with params:', params.toString());\n      console.log('Using endpoint: /api/v1/notifications (Build: 2025-09-06-v3)');\n\n      const response = await fetch(`/api/v1/notifications?${params}`);\n      if (response.ok) {\n        const result = await response.json();\n        console.log('Notifications loaded:', result);\n        \n        // Extract notifications from nested data structure\n        const notifications = Array.isArray(result.data?.data) ? result.data.data : [];\n        console.log('NotificationsBell - About to setItems with:', notifications);\n        setItems(notifications);\n        \n        // Count unread notifications\n        const unreadCount = notifications.filter((n: any) => !n.isRead).length;\n        console.log('NotificationsBell - Setting unreadCount to:', unreadCount);\n        console.log('NotificationsBell - All notifications:', notifications.map((n: any) => ({ id: n.id, isRead: n.isRead, title: n.title })));\n        setUnreadCount(unreadCount);\n        \n        setCursor(result.data?.pagination?.nextCursor);\n        setHasMore(result.data?.pagination?.hasMore || false);\n      } else {\n        console.error('Failed to load notifications:', response.status, response.statusText);\n        const errorData = await response.json();\n        console.error('Error details:', errorData);\n      }\n    } catch (error) {\n      console.error('Error loading notifications:', error);\n    }\n  };\n\n  if (!session?.user) {\n    return null;\n  }\n\n  // Hide notification bell for verifiers as they don't receive notifications\n  if (session.user.role === 'VERIFIER') {\n    return null;\n  }\n\n  return (\n    <div className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`relative p-2 rounded-lg transition-all duration-200 ${\n          isOpen \n            ? 'bg-blue-50 text-blue-600' \n            : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'\n        }`}\n        aria-label=\"Notifications\"\n      >\n        <BellIcon className=\"h-6 w-6\" />\n        {unreadCount > 0 && (\n          <span className=\"absolute -top-1 -right-1 min-w-5 h-5 bg-red-600 text-white text-xs rounded-full flex items-center justify-center font-semibold px-1.5\">\n            {unreadCount > 99 ? '99+' : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {isOpen && (\n        <NotificationsPanel \n          onClose={() => setIsOpen(false)}\n        />\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/notifications/NotificationsPanel.tsx",
      "lang": "tsx",
      "size": 27929,
      "lines": 742,
      "hash": "ff990c69fb478090091680c015485ed8ec1ab53ae4615344505a1fc0102c62cc",
      "truncated": false,
      "content": "import { useState, useEffect, useCallback } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { \n  BellIcon, \n  XMarkIcon,\n  CheckIcon,\n  CheckCircleIcon,\n  ClockIcon,\n  UserPlusIcon,\n  DocumentPlusIcon,\n  ShieldCheckIcon,\n  InboxIcon\n} from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\nimport AdminSubmissionDetailModal from '../admin/AdminSubmissionDetailModal';\nimport SubmissionDetailModal from '../vendor/SubmissionDetailModal';\nimport ApproverSubmissionDetailModal from '../approver/ApproverSubmissionDetailModal';\nimport ReviewerSubmissionDetailModal from '../reviewer/ReviewerSubmissionDetailModal';\nimport UserVerificationModal from '../admin/UserVerificationModal';\nimport ReviewerUserVerificationModal from '../reviewer/ReviewerUserVerificationModal';\nimport { UserData } from '@/types/user';\nimport { useToast } from '@/hooks/useToast';\n\nimport { useNotificationsStore, type Notification } from '../../store/notifications';\n\ninterface NotificationsPanelProps {\n  onClose: () => void;\n}\n\nexport default function NotificationsPanel({\n  onClose\n}: NotificationsPanelProps) {\n  const { data: session } = useSession();\n  const { \n    items: notifications, \n    unreadCount, \n    markAsRead, \n    markAllAsRead \n  } = useNotificationsStore();\n  const { showError, showWarning } = useToast();\n\n  // Debug: log notifications data\n  console.log('NotificationsPanel - notifications:', notifications);\n  console.log('NotificationsPanel - notifications length:', notifications?.length);\n  console.log('NotificationsPanel - unreadCount:', unreadCount);\n  \n  // Debug each notification\n  if (notifications && notifications.length > 0) {\n    notifications.slice(0, 3).forEach((notif, index) => {\n      console.log(`Notification ${index}:`, {\n        id: notif.id,\n        type: notif.type,\n        title: notif.title,\n        message: notif.message,\n        data: notif.data,\n        isRead: notif.isRead,\n        createdAt: notif.createdAt\n      });\n    });\n  }\n  \n  const [selectedSubmission, setSelectedSubmission] = useState<any>(null);\n  const [selectedSubmissionId, setSelectedSubmissionId] = useState<string | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  \n  // State for vendor verification modal\n  const [selectedVendorUser, setSelectedVendorUser] = useState<UserData | null>(null);\n\n  // Close panel when clicking outside\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscape);\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [onClose]);\n\n  const handleViewDetail = async (notification: Notification) => {\n    try {\n      console.log('handleViewDetail called with notification:', notification);\n      \n      // Handle vendor notifications\n      if (notification.type === 'user_registered' || notification.type === 'new_vendor' || notification.type === 'new_user_verification') {\n        await handleVendorDetail(notification);\n        return;\n      }\n      \n      // Parse data dari notification untuk mendapatkan submission ID\n      let submissionId = null;\n      \n      if (notification.data) {\n        try {\n          // Check if data is already an object or needs parsing\n          const parsedData = typeof notification.data === 'string' \n            ? JSON.parse(notification.data) \n            : notification.data;\n          submissionId = parsedData.submissionId || parsedData.submission_id;\n          console.log('Extracted submissionId from data:', submissionId);\n        } catch (e) {\n          console.error('Error parsing notification data:', e);\n          console.log('Raw notification.data:', notification.data);\n        }\n      }\n\n      // Jika tidak ada submissionId, coba extract dari message atau title\n      if (!submissionId) {\n        // Cari pattern ID dalam message atau title\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notification.message.match(idPattern);\n        const titleMatch = notification.title.match(idPattern);\n        \n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n        console.log('Extracted submissionId from text:', submissionId);\n      }\n\n      if (!submissionId) {\n        console.warn('No submission ID found in notification:', notification);\n        return;\n      }\n\n      console.log('Fetching submission details for ID:', submissionId);\n\n      // Determine API endpoint based on user role\n      let apiEndpoint = `/api/submissions/${submissionId}`;\n      if (session?.user?.role === 'APPROVER') {\n        apiEndpoint = `/api/approver/simloks/${submissionId}`;\n      } else if (session?.user?.role === 'REVIEWER') {\n        apiEndpoint = `/api/reviewer/simloks/${submissionId}`;\n      } else if (session?.user?.role === 'ADMIN' || session?.user?.role === 'SUPER_ADMIN') {\n        apiEndpoint = `/api/admin/submissions/${submissionId}`;\n      }\n\n      // Fetch detail submission\n      const response = await fetch(apiEndpoint);\n      \n      if (response.status === 404) {\n        // Submission tidak ditemukan (mungkin sudah dihapus)\n        console.warn('Submission not found:', submissionId);\n        showWarning(\n          'Pengajuan Tidak Ditemukan',\n          'Pengajuan yang dirujuk dalam notifikasi ini sudah tidak tersedia atau telah dihapus.'\n        );\n        \n        // Mark notification as read karena sudah dicoba akses\n        if (!notification.isRead) {\n          console.log('Marking notification as read (submission not found):', notification.id);\n          await markAsRead(notification.id);\n        }\n        return;\n      }\n      \n      if (!response.ok) {\n        throw new Error(`Failed to fetch submission details: ${response.status}`);\n      }\n\n      const responseData = await response.json();\n      console.log('Submission data fetched:', responseData);\n      \n      // Handle different response structures based on role\n      const submissionData = responseData.submission || responseData;\n      \n      setSelectedSubmission(submissionData);\n      setSelectedSubmissionId(submissionId);\n      setIsDetailModalOpen(true);\n\n      // Mark notification as read\n      if (!notification.isRead) {\n        console.log('Marking notification as read:', notification.id);\n        await markAsRead(notification.id);\n      }\n\n    } catch (error) {\n      console.error('Error viewing submission detail:', error);\n      \n      // Tampilkan pesan error yang user-friendly\n      if (error instanceof Error) {\n        if (error.message.includes('404')) {\n          showWarning(\n            'Pengajuan Tidak Ditemukan',\n            'Pengajuan yang dirujuk dalam notifikasi ini sudah tidak tersedia atau telah dihapus.'\n          );\n        } else {\n          showError(\n            'Gagal Memuat Detail',\n            'Terjadi kesalahan saat memuat detail pengajuan. Silakan coba lagi.'\n          );\n        }\n      } else {\n        showError(\n          'Gagal Memuat Detail',\n          'Terjadi kesalahan saat memuat detail pengajuan. Silakan coba lagi.'\n        );\n      }\n    }\n  };\n\n  const handleVendorDetail = async (notification: Notification) => {\n    try {\n      console.log('handleVendorDetail called with notification:', notification);\n      \n      let vendorId = null;\n      \n      if (notification.data) {\n        try {\n          const parsedData = typeof notification.data === 'string' \n            ? JSON.parse(notification.data) \n            : notification.data;\n          vendorId = parsedData.vendorId || parsedData.userId || parsedData.user_id;\n          console.log('Extracted vendorId from data:', vendorId);\n        } catch (e) {\n          console.error('Error parsing notification data:', e);\n          console.log('Raw notification.data:', notification.data);\n        }\n      }\n\n      if (!vendorId) {\n        console.warn('No vendor ID found in notification:', notification);\n        return;\n      }\n\n      console.log('🔍 Fetching vendor data for ID:', vendorId);\n      \n      // Determine the correct API endpoint based on user role\n      let apiEndpoint = `/api/admin/users/${vendorId}`;\n      if (session?.user?.role === 'REVIEWER') {\n        apiEndpoint = `/api/reviewer/users/${vendorId}`;\n      }\n      \n      const response = await fetch(apiEndpoint);\n      \n      if (response.status === 404) {\n        console.warn('User not found:', vendorId);\n        showWarning(\n          'Data Vendor Tidak Ditemukan',\n          'Data vendor yang dirujuk dalam notifikasi ini sudah tidak tersedia.'\n        );\n        \n        // Mark notification as read karena sudah dicoba akses\n        if (!notification.isRead) {\n          console.log('Marking notification as read (user not found):', notification.id);\n          await markAsRead(notification.id);\n        }\n        return;\n      }\n      \n      if (!response.ok) {\n        throw new Error(`Failed to fetch vendor details: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      console.log('✅ Vendor user data fetched:', data);\n      \n      setSelectedVendorUser(data.user);\n      console.log('🚀 Opening user verification modal for vendorId:', vendorId);\n\n      // Mark notification as read\n      if (!notification.isRead) {\n        console.log('Marking notification as read:', notification.id);\n        await markAsRead(notification.id);\n      }\n\n    } catch (err) {\n      console.error('❌ Error fetching vendor details:', err);\n      \n      // Tampilkan pesan error yang user-friendly\n      if (err instanceof Error) {\n        if (err.message.includes('404')) {\n          showWarning(\n            'Data Vendor Tidak Ditemukan',\n            'Data vendor yang dirujuk dalam notifikasi ini sudah tidak tersedia.'\n          );\n        } else {\n          showError(\n            'Gagal Memuat Detail Vendor',\n            'Gagal memuat detail vendor. Silakan coba lagi.'\n          );\n        }\n      } else {\n        showError(\n          'Gagal Memuat Detail Vendor',\n          'Gagal memuat detail vendor. Silakan coba lagi.'\n        );\n      }\n    }\n  };\n\n  const handleCloseDetailModal = () => {\n    setIsDetailModalOpen(false);\n    setSelectedSubmission(null);\n    setSelectedSubmissionId(null);\n  };\n\n  const formatTimeAgo = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n    if (diffInSeconds < 60) {\n      return 'Baru saja';\n    } else if (diffInSeconds < 3600) {\n      const minutes = Math.floor(diffInSeconds / 60);\n      return `${minutes}m`;\n    } else if (diffInSeconds < 86400) {\n      const hours = Math.floor(diffInSeconds / 3600);\n      return `${hours}j`;\n    } else if (diffInSeconds < 604800) {\n      const days = Math.floor(diffInSeconds / 86400);\n      return `${days}h`;\n    } else {\n      return date.toLocaleDateString('id-ID', {\n        day: 'numeric',\n        month: 'short'\n      });\n    }\n  };\n\n  const getNotificationIcon = (type: string) => {\n    const iconClass = \"w-5 h-5\";\n    switch (type) {\n      case 'submission_approved':\n        return <CheckCircleIcon className={`${iconClass} text-green-600`} />;\n      case 'submission_rejected':\n        return <XMarkIcon className={`${iconClass} text-red-500`} />;\n      case 'submission_pending':\n        return <ClockIcon className={`${iconClass} text-amber-500`} />;\n      case 'status_change':\n        return <ShieldCheckIcon className={`${iconClass} text-blue-600`} />;\n      case 'new_submission':\n        return <DocumentPlusIcon className={`${iconClass} text-blue-600`} />;\n      case 'user_registered':\n      case 'new_vendor':\n        return <UserPlusIcon className={`${iconClass} text-blue-600`} />;\n      default:\n        return <BellIcon className={`${iconClass} text-gray-500`} />;\n    }\n  };\n\n  const truncateText = (text: string, maxLength: number = 80) => {\n    return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n  };\n\n  const getEnhancedMessage = useCallback((notification: Notification) => {\n    const { type, message, title } = notification;\n    \n    // Create enhanced messages with clear status information\n    switch (type) {\n      case 'submission_approved':\n        return {\n          title: 'Pengajuan Disetujui',\n          message: truncateText('Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.'),\n          action: 'Lihat detail'\n        };\n      case 'submission_rejected':\n        return {\n          title: 'Pengajuan Ditolak',\n          message: truncateText('Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.'),\n          action: 'Lihat detail'\n        };\n      case 'submission_pending':\n        return {\n          title: 'Status Pending',\n          message: truncateText('Pengajuan Simlok Anda sedang dalam proses review lebih lanjut.'),\n          action: 'Lihat detail'\n        };\n      case 'status_change':\n        // Use the server-provided title and message, but make status clear\n        let enhancedTitle = title;\n        let enhancedMessage = message;\n        \n        if (title.includes('Disetujui')) {\n          enhancedTitle = 'Pengajuan Disetujui';\n          enhancedMessage = 'Selamat! Pengajuan Simlok Anda telah disetujui dan dapat digunakan.';\n        } else if (title.includes('Ditolak')) {\n          enhancedTitle = 'Pengajuan Ditolak';\n          enhancedMessage = 'Pengajuan Simlok Anda ditolak. Silakan periksa catatan dan lakukan perbaikan.';\n        }\n        \n        return {\n          title: truncateText(enhancedTitle, 50),\n          message: truncateText(enhancedMessage),\n          action: 'Lihat detail'\n        };\n      case 'new_submission':\n        return {\n          title: 'Pengajuan Baru Masuk',\n          message: truncateText(message.replace('Pengajuan baru dari', 'Pengajuan Simlok baru dari')),\n          action: 'Lihat detail'\n        };\n      case 'user_registered':\n      case 'new_vendor':\n      case 'new_user_verification':\n        return {\n          title: 'User Baru Perlu Verifikasi',\n          message: truncateText(message.replace('User baru terdaftar', 'User baru mendaftar dan perlu verifikasi')),\n          action: 'Lihat detail'\n        };\n      default:\n        return {\n          title: truncateText(title, 50),\n          message: truncateText(message),\n          action: 'Lihat detail'\n        };\n    }\n  }, []);\n\n  const hasSubmissionData = (notification: Notification) => {\n    console.log('hasSubmissionData check for:', notification);\n    \n    // Check if this is a vendor notification\n    if (notification.type === 'user_registered' || notification.type === 'new_vendor' || notification.type === 'new_user_verification') {\n      return true;\n    }\n    \n    // Check if notification contains submission data that can be viewed\n    const hasSubmissionType = notification.type.includes('submission') || notification.type === 'status_change';\n    \n    let hasSubmissionId = false;\n    if (notification.data) {\n      if (typeof notification.data === 'string') {\n        hasSubmissionId = notification.data.includes('submissionId');\n      } else if (typeof notification.data === 'object') {\n        hasSubmissionId = notification.data.submissionId || notification.data.submission_id;\n      }\n    }\n    \n    const hasIdInMessage = notification.message.includes('ID');\n    const hasIdInTitle = notification.title.includes('ID');\n    \n    const result = hasSubmissionType || hasSubmissionId || hasIdInMessage || hasIdInTitle;\n    \n    console.log('hasSubmissionData result:', {\n      notification: notification.id,\n      type: notification.type,\n      hasSubmissionType,\n      hasSubmissionId,\n      hasIdInMessage,\n      hasIdInTitle,\n      result\n    });\n    \n    return result;\n  };\n\n  if (!notifications) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 z-40\"\n        onClick={onClose}\n      />\n\n      {/* Floating Panel */}\n      <div \n        className=\"absolute right-0 top-12 w-[min(420px,90vw)] bg-white rounded-xl shadow-xl border border-gray-200 z-50 max-h-[70vh] flex flex-col overflow-hidden\"\n        role=\"dialog\"\n        aria-label=\"Panel notifikasi\"\n      >\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0 bg-gray-50/50\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"relative\">\n              <BellIcon className=\"w-5 h-5 text-gray-700\" />\n              {unreadCount > 0 && (\n                <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center\">\n                  <span className=\"text-[10px] font-semibold\">{unreadCount > 9 ? '9+' : unreadCount}</span>\n                </div>\n              )}\n            </div>\n            <div>\n              <h3 className=\"text-sm font-semibold text-gray-900\">\n                Notifikasi\n              </h3>\n              {unreadCount > 0 && (\n                <p className=\"text-xs text-gray-500\">\n                  {unreadCount} belum dibaca\n                </p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            {unreadCount > 0 && (\n              <Button\n                onClick={markAllAsRead}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-xs px-3 py-1.5 hover:bg-blue-50 hover:border-blue-300 transition-colors\"\n              >\n                <CheckIcon className=\"w-3 h-3 mr-1\" />\n                Tandai Semua\n              </Button>\n            )}\n            <button\n              onClick={onClose}\n              className=\"p-1.5 hover:bg-gray-200:bg-gray-700 rounded-md transition-colors\"\n              aria-label=\"Tutup panel\"\n            >\n              <XMarkIcon className=\"w-4 h-4 text-gray-500 hover:text-gray-700\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto\" role=\"list\" aria-label=\"Daftar notifikasi\">\n          {!notifications || notifications.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 px-6\">\n              <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                <InboxIcon className=\"w-8 h-8 text-gray-400\" />\n              </div>\n              <h4 className=\"text-sm font-medium text-gray-900 mb-2\">\n                Tidak ada notifikasi\n              </h4>\n              <p className=\"text-xs text-gray-500 text-center leading-relaxed\">\n                Anda akan melihat notifikasi baru di sini ketika ada aktivitas\n              </p>\n            </div>\n          ) : (\n            <div className=\"divide-y divide-gray-100\">\n              {Array.isArray(notifications) && notifications.slice(0, 10).map((notification) => {\n                const enhancedInfo = getEnhancedMessage(notification);\n                const isUnread = !notification.isRead;\n                const fullTimestamp = new Date(notification.createdAt).toLocaleString('id-ID');\n                \n                return (\n                  <div\n                    key={`notification-${notification.id}-${notification.createdAt}`}\n                    role=\"listitem\"\n                    className={`group relative transition-all duration-200 hover:bg-gray-50:bg-gray-800/50 ${\n                      isUnread \n                        ? 'bg-blue-50/50' \n                        : 'bg-white'\n                    } ${\n                      hasSubmissionData(notification) ? 'cursor-pointer' : ''\n                    }`}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      if (hasSubmissionData(notification)) {\n                        handleViewDetail(notification);\n                      }\n                    }}\n                  >\n                    {/* Unread indicator dot */}\n                    {isUnread && (\n                      <div className=\"absolute left-3 top-6 w-2 h-2 rounded-full bg-blue-600\"></div>\n                    )}\n                    \n                    <div className=\"p-3 pl-7\">\n                      <div className=\"flex items-start space-x-3\">\n                        {/* Icon */}\n                        <div className=\"flex-shrink-0\">\n                          <div className=\"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center\">\n                            {getNotificationIcon(notification.type)}\n                          </div>\n                        </div>\n\n                        {/* Content */}\n                        <div className=\"flex-1 min-w-0\">\n                          {/* Header with time */}\n                          <div className=\"flex items-start justify-between mb-1\">\n                            <h4 \n                              className={`text-sm leading-tight ${\n                                isUnread \n                                  ? 'font-semibold text-gray-900' \n                                  : 'font-medium text-gray-800'\n                              }`}\n                              style={{ lineClamp: 2, WebkitLineClamp: 2, display: '-webkit-box', WebkitBoxOrient: 'vertical', overflow: 'hidden' }}\n                            >\n                              {enhancedInfo.title}\n                            </h4>\n                            <span \n                              className=\"text-[11px] text-gray-500 whitespace-nowrap ml-2\"\n                              title={fullTimestamp}\n                            >\n                              {formatTimeAgo(notification.createdAt)}\n                            </span>\n                          </div>\n                          \n                          {/* Message */}\n                          <p \n                            className=\"text-xs text-gray-600 leading-relaxed mb-2\"\n                            style={{ lineClamp: 2, WebkitLineClamp: 2, display: '-webkit-box', WebkitBoxOrient: 'vertical', overflow: 'hidden' }}\n                          >\n                            {enhancedInfo.message}\n                          </p>\n\n                          {/* Actions */}\n                          <div className=\"flex items-center justify-between\">\n                            {hasSubmissionData(notification) && (\n                              <button className=\"inline-flex items-center text-xs text-blue-600 font-medium hover:text-blue-700 transition-colors\">\n                                {enhancedInfo.action}\n                              </button>\n                            )}\n                            \n                            {isUnread && (\n                              <button\n                                onClick={async (e) => {\n                                  e.preventDefault();\n                                  e.stopPropagation();\n                                  await markAsRead(notification.id);\n                                }}\n                                className=\"inline-flex items-center text-xs text-gray-500 hover:text-blue-600 font-medium px-2 py-1 rounded hover:bg-blue-50:bg-blue-900/20 transition-colors\"\n                                aria-label=\"Tandai sebagai dibaca\"\n                              >\n                                <CheckIcon className=\"w-3 h-3 mr-1\" />\n                                Tandai dibaca\n                              </button>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        {notifications.length > 0 && (\n          <div className=\"border-t border-gray-200 p-3 flex-shrink-0 bg-gray-50/30\">\n            <div className=\"flex items-center justify-between text-xs\">\n              <span className=\"text-gray-500\">\n                {Math.min(notifications.length, 10)} dari {notifications.length}\n              </span>\n              {notifications.length && (\n                <a\n                  href=\"/dashboard/notifications\"\n                  className=\"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium hover:underline transition-colors\"\n                  onClick={onClose}\n                >\n                  Lihat semua →\n                </a>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Modal Detail Submission */}\n      {selectedSubmission && selectedSubmissionId && (\n        <>\n          {session?.user?.role === 'APPROVER' && (\n            <ApproverSubmissionDetailModal\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n              submissionId={selectedSubmissionId}\n              onApprovalSubmitted={() => {\n                // Refresh or handle approval completion\n                handleCloseDetailModal();\n              }}\n            />\n          )}\n          \n          {session?.user?.role === 'REVIEWER' && (\n            <ReviewerSubmissionDetailModal\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n              submissionId={selectedSubmissionId}\n              onReviewSubmitted={() => {\n                // Refresh or handle review completion\n                handleCloseDetailModal();\n              }}\n            />\n          )}\n          \n          {(session?.user?.role === 'ADMIN' || session?.user?.role === 'SUPER_ADMIN') && (\n            <AdminSubmissionDetailModal\n              submission={selectedSubmission}\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n              onSubmissionUpdate={(updatedSubmission) => {\n                setSelectedSubmission(updatedSubmission);\n              }}\n            />\n          )}\n          \n          {session?.user?.role === 'VENDOR' && (\n            <SubmissionDetailModal\n              submission={selectedSubmission}\n              isOpen={isDetailModalOpen}\n              onClose={handleCloseDetailModal}\n            />\n          )}\n        </>\n      )}\n\n      {/* User Verification Modal for Vendor Details */}\n      {selectedVendorUser && (\n        <>\n          {/* Show Reviewer User Verification Modal for REVIEWER role */}\n          {session?.user?.role === 'REVIEWER' ? (\n            <ReviewerUserVerificationModal\n              isOpen={!!selectedVendorUser}\n              onClose={() => {\n                console.log('🚪 Closing reviewer user verification modal');\n                setSelectedVendorUser(null);\n              }}\n              user={selectedVendorUser}\n              onUserUpdate={(updatedUser: UserData) => {\n                setSelectedVendorUser(updatedUser);\n              }}\n              onUserRemove={() => {\n                setSelectedVendorUser(null);\n              }}\n            />\n          ) : (\n            /* Show Admin User Verification Modal for ADMIN/SUPER_ADMIN roles */\n            <UserVerificationModal\n              isOpen={!!selectedVendorUser}\n              onClose={() => {\n                console.log('🚪 Closing admin user verification modal');\n                setSelectedVendorUser(null);\n              }}\n              user={selectedVendorUser}\n              userRole={session?.user?.role}\n              onUserUpdate={(updatedUser: UserData) => {\n                setSelectedVendorUser(updatedUser);\n              }}\n              onUserRemove={() => {\n                setSelectedVendorUser(null);\n              }}\n            />\n          )}\n        </>\n      )}\n    </>\n  );\n}\n"
    },
    {
      "path": "src/components/reviewer/ReviewerDashboard.tsx",
      "lang": "tsx",
      "size": 15469,
      "lines": 406,
      "hash": "a99852a7914b95608b627d985a60e122a5c5c40d49ae37e2b6cf8ee228b4c375",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport {\n  ClipboardDocumentListIcon,\n  ClockIcon,\n  CheckCircleIcon,\n  ExclamationTriangleIcon,\n  EyeIcon\n} from '@heroicons/react/24/outline';\n\nimport Button from '@/components/ui/button/Button';\nimport Alert from '@/components/ui/alert/Alert';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\nimport ReviewerSubmissionDetailModal from './ReviewerSubmissionDetailModal';\nimport Link from 'next/link';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  approved_by_final_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface StatsData {\n  pendingReview: number;\n  meetsRequirements: number;\n  notMeetsRequirements: number;\n  total: number;\n  pendingUserVerifications?: number;\n  totalVerifiedUsers?: number;\n}\n\nconst ReviewerDashboard = () => {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [stats, setStats] = useState<StatsData>({ \n    pendingReview: 0, \n    meetsRequirements: 0, \n    notMeetsRequirements: 0, \n    total: 0,\n    pendingUserVerifications: 0,\n    totalVerifiedUsers: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  \n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<string | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const fetchDashboardData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      // Fetch stats dan 10 submission terakhir untuk dashboard\n      const response = await fetch('/api/reviewer/simloks?page=1&limit=10&sortBy=created_at&sortOrder=desc');\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data dashboard');\n      }\n      \n      const data = await response.json();\n      setSubmissions(data.submissions || []);\n      setStats(data.stats || { pendingReview: 0, meetsRequirements: 0, notMeetsRequirements: 0, total: 0 });\n      setError(null);\n    } catch (err) {\n      console.error('Error fetching dashboard data:', err);\n      setError('Gagal memuat data dashboard');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchDashboardData();\n  }, [fetchDashboardData]);\n\n  // Socket untuk real-time updates\n  const socket = useSocket();\n  \n  useEffect(() => {\n    if (!socket) return;\n\n    // Join reviewer room\n    socket.emit('join', { role: 'REVIEWER' });\n\n    const handleNotificationNew = (notification: any) => {\n      console.log('New notification received for reviewer:', notification);\n      if (notification.type === 'new_submission_review') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleStatsUpdate = (statsUpdate: any) => {\n      console.log('Stats update received for reviewer:', statsUpdate);\n      if (statsUpdate.scope === 'reviewer') {\n        fetchDashboardData();\n      }\n    };\n\n    const handleSubmissionCreated = () => {\n      console.log('New submission created - updating reviewer dashboard');\n      fetchDashboardData();\n    };\n\n    // Listen for new notifications (including new submissions to review)\n    socket.on('notification:new', handleNotificationNew);\n    // Listen for stats updates\n    socket.on('stats:update', handleStatsUpdate);\n    // Listen for new submission events\n    socket.on('submission:created', handleSubmissionCreated);\n\n    return () => {\n      socket.off('notification:new', handleNotificationNew);\n      socket.off('stats:update', handleStatsUpdate);\n      socket.off('submission:created', handleSubmissionCreated);\n    };\n  }, [socket, fetchDashboardData]);\n\n  const handleViewDetail = (submissionId: string) => {\n    setSelectedSubmission(submissionId);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  };\n\n  const handleReviewSubmitted = () => {\n    fetchDashboardData();\n    handleCloseModal();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Review</span>;\n        case 'MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Memenuhi Syarat</span>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Tidak Memenuhi Syarat</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>Menunggu Persetujuan</span>;\n        case 'APPROVED':\n          return <span className={`${baseClasses} bg-green-100 text-green-800`}>Disetujui</span>;\n        case 'REJECTED':\n          return <span className={`${baseClasses} bg-red-100 text-red-800`}>Ditolak</span>;\n        default:\n          return <span className={`${baseClasses} bg-gray-100 text-gray-800`}>{status}</span>;\n      }\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        \n        {error && (\n          <Alert variant=\"error\" title=\"Error\" message={error} className=\"mb-6\" />\n        )}\n\n        {/* Statistics Cards - Updated Design */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Total Pengajuan</h3>\n                <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats?.total || 0}</p>\n              </div>\n              <div className=\"p-3 bg-blue-100 rounded-full\">\n                <ClipboardDocumentListIcon className=\"w-6 h-6 text-blue-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Review</h3>\n                <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats?.pendingReview || 0}</p>\n              </div>\n              <div className=\"p-3 bg-amber-100 rounded-full\">\n                <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Memenuhi Syarat</h3>\n                <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats?.meetsRequirements || 0}</p>\n              </div>\n              <div className=\"p-3 bg-green-100 rounded-full\">\n                <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">Tidak Memenuhi Syarat</h3>\n                <p className=\"text-2xl font-bold text-red-600 mt-1\">{stats?.notMeetsRequirements || 0}</p>\n              </div>\n              <div className=\"p-3 bg-red-100 rounded-full\">\n                <ExclamationTriangleIcon className=\"w-6 h-6 text-red-600\" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* User Verification Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8\">\n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">User Perlu Verifikasi</h3>\n                <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats?.pendingUserVerifications || 0}</p>\n              </div>\n              <div className=\"p-3 bg-purple-100 rounded-full\">\n                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-sm font-medium text-gray-500\">User Terverifikasi</h3>\n                <p className=\"text-2xl font-bold text-indigo-600 mt-1\">{stats?.totalVerifiedUsers || 0}</p>\n              </div>\n              <div className=\"p-3 bg-indigo-100 rounded-full\">\n                <svg className=\"w-6 h-6 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Recent Submissions */}\n        <div className=\"bg-white shadow rounded-lg\">\n          <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n            <h2 className=\"text-lg font-medium text-gray-900 flex items-center\">\n              <ClipboardDocumentListIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n              10 Pengajuan Terakhir\n            </h2>\n            <Link href=\"/reviewer/submissions\">\n              <Button variant=\"outline\" size=\"sm\">\n                Lihat Semua Pengajuan\n              </Button>\n            </Link>\n          </div>\n\n          {submissions.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <ClipboardDocumentListIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">Belum ada pengajuan</h3>\n              <p className=\"mt-1 text-sm text-gray-500\">Pengajuan yang perlu direview akan muncul di sini</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Vendor & Petugas\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Lokasi Kerja\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Review\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Akhir\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Tanggal Dibuat\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {submissions.map((submission) => (\n                    <tr key={submission.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4\">\n                        <div>\n                          <div className=\"text-sm font-medium text-gray-900\">{submission.vendor_name}</div>\n                          <div className=\"text-sm text-gray-500\">{submission.user.officer_name}</div>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <div className=\"text-sm text-gray-900\">{submission.work_location}</div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        {getStatusBadge(submission.review_status, 'review')}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        {getStatusBadge(submission.final_status, 'final')}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-500\">\n                        {new Date(submission.created_at).toLocaleDateString('id-ID')}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <Button\n                          onClick={() => handleViewDetail(submission.id)}\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"text-blue-600 hover:text-blue-900\"\n                        >\n                          <EyeIcon className=\"w-4 h-4 mr-1\" />\n                          Detail\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Modal */}\n      {selectedSubmission && (\n        <ReviewerSubmissionDetailModal\n          isOpen={isModalOpen}\n          onClose={handleCloseModal}\n          submissionId={selectedSubmission}\n          onReviewSubmitted={handleReviewSubmitted}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ReviewerDashboard;"
    },
    {
      "path": "src/components/reviewer/ReviewerScanHistoryContent.tsx",
      "lang": "tsx",
      "size": 21522,
      "lines": 525,
      "hash": "db10def5862525522e60b8a34073a382e3a7349863bda14cfe160e24e8be955d",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  FunnelIcon,\n  QrCodeIcon,\n  UserIcon,\n  DocumentTextIcon,\n  ClockIcon,\n  EyeIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport { formatDistanceToNow, format } from 'date-fns';\nimport { id } from 'date-fns/locale';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\n\ninterface QrScan {\n  id: string;\n  submission_id: string;\n  scanned_by: string;\n  scanned_at: string;\n  scanner_name?: string;\n  notes?: string;\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    job_description: string;\n    review_status: string;\n    final_status: string;\n  };\n  user: {\n    id: string;\n    full_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface FilterState {\n  dateFrom: string;\n  dateTo: string;\n  verifier: string;\n  submissionId: string;\n}\n\nexport default function ReviewerScanHistoryContent() {\n  const [scans, setScans] = useState<QrScan[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n  const [filters, setFilters] = useState<FilterState>({\n    dateFrom: '',\n    dateTo: '',\n    verifier: '',\n    submissionId: ''\n  });\n  const [showFilters, setShowFilters] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedScan, setSelectedScan] = useState<QrScan | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const pageSize = 15;\n\n  const fetchScanHistory = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: pageSize.toString(),\n        ...(filters.dateFrom && { dateFrom: filters.dateFrom }),\n        ...(filters.dateTo && { dateTo: filters.dateTo }),\n        ...(filters.verifier && { verifier: filters.verifier }),\n        ...(filters.submissionId && { submissionId: filters.submissionId }),\n        ...(searchTerm && { search: searchTerm })\n      });\n\n      const response = await fetch(`/api/scan-history?${params}`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data = await response.json();\n      setScans(data.scans || []);\n      setTotalPages(Math.ceil((data.total || 0) / pageSize));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      fetchScanHistory();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [currentPage, searchTerm]);\n\n  const handleFilterSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const resetFilters = () => {\n    setFilters({\n      dateFrom: '',\n      dateTo: '',\n      verifier: '',\n      submissionId: ''\n    });\n    setSearchTerm('');\n    setCurrentPage(1);\n    fetchScanHistory();\n  };\n\n  const getStatusBadge = (status: string, type: 'review' | 'final') => {\n    if (type === 'review') {\n      switch (status) {\n        case 'PENDING_REVIEW':\n          return <Badge variant=\"warning\">Menunggu Review</Badge>;\n        case 'MEETS_REQUIREMENTS':\n          return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n        case 'NOT_MEETS_REQUIREMENTS':\n          return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n        default:\n          return null;\n      }\n    } else {\n      switch (status) {\n        case 'PENDING_APPROVAL':\n          return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n        case 'APPROVED':\n          return <Badge variant=\"success\">Disetujui</Badge>;\n        case 'REJECTED':\n          return <Badge variant=\"destructive\">Ditolak</Badge>;\n        default:\n          return null;\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Search and Filters */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <QrCodeIcon className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">Manajemen Riwayat Scan</h2>\n              <p className=\"text-sm text-gray-500\">Pantau aktivitas scan QR code oleh verifikator</p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-3\">\n            <Button\n              onClick={() => setShowFilters(!showFilters)}\n              variant={showFilters ? 'secondary' : 'primary'}\n              className=\"flex items-center space-x-2\"\n            >\n              <FunnelIcon className=\"h-4 w-4\" />\n              <span>Filter</span>\n            </Button>\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        <div className=\"relative mb-4\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            placeholder=\"Cari berdasarkan nomor simlok, nama perusahaan, atau verifikator...\"\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        {/* Advanced Filters */}\n        {showFilters && (\n          <div className=\"border-t border-gray-200 pt-4\">\n            <form onSubmit={handleFilterSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Dari\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateFrom}\n                    onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tanggal Sampai\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={filters.dateTo}\n                    onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nama Verifikator\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.verifier}\n                    onChange={(e) => setFilters(prev => ({ ...prev, verifier: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nama verifikator...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nomor Simlok\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={filters.submissionId}\n                    onChange={(e) => setFilters(prev => ({ ...prev, submissionId: e.target.value }))}\n                    placeholder=\"Filter berdasarkan nomor simlok...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3\">\n                <Button type=\"submit\" className=\"flex items-center space-x-2\">\n                  <MagnifyingGlassIcon className=\"h-4 w-4\" />\n                  <span>Terapkan Filter</span>\n                </Button>\n                \n                <Button \n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={resetFilters}\n                >\n                  Reset\n                </Button>\n              </div>\n            </form>\n          </div>\n        )}\n      </div>\n\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Scan History Table */}\n      <div className=\"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden\">\n        {loading ? (\n          <div className=\"p-8\">\n            <div className=\"animate-pulse space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-gray-200 rounded-lg\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-2\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                  </div>\n                  <div className=\"w-20 h-8 bg-gray-200 rounded\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ) : scans.length === 0 ? (\n          <div className=\"p-12 text-center\">\n            <QrCodeIcon className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No scan history found</h3>\n            <p className=\"text-gray-500\">No QR code scans match your current filters.</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pengajuan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Verifikator\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Waktu Scan\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status\n                    </th>\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {scans.map((scan) => (\n                    <tr key={scan.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-2 bg-blue-100 rounded-lg mr-3\">\n                            <DocumentTextIcon className=\"h-5 w-5 text-blue-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.submission.simlok_number}\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {scan.submission.vendor_name}\n                            </div>\n                            <div className=\"text-xs text-gray-400 truncate max-w-xs\">\n                              {scan.submission.job_description}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center\">\n                          <div className=\"p-1.5 bg-green-100 rounded-full mr-3\">\n                            <UserIcon className=\"h-4 w-4 text-green-600\" />\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium text-gray-900\">\n                              {scan.user.full_name}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {scan.user.email}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"flex items-center text-sm text-gray-900\">\n                          <ClockIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <div>\n                            <div className=\"font-medium\">\n                              {format(new Date(scan.scanned_at), 'dd/MM/yyyy HH:mm', { locale: id })}\n                            </div>\n                            <div className=\"text-xs text-gray-500\">\n                              {formatDistanceToNow(new Date(scan.scanned_at), { locale: id, addSuffix: true })}\n                            </div>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"space-y-1\">\n                          {getStatusBadge(scan.submission.review_status, 'review')}\n                          {getStatusBadge(scan.submission.final_status, 'final')}\n                        </div>\n                      </td>\n                      \n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          className=\"flex items-center space-x-1\"\n                        >\n                          <EyeIcon className=\"h-4 w-4\" />\n                          <span>Detail</span>\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {totalPages > 1 && (\n              <div className=\"bg-white px-4 py-3 border-t border-gray-200 sm:px-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <p className=\"text-sm text-gray-700\">\n                      Menampilkan halaman <span className=\"font-medium\">{currentPage}</span> dari{' '}\n                      <span className=\"font-medium\">{totalPages}</span>\n                    </p>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <ChevronLeftIcon className=\"h-4 w-4\" />\n                      <span>Sebelumnya</span>\n                    </Button>\n                    \n                    <Button\n                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}\n                      disabled={currentPage === totalPages}\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"flex items-center space-x-1\"\n                    >\n                      <span>Selanjutnya</span>\n                      <ChevronRightIcon className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6 border-b border-gray-200\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">Informasi Detail Scan</h3>\n                <button\n                  onClick={() => setSelectedScan(null)}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <span className=\"sr-only\">Close</span>\n                  ✕\n                </button>\n              </div>\n            </div>\n            \n            <div className=\"p-6 space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Pengajuan</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nomor Simlok:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.simlok_number}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Perusahaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.vendor_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Deskripsi Pekerjaan:</span>\n                      <span className=\"font-medium\">{selectedScan.submission.job_description}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Informasi Verifikator</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Nama:</span>\n                      <span className=\"font-medium\">{selectedScan.user.full_name}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Email:</span>\n                      <span className=\"font-medium\">{selectedScan.user.email}</span>\n                    </div>\n                    \n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Detail Scan</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-500\">Waktu Scan:</span>\n                    <span className=\"font-medium\">\n                      {format(new Date(selectedScan.scanned_at), 'dd/MM/yyyy HH:mm:ss', { locale: id })}\n                    </span>\n                  </div>\n                  {selectedScan.scanner_name && (\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-500\">Scanner Name:</span>\n                      <span className=\"font-medium\">{selectedScan.scanner_name}</span>\n                    </div>\n                  )}\n                  {selectedScan.notes && (\n                    <div className=\"col-span-2\">\n                      <span className=\"text-gray-500\">Notes:</span>\n                      <p className=\"mt-1 font-medium\">{selectedScan.notes}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"text-sm font-semibold text-gray-700 border-b pb-2\">Current Status</h4>\n                <div className=\"flex flex-wrap gap-3\">\n                  {getStatusBadge(selectedScan.submission.review_status, 'review')}\n                  {getStatusBadge(selectedScan.submission.final_status, 'final')}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/reviewer/ReviewerSubmissionDetailModal.tsx",
      "lang": "tsx",
      "size": 104597,
      "lines": 2069,
      "hash": "b74750942433c5189d103f61eac3b411bab7957c92e32e93ec5aab424b33ffac",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport {\n  XMarkIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  DocumentTextIcon,\n  UserGroupIcon,\n  PencilIcon,\n  TrashIcon,\n  QrCodeIcon,\n  ClockIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { useToast } from '@/hooks/useToast';\nimport DatePicker from '@/components/form/DatePicker';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport RichTextEditor from '@/components/ui/RichTextEditor';\n\ninterface WorkerPhoto {\n  id: string;\n  worker_name: string;\n  worker_photo: string;\n  created_at: string;\n}\n\ninterface QrScan {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  notes?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface ScanHistory {\n  scans: QrScan[];\n  totalScans: number;\n  lastScan: QrScan | null;\n  hasBeenScanned: boolean;\n}\n\ninterface SubmissionDetail {\n  id: string;\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  officer_email?: string;\n  job_description: string;\n  work_location: string;\n  implementation: string;\n  working_hours: string;\n  other_notes: string;\n  work_facilities: string;\n  worker_count: number | null;\n  simja_number: string;\n  simja_date: string | null;\n  sika_number: string;\n  sika_date: string | null;\n  simlok_number: string | null;\n  simlok_date: string | null;\n  implementation_start_date: string | null;\n  implementation_end_date: string | null;\n  worker_names: string;\n  content: string;\n  notes: string;\n  vendor_note: string | null;\n  signer_position: string;\n  signer_name: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  review_note: string;\n  reviewed_by_name?: string;\n  reviewed_by_email?: string;\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  final_note: string;\n  approved_by_name?: string;\n  approved_by_email?: string;\n  created_at: string;\n  reviewed_at: string;\n  approved_at: string;\n  worker_list: WorkerPhoto[];\n}\n\ninterface ReviewerSubmissionDetailModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  submissionId: string;\n  onReviewSubmitted: () => void;\n}\n\nconst ReviewerSubmissionDetailModal: React.FC<ReviewerSubmissionDetailModalProps> = ({\n  isOpen,\n  onClose,\n  submissionId,\n  onReviewSubmitted\n}) => {\n  const [submission, setSubmission] = useState<SubmissionDetail | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [activeTab, setActiveTab] = useState<'details' | 'workers' | 'review'>('details');\n  const [isEditing, setIsEditing] = useState(false);\n  const [isEditingWorkers, setIsEditingWorkers] = useState(false);\n  const [hasWorkerChanges, setHasWorkerChanges] = useState(false);\n  const [workersToDelete, setWorkersToDelete] = useState<string[]>([]);\n  const [originalWorkerList, setOriginalWorkerList] = useState<WorkerPhoto[]>([]);\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n  const [scanHistory, setScanHistory] = useState<ScanHistory | null>(null);\n  const [loadingScanHistory, setLoadingScanHistory] = useState(false);\n  // Removed unused deletingWorker state since we now use deferred deletion\n  const { showSuccess, showError } = useToast();\n\n  // Form state for editing\n  const [formData, setFormData] = useState({\n    vendor_name: '',\n    vendor_phone: '',\n    based_on: '',\n    officer_name: '',\n    job_description: '',\n    work_location: '',\n    implementation: '',\n    working_hours: '',\n    other_notes: '',\n    work_facilities: '',\n    worker_count: 0,\n    simja_number: '',\n    simja_date: '',\n    sika_number: '',\n    sika_date: '',\n    implementation_start_date: '',\n    implementation_end_date: '',\n    worker_names: '',\n    content: '',\n  });\n\n  // Review form state\n  const [reviewData, setReviewData] = useState({\n    review_status: '' as 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS' | '',\n    review_note: ''\n  });\n\n  // Approval form state for admin-like inputs (tanpa status keputusan)\n  const [approvalForm, setApprovalForm] = useState({\n    vendor_note: '', // Catatan khusus ke vendor\n    tanggal_simlok: '',\n    pelaksanaan: '',\n    lain_lain: '', // Template lain-lain untuk approval\n    content: '',\n    jabatan_signer: 'Sr Officer Security III',\n    nama_signer: 'Julianto Santoso'\n  });\n\n  // Template helper fields (tidak disimpan ke database)\n  const [templateFields, setTemplateFields] = useState({\n    tanggal_dari: '',\n    tanggal_sampai: '',\n    tanggal_simlok: ''\n  });\n\n  const fetchSubmissionDetail = async () => {\n    if (!submissionId) return;\n\n    try {\n      setLoading(true);\n\n      const response = await fetch(`/api/reviewer/simloks/${submissionId}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil detail pengajuan');\n      }\n\n      const data = await response.json();\n      setSubmission(data.submission);\n\n      // Save original worker list for cancel functionality only if not in edit mode\n      if (!isEditingWorkers) {\n        setOriginalWorkerList(data.submission.worker_list || []);\n      }\n\n      // Debug log untuk melihat data submission\n      console.log('Submission data received:', data.submission);\n      console.log('Worker list:', data.submission.worker_list);\n      if (data.submission.worker_list) {\n        data.submission.worker_list.forEach((worker: WorkerPhoto, index: number) => {\n          console.log(`Worker ${index + 1}:`, {\n            name: worker.worker_name,\n            photo: worker.worker_photo,\n            hasPhoto: !!worker.worker_photo,\n            photoLength: worker.worker_photo ? worker.worker_photo.length : 0\n          });\n        });\n      }\n\n      // Initialize form data with error handling\n      const sub = data.submission;\n      \n      const safeDateConversion = (dateValue: string | null | undefined): string => {\n        if (!dateValue) return '';\n        try {\n          const date = new Date(dateValue);\n          if (isNaN(date.getTime())) return '';\n          const isoString = date.toISOString();\n          const datePart = isoString.split('T')[0];\n          return datePart || '';\n        } catch (error) {\n          console.warn('Date conversion error:', error);\n          return '';\n        }\n      };\n      \n      setFormData({\n        vendor_name: sub.vendor_name || '',\n        vendor_phone: sub.vendor_phone || '',\n        based_on: sub.based_on || '',\n        officer_name: sub.officer_name || '',\n        job_description: sub.job_description || '',\n        work_location: sub.work_location || '',\n        implementation: sub.implementation || '',\n        working_hours: sub.working_hours || '',\n        other_notes: sub.other_notes || '',\n        work_facilities: sub.work_facilities || '',\n        worker_count: sub.worker_count || 0,\n        simja_number: sub.simja_number || '',\n        simja_date: safeDateConversion(sub.simja_date),\n        sika_number: sub.sika_number || '',\n        sika_date: safeDateConversion(sub.sika_date),\n        implementation_start_date: safeDateConversion(sub.implementation_start_date),\n        implementation_end_date: safeDateConversion(sub.implementation_end_date),\n        worker_names: sub.worker_names || '',\n        content: sub.content || '',\n      });\n\n      // Initialize review data\n      setReviewData({\n        review_status: sub.review_status === 'PENDING_REVIEW' ? '' : sub.review_status,\n        review_note: sub.review_note || ''\n      });\n\n      // Initialize approval form data\n      const formatDateForInput = (dateString: string | null | undefined): string => {\n        try {\n          if (!dateString) {\n            const today = new Date();\n            const todayYear = today.getFullYear();\n            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');\n            const todayDay = String(today.getDate()).padStart(2, '0');\n            return `${todayYear}-${todayMonth}-${todayDay}`;\n          }\n\n          const date = new Date(dateString);\n          if (isNaN(date.getTime())) {\n            // Fallback to today if date is invalid\n            const today = new Date();\n            const todayYear = today.getFullYear();\n            const todayMonth = String(today.getMonth() + 1).padStart(2, '0');\n            const todayDay = String(today.getDate()).padStart(2, '0');\n            return `${todayYear}-${todayMonth}-${todayDay}`;\n          }\n          \n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        } catch (error) {\n          console.warn('Error formatting date for input:', error);\n          // Return today's date as fallback\n          const today = new Date();\n          const todayYear = today.getFullYear();\n          const todayMonth = String(today.getMonth() + 1).padStart(2, '0');\n          const todayDay = String(today.getDate()).padStart(2, '0');\n          return `${todayYear}-${todayMonth}-${todayDay}`;\n        }\n      };\n\n      setApprovalForm({\n        vendor_note: sub.vendor_note || '', // Catatan khusus ke vendor\n        tanggal_simlok: formatDateForInput(sub.simlok_date),\n        pelaksanaan: sub.implementation || '',\n        lain_lain: sub.other_notes || '', // Template lain-lain untuk admin\n        content: sub.content || 'Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan SIMLOK 2 hari sebelum masa berlaku habis.',\n        jabatan_signer: sub.signer_position || 'Sr Officer Security III',\n        nama_signer: sub.signer_name || 'Julianto Santoso'\n      });\n\n      setTemplateFields({\n        tanggal_dari: sub.implementation_start_date ? formatDateForInput(sub.implementation_start_date) : '',\n        tanggal_sampai: sub.implementation_end_date ? formatDateForInput(sub.implementation_end_date) : '',\n        tanggal_simlok: sub.simlok_date || '',\n      });\n\n    } catch (err) {\n      console.error('Error fetching submission:', err);\n      showError('Error', 'Gagal memuat detail pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchScanHistory = async () => {\n    if (!submissionId) return;\n    \n    try {\n      setLoadingScanHistory(true);\n      const response = await fetch(`/api/submissions/${submissionId}/scans`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch scan history');\n      }\n\n      const data: ScanHistory = await response.json();\n      setScanHistory(data);\n    } catch (err) {\n      console.error('Error fetching scan history:', err);\n      // Don't show error for scan history as it's not critical\n    } finally {\n      setLoadingScanHistory(false);\n    }\n  };\n\n  // Format date function with error handling\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return '-';\n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) {\n        return '-';\n      }\n      return date.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: 'long',\n        year: 'numeric'\n      });\n    } catch (error) {\n      console.warn('Error formatting date:', error);\n      return '-';\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen && submissionId) {\n      fetchSubmissionDetail();\n      fetchScanHistory();\n    }\n  }, [isOpen, submissionId]);\n\n  // Reset editing modes when modal closes or tab changes\n  useEffect(() => {\n    if (!isOpen) {\n      setIsEditing(false);\n      setIsEditingWorkers(false);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    setIsEditingWorkers(false);\n  }, [activeTab]);\n\n  // Template pelaksanaan\n  useEffect(() => {\n    try {\n      if (templateFields.tanggal_dari && templateFields.tanggal_sampai) {\n        const template = `Terhitung mulai tanggal ${formatDate(templateFields.tanggal_dari)} sampai ${formatDate(templateFields.tanggal_sampai)}. Termasuk hari Sabtu, Minggu dan hari libur lainnya.`;\n        setApprovalForm(prev => ({ ...prev, pelaksanaan: template }));\n      }\n    } catch (error) {\n      console.warn('Error updating template pelaksanaan:', error);\n      // Fallback to empty template\n      setApprovalForm(prev => ({ ...prev, pelaksanaan: '' }));\n    }\n  }, [templateFields.tanggal_dari, templateFields.tanggal_sampai]);\n\n  // Template generator untuk lain-lain - Generate ketika tanggal pelaksanaan sudah dipilih\n  useEffect(() => {\n    const generateLainLainTemplate = () => {\n      try {\n        // Hanya generate jika tanggal pelaksanaan sudah dipilih\n        if (submission && templateFields.tanggal_dari && templateFields.tanggal_sampai) {\n          const templateParts = [];\n\n          // Header template\n          templateParts.push(\"Izin diberikan berdasarkan :\");\n\n          // SIMJA section\n          if (submission?.simja_number && submission?.simja_date) {\n            const simjaDate = new Date(submission.simja_date);\n            const simjaDateStr = !isNaN(simjaDate.getTime()) \n              ? simjaDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })\n              : '[tanggal]';\n            \n            templateParts.push(\n              `• <strong>SIMJA</strong> Ast. Man. Facility Management`,\n              `  <strong>No. ${submission.simja_number}</strong> <strong>Tanggal ${simjaDateStr}</strong>`\n            );\n          } else {\n            templateParts.push(\n              `• <strong>SIMJA</strong> Ast. Man. Facility Management`,\n              `  <strong>No. [nomor]</strong> <strong>Tanggal [tanggal]</strong>`\n            );\n          }\n\n          // SIKA section  \n          if (submission?.sika_number && submission?.sika_date) {\n            const sikaDate = new Date(submission.sika_date);\n            const sikaDateStr = !isNaN(sikaDate.getTime()) \n              ? sikaDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })\n              : '[tanggal]';\n            \n            templateParts.push(\n              `• <strong>SIKA</strong> Pekerjaan Dingin`,\n              `  <strong>No.${submission.sika_number}</strong> <strong>Tgl. ${sikaDateStr}</strong>`\n            );\n          } else {\n            templateParts.push(\n              `• <strong>SIKA</strong> Pekerjaan Dingin`,\n              `  <strong>No.[nomor]</strong> <strong>Tgl. [tanggal]</strong>`\n            );\n          }\n\n          // Head of Security section\n          const today = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });\n          const jabatan = approvalForm.jabatan_signer || submission?.signer_position || 'Sr Officer Security III';\n          templateParts.push(\n            ``,\n            `Diterima ${jabatan}`,\n            `<strong>${today}</strong>`\n          );\n\n          const template = templateParts.join('\\n');\n          setApprovalForm(prev => ({ ...prev, lain_lain: template }));\n        }\n      } catch (error) {\n        console.warn('Error generating lain-lain template:', error);\n        // Fallback to simple template\n        setApprovalForm(prev => ({ ...prev, lain_lain: 'Izin diberikan berdasarkan dokumen yang terlampir.' }));\n      }\n    };\n\n    // Generate template ketika tanggal pelaksanaan sudah dipilih\n    if (submission && templateFields.tanggal_dari && templateFields.tanggal_sampai) {\n      generateLainLainTemplate();\n    }\n  }, [\n    submission?.id,\n    templateFields.tanggal_dari,\n    templateFields.tanggal_sampai,\n    submission?.simja_number,\n    submission?.simja_date,\n    submission?.sika_number,\n    submission?.sika_date,\n    submission?.signer_position,\n    approvalForm.jabatan_signer\n  ]); // Re-generate when dates or relevant data changes\n\n  const handleViewPdf = () => {\n    setIsPdfModalOpen(true);\n  };\n\n  const handleSaveChanges = async () => {\n    try {\n      setSaving(true);\n\n      // Gabungkan formData dengan approvalForm\n      const requestBody = {\n        ...formData,\n        // Tambahkan data approval form ke requestBody\n        vendor_note: approvalForm.vendor_note, // Catatan khusus ke vendor\n        other_notes: approvalForm.lain_lain, // Template lain-lain untuk admin\n        content: approvalForm.content,\n        signer_position: approvalForm.jabatan_signer,\n        signer_name: approvalForm.nama_signer,\n        implementation: approvalForm.pelaksanaan,\n        // Tambahkan tanggal pelaksanaan jika ada\n        ...(templateFields.tanggal_dari && { implementation_start_date: templateFields.tanggal_dari }),\n        ...(templateFields.tanggal_sampai && { implementation_end_date: templateFields.tanggal_sampai }),\n      };\n\n      const response = await fetch(`/api/reviewer/simloks/${submissionId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal memperbarui pengajuan');\n      }\n\n      const data = await response.json();\n      setSubmission(data.submission);\n      showSuccess('Berhasil', 'Data berhasil diupdate');\n      setIsEditing(false);\n\n    } catch (err: any) {\n      console.error('Error updating submission:', err);\n      showError('Error', err.message || 'Gagal mengupdate data');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Combined handler untuk review dan save approval template\n  const handleSubmitReviewAndSave = async () => {\n    if (!reviewData.review_status) {\n      showError('Error', 'Pilih status review terlebih dahulu');\n      return;\n    }\n\n    if (!reviewData.review_note.trim()) {\n      showError('Error', 'Catatan review wajib diisi');\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      // 1. Save approval template data first\n      const requestBody = {\n        ...formData,\n        vendor_note: approvalForm.vendor_note, // Catatan khusus ke vendor\n        other_notes: approvalForm.lain_lain, // Template lain-lain untuk admin\n        content: approvalForm.content,\n        signer_position: approvalForm.jabatan_signer,\n        signer_name: approvalForm.nama_signer,\n        implementation: approvalForm.pelaksanaan,\n        ...(templateFields.tanggal_dari && { implementation_start_date: templateFields.tanggal_dari }),\n        ...(templateFields.tanggal_sampai && { implementation_end_date: templateFields.tanggal_sampai }),\n      };\n\n      const saveResponse = await fetch(`/api/reviewer/simloks/${submissionId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!saveResponse.ok) {\n        throw new Error('Gagal menyimpan template approval');\n      }\n\n      // 2. Submit review\n      const reviewResponse = await fetch(`/api/reviewer/simloks/${submissionId}/review`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(reviewData),\n      });\n\n      if (!reviewResponse.ok) {\n        const errorData = await reviewResponse.json();\n        throw new Error(errorData.error || 'Gagal mengirim review');\n      }\n\n      const data = await reviewResponse.json();\n      setSubmission(data.submission);\n      showSuccess('Berhasil', 'Review berhasil dikirim dan template approval tersimpan');\n      onReviewSubmitted();\n\n    } catch (err: any) {\n      console.error('Error submitting review and saving template:', err);\n      showError('Error', err.message || 'Gagal mengirim review');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDeleteWorker = (workerId: string) => {\n    if (!submission || !window.confirm('Apakah Anda yakin ingin menghapus foto pekerja ini?')) {\n      return;\n    }\n\n    // Remove the worker from the local state only\n    setSubmission(prevSubmission => {\n      if (!prevSubmission) return null;\n      return {\n        ...prevSubmission,\n        worker_list: prevSubmission.worker_list.filter(worker => worker.id !== workerId)\n      };\n    });\n\n    // Add to deletion list\n    setWorkersToDelete(prev => [...prev, workerId]);\n\n    // Mark that there are changes\n    setHasWorkerChanges(true);\n\n    showSuccess('Berhasil', 'Foto pekerja akan dihapus setelah menyimpan perubahan');\n  };\n\n  const deleteWorkersFromDatabase = async () => {\n    if (workersToDelete.length === 0) return;\n\n    for (const workerId of workersToDelete) {\n      try {\n        const response = await fetch(`/api/reviewer/simloks/${submissionId}/workers/${workerId}`, {\n          method: 'DELETE',\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error || 'Gagal menghapus foto pekerja');\n        }\n      } catch (err) {\n        console.error('Error deleting worker:', err);\n        throw err;\n      }\n    }\n  };\n\n  const handleSaveWorkerChanges = async () => {\n    if (!hasWorkerChanges && workersToDelete.length === 0) {\n      setIsEditingWorkers(false);\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      // Delete workers from database first\n      await deleteWorkersFromDatabase();\n\n      // Call the regular save changes function for other worker data updates\n      if (hasWorkerChanges) {\n        await handleSaveChanges();\n      }\n\n      // Reset states\n      setHasWorkerChanges(false);\n      setIsEditingWorkers(false);\n      setWorkersToDelete([]);\n      setOriginalWorkerList([]);\n\n    } catch (err: any) {\n      console.error('Error saving worker changes:', err);\n      showError('Error', err.message || 'Gagal menyimpan perubahan data pekerja');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleCancelWorkerEdit = () => {\n    if (hasWorkerChanges || workersToDelete.length > 0) {\n      const confirmed = window.confirm('Ada perubahan yang belum disimpan. Apakah Anda yakin ingin membatalkan?');\n      if (!confirmed) {\n        return;\n      }\n    }\n\n    // Restore original worker list if we have it\n    if (originalWorkerList.length > 0 && submission) {\n      setSubmission(prev => {\n        if (prev) {\n          return {\n            ...prev,\n            worker_list: [...originalWorkerList]\n          };\n        }\n        return prev;\n      });\n    }\n\n    // Reset all states\n    setIsEditingWorkers(false);\n    setHasWorkerChanges(false);\n    setWorkersToDelete([]);\n    setOriginalWorkerList([]);\n  };\n\n  const handleEditWorkerMode = () => {\n    // Save original worker list for cancel functionality\n    if (submission?.worker_list) {\n      setOriginalWorkerList([...submission.worker_list]);\n    }\n    setIsEditingWorkers(true);\n  };\n\n  const canEdit = submission && submission.final_status === 'PENDING_APPROVAL';\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_REVIEW':\n        return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">Detail & Review Pengajuan</h2>\n            {submission && (\n              <div className=\"text-sm text-gray-500 mt-1 space-y-1\">\n                <p>\n                  <span className=\"font-medium\">{submission.vendor_name}</span> - {submission.officer_name}\n                </p>\n                {submission.simlok_number && (\n                  <p className=\"text-xs\">\n                    <span className=\"font-medium\">No. SIMLOK:</span> {submission.simlok_number}\n                    {submission.simlok_date && (\n                      <span className=\"ml-2\">• <span className=\"font-medium\">Tanggal:</span> {formatDate(submission.simlok_date)}</span>\n                    )}\n                  </p>\n                )}\n                <p className=\"text-xs\">\n                  <span className=\"font-medium\">ID Pengajuan:</span> {submission.id}\n                </p>\n                \n                {/* Scan Status */}\n                <div className=\"mt-2 pt-2 border-t border-gray-100\">\n                  {loadingScanHistory ? (\n                    <div className=\"flex items-center text-xs text-gray-500\">\n                      <ClockIcon className=\"h-3 w-3 mr-1 animate-spin\" />\n                      Memuat status scan...\n                    </div>\n                  ) : scanHistory ? (\n                    <div className=\"space-y-1\">\n                      {scanHistory.hasBeenScanned ? (\n                        <div className=\"flex items-center text-xs text-green-600\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span className=\"font-medium\">SIMLOK telah discan</span>\n                          <span className=\"ml-2\">({scanHistory.totalScans}x)</span>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                          <span>SIMLOK belum discan</span>\n                        </div>\n                      )}\n                      \n                      {scanHistory.lastScan && (\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <ClockIcon className=\"h-3 w-3 mr-1\" />\n                          <span>Terakhir discan: {new Date(scanHistory.lastScan.scanned_at).toLocaleDateString('id-ID', {\n                            day: 'numeric',\n                            month: 'short',\n                            year: 'numeric',\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}</span>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center text-xs text-gray-400\">\n                      <QrCodeIcon className=\"h-3 w-3 mr-1\" />\n                      <span>Status scan tidak tersedia</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n          <Button\n            onClick={onClose}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-gray-400 hover:text-gray-600\"\n          >\n            <XMarkIcon className=\"h-6 w-6\" />\n          </Button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"border-b border-gray-200 flex-shrink-0\">\n          <nav className=\"flex space-x-8 px-6\">\n            <button\n              onClick={() => setActiveTab('details')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'details'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <DocumentTextIcon className=\"h-5 w-5 inline mr-2\" />\n              Detail SIMLOK\n            </button>\n            <button\n              onClick={() => setActiveTab('workers')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'workers'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <UserGroupIcon className=\"h-5 w-5 inline mr-2\" />\n              Data Pekerja\n            </button>\n            <button\n              onClick={() => setActiveTab('review')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'review'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n                }`}\n            >\n              <CheckCircleIcon className=\"h-5 w-5 inline mr-2\" />\n              Review\n            </button>\n          </nav>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n            </div>\n          )}\n\n          {submission && (\n            <>\n              {/* Details Tab */}\n              {activeTab === 'details' && (\n                <div className=\"space-y-8\">\n                  {/* Header with Status and Actions */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <h3 className=\"text-lg font-medium text-gray-900\">Informasi SIMLOK</h3>\n                      <div className=\"flex items-center space-x-3\">\n                        <span className=\"text-sm text-gray-500\">Review:</span>\n                        {getStatusBadge(submission.review_status)}\n                        <span className=\"text-sm text-gray-500\">Status:</span>\n                        {getStatusBadge(submission.final_status)}\n                      </div>\n                    </div>\n                    {canEdit && !isEditing && (\n                      <Button\n                        onClick={() => setIsEditing(true)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"text-blue-600 border-blue-600 hover:bg-blue-50\"\n                      >\n                        <PencilIcon className=\"h-4 w-4 mr-1\" />\n                        Edit Data\n                      </Button>\n                    )}\n                    {isEditing && (\n                      <div className=\"space-x-2\">\n                        <Button\n                          onClick={() => setIsEditing(false)}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          disabled={saving}\n                        >\n                          Batal\n                        </Button>\n                        <Button\n                          onClick={handleSaveChanges}\n                          variant=\"primary\"\n                          size=\"sm\"\n                          disabled={saving}\n                        >\n                          {saving ? 'Menyimpan...' : 'Simpan'}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n\n                  {!canEdit && submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\n                      <div className=\"flex\">\n                        <div className=\"flex-shrink-0\">\n                          <XCircleIcon className=\"h-5 w-5 text-blue-400\" />\n                        </div>\n                        <div className=\"ml-3\">\n                          <h3 className=\"text-sm font-medium text-blue-800\">Informasi</h3>\n                          <div className=\"mt-2 text-sm text-blue-700\">\n                            <p>Data tidak dapat diedit karena sudah difinalisasi oleh approver.</p>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Data Vendor */}\n                  <div className=\"bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-6\">Data Vendor & Penanggung Jawab</h4>\n                    \n                    <div className=\"space-y-6\">\n                      {/* Informasi Vendor */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-6\">Informasi Vendor</h5>\n                        \n                        {/* Informasi Perusahaan */}\n                        <div className=\"mb-6\">\n                          <h6 className=\"text-sm font-medium text-gray-800 mb-4 pb-2 border-b border-gray-200\">Informasi Perusahaan</h6>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nama Perusahaan Vendor <span className=\"text-red-500\">*</span>\n                              </label>\n                              {isEditing ? (\n                                <input\n                                  type=\"text\"\n                                  value={formData.vendor_name}\n                                  onChange={(e) => setFormData({ ...formData, vendor_name: e.target.value })}\n                                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                                  placeholder=\"Nama perusahaan vendor\"\n                                />\n                              ) : (\n                                <p className=\"text-gray-900 py-2 font-medium\">{submission.vendor_name}</p>\n                              )}\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nomor Telepon Vendor\n                              </label>\n                              {isEditing ? (\n                                <input\n                                  type=\"tel\"\n                                  value={formData.vendor_phone || ''}\n                                  onChange={(e) => setFormData({ ...formData, vendor_phone: e.target.value })}\n                                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                                  placeholder=\"Contoh: 0812-3456-7890\"\n                                />\n                              ) : (\n                                <p className=\"text-gray-900 py-2\">\n                                  {submission.vendor_phone || (\n                                    <span className=\"text-gray-400 italic\">Belum diisi</span>\n                                  )}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Penanggung Jawab */}\n                        <div>\n                          <h6 className=\"text-sm font-medium text-gray-800 mb-4 pb-2 border-b border-gray-200\">Penanggung Jawab Pengajuan</h6>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Nama Petugas <span className=\"text-red-500\">*</span>\n                              </label>\n                              {isEditing ? (\n                                <input\n                                  type=\"text\"\n                                  value={formData.officer_name}\n                                  onChange={(e) => setFormData({ ...formData, officer_name: e.target.value })}\n                                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                                  placeholder=\"Nama petugas penanggung jawab\"\n                                />\n                              ) : (\n                                <p className=\"text-gray-900 py-2 font-medium\">{submission.officer_name}</p>\n                              )}\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Email Kontak\n                              </label>\n                              <p className=\"text-gray-900 py-2\">{submission.officer_email || '-'}</p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Dokumen Dasar */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-4\">Berdasarkan</h5>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                            Dokumen Dasar / Referensi <span className=\"text-red-500\">*</span>\n                          </label>\n                          {isEditing ? (\n                            <textarea\n                              value={formData.based_on}\n                              onChange={(e) => setFormData({ ...formData, based_on: e.target.value })}\n                              rows={4}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                              placeholder=\"Contoh: SPK No. XXX/YYY/ZZZ tanggal DD-MM-YYYY atau Work Order No. ABC123\"\n                            />\n                          ) : (\n                            <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                              <p className=\"text-gray-900 whitespace-pre-line leading-relaxed\">{submission.based_on}</p>\n                            </div>\n                          )}\n                          <p className=\"text-xs text-gray-500 mt-3\">\n                            Dokumen kontrak, SPK, Work Order, atau referensi lain yang menjadi dasar pengajuan SIMLOK\n                          </p>\n                        </div>\n                      </div>\n\n                      {/* Status Pengajuan */}\n                      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n                        <h5 className=\"text-lg font-semibold text-gray-900 mb-4\">Status Pengajuan</h5>\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Tanggal Pengajuan</div>\n                            <div className=\"text-base font-semibold text-gray-900\">\n                              {formatDate(submission.created_at)}\n                            </div>\n                          </div>\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Status Review</div>\n                            <div>{getStatusBadge(submission.review_status)}</div>\n                          </div>\n                          <div className=\"bg-white rounded-md p-4 border border-gray-200\">\n                            <div className=\"text-sm text-gray-600 mb-2 font-medium\">Status Persetujuan</div>\n                            <div>{getStatusBadge(submission.final_status)}</div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Informasi Pekerjaan */}\n                  <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Informasi Pekerjaan</h4>\n                    <div className=\"space-y-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Deskripsi Pekerjaan <span className=\"text-red-500\">*</span>\n                        </label>\n                        {isEditing ? (\n                          <textarea\n                            value={formData.job_description}\n                            onChange={(e) => setFormData({ ...formData, job_description: e.target.value })}\n                            rows={3}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            placeholder=\"Deskripsi detail pekerjaan yang akan dilakukan\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 whitespace-pre-line\">{submission.job_description}</p>\n                          </div>\n                        )}\n                      </div>\n                      \n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Lokasi Kerja <span className=\"text-red-500\">*</span>\n                          </label>\n                          {isEditing ? (\n                            <input\n                              type=\"text\"\n                              value={formData.work_location}\n                              onChange={(e) => setFormData({ ...formData, work_location: e.target.value })}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                              placeholder=\"Lokasi tempat kerja\"\n                            />\n                          ) : (\n                            <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                              <p className=\"text-gray-900 font-medium\">{submission.work_location}</p>\n                            </div>\n                          )}\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Jam Kerja\n                          </label>\n                          {isEditing ? (\n                            <input\n                              type=\"text\"\n                              value={formData.working_hours}\n                              onChange={(e) => setFormData({ ...formData, working_hours: e.target.value })}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                              placeholder=\"Jam kerja (contoh: 08:00 - 16:00)\"\n                            />\n                          ) : (\n                            <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                              <p className=\"text-gray-900 font-medium\">{submission.working_hours || 'Tidak ditentukan'}</p>\n                            </div>\n                          )}\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Jumlah Pekerja\n                          </label>\n                          {isEditing ? (\n                            <input\n                              type=\"number\"\n                              min=\"1\"\n                              max=\"100\"\n                              value={formData.worker_count || ''}\n                              onChange={(e) => setFormData({ ...formData, worker_count: parseInt(e.target.value) || 0 })}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                              placeholder=\"Jumlah pekerja\"\n                            />\n                          ) : (\n                            <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                              <p className=\"text-gray-900 font-bold text-lg\">{submission.worker_count || 0} <span className=\"text-sm font-normal\">orang</span></p>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* Informasi Tambahan */}\n                      {(submission.work_facilities || submission.implementation || submission.other_notes) && (\n                        <div className=\"border-t border-gray-200 pt-4 space-y-4\">\n                          {submission.work_facilities && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Fasilitas Kerja\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm\">{submission.work_facilities}</p>\n                              </div>\n                            </div>\n                          )}\n                          \n                          {submission.implementation && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Keterangan Pelaksanaan\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm whitespace-pre-line\">{submission.implementation}</p>\n                              </div>\n                            </div>\n                          )}\n\n                          {submission.other_notes && (\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                                Catatan Lainnya\n                              </label>\n                              <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                                <p className=\"text-gray-900 text-sm whitespace-pre-line\">{submission.other_notes}</p>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Dokumen Pendukung */}\n                  <div className=\"bg-gray-50 rounded-lg p-6 border border-gray-200\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Dokumen Pendukung</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Nomor SIMJA\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"text\"\n                            value={formData.simja_number}\n                            onChange={(e) => setFormData({ ...formData, simja_number: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            placeholder=\"Nomor SIMJA\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">{submission.simja_number}</p>\n                          </div>\n                        )}\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal SIMJA\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"date\"\n                            value={formData.simja_date}\n                            onChange={(e) => setFormData({ ...formData, simja_date: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">\n                              {submission.simja_date ? new Date(submission.simja_date).toLocaleDateString('id-ID') : '-'}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Nomor SIKA\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"text\"\n                            value={formData.sika_number}\n                            onChange={(e) => setFormData({ ...formData, sika_number: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            placeholder=\"Nomor SIKA\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">{submission.sika_number}</p>\n                          </div>\n                        )}\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal SIKA\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"date\"\n                            value={formData.sika_date}\n                            onChange={(e) => setFormData({ ...formData, sika_date: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">\n                              {submission.sika_date ? new Date(submission.sika_date).toLocaleDateString('id-ID') : '-'}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Jadwal Pelaksanaan */}\n                  <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6\">\n                    <h4 className=\"text-base font-semibold text-gray-900 mb-4\">Jadwal Pelaksanaan</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal Mulai Pelaksanaan\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"date\"\n                            value={formData.implementation_start_date}\n                            onChange={(e) => setFormData({ ...formData, implementation_start_date: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">\n                              {submission.implementation_start_date ? new Date(submission.implementation_start_date).toLocaleDateString('id-ID') : '-'}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Tanggal Selesai Pelaksanaan\n                        </label>\n                        {isEditing ? (\n                          <input\n                            type=\"date\"\n                            value={formData.implementation_end_date}\n                            onChange={(e) => setFormData({ ...formData, implementation_end_date: e.target.value })}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                          />\n                        ) : (\n                          <div className=\"bg-white p-3 border border-gray-200 rounded-lg\">\n                            <p className=\"text-gray-900 font-medium\">\n                              {submission.implementation_end_date ? new Date(submission.implementation_end_date).toLocaleDateString('id-ID') : '-'}\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Workers Tab */}\n              {activeTab === 'workers' && (\n                <div className=\"space-y-6\">\n                  {/* Header */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-2\">\n                      <h3 className=\"text-lg font-medium text-gray-900\">Data Pekerja</h3>\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n                          {submission.worker_count || 0} total\n                        </span>\n                        <span className=\"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n                          {submission.worker_list.length} foto\n                        </span>\n                      </div>\n                    </div>\n\n                    {/* Edit/Cancel Buttons */}\n                    {canEdit && (\n                      <div className=\"flex items-center space-x-2\">\n                        {!isEditingWorkers ? (\n                          <Button\n                            onClick={handleEditWorkerMode}\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"text-blue-600 border-blue-600 hover:bg-blue-50\"\n                          >\n                            <PencilIcon className=\"h-4 w-4 mr-1\" />\n                            Edit Data Pekerja\n                          </Button>\n                        ) : (\n                          <div className=\"flex items-center space-x-2\">\n                            <Button\n                              onClick={handleCancelWorkerEdit}\n                              variant=\"outline\"\n                              size=\"sm\"\n                              disabled={saving}\n                            >\n                              Batal\n                            </Button>\n                            <Button\n                              onClick={handleSaveWorkerChanges}\n                              variant=\"primary\"\n                              size=\"sm\"\n                              disabled={saving}\n                              className={hasWorkerChanges ? 'bg-orange-600 hover:bg-orange-700' : ''}\n                            >\n                              {saving ? 'Menyimpan...' : hasWorkerChanges ? 'Simpan Perubahan' : 'Selesai Edit'}\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Input Jumlah Pekerja */}\n                  <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1 mr-4\">\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                          Jumlah Total Pekerja\n                        </label>\n                        <p className=\"text-xs text-gray-500 mb-2\">\n                          Masukkan jumlah total pekerja yang akan dipekerjakan untuk proyek ini\n                        </p>\n                        {isEditingWorkers ? (\n                          <input\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"9999\"\n                            value={formData.worker_count || ''}\n                            onChange={(e) => {\n                              const inputValue = e.target.value;\n                              if (inputValue === '') {\n                                setFormData({ ...formData, worker_count: 0 });\n                                setHasWorkerChanges(true);\n                                return;\n                              }\n                              const value = Math.max(0, parseInt(inputValue) || 0);\n                              setFormData({ ...formData, worker_count: value });\n                              setHasWorkerChanges(true);\n                            }}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                            placeholder=\"Masukkan jumlah pekerja (0-9999)\"\n                          />\n                        ) : (\n                          <div className=\"px-3 py-2 bg-white border border-gray-300 rounded-md text-gray-900\">\n                            {submission.worker_count || 0} orang\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex-shrink-0\">\n                        <div className=\"text-sm text-gray-600\">\n                          <div>Foto terupload: <span className=\"font-medium text-blue-600\">{submission.worker_list.length}</span></div>\n                          {(formData.worker_count || submission.worker_count) && (formData.worker_count || submission.worker_count) !== submission.worker_list.length && (\n                            <div className={`mt-1 font-medium ${(formData.worker_count || submission.worker_count || 0) > submission.worker_list.length\n                              ? 'text-orange-600'\n                              : 'text-red-600'\n                              }`}>\n                              {(formData.worker_count || submission.worker_count || 0) > submission.worker_list.length\n                                ? `Kurang ${(formData.worker_count || submission.worker_count || 0) - submission.worker_list.length} foto`\n                                : `Kelebihan ${submission.worker_list.length - (formData.worker_count || submission.worker_count || 0)} foto`\n                              }\n                            </div>\n                          )}\n                          {(formData.worker_count || submission.worker_count) === submission.worker_list.length && (\n                            <div className=\"text-green-600 mt-1 font-medium\">\n                              Jumlah sudah sesuai\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Info jika jumlah tidak sesuai */}\n                  {submission.worker_count && submission.worker_count !== submission.worker_list.length && (\n                    <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0\">\n                          <svg className=\"h-5 w-5 text-orange-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </div>\n                        <div className=\"ml-3\">\n                          <h3 className=\"text-sm font-medium text-orange-800\">Informasi Penting</h3>\n                          <p className=\"text-sm text-orange-700 mt-1\">\n                            Jumlah pekerja yang diajukan adalah <strong>{submission.worker_count} orang</strong>,\n                            tetapi foto yang diupload hanya <strong>{submission.worker_list.length} foto</strong>.\n                            {submission.worker_count > submission.worker_list.length\n                              ? ' Mungkin ada pekerja yang belum mengupload foto.'\n                              : ' Ada lebih banyak foto dari yang diajukan.'\n                            }\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Edit Mode Info */}\n                  {canEdit && isEditingWorkers && (\n                    <div className={`${hasWorkerChanges ? 'bg-orange-50 border-orange-200' : 'bg-blue-50 border-blue-200'} border rounded-lg p-4 mb-6`}>\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0\">\n                          {hasWorkerChanges ? (\n                            <svg className=\"h-5 w-5 text-orange-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                              <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                            </svg>\n                          ) : (\n                            <svg className=\"h-5 w-5 text-blue-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                              <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                            </svg>\n                          )}\n                        </div>\n                        <div className=\"ml-3\">\n                          <h3 className={`text-sm font-medium ${hasWorkerChanges ? 'text-orange-800' : 'text-blue-800'}`}>\n                            {hasWorkerChanges ? 'Ada Perubahan Belum Disimpan' : 'Mode Edit Aktif'}\n                          </h3>\n                          <p className={`text-sm ${hasWorkerChanges ? 'text-orange-700' : 'text-blue-700'} mt-1`}>\n                            {hasWorkerChanges\n                              ? 'Anda telah melakukan perubahan data pekerja. Jangan lupa untuk menyimpan perubahan.'\n                              : 'Sekarang Anda dapat menghapus foto pekerja. Hover pada foto untuk melihat tombol hapus.'\n                            }\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.worker_list.length === 0 ? (\n                    <div className=\"text-center py-16\">\n                      <UserGroupIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada foto pekerja</h3>\n                      <p className=\"text-gray-500 max-w-md mx-auto\">\n                        Foto pekerja akan ditampilkan di sini setelah vendor mengupload data pekerja.\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                      {submission.worker_list.map((worker) => (\n                        <div\n                          key={worker.id}\n                          className=\"bg-white rounded-lg border border-gray-200 hover:border-gray-300 transition-all duration-200 overflow-hidden shadow-sm hover:shadow-md group\"\n                        >\n                          {/* Photo Section */}\n                          <div className=\"relative p-4 pb-2\">\n                            <div className=\"relative\">\n                              {worker.worker_photo ? (\n                                <img\n                                  src={worker.worker_photo.startsWith('/') ? worker.worker_photo : `/${worker.worker_photo}`}\n                                  alt={`Foto ${worker.worker_name}`}\n                                  className=\"w-full h-48 rounded-lg object-cover shadow-sm\"\n                                  onLoad={() => console.log('Worker tab - Image loaded successfully for:', worker.worker_name)}\n                                  onError={(e) => {\n                                    console.log('Worker tab - Image load error for worker:', worker.worker_name, 'URL:', worker.worker_photo);\n                                    console.log('Worker tab - Full processed URL:', worker.worker_photo.startsWith('/') ? worker.worker_photo : `/${worker.worker_photo}`);\n                                    const target = e.target as HTMLImageElement;\n                                    target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgODBDMTA4LjI4NCA4MCA5Ni41NjggODggOTYuNTY4IDEwMEM5Ni41NjggMTEyIDEwOC4yODQgMTIwIDEwMCAxMjBDOTEuNzE2IDEyMCA4My40MzIgMTEyIDgzLjQzMiAxMDBDODMuNDMyIDg4IDkxLjcxNiA4MCA5Ni41NjggODBIMTAwWiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMTQwIDEzNkMxNDAgMTI2LjMyIDEzMi4wOTEgMTE4IDEyMiAxMThaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=';\n                                  }}\n                                />\n                              ) : (\n                                <div className=\"w-full h-48 rounded-lg bg-gray-200 flex items-center justify-center shadow-sm\">\n                                  <div className=\"text-center text-gray-500\">\n                                    <svg className=\"w-12 h-12 mx-auto mb-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                      <path fillRule=\"evenodd\" d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\" clipRule=\"evenodd\" />\n                                    </svg>\n                                    <p className=\"text-sm\">Tidak ada foto</p>\n                                  </div>\n                                </div>\n                              )}\n\n                              {/* Delete Button - Only show if can edit and in editing mode */}\n                              {canEdit && isEditingWorkers && (\n                                <button\n                                  onClick={() => handleDeleteWorker(worker.id)}\n                                  className=\"absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-lg\"\n                                  title=\"Hapus foto pekerja\"\n                                >\n                                  <TrashIcon className=\"w-4 h-4\" />\n                                </button>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Info Section */}\n                          <div className=\"px-4 pb-4\">\n                            <h4 className=\"font-semibold text-gray-900 text-sm mb-1 truncate\">\n                              {worker.worker_name}\n                            </h4>\n                            <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                              <span>Upload:</span>\n                              <span>\n                                {new Date(worker.created_at).toLocaleDateString('id-ID', {\n                                  day: '2-digit',\n                                  month: 'short',\n                                  year: 'numeric'\n                                })}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Review Tab */}\n              {activeTab === 'review' && (\n                <div className=\"  space-y-8\">\n                  {/* Header Section */}\n                  <div className=\"pb-6 border-b border-gray-200\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"flex-shrink-0\">\n                        <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                          <CheckCircleIcon className=\"h-6 w-6 text-blue-600\" />\n                        </div>\n                      </div>\n                      <div>\n                        <h2 className=\"text-xl font-bold text-gray-900\">Review Pengajuan SIMLOK</h2>\n                        <p className=\"text-gray-600 mt-1\">{submission.vendor_name}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Review Status Display */}\n                  {submission.review_status !== 'PENDING_REVIEW' && (\n                    <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 mb-8\">\n                      <div className=\"flex items-start space-x-4\">\n                        <div className=\"flex-shrink-0\">\n                          <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                            <CheckCircleIcon className=\"h-6 w-6 text-blue-600\" />\n                          </div>\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center space-x-3 mb-3\">\n                            <h4 className=\"text-lg font-semibold text-gray-900\">Review Selesai</h4>\n                            {getStatusBadge(submission.review_status)}\n                          </div>\n                          {submission.review_note && (\n                            <div className=\"bg-white rounded-lg p-4 border border-blue-100\">\n                              <h5 className=\"font-medium text-gray-900 mb-2\">Catatan Review</h5>\n                              <p className=\"text-gray-700 whitespace-pre-line leading-relaxed\">{submission.review_note}</p>\n                            </div>\n                          )}\n                          <div className=\"mt-4 space-y-3\">\n                            {/* Review Info */}\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500\">\n                              <div>\n                                <span className=\"font-medium\">Direview pada:</span><br />\n                                {submission.reviewed_at ? formatDate(submission.reviewed_at) : '-'}\n                              </div>\n                              <div>\n                                {submission.reviewed_by_name && (\n                                  <>\n                                    <span className=\"font-medium\">Reviewer:</span><br />\n                                    {submission.reviewed_by_name}\n                                    {submission.reviewed_by_email && (\n                                      <>\n                                        <br />\n                                        <span className=\"text-xs text-gray-400\">{submission.reviewed_by_email}</span>\n                                      </>\n                                    )}\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                            \n                            {/* Approval Info - Show if final status is not PENDING_APPROVAL */}\n                            {submission.final_status !== 'PENDING_APPROVAL' && (\n                              <div className=\"border-t border-blue-200 pt-3\">\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500\">\n                                  <div>\n                                    <span className=\"font-medium\">Status Persetujuan:</span><br />\n                                    <div className=\"mt-1\">{getStatusBadge(submission.final_status)}</div>\n                                    {submission.approved_at && (\n                                      <div className=\"mt-1\">\n                                        Difinalisasi pada: {formatDate(submission.approved_at)}\n                                      </div>\n                                    )}\n                                  </div>\n                                  <div>\n                                    {submission.approved_by_name && (\n                                      <>\n                                        <span className=\"font-medium\">Approver:</span><br />\n                                        {submission.approved_by_name}\n                                        {submission.approved_by_email && (\n                                          <>\n                                            <br />\n                                            <span className=\"text-xs text-gray-400\">{submission.approved_by_email}</span>\n                                          </>\n                                        )}\n                                      </>\n                                    )}\n                                  </div>\n                                </div>\n                                {submission.final_note && (\n                                  <div className=\"mt-3 p-3 bg-white rounded-lg border border-blue-100\">\n                                    <span className=\"font-medium text-gray-700\">Catatan Approver:</span>\n                                    <p className=\"text-gray-600 mt-1 text-sm\">{submission.final_note}</p>\n                                  </div>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Review Form */}\n                  {canEdit && (\n\n                      <div className=\"space-y-6\">\n\n\n                        {/* Catatan Review */}\n                        <div className=\"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm\">\n                          <div className=\"flex items-center mb-4\">\n                            <div className=\"flex-shrink-0\">\n                              <svg className=\"h-6 w-6 text-gray-600 mr-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                            <h5 className=\"text-lg font-bold text-gray-900\">Catatan Review</h5>\n                          </div>\n                          <div className=\"space-y-4\">\n                            {/* Catatan untuk Approver */}\n                            <div>\n                              <label className=\"block text-sm font-semibold text-gray-800 mb-2\">\n                                Catatan untuk Approver <span className=\"text-red-500\">*</span>\n                              </label>\n                              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3\">\n                                <p className=\"text-xs text-blue-700 flex items-center\">\n                                  <svg className=\"h-4 w-4 mr-2 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                    <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                                  </svg>\n                                  Catatan ini akan diteruskan ke Approver untuk membantu pengambilan keputusan final\n                                </p>\n                              </div>\n                              <textarea\n                                value={reviewData.review_note}\n                                onChange={(e) => setReviewData({ ...reviewData, review_note: e.target.value })}\n                                rows={4}\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none\"\n                                placeholder=\"Berikan penjelasan detail mengenai hasil review, termasuk poin-poin yang perlu diperhatikan approver...\"\n                                required\n                              />\n                            </div>\n\n                            {/* Catatan Khusus untuk Vendor */}\n                            <div>\n                              <label className=\"block text-sm font-semibold text-gray-800 mb-2\">\n                                Catatan Khusus untuk Vendor\n                              </label>\n                              <textarea\n                                value={approvalForm.vendor_note}\n                                onChange={(e) => setApprovalForm(prev => ({ ...prev, vendor_note: e.target.value }))}\n                                rows={3}\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none\"\n                                placeholder=\"Catatan khusus yang perlu diperhatikan vendor (opsional)...\"\n                              />\n                              <p className=\"text-xs text-gray-500 mt-2\">\n                                Catatan ini akan dilihat oleh vendor dan akan disertakan dalam PDF SIMLOK\n                              </p>\n                            </div>\n\n                            {/* Informasi Tambahan */}\n                            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                              <div className=\"flex items-start space-x-3\">\n                                <div className=\"flex-shrink-0\">\n                                  <svg className=\"h-5 w-5 text-blue-600 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                    <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                                  </svg>\n                                </div>\n                                <div>\n                                  <h6 className=\"text-sm font-medium text-blue-800 mb-1\">Catatan Penting</h6>\n                                  <p className=\"text-sm text-blue-700\">\n                                    Catatan review akan diteruskan kepada Approver untuk membantu pengambilan keputusan final.\n                                    Pastikan catatan yang diberikan jelas dan objektif.\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n\n                          {reviewData.review_status && !reviewData.review_note.trim() && (\n                            <div className=\"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                              <p className=\"text-red-600 text-sm font-medium\">Catatan untuk Approver wajib diisi</p>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Submit Button - Removed from here, will be at the bottom */}\n                      </div>\n                  )}\n\n                  {/* Persiapan Approval Form - Hanya untuk yang bisa edit */}\n                  {canEdit && (\n                    <div className=\"bg-white border border-gray-200 rounded-lg shadow-sm mt-8\">\n                      <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center\">\n                            <svg className=\"h-5 w-5 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                              <path fillRule=\"evenodd\" d=\"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z\" clipRule=\"evenodd\" />\n                            </svg>\n                          </div>\n                          <div>\n                            <h3 className=\"text-lg font-semibold text-gray-900\">Template Persiapan Approval</h3>\n                            <p className=\"text-sm text-gray-600\">\n                              Lengkapi data untuk mempersiapkan template approval yang akan digunakan admin\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"p-6 space-y-8\">\n                        {/* Tanggal Pelaksanaan */}\n                        <div>\n                          <div className=\"flex items-center space-x-2 mb-4\">\n                            <div className=\"w-6 h-6 bg-blue-100 rounded flex items-center justify-center\">\n                              <svg className=\"h-4 w-4 text-blue-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                            <h4 className=\"text-base font-medium text-gray-900\">Jadwal Pelaksanaan</h4>\n                          </div>\n\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal Mulai</label>\n                              <DatePicker\n                                value={templateFields.tanggal_dari}\n                                onChange={(value) => setTemplateFields(prev => ({ ...prev, tanggal_dari: value }))}\n                                placeholder=\"Pilih tanggal mulai\"\n                                className=\"w-full\"\n                              />\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tanggal Selesai</label>\n                              <DatePicker\n                                value={templateFields.tanggal_sampai}\n                                onChange={(value) => setTemplateFields(prev => ({ ...prev, tanggal_sampai: value }))}\n                                placeholder=\"Pilih tanggal selesai\"\n                                className=\"w-full\"\n                              />\n                            </div>\n                          </div>\n\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Keterangan Pelaksanaan</label>\n                            <textarea\n                              value={approvalForm.pelaksanaan}\n                              onChange={(e) => setApprovalForm(prev => ({ ...prev, pelaksanaan: e.target.value }))}\n                              rows={3}\n                              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                              placeholder=\"Contoh: Terhitung mulai tanggal 15 Januari 2024 sampai 20 Januari 2024. Termasuk hari Sabtu, Minggu dan hari libur lainnya.\"\n                            />\n                          </div>\n                        </div>\n\n                        {/* Penandatangan */}\n                        <div>\n                          <div className=\"flex items-center space-x-2 mb-4\">\n                            <div className=\"w-6 h-6 bg-green-100 rounded flex items-center justify-center\">\n                              <svg className=\"h-4 w-4 text-green-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                            <h4 className=\"text-base font-medium text-gray-900\">Data Penandatangan</h4>\n                          </div>\n\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Jabatan</label>\n                              <input\n                                type=\"text\"\n                                value={approvalForm.jabatan_signer}\n                                onChange={(e) => setApprovalForm(prev => ({ ...prev, jabatan_signer: e.target.value }))}\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                                placeholder=\"Sr Officer Security III\"\n                              />\n                            </div>\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nama Lengkap</label>\n                              <input\n                                type=\"text\"\n                                value={approvalForm.nama_signer}\n                                onChange={(e) => setApprovalForm(prev => ({ ...prev, nama_signer: e.target.value }))}\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                                placeholder=\"Masukkan nama penandatangan\"\n                              />\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Template Lain-lain */}\n                        <div>\n                          <div className=\"flex items-center space-x-2 mb-4\">\n                            <div className=\"w-6 h-6 bg-purple-100 rounded flex items-center justify-center\">\n                              <svg className=\"h-4 w-4 text-purple-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                            <h4 className=\"text-base font-medium text-gray-900\">Template Lain-lain untuk Admin</h4>\n                            <span className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">Template SIMLOK</span>\n                          </div>\n\n                          <div className=\"space-y-3\">\n                            {/* Preview dengan formatting */}\n                            <div className=\"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-sm\">\n                              <div className=\"font-medium text-gray-700 mb-2\">Preview (dengan formatting):</div>\n                              <div \n                                className=\"whitespace-pre-line text-sm text-gray-900\"\n                                dangerouslySetInnerHTML={{\n                                  __html: approvalForm.lain_lain\n                                }}\n                              />\n                            </div>\n                            \n                            {/* Rich Text Editor untuk editing */}\n                            <RichTextEditor\n                              value={approvalForm.lain_lain}\n                              onChange={(value) => setApprovalForm(prev => ({ ...prev, lain_lain: value }))}\n                              rows={6}\n                              placeholder=\"Template ini akan digunakan admin saat approval SIMLOK. Auto-generate berdasarkan data SIMJA dan SIKA...\"\n                              className=\"text-sm\"\n                            />\n                          </div>\n                          \n                          <p className=\"text-xs text-gray-500 mt-2\">\n                            Template ini akan dikirim ke admin sebagai konten \"Lain-lain\" saat proses approval SIMLOK\n                          </p>\n\n                          {templateFields.tanggal_dari && templateFields.tanggal_sampai ? (\n                            <div className=\"mt-3 flex items-center space-x-2 text-sm text-green-700 bg-green-50 px-3 py-2 rounded-lg\">\n                              <svg className=\"h-4 w-4 text-green-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <span>Template berhasil dibuat otomatis berdasarkan data SIMJA dan SIKA</span>\n                            </div>\n                          ) : (\n                            <div className=\"mt-3 flex items-center space-x-2 text-sm text-amber-700 bg-amber-50 px-3 py-2 rounded-lg\">\n                              <svg className=\"h-4 w-4 text-amber-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <span>Pilih tanggal pelaksanaan untuk generate template otomatis</span>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Content Surat */}\n                        {/* <div>\n                          <div className=\"flex items-center space-x-2 mb-4\">\n                            <div className=\"w-6 h-6 bg-orange-100 rounded flex items-center justify-center\">\n                              <svg className=\"h-4 w-4 text-orange-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\n                              </svg>\n                            </div>\n                            <h4 className=\"text-base font-medium text-gray-900\">Isi Surat SIMLOK</h4>\n                          </div>\n\n                          <textarea\n                            value={approvalForm.content}\n                            onChange={(e) => setApprovalForm(prev => ({ ...prev, content: e.target.value }))}\n                            rows={4}\n                            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n                            placeholder=\"Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan tentang keamanan dan keselamatan kerja dan ketertiban...\"\n                          />\n                        </div> */}\n\n                      </div>\n                      {/* Status Selection */}\n                      <div className=\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-8 border border-gray-200 shadow-sm\">\n                        <div className=\"text-center mb-6\">\n                          <div className=\"inline-flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mb-3\">\n                            <CheckCircleIcon className=\"h-6 w-6 text-blue-600\" />\n                          </div>\n                          <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Keputusan Review</h3>\n                          <p className=\"text-gray-600 text-sm\">\n                            Pilih hasil review berdasarkan penilaian Anda terhadap pengajuan ini\n                          </p>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                          {/* Meets Requirements Option */}\n                          <label className={`\n                              relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                              ${reviewData.review_status === 'MEETS_REQUIREMENTS'\n                              ? 'border-green-500 bg-green-50 shadow-md'\n                              : 'border-gray-200 bg-white hover:border-green-300 hover:bg-green-50'\n                            }\n                            `}>\n                            <input\n                              type=\"radio\"\n                              name=\"review_status\"\n                              value=\"MEETS_REQUIREMENTS\"\n                              checked={reviewData.review_status === 'MEETS_REQUIREMENTS'}\n                              onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                  flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                  ${reviewData.review_status === 'MEETS_REQUIREMENTS'\n                                  ? 'border-green-500 bg-green-500'\n                                  : 'border-gray-300'\n                                }\n                                `}>\n                                {reviewData.review_status === 'MEETS_REQUIREMENTS' && (\n                                  <CheckCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Memenuhi Syarat</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan telah sesuai dengan persyaratan</div>\n                              </div>\n                            </div>\n                          </label>\n\n                          {/* Not Meets Requirements Option */}\n                          <label className={`\n                              relative flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200\n                              ${reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'\n                              ? 'border-red-500 bg-red-50 shadow-md'\n                              : 'border-gray-200 bg-white hover:border-red-300 hover:bg-red-50'\n                            }\n                            `}>\n                            <input\n                              type=\"radio\"\n                              name=\"review_status\"\n                              value=\"NOT_MEETS_REQUIREMENTS\"\n                              checked={reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'}\n                              onChange={(e) => setReviewData({ ...reviewData, review_status: e.target.value as any })}\n                              className=\"sr-only\"\n                            />\n                            <div className=\"flex items-center flex-1\">\n                              <div className={`\n                                  flex-shrink-0 w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center\n                                  ${reviewData.review_status === 'NOT_MEETS_REQUIREMENTS'\n                                  ? 'border-red-500 bg-red-500'\n                                  : 'border-gray-300'\n                                }\n                                `}>\n                                {reviewData.review_status === 'NOT_MEETS_REQUIREMENTS' && (\n                                  <XCircleIcon className=\"h-3 w-3 text-white\" />\n                                )}\n                              </div>\n                              <div>\n                                <div className=\"text-sm font-medium text-gray-900\">Tidak Memenuhi Syarat</div>\n                                <div className=\"text-xs text-gray-500\">Pengajuan perlu perbaikan atau penyesuaian</div>\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n                      </div>\n                      {/* Combined Submit Button */}\n                      <div className=\"border-t border-gray-200 bg-gray-50 px-6 py-6\">\n                        <div className=\"text-center mb-4\">\n                          <h4 className=\"text-lg font-semibold text-gray-900 mb-2\">Finalisasi Review</h4>\n                          <p className=\"text-gray-600 text-sm\">\n                            Pastikan semua data sudah benar sebelum mengirim review\n                          </p>\n                        </div>\n\n                        <Button\n                          onClick={handleSubmitReviewAndSave}\n                          variant=\"primary\"\n                          disabled={!reviewData.review_status || !reviewData.review_note.trim() || saving}\n                          className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-bold py-4 text-base transition-all duration-200 transform hover:scale-[1.02] shadow-lg hover:shadow-xl\"\n                        >\n                          {saving ? (\n                            <div className=\"flex items-center justify-center\">\n                              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3\"></div>\n                              <span>Mengirim Review & Menyimpan Template...</span>\n                            </div>\n                          ) : (\n                            <div className=\"flex items-center justify-center\">\n                              <svg className=\"h-5 w-5 mr-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l3-3z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <span>Submit Review</span>\n                            </div>\n                          )}\n                        </Button>\n\n                        <div className=\"flex items-center justify-center mt-4 text-xs text-gray-500\">\n                          <svg className=\"h-4 w-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                          </svg>\n                          Review akan dikirim ke approver untuk persetujuan final\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Information for Non-Editable Status */}\n                  {!canEdit && submission.final_status !== 'PENDING_APPROVAL' && (\n                    <div className=\"bg-gray-50 border border-gray-200 rounded-xl p-6\">\n                      <div className=\"flex items-start space-x-4\">\n                        <div className=\"flex-shrink-0\">\n                          <div className=\"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center\">\n                            <svg className=\"h-5 w-5 text-gray-600\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                              <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                            </svg>\n                          </div>\n                        </div>\n                        <div>\n                          <h4 className=\"text-base font-semibold text-gray-900 mb-1\">Informasi</h4>\n                          <p className=\"text-gray-600\">\n                            Pengajuan ini sudah difinalisasi dan tidak dapat direview ulang.\n                            Status saat ini: {getStatusBadge(submission.final_status)}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between p-6 border-t border-gray-200 flex-shrink-0 bg-white\">\n          <div>\n            {/* Tampilkan tombol PDF setelah reviewer memberikan status review */}\n            {submission?.review_status !== 'PENDING_REVIEW' && (\n              <Button onClick={handleViewPdf} variant=\"primary\" size=\"sm\">\n                <DocumentTextIcon className=\"w-4 h-4 mr-2\" />\n                Lihat Preview PDF SIMLOK\n              </Button>\n            )}\n          </div>\n          <Button onClick={onClose} variant=\"outline\">\n            Tutup\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submissionId}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n    </div>\n  );\n};\n\nexport default ReviewerSubmissionDetailModal;\n"
    },
    {
      "path": "src/components/reviewer/ReviewerSubmissionsManagement.tsx",
      "lang": "tsx",
      "size": 18075,
      "lines": 461,
      "hash": "01b0cdd782d607367895848bb63581ed5fb8b37e91899c9eba1438e1fdc52502",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  PencilIcon,\n  UserIcon,\n  ClipboardDocumentListIcon,\n} from \"@heroicons/react/24/outline\";\n\nimport Button from '@/components/ui/button/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport Alert from '@/components/ui/alert/Alert';\nimport ReviewerSubmissionDetailModal from './ReviewerSubmissionDetailModal';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  review_status: 'PENDING_REVIEW' | 'MEETS_REQUIREMENTS' | 'NOT_MEETS_REQUIREMENTS';\n  final_status: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED';\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  review_note?: string;\n  final_note?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  reviewed_at?: string;\n  approved_at?: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  reviewed_by_user?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n  worker_list: Array<{\n    id: string;\n    worker_name: string;\n    worker_photo: string | null;\n  }>;\n}\n\ninterface SubmissionsResponse {\n  submissions: Submission[];\n  pagination: {\n    page: number;\n    limit: number;\n    total: number;\n    pages: number;\n  };\n}\n\nexport default function ReviewerSubmissionsManagement() {\n  const [submissions, setSubmissions] = useState<Submission[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  \n  // Filters and pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [reviewStatusFilter, setReviewStatusFilter] = useState<string>('');\n  const [finalStatusFilter, setFinalStatusFilter] = useState<string>('');\n  const [sortBy, setSortBy] = useState('created_at');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  const [pagination, setPagination] = useState({\n    page: 1,\n    limit: 10,\n    total: 0,\n    pages: 0,\n  });\n\n  // Socket connection\n  const socket = useSocket();\n\n  const fetchSubmissions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: '10',\n        sortBy,\n        sortOrder,\n      });\n\n      if (searchTerm) params.append('search', searchTerm);\n      if (reviewStatusFilter) params.append('reviewStatus', reviewStatusFilter);\n      if (finalStatusFilter) params.append('finalStatus', finalStatusFilter);\n\n      const response = await fetch(`/api/reviewer/simloks?${params}`);\n      if (!response.ok) {\n        throw new Error('Gagal mengambil data pengajuan');\n      }\n\n      const data: SubmissionsResponse = await response.json();\n      setSubmissions(data.submissions);\n      setPagination(data.pagination);\n    } catch (err) {\n      console.error('Error fetching submissions:', err);\n      setError('Gagal memuat data pengajuan');\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, searchTerm, reviewStatusFilter, finalStatusFilter, sortBy, sortOrder]);\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [fetchSubmissions]);\n\n  // Socket listeners for real-time updates\n  useEffect(() => {\n    if (!socket) return;\n\n    // Join reviewer room\n    socket.emit('join', { role: 'REVIEWER' });\n\n    const handleSubmissionUpdate = () => {\n      console.log('Submission update received, refreshing reviewer submissions');\n      fetchSubmissions();\n    };\n\n    socket.on('submission:created', handleSubmissionUpdate);\n    socket.on('submission:reviewed', handleSubmissionUpdate);\n    socket.on('submission:approved', handleSubmissionUpdate);\n    socket.on('submission:rejected', handleSubmissionUpdate);\n\n    return () => {\n      socket.off('submission:created', handleSubmissionUpdate);\n      socket.off('submission:reviewed', handleSubmissionUpdate);\n      socket.off('submission:approved', handleSubmissionUpdate);\n      socket.off('submission:rejected', handleSubmissionUpdate);\n    };\n  }, [socket, fetchSubmissions]);\n\n  const handleSort = (field: string) => {\n    if (sortBy === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortBy(field);\n      setSortOrder('desc');\n    }\n    setCurrentPage(1);\n  };\n\n  const getSortIcon = (field: string) => {\n    if (sortBy !== field) return <ChevronUpDownIcon className=\"h-4 w-4\" />;\n    return sortOrder === 'asc' \n      ? <ChevronUpIcon className=\"h-4 w-4\" />\n      : <ChevronDownIcon className=\"h-4 w-4\" />;\n  };\n\n  const getReviewStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_REVIEW':\n        return <Badge variant=\"warning\">Menunggu Review</Badge>;\n      case 'MEETS_REQUIREMENTS':\n        return <Badge variant=\"success\">Memenuhi Syarat</Badge>;\n      case 'NOT_MEETS_REQUIREMENTS':\n        return <Badge variant=\"destructive\">Tidak Memenuhi Syarat</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const getFinalStatusBadge = (status: string) => {\n    switch (status) {\n      case 'PENDING_APPROVAL':\n        return <Badge variant=\"warning\">Menunggu Persetujuan</Badge>;\n      case 'APPROVED':\n        return <Badge variant=\"success\">Disetujui</Badge>;\n      case 'REJECTED':\n        return <Badge variant=\"destructive\">Ditolak</Badge>;\n      default:\n        return <Badge variant=\"default\">{status}</Badge>;\n    }\n  };\n\n  const handleViewDetails = (submission: Submission) => {\n    setSelectedSubmission(submission);\n    setShowDetailModal(true);\n  };\n\n  if (loading && submissions.length === 0) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header and Filters - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <div>\n            <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Review Pengajuan</h1>\n            <p className=\"text-sm text-gray-500 mt-1\">Kelola dan review pengajuan SIMLOK</p>\n          </div>\n        </div>\n\n        {/* Toolbar - Search and Filters */}\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n          <div className=\"relative w-full md:w-80\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n            </div>\n            <input\n              type=\"text\"\n              placeholder=\"Cari berdasarkan nama vendor, deskripsi pekerjaan, atau petugas...\"\n              value={searchTerm}\n              onChange={(e) => {\n                setSearchTerm(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\n            />\n          </div>\n          <div className=\"flex gap-2 md:w-auto\">\n            <select\n              value={reviewStatusFilter}\n              onChange={(e) => {\n                setReviewStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Review</option>\n              <option value=\"PENDING_REVIEW\">Menunggu Review</option>\n              <option value=\"MEETS_REQUIREMENTS\">Memenuhi Syarat</option>\n              <option value=\"NOT_MEETS_REQUIREMENTS\">Tidak Memenuhi Syarat</option>\n            </select>\n            <select\n              value={finalStatusFilter}\n              onChange={(e) => {\n                setFinalStatusFilter(e.target.value);\n                setCurrentPage(1);\n              }}\n              className=\"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white text-sm\"\n            >\n              <option value=\"\">Semua Status Akhir</option>\n              <option value=\"PENDING_APPROVAL\">Menunggu Persetujuan</option>\n              <option value=\"APPROVED\">Disetujui</option>\n              <option value=\"REJECTED\">Ditolak</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {error && (\n        <Alert variant=\"error\" title=\"Error\" message={error} />\n      )}\n\n      {/* Submissions Table - Unified Design */}\n      <div className=\"bg-white rounded-xl border shadow-sm overflow-hidden\">\n        {submissions.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <ClipboardDocumentListIcon className=\"mx-auto h-16 w-16 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Tidak ada pengajuan</h3>\n            <p className=\"text-gray-500 max-w-md mx-auto\">\n              {searchTerm || reviewStatusFilter || finalStatusFilter \n                ? 'Tidak ada pengajuan yang sesuai dengan filter yang dipilih.'\n                : 'Belum ada pengajuan yang tersedia untuk di-review.'\n              }\n            </p>\n          </div>\n        ) : (\n          <>\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th \n                      className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100\"\n                      onClick={() => handleSort('created_at')}\n                    >\n                      <div className=\"flex items-center space-x-1\">\n                        <span>Tanggal</span>\n                        {getSortIcon('created_at')}\n                      </div>\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Vendor & Penanggung Jawab\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Pekerjaan & Lokasi\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Review\n                    </th>\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Status Final\n                    </th>\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                      Aksi\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {submissions.map((submission) => (\n                    <tr key={submission.id} className=\"hover:bg-gray-50 transition-colors\">\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {new Date(submission.created_at).toLocaleDateString('id-ID', {\n                            day: '2-digit',\n                            month: 'short',\n                            year: 'numeric'\n                          })}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                          {new Date(submission.created_at).toLocaleTimeString('id-ID', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"max-w-48\">\n                          <div className=\"font-medium text-sm text-gray-900 truncate\" title={submission.vendor_name}>\n                            {submission.vendor_name}\n                          </div>\n                          <div className=\"flex items-center space-x-1 text-xs text-gray-500 mt-1\">\n                            <UserIcon className=\"h-3 w-3 flex-shrink-0\" />\n                            <span className=\"truncate\" title={submission.officer_name}>{submission.officer_name}</span>\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"max-w-64\">\n                          <div className=\"text-sm text-gray-900 font-medium truncate\" title={submission.job_description}>\n                            {submission.job_description}\n                          </div>\n                          <div className=\"text-xs text-gray-500 mt-1 truncate\" title={submission.work_location}>\n                            📍 {submission.work_location}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        {getReviewStatusBadge(submission.review_status)}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap\">\n                        {getFinalStatusBadge(submission.final_status)}\n                      </td>\n                      <td className=\"px-4 py-3 whitespace-nowrap text-center\">\n                        <Button\n                          onClick={() => handleViewDetails(submission)}\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"text-blue-600 border-blue-600 hover:bg-blue-50\"\n                        >\n                          <PencilIcon className=\"h-4 w-4 mr-1\" />\n                          {submission.final_status === 'PENDING_APPROVAL' ? 'Review' : 'Lihat'}\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n\n            {/* Pagination */}\n            {pagination.pages > 1 && (\n              <div className=\"px-4 py-3 border-t border-gray-200 bg-gray-50\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"text-sm text-gray-700\">\n                    Menampilkan {((currentPage - 1) * pagination.limit) + 1} sampai{' '}\n                    {Math.min(currentPage * pagination.limit, pagination.total)} dari{' '}\n                    {pagination.total} pengajuan\n                  </div>\n                  <div className=\"flex space-x-1\">\n                    <Button\n                      onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                      disabled={currentPage === 1}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      Sebelumnya\n                    </Button>\n                    {Array.from({ length: pagination.pages }, (_, i) => i + 1)\n                      .filter(page => {\n                        const distance = Math.abs(page - currentPage);\n                        return distance === 0 || distance === 1 || page === 1 || page === pagination.pages;\n                      })\n                      .map((page, index, array) => (\n                        <React.Fragment key={page}>\n                          {index > 0 && array[index - 1] !== page - 1 && (\n                            <span className=\"px-3 py-1 text-gray-500\">...</span>\n                          )}\n                          <Button\n                            onClick={() => setCurrentPage(page)}\n                            variant={currentPage === page ? \"primary\" : \"outline\"}\n                            size=\"sm\"\n                            className={currentPage === page ? \"bg-blue-600 text-white\" : \"\"}\n                          >\n                            {page}\n                          </Button>\n                        </React.Fragment>\n                      ))}\n                    <Button\n                      onClick={() => setCurrentPage(Math.min(pagination.pages, currentPage + 1))}\n                      disabled={currentPage === pagination.pages}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      Selanjutnya\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Detail Modal */}\n      {showDetailModal && selectedSubmission && (\n        <ReviewerSubmissionDetailModal\n          isOpen={showDetailModal}\n          onClose={() => {\n            setShowDetailModal(false);\n            setSelectedSubmission(null);\n          }}\n          submissionId={selectedSubmission.id}\n          onReviewSubmitted={() => {\n            fetchSubmissions();\n          }}\n        />\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/reviewer/ReviewerUserVerificationModal.tsx",
      "lang": "tsx",
      "size": 18503,
      "lines": 456,
      "hash": "15a31d0bb0c326a86995c37d5cf4c4b9e6ec110bdd5ca5e94175f5307152476b",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState } from 'react';\nimport Button from '@/components/ui/button/Button';\nimport Card from '@/components/ui/Card';\nimport { UserData } from '@/types/user';\nimport { \n  XMarkIcon, \n  CheckCircleIcon, \n  XCircleIcon,\n  ExclamationTriangleIcon,\n  UserIcon,\n  EnvelopeIcon,\n  BuildingOfficeIcon,\n  PhoneIcon,\n  MapPinIcon,\n  ClockIcon,\n  ShieldCheckIcon,\n  IdentificationIcon\n} from '@heroicons/react/24/outline';\n\ninterface ReviewerUserVerificationModalProps {\n  user: UserData | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUserUpdate?: (updatedUser: UserData) => void;\n  onUserRemove?: () => void;\n}\n\nexport default function ReviewerUserVerificationModal({\n  user,\n  isOpen,\n  onClose,\n  onUserUpdate,\n  onUserRemove\n}: ReviewerUserVerificationModalProps) {\n  const [processing, setProcessing] = useState<string | null>(null);\n  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);\n\n  if (!isOpen || !user) return null;\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleVerifyUser = async (action: 'approve' | 'reject') => {\n    if (!user) return;\n    \n    setProcessing(user.id);\n    \n    try {\n      const response = await fetch(`/api/reviewer/users/${user.id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          status: action === 'approve' ? 'VERIFY' : 'REJECT'\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update user verification');\n      }\n\n      const result = await response.json();\n      \n      if (action === 'approve' && result.user) {\n        onUserUpdate?.(result.user);\n      } else if (action === 'reject') {\n        onUserRemove?.();\n      }\n\n      setShowConfirmModal(null);\n      onClose();\n      \n    } catch (error) {\n      console.error('Error updating user verification:', error);\n      alert(error instanceof Error ? error.message : 'Failed to update user verification');\n    } finally {\n      setProcessing(null);\n    }\n  };\n\n  const handleModalClose = () => {\n    setShowConfirmModal(null);\n    onClose();\n  };\n\n  const isVerified = !!user.verified_at;\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n        <div className=\"max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n          <Card className=\"shadow-2xl\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n              <div className=\"flex items-center\">\n                <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4\">\n                  <UserIcon className=\"w-6 h-6 text-brand-600\" />\n                </div>\n                <div>\n                  <h2 className=\"text-xl font-semibold text-gray-900\">\n                    Detail User\n                  </h2>\n                  <p className=\"text-sm text-gray-500\">\n                    Informasi lengkap dan status verifikasi\n                  </p>\n                </div>\n              </div>\n              <Button\n                onClick={handleModalClose}\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"p-2\"\n              >\n                <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n              </Button>\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6 max-h-[calc(90vh-200px)] overflow-y-auto\">\n              <div className=\"space-y-8\">\n                {/* Status Section */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${\n                      isVerified \n                        ? 'bg-green-100 text-green-800' \n                        : 'bg-warning-100 text-warning-800'\n                    }`}>\n                      {isVerified ? (\n                        <CheckCircleIcon className=\"w-4 h-4\" />\n                      ) : (\n                        <ClockIcon className=\"w-4 h-4\" />\n                      )}\n                      {isVerified ? 'Terverifikasi' : 'Menunggu Verifikasi'}\n                    </div>\n                    <div className={`px-3 py-1 rounded-full text-sm font-medium ${\n                      user.role === 'VENDOR' \n                        ? 'bg-blue-100 text-blue-800' \n                        : user.role === 'VERIFIER'\n                        ? 'bg-purple-100 text-purple-800'\n                        : 'bg-gray-100 text-gray-800'\n                    }`}>\n                      <IdentificationIcon className=\"w-4 h-4 inline mr-1\" />\n                      {user.role}\n                    </div>\n                  </div>\n                </div>\n\n                {/* User Info Grid */}\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                  {/* Personal Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <UserIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Personal\n                      </h3>\n                      \n                      <div className=\"space-y-4\">\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <UserIcon className=\"w-5 h-5 text-blue-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.officer_name}\n                            </p>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <EnvelopeIcon className=\"w-5 h-5 text-green-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Email</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.email}\n                            </p>\n                          </div>\n                        </div>\n\n                        {user.phone_number && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <PhoneIcon className=\"w-5 h-5 text-orange-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">No. Telepon</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {user.phone_number}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        {user.address && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <MapPinIcon className=\"w-5 h-5 text-purple-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {user.address}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n\n                  {/* System Information */}\n                  <Card className=\"bg-gray-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                        <ShieldCheckIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                        Informasi Sistem\n                      </h3>\n\n                      <div className=\"space-y-4\">\n                        {user.vendor_name && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <BuildingOfficeIcon className=\"w-5 h-5 text-indigo-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n                              <p className=\"text-base font-medium text-gray-900 break-words\">\n                                {user.vendor_name}\n                              </p>\n                            </div>\n                          </div>\n                        )}\n\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <ClockIcon className=\"w-5 h-5 text-gray-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Tanggal Daftar</p>\n                            <p className=\"text-base font-medium text-gray-900\">\n                              {formatDate(user.created_at)}\n                            </p>\n                          </div>\n                        </div>\n\n                        {isVerified && user.verified_at && (\n                          <div className=\"flex items-start\">\n                            <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                              <ShieldCheckIcon className=\"w-5 h-5 text-green-600\" />\n                            </div>\n                            <div className=\"min-w-0 flex-1\">\n                              <p className=\"text-sm font-medium text-gray-500\">Diverifikasi Pada</p>\n                              <p className=\"text-base font-medium text-gray-900\">\n                                {formatDate(user.verified_at)}\n                              </p>\n                              {user.verified_by && (\n                                <p className=\"text-sm text-gray-600 mt-1\">\n                                  oleh: {user.verified_by}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                </div>\n\n                {/* Actions for Unverified Users */}\n                {!isVerified && (\n                  <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50\">\n                    <div className=\"p-6\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                        <CheckCircleIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n                        Tindakan Verifikasi\n                      </h3>\n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, \n                        sedangkan penolakan akan menghapus user dari sistem.\n                      </p>\n\n                      <div className=\"flex flex-col sm:flex-row gap-4\">\n                        <Button\n                          onClick={() => setShowConfirmModal('approve')}\n                          disabled={processing === user.id}\n                          variant=\"primary\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <CheckCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Setujui User\n                        </Button>\n                        <Button\n                          onClick={() => setShowConfirmModal('reject')}\n                          disabled={processing === user.id}\n                          variant=\"destructive\"\n                          size=\"md\"\n                          className=\"flex-1\"\n                        >\n                          <XCircleIcon className=\"w-5 h-5 mr-2\" />\n                          Tolak User\n                        </Button>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n\n                {/* Verification Status Info */}\n                {isVerified && (\n                  <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n                    <div className=\"p-6\">\n                      <div className=\"flex items-start\">\n                        <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                          <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                        </div>\n                        <div>\n                          <h4 className=\"text-lg font-semibold text-green-900 mb-2\">\n                            User Sudah Terverifikasi\n                          </h4>\n                          <p className=\"text-green-700\">\n                            User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan \n                            memiliki akses penuh ke fitur yang tersedia.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n              </div>\n            </div>\n\n            {/* Footer */}\n            <div className=\"flex justify-end p-6 border-t border-gray-200\">\n              <Button onClick={handleModalClose} variant=\"outline\" size=\"md\">\n                Tutup\n              </Button>\n            </div>\n          </Card>\n        </div>\n      </div>\n\n      {/* Confirmation Modal */}\n      {showConfirmModal && user && (\n        <ConfirmationModal\n          isOpen={!!showConfirmModal}\n          onClose={() => setShowConfirmModal(null)}\n          user={user}\n          action={showConfirmModal}\n          isProcessing={processing === user.id}\n          onConfirm={() => handleVerifyUser(showConfirmModal)}\n        />\n      )}\n    </>\n  );\n}\n\n// Modal Konfirmasi\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  user: UserData;\n  action: 'approve' | 'reject';\n  isProcessing: boolean;\n  onConfirm: () => void;\n}\n\nfunction ConfirmationModal({ isOpen, onClose, user, action, isProcessing, onConfirm }: ConfirmationModalProps) {\n  if (!isOpen) return null;\n\n  const isApprove = action === 'approve';\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]\">\n      <Card className=\"max-w-md w-full mx-4\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center mb-4\">\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n              isApprove ? 'bg-green-100' : 'bg-red-100'\n            }`}>\n              {isApprove ? (\n                <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n              ) : (\n                <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n              )}\n            </div>\n            <div className=\"ml-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}\n              </h3>\n            </div>\n          </div>\n\n          <p className=\"text-gray-600 mb-6\">\n            Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}\n            <strong className=\"text-gray-900\">{user.officer_name}</strong>?\n          </p>\n\n          {!isApprove && (\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 mb-6\">\n              <div className=\"flex items-start\">\n                <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-medium text-red-800 mb-1\">Peringatan!</p>\n                  <p className=\"text-red-700\">\n                    User akan dihapus dari sistem dan tidak dapat login lagi.\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-end space-x-3\">\n            <Button\n              onClick={onClose}\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={isProcessing}\n            >\n              Batal\n            </Button>\n            <Button\n              onClick={onConfirm}\n              disabled={isProcessing}\n              variant={isApprove ? \"primary\" : \"destructive\"}\n              size=\"sm\"\n            >\n              {isProcessing ? (\n                <span className=\"flex items-center\">\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                  Memproses...\n                </span>\n              ) : (\n                `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`\n              )}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/reviewer/UserVerificationManagement.tsx",
      "lang": "tsx",
      "size": 39636,
      "lines": 1059,
      "hash": "8050aafb36ffd01f777c916b6205a8cac26ca889b47e9d085470ffedbbfd2ffb",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport { useSocket } from '@/app/socket-provider';\nimport Button from '@/components/ui/button/Button';\nimport Card from '@/components/ui/Card';\nimport { \n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  XMarkIcon, \n  CheckCircleIcon, \n  XCircleIcon,\n  ExclamationTriangleIcon,\n  UserIcon,\n  EnvelopeIcon,\n  BuildingOfficeIcon,\n  PhoneIcon,\n  MapPinIcon,\n  ClockIcon,\n  ShieldCheckIcon,\n  IdentificationIcon\n} from '@heroicons/react/24/outline';\n\ninterface User {\n  id: string;\n  email: string;\n  officer_name: string;\n  vendor_name: string;\n  address?: string;\n  phone_number?: string;\n  profile_photo?: string;\n  created_at: string;\n  verified_at?: string;\n  verified_by?: string;\n  role: string;\n}\n\ninterface Stats {\n  totalPending: number;\n  totalVerified: number;\n  totalUsers: number;\n  todayRegistrations: number;\n}\n\ninterface UserVerificationManagementProps {\n  className?: string;\n  refreshTrigger?: number;\n}\n\ntype SortField = keyof User;\ntype SortOrder = \"asc\" | \"desc\";\n\n// Custom hook untuk debounced value\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n\nexport default function UserVerificationManagement({ className = '', refreshTrigger = 0 }: UserVerificationManagementProps) {\n  const [users, setUsers] = useState<User[]>([]);\n  const [stats, setStats] = useState<Stats>({\n    totalPending: 0,\n    totalVerified: 0,\n    totalUsers: 0,\n    todayRegistrations: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [processing, setProcessing] = useState<string | null>(null);\n  \n  // Pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [totalUsers, setTotalUsers] = useState(0);\n  const [limit] = useState(10);\n  \n  // Search & Filter\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<\"all\" | \"pending\" | \"verified\">(\"all\");\n  \n  // Sorting\n  const [sortField, setSortField] = useState<SortField>(\"created_at\");\n  const [sortOrder, setSortOrder] = useState<SortOrder>(\"desc\");\n\n  // Modal states\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [showVerificationModal, setShowVerificationModal] = useState(false);\n  const [showConfirmModal, setShowConfirmModal] = useState<'approve' | 'reject' | null>(null);\n  const [verificationNote, setVerificationNote] = useState('');\n\n  // Ref untuk search input\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  // Debounced search term\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  const { socket } = useSocket();\n\n  const fetchUsers = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(\"\");\n      \n      const params = new URLSearchParams({\n        page: currentPage.toString(),\n        limit: limit.toString(),\n        sortBy: sortField,\n        sortOrder: sortOrder,\n      });\n\n      if (debouncedSearchTerm) {\n        params.append(\"search\", debouncedSearchTerm);\n      }\n      \n      if (statusFilter !== \"all\") {\n        params.append(\"status\", statusFilter);\n      }\n\n      const response = await fetch(`/api/reviewer/users?${params.toString()}`);\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Gagal mengambil data user\");\n      }\n\n      const data = await response.json();\n      setUsers(data.users);\n      setStats(data.stats);\n      setTotalPages(data.pagination.totalPages);\n      setTotalUsers(data.pagination.total || 0);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n      console.error('Error fetching users:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [currentPage, debouncedSearchTerm, statusFilter, sortField, sortOrder, limit]);\n\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers, refreshTrigger]);\n\n  useEffect(() => {\n    if (socket) {\n      // Listen for new user registrations\n      socket.on('user:verification-needed', () => {\n        console.log('New user needs verification, refreshing list');\n        fetchUsers();\n      });\n\n      // Listen for notification updates\n      socket.on('notification:new', () => {\n        fetchUsers();\n      });\n\n      return () => {\n        socket.off('user:verification-needed');\n        socket.off('notification:new');\n      };\n    }\n    \n    return () => {}; // Cleanup function for when socket is null\n  }, [socket, fetchUsers]);\n\n  // Reset ke halaman 1 saat search term berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, statusFilter, sortField, sortOrder]);\n\n  // Kembalikan fokus ke search input setelah data reload\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  const handleSort = useCallback((field: SortField) => {\n    if (sortField === field) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortOrder(\"asc\");\n    }\n  }, [sortField, sortOrder]);\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const resetFilters = useCallback(() => {\n    setSearchTerm(\"\");\n    setStatusFilter(\"all\");\n    setCurrentPage(1);\n    setSortField(\"created_at\");\n    setSortOrder(\"desc\");\n  }, []);\n\n  const getSortIcon = useCallback((field: SortField) => {\n    if (sortField !== field) {\n      return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n    }\n    return sortOrder === \"asc\" \n      ? <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      : <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />;\n  }, [sortField, sortOrder]);\n\n  const formatDate = useCallback((dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString(\"id-ID\", {\n      year: \"numeric\",\n      month: \"short\", \n      day: \"numeric\"\n    });\n  }, []);\n\n\n\n  const getRoleBadge = useCallback((role: string) => {\n    const colors: Record<string, string> = {\n      VENDOR: \"bg-green-100 text-green-800\",\n      VERIFIER: \"bg-blue-100 text-blue-800\",\n      REVIEWER: \"bg-yellow-100 text-yellow-800\",\n      APPROVER: \"bg-orange-100 text-orange-800\",\n      ADMIN: \"bg-purple-100 text-purple-800\",\n      SUPER_ADMIN: \"bg-red-100 text-red-800\"\n    };\n    \n    return (\n      <span className={`px-2 py-1 text-xs font-medium rounded-full ${colors[role] || 'bg-gray-100 text-gray-800'}`}>\n        {role}\n      </span>\n    );\n  }, []);\n\n  const getVerificationStatus = useCallback((verified_at?: string | Date | null) => {\n    if (verified_at) {\n      return (\n        <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800\">\n          Terverifikasi\n        </span>\n      );\n    }\n    return (\n      <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-warning-100 text-warning-800\">\n        Menunggu Verifikasi\n      </span>\n    );\n  }, []);\n\n  const paginationInfo = useMemo(() => ({\n    currentPage,\n    totalPages,\n    totalUsers,\n    limit,\n    startItem: ((currentPage - 1) * limit) + 1,\n    endItem: Math.min(currentPage * limit, totalUsers)\n  }), [currentPage, totalPages, totalUsers, limit]);\n\n  const handleVerifyUser = async (action: 'approve' | 'reject') => {\n    if (!selectedUser) return;\n    \n    setProcessing(selectedUser.id);\n    \n    try {\n      const response = await fetch(`/api/reviewer/users/${selectedUser.id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          status: action === 'approve' ? 'VERIFY' : 'REJECT',\n          note: verificationNote.trim() || undefined\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update user verification');\n      }\n\n      await fetchUsers();\n      setShowConfirmModal(null);\n      setShowVerificationModal(false);\n      setSelectedUser(null);\n      setVerificationNote('');\n      \n    } catch (error) {\n      console.error('Error updating user verification:', error);\n      alert(error instanceof Error ? error.message : 'Failed to update user verification');\n    } finally {\n      setProcessing(null);\n    }\n  };\n\n  const handleViewUser = (user: User) => {\n    setSelectedUser(user);\n    setVerificationNote('');\n    setShowVerificationModal(true);\n  };\n\n  const handleModalClose = () => {\n    setShowVerificationModal(false);\n    setShowConfirmModal(null);\n    setSelectedUser(null);\n    setVerificationNote('');\n  };\n\n  // Memoize tabel content untuk hanya reload bagian ini\n  const tableContent = useMemo(() => {\n    if (error) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n            <div className=\"text-red-800\">{error}</div>\n            <Button \n              onClick={fetchUsers}\n              variant=\"destructive\"\n              size=\"sm\"\n              className=\"mt-2\"\n            >\n              Coba Lagi\n            </Button>\n          </div>\n        </div>\n      );\n    }\n\n    if (users.length === 0 && !loading) {\n      return (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-500\">Tidak ada user yang ditemukan</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th \n                  onClick={() => handleSort(\"officer_name\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Nama Petugas</span>\n                    {getSortIcon(\"officer_name\")}\n                  </div>\n                </th>\n                <th \n                  onClick={() => handleSort(\"email\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Email</span>\n                    {getSortIcon(\"email\")}\n                  </div>\n                </th>\n                <th \n                  onClick={() => handleSort(\"role\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Role</span>\n                    {getSortIcon(\"role\")}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Vendor/Kontak\n                </th>\n                <th \n                  onClick={() => handleSort(\"created_at\")}\n                  className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none\"\n                >\n                  <div className=\"flex items-center space-x-1\">\n                    <span>Tgl Dibuat</span>\n                    {getSortIcon(\"created_at\")}\n                  </div>\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Aksi\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {users.map((user) => (\n                <tr key={user.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-gray-900\">{user.officer_name}</div>\n                    {user.address && (\n                      <div className=\"text-sm text-gray-500 truncate max-w-xs\">{user.address}</div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{user.email}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    {getRoleBadge(user.role)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">\n                      {user.vendor_name || \"-\"}\n                    </div>\n                    {user.phone_number && (\n                      <div className=\"text-sm text-gray-500\">{user.phone_number}</div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-900\">{formatDate(user.created_at)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    {getVerificationStatus(user.verified_at)}\n                    {user.verified_by && (\n                      <div className=\"text-xs text-gray-500 mt-1\">\n                        oleh: {user.verified_by}\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <div className=\"flex items-center justify-end space-x-2\">\n                      <Button\n                        onClick={() => handleViewUser(user)}\n                        variant=\"info\"\n                        size=\"sm\"\n                        className=\"px-3 py-1.5\"\n                      >\n                        Lihat\n                      </Button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n        \n        {loading && (\n          <div className=\"flex justify-center items-center h-32\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n          </div>\n        )}\n      </div>\n    );\n  }, [users, loading, error, handleSort, getSortIcon, formatDate, getRoleBadge, getVerificationStatus, handleViewUser, fetchUsers]);\n\n  if (loading && users.length === 0) {\n    return (\n      <div className={`space-y-6 ${className}`}>\n        <div className=\"animate-pulse\">\n          <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-4\"></div>\n          <div className=\"space-y-3\">\n            {[...Array(5)].map((_, i) => (\n              <div key={i} className=\"h-16 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Statistics Cards - Dashboard Design */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Menunggu Verifikasi</h3>\n              <p className=\"text-2xl font-bold text-amber-600 mt-1\">{stats.totalPending}</p>\n            </div>\n            <div className=\"p-3 bg-amber-100 rounded-full\">\n              <ClockIcon className=\"w-6 h-6 text-amber-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Terverifikasi</h3>\n              <p className=\"text-2xl font-bold text-green-600 mt-1\">{stats.totalVerified}</p>\n            </div>\n            <div className=\"p-3 bg-green-100 rounded-full\">\n              <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Total User</h3>\n              <p className=\"text-2xl font-bold text-blue-600 mt-1\">{stats.totalUsers}</p>\n            </div>\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-blue-600\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium text-gray-500\">Registrasi Hari Ini</h3>\n              <p className=\"text-2xl font-bold text-purple-600 mt-1\">{stats.todayRegistrations}</p>\n            </div>\n            <div className=\"p-3 bg-purple-100 rounded-full\">\n              <UserIcon className=\"w-6 h-6 text-purple-600\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Search dan Filter */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari nama, email, vendor, atau nomor telepon...\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        <select\n          value={statusFilter}\n          onChange={(e) => {\n            const newValue = e.target.value as \"all\" | \"pending\" | \"verified\";\n            setStatusFilter(newValue);\n            setCurrentPage(1);\n          }}\n          className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n        >\n          <option value=\"all\">Semua Status</option>\n          <option value=\"pending\">Belum Verifikasi</option>\n          <option value=\"verified\">Sudah Verifikasi</option>\n        </select>\n        \n        <Button\n          onClick={resetFilters}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"px-3 py-2\"\n        >\n          Reset Filter\n        </Button>\n      </div>\n\n      {/* Tabel dengan loading overlay */}\n      <div className=\"relative\">\n        {tableContent}\n      </div>\n\n      {/* Pagination */}\n      {totalPages > 1 && (\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-gray-700\">\n            Menampilkan {paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.totalUsers} user\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n              disabled={currentPage === 1}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Sebelumnya\n            </button>\n            \n            <div className=\"flex items-center space-x-1\">\n              {[...Array(totalPages)].map((_, index) => {\n                const page = index + 1;\n                if (\n                  page === 1 ||\n                  page === totalPages ||\n                  (page >= currentPage - 1 && page <= currentPage + 1)\n                ) {\n                  return (\n                    <button\n                      key={page}\n                      onClick={() => setCurrentPage(page)}\n                      className={`px-3 py-2 border text-sm font-medium rounded-md ${\n                        currentPage === page\n                          ? \"bg-blue-500 border-blue-500 text-white\"\n                          : \"border-gray-300 text-gray-700 bg-white hover:bg-gray-50\"\n                      }`}\n                    >\n                      {page}\n                    </button>\n                  );\n                } else if (\n                  page === currentPage - 2 ||\n                  page === currentPage + 2\n                ) {\n                  return <span key={page} className=\"text-gray-500\">...</span>;\n                }\n                return null;\n              })}\n            </div>\n            \n            <button\n              onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n              disabled={currentPage === totalPages}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Selanjutnya\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* User Verification Modal */}\n      {showVerificationModal && selectedUser && (\n        <UserVerificationModal\n          isOpen={showVerificationModal}\n          onClose={handleModalClose}\n          user={selectedUser}\n          isProcessing={processing === selectedUser.id}\n          verificationNote={verificationNote}\n          setVerificationNote={setVerificationNote}\n          onApprove={() => setShowConfirmModal('approve')}\n          onReject={() => setShowConfirmModal('reject')}\n        />\n      )}\n\n      {/* Confirmation Modal */}\n      {showConfirmModal && selectedUser && (\n        <ConfirmationModal\n          isOpen={!!showConfirmModal}\n          onClose={() => setShowConfirmModal(null)}\n          user={selectedUser}\n          action={showConfirmModal}\n          isProcessing={processing === selectedUser.id}\n          onConfirm={() => handleVerifyUser(showConfirmModal)}\n        />\n      )}\n    </div>\n  );\n}\n\n// Modal Komponen untuk Verifikasi User (mirip dengan admin)\ninterface UserVerificationModalProps {\n  user: User;\n  isOpen: boolean;\n  onClose: () => void;\n  isProcessing: boolean;\n  verificationNote: string;\n  setVerificationNote: (note: string) => void;\n  onApprove: () => void;\n  onReject: () => void;\n}\n\nfunction UserVerificationModal({\n  user,\n  isOpen,\n  onClose,\n  isProcessing,\n  verificationNote,\n  setVerificationNote,\n  onApprove,\n  onReject\n}: UserVerificationModalProps) {\n  if (!isOpen || !user) return null;\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const isVerified = !!user.verified_at;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\">\n      <div className=\"max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n        <Card className=\"shadow-2xl\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center\">\n              <div className=\"w-12 h-12 bg-brand-100 rounded-full flex items-center justify-center mr-4\">\n                <UserIcon className=\"w-6 h-6 text-brand-600\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  Detail User\n                </h2>\n                <p className=\"text-sm text-gray-500\">\n                  Informasi lengkap dan status verifikasi\n                </p>\n              </div>\n            </div>\n            <Button\n              onClick={onClose}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"p-2\"\n            >\n              <XMarkIcon className=\"w-5 h-5 text-gray-500\" />\n            </Button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6 max-h-[calc(90vh-200px)] overflow-y-auto\">\n            <div className=\"space-y-8\">\n              {/* Status Section */}\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${\n                    isVerified \n                      ? 'bg-green-100 text-green-800' \n                      : 'bg-warning-100 text-warning-800'\n                  }`}>\n                    {isVerified ? (\n                      <CheckCircleIcon className=\"w-4 h-4\" />\n                    ) : (\n                      <ClockIcon className=\"w-4 h-4\" />\n                    )}\n                    {isVerified ? 'Terverifikasi' : 'Menunggu Verifikasi'}\n                  </div>\n                  <div className={`px-3 py-1 rounded-full text-sm font-medium ${\n                    user.role === 'VENDOR' \n                      ? 'bg-blue-100 text-blue-800' \n                      : user.role === 'VERIFIER'\n                      ? 'bg-purple-100 text-purple-800'\n                      : 'bg-gray-100 text-gray-800'\n                  }`}>\n                    <IdentificationIcon className=\"w-4 h-4 inline mr-1\" />\n                    {user.role}\n                  </div>\n                </div>\n              </div>\n\n              {/* User Info Grid */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Personal Information */}\n                <Card className=\"bg-gray-50\">\n                  <div className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                      <UserIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                      Informasi Personal\n                    </h3>\n                    \n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-start\">\n                        <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                          <UserIcon className=\"w-5 h-5 text-blue-600\" />\n                        </div>\n                        <div className=\"min-w-0 flex-1\">\n                          <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n                          <p className=\"text-base font-medium text-gray-900 break-words\">\n                            {user.officer_name}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-start\">\n                        <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                          <EnvelopeIcon className=\"w-5 h-5 text-green-600\" />\n                        </div>\n                        <div className=\"min-w-0 flex-1\">\n                          <p className=\"text-sm font-medium text-gray-500\">Email</p>\n                          <p className=\"text-base font-medium text-gray-900 break-words\">\n                            {user.email}\n                          </p>\n                        </div>\n                      </div>\n\n                      {user.phone_number && (\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <PhoneIcon className=\"w-5 h-5 text-orange-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">No. Telepon</p>\n                            <p className=\"text-base font-medium text-gray-900\">\n                              {user.phone_number}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      {user.address && (\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <MapPinIcon className=\"w-5 h-5 text-purple-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.address}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </Card>\n\n                {/* System Information */}\n                <Card className=\"bg-gray-50\">\n                  <div className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-6 flex items-center\">\n                      <ShieldCheckIcon className=\"w-5 h-5 mr-2 text-gray-500\" />\n                      Informasi Sistem\n                    </h3>\n\n                    <div className=\"space-y-4\">\n                      {user.vendor_name && (\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <BuildingOfficeIcon className=\"w-5 h-5 text-indigo-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n                            <p className=\"text-base font-medium text-gray-900 break-words\">\n                              {user.vendor_name}\n                            </p>\n                          </div>\n                        </div>\n                      )}\n\n                      <div className=\"flex items-start\">\n                        <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                          <ClockIcon className=\"w-5 h-5 text-gray-600\" />\n                        </div>\n                        <div className=\"min-w-0 flex-1\">\n                          <p className=\"text-sm font-medium text-gray-500\">Tanggal Daftar</p>\n                          <p className=\"text-base font-medium text-gray-900\">\n                            {formatDate(user.created_at)}\n                          </p>\n                        </div>\n                      </div>\n\n                      {isVerified && user.verified_at && (\n                        <div className=\"flex items-start\">\n                          <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4 flex-shrink-0\">\n                            <ShieldCheckIcon className=\"w-5 h-5 text-green-600\" />\n                          </div>\n                          <div className=\"min-w-0 flex-1\">\n                            <p className=\"text-sm font-medium text-gray-500\">Diverifikasi Pada</p>\n                            <p className=\"text-base font-medium text-gray-900\">\n                              {formatDate(user.verified_at)}\n                            </p>\n                            {user.verified_by && (\n                              <p className=\"text-sm text-gray-600 mt-1\">\n                                oleh: {user.verified_by}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </Card>\n              </div>\n\n              {/* Actions for Unverified Users */}\n              {!isVerified && (\n                <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50\">\n                  <div className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n                      <CheckCircleIcon className=\"w-5 h-5 mr-2 text-blue-600\" />\n                      Tindakan Verifikasi\n                    </h3>\n                    <p className=\"text-sm text-gray-600 mb-4\">\n                      Pilih tindakan yang sesuai untuk user ini. Persetujuan akan memberikan akses sistem, \n                      sedangkan penolakan akan menghapus user dari sistem.\n                    </p>\n\n                    <div className=\"mb-4\">\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Catatan (Opsional)\n                      </label>\n                      <textarea\n                        value={verificationNote}\n                        onChange={(e) => setVerificationNote(e.target.value)}\n                        rows={3}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                        placeholder=\"Tambahkan catatan jika diperlukan...\"\n                      />\n                    </div>\n\n                    <div className=\"flex flex-col sm:flex-row gap-4\">\n                      <Button\n                        onClick={onApprove}\n                        disabled={isProcessing}\n                        variant=\"primary\"\n                        size=\"md\"\n                        className=\"flex-1\"\n                      >\n                        <CheckCircleIcon className=\"w-5 h-5 mr-2\" />\n                        Setujui User\n                      </Button>\n                      <Button\n                        onClick={onReject}\n                        disabled={isProcessing}\n                        variant=\"destructive\"\n                        size=\"md\"\n                        className=\"flex-1\"\n                      >\n                        <XCircleIcon className=\"w-5 h-5 mr-2\" />\n                        Tolak User\n                      </Button>\n                    </div>\n                  </div>\n                </Card>\n              )}\n\n              {/* Verification Status Info */}\n              {isVerified && (\n                <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50\">\n                  <div className=\"p-6\">\n                    <div className=\"flex items-start\">\n                      <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                        <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                      </div>\n                      <div>\n                        <h4 className=\"text-lg font-semibold text-green-900 mb-2\">\n                          User Sudah Terverifikasi\n                        </h4>\n                        <p className=\"text-green-700\">\n                          User ini sudah dapat mengakses sistem sesuai dengan role yang diberikan dan \n                          memiliki akses penuh ke fitur yang tersedia.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </Card>\n              )}\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex justify-end p-6 border-t border-gray-200\">\n            <Button onClick={onClose} variant=\"outline\" size=\"md\">\n              Tutup\n            </Button>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\n// Modal Konfirmasi\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  user: User;\n  action: 'approve' | 'reject';\n  isProcessing: boolean;\n  onConfirm: () => void;\n}\n\nfunction ConfirmationModal({ isOpen, onClose, user, action, isProcessing, onConfirm }: ConfirmationModalProps) {\n  if (!isOpen) return null;\n\n  const isApprove = action === 'approve';\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]\">\n      <Card className=\"max-w-md w-full mx-4\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center mb-4\">\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n              isApprove ? 'bg-green-100' : 'bg-red-100'\n            }`}>\n              {isApprove ? (\n                <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n              ) : (\n                <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n              )}\n            </div>\n            <div className=\"ml-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Konfirmasi {isApprove ? 'Persetujuan' : 'Penolakan'}\n              </h3>\n            </div>\n          </div>\n\n          <p className=\"text-gray-600 mb-6\">\n            Apakah Anda yakin ingin {isApprove ? 'menyetujui' : 'menolak'} user{' '}\n            <strong className=\"text-gray-900\">{user.officer_name}</strong>?\n          </p>\n\n          {!isApprove && (\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 mb-6\">\n              <div className=\"flex items-start\">\n                <ExclamationTriangleIcon className=\"w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-medium text-red-800 mb-1\">Peringatan!</p>\n                  <p className=\"text-red-700\">\n                    User akan dihapus dari sistem dan tidak dapat login lagi.\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-end space-x-3\">\n            <Button\n              onClick={onClose}\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={isProcessing}\n            >\n              Batal\n            </Button>\n            <Button\n              onClick={onConfirm}\n              disabled={isProcessing}\n              variant={isApprove ? \"primary\" : \"destructive\"}\n              size=\"sm\"\n            >\n              {isProcessing ? (\n                <span className=\"flex items-center\">\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                  Memproses...\n                </span>\n              ) : (\n                `Ya, ${isApprove ? 'Setujui' : 'Tolak'}`\n              )}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/scanner/CameraQRScanner.tsx",
      "lang": "tsx",
      "size": 11599,
      "lines": 356,
      "hash": "62de72d93956e73cdcc04b9d2dc84a56ba990553856b50f96780a0a8c92f19c6",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { BrowserMultiFormatReader } from '@zxing/browser';\nimport { NotFoundException } from '@zxing/library';\nimport {\n  XMarkIcon,\n  CameraIcon,\n  StopIcon\n} from '@heroicons/react/24/outline';\nimport Button from '@/components/ui/button/Button';\nimport { Modal } from '@/components/ui/modal';\nimport ScanModal from './ScanModal';\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n  scanned_at?: string;\n  scanned_by?: string;\n  scan_id?: string;\n}\n\ninterface CameraQRScannerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onScan?: (result: string) => void;\n  title?: string;\n  description?: string;\n}\n\nexport default function CameraQRScanner({ isOpen, onClose, onScan, title = \"Scan Barcode/QR Code SIMLOK\", description }: CameraQRScannerProps) {\n  const [isScanning, setIsScanning] = useState(false);\n  const [scanResult, setScanResult] = useState<ScanResult | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const codeReaderRef = useRef<BrowserMultiFormatReader | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const scanningRef = useRef<boolean>(false); // Track if scanning is active\n  const scanIdRef = useRef<number>(0); // Unique ID for each scan session\n\n  const resetScannerState = useCallback(() => {\n    console.log('=== RESETTING SCANNER STATE ===');\n    setScanResult(null);\n    setIsModalOpen(false);\n    setError(null);\n    scanningRef.current = false;\n    // Don't reset scanIdRef here as we want it to keep incrementing\n  }, []);\n\n  useEffect(() => {\n    if (isOpen) {\n      console.log('=== SCANNER OPENED ===');\n      // Reset previous scan results when opening scanner\n      resetScannerState();\n      initializeScanner();\n    } else {\n      console.log('=== SCANNER CLOSED ===');\n      stopScanner();\n    }\n\n    return () => {\n      console.log('=== SCANNER CLEANUP ===');\n      stopScanner();\n    };\n  }, [isOpen, resetScannerState]);\n\n  const initializeScanner = async () => {\n    try {\n      console.log('=== INITIALIZING SCANNER ===');\n      setError(null);\n      setScanResult(null); // Clear any previous scan results\n      setIsModalOpen(false); // Ensure modal is closed\n      scanningRef.current = false; // Reset scanning state\n      \n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        throw new Error('Camera not supported in this browser');\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { \n          facingMode: 'environment',\n          width: { ideal: 1280 },\n          height: { ideal: 720 }\n        }\n      });\n\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        streamRef.current = stream;\n        console.log('Video stream attached');\n      }\n\n      codeReaderRef.current = new BrowserMultiFormatReader();\n      console.log('BrowserMultiFormatReader initialized');\n      \n      setIsScanning(true);\n      startScanning();\n    } catch (err) {\n      console.error('Failed to initialize scanner:', err);\n      setError(err instanceof Error ? err.message : 'Failed to access camera');\n    }\n  };\n\n  const startScanning = async () => {\n    if (!videoRef.current) {\n      console.error('Video element not available');\n      return;\n    }\n\n    try {\n      // Increment scan ID for this session\n      scanIdRef.current += 1;\n      const currentScanId = scanIdRef.current;\n      \n      console.log(`=== STARTING SCAN PROCESS (ID: ${currentScanId}) ===`);\n      \n      // Reset any previous scan result before starting new scan\n      setScanResult(null);\n      setIsModalOpen(false);\n      \n      // Always create a fresh code reader instance to avoid state issues\n      if (codeReaderRef.current) {\n        codeReaderRef.current = null;\n      }\n      codeReaderRef.current = new BrowserMultiFormatReader();\n      console.log('Fresh BrowserMultiFormatReader created');\n      \n      scanningRef.current = true; // Mark scanning as active\n      \n      codeReaderRef.current.decodeFromVideoDevice(\n        undefined,\n        videoRef.current,\n        (result, error) => {\n          // Check if this is still the current scan session\n          if (scanIdRef.current !== currentScanId) {\n            console.log(`Ignoring result from old scan session (${currentScanId} vs ${scanIdRef.current})`);\n            return;\n          }\n          \n          // Check if scanning is still active before processing\n          if (!scanningRef.current) {\n            console.log('Scanning stopped, ignoring result');\n            return;\n          }\n\n          if (result) {\n            console.log(`=== SCAN SUCCESS (ID: ${currentScanId}) ===`);\n            console.log('Scanned text:', result.getText());\n            scanningRef.current = false; // Stop scanning immediately\n            handleScanSuccess(result.getText());\n          }\n          \n          if (error && !(error instanceof NotFoundException)) {\n            console.log('Scan error (non-critical):', error.message);\n          }\n        }\n      );\n    } catch (err) {\n      console.error('Error during scanning:', err);\n      setError('Scanning failed');\n      scanningRef.current = false;\n    }\n  };\n\n  const handleScanSuccess = async (scannedText: string) => {\n    console.log('=== PROCESSING SCAN RESULT ===');\n    console.log('Scanned text:', scannedText);\n    \n    try {\n      // Stop all scanning activity immediately\n      setIsScanning(false);\n      scanningRef.current = false;\n\n      const response = await fetch('/api/qr/verify', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          qrData: scannedText,\n          scanner_type: 'barcode_scanner'\n        }),\n      });\n\n      console.log('API response status:', response.status);\n      const result = await response.json();\n      console.log('API response data:', result);\n      console.log('API response data.data:', result.data);\n      console.log('API response data.data.submission:', result.data?.submission);\n\n      setScanResult(result);\n      \n      // Call onScan callback if provided\n      if (onScan) {\n        onScan(scannedText);\n      }\n      \n      console.log('=== SETTING MODAL STATE ===');\n      console.log('result.success:', result.success);\n      console.log('About to set modal open to true');\n      setIsModalOpen(true);\n      console.log('Modal state should be open now');\n      \n    } catch (error) {\n      console.error('Error verifying QR:', error);\n      const errorResult = {\n        success: false,\n        error: 'Failed to verify barcode/QR code'\n      };\n      setScanResult(errorResult);\n      setIsModalOpen(true);\n    }\n  };\n\n  const stopCamera = () => {\n    console.log('=== STOPPING CAMERA ===');\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => {\n        track.stop();\n        console.log('Camera track stopped');\n      });\n      streamRef.current = null;\n    }\n  };\n\n  const stopScanner = () => {\n    console.log('=== STOPPING SCANNER ===');\n    setIsScanning(false);\n    scanningRef.current = false; // Stop scanning process\n    \n    if (codeReaderRef.current) {\n      try {\n        // Create a new instance to completely reset the scanner\n        codeReaderRef.current = null;\n        console.log('Code reader cleared');\n      } catch (error) {\n        console.log('Error clearing code reader:', error);\n      }\n    }\n    \n    stopCamera();\n  };\n\n  const handleClose = () => {\n    console.log('=== CLOSING SCANNER ===');\n    stopScanner();\n    setScanResult(null);\n    setError(null);\n    onClose();\n  };\n\n  const handleModalClose = () => {\n    console.log('=== CLOSING RESULT MODAL ===');\n    setIsModalOpen(false);\n    setScanResult(null);\n    setError(null);\n    \n    // Restart scanning after modal closes if scanner is still open\n    if (isOpen && videoRef.current) {\n      console.log('=== RESTARTING SCANNER AFTER MODAL CLOSE ===');\n      // Add delay to ensure state is properly reset and avoid race conditions\n      setTimeout(() => {\n        setIsScanning(true);\n        scanningRef.current = false; // Reset scanning state\n        startScanning();\n      }, 300); // Increased delay for more stability\n    }\n  };\n\n  console.log('=== RENDER STATE ===');\n  console.log('isOpen:', isOpen);\n  console.log('isScanning:', isScanning);\n  console.log('scanResult:', scanResult);\n  console.log('isModalOpen:', isModalOpen);\n\n  return (\n    <>\n      <Modal isOpen={isOpen} onClose={handleClose}>\n        <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n          <div className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">\n              {title}\n            </h2>\n            {description && (\n              <p className=\"text-gray-600 mb-4\">\n                {description}\n              </p>\n            )}\n            \n            <div className=\"space-y-4\">\n              {error && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                  <p className=\"text-red-700\">{error}</p>\n                </div>\n              )}\n\n              <div className=\"relative bg-black rounded-lg overflow-hidden\">\n                <video\n                  ref={videoRef}\n                  autoPlay\n                  playsInline\n                  muted\n                  className=\"w-full h-80 object-cover\"\n                />\n                \n                {isScanning && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"border-2 border-green-500 w-64 h-64 rounded-lg animate-pulse\">\n                      <div className=\"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-green-500\"></div>\n                      <div className=\"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-green-500\"></div>\n                      <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-green-500\"></div>\n                      <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-green-500\"></div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex justify-between items-center\">\n                <p className=\"text-sm text-gray-600\">\n                  {isScanning ? 'Scanning for barcode/QR code...' : 'Camera ready'}\n                </p>\n                \n                <div className=\"flex gap-2\">\n                  {!isScanning ? (\n                    <Button onClick={initializeScanner} startIcon={<CameraIcon className=\"h-4 w-4\" />}>\n                      Start Scanning\n                    </Button>\n                  ) : (\n                    <Button onClick={stopScanner} variant=\"outline\" startIcon={<StopIcon className=\"h-4 w-4\" />}>\n                      Stop Scanning\n                    </Button>\n                  )}\n                  \n                  <Button onClick={handleClose} variant=\"outline\" startIcon={<XMarkIcon className=\"h-4 w-4\" />}>\n                    Close\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Modal>\n\n      {scanResult && (\n        <ScanModal\n          isOpen={isModalOpen}\n          onClose={handleModalClose}\n          result={scanResult}\n        />\n      )}\n    </>\n  );\n}"
    },
    {
      "path": "src/components/scanner/QrScanErrorModal.tsx",
      "lang": "tsx",
      "size": 5214,
      "lines": 161,
      "hash": "3a4c43bcb667799700cd934d59e84895f7767e584de21e732ca4f1c44448f907",
      "truncated": false,
      "content": "'use client';\n\nimport React from 'react';\nimport { X, XCircle, AlertTriangle, RefreshCw } from 'lucide-react';\n\ninterface QrScanErrorModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  error: string;\n  message?: string | undefined;\n  errorType?: 'invalid' | 'expired' | 'network' | 'unknown';\n  onRetry?: () => void;\n}\n\nconst QrScanErrorModal: React.FC<QrScanErrorModalProps> = ({\n  isOpen,\n  onClose,\n  error: errorMessage,\n  message,\n  errorType = 'unknown',\n  onRetry\n}) => {\n  if (!isOpen) return null;\n\n  const getErrorIcon = () => {\n    switch (errorType) {\n      case 'invalid':\n        return <XCircle className=\"h-12 w-12 text-red-500\" />;\n      case 'expired':\n        return <AlertTriangle className=\"h-12 w-12 text-orange-500\" />;\n      case 'network':\n        return <AlertTriangle className=\"h-12 w-12 text-yellow-500\" />;\n      default:\n        return <XCircle className=\"h-12 w-12 text-red-500\" />;\n    }\n  };\n\n  const getErrorTitle = () => {\n    switch (errorType) {\n      case 'invalid':\n        return 'QR Code Tidak Valid';\n      case 'expired':\n        return 'QR Code Kedaluwarsa';\n      case 'network':\n        return 'Masalah Koneksi';\n      default:\n        return 'Scan Gagal';\n    }\n  };\n\n  const getErrorDescription = () => {\n    switch (errorType) {\n      case 'invalid':\n        return 'QR Code yang dipindai tidak valid atau bukan QR Code SIMLOK.';\n      case 'expired':\n        return 'QR Code yang dipindai sudah kedaluwarsa. Silakan minta QR Code baru.';\n      case 'network':\n        return 'Terjadi masalah koneksi saat memverifikasi QR Code.';\n      default:\n        return 'Terjadi kesalahan saat memindai QR Code.';\n    }\n  };\n\n  const getHeaderColor = () => {\n    switch (errorType) {\n      case 'expired':\n        return 'bg-orange-50 border-orange-200';\n      case 'network':\n        return 'bg-yellow-50 border-yellow-200';\n      default:\n        return 'bg-red-50 border-red-200';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n        {/* Header */}\n        <div className={`flex items-center justify-between p-4 border-b ${getHeaderColor()}`}>\n          <div className=\"flex items-center space-x-2\">\n            {getErrorIcon()}\n            <h2 className=\"text-lg font-semibold text-gray-800\">{getErrorTitle()}</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 space-y-4\">\n          {/* Error Description */}\n          <div className=\"text-center\">\n            <p className=\"text-gray-600 mb-2\">{message || getErrorDescription()}</p>\n            {errorMessage && (\n              <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-3\">\n                <p className=\"text-sm text-gray-700 font-mono\">{errorMessage}</p>\n              </div>\n            )}\n          </div>\n\n          {/* Solutions/Tips */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h4 className=\"font-medium text-blue-800 mb-2\">Tips:</h4>\n            <ul className=\"text-sm text-blue-700 space-y-1\">\n              {errorType === 'invalid' && (\n                <>\n                  <li>• Pastikan QR Code adalah QR Code SIMLOK yang valid</li>\n                  <li>• Pastikan QR Code tidak rusak atau terpotong</li>\n                  <li>• Coba posisikan QR Code lebih dekat ke kamera</li>\n                </>\n              )}\n              {errorType === 'expired' && (\n                <>\n                  <li>• Minta QR Code baru dari sistem</li>\n                  <li>• Pastikan permohonan masih dalam periode yang valid</li>\n                </>\n              )}\n              {errorType === 'network' && (\n                <>\n                  <li>• Periksa koneksi internet</li>\n                  <li>• Coba lagi dalam beberapa saat</li>\n                </>\n              )}\n              {errorType === 'unknown' && (\n                <>\n                  <li>• Coba scan ulang QR Code</li>\n                  <li>• Pastikan kamera dapat membaca QR Code dengan jelas</li>\n                </>\n              )}\n            </ul>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-gray-200 bg-gray-50 space-y-2\">\n          {onRetry && (\n            <button\n              onClick={onRetry}\n              className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2\"\n            >\n              <RefreshCw className=\"h-4 w-4\" />\n              <span>Coba Scan Lagi</span>\n            </button>\n          )}\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\n          >\n            Tutup\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QrScanErrorModal;\n"
    },
    {
      "path": "src/components/scanner/QrScanResultModal.tsx",
      "lang": "tsx",
      "size": 7738,
      "lines": 231,
      "hash": "e543d317e231438e17e62daf2f91d7974ef27e7ab22564af6e9e332fa3cd0e9a",
      "truncated": false,
      "content": "'use client';\n\nimport React from 'react';\nimport { X, CheckCircle, User, Calendar, MapPin, QrCode } from 'lucide-react';\n\ninterface Submission {\n  id: string;\n  number: string;\n  title: string;\n  task: string;\n  workers?: { name: string }[];\n  vendor?: { name: string };\n  location?: string;\n  implementation_start_date?: string | null;\n  implementation_end_date?: string | null;\n  status: string;\n}\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n}\n\ninterface QrScanResultModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  result: ScanResult;\n  submission?: Submission | null;\n  scanTime?: string | undefined;\n  scannedBy?: string | undefined;\n  scanId?: string | undefined;\n  onScanAnother?: () => void;\n}\n\nconst QrScanResultModal: React.FC<QrScanResultModalProps> = ({\n  isOpen,\n  onClose,\n  result,\n  submission,\n  scanTime,\n  scannedBy,\n  scanId,\n  onScanAnother\n}) => {\n  // Extract submission from result if not provided directly\n  const submissionData = submission || result.data?.submission;\n  \n  if (!isOpen || !result.success || !submissionData) return null;\n\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return 'Tidak ditentukan';\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status.toLowerCase()) {\n      case 'completed':\n        return 'text-green-600 bg-green-100';\n      case 'in_progress':\n        return 'text-blue-600 bg-blue-100';\n      case 'pending':\n        return 'text-yellow-600 bg-yellow-100';\n      default:\n        return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status.toLowerCase()) {\n      case 'completed':\n        return 'Selesai';\n      case 'in_progress':\n        return 'Sedang Berlangsung';\n      case 'pending':\n        return 'Menunggu';\n      default:\n        return status;\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-green-50\">\n          <div className=\"flex items-center space-x-2\">\n            <CheckCircle className=\"h-6 w-6 text-green-600\" />\n            <h2 className=\"text-lg font-semibold text-green-800\">QR Code Valid</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <X className=\"h-6 w-6\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4 space-y-4\">\n          {/* Scan Information */}\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n            <h4 className=\"font-medium text-green-800 mb-2\">Informasi Scan</h4>\n            <div className=\"space-y-1 text-sm\">\n              {scanTime && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">Waktu Scan:</span>\n                  <span className=\"text-green-800 font-medium\">{scanTime}</span>\n                </div>\n              )}\n              {scannedBy && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">Dipindai oleh:</span>\n                  <span className=\"text-green-800 font-medium\">{scannedBy}</span>\n                </div>\n              )}\n              {scanId && (\n                <div className=\"flex justify-between\">\n                  <span className=\"text-green-700\">ID Scan:</span>\n                  <span className=\"text-green-800 font-mono text-xs\">{scanId}</span>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Submission Number */}\n          <div className=\"text-center\">\n            <div className=\"text-sm text-gray-600\">Nomor Permohonan</div>\n            <div className=\"text-xl font-bold text-gray-900\">{submissionData.number}</div>\n          </div>\n\n          {/* Status */}\n          <div className=\"flex justify-center\">\n            <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(submissionData.status)}`}>\n              {getStatusText(submissionData.status)}\n            </span>\n          </div>\n\n          {/* Title */}\n          <div>\n            <div className=\"text-sm font-medium text-gray-700 mb-1\">Judul Pekerjaan</div>\n            <div className=\"text-gray-900\">{submissionData.title}</div>\n          </div>\n\n          {/* Task */}\n          <div>\n            <div className=\"text-sm font-medium text-gray-700 mb-1\">Uraian Pekerjaan</div>\n            <div className=\"text-gray-900 text-sm\">{submissionData.task}</div>\n          </div>\n\n          {/* Vendor */}\n          {submissionData.vendor && (\n            <div className=\"flex items-start space-x-2\">\n              <User className=\"h-4 w-4 text-gray-500 mt-1\" />\n              <div>\n                <div className=\"text-sm font-medium text-gray-700\">Vendor</div>\n                <div className=\"text-gray-900\">{submissionData.vendor.name}</div>\n              </div>\n            </div>\n          )}\n\n          {/* Location */}\n          {submissionData.location && (\n            <div className=\"flex items-start space-x-2\">\n              <MapPin className=\"h-4 w-4 text-gray-500 mt-1\" />\n              <div>\n                <div className=\"text-sm font-medium text-gray-700\">Lokasi</div>\n                <div className=\"text-gray-900\">{submissionData.location}</div>\n              </div>\n            </div>\n          )}\n\n          {/* Implementation Period */}\n          <div className=\"flex items-start space-x-2\">\n            <Calendar className=\"h-4 w-4 text-gray-500 mt-1\" />\n            <div>\n              <div className=\"text-sm font-medium text-gray-700\">Periode Pelaksanaan</div>\n              <div className=\"text-gray-900 text-sm\">\n                {formatDate(submissionData.implementation_start_date || null)} - {formatDate(submissionData.implementation_end_date || null)}\n              </div>\n            </div>\n          </div>\n\n          {/* Workers */}\n          {submissionData.workers && submissionData.workers.length > 0 && (\n            <div>\n              <div className=\"text-sm font-medium text-gray-700 mb-1\">Pekerja</div>\n              <div className=\"space-y-1\">\n                {submissionData.workers.map((worker: any, index: number) => (\n                  <div key={index} className=\"text-sm text-gray-900 bg-gray-50 px-2 py-1 rounded\">\n                    {worker.name}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t border-gray-200 bg-gray-50 space-y-2\">\n          {onScanAnother && (\n            <button\n              onClick={() => {\n                onScanAnother();\n                onClose();\n              }}\n              className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2\"\n            >\n              <QrCode className=\"h-4 w-4\" />\n              <span>Scan QR Code Lain</span>\n            </button>\n          )}\n          <button\n            onClick={onClose}\n            className=\"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\n          >\n            Tutup\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QrScanResultModal;\n"
    },
    {
      "path": "src/components/scanner/ScanHistory.tsx",
      "lang": "tsx",
      "size": 18632,
      "lines": 503,
      "hash": "14fa2518d246e23ea4781c6ecc57d6db8546ca77e7a2ca814c390b38a8984158",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { \n  QrCodeIcon, \n  EyeIcon, \n  ClockIcon, \n  UserIcon,\n  BuildingOfficeIcon,\n  DocumentIcon,\n  MapPinIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon\n} from '@heroicons/react/24/outline';\nimport Alert from '@/components/ui/alert/Alert';\nimport Button from '@/components/ui/button/Button';\n\ninterface ScanHistoryItem {\n  id: string;\n  scanned_at: string;\n  scanner_name?: string;\n  scan_location?: string;\n  notes?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    role: string;\n  };\n  submission: {\n    id: string;\n    simlok_number: string;\n    vendor_name: string;\n    officer_name: string;\n    job_description: string;\n    work_location: string;\n    approval_status: string;\n  };\n}\n\ninterface Pagination {\n  total: number;\n  limit: number;\n  offset: number;\n  hasMore: boolean;\n}\n\ninterface ScanHistoryProps {\n  submissionId?: string; // If provided, show scans for specific submission only\n  className?: string;\n}\n\ninterface ScanHistoryRef {\n  closeDetailModal: () => void;\n}\n\nconst ScanHistory = forwardRef<ScanHistoryRef, ScanHistoryProps>(function ScanHistory({ submissionId, className = '' }, ref) {\n  const { data: session } = useSession();\n  const [scans, setScans] = useState<ScanHistoryItem[]>([]);\n  const [pagination, setPagination] = useState<Pagination>({\n    total: 0,\n    limit: 20,\n    offset: 0,\n    hasMore: false\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedScan, setSelectedScan] = useState<ScanHistoryItem | null>(null);\n\n  // Expose methods to parent component via ref\n  useImperativeHandle(ref, () => ({\n    closeDetailModal: () => {\n      setSelectedScan(null);\n    }\n  }));\n\n  // Fetch scan history\n  const fetchScanHistory = async (offset = 0) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const params = new URLSearchParams({\n        limit: pagination.limit.toString(),\n        offset: offset.toString(),\n      });\n\n      if (submissionId) {\n        params.append('submission_id', submissionId);\n      }\n\n      const response = await fetch(`/api/qr/verify?${params}`);\n      const data = await response.json();\n\n      if (response.ok) {\n        setScans(data.scans);\n        setPagination(data.pagination);\n      } else {\n        setError(data.error || 'Failed to fetch scan history');\n      }\n    } catch (err) {\n      console.error('Error fetching scan history:', err);\n      setError('Network error while fetching scan history');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Load data on mount\n  useEffect(() => {\n    fetchScanHistory();\n  }, [submissionId]);\n\n  // Format date for display\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return {\n      date: date.toLocaleDateString('id-ID', {\n        day: '2-digit',\n        month: 'long',\n        year: 'numeric'\n      }),\n      time: date.toLocaleTimeString('id-ID', {\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      })\n    };\n  };\n\n  // Get role badge color\n  const getRoleBadge = (role: string) => {\n    const roleConfig = {\n      ADMIN: { label: 'Admin', className: 'bg-purple-100 text-purple-800' },\n      VERIFIER: { label: 'Verifier', className: 'bg-blue-100 text-blue-800' },\n      VENDOR: { label: 'Vendor', className: 'bg-green-100 text-green-800' }\n    };\n    \n    const config = roleConfig[role as keyof typeof roleConfig] || { \n      label: role, \n      className: 'bg-gray-100 text-gray-800' \n    };\n    \n    return (\n      <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${config.className}`}>\n        {config.label}\n      </span>\n    );\n  };\n\n  // Handle pagination\n  const handlePrevious = () => {\n    const newOffset = Math.max(0, pagination.offset - pagination.limit);\n    fetchScanHistory(newOffset);\n  };\n\n  const handleNext = () => {\n    const newOffset = pagination.offset + pagination.limit;\n    fetchScanHistory(newOffset);\n  };\n\n  if (!session) {\n    return (\n      <Alert\n        variant=\"error\"\n        title=\"Akses Ditolak\"\n        message=\"Anda harus login untuk melihat history scan\"\n      />\n    );\n  }\n\n  return (\n    <div className={`scan-history ${className}`}>\n      <div className=\"bg-white rounded-lg shadow-lg\">\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <ClockIcon className=\"h-6 w-6 text-blue-500 mr-3\" />\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  {submissionId ? 'History Scan Submission' : 'History Scan QR Code'}\n                </h2>\n                <p className=\"text-sm text-gray-500\">\n                  {pagination.total} total scan records\n                </p>\n              </div>\n            </div>\n            \n            <Button\n              onClick={() => fetchScanHistory(pagination.offset)}\n              variant=\"secondary\"\n              size=\"sm\"\n            >\n              Refresh\n            </Button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6\">\n          {/* Error State */}\n          {error && (\n            <Alert\n              variant=\"error\"\n              title=\"Error\"\n              message={error}\n              className=\"mb-4\"\n            />\n          )}\n\n          {/* Loading State */}\n          {isLoading && (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mr-3\"></div>\n              <span className=\"text-gray-600\">Loading scan history...</span>\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!isLoading && scans.length === 0 && !error && (\n            <div className=\"text-center py-12\">\n              <QrCodeIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-1\">\n                Belum Ada Scan\n              </h3>\n              <p className=\"text-gray-500\">\n                {submissionId \n                  ? 'Submission ini belum pernah di-scan'\n                  : 'Belum ada QR code yang di-scan'\n                }\n              </p>\n            </div>\n          )}\n\n          {/* Scan History List */}\n          {!isLoading && scans.length > 0 && (\n            <div className=\"space-y-4\">\n              {scans.map((scan) => {\n                const dateTime = formatDate(scan.scanned_at);\n                \n                return (\n                  <div\n                    key={scan.id}\n                    className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\"\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1 space-y-3\">\n                        {/* Scan Info */}\n                        <div className=\"flex items-center space-x-4\">\n                          <div className=\"flex items-center text-sm text-gray-600\">\n                            <ClockIcon className=\"h-4 w-4 mr-1\" />\n                            <span className=\"font-medium\">{dateTime.date}</span>\n                            <span className=\"mx-2\">•</span>\n                            <span>{dateTime.time}</span>\n                          </div>\n                          \n                          <div className=\"flex items-center text-sm\">\n                            <UserIcon className=\"h-4 w-4 text-gray-400 mr-1\" />\n                            <span className=\"font-medium text-gray-700\">\n                              {scan.scanner_name || scan.user.officer_name}\n                            </span>\n                            <span className=\"ml-2\">\n                              {getRoleBadge(scan.user.role)}\n                            </span>\n                          </div>\n                        </div>\n\n                        {/* Submission Info */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm\">\n                          <div className=\"flex items-center\">\n                            <DocumentIcon className=\"h-4 w-4 text-blue-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">SIMLOK:</span>\n                              <span className=\"ml-1 font-semibold text-blue-600\">\n                                {scan.submission.simlok_number}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"flex items-center\">\n                            <BuildingOfficeIcon className=\"h-4 w-4 text-green-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Vendor:</span>\n                              <span className=\"ml-1 font-medium\">\n                                {scan.submission.vendor_name}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <div className=\"flex items-center\">\n                            <UserIcon className=\"h-4 w-4 text-purple-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Petugas:</span>\n                              <span className=\"ml-1 font-medium\">\n                                {scan.submission.officer_name}\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Job Description */}\n                        <div className=\"text-sm\">\n                          <span className=\"text-gray-600\">Pekerjaan:</span>\n                          <span className=\"ml-1\">{scan.submission.job_description}</span>\n                        </div>\n\n                        {/* Location */}\n                        <div className=\"text-sm\">\n                          <span className=\"text-gray-600\">Lokasi:</span>\n                          <span className=\"ml-1\">{scan.submission.work_location}</span>\n                        </div>\n\n                        {/* Scan Location */}\n                        {scan.scan_location && (\n                          <div className=\"flex items-center text-sm\">\n                            <MapPinIcon className=\"h-4 w-4 text-orange-400 mr-2\" />\n                            <div>\n                              <span className=\"text-gray-600\">Lokasi Scan:</span>\n                              <span className=\"ml-1 font-medium text-orange-600\">{scan.scan_location}</span>\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Notes */}\n                        {scan.notes && (\n                          <div className=\"text-sm bg-blue-50 p-3 rounded-md border-l-4 border-blue-200\">\n                            <span className=\"text-blue-700 font-medium\">Catatan:</span>\n                            <span className=\"ml-1 text-blue-600\">{scan.notes}</span>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Actions */}\n                      <div className=\"flex-shrink-0 ml-4\">\n                        <Button\n                          onClick={() => setSelectedScan(scan)}\n                          variant=\"secondary\"\n                          size=\"sm\"\n                        >\n                          <EyeIcon className=\"h-4 w-4 mr-1\" />\n                          Detail\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Pagination */}\n          {!isLoading && scans.length > 0 && (\n            <div className=\"flex items-center justify-between mt-6 pt-4 border-t border-gray-200\">\n              <div className=\"text-sm text-gray-600\">\n                Showing {pagination.offset + 1} to {Math.min(pagination.offset + pagination.limit, pagination.total)} of {pagination.total} scans\n              </div>\n              \n              <div className=\"flex space-x-2\">\n                <Button\n                  onClick={handlePrevious}\n                  disabled={pagination.offset === 0}\n                  variant=\"secondary\"\n                  size=\"sm\"\n                >\n                  <ChevronLeftIcon className=\"h-4 w-4 mr-1\" />\n                  Previous\n                </Button>\n                \n                <Button\n                  onClick={handleNext}\n                  disabled={!pagination.hasMore}\n                  variant=\"secondary\"\n                  size=\"sm\"\n                >\n                  Next\n                  <ChevronRightIcon className=\"h-4 w-4 ml-1\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Detail Modal */}\n      {selectedScan && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          <div className=\"flex min-h-full items-center justify-center p-4\">\n            <div \n              className=\"fixed inset-0 bg-black/30 transition-opacity\"\n              onClick={() => setSelectedScan(null)}\n            />\n            \n            <div className=\"relative bg-white rounded-lg shadow-xl max-w-2xl w-full\">\n              <div className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n                  Detail Scan QR Code\n                </h3>\n                \n                <div className=\"space-y-4\">\n                  {/* Scan Details */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <span className=\"block text-sm font-medium text-gray-600\">Waktu Scan</span>\n                      <span className=\"text-gray-900\">\n                        {formatDate(selectedScan.scanned_at).date} - {formatDate(selectedScan.scanned_at).time}\n                      </span>\n                    </div>\n                    \n                    <div>\n                      <span className=\"block text-sm font-medium text-gray-600\">Di-scan Oleh</span>\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"text-gray-900\">\n                          {selectedScan.scanner_name || selectedScan.user.officer_name}\n                        </span>\n                        {getRoleBadge(selectedScan.user.role)}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Submission Details */}\n                  <div className=\"pt-4 border-t border-gray-200\">\n                    <h4 className=\"font-medium text-gray-900 mb-3\">Submission Details</h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                      <div>\n                        <span className=\"block font-medium text-gray-600\">SIMLOK Number</span>\n                        <span className=\"text-blue-600 font-semibold\">\n                          {selectedScan.submission.simlok_number}\n                        </span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Vendor</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.vendor_name}</span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Officer</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.officer_name}</span>\n                      </div>\n                      \n                      <div>\n                        <span className=\"block font-medium text-gray-600\">Status</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.approval_status}</span>\n                      </div>\n                      \n                      <div className=\"md:col-span-2\">\n                        <span className=\"block font-medium text-gray-600\">Job Description</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.job_description}</span>\n                      </div>\n                      \n                      <div className=\"md:col-span-2\">\n                        <span className=\"block font-medium text-gray-600\">Work Location</span>\n                        <span className=\"text-gray-900\">{selectedScan.submission.work_location}</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Scan Location */}\n                  {selectedScan.scan_location && (\n                    <div className=\"pt-4 border-t border-gray-200\">\n                      <div className=\"flex items-center\">\n                        <MapPinIcon className=\"h-5 w-5 text-orange-500 mr-2\" />\n                        <span className=\"block font-medium text-gray-600 mb-2\">Scan Location</span>\n                      </div>\n                      <div className=\"bg-orange-50 p-3 rounded-md text-sm text-orange-700 border-l-4 border-orange-200\">\n                        {selectedScan.scan_location}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Notes */}\n                  {selectedScan.notes && (\n                    <div className=\"pt-4 border-t border-gray-200\">\n                      <span className=\"block font-medium text-gray-600 mb-2\">Notes</span>\n                      <div className=\"bg-gray-50 p-3 rounded-md text-sm text-gray-700\">\n                        {selectedScan.notes}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Close Button */}\n                <div className=\"mt-6 flex justify-end\">\n                  <Button\n                    onClick={() => setSelectedScan(null)}\n                    variant=\"secondary\"\n                  >\n                    Close\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default ScanHistory;\n"
    },
    {
      "path": "src/components/scanner/ScanModal.tsx",
      "lang": "tsx",
      "size": 9276,
      "lines": 222,
      "hash": "16947916b9aacc5c305acf249a379adb82451dadf97378eba4e40e17cbb0492f",
      "truncated": false,
      "content": "'use client';\n\nimport React from 'react';\nimport { XMarkIcon } from '@heroicons/react/24/outline';\nimport { CheckCircleIcon, XCircleIcon } from '@heroicons/react/24/solid';\nimport Button from '@/components/ui/button/Button';\n\ninterface ScanResult {\n  success: boolean;\n  data?: any;\n  error?: string;\n  message?: string;\n  scanned_at?: string;\n  scanned_by?: string;\n  scan_id?: string;\n  previousScan?: {\n    scanDate: string | Date;\n    scanId: string;\n    scannerName: string;\n  };\n}\n\ninterface ScanModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  result: ScanResult;\n}\n\nconst ScanModal: React.FC<ScanModalProps> = ({\n  isOpen,\n  onClose,\n  result\n}) => {\n  if (!isOpen) return null;\n\n  // Debug logging\n  console.log('=== SCAN MODAL DEBUG ===');\n  console.log('result:', result);\n  console.log('result.data:', result.data);\n  console.log('result.data?.submission:', result.data?.submission);\n\n  const submission = result.data?.submission;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 md:p-8\"\n      onClick={onClose}\n    >\n      <div \n        className=\"bg-white  rounded-lg  shadow-xl h-full w-full md:h-auto md:max-w-2xl md:min-w-[600px] md:max-h-[80vh] flex flex-col\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"p-4 md:p-6 h-full flex flex-col overflow-hidden\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-4 shrink-0\">\n            <h2 className=\"text-xl font-semibold\">\n              {result.success ? 'Scan Berhasil' : 'Scan Gagal'}\n            </h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 p-1\"\n            >\n              <XMarkIcon className=\"h-6 w-6\" />\n            </button>\n          </div>\n\n          {/* Scrollable Content */}\n          <div className=\"flex-1 overflow-y-auto\">\n            {/* Status Icon & Message */}\n            <div className=\"text-center mb-6\">\n              {result.success ? (\n                <CheckCircleIcon className=\"h-16 w-16 text-green-500 mx-auto mb-3\" />\n              ) : (\n                <XCircleIcon className=\"h-16 w-16 text-red-500 mx-auto mb-3\" />\n              )}\n              \n              <p className=\"text-lg font-medium mb-2\">\n                {result.success ? 'Barcode/QR Code Valid' : \n                 result.error === 'duplicate_scan_same_day' ? 'Sudah Discan Hari Ini' :\n                 result.error === 'already_scanned_by_other' ? 'Sudah Discan Verifikator Lain' :\n                 result.error === 'duplicate_scan' ? 'QR Code Sudah Pernah Discan' :\n                 'Barcode/QR Code Tidak Valid'}\n              </p>\n              \n              {result.message && (\n                <p className=\"text-gray-600 text-sm md:text-base\">{result.message}</p>\n              )}\n              \n              {/* Show previous scan info for all duplicate error types */}\n              {(result.error === 'duplicate_scan_same_day' || \n                result.error === 'already_scanned_by_other' || \n                result.error === 'duplicate_scan') && result.previousScan && (\n                <div className=\"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200 text-left max-w-md mx-auto\">\n                  <h4 className=\"text-sm font-medium text-yellow-800 mb-2\">Informasi Scan Sebelumnya:</h4>\n                  <div className=\"text-xs text-yellow-700 space-y-1\">\n                    <p><span className=\"font-medium\">Verifikator:</span> {result.previousScan.scannerName}</p>\n                    <p><span className=\"font-medium\">Waktu:</span> {new Date(result.previousScan.scanDate).toLocaleDateString('id-ID', {\n                      day: '2-digit',\n                      month: '2-digit',\n                      year: 'numeric',\n                      hour: '2-digit',\n                      minute: '2-digit',\n                    })}</p>\n                  </div>\n                </div>\n              )}\n              \n              {result.error && !['duplicate_scan', 'duplicate_scan_same_day', 'already_scanned_by_other'].includes(result.error) && (\n                <p className=\"text-red-600 text-sm md:text-base\">{result.error}</p>\n              )}\n            </div>\n\n            {/* Submission Details */}\n            {result.success && submission && (\n              <div className=\"bg-gray-50 rounded-lg p-4 md:p-6 mb-6\">\n                <h3 className=\"font-semibold mb-4 text-lg\">Detail SIMLOK</h3>\n                <div className=\"space-y-4 md:space-y-3\">\n                  <div className=\"grid md:grid-cols-2 gap-4\">\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Nomor SIMLOK:</span>\n                      <p className=\"font-medium\">{submission.number || '-'}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Status:</span>\n                      <p className=\"font-medium capitalize\">\n                        {submission.status === 'approved' ? 'Disetujui' : \n                         submission.status === 'pending' ? 'Menunggu' : \n                         submission.status === 'rejected' ? 'Ditolak' : \n                         submission.status}\n                      </p>\n                    </div>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Vendor:</span>\n                    <p className=\"font-medium\">{submission.vendor?.name || '-'}</p>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Pekerjaan:</span>\n                    <p className=\"font-medium\">{submission.title || submission.task || '-'}</p>\n                  </div>\n                  <div>\n                    <span className=\"text-sm text-gray-600\">Lokasi:</span>\n                    <p className=\"font-medium\">{submission.location || '-'}</p>\n                  </div>\n                  {submission.workers && submission.workers.length > 0 && (\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Pekerja:</span>\n                      <div className=\"mt-1\">\n                        {submission.workers.map((worker: any, index: number) => (\n                          <p key={index} className=\"font-medium text-sm\">\n                            • {worker.name}\n                          </p>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  {(submission.implementation_start_date || submission.implementation_end_date) && (\n                    <div>\n                      <span className=\"text-sm text-gray-600\">Periode Pelaksanaan:</span>\n                      <p className=\"font-medium\">\n                        {submission.implementation_start_date ? \n                          new Date(submission.implementation_start_date).toLocaleDateString('id-ID') : \n                          '-'} \n                        {submission.implementation_end_date && \n                          ` s/d ${new Date(submission.implementation_end_date).toLocaleDateString('id-ID')}`}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Scan Information */}\n            {/* {result.success && (result.scanned_at || result.scanned_by) && (\n              <div className=\"bg-blue-50 rounded-lg p-4 mb-6\">\n                <h3 className=\"font-semibold mb-3 text-blue-900\">Informasi Scan</h3>\n                <div className=\"space-y-2\">\n                  {result.scanned_by && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">Discan oleh:</span>\n                      <p className=\"font-medium text-blue-900\">{result.scanned_by}</p>\n                    </div>\n                  )}\n                  {result.scanned_at && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">Waktu scan:</span>\n                      <p className=\"font-medium text-blue-900\">\n                        {new Date(result.scanned_at).toLocaleString('id-ID')}\n                      </p>\n                    </div>\n                  )}\n                  {result.scan_id && (\n                    <div>\n                      <span className=\"text-sm text-blue-700\">ID Scan:</span>\n                      <p className=\"font-medium text-blue-900 font-mono text-sm\">{result.scan_id}</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )} */}\n            \n            {/* Extra padding for better scrolling on mobile */}\n            <div className=\"pb-4 md:pb-6\"></div>\n          </div>\n\n          {/* Actions - Fixed at bottom */}\n          <div className=\"flex gap-3 shrink-0 pt-4 md:pt-6 border-t border-gray-200 md:px-2\">\n            <Button \n              onClick={onClose}\n              variant={result.success ? \"primary\" : \"outline\"}\n              className=\"flex-1 md:py-3 md:text-base md:font-medium\"\n            >\n              {result.success ? 'Selesai' : 'Tutup'}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ScanModal;"
    },
    {
      "path": "src/components/security/RoleGate.tsx",
      "lang": "tsx",
      "size": 880,
      "lines": 26,
      "hash": "344548adbbaf0be08346b5071cf3444d79a52046f2ccd1e29a7ca9fb5b25c792",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect } from \"react\";\n\ninterface Props {\n  allowedRoles: (\"SUPER_ADMIN\" | \"ADMIN\" | \"VENDOR\" | \"VERIFIER\" | \"REVIEWER\" | \"APPROVER\")[];\n  children: React.ReactNode;\n}\n\nexport default function RoleGate({ allowedRoles, children }: Props) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === \"loading\") return;\n    if (!session) router.replace(\"/login\");\n    else if (!allowedRoles.includes(session.user.role)) router.replace(\"/\"); // Redirect to home if role is not allowed\n  }, [session, status, allowedRoles, router]);\n\n  if (status === \"loading\") return <p className=\"p-8\">Loading…</p>;\n  if (!session || !allowedRoles.includes(session.user.role)) return null;\n\n  return <>{children}</>;\n}"
    },
    {
      "path": "src/components/security/SessionExpiryHandler.tsx",
      "lang": "tsx",
      "size": 4414,
      "lines": 138,
      "hash": "b6bfe92b727a1264620865b822fa6d0064ed294a6c054255b743c941bf34b7cf",
      "truncated": false,
      "content": "\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { JWT_CONFIG, getTimeUntilExpiry, formatExpiryTime } from \"@/utils/jwt-config\";\nimport ConfirmModal from \"../ui/modal/ConfirmModal\";\n\ninterface SessionExpiryHandlerProps {\n  children: React.ReactNode;\n}\n\nexport default function SessionExpiryHandler({ children }: SessionExpiryHandlerProps) {\n  const { data: session, status, update } = useSession();\n  const router = useRouter();\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const refreshIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  \n  const [showSessionWarning, setShowSessionWarning] = useState(false);\n  const [showSessionExpired, setShowSessionExpired] = useState(false);\n\n  useEffect(() => {\n    // Clear existing timeout\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    if (status === \"authenticated\" && session) {\n      // Calculate time until session expires\n      const now = Date.now() / 1000;\n      const expiresAt = session.expires ? new Date(session.expires).getTime() / 1000 : now + JWT_CONFIG.SESSION_MAX_AGE;\n      const timeUntilExpiry = getTimeUntilExpiry(expiresAt) * 1000; // Convert to milliseconds\n\n      console.log('Session expires at:', new Date(expiresAt * 1000));\n      console.log('Time until expiry:', formatExpiryTime(timeUntilExpiry / 1000));\n\n      if (timeUntilExpiry > 0) {\n        // Set timeout to show warning before expiry\n        const warningTime = Math.max(0, timeUntilExpiry - (JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000));\n        \n        timeoutRef.current = setTimeout(async () => {\n          setShowSessionWarning(true);\n        }, warningTime);\n      } else {\n        // Session already expired\n        console.log('Session already expired');\n        router.push(\"/login\");\n      }\n    }\n\n    // Cleanup timeout on unmount\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [session, status, router, update]);\n\n  // Auto-refresh session periodically (but not on visibility change)\n  useEffect(() => {\n    // Clear existing interval\n    if (refreshIntervalRef.current) {\n      clearInterval(refreshIntervalRef.current);\n    }\n\n    // Auto-refresh based on configured interval (only when authenticated)\n    if (status === \"authenticated\") {\n      refreshIntervalRef.current = setInterval(async () => {\n        try {\n          const response = await fetch(\"/api/auth/session\");\n          if (!response.ok) {\n            console.log('Session validation failed, redirecting to login');\n            setShowSessionExpired(true);\n          }\n        } catch (error) {\n          console.error('Session validation error:', error);\n          setShowSessionExpired(true);\n        }\n      }, JWT_CONFIG.AUTO_REFRESH_INTERVAL * 60 * 1000); // Convert minutes to milliseconds\n    }\n\n    return () => {\n      if (refreshIntervalRef.current) {\n        clearInterval(refreshIntervalRef.current);\n      }\n    };\n  }, [status, router]);\n\n  const handleExtendSession = async () => {\n    try {\n      await update();\n      setShowSessionWarning(false);\n      console.log('Session refreshed successfully');\n    } catch (error) {\n      console.error('Failed to refresh session:', error);\n      setShowSessionExpired(true);\n    }\n  };\n\n  const handleSessionExpiry = () => {\n    setShowSessionWarning(false);\n    setTimeout(() => {\n      setShowSessionExpired(true);\n    }, JWT_CONFIG.WARNING_BEFORE_EXPIRY * 60 * 1000);\n  };\n\n  const handleGoToLogin = () => {\n    setShowSessionExpired(false);\n    router.push(\"/login\");\n  };\n\n  return (\n    <>\n      {children}\n      \n      <ConfirmModal\n        isOpen={showSessionWarning}\n        title=\"Session Warning\"\n        message={`Your session will expire in ${JWT_CONFIG.WARNING_BEFORE_EXPIRY} minutes. Would you like to extend your session?`}\n        onConfirm={handleExtendSession}\n        onClose={handleSessionExpiry}\n        confirmText=\"Extend Session\"\n        cancelText=\"Let it expire\"\n      />\n\n      <ConfirmModal\n        isOpen={showSessionExpired}\n        title=\"Session Expired\"\n        message=\"Your session has expired. Please log in again.\"\n        onConfirm={handleGoToLogin}\n        onClose={handleGoToLogin}\n        confirmText=\"Go to Login\"\n        showCancel={false}\n      />\n    </>\n  );\n}\n"
    },
    {
      "path": "src/components/security/VerificationGuard.tsx",
      "lang": "tsx",
      "size": 1341,
      "lines": 52,
      "hash": "4bff1f2b0b869ccbbab49a9b4493bc2b3686c22152c80a04556cbf3ed229eb85",
      "truncated": false,
      "content": "'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { useEffect } from 'react';\n\ninterface VerificationGuardProps {\n  children: React.ReactNode;\n}\n\nexport default function VerificationGuard({ children }: VerificationGuardProps) {\n  const { data: session, status } = useSession();\n  const router = useRouter();\n\n  useEffect(() => {\n    if (status === 'loading') return; // Still loading\n\n    if (!session) {\n      router.push('/login');\n      return;\n    }\n\n    // Check if user is verified (admin always allowed)\n    if (session.user.role !== 'ADMIN' && !session.user.verified_at) {\n      console.log('VerificationGuard - User not verified, redirecting...');\n      router.push('/verification-pending');\n      return;\n    }\n  }, [session, status, router]);\n\n  // Show loading while checking\n  if (status === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Don't render if not authenticated\n  if (!session) {\n    return null;\n  }\n\n  // Don't render if not verified (except admin)\n  if (session.user.role !== 'ADMIN' && !session.user.verified_at) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n"
    },
    {
      "path": "src/components/submissions/SubmissionForm.tsx",
      "lang": "tsx",
      "size": 23702,
      "lines": 606,
      "hash": "976683d2fad62b14366b72f3b69b2ee644645494e64fef4902f0f0a641655235",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSession } from 'next-auth/react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport Input from '@/components/form/Input';\nimport Label from '@/components/form/Label';\nimport DatePicker from '@/components/form/DatePicker';\nimport TimePicker from '@/components/form/TimePicker';\nimport FileUpload from '@/components/form/FileUpload';\nimport Alert from \"../ui/alert/Alert\";\nimport { useToast } from '@/hooks/useToast';\nimport { SubmissionData } from '@/types/submission';\n\n// Define Worker interface for dynamic inputs\ninterface Worker {\n  id: string;\n  worker_name: string;\n  worker_photo: string;\n}\n\nexport default function SubmissionForm() {\n  const router = useRouter();\n  const { showSuccess, showError } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [alert, setAlert] = useState<{ variant: 'success' | 'error' | 'warning' | 'info', title: string, message: string } | null>(null);\n\n  const { data: session } = useSession();\n\n  // State for dynamic workers\n  const [workers, setWorkers] = useState<Worker[]>([\n    { id: '1', worker_name: '', worker_photo: '' }\n  ]);\n\n  // Auto-fill form data when session is available\n  useEffect(() => {\n    if (session?.user) {\n      console.log('Session user data:', session.user); // Debug log\n      setFormData(prev => ({\n        ...prev,\n        vendor_name: session.user.vendor_name || prev.vendor_name || '',\n        officer_name: session.user.officer_name || prev.officer_name || '',\n      }));\n    }\n  }, [session]);\n\n  \n  const [formData, setFormData] = useState<SubmissionData>({\n    vendor_name: '',\n    based_on: '',\n    officer_name: '',\n    job_description: '',\n    work_location: '',\n    working_hours: '',\n    work_facilities: '',\n    worker_count: 0,\n    simja_number: '',\n    simja_date: '',\n    sika_number: '',\n    sika_date: '',\n    worker_names: '',\n    sika_document_upload: '',\n    simja_document_upload: '',\n  });\n\n  // Handle file upload from FileUpload component\n  const handleFileUpload = (fieldName: string) => (url: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [fieldName]: url\n    }));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value, type } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'number' ? (value === '' ? 0 : Number(value)) : value\n    }));\n  };\n\n  const handleDateChange = (name: string) => (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleTimeChange = (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      working_hours: value\n    }));\n  };\n\n  // Functions for managing dynamic workers\n  const addWorker = () => {\n    const newWorker: Worker = {\n      id: Date.now().toString(),\n      worker_name: '',\n      worker_photo: ''\n    };\n    setWorkers(prev => [...prev, newWorker]);\n  };\n\n  const removeWorker = (id: string) => {\n    if (workers.length > 1) {\n      setWorkers(prev => prev.filter(worker => worker.id !== id));\n    }\n  };\n\n  const updateWorkerName = (id: string, nama: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, worker_name: nama } : worker\n    ));\n  };\n\n  const updateWorkerPhoto = (id: string, foto: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, worker_photo: foto } : worker\n    ));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      // Validate workers\n      const validWorkers = workers.filter(worker => worker.worker_name.trim() !== '');\n      if (validWorkers.length === 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Minimal harus ada satu pekerja yang diisi'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Check if all workers have photos\n      const workersWithoutPhoto = validWorkers.filter(worker => !worker.worker_photo.trim());\n      if (workersWithoutPhoto.length > 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Semua pekerja harus memiliki foto. Silakan upload foto untuk semua pekerja.'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Format worker names for database\n      const workerNames = validWorkers.map(worker => worker.worker_name.trim()).join('\\n');\n\n      // Prepare submission data\n      const formattedData = {\n        ...formData,\n        worker_names: workerNames,\n        workers: validWorkers // Include workers data for API processing\n      };\n\n      const response = await fetch('/api/submissions', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(formattedData),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create submission');\n      }\n\n      // Show success toast and redirect\n      showSuccess('Berhasil!', 'Pengajuan SIMLOK berhasil dibuat!');\n      router.push('/vendor/submissions');\n    } catch (error) {\n      console.error('Error creating submission:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Failed to create submission. Please try again.';\n      showError('Error!', errorMessage);\n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: errorMessage\n      });\n      setTimeout(() => setAlert(null), 5000);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      {/* Debug info - remove in production */}\n      {/* {process.env.NODE_ENV === 'development' && (\n        <div className=\"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n          <h3 className=\"font-semibold text-yellow-800\">Debug Session Info:</h3>\n          <pre className=\"text-sm text-yellow-700 mt-2\">\n            {JSON.stringify({\n              userId: session?.user?.id,\n              nama_petugas: session?.user?.nama_petugas,\n              nama_vendor: session?.user?.nama_vendor,\n              role: session?.user?.role,\n              email: session?.user?.email\n            }, null, 2)}\n          </pre>\n        </div>\n      )} */}\n      \n      <Card>\n        <div className=\"p-6\">\n          {/* <h1 className=\"text-2xl font-bold mb-6\">Buat Pengajuan Baru</h1> */}\n          \n          <form onSubmit={handleSubmit} className=\"space-y-8\">\n            {/* Informasi Vendor */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Vendor</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"vendor_name\">Nama vendor</Label>\n                  <Input\n                    id=\"vendor_name\"\n                    name=\"vendor_name\"\n                    value={session?.user?.vendor_name || formData.vendor_name || ''}\n                    onChange={handleChange}\n                    required\n                    readOnly={!!session?.user?.vendor_name}\n                    disabled={!!session?.user?.vendor_name}\n                    className={session?.user?.vendor_name ? \" cursor-not-allowed\" : \"\"}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"officer_name\">Nama petugas</Label>\n                  <Input\n                    id=\"officer_name\"\n                    name=\"officer_name\"\n                    value={session?.user?.officer_name || formData.officer_name || ''}\n                    onChange={handleChange}\n                    required\n                    readOnly={!!session?.user?.officer_name}\n                    disabled={!!session?.user?.officer_name}\n                    className={session?.user?.officer_name ? \" cursor-not-allowed\" : \"\"}\n                    placeholder=\"Nama petugas yang bertanggung jawab\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <Label htmlFor=\"based_on\">Berdasarkan</Label>\n                  <Input\n                    id=\"based_on\"\n                    name=\"based_on\"\n                    value={formData.based_on}\n                    onChange={handleChange}\n                    type='text'\n                    required\n                  />\n                </div>\n\n                {/* Document Numbers */}\n                <div>\n                  <Label htmlFor=\"simja_number\">Nomor SIMJA</Label>\n                  <Input\n                    id=\"simja_number\"\n                    name=\"simja_number\"\n                    value={formData.simja_number}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIMJA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sika_number\">Nomor SIKA</Label>\n                  <Input\n                    id=\"sika_number\"\n                    name=\"sika_number\"\n                    value={formData.sika_number}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIKA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"simja_date\">Tanggal SIMJA</Label>\n                  <DatePicker\n                    id=\"simja_date\"\n                    name=\"simja_date\"\n                    value={formData.simja_date || ''}\n                    onChange={handleDateChange('simja_date')}\n                    placeholder=\"Pilih tanggal SIMJA\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sika_date\">Tanggal SIKA</Label>\n                  <DatePicker\n                    id=\"sika_date\"\n                    name=\"sika_date\"\n                    value={formData.sika_date || ''}\n                    onChange={handleDateChange('sika_date')}\n                    placeholder=\"Pilih tanggal SIKA\"\n                    required\n                  />\n                </div>\n\n                {/* File Upload Areas */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"simja_document_upload\">UPLOAD DOKUMEN SIMJA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"simja_document_upload\"\n                      name=\"simja_document_upload\"\n                      label=\"\"\n                      description=\"Upload dokumen SIMJA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.simja_document_upload || ''}\n                      onChange={handleFileUpload('simja_document_upload')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"sika_document_upload\">UPLOAD DOKUMEN SIKA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"sika_document_upload\"\n                      name=\"sika_document_upload\"\n                      label=\"\"\n                      description=\"Upload dokumen SIKA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.sika_document_upload || ''}\n                      onChange={handleFileUpload('sika_document_upload')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Informasi Pekerjaan */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Pekerjaan</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"job_description\">Pekerjaan</Label>\n                  <Input\n                    id=\"job_description\"\n                    name=\"job_description\"\n                    value={formData.job_description}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"work_location\">Lokasi kerja</Label>\n                  <Input\n                    id=\"work_location\"\n                    name=\"work_location\"\n                    value={formData.work_location}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"working_hours\">Jam kerja</Label>\n                  <TimePicker\n                    id=\"working_hours\"\n                    name=\"working_hours\"\n                    value={formData.working_hours}\n                    onChange={handleTimeChange}\n                    required\n                    placeholder=\"Pilih jam kerja\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"work_facilities\">Sarana kerja</Label>\n                  <Input\n                    id=\"work_facilities\"\n                    name=\"work_facilities\"\n                    value={formData.work_facilities}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: Toolkit lengkap, APD standar, crane mobile\"\n                    required\n                  />\n                </div>\n              </div>\n            </div>\n\n\n\n            {/* Daftar nama pekerja */}\n            <div className=\"p-6 rounded-lg\">\n              <div className=\"flex justify-between items-center mb-6 border-b border-gray-300 \">\n                <div className='flex justify-between'>\n                  <h2 className=\"text-lg font-semibold text-gray-900 pb-2\">Daftar Nama Pekerja</h2>\n                  {/* <p className=\"text-sm text-gray-500 mt-2\">Total: {workers.length} pekerja</p> */}\n                </div>\n               \n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                <div>\n                  <Label htmlFor=\"worker_count\">Jumlah Pekerja</Label>\n                  <Input\n                    id=\"worker_count\"\n                    name=\"worker_count\"\n                    type=\"number\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={formData.worker_count || ''}\n                    onChange={handleChange}\n                    placeholder=\"Masukkan jumlah pekerja\"\n                    required\n                  />\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    Jumlah total pekerja yang akan bekerja di lokasi ini\n                  </p>\n                </div>\n                <div className=\"flex items-end\">\n                  <div className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg\">\n                    <div className=\"font-medium mb-1\">Info:</div>\n                    <div>Pekerja yang diinput: {workers.length}</div>\n                    <div>Jumlah pekerja: {formData.worker_count || 0}</div>\n                    {formData.worker_count && workers.length !== Number(formData.worker_count) && (\n                      <div className=\"text-orange-600 mt-1\">\n                        ⚠️ Jumlah tidak sesuai dengan daftar pekerja\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n              {/* Workers Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {workers.map((worker, _index) => (\n                  <div key={worker.id} className=\"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md\">\n                    {/* Header */}\n                    <div className=\"flex justify-between items-center mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        {/* <div className=\"bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium\">\n                          {index + 1}\n                        </div>\n                        <span className=\"text-sm font-medium text-gray-700\">Pekerja {index + 1}</span> */}\n                      </div>\n                      {workers.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          onClick={() => removeWorker(worker.id)}\n                          variant=\"outline\"\n                          className=\"text-red-500 hover:bg-red-50 border-red-200 w-8 h-8 p-0 rounded-full\"\n                          title=\"Hapus pekerja\"\n                        >\n                          ✕\n                        </Button>\n                      )}\n                    </div>\n                    \n                    {/* Photo Preview */}\n                    <div className=\"mb-4\">\n\n                      <div className=\"relative\">\n                        {worker.worker_photo ? (\n                          <div className=\"relative group\">\n                            <img \n                              src={worker.worker_photo} \n                              alt={`Foto ${worker.worker_name || 'pekerja'}`}\n                              className=\"w-full h-50 object-cover rounded-lg border-2 border-gray-300\"\n                            />\n                            <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center\">\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                onClick={() => document.getElementById(`worker_photo_${worker.id}`)?.click()}\n                                className=\"bg-white text-gray-800 hover:bg-gray-100 text-xs px-3 py-1\"\n                              >\n                                Ganti Foto\n                              </Button>\n                            </div>\n                            <button\n                              type=\"button\"\n                              onClick={() => updateWorkerPhoto(worker.id, '')}\n                              className=\"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\"\n                              title=\"Hapus foto\"\n                            >\n                              ✕\n                            </button>\n                          </div>\n                        ) : (\n                          <div \n                            onClick={() => document.getElementById(`worker_photo_${worker.id}`)?.click()}\n                            className=\"w-full h-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 bg-gray-50\"\n                          >\n                           \n                            <p className=\"text-sm font-medium text-gray-600\">Upload Foto Pekerja</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">Klik atau drag & drop foto</p>\n   \n                          </div>\n                        )}\n                        <FileUpload\n                          id={`worker_photo_${worker.id}`}\n                          name={`worker_photo_${worker.id}`}\n                          label=\"\"\n                          description=\"\"\n                          value={worker.worker_photo}\n                          onChange={(url) => updateWorkerPhoto(worker.id, url)}\n                          accept=\".jpg,.jpeg,.png\"\n                          maxSize={8}\n                          required={false}\n                          className=\"sr-only\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Name Input */}\n                    <div>\n                      <Label htmlFor={`worker_name_${worker.id}`} className=\"text-sm font-medium text-gray-700\">\n                        Nama Lengkap\n                      </Label>\n                      <Input\n                        id={`worker_name_${worker.id}`}\n                        name={`worker_name_${worker.id}`}\n                        value={worker.worker_name}\n                        onChange={(e) => updateWorkerName(worker.id, e.target.value)}\n                        placeholder=\"Masukkan nama lengkap\"\n                        required\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    \n                    {/* Status Indicator */}\n                    <div className=\"mt-3 flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${\n                        worker.worker_name.trim() && worker.worker_photo.trim()\n                          ? 'bg-green-400' \n                          : 'bg-red-400'\n                      }`}></div>\n                      <span className={`text-xs ${\n                        worker.worker_name.trim() && worker.worker_photo.trim()\n                          ? 'text-green-600' \n                          : 'text-red-600'\n                      }`}>\n                        {worker.worker_name.trim() && worker.worker_photo.trim()\n                          ? 'Lengkap' \n                          : worker.worker_name.trim() \n                            ? 'Perlu foto' \n                            : 'Belum lengkap'}\n                      </span>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Add New Worker Card */}\n                <div \n                  onClick={addWorker}\n                  className=\"border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex flex-col items-center justify-center min-h-[280px] text-gray-500 hover:text-blue-600\"\n                >\n                  <div className=\"text-4xl mb-2\">➕</div>\n                  <p className=\"text-sm font-medium\">Tambah Pekerja Baru</p>\n                  <p className=\"text-xs mt-1\">Klik untuk menambah</p>\n                </div>\n              </div>\n            \n            </div>\n\n            <div className=\"flex justify-end space-x-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => router.back()}\n              >\n                Batal\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={isLoading}\n              >\n                {isLoading ? 'Menyimpan...' : 'Buat Pengajuan'}\n              </Button>\n            </div>\n          </form>\n        </div>\n      </Card>\n\n      {/* Alert */}\n      {alert && (\n        <Alert\n          variant={alert.variant}\n          title={alert.title}\n          message={alert.message}\n        />\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/test/QRGenerator.tsx",
      "lang": "tsx",
      "size": 7045,
      "lines": 220,
      "hash": "ccf4df95abf3c62454b2d1b4fc1b3c3dccb039f57713a681815d294f75de7d30",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useRef } from 'react';\nimport QRCode from 'qrcode';\nimport Button from '@/components/ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport { generateQrString } from '@/lib/qr-security';\n\ninterface QRGeneratorProps {\n  data?: string;\n}\n\nexport default function QRGenerator({ data = 'cmeg7fce10003silbg30j9em8' }: QRGeneratorProps) {\n  const [qrText, setQrText] = useState(data);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [generatedQrString, setGeneratedQrString] = useState<string>('');\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const { showSuccess, showError } = useToast();\n\n  const generateSecureQR = () => {\n    try {\n      // Generate proper QR format using the security function\n      const qrString = generateQrString({\n        id: qrText,\n        implementation_start_date: new Date(),\n        implementation_end_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 days from now\n      });\n      \n      setQrText(qrString);\n      setGeneratedQrString(qrString);\n      showSuccess(\"Secure QR Generated\", \"QR dengan format yang benar telah dibuat\");\n    } catch (error) {\n      console.error('Error generating secure QR:', error);\n      showError(\"Error\", \"Gagal membuat secure QR\");\n    }\n  };\n\n  const generateQRCode = async () => {\n    if (!qrText.trim()) {\n      showError(\"Error\", \"Masukkan teks untuk QR code\");\n      return;\n    }\n\n    setIsGenerating(true);\n    try {\n      const canvas = canvasRef.current;\n      if (canvas) {\n        await QRCode.toCanvas(canvas, qrText, {\n          errorCorrectionLevel: 'M',\n          margin: 1,\n          color: {\n            dark: '#000000',\n            light: '#FFFFFF'\n          },\n          width: 200\n        });\n\n        // Also generate data URL for download\n        const dataUrl = await QRCode.toDataURL(qrText, {\n          errorCorrectionLevel: 'M',\n          margin: 1,\n          color: {\n            dark: '#000000',\n            light: '#FFFFFF'\n          },\n          width: 300\n        });\n        setQrCodeUrl(dataUrl);\n\n        showSuccess(\"QR Code Generated\", \"QR code berhasil dibuat. Coba scan dengan scanner!\");\n      }\n    } catch (error) {\n      console.error('Error generating QR code:', error);\n      showError(\"Error\", \"Gagal membuat QR code\");\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const downloadQRCode = () => {\n    if (qrCodeUrl) {\n      const link = document.createElement('a');\n      link.download = `qr-code-${Date.now()}.png`;\n      link.href = qrCodeUrl;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n  };\n\n  const copyText = () => {\n    navigator.clipboard.writeText(qrText).then(() => {\n      showSuccess(\"Copied\", \"Teks QR code berhasil disalin\");\n    });\n  };\n\n  const sampleData = [\n    { label: 'Sample Submission ID (Raw)', value: 'cmeg7fce10003silbg30j9em8' },\n    { label: 'Another Submission (Raw)', value: 'cmevi912t0002si34tkyfb4vr' },\n    { label: 'New Ultra-Short QR Format', value: 'SL:cmeg7fce10003silbg30j9em8:1758047684671:b0915b' },\n    { label: 'Old Base64 Format (Legacy)', value: 'SL|eyJpZCI6ImNtZWc3ZmNlMTAwMDNzaWxiZzMwajllbTgiLCJleHAiOjE3NTgwNDc2ODQ2NzEsInNpZyI6ImIwOTE1YmVjIn0=' },\n    { label: 'Simple Test Data', value: 'test-submission-123' },\n    { label: 'Website URL', value: 'https://example.com/submission/test' }\n  ];\n\n  return (\n    <div className=\"bg-white shadow rounded-lg\">\n      <div className=\"px-6 py-4 border-b border-gray-200\">\n        <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n          QR Code Generator\n        </h3>\n        <p className=\"mt-1 text-sm text-gray-500\">\n          Buat QR code untuk test scanner\n        </p>\n      </div>\n      \n      <div className=\"p-6\">\n        {/* Input Section */}\n        <div className=\"mb-4\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Data QR Code\n          </label>\n          <textarea\n            value={qrText}\n            onChange={(e) => setQrText(e.target.value)}\n            placeholder=\"Masukkan teks atau data untuk QR code...\"\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm bg-white text-gray-900 resize-none\"\n            rows={3}\n          />\n        </div>\n\n        {/* Sample Data */}\n        <div className=\"mb-4\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Data Contoh\n          </label>\n          <div className=\"grid grid-cols-1 gap-2\">\n            {sampleData.map((sample, index) => (\n              <Button\n                key={index}\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setQrText(sample.value)}\n                className=\"justify-start text-left h-auto py-2\"\n              >\n                <div>\n                  <div className=\"font-medium\">{sample.label}</div>\n                  <div className=\"text-xs text-gray-500 truncate max-w-[200px]\">\n                    {sample.value}\n                  </div>\n                </div>\n              </Button>\n            ))}\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex gap-2 mb-4\">\n          <Button \n            onClick={generateQRCode} \n            disabled={isGenerating || !qrText.trim()}\n            className=\"flex-1\"\n          >\n            {isGenerating ? 'Generating...' : 'Generate QR Code'}\n          </Button>\n          <Button \n            variant=\"outline\" \n            onClick={generateSecureQR}\n          >\n            Generate Secure QR\n          </Button>\n          <Button \n            variant=\"outline\" \n            onClick={copyText}\n            disabled={!qrText.trim()}\n          >\n            Copy Text\n          </Button>\n        </div>\n\n        {/* Generated QR String Info */}\n        {generatedQrString && (\n          <div className=\"mb-4 p-3 bg-blue-50 rounded-lg\">\n            <label className=\"block text-sm font-medium text-blue-800 mb-1\">\n              Generated Secure QR String:\n            </label>\n            <code className=\"text-xs text-blue-700 break-all block bg-white p-2 rounded border\">\n              {generatedQrString}\n            </code>\n          </div>\n        )}\n\n        {/* QR Code Display */}\n        <div className=\"text-center\">\n          <canvas\n            ref={canvasRef}\n            className=\"mx-auto border border-gray-200 rounded\"\n            style={{ display: qrCodeUrl ? 'block' : 'none' }}\n          />\n          \n          {qrCodeUrl && (\n            <div className=\"mt-4\">\n              <Button variant=\"outline\" onClick={downloadQRCode} size=\"sm\">\n                Download QR Code\n              </Button>\n            </div>\n          )}\n          \n          {!qrCodeUrl && (\n            <div className=\"py-8 text-gray-500\">\n              QR code akan muncul di sini setelah generate\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/test/QRTestHelper.tsx",
      "lang": "tsx",
      "size": 3451,
      "lines": 105,
      "hash": "e48524fa77659ece135bdcad4a0066c8d90bbeb478e2c92a068e28acf98bd16b",
      "truncated": false,
      "content": "'use client';\n\nimport { useState } from 'react';\nimport { QrCodeIcon, DocumentDuplicateIcon } from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\n\nexport default function QRTestHelper() {\n  const [submissionId, setSubmissionId] = useState('');\n  const [qrData, setQrData] = useState('');\n\n  const generateTestQR = () => {\n    if (!submissionId.trim()) {\n      alert('Masukkan ID submission terlebih dahulu');\n      return;\n    }\n\n    // Generate QR data format yang sama dengan sistem\n    const qrContent = JSON.stringify({\n      submissionId: submissionId.trim(),\n      type: 'simlok',\n      timestamp: new Date().toISOString()\n    });\n\n    setQrData(qrContent);\n  };\n\n  const copyToClipboard = () => {\n    if (qrData) {\n      navigator.clipboard.writeText(qrData);\n      alert('Data QR berhasil disalin ke clipboard!');\n    }\n  };\n\n  return (\n    <div className=\"bg-white shadow rounded-lg p-6\">\n      <h3 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n        <QrCodeIcon className=\"w-5 h-5 mr-2\" />\n        Test QR Scanner\n      </h3>\n      \n      <div className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            ID Submission untuk Test\n          </label>\n          <input\n            type=\"text\"\n            value={submissionId}\n            onChange={(e) => setSubmissionId(e.target.value)}\n            className=\"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            placeholder=\"Masukkan ID submission yang valid...\"\n          />\n        </div>\n        \n        <Button\n          onClick={generateTestQR}\n          className=\"w-full bg-green-600 hover:bg-green-700\"\n        >\n          Generate Test QR Data\n        </Button>\n        \n        {qrData && (\n          <div className=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n            <div className=\"flex justify-between items-center mb-2\">\n              <h4 className=\"text-sm font-medium text-gray-900\">\n                Data QR untuk Test:\n              </h4>\n              <Button\n                onClick={copyToClipboard}\n                variant=\"outline\"\n                size=\"sm\"\n              >\n                <DocumentDuplicateIcon className=\"w-4 h-4 mr-1\" />\n                Copy\n              </Button>\n            </div>\n            \n            <div className=\"bg-white p-3 rounded border text-xs font-mono text-gray-800 break-all\">\n              {qrData}\n            </div>\n            \n            <p className=\"mt-2 text-xs text-gray-500\">\n              Gunakan data ini di \"Input Manual\" pada scanner untuk test\n            </p>\n          </div>\n        )}\n        \n        <div className=\"mt-6 p-4 bg-blue-50 rounded-lg\">\n          <h5 className=\"text-sm font-medium text-blue-800 mb-2\">\n            Cara testing scanner:\n          </h5>\n          <ol className=\"text-xs text-blue-700 space-y-1 list-decimal list-inside\">\n            <li>Masukkan ID submission yang valid (lihat di database)</li>\n            <li>Klik \"Generate Test QR Data\"</li>\n            <li>Copy data yang dihasilkan</li>\n            <li>Buka scanner dan pilih \"Input Manual\"</li>\n            <li>Paste data yang sudah dicopy</li>\n            <li>Scanner akan memproses seperti scan QR code asli</li>\n          </ol>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/test/QRTestPage.tsx",
      "lang": "tsx",
      "size": 5124,
      "lines": 148,
      "hash": "3bbb5316d236cbdc4cccd652d4dc23b27dc800b18ca3d67e47481a9fbc7e3c4a",
      "truncated": false,
      "content": "'use client';\n\nimport { useState } from 'react';\nimport * as QRCode from 'qrcode';\nimport { generateQrString, parseQrString } from '@/lib/qr-security';\n\nexport default function QRTestPage() {\n  const [submissionId, setSubmissionId] = useState('test-submission-123');\n  const [qrString, setQrString] = useState('');\n  const [qrImageUrl, setQrImageUrl] = useState('');\n  const [testResult, setTestResult] = useState('');\n\n  const generateTestQR = async () => {\n    try {\n      // Generate QR string using the same method as the system\n      const generatedQrString = generateQrString({\n        id: submissionId,\n        implementation_start_date: new Date(),\n        implementation_end_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days from now\n      });\n      \n      setQrString(generatedQrString);\n      \n      // Generate QR image\n      const dataUrl = await QRCode.toDataURL(generatedQrString, {\n        width: 300,\n        margin: 2,\n        color: {\n          dark: '#000000',\n          light: '#FFFFFF'\n        }\n      });\n      \n      setQrImageUrl(dataUrl);\n      \n      // Test parsing\n      const parsed = parseQrString(generatedQrString);\n      setTestResult(JSON.stringify(parsed, null, 2));\n      \n    } catch (error) {\n      console.error('Error generating QR:', error);\n      setTestResult('Error: ' + error);\n    }\n  };\n\n  const testParsing = () => {\n    if (!qrString) return;\n    \n    try {\n      const parsed = parseQrString(qrString);\n      setTestResult(JSON.stringify(parsed, null, 2));\n    } catch (error) {\n      setTestResult('Error parsing: ' + error);\n    }\n  };\n\n  return (\n    <div className=\"p-8 max-w-4xl mx-auto\">\n      <h1 className=\"text-2xl font-bold mb-6\">QR Code Test Page</h1>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n        {/* Generator */}\n        <div className=\"bg-white p-6 rounded-lg shadow\">\n          <h2 className=\"text-xl font-semibold mb-4\">Generate QR Code</h2>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">Submission ID</label>\n              <input\n                type=\"text\"\n                value={submissionId}\n                onChange={(e) => setSubmissionId(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md\"\n                placeholder=\"Enter submission ID\"\n              />\n            </div>\n            \n            <button\n              onClick={generateTestQR}\n              className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700\"\n            >\n              Generate QR Code\n            </button>\n            \n            {qrString && (\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Generated QR String</label>\n                <textarea\n                  value={qrString}\n                  onChange={(e) => setQrString(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md h-24 text-xs font-mono\"\n                />\n              </div>\n            )}\n            \n            <button\n              onClick={testParsing}\n              disabled={!qrString}\n              className=\"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:bg-gray-400\"\n            >\n              Test Parsing\n            </button>\n          </div>\n        </div>\n        \n        {/* Display */}\n        <div className=\"bg-white p-6 rounded-lg shadow\">\n          <h2 className=\"text-xl font-semibold mb-4\">QR Code & Results</h2>\n          \n          {qrImageUrl && (\n            <div className=\"mb-4 text-center\">\n              <img src={qrImageUrl} alt=\"QR Code\" className=\"mx-auto\" />\n              <p className=\"text-sm text-gray-600 mt-2\">Scan this QR code with your camera</p>\n            </div>\n          )}\n          \n          {testResult && (\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">Parse Result</label>\n              <pre className=\"bg-gray-100 p-4 rounded-md text-xs overflow-auto\">\n                {testResult}\n              </pre>\n            </div>\n          )}\n        </div>\n      </div>\n      \n      {/* Format Examples */}\n      <div className=\"mt-8 bg-yellow-50 p-6 rounded-lg\">\n        <h3 className=\"text-lg font-semibold mb-4\">QR Code Format Examples</h3>\n        <div className=\"space-y-2 text-sm\">\n          <div><strong>New Format:</strong> <code>SL:submissionId:expiration:signature</code></div>\n          <div><strong>Old Format:</strong> <code>SL|base64EncodedData</code></div>\n          <div><strong>Raw ID:</strong> <code>submissionId</code> (not recommended)</div>\n        </div>\n        \n        <div className=\"mt-4\">\n          <h4 className=\"font-medium mb-2\">Test Cases:</h4>\n          <div className=\"space-y-1 text-xs font-mono\">\n            <div>VALID: SL:test-123:1695211200000:abc123def456...</div>\n            <div>VALID: SL|eyJpIjoidGVzdC0xMjMiLCJlIjoxNjk1...</div>\n            <div>WARNING: test-submission-123 (raw ID)</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/ui/ActivityList.tsx",
      "lang": "tsx",
      "size": 391,
      "lines": 17,
      "hash": "af7951f8253a0db45f79bc122b7c70035fb4f5cae92b26463b494e2a36bdd30d",
      "truncated": false,
      "content": "\"use client\";\nexport function ActivityList({\n  items,\n}: {\n  items: { id: number; txt: string; time: string }[];\n}) {\n  return (\n    <ul className=\"space-y-3\">\n      {items.map((act) => (\n        <li key={act.id} className=\"text-sm\">\n          <p className=\"text-slate-900\">{act.txt}</p>\n          <p className=\"text-xs text-slate-500\">{act.time}</p>\n        </li>\n      ))}\n    </ul>\n  );\n}"
    },
    {
      "path": "src/components/ui/Badge.tsx",
      "lang": "tsx",
      "size": 960,
      "lines": 32,
      "hash": "6dde252cfdc5e225915e58c53737693203ab5c288b90746919e00c618bdafb77",
      "truncated": false,
      "content": "\"use client\";\n\ninterface BadgeProps {\n  children: React.ReactNode;\n  variant?: \"default\" | \"success\" | \"warning\" | \"destructive\";\n}\n\nexport function Badge({ children, variant = \"default\" }: BadgeProps) {\n  const variantClasses = {\n    default: \"border-slate-200 bg-slate-50 text-slate-700\",\n    success: \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n    warning: \"border-amber-200 bg-amber-50 text-amber-700\",\n    destructive: \"border-red-200 bg-red-50 text-red-700\",\n  };\n\n  // Force red styling with inline styles for destructive variant\n  const inlineStyle = variant === 'destructive' ? {\n    borderColor: '#ef4444 !important',\n    backgroundColor: '#ef4444 !important',\n    color: '#ffffff !important',\n    fontWeight: '600'\n  } : {};\n\n  return (\n    <span \n      className={`inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium ${variantClasses[variant]}`}\n      style={inlineStyle}\n    >\n      {children}\n    </span>\n  );\n}"
    },
    {
      "path": "src/components/ui/Card.tsx",
      "lang": "tsx",
      "size": 322,
      "lines": 18,
      "hash": "c189e58c4e78b53eb87eedaaa2901f0187bb089a487791a5d23111a0a039076c",
      "truncated": false,
      "content": "\"use client\";\nimport type { ReactNode } from \"react\";\n\nexport default function Card({\n  children,\n  className = \"\",\n}: {\n  children: ReactNode;\n  className?: string;\n}) {\n  return (\n    <div\n      className={`rounded-2xl border border-slate-200/70 bg-white shadow-sm ${className}`}\n    >\n      {children}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/ui/LoadingSpinner.tsx",
      "lang": "tsx",
      "size": 546,
      "lines": 25,
      "hash": "10d36535b0c6612cb4bebe92e6b593a5d2912ae95353b3f6f003a01c4714336b",
      "truncated": false,
      "content": "'use client';\n\ninterface LoadingSpinnerProps {\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n}\n\nexport default function LoadingSpinner({ size = 'md', className = '' }: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: 'w-4 h-4',\n    md: 'w-6 h-6',\n    lg: 'w-8 h-8'\n  };\n\n  return (\n    <div\n      className={`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${sizeClasses[size]} ${className}`}\n      role=\"status\"\n      aria-label=\"Loading\"\n    >\n      <span className=\"sr-only\">Loading...</span>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/ui/RichTextEditor.tsx",
      "lang": "tsx",
      "size": 8929,
      "lines": 299,
      "hash": "09f7abd5754e32a0be56774331b56b3c767f332ca1ae31f40b470cedea689b17",
      "truncated": false,
      "content": "'use client';\n\nimport React, { useCallback, useEffect } from 'react';\nimport { \n  $getRoot, \n  $getSelection, \n  $isRangeSelection,\n  FORMAT_TEXT_COMMAND,\n  SELECTION_CHANGE_COMMAND,\n  EditorState,\n  $createParagraphNode,\n  $createTextNode,\n} from 'lexical';\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\nimport { ListItemNode, ListNode } from '@lexical/list';\nimport { LexicalErrorBoundary } from '@lexical/react/LexicalErrorBoundary';\nimport { \n  INSERT_ORDERED_LIST_COMMAND, \n  INSERT_UNORDERED_LIST_COMMAND,\n  REMOVE_LIST_COMMAND\n} from '@lexical/list';\n\n\n// Toolbar Component\nfunction ToolbarPlugin() {\n  const [editor] = useLexicalComposerContext();\n  const [isBold, setIsBold] = React.useState(false);\n  const [isItalic, setIsItalic] = React.useState(false);\n  const [isUnderline, setIsUnderline] = React.useState(false);\n\n  const $updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n    }\n  }, []);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (_payload, _newEditor) => {\n        $updateToolbar();\n        return false;\n      },\n      1,\n    );\n  }, [editor, $updateToolbar]);\n\n  return (\n    <div className=\"flex items-center space-x-2 p-2 border-b border-gray-200 bg-gray-50\">\n      {/* Bold */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={`p-2 rounded text-sm font-medium transition-colors ${\n          isBold \n            ? 'bg-blue-500 text-white' \n            : 'bg-white hover:bg-gray-100 text-gray-700 border border-gray-300'\n        }`}\n        title=\"Bold (Ctrl+B)\"\n      >\n        <strong>B</strong>\n      </button>\n\n      {/* Italic */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={`p-2 rounded text-sm font-medium transition-colors ${\n          isItalic \n            ? 'bg-blue-500 text-white' \n            : 'bg-white hover:bg-gray-100 text-gray-700 border border-gray-300'\n        }`}\n        title=\"Italic (Ctrl+I)\"\n      >\n        <em>I</em>\n      </button>\n\n      {/* Underline */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={`p-2 rounded text-sm font-medium transition-colors ${\n          isUnderline \n            ? 'bg-blue-500 text-white' \n            : 'bg-white hover:bg-gray-100 text-gray-700 border border-gray-300'\n        }`}\n        title=\"Underline (Ctrl+U)\"\n      >\n        <u>U</u>\n      </button>\n\n      <div className=\"w-px h-6 bg-gray-300 mx-2\"></div>\n\n      {/* Bullet List */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n        }}\n        className=\"p-2 rounded text-sm font-medium transition-colors bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n        title=\"Bullet List\"\n      >\n        •\n      </button>\n\n      {/* Numbered List */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n        }}\n        className=\"p-2 rounded text-sm font-medium transition-colors bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n        title=\"Numbered List\"\n      >\n        1.\n      </button>\n\n      {/* Remove List */}\n      <button\n        type=\"button\"\n        onClick={() => {\n          editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n        }}\n        className=\"p-2 rounded text-sm font-medium transition-colors bg-white hover:bg-gray-100 text-gray-700 border border-gray-300\"\n        title=\"Remove List\"\n      >\n        ✕\n      </button>\n    </div>\n  );\n}\n\n// Plugin to set initial content\nfunction InitialContentPlugin({ value }: { value: string }) {\n  const [editor] = useLexicalComposerContext();\n  \n  useEffect(() => {\n    if (value) {\n      editor.update(() => {\n        const root = $getRoot();\n        root.clear();\n        \n        // Split by lines and create paragraphs\n        const lines = value.split('\\n');\n        lines.forEach((line) => {\n          const paragraph = $createParagraphNode();\n          \n          // Handle HTML formatting (bold, italic, etc.)\n          if (line.includes('<strong>') || line.includes('<b>')) {\n            // Parse simple HTML formatting\n            const parts = line.split(/(<\\/?(?:strong|b)>)/);\n            let isBold = false;\n            \n            parts.forEach(part => {\n              if (part === '<strong>' || part === '<b>') {\n                isBold = true;\n              } else if (part === '</strong>' || part === '</b>') {\n                isBold = false;\n              } else if (part && part.trim()) {\n                const textNode = $createTextNode(part);\n                if (isBold) {\n                  textNode.toggleFormat('bold');\n                }\n                paragraph.append(textNode);\n              }\n            });\n          } else {\n            // Plain text\n            const textNode = $createTextNode(line || '');\n            paragraph.append(textNode);\n          }\n          \n          root.append(paragraph);\n        });\n      });\n    }\n  }, [editor, value]);\n\n  return null;\n}\n\n// Main RichTextEditor component\ninterface RichTextEditorProps {\n  value?: string;\n  onChange?: (value: string) => void;\n  placeholder?: string;\n  className?: string;\n  rows?: number;\n  disabled?: boolean;\n  minimal?: boolean;\n  error?: boolean;\n}\n\nexport default function RichTextEditor({\n  value = '',\n  onChange,\n  placeholder = 'Masukkan teks...',\n  className = '',\n  rows = 4,\n  disabled = false,\n  minimal = false,\n  error = false\n}: RichTextEditorProps) {\n  \n  // Initial editor configuration\n  const initialConfig = {\n    namespace: 'RichTextEditor',\n    theme: {\n      root: 'p-0 border-0 focus:outline-none',\n      text: {\n        bold: 'font-bold',\n        italic: 'italic',\n        underline: 'underline',\n      },\n      list: {\n        ul: 'list-disc list-inside ml-4',\n        ol: 'list-decimal list-inside ml-4',\n        listitem: 'py-1',\n      },\n    },\n    onError(error: Error) {\n      console.error('Lexical editor error:', error);\n    },\n    nodes: [ListNode, ListItemNode],\n    editable: !disabled,\n  };\n\n  const handleEditorChange = (editorState: EditorState) => {\n    if (onChange) {\n      editorState.read(() => {\n        const root = $getRoot();\n        // Untuk sekarang gunakan text content dulu, nanti bisa diperluas untuk HTML\n        const textContent = root.getTextContent();\n        \n        // Sederhana untuk bold formatting - dapat ditingkatkan nanti\n        const htmlContent = textContent;\n        \n        // Basic HTML conversion untuk bold text (contoh sederhana)\n        // Ini bisa diperluas untuk formatting lain\n        onChange(htmlContent);\n      });\n    }\n  };\n\n  return (\n    <div className={`border ${error ? 'border-red-300' : 'border-gray-300'} rounded-lg overflow-hidden ${className}`}>\n      <LexicalComposer initialConfig={initialConfig}>\n        {/* Toolbar - hanya tampil jika tidak minimal dan tidak disabled */}\n        {!disabled && !minimal && <ToolbarPlugin />}\n        \n        {/* Editor */}\n        <div className=\"relative\">\n          <RichTextPlugin\n            contentEditable={\n              <ContentEditable\n                className={`\n                  p-3 resize-none outline-none \n                  ${disabled ? 'bg-gray-100 cursor-not-allowed' : 'bg-white'}\n                  min-h-[${rows * 1.5}rem]\n                `}\n                style={{ minHeight: `${rows * 1.5}rem` }}\n              />\n            }\n            placeholder={\n              <div className=\"absolute top-3 left-3 text-gray-400 pointer-events-none select-none\">\n                {placeholder}\n              </div>\n            }\n            ErrorBoundary={LexicalErrorBoundary}\n          />\n          \n          {/* Plugins */}\n          <HistoryPlugin />\n          <ListPlugin />\n          <OnChangePlugin onChange={handleEditorChange} />\n          \n          {/* Set initial content plugin */}\n          <InitialContentPlugin value={value} />\n        </div>\n      </LexicalComposer>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/ui/SectionTitle.tsx",
      "lang": "tsx",
      "size": 335,
      "lines": 11,
      "hash": "5681fb97e4399524bb5dc8564b96baf317599165db2f58fc4d5425aee4f68123",
      "truncated": false,
      "content": "\"use client\";\nimport type { ReactNode } from \"react\";\n\nexport function SectionTitle({ children, right }: { children: ReactNode; right?: ReactNode }) {\n  return (\n    <div className=\"mb-4 flex items-center justify-between gap-3\">\n      <h2 className=\"text-lg font-semibold text-slate-900\">{children}</h2>\n      {right}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/ui/Stat.tsx",
      "lang": "tsx",
      "size": 591,
      "lines": 22,
      "hash": "d2cf2e8966d7544fb8a3c696326170fb46d9345b34942c17489143882d5b78ed",
      "truncated": false,
      "content": "\"use client\";\nimport type { ComponentType } from \"react\";\n\nexport function Stat({\n  label,\n  value,\n  icon: Icon,\n}: {\n  label: string;\n  value: string | number;\n  icon?: ComponentType<{ className?: string }>;\n}) {\n  return (\n    <div className=\"rounded-2xl border border-sky-200/50 bg-sky-50/60 p-5 shadow-sm\">\n      <div className=\"flex items-start justify-between\">\n        <p className=\"text-sm text-slate-600\">{label}</p>\n        {Icon && <Icon className=\"h-5 w-5 text-slate-400\" />}\n      </div>\n      <p className=\"mt-1 text-2xl font-bold text-slate-900\">{value}</p>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/ui/alert/Alert.tsx",
      "lang": "tsx",
      "size": 6585,
      "lines": 148,
      "hash": "6e9ff15074de650e672ae687479f1e5a96a7d63fd85cbe46520765cf2c9744bf",
      "truncated": false,
      "content": "import Link from \"next/link\";\nimport React from \"react\";\n\ninterface AlertProps {\n  variant: \"success\" | \"error\" | \"warning\" | \"info\"; // Alert type\n  title: string; // Title of the alert\n  message: string; // Message of the alert\n  showLink?: boolean; // Whether to show the \"Learn More\" link\n  linkHref?: string; // Link URL\n  linkText?: string; // Link text\n  className?: string; // Additional CSS classes\n}\n\nconst Alert: React.FC<AlertProps> = ({\n  variant,\n  title,\n  message,\n  showLink = false,\n  linkHref = \"#\",\n  linkText = \"Learn more\",\n  className = \"\",\n}) => {\n  // Tailwind classes for each variant\n  const variantClasses = {\n    success: {\n      container:\n        \"border-success-500 bg-success-50\",\n      icon: \"text-success-500\",\n    },\n    error: {\n      container:\n        \"border-error-500 bg-error-50\",\n      icon: \"text-error-500\",\n    },\n    warning: {\n      container:\n        \"border-warning-500 bg-warning-50\",\n      icon: \"text-warning-500\",\n    },\n    info: {\n      container:\n        \"border-blue-light-500 bg-blue-light-50\",\n      icon: \"text-blue-light-500\",\n    },\n  };\n\n  // Icon for each variant\n  const icons = {\n    success: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.70186 12.0001C3.70186 7.41711 7.41711 3.70186 12.0001 3.70186C16.5831 3.70186 20.2984 7.41711 20.2984 12.0001C20.2984 16.5831 16.5831 20.2984 12.0001 20.2984C7.41711 20.2984 3.70186 16.5831 3.70186 12.0001ZM12.0001 1.90186C6.423 1.90186 1.90186 6.423 1.90186 12.0001C1.90186 17.5772 6.423 22.0984 12.0001 22.0984C17.5772 22.0984 22.0984 17.5772 22.0984 12.0001C22.0984 6.423 17.5772 1.90186 12.0001 1.90186ZM15.6197 10.7395C15.9712 10.388 15.9712 9.81819 15.6197 9.46672C15.2683 9.11525 14.6984 9.11525 14.347 9.46672L11.1894 12.6243L9.6533 11.0883C9.30183 10.7368 8.73198 10.7368 8.38051 11.0883C8.02904 11.4397 8.02904 12.0096 8.38051 12.3611L10.553 14.5335C10.7217 14.7023 10.9507 14.7971 11.1894 14.7971C11.428 14.7971 11.657 14.7023 11.8257 14.5335L15.6197 10.7395Z\"\n        />\n      </svg>\n    ),\n    error: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M20.3499 12.0004C20.3499 16.612 16.6115 20.3504 11.9999 20.3504C7.38832 20.3504 3.6499 16.612 3.6499 12.0004C3.6499 7.38881 7.38833 3.65039 11.9999 3.65039C16.6115 3.65039 20.3499 7.38881 20.3499 12.0004ZM11.9999 22.1504C17.6056 22.1504 22.1499 17.6061 22.1499 12.0004C22.1499 6.3947 17.6056 1.85039 11.9999 1.85039C6.39421 1.85039 1.8499 6.3947 1.8499 12.0004C1.8499 17.6061 6.39421 22.1504 11.9999 22.1504ZM13.0008 16.4753C13.0008 15.923 12.5531 15.4753 12.0008 15.4753L11.9998 15.4753C11.4475 15.4753 10.9998 15.923 10.9998 16.4753C10.9998 17.0276 11.4475 17.4753 11.9998 17.4753L12.0008 17.4753C12.5531 17.4753 13.0008 17.0276 13.0008 16.4753ZM11.9998 6.62898C12.414 6.62898 12.7498 6.96476 12.7498 7.37898L12.7498 13.0555C12.7498 13.4697 12.414 13.8055 11.9998 13.8055C11.5856 13.8055 11.2498 13.4697 11.2498 13.0555L11.2498 7.37898C11.2498 6.96476 11.5856 6.62898 11.9998 6.62898Z\"\n          fill=\"#F04438\"\n        />\n      </svg>\n    ),\n    warning: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.6501 12.0001C3.6501 7.38852 7.38852 3.6501 12.0001 3.6501C16.6117 3.6501 20.3501 7.38852 20.3501 12.0001C20.3501 16.6117 16.6117 20.3501 12.0001 20.3501C7.38852 20.3501 3.6501 16.6117 3.6501 12.0001ZM12.0001 1.8501C6.39441 1.8501 1.8501 6.39441 1.8501 12.0001C1.8501 17.6058 6.39441 22.1501 12.0001 22.1501C17.6058 22.1501 22.1501 17.6058 22.1501 12.0001C22.1501 6.39441 17.6058 1.8501 12.0001 1.8501ZM10.9992 7.52517C10.9992 8.07746 11.4469 8.52517 11.9992 8.52517H12.0002C12.5525 8.52517 13.0002 8.07746 13.0002 7.52517C13.0002 6.97289 12.5525 6.52517 12.0002 6.52517H11.9992C11.4469 6.52517 10.9992 6.97289 10.9992 7.52517ZM12.0002 17.3715C11.586 17.3715 11.2502 17.0357 11.2502 16.6215V10.945C11.2502 10.5308 11.586 10.195 12.0002 10.195C12.4144 10.195 12.7502 10.5308 12.7502 10.945V16.6215C12.7502 17.0357 12.4144 17.3715 12.0002 17.3715Z\"\n          fill=\"\"\n        />\n      </svg>\n    ),\n    info: (\n      <svg\n        className=\"fill-current\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M3.6501 11.9996C3.6501 7.38803 7.38852 3.64961 12.0001 3.64961C16.6117 3.64961 20.3501 7.38803 20.3501 11.9996C20.3501 16.6112 16.6117 20.3496 12.0001 20.3496C7.38852 20.3496 3.6501 16.6112 3.6501 11.9996ZM12.0001 1.84961C6.39441 1.84961 1.8501 6.39392 1.8501 11.9996C1.8501 17.6053 6.39441 22.1496 12.0001 22.1496C17.6058 22.1496 22.1501 17.6053 22.1501 11.9996C22.1501 6.39392 17.6058 1.84961 12.0001 1.84961ZM10.9992 7.52468C10.9992 8.07697 11.4469 8.52468 11.9992 8.52468H12.0002C12.5525 8.52468 13.0002 8.07697 13.0002 7.52468C13.0002 6.9724 12.5525 6.52468 12.0002 6.52468H11.9992C11.4469 6.52468 10.9992 6.9724 10.9992 7.52468ZM12.0002 17.371C11.586 17.371 11.2502 17.0352 11.2502 16.621V10.9445C11.2502 10.5303 11.586 10.1945 12.0002 10.1945C12.4144 10.1945 12.7502 10.5303 12.7502 10.9445V16.621C12.7502 17.0352 12.4144 17.371 12.0002 17.371Z\"\n          fill=\"\"\n        />\n      </svg>\n    ),\n  };\n\n  return (\n    <div\n      className={`rounded-xl border p-4 ${variantClasses[variant].container} ${className}`}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={`-mt-0.5 ${variantClasses[variant].icon}`}>\n          {icons[variant]}\n        </div>\n\n        <div className=\"flex-1\">\n          <h4 className=\"mb-1 text-sm font-semibold text-gray-800\">\n            {title}\n          </h4>\n\n          <p className=\"text-sm text-gray-500\">{message}</p>\n\n          {showLink && (\n            <Link\n              href={linkHref}\n              className=\"inline-block mt-3 text-sm font-medium text-gray-500 underline\"\n            >\n              {linkText}\n            </Link>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Alert;\n"
    },
    {
      "path": "src/components/ui/button/Button.tsx",
      "lang": "tsx",
      "size": 2896,
      "lines": 75,
      "hash": "f082d85465253025141d638035f8e0c775751957b7f634b51301a385aad22266",
      "truncated": false,
      "content": "import React, { ReactNode } from \"react\";\n\ninterface ButtonProps {\n  children: ReactNode; // Button text or content\n  size?: \"sm\" | \"md\" | \"lg\"; // Button size\n  variant?: \"primary\" | \"secondary\" | \"outline\" | \"ghost\" | \"destructive\" | \"success\" | \"warning\" | \"info\"; // Button variant\n  startIcon?: ReactNode; // Icon before the text\n  endIcon?: ReactNode; // Icon after the text\n  onClick?: ((e?: any) => void) | (() => void); // Click handler\n  disabled?: boolean; // Disabled state\n  className?: string; // Additional classes\n  type?: \"button\" | \"submit\" | \"reset\"; // Button type\n  title?: string; // Tooltip text\n}\n\nconst Button: React.FC<ButtonProps> = ({\n  children,\n  size = \"md\",\n  variant = \"primary\",\n  startIcon,\n  endIcon,\n  onClick,\n  className = \"\",\n  disabled = false,\n  type = \"button\",\n  title,\n}) => {\n  // Size Classes\n  const sizeClasses = {\n    sm: \"px-3 py-2 text-sm\",\n    md: \"px-4 py-2 text-sm\",\n    lg: \"px-6 py-3 text-base\",\n  };\n\n  // Variant Classes - sesuai referensi warna yang diberikan\n  const variantClasses = {\n    primary:\n      \"bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300\",\n    secondary:\n      \"bg-gray-500 text-white shadow-sm hover:bg-gray-600 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-300\",\n    outline:\n      \"bg-white text-gray-700 border border-gray-300 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:bg-gray-100 disabled:text-gray-400\",\n    ghost:\n      \"bg-transparent text-gray-600 hover:bg-gray-100 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:text-gray-400\",\n    destructive:\n      \"bg-red-600 text-white shadow-sm hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:bg-red-300\",\n    success:\n      \"bg-emerald-500 text-white shadow-sm hover:bg-emerald-600 focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 disabled:bg-emerald-300\",\n    warning:\n      \"bg-amber-500 text-white shadow-sm hover:bg-amber-600 focus:ring-2 focus:ring-amber-400 focus:ring-offset-2 disabled:bg-amber-300\",\n    info:\n      \"bg-blue-600 text-white shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300\",\n  };\n\n  return (\n    <button\n      type={type}\n      title={title}\n      className={`inline-flex items-center justify-center font-medium gap-2 rounded-md transition-colors duration-200 focus:outline-none ${\n        sizeClasses[size]\n      } ${variantClasses[variant]} ${\n        disabled ? \"cursor-not-allowed opacity-50\" : \"\"\n      } ${className}`}\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {startIcon && <span className=\"flex items-center\">{startIcon}</span>}\n      {children}\n      {endIcon && <span className=\"flex items-center\">{endIcon}</span>}\n    </button>\n  );\n};\n\nexport default Button;\n"
    },
    {
      "path": "src/components/ui/modal/ConfirmModal.tsx",
      "lang": "tsx",
      "size": 3328,
      "lines": 117,
      "hash": "7a6092488594ce7d10accab4b55453e24f768f0e37566a16c3b5e75ff585b914",
      "truncated": false,
      "content": "'use client';\n\nimport { XMarkIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\nimport Button from '../button/Button';\nimport LoadingSpinner from '../LoadingSpinner';\n\ninterface ConfirmModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  showCancel?: boolean;\n  variant?: 'danger' | 'warning' | 'info';\n  isLoading?: boolean;\n}\n\nexport default function ConfirmModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = 'Konfirmasi',\n  cancelText = 'Batal',\n  showCancel = true,\n  variant = 'danger',\n  isLoading = false\n}: ConfirmModalProps) {\n  if (!isOpen) return null;\n\n  const variantConfig = {\n    danger: {\n      icon: 'text-red-600',\n      button: 'bg-red-600 hover:bg-red-700 border-red-600'\n    },\n    warning: {\n      icon: 'text-amber-500',\n      button: 'bg-amber-500 hover:bg-amber-600 border-amber-500'\n    },\n    info: {\n      icon: 'text-blue-600',\n      button: 'bg-blue-600 hover:bg-blue-700 border-blue-600'\n    }\n  };\n\n  const config = variantConfig[variant];\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center\">\n              <ExclamationTriangleIcon className={`w-6 h-6 ${config.icon} mr-2`} />\n              <h3 className=\"text-lg font-medium text-gray-900\">{title}</h3>\n            </div>\n            {showCancel && (\n              <button\n                onClick={onClose}\n                disabled={isLoading}\n                className=\"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 disabled:opacity-50\"\n              >\n                <XMarkIcon className=\"h-5 w-5\" />\n              </button>\n            )}\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            <p className=\"text-sm text-gray-600 mb-6\">{message}</p>\n\n            {/* Buttons */}\n            <div className=\"flex justify-end space-x-3\">\n              {showCancel && (\n                <Button\n                  type=\"button\"\n                  onClick={onClose}\n                  disabled={isLoading}\n                  variant=\"outline\"\n                >\n                  {cancelText}\n                </Button>\n              )}\n              <Button\n                type=\"button\"\n                onClick={onConfirm}\n                disabled={isLoading}\n                className={`text-white ${config.button} focus:ring-2 focus:ring-offset-2`}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center\">\n                    <LoadingSpinner size=\"sm\" className=\"mr-2\" />\n                    Loading...\n                  </div>\n                ) : (\n                  confirmText\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/ui/modal.tsx",
      "lang": "tsx",
      "size": 654,
      "lines": 36,
      "hash": "e70b278961a9119128806636fc047d0873faaa0682aeeae2bf4b9e96207d1896",
      "truncated": false,
      "content": "\"use client\";\nimport React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ntype ModalProps = {\n  children: React.ReactNode;\n  isOpen: boolean;\n  onClose: () => void;\n  className?: string;\n};\n\nexport const Modal: React.FC<ModalProps> = ({\n  children,\n  isOpen,\n  onClose,\n  className,\n}) => {\n  if (!isOpen) return null;\n\n  return (\n    <>\n      <div\n        className=\"fixed inset-0 z-[99] bg-black/50 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      <div\n        className={cn(\n          \"fixed left-1/2 top-1/2 z-[999] -translate-x-1/2 -translate-y-1/2\",\n          className\n        )}\n      >\n        {children}\n      </div>\n    </>\n  );\n};"
    },
    {
      "path": "src/components/ui/toast/Toast.tsx",
      "lang": "tsx",
      "size": 3405,
      "lines": 123,
      "hash": "86e153596410a8a32688aa02e65233966576ede9c250ef41f563e060b0797ed6",
      "truncated": false,
      "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { XMarkIcon, CheckCircleIcon, ExclamationCircleIcon, InformationCircleIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\n\nexport interface ToastProps {\n  id: string;\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n  onClose: (id: string) => void;\n}\n\nexport default function Toast({ \n  id, \n  variant, \n  title, \n  message, \n  duration = 5000, \n  onClose \n}: ToastProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isExiting, setIsExiting] = useState(false);\n\n  useEffect(() => {\n    // Show animation\n    setIsVisible(true);\n\n    // Auto-hide timer\n    const timer = setTimeout(() => {\n      handleClose();\n    }, duration);\n\n    return () => clearTimeout(timer);\n  }, [duration]);\n\n  const handleClose = () => {\n    setIsExiting(true);\n    setTimeout(() => {\n      onClose(id);\n    }, 300); // Wait for exit animation\n  };\n\n  const variantConfig = {\n    success: {\n      bgColor: 'bg-emerald-50 border-emerald-200',\n      iconColor: 'text-emerald-500',\n      titleColor: 'text-emerald-800',\n      messageColor: 'text-emerald-700',\n      icon: CheckCircleIcon\n    },\n    error: {\n      bgColor: 'bg-red-50 border-red-200',\n      iconColor: 'text-red-500',\n      titleColor: 'text-red-800',\n      messageColor: 'text-red-700',\n      icon: ExclamationCircleIcon\n    },\n    warning: {\n      bgColor: 'bg-amber-50 border-amber-200',\n      iconColor: 'text-amber-500',\n      titleColor: 'text-amber-800',\n      messageColor: 'text-amber-700',\n      icon: ExclamationTriangleIcon\n    },\n    info: {\n      bgColor: 'bg-blue-50 border-blue-200',\n      iconColor: 'text-blue-500',\n      titleColor: 'text-blue-800',\n      messageColor: 'text-blue-700',\n      icon: InformationCircleIcon\n    }\n  };\n\n  const config = variantConfig[variant];\n  const IconComponent = config.icon;\n\n  return (\n    <div\n      className={`\n        pointer-events-auto w-full overflow-hidden rounded-lg border shadow-lg\n        ${config.bgColor}\n        transform transition-all duration-300 ease-in-out\n        ${isVisible && !isExiting \n          ? 'translate-x-0 opacity-100' \n          : 'translate-x-full opacity-0'\n        }\n      `}\n      style={{ minWidth: '320px', maxWidth: '400px' }}\n    >\n      <div className=\"p-4\">\n        <div className=\"flex items-start\">\n          <div className=\"flex-shrink-0\">\n            <IconComponent className={`h-6 w-6 ${config.iconColor}`} />\n          </div>\n          <div className=\"ml-3 flex-1 min-w-0\">\n            <p className={`text-sm font-medium ${config.titleColor} break-words`}>\n              {title}\n            </p>\n            <p className={`mt-1 text-sm ${config.messageColor} break-words`}>\n              {message}\n            </p>\n          </div>\n          <div className=\"ml-4 flex flex-shrink-0\">\n            <button\n              type=\"button\"\n              className={`\n                inline-flex rounded-md p-1.5 transition-colors duration-200\n                ${config.iconColor} hover:bg-black/5 focus:outline-none focus:ring-2 focus:ring-offset-2\n              `}\n              onClick={handleClose}\n            >\n              <span className=\"sr-only\">Dismiss</span>\n              <XMarkIcon className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/ui/toast/ToastContainer.tsx",
      "lang": "tsx",
      "size": 1408,
      "lines": 55,
      "hash": "971b3d2bcbd0a61f8245c0d190bd77528e57c4290c228d9704a0bae77bf58ca3",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useCallback } from 'react';\nimport Toast from './Toast';\n\ninterface ToastData {\n  id: string;\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n}\n\nexport interface ToastContextType {\n  addToast: (toast: Omit<ToastData, 'id'>) => void;\n  removeToast: (id: string) => void;\n}\n\nexport default function ToastContainer() {\n  const [toasts, setToasts] = useState<ToastData[]>([]);\n\n  const removeToast = useCallback((id: string) => {\n    setToasts(prev => prev.filter(toast => toast.id !== id));\n  }, []);\n\n  const addToast = useCallback((toast: Omit<ToastData, 'id'>) => {\n    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);\n    setToasts(prev => [...prev, { ...toast, id }]);\n  }, []);\n\n  // Expose methods globally for easy access\n  if (typeof window !== 'undefined') {\n    (window as any).showToast = addToast;\n  }\n\n  return (\n    <div\n      className=\"fixed top-4 right-4 z-[9999] flex flex-col space-y-2 pointer-events-none max-w-sm w-full\"\n      style={{ zIndex: 9999 }}\n    >\n      {toasts.map((toast) => (\n        <Toast\n          key={toast.id}\n          id={toast.id}\n          variant={toast.variant}\n          title={toast.title}\n          message={toast.message}\n          duration={toast.duration || 5000}\n          onClose={removeToast}\n        />\n      ))}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/user-profile/ChangePasswordCard.tsx",
      "lang": "tsx",
      "size": 5631,
      "lines": 184,
      "hash": "e919aebd580872cd07fe282b538bdb27321aaa3d6b2f52402654bd0f50f07062",
      "truncated": false,
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport { useModal } from \"@/hooks/useModal\";\nimport { Modal } from \"@/components/ui/modal\";\nimport Button from \"@/components/ui/button/Button\";\nimport Input from \"@/components/form/input/InputField\";\nimport Label from \"@/components/form/Label\";\n\nexport default function ChangePasswordCard() {\n  const { isOpen, openModal, closeModal } = useModal();\n  const [passwords, setPasswords] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n  const [errors, setErrors] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setPasswords((prev) => ({\n      ...prev,\n      [name]: value,\n    }));\n    // Clear error when user starts typing\n    setErrors((prev) => ({\n      ...prev,\n      [name]: \"\",\n    }));\n  };\n\n  const validatePasswords = () => {\n    let isValid = true;\n    const newErrors = {\n      currentPassword: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    };\n\n    if (!passwords.currentPassword) {\n      newErrors.currentPassword = \"Password saat ini wajib diisi\";\n      isValid = false;\n    }\n\n    if (!passwords.newPassword) {\n      newErrors.newPassword = \"Password baru wajib diisi\";\n      isValid = false;\n    } else if (passwords.newPassword.length < 8) {\n      newErrors.newPassword = \"Password minimal 8 karakter\";\n      isValid = false;\n    }\n\n    if (!passwords.confirmPassword) {\n      newErrors.confirmPassword = \"Silakan konfirmasi password baru Anda\";\n      isValid = false;\n    } else if (passwords.newPassword !== passwords.confirmPassword) {\n      newErrors.confirmPassword = \"Password tidak cocok\";\n      isValid = false;\n    }\n\n    setErrors(newErrors);\n    return isValid;\n  };\n\n  const handleSave = async () => {\n    if (validatePasswords()) {\n      try {\n        const response = await fetch(\"/api/user/change-password\", {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({\n            currentPassword: passwords.currentPassword,\n            newPassword: passwords.newPassword,\n          }),\n        });\n\n        if (!response.ok) {\n          const error = await response.text();\n          throw new Error(error);\n        }\n\n        // Reset form and close modal on success\n        closeModal();\n        setPasswords({\n          currentPassword: \"\",\n          newPassword: \"\",\n          confirmPassword: \"\",\n        });\n        \n        // Show success message\n        alert(\"Password berhasil diubah\");\n      } catch (error) {\n        console.error(\"Error changing password:\", error);\n        setErrors((prev) => ({\n          ...prev,\n          currentPassword: error instanceof Error ? error.message : \"Gagal mengubah password\",\n        }));\n      }\n    }\n  };\n\n  return (\n    <div className=\"p-5 border border-gray-200 rounded-2xl lg:p-6\">\n      <div className=\"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between\">\n        <div>\n          <h4 className=\"text-lg font-semibold text-gray-800 lg:mb-2\">\n            Pengaturan Password\n          </h4>\n          <p className=\"text-sm text-gray-500\">\n            Ubah password Anda untuk menjaga keamanan akun\n          </p>\n        </div>\n\n        <button\n          onClick={openModal}\n          className=\"flex w-full items-center justify-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-xs hover:bg-gray-50 hover:text-gray-800 lg:inline-flex lg:w-auto\"\n        >\n          Ubah Password\n        </button>\n      </div>\n\n      <Modal isOpen={isOpen} onClose={closeModal} className=\"max-w-[500px] m-4\">\n        <div className=\"no-scrollbar relative w-full overflow-y-auto rounded-3xl bg-white p-4 lg:p-8\">\n          <div className=\"pr-14\">\n            <h4 className=\"mb-2 text-2xl font-semibold text-gray-800\">\n              Ubah Password\n            </h4>\n            <p className=\"mb-6 text-sm text-gray-500\">\n              Silakan masukkan password saat ini dan pilih password baru.\n            </p>\n          </div>\n          <form className=\"flex flex-col gap-5\">\n            <div>\n              <Label>Password Saat Ini</Label>\n              <Input\n                type=\"password\"\n                name=\"currentPassword\"\n                value={passwords.currentPassword}\n                onChange={handleChange}\n                error={errors.currentPassword}\n              />\n            </div>\n\n            <div>\n              <Label>Password Baru</Label>\n              <Input\n                type=\"password\"\n                name=\"newPassword\"\n                value={passwords.newPassword}\n                onChange={handleChange}\n                error={errors.newPassword}\n              />\n            </div>\n\n            <div>\n              <Label>Konfirmasi Password Baru</Label>\n              <Input\n                type=\"password\"\n                name=\"confirmPassword\"\n                value={passwords.confirmPassword}\n                onChange={handleChange}\n                error={errors.confirmPassword}\n              />\n            </div>\n\n            <div className=\"flex items-center gap-3 mt-6 lg:justify-end\">\n              <Button size=\"sm\" variant=\"outline\" onClick={closeModal}>\n                Batal\n              </Button>\n              <Button size=\"sm\" onClick={handleSave}>\n                Perbarui Password\n              </Button>\n            </div>\n          </form>\n        </div>\n      </Modal>\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/user-profile/UserAddressCard.tsx",
      "lang": "tsx",
      "size": 5314,
      "lines": 135,
      "hash": "d5bd98f9ac4a47c6dc768e865d77183b2945b2587517c1fe5c2c9620d3d8f59e",
      "truncated": false,
      "content": "\"use client\";\nimport React from \"react\";\nimport { useModal } from \"../../hooks/useModal\";\nimport { Modal } from \"../ui/modal\";\nimport Button from \"../ui/button/Button\";\nimport Input from \"../form/input/InputField\";\nimport Label from \"../form/Label\";\n\nexport default function UserAddressCard() {\n  const { isOpen, openModal, closeModal } = useModal();\n  const handleSave = () => {\n    // Handle save logic here\n    console.log(\"Saving changes...\");\n    closeModal();\n  };\n  return (\n    <>\n      <div className=\"p-5 border border-gray-200 rounded-2xl lg:p-6\">\n        <div className=\"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between\">\n          <div>\n            <h4 className=\"text-lg font-semibold text-gray-800 lg:mb-6\">\n              Address\n            </h4>\n\n            <div className=\"grid grid-cols-1 gap-4 lg:grid-cols-2 lg:gap-7 2xl:gap-x-32\">\n              <div>\n                <p className=\"mb-2 text-xs leading-normal text-gray-500\">\n                  Country\n                </p>\n                <p className=\"text-sm font-medium text-gray-800\">\n                  United States\n                </p>\n              </div>\n\n              <div>\n                <p className=\"mb-2 text-xs leading-normal text-gray-500\">\n                  City/State\n                </p>\n                <p className=\"text-sm font-medium text-gray-800\">\n                  Phoenix, Arizona, United States.\n                </p>\n              </div>\n\n              <div>\n                <p className=\"mb-2 text-xs leading-normal text-gray-500\">\n                  Postal Code\n                </p>\n                <p className=\"text-sm font-medium text-gray-800\">\n                  ERT 2489\n                </p>\n              </div>\n\n              <div>\n                <p className=\"mb-2 text-xs leading-normal text-gray-500\">\n                  TAX ID\n                </p>\n                <p className=\"text-sm font-medium text-gray-800\">\n                  AS4568384\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <button\n            onClick={openModal}\n            className=\"flex w-full items-center justify-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-3 text-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 lg:inline-flex lg:w-auto\"\n          >\n            <svg\n              className=\"fill-current\"\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 18 18\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                fillRule=\"evenodd\"\n                clipRule=\"evenodd\"\n                d=\"M15.0911 2.78206C14.2125 1.90338 12.7878 1.90338 11.9092 2.78206L4.57524 10.116C4.26682 10.4244 4.0547 10.8158 3.96468 11.2426L3.31231 14.3352C3.25997 14.5833 3.33653 14.841 3.51583 15.0203C3.69512 15.1996 3.95286 15.2761 4.20096 15.2238L7.29355 14.5714C7.72031 14.4814 8.11172 14.2693 8.42013 13.9609L15.7541 6.62695C16.6327 5.74827 16.6327 4.32365 15.7541 3.44497L15.0911 2.78206ZM12.9698 3.84272C13.2627 3.54982 13.7376 3.54982 14.0305 3.84272L14.6934 4.50563C14.9863 4.79852 14.9863 5.2734 14.6934 5.56629L14.044 6.21573L12.3204 4.49215L12.9698 3.84272ZM11.2597 5.55281L5.6359 11.1766C5.53309 11.2794 5.46238 11.4099 5.43238 11.5522L5.01758 13.5185L6.98394 13.1037C7.1262 13.0737 7.25666 13.003 7.35947 12.9002L12.9833 7.27639L11.2597 5.55281Z\"\n                fill=\"\"\n              />\n            </svg>\n            Edit\n          </button>\n        </div>\n      </div>\n      <Modal isOpen={isOpen} onClose={closeModal} className=\"max-w-[700px] m-4\">\n        <div className=\"relative w-full p-4 overflow-y-auto bg-white no-scrollbar rounded-3xl lg:p-11\">\n          <div className=\"px-2 pr-14\">\n            <h4 className=\"mb-2 text-2xl font-semibold text-gray-800\">\n              Edit Address\n            </h4>\n            <p className=\"mb-6 text-sm text-gray-500 lg:mb-7\">\n              Update your details to keep your profile up-to-date.\n            </p>\n          </div>\n          <form className=\"flex flex-col\">\n            <div className=\"px-2 overflow-y-auto custom-scrollbar\">\n              <div className=\"grid grid-cols-1 gap-x-6 gap-y-5 lg:grid-cols-2\">\n                <div>\n                  <Label>Country</Label>\n                  <Input type=\"text\" defaultValue=\"United States\" />\n                </div>\n\n                <div>\n                  <Label>City/State</Label>\n                  <Input type=\"text\" defaultValue=\"Arizona, United States.\" />\n                </div>\n\n                <div>\n                  <Label>Postal Code</Label>\n                  <Input type=\"text\" defaultValue=\"ERT 2489\" />\n                </div>\n\n                <div>\n                  <Label>TAX ID</Label>\n                  <Input type=\"text\" defaultValue=\"AS4568384\" />\n                </div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3 px-2 mt-6 lg:justify-end\">\n              <Button size=\"sm\" variant=\"outline\" onClick={closeModal}>\n                Close\n              </Button>\n              <Button size=\"sm\" onClick={handleSave}>\n                Save Changes\n              </Button>\n            </div>\n          </form>\n        </div>\n      </Modal>\n    </>\n  );\n}\n"
    },
    {
      "path": "src/components/user-profile/UserInfoCard.tsx",
      "lang": "tsx",
      "size": 8510,
      "lines": 280,
      "hash": "a90a0996ff0a95a01ca1e396381bd1be043350e15f71d1246c419955821afd2e",
      "truncated": false,
      "content": "\"use client\";\nimport React, { useState } from \"react\";\n\nimport Input from \"../form/input/InputField\";\nimport TextArea from \"../form/textarea/TextArea\";\nimport { useRouter } from \"next/navigation\";\nimport { useToast } from \"@/hooks/useToast\";\n\ninterface UserInfoCardProps {\n  user: {\n    id: string;\n    email: string;\n    officer_name: string;\n    vendor_name: string | null;\n    phone_number: string | null;\n    address: string | null;\n    role: string;\n  }\n}\n\nexport default function UserInfoCard({ user }: UserInfoCardProps) {\n  const router = useRouter();\n  const { showSuccess, showError } = useToast();\n  const [isEditing, setIsEditing] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [errors, setErrors] = useState({\n    officer_name: \"\",\n    vendor_name: \"\",\n    phone_number: \"\",\n    address: \"\",\n    email: \"\"\n  });\n  const [formData, setFormData] = useState({\n    officer_name: user.officer_name,\n    vendor_name: user.vendor_name || \"\",\n    phone_number: user.phone_number || \"\",\n    address: user.address || \"\",\n    email: user.email\n  });\n\n  const validateForm = () => {\n    const newErrors = {\n      officer_name: \"\",\n      vendor_name: \"\",\n      phone_number: \"\",\n      address: \"\",\n      email: \"\"\n    };\n    let isValid = true;\n\n    // Validate Officer Name\n    if (!formData.officer_name.trim()) {\n      newErrors.officer_name = \"Nama petugas wajib diisi\";\n      isValid = false;\n    }\n\n    // Validate Email\n    if (!formData.email.trim()) {\n      newErrors.email = \"Email wajib diisi\";\n      isValid = false;\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = \"Format email tidak valid\";\n      isValid = false;\n    }\n\n    // Validate Phone Number\n    if (!formData.phone_number.trim()) {\n      newErrors.phone_number = \"Nomor telepon wajib diisi\";\n      isValid = false;\n    } else if (!/^[0-9+\\-\\s()]*$/.test(formData.phone_number)) {\n      newErrors.phone_number = \"Nomor telepon hanya boleh berisi angka dan karakter + - ( )\";\n      isValid = false;\n    }\n\n    // Validate Vendor Name\n    if (!formData.vendor_name.trim()) {\n      newErrors.vendor_name = \"Nama vendor wajib diisi\";\n      isValid = false;\n    }\n\n    // Validate Address\n    if (!formData.address.trim()) {\n      newErrors.address = \"Alamat wajib diisi\";\n      isValid = false;\n    }\n\n    setErrors(newErrors);\n    return isValid;\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n    // Clear error when user starts typing\n    if (errors[name as keyof typeof errors]) {\n      setErrors(prev => ({\n        ...prev,\n        [name]: \"\"\n      }));\n    }\n  };\n\n  const handleSave = async () => {\n    if (!validateForm()) {\n      return;\n    }\n    \n    try {\n      setIsLoading(true);\n      const response = await fetch(\"/api/users/profile\", {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(formData),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || \"Gagal memperbarui profil\");\n      }\n\n      showSuccess(\"Berhasil\", \"Profil berhasil diperbarui\");\n      setIsEditing(false);\n      router.refresh();\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      showError(\"Error\", \"Gagal memperbarui profil\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return (\n    <div className=\"p-5 border border-gray-200 rounded-2xl lg:p-6\">\n      <div className=\"flex flex-col gap-6\">\n        <div className=\"flex items-center justify-between\">\n          <h4 className=\"text-lg font-semibold text-gray-800\">\n            Informasi Pribadi\n          </h4>\n\n          {!isEditing ? (\n            <button\n              onClick={() => setIsEditing(true)}\n              className=\"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50\"\n            >\n              <svg\n                className=\"h-4 w-4\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"\n                />\n              </svg>\n              Ubah\n            </button>\n          ) : (\n            <div className=\"flex gap-2\">\n              <button\n                onClick={() => {\n                  setFormData({\n                    officer_name: user.officer_name,\n                    vendor_name: user.vendor_name || \"\",\n                    phone_number: user.phone_number || \"\",\n                    address: user.address || \"\",\n                    email: user.email\n                  });\n                  setIsEditing(false);\n                }}\n                className=\"inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50\"\n              >\n                Batal\n              </button>\n              <button\n                onClick={handleSave}\n                disabled={isLoading}\n                className=\"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 disabled:opacity-50\"\n              >\n                {isLoading ? \"Menyimpan...\" : \"Simpan Perubahan\"}\n              </button>\n            </div>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Nama Petugas</p>\n            {isEditing ? (\n              <Input \n                type=\"text\"\n                name=\"officer_name\"\n                value={formData.officer_name}\n                onChange={handleChange}\n                className=\"mt-1\"\n                error={errors.officer_name}\n              />\n            ) : (\n              <p className=\"mt-1 text-base text-gray-900\">{user.officer_name}</p>\n            )}\n          </div>\n\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Email</p>\n            {isEditing ? (\n              <Input \n                type=\"email\"\n                name=\"email\"\n                value={formData.email}\n                onChange={handleChange}\n                className=\"mt-1\"\n                error={errors.email}\n              />\n            ) : (\n              <p className=\"mt-1 text-base text-gray-900\">{user.email}</p>\n            )}\n          </div>\n\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Nomor Telepon</p>\n            {isEditing ? (\n              <Input \n                type=\"text\"\n                name=\"phone_number\"\n                value={formData.phone_number}\n                onChange={handleChange}\n                className=\"mt-1\"\n                error={errors.phone_number}\n              />\n            ) : (\n              <p className=\"mt-1 text-base text-gray-900\">{user.phone_number || \"-\"}</p>\n            )}\n          </div>\n\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Nama Vendor</p>\n            {isEditing ? (\n              <Input \n                type=\"text\"\n                name=\"vendor_name\"\n                value={formData.vendor_name}\n                onChange={handleChange}\n                className=\"mt-1\"\n                error={errors.vendor_name}\n              />\n            ) : (\n              <p className=\"mt-1 text-base text-gray-900\">{user.vendor_name || \"-\"}</p>\n            )}\n          </div>\n\n          <div className=\"lg:col-span-2\">\n            <p className=\"text-sm font-medium text-gray-500\">Alamat</p>\n            {isEditing ? (\n              <TextArea\n                name=\"address\"\n                value={formData.address}\n                onChange={handleChange}\n                className=\"mt-1\"\n                rows={3}\n                error={errors.address}\n              />\n            ) : (\n              <p className=\"mt-1 text-base text-gray-900 whitespace-pre-line\">{user.address || \"-\"}</p>\n            )}\n          </div>\n\n        </div>\n      </div>\n\n\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/vendor/EditSubmissionForm.tsx",
      "lang": "tsx",
      "size": 32339,
      "lines": 846,
      "hash": "6885eb2edd27b0cb96e8965c446a41abe8ad1d58be057ce34a24b1033520825e",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSession } from 'next-auth/react';\nimport Card from '@/components/ui/Card';\nimport Button from '@/components/ui/button/Button';\nimport Input from '@/components/form/Input';\nimport Label from '@/components/form/Label';\nimport DatePicker from '@/components/form/DatePicker';\nimport TimePicker from '@/components/form/TimePicker';\nimport FileUpload from '@/components/form/FileUpload';\nimport Alert from '@/components/ui/alert/Alert';\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\nimport { useToast } from '@/hooks/useToast';\n\n// Define Worker interface for dynamic inputs\ninterface Worker {\n  id: string;\n  nama_pekerja: string;\n  foto_pekerja: string;\n}\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string | null;\n  work_facilities: string;\n  worker_count?: number | null;\n  simja_number?: string | null;\n  simja_date?: Date | null;\n  sika_number?: string | null;\n  sika_date?: Date | null;\n  worker_names: string;\n  content: string | null;\n  sika_document_upload?: string | null;\n  simja_document_upload?: string | null;\n}\n\ninterface EditSubmissionFormProps {\n  submissionId: string;\n}\n\nexport default function EditSubmissionForm({ submissionId }: EditSubmissionFormProps) {\n  const router = useRouter();\n  const { data: session, status: _status } = useSession();\n  const { showSuccess, showError } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isInitialLoading, setIsInitialLoading] = useState(true);\n  const [alert, setAlert] = useState<{ variant: 'success' | 'error' | 'warning' | 'info', title: string, message: string } | null>(null);\n  const [submission, setSubmission] = useState<Submission | null>(null);\n  \n  // State for dynamic workers\n  const [workers, setWorkers] = useState<Worker[]>([\n    { id: '1', nama_pekerja: '', foto_pekerja: '' }\n  ]);\n  \n  // Load submission data\n  useEffect(() => {\n    const fetchSubmission = async () => {\n      setIsInitialLoading(true);\n      try {\n        const response = await fetch(`/api/submissions/${submissionId}`);\n        if (response.ok) {\n          const data = await response.json();\n          setSubmission(data);\n          \n          // Also fetch workers data\n          const workersResponse = await fetch(`/api/submissions/${submissionId}/workers`);\n          if (workersResponse.ok) {\n            const workersData = await workersResponse.json();\n            if (workersData.workers && workersData.workers.length > 0) {\n              setWorkers(workersData.workers.map((worker: any) => ({\n                id: worker.id,\n                nama_pekerja: worker.worker_name || worker.nama_pekerja || '',\n                foto_pekerja: worker.worker_photo || worker.foto_pekerja || ''\n              })));\n            }\n          }\n        } else {\n          setAlert({\n            variant: 'error',\n            title: 'Error!',\n            message: 'Gagal memuat data pengajuan'\n          });\n        }\n      } catch (error) {\n        console.error('Error fetching submission:', error);\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Gagal memuat data pengajuan'\n        });\n      } finally {\n        setIsInitialLoading(false);\n      }\n    };\n    \n    if (submissionId) {\n      fetchSubmission();\n    }\n  }, [submissionId]);\n\n  const [formData, setFormData] = useState({\n    nama_vendor: '',\n    berdasarkan: '',\n    nama_petugas: '',\n    pekerjaan: '',\n    lokasi_kerja: '',\n    pelaksanaan: '',\n    jam_kerja: '',\n    lain_lain: '',\n    sarana_kerja: '',\n    jumlah_pekerja: 0,\n    nomor_simja: '',\n    tanggal_simja: '',\n    nomor_sika: '',\n    tanggal_sika: '',\n    nama_pekerja: '',\n    content: '',\n    upload_doc_sika: '',\n    upload_doc_simja: '',\n  });\n\n  // Update form data when submission is loaded\n  useEffect(() => {\n    if (submission) {\n      setFormData({\n        nama_vendor: submission.vendor_name || '',\n        berdasarkan: submission.based_on || '',\n        nama_petugas: submission.officer_name || '',\n        pekerjaan: submission.job_description || '',\n        lokasi_kerja: submission.work_location || '',\n        pelaksanaan: submission.implementation || '',\n        jam_kerja: submission.working_hours || '',\n        lain_lain: submission.other_notes || '',\n        sarana_kerja: submission.work_facilities || '',\n        jumlah_pekerja: submission.worker_count || 0,\n        nomor_simja: submission.simja_number || '',\n        tanggal_simja: submission.simja_date ? (() => {\n          const date = new Date(submission.simja_date);\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        })() : '',\n        nomor_sika: submission.sika_number || '',\n        tanggal_sika: submission.sika_date ? (() => {\n          const date = new Date(submission.sika_date);\n          const year = date.getFullYear();\n          const month = String(date.getMonth() + 1).padStart(2, '0');\n          const day = String(date.getDate()).padStart(2, '0');\n          return `${year}-${month}-${day}`;\n        })() : '',\n        nama_pekerja: submission.worker_names || '',\n        content: submission.content || '',\n        upload_doc_sika: submission.sika_document_upload || '',\n        upload_doc_simja: submission.simja_document_upload || '',\n      });\n    }\n  }, [submission]);\n  \n  // Auto-fill form data when session is available (for readonly fields)\n  useEffect(() => {\n    if (session?.user && submission) {\n      setFormData(prev => ({\n        ...prev,\n        // Keep vendor name readonly for vendors - use session data if available\n        nama_vendor: session.user.vendor_name || submission.vendor_name || prev.nama_vendor || '',\n      }));\n    }\n  }, [session, submission]);\n\n  // Handle file upload from FileUpload component\n  const handleFileUpload = (fieldName: string) => (url: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [fieldName]: url\n    }));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value, type } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'number' ? (value === '' ? 0 : Number(value)) : value\n    }));\n  };\n\n  const handleDateChange = (name: string) => (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleTimeChange = (value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      jam_kerja: value\n    }));\n  };\n\n  // Functions for managing dynamic workers\n  const addWorker = () => {\n    const newWorker: Worker = {\n      id: Date.now().toString(),\n      nama_pekerja: '',\n      foto_pekerja: ''\n    };\n    setWorkers(prev => [...prev, newWorker]);\n  };\n\n  const removeWorker = (id: string) => {\n    if (workers.length > 1) {\n      setWorkers(prev => prev.filter(worker => worker.id !== id));\n    }\n  };\n\n  const updateWorkerName = (id: string, nama: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, nama_pekerja: nama } : worker\n    ));\n  };\n\n  const updateWorkerPhoto = (id: string, foto: string) => {\n    setWorkers(prev => prev.map(worker =>\n      worker.id === id ? { ...worker, foto_pekerja: foto } : worker\n    ));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Check if submission is loaded\n    if (!submission) {\n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: 'Data pengajuan belum dimuat'\n      });\n      return;\n    }\n    \n    // Check if submission is still editable\n    if (submission.approval_status !== 'PENDING') {\n      setAlert({\n        variant: 'warning',\n        title: 'Peringatan!',\n        message: 'Tidak dapat mengubah pengajuan yang sudah diproses oleh admin.'\n      });\n      return;\n    }\n    \n    // Client-side validation\n    const requiredFields = [\n      'nama_vendor', 'berdasarkan', 'nama_petugas', 'pekerjaan', \n      'lokasi_kerja', 'jam_kerja', 'sarana_kerja', 'nama_pekerja'\n    ];\n\n    for (const field of requiredFields) {\n      const value = formData[field as keyof typeof formData];\n      if (!value || (typeof value === 'string' && value.trim() === '')) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: `Field ${field} harus diisi!`\n        });\n        return;\n      }\n    }\n    \n    setIsLoading(true);\n\n    try {\n      // Validate workers\n      const validWorkers = workers.filter(worker => worker.nama_pekerja.trim() !== '');\n      if (validWorkers.length === 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Minimal harus ada satu pekerja yang diisi'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Check if all workers have photos\n      const workersWithoutPhoto = validWorkers.filter(worker => !worker.foto_pekerja.trim());\n      if (workersWithoutPhoto.length > 0) {\n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: 'Semua pekerja harus memiliki foto. Silakan upload foto untuk semua pekerja.'\n        });\n        setIsLoading(false);\n        return;\n      }\n\n      // Format worker names for database\n      const workerNames = validWorkers.map(worker => worker.nama_pekerja.trim()).join('\\n');\n\n      // Prepare submission data - transform Indonesian field names to English for API\n      const formattedData = {\n        vendor_name: formData.nama_vendor,\n        based_on: formData.berdasarkan,\n        officer_name: formData.nama_petugas,\n        job_description: formData.pekerjaan,\n        work_location: formData.lokasi_kerja,\n        implementation: formData.pelaksanaan,\n        working_hours: formData.jam_kerja,\n        other_notes: formData.lain_lain,\n        work_facilities: formData.sarana_kerja,\n        worker_count: formData.jumlah_pekerja,\n        simja_number: formData.nomor_simja,\n        simja_date: formData.tanggal_simja ? new Date(formData.tanggal_simja) : null,\n        sika_number: formData.nomor_sika,\n        sika_date: formData.tanggal_sika ? new Date(formData.tanggal_sika) : null,\n        worker_names: workerNames,\n        content: formData.content,\n        sika_document_upload: formData.upload_doc_sika,\n        simja_document_upload: formData.upload_doc_simja,\n        workers: validWorkers.map(worker => ({\n          worker_name: worker.nama_pekerja.trim(),\n          worker_photo: worker.foto_pekerja\n        }))\n      };\n\n      console.log('Sending update request:', {\n        url: `/api/submissions/${submission.id}`,\n        method: 'PUT',\n        data: formattedData\n      });\n\n      const response = await fetch(`/api/submissions/${submission.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(formattedData),\n      });\n\n      console.log('Response status:', response.status);\n      console.log('Response headers:', Object.fromEntries(response.headers.entries()));\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Error response:', errorText);\n        \n        let errorMessage;\n        try {\n          const errorJson = JSON.parse(errorText);\n          errorMessage = errorJson.error || errorJson.message || 'Gagal menyimpan perubahan';\n        } catch {\n          errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n        }\n        \n        setAlert({\n          variant: 'error',\n          title: 'Error!',\n          message: `Error: ${errorMessage}`\n        });\n        showError('Gagal Menyimpan', errorMessage);\n        return;\n      }\n\n      const result = await response.json();\n      console.log('Update successful:', result);\n      \n      // Show success toast and redirect immediately\n      showSuccess('Berhasil!', 'Perubahan berhasil disimpan!');\n      \n      // Redirect immediately without delay\n      router.push('/vendor/submissions');\n    } catch (error) {\n      console.error('Network/unexpected error:', error);\n      \n      let errorMessage = 'Terjadi kesalahan tidak terduga';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      setAlert({\n        variant: 'error',\n        title: 'Error!',\n        message: `Gagal menyimpan perubahan: ${errorMessage}`\n      });\n      showError('Error!', `Gagal menyimpan perubahan: ${errorMessage}`);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      {isInitialLoading ? (\n        <Card>\n          <div className=\"p-6 text-center\">\n            <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n            <p className=\"text-gray-600\">Memuat data pengajuan...</p>\n          </div>\n        </Card>\n      ) : !submission ? (\n        <Card>\n          <div className=\"p-6 text-center\">\n            <p className=\"text-red-600\">Data pengajuan tidak ditemukan</p>\n          </div>\n        </Card>\n      ) : (\n        <Card>\n          <div className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-6\">\n              <div className=\"text-sm text-gray-500\">\n                Status: <span className={`font-medium ${\n                  submission.approval_status === 'PENDING' ? 'text-yellow-600' :\n                  submission.approval_status === 'APPROVED' ? 'text-green-600' :\n                  'text-red-600'\n                }`}>{\n                  submission.approval_status === 'PENDING' ? 'Menunggu Review' :\n                  submission.approval_status === 'APPROVED' ? 'Disetujui' :\n                  submission.approval_status === 'REJECTED' ? 'Ditolak' :\n                  submission.approval_status\n                }</span>\n              </div>\n            </div>\n            \n            {submission.approval_status !== 'PENDING' && (\n              <div className=\"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <p className=\"text-yellow-800 text-sm\">\n                  <span className=\"font-medium\">Peringatan:</span> Pengajuan ini sudah diproses oleh admin dan tidak dapat diubah.\n                  Anda hanya dapat melihat detailnya saja.\n                </p>\n              </div>\n            )}\n            \n            <form onSubmit={handleSubmit} className=\"space-y-8\">\n              <fieldset disabled={submission.approval_status !== 'PENDING'} className={submission.approval_status !== 'PENDING' ? 'opacity-60' : ''}>\n            \n            {/* Informasi Vendor */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Vendor</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"nama_vendor\">Nama vendor</Label>\n                  <Input\n                    id=\"nama_vendor\"\n                    name=\"nama_vendor\"\n                    value={session?.user?.vendor_name || formData.nama_vendor || ''}\n                    onChange={handleChange}\n                    required\n                    readOnly={!!session?.user?.vendor_name}\n                    disabled={!!session?.user?.vendor_name}\n                    className={session?.user?.vendor_name ? \"cursor-not-allowed\" : \"\"}\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"nama_petugas\">Nama petugas</Label>\n                  <Input\n                    id=\"nama_petugas\"\n                    name=\"nama_petugas\"\n                    value={formData.nama_petugas}\n                    onChange={handleChange}\n                    required\n                    placeholder=\"Nama petugas yang bertanggung jawab\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <Label htmlFor=\"berdasarkan\">Berdasarkan</Label>\n                  <Input\n                    id=\"berdasarkan\"\n                    name=\"berdasarkan\"\n                    value={formData.berdasarkan}\n                    onChange={handleChange}\n                    type='text'\n                    required\n                  />\n                </div>\n\n                {/* Document Numbers */}\n                <div>\n                  <Label htmlFor=\"nomor_simja\">Nomor SIMJA</Label>\n                  <Input\n                    id=\"nomor_simja\"\n                    name=\"nomor_simja\"\n                    value={formData.nomor_simja}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIMJA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"nomor_sika\">Nomor SIKA</Label>\n                  <Input\n                    id=\"nomor_sika\"\n                    name=\"nomor_sika\"\n                    value={formData.nomor_sika}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: SIKA/2024/001\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"tanggal_simja\">Tanggal SIMJA</Label>\n                  <DatePicker\n                    id=\"tanggal_simja\"\n                    name=\"tanggal_simja\"\n                    value={formData.tanggal_simja}\n                    onChange={handleDateChange('tanggal_simja')}\n                    placeholder=\"Pilih tanggal SIMJA\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"tanggal_sika\">Tanggal SIKA</Label>\n                  <DatePicker\n                    id=\"tanggal_sika\"\n                    name=\"tanggal_sika\"\n                    value={formData.tanggal_sika}\n                    onChange={handleDateChange('tanggal_sika')}\n                    placeholder=\"Pilih tanggal SIKA\"\n                    required\n                  />\n                </div>\n\n                {/* File Upload Areas */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"upload_doc_simja\">UPLOAD DOKUMEN SIMJA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"upload_doc_simja\"\n                      name=\"upload_doc_simja\"\n                      label=\"\"\n                      description=\"Upload dokumen SIMJA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.upload_doc_simja}\n                      onChange={handleFileUpload('upload_doc_simja')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required={false}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"upload_doc_sika\">UPLOAD DOKUMEN SIKA</Label>\n                  <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center\">\n                    <FileUpload\n                      id=\"upload_doc_sika\"\n                      name=\"upload_doc_sika\"\n                      label=\"\"\n                      description=\"Upload dokumen SIKA dalam format PDF, DOC, DOCX, atau gambar (JPG, PNG) maksimal 8MB\"\n                      value={formData.upload_doc_sika}\n                      onChange={handleFileUpload('upload_doc_sika')}\n                      accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\n                      maxSize={8}\n                      required={false}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Informasi Pekerjaan */}\n            <div className=\"p-6 rounded-lg\">\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4 border-b border-gray-300 pb-2\">Informasi Pekerjaan</h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"pekerjaan\">Pekerjaan</Label>\n                  <Input\n                    id=\"pekerjaan\"\n                    name=\"pekerjaan\"\n                    value={formData.pekerjaan}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"lokasi_kerja\">Lokasi kerja</Label>\n                  <Input\n                    id=\"lokasi_kerja\"\n                    name=\"lokasi_kerja\"\n                    value={formData.lokasi_kerja}\n                    onChange={handleChange}\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"jam_kerja\">Jam kerja</Label>\n                  <TimePicker\n                    id=\"jam_kerja\"\n                    name=\"jam_kerja\"\n                    value={formData.jam_kerja}\n                    onChange={handleTimeChange}\n                    required\n                    placeholder=\"Pilih jam kerja\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"sarana_kerja\">Sarana kerja</Label>\n                  <Input\n                    id=\"sarana_kerja\"\n                    name=\"sarana_kerja\"\n                    value={formData.sarana_kerja}\n                    onChange={handleChange}\n                    placeholder=\"Contoh: Toolkit lengkap, APD standar, crane mobile\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"jumlah_pekerja\">Jumlah Pekerja</Label>\n                  <Input\n                    id=\"jumlah_pekerja\"\n                    name=\"jumlah_pekerja\"\n                    type=\"number\"\n                    min=\"1\"\n                    max=\"100\"\n                    value={formData.jumlah_pekerja || ''}\n                    onChange={handleChange}\n                    placeholder=\"Masukkan jumlah pekerja\"\n                    required\n                  />\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    Jumlah total pekerja yang akan bekerja di lokasi ini\n                  </p>\n                </div>\n\n                <div className=\"flex items-end\">\n                  <div className=\"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg w-full\">\n                    <div className=\"font-medium mb-1\">Info:</div>\n                    <div>Pekerja yang diinput: {workers.length}</div>\n                    <div>Jumlah pekerja: {formData.jumlah_pekerja || 0}</div>\n                    {formData.jumlah_pekerja && workers.length !== Number(formData.jumlah_pekerja) && (\n                      <div className=\"text-orange-600 mt-1\">\n                        ⚠️ Jumlah tidak sesuai dengan daftar pekerja\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Daftar nama pekerja */}\n            <div className=\"p-6 rounded-lg\">\n              <div className=\"flex justify-between items-center mb-6 border-b border-gray-300 \">\n                <div className='flex justify-between'>\n                  <h2 className=\"text-lg font-semibold text-gray-900 pb-2\">Daftar Nama Pekerja</h2>\n                  <p className=\"text-sm text-gray-500 mt-2\">Total: {workers.length} pekerja</p>\n                </div>\n               \n              </div>\n              \n              {/* Workers Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {workers.map((worker, _index) => (\n                  <div key={worker.id} className=\"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition-all duration-200 shadow-sm hover:shadow-md\">\n                    {/* Header */}\n                    <div className=\"flex justify-between items-center mb-3\">\n                      <div className=\"flex items-center gap-2\">\n                        {/* <div className=\"bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium\">\n                          {index + 1}\n                        </div>\n                        <span className=\"text-sm font-medium text-gray-700\">Pekerja {index + 1}</span> */}\n                      </div>\n                      {workers.length > 1 && (\n                        <Button\n                          type=\"button\"\n                          onClick={() => removeWorker(worker.id)}\n                          variant=\"outline\"\n                          className=\"text-red-500 hover:bg-red-50 border-red-200 w-8 h-8 p-0 rounded-full\"\n                          title=\"Hapus pekerja\"\n                          disabled={submission.approval_status !== 'PENDING'}\n                        >\n                          ✕\n                        </Button>\n                      )}\n                    </div>\n                    \n                    {/* Photo Preview */}\n                    <div className=\"mb-4\">\n\n                      <div className=\"relative\">\n                        {worker.foto_pekerja ? (\n                          <div className=\"relative group\">\n                            <img \n                              src={worker.foto_pekerja} \n                              alt={`Foto ${worker.nama_pekerja || 'pekerja'}`}\n                              className=\"w-full h-50 object-cover rounded-lg border-2 border-gray-300\"\n                            />\n                            <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center\">\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                onClick={() => document.getElementById(`foto_pekerja_${worker.id}`)?.click()}\n                                className=\"bg-white text-gray-800 hover:bg-gray-100 text-xs px-3 py-1\"\n                                disabled={submission.approval_status !== 'PENDING'}\n                              >\n                                Ganti Foto\n                              </Button>\n                            </div>\n                            <button\n                              type=\"button\"\n                              onClick={() => updateWorkerPhoto(worker.id, '')}\n                              className=\"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600\"\n                              title=\"Hapus foto\"\n                              disabled={submission.approval_status !== 'PENDING'}\n                            >\n                              ✕\n                            </button>\n                          </div>\n                        ) : (\n                          <div \n                            onClick={() => submission.approval_status === 'PENDING' && document.getElementById(`foto_pekerja_${worker.id}`)?.click()}\n                            className={`w-full h-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center transition-all duration-200 bg-gray-50 ${\n                              submission.approval_status === 'PENDING' \n                                ? 'cursor-pointer hover:border-blue-400 hover:bg-blue-50' \n                                : 'cursor-not-allowed opacity-60'\n                            }`}\n                          >\n                           \n                            <p className=\"text-sm font-medium text-gray-600\">Upload Foto Pekerja</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">Klik atau drag & drop foto</p>\n   \n                          </div>\n                        )}\n                        <FileUpload\n                          id={`foto_pekerja_${worker.id}`}\n                          name={`foto_pekerja_${worker.id}`}\n                          label=\"\"\n                          description=\"\"\n                          value={worker.foto_pekerja}\n                          onChange={(url) => updateWorkerPhoto(worker.id, url)}\n                          accept=\".jpg,.jpeg,.png\"\n                          maxSize={8}\n                          required={false}\n                          className=\"sr-only\"\n                        />\n                      </div>\n                    </div>\n                    \n                    {/* Name Input */}\n                    <div>\n                      <Label htmlFor={`nama_pekerja_${worker.id}`} className=\"text-sm font-medium text-gray-700\">\n                        Nama Lengkap\n                      </Label>\n                      <Input\n                        id={`nama_pekerja_${worker.id}`}\n                        name={`nama_pekerja_${worker.id}`}\n                        value={worker.nama_pekerja}\n                        onChange={(e) => updateWorkerName(worker.id, e.target.value)}\n                        placeholder=\"Masukkan nama lengkap\"\n                        required\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    \n                    {/* Status Indicator */}\n                    <div className=\"mt-3 flex items-center gap-2\">\n                      <div className={`w-2 h-2 rounded-full ${\n                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'bg-green-400' \n                          : 'bg-red-400'\n                      }`}></div>\n                      <span className={`text-xs ${\n                        worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'text-green-600' \n                          : 'text-red-600'\n                      }`}>\n                        {worker.nama_pekerja.trim() && worker.foto_pekerja.trim()\n                          ? 'Lengkap' \n                          : worker.nama_pekerja.trim() \n                            ? 'Perlu foto' \n                            : 'Belum lengkap'}\n                      </span>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Add New Worker Card */}\n                {submission.approval_status === 'PENDING' && (\n                  <div \n                    onClick={addWorker}\n                    className=\"border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex flex-col items-center justify-center min-h-[280px] text-gray-500 hover:text-blue-600\"\n                  >\n                    <div className=\"text-4xl mb-2\">➕</div>\n                    <p className=\"text-sm font-medium\">Tambah Pekerja Baru</p>\n                    <p className=\"text-xs mt-1\">Klik untuk menambah</p>\n                  </div>\n                )}\n              </div>\n              \n           \n             \n            </div>\n\n            </fieldset>\n\n            <div className=\"flex justify-end space-x-4 pt-6 border-t\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => router.back()}\n                disabled={isLoading}\n              >\n                Batal\n              </Button>\n              {submission.approval_status === 'PENDING' && (\n                <Button\n                  type=\"submit\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? 'Menyimpan...' : 'Simpan Perubahan'}\n                </Button>\n              )}\n            </div>\n          </form>\n\n          {/* Alert */}\n          {alert && (\n            <Alert\n              variant={alert.variant}\n              title={alert.title}\n              message={alert.message}\n            />\n          )}\n        </div>\n      </Card>\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/vendor/SubmissionDetailModal.tsx",
      "lang": "tsx",
      "size": 21534,
      "lines": 566,
      "hash": "03ca87dfcc192d039f058c6ffc6e077699431dd8e6430bb2dae39a477df979f5",
      "truncated": false,
      "content": "'use client';\n\nimport { useEffect, useState } from 'react';\nimport { \n  XMarkIcon, \n  EyeIcon, \n  DocumentIcon, \n  BuildingOfficeIcon,\n  UserIcon,\n  BriefcaseIcon,\n  CalendarIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon as PendingIcon\n} from '@heroicons/react/24/outline';\nimport { fileUrlHelper } from '@/lib/fileUrlHelper';\nimport DocumentPreviewModal from '@/components/common/DocumentPreviewModal';\nimport SimlokPdfModal from '@/components/common/SimlokPdfModal';\nimport WorkersList from '@/components/common/WorkersList';\nimport DetailSection from '@/components/common/DetailSection';\nimport InfoCard from '@/components/common/InfoCard';\nimport Button from '@/components/ui/button/Button';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  signer_position?: string;\n  signer_name?: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\ninterface SubmissionDetailModalProps {\n  submission: Submission | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function SubmissionDetailModal({\n  submission,\n  isOpen,\n  onClose\n}: SubmissionDetailModalProps) {\n  const [showDebug, setShowDebug] = useState(false);\n  const [isDocumentModalOpen, setIsDocumentModalOpen] = useState(false);\n  const [isPdfModalOpen, setIsPdfModalOpen] = useState(false);\n  const [selectedDocument, setSelectedDocument] = useState<{\n    url: string;\n    title: string;\n  } | null>(null);\n\n  useEffect(() => {\n    // Handle escape key to close modal\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  if (!isOpen || !submission) return null;\n\n  const formatDate = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    return date.toLocaleDateString('id-ID', {\n      day: '2-digit',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const baseClasses = \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\";\n    \n    switch (status) {\n      case 'PENDING':\n        return (\n          <span className={`${baseClasses} bg-yellow-100 text-yellow-800`}>\n            Menunggu\n          </span>\n        );\n      case 'APPROVED':\n        return (\n          <span className={`${baseClasses} bg-green-100 text-green-800`}>\n            Disetujui\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className={`${baseClasses} bg-red-100 text-red-800`}>\n            Ditolak\n          </span>\n        );\n      default:\n        return (\n          <span className={`${baseClasses} bg-gray-100 text-gray-800`}>\n            {status}\n          </span>\n        );\n    }\n  };\n\n  const handleFileView = (url: string, title: string) => {\n    setSelectedDocument({ url: fileUrlHelper.convertLegacyUrl(url), title });\n    setIsDocumentModalOpen(true);\n  };\n\n  const handleDownloadPdf = () => {\n    setIsPdfModalOpen(true);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div\n        className=\"fixed inset-0 bg-black/30 transition-opacity\"\n        onClick={onClose}\n      />\n\n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div className=\"relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between border-b border-gray-200 p-6 flex-shrink-0\">\n            <div className=\"flex items-center space-x-3\">\n\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900\">Detail Pengajuan SIMLOK</h2>\n                <p className=\"text-sm text-gray-500 mt-1\">\n                  Dibuat pada {formatDate(submission.created_at)}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              {getStatusBadge(submission.approval_status)}\n              <button\n                onClick={onClose}\n                className=\"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <XMarkIcon className=\"h-6 w-6\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            <div className=\"space-y-8\">\n              {/* Debug Section - Development Only */}\n              {process.env.NODE_ENV === 'development' && (\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                  <button\n                    onClick={() => setShowDebug(!showDebug)}\n                    className=\"text-sm font-medium text-yellow-800 hover:text-yellow-900\"\n                  >\n                    {showDebug ? 'Hide' : 'Show'} Debug Info\n                  </button>\n                  {showDebug && (\n                    <div className=\"mt-3\">\n                      <h4 className=\"font-bold mb-2\">Debug Info:</h4>\n                      <pre className=\"text-xs bg-yellow-50 p-3 rounded border overflow-auto max-h-40\">\n                        {JSON.stringify({\n                          id: submission.id,\n                          vendor_name: submission.vendor_name,\n                          officer_name: submission.officer_name,\n                          user: submission.user,\n                          based_on: submission.based_on,\n                          job_description: submission.job_description,\n                          work_location: submission.work_location,\n                          implementation: submission.implementation,\n                          working_hours: submission.working_hours,\n                          work_facilities: submission.work_facilities,\n                          other_notes: submission.other_notes,\n                          content: submission.content\n                        }, null, 2)}\n                      </pre>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Informasi Vendor */}\n              <DetailSection \n                title=\"Informasi Vendor\" \n                icon={<BuildingOfficeIcon className=\"h-5 w-5 text-blue-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Nama Vendor\"\n                    value={submission.vendor_name || '-'}\n                  />\n                  <InfoCard\n                    label=\"Nama Petugas\"\n                    value={submission.officer_name || '-'}\n                    icon={<UserIcon className=\"h-4 w-4 text-gray-500\" />}\n                  />\n                  <InfoCard\n                    label=\"Email\"\n                    value={submission.user?.email || '-'}\n                  />\n                  <InfoCard\n                    label=\"Berdasarkan\"\n                    value={submission.based_on || '-'}\n                  />\n                </div>\n              </DetailSection>\n\n                {/* Informasi Dokumen */}\n              <DetailSection \n                title=\"Informasi Dokumen\" \n                icon={<DocumentIcon className=\"h-5 w-5 text-orange-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {submission.simja_number && (\n                    <InfoCard\n                      label=\"Nomor SIMJA\"\n                      value={submission.simja_number}\n                    />\n                  )}\n                  {submission.simja_date && (\n                    <InfoCard\n                      label=\"Tanggal SIMJA\"\n                      value={formatDate(submission.simja_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                  {submission.sika_number && (\n                    <InfoCard\n                      label=\"Nomor SIKA\"\n                      value={submission.sika_number}\n                    />\n                  )}\n                  {submission.sika_date && (\n                    <InfoCard\n                      label=\"Tanggal SIKA\"\n                      value={formatDate(submission.sika_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                  {submission.approval_status === 'APPROVED' && submission.simlok_number && (\n                    <InfoCard\n                      label=\"Nomor SIMLOK\"\n                      value={submission.simlok_number}\n                    />\n                  )}\n                  {submission.approval_status === 'APPROVED' && submission.simlok_date && (\n                    <InfoCard\n                      label=\"Tanggal SIMLOK\"\n                      value={formatDate(submission.simlok_date)}\n                      icon={<CalendarIcon className=\"h-4 w-4 text-gray-500\" />}\n                    />\n                  )}\n                </div>\n              </DetailSection>\n\n              {/* Informasi Pekerjaan */}\n              <DetailSection \n                title=\"Informasi Pekerjaan\" \n                icon={<BriefcaseIcon className=\"h-5 w-5 text-green-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Pekerjaan\"\n                    value={submission.job_description || '-'}\n                  />\n                  <InfoCard\n                    label=\"Lokasi Kerja\"\n                    value={submission.work_location || '-'}\n                  />\n                  <InfoCard\n                    label=\"Pelaksanaan\"\n                    value={submission.implementation || 'Akan diisi oleh admin saat approval'}\n                  />\n                  <InfoCard\n                    label=\"Jam Kerja\"\n                    value={submission.working_hours || '-'}\n                  />\n                  <InfoCard\n                    label=\"Sarana Kerja\"\n                    value={submission.work_facilities || '-'}\n                    className=\"md:col-span-2\"\n                  />\n                </div>\n\n                {/* {submission.other_notes && (\n                  <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                    <InfoCard\n                      label=\"Lain-lain\"\n                      value={\n                        <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                          {submission.other_notes}\n                        </div>\n                      }\n                    />\n                  </div>\n                )} */}\n              </DetailSection>\n\n              {/* Daftar Pekerja */}\n              <DetailSection \n                title=\"Daftar Pekerja\" \n                icon={<UserIcon className=\"h-5 w-5 text-purple-500\" />}\n              >\n                {submission.worker_names ? (\n                  <WorkersList\n                    submissionId={submission.id}\n                    fallbackWorkers={submission.worker_names}\n                    layout=\"grid\"\n                    showPhotos={true}\n                    maxDisplayCount={6}\n                  />\n                ) : (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <UserIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                    <p>Belum ada data pekerja</p>\n                  </div>\n                )}\n              </DetailSection>\n\n              {/* Upload Dokumen */}\n              <DetailSection \n                title=\"Dokumen Upload\" \n                icon={<DocumentIcon className=\"h-5 w-5 text-red-500\" />}\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {submission.sika_document_upload && (\n                    <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                      <div className=\"flex items-center space-x-3\">\n                        <DocumentIcon className=\"h-6 w-6 text-red-500 flex-shrink-0\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Dokumen SIKA</p>\n                          <p className=\"text-sm text-gray-500\">File tersedia</p>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleFileView(submission.sika_document_upload!, 'Dokumen SIKA')}\n                        className=\"flex items-center space-x-2\"\n                      >\n                        <EyeIcon className=\"w-4 h-4\" />\n                        <span>Lihat</span>\n                      </Button>\n                    </div>\n                  )}\n                  \n                  {submission.simja_document_upload && (\n                    <div className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50\">\n                      <div className=\"flex items-center space-x-3\">\n                        <DocumentIcon className=\"h-6 w-6 text-blue-500 flex-shrink-0\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Dokumen SIMJA</p>\n                          <p className=\"text-sm text-gray-500\">File tersedia</p>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleFileView(submission.simja_document_upload!, 'Dokumen SIMJA')}\n                        className=\"flex items-center space-x-2\"\n                      >\n                        <EyeIcon className=\"w-4 h-4\" />\n                        <span>Lihat</span>\n                      </Button>\n                    </div>\n                  )}\n                  \n                  {!submission.sika_document_upload && !submission.simja_document_upload && (\n                    <div className=\"col-span-2 text-center py-8 text-gray-500\">\n                      <DocumentIcon className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <p>Belum ada dokumen yang diupload</p>\n                    </div>\n                  )}\n                </div>\n              </DetailSection>\n\n              {/* Informasi Penanda Tangan */}\n              {/* {(submission.signer_position || submission.signer_name) && (\n                <DetailSection \n                  title=\"Informasi Penanda Tangan\" \n                  icon={<UserIcon className=\"h-5 w-5 text-indigo-500\" />}\n                >\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <InfoCard\n                      label=\"Jabatan Penanda Tangan\"\n                      value={submission.signer_position || '-'}\n                    />\n                    <InfoCard\n                      label=\"Nama Penanda Tangan\"\n                      value={submission.signer_name || '-'}\n                    />\n                  </div>\n                </DetailSection>\n              )} */}\n\n              {/* Status & Approval */}\n              <DetailSection \n                title=\"Status Pengajuan\" \n                icon={\n                  submission.approval_status === 'APPROVED' ? (\n                    <CheckCircleIcon className=\"h-5 w-5 text-green-500\" />\n                  ) : submission.approval_status === 'REJECTED' ? (\n                    <XCircleIcon className=\"h-5 w-5 text-red-500\" />\n                  ) : (\n                    <PendingIcon className=\"h-5 w-5 text-orange-500\" />\n                  )\n                }\n                \n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <InfoCard\n                    label=\"Status\"\n                    value={getStatusBadge(submission.approval_status)}\n                  />\n                  {submission.approvedByUser && (\n                    <InfoCard\n                      label=\"Disetujui oleh\"\n                      value={submission.approvedByUser.officer_name}\n                    />\n                  )}\n\n                  {submission.notes && (\n                    <InfoCard\n                      label=\"Keterangan\"\n                      value={\n                        <div className=\"whitespace-pre-wrap text-sm text-gray-900 bg-gray-50 p-3 rounded-md\">\n                          {submission.notes}\n                        </div>\n                      }\n                    />\n                  )}\n\n                  {/* Status-specific information */}\n                  {submission.approval_status === 'PENDING' && (\n                    <div className=\"md:col-span-2 bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <PendingIcon className=\"h-5 w-5 text-yellow-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-yellow-800\">Menunggu Review</h4>\n                          <p className=\"text-sm text-yellow-700 mt-1\">\n                            Pengajuan Anda sedang dalam proses review oleh admin.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.approval_status === 'APPROVED' && (\n                    <div className=\"md:col-span-2 bg-green-50 border border-green-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <CheckCircleIcon className=\"h-5 w-5 text-green-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-green-800\">Pengajuan Disetujui</h4>\n                          <p className=\"text-sm text-green-700 mt-1\">\n                            Selamat! Pengajuan SIMLOK Anda telah disetujui.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {submission.approval_status === 'REJECTED' && (\n                    <div className=\"md:col-span-2 bg-red-50 border border-red-200 rounded-lg p-4\">\n                      <div className=\"flex items-center\">\n                        <XCircleIcon className=\"h-5 w-5 text-red-500 mr-3\" />\n                        <div>\n                          <h4 className=\"text-sm font-medium text-red-800\">Pengajuan Ditolak</h4>\n                          <p className=\"text-sm text-red-700 mt-1\">\n                            Pengajuan SIMLOK Anda tidak dapat disetujui. Silakan hubungi admin untuk informasi lebih lanjut.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </DetailSection>\n            </div>\n\n            {/* Footer Actions */}\n            <div className=\"flex items-center justify-between border-t border-gray-200 pt-6 mt-8\">\n              <div className=\"flex items-center space-x-3 justify-between w-full\">\n                {submission.approval_status === 'APPROVED' && submission.simlok_number && (\n                  <Button\n                    variant=\"primary\"\n                    size=\"sm\"\n                    onClick={handleDownloadPdf}\n                  >\n                    <DocumentIcon className=\"w-4 h-4 mr-2\" />\n                    Lihat PDF\n                  </Button>\n                )}\n                \n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={onClose}\n                >\n                  Tutup\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Document Preview Modal */}\n      <DocumentPreviewModal\n        isOpen={isDocumentModalOpen}\n        onClose={() => setIsDocumentModalOpen(false)}\n        fileUrl={selectedDocument?.url || ''}\n        fileName={selectedDocument?.title || ''}\n      />\n\n      {/* PDF Download Modal */}\n      <SimlokPdfModal\n        isOpen={isPdfModalOpen}\n        onClose={() => setIsPdfModalOpen(false)}\n        submissionId={submission?.id || ''}\n        submissionName={submission?.vendor_name || ''}\n        nomorSimlok={submission?.simlok_number || ''}\n      />\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/vendor/VendorSubmissionsContent.tsx",
      "lang": "tsx",
      "size": 31968,
      "lines": 781,
      "hash": "66c99e60ef422284bc982a1af3f8d0b2991f4dc805aa8193782868a4de3e162f",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react';\nimport Link from 'next/link';\nimport { \n  MagnifyingGlassIcon,\n  ChevronUpIcon,\n  ChevronDownIcon,\n  ChevronUpDownIcon,\n  PlusIcon\n} from \"@heroicons/react/24/outline\";\nimport SubmissionDetailModal from './SubmissionDetailModal';\nimport Button from '../ui/button/Button';\nimport { useToast } from '@/hooks/useToast';\nimport ConfirmModal from '../ui/modal/ConfirmModal';\nimport { useSubmissionStore } from '@/store/useSubmissionStore';\nimport { useSocket } from '@/components/common/RealtimeUpdates';\n\ninterface Submission {\n  id: string;\n  approval_status: string;\n  vendor_name: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;\n  other_notes?: string;\n  work_facilities: string;\n  simja_number?: string;\n  simja_date?: string | null;\n  sika_number?: string;\n  sika_date?: string | null;\n  simlok_number?: string;\n  simlok_date?: string | null;\n  worker_names: string;\n  content: string;\n  notes?: string;\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n  qrcode?: string;\n  created_at: string;\n  user: {\n    id: string;\n    officer_name: string;\n    email: string;\n    vendor_name: string;\n  };\n  approvedByUser?: {\n    id: string;\n    officer_name: string;\n    email: string;\n  };\n}\n\n// Types already defined in the store\n\n// Custom hook untuk debounced value\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n\nexport default function VendorSubmissionsContent() {\n  const { showSuccess, showError } = useToast();\n  \n  // Use Zustand store for realtime submissions data\n  const { \n    submissions,\n    loading,\n    searchTerm,\n    sortField,\n    sortOrder,\n    currentPage,\n    totalPages,\n    allSubmissionsStats,\n    filteredTotal,\n    fetchVendorSubmissions,\n    fetchVendorStats,\n    setSearchTerm,\n    setSortField,\n    setSortOrder,\n    setCurrentPage\n  } = useSubmissionStore();\n  \n  // Initialize Socket.IO connection\n  useSocket();\n  \n  const [error] = useState(\"\");\n  \n  // Status filter (local state)\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [limit] = useState(10);\n\n  // Modal state\n  const [selectedSubmission, setSelectedSubmission] = useState<Submission | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  \n  // Confirm modal state\n  const [confirmModal, setConfirmModal] = useState<{\n    isOpen: boolean;\n    title: string;\n    message: string;\n    onConfirm: () => void;\n  }>({\n    isOpen: false,\n    title: '',\n    message: '',\n    onConfirm: () => {}\n  });\n\n  // Ref untuk search input\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const [isInputFocused, setIsInputFocused] = useState(false);\n\n  // Debounced search term\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\n\n  // Fetch statistics once when component mounts\n  useEffect(() => {\n    fetchVendorStats();\n  }, [fetchVendorStats]);\n\n  // Fetch submissions when filters change\n  useEffect(() => {\n    const params = {\n      page: currentPage,\n      limit,\n      search: debouncedSearchTerm,\n      sortBy: sortField,\n      sortOrder,\n      ...(statusFilter && { status: statusFilter }),\n    };\n    \n    fetchVendorSubmissions(params);\n  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions]);\n\n  // Kembalikan fokus ke search input setelah data reload\n  useEffect(() => {\n    if (!loading && isInputFocused && searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n  }, [loading, isInputFocused]);\n\n  // Reset ke halaman 1 saat search term berubah\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [debouncedSearchTerm, statusFilter]);\n\n  const handleSort = useCallback((field: string) => {\n    if (field === sortField) {\n      setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortOrder(\"desc\");\n    }\n    setCurrentPage(1);\n  }, [sortField, sortOrder, setSortField, setSortOrder, setCurrentPage]);\n\n  const handleSearchChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchTerm(e.target.value);\n    setIsInputFocused(true);\n  }, []);\n\n  const handleStatusFilterChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\n    setStatusFilter(e.target.value);\n  }, []);\n\n  const handleDelete = useCallback((id: string) => {\n    setConfirmModal({\n      isOpen: true,\n      title: 'Konfirmasi Hapus',\n      message: 'Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan.',\n      onConfirm: () => performDelete(id)\n    });\n  }, []);\n\n  const performDelete = useCallback(async (id: string) => {\n    try {\n      setConfirmModal(prev => ({ ...prev, isOpen: false }));\n      \n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Gagal menghapus pengajuan');\n      }\n\n      // Refresh data setelah berhasil menghapus\n      const params = {\n        page: currentPage,\n        limit,\n        search: debouncedSearchTerm,\n        sortBy: sortField,\n        sortOrder,\n        ...(statusFilter && { status: statusFilter }),\n      };\n      \n      await fetchVendorSubmissions(params);\n      \n      showSuccess('Berhasil!', 'Pengajuan berhasil dihapus');\n    } catch (error: any) {\n      console.error('Error deleting submission:', error);\n      showError('Error!', error.message || 'Gagal menghapus pengajuan');\n    }\n  }, [currentPage, limit, debouncedSearchTerm, sortField, sortOrder, statusFilter, fetchVendorSubmissions, showSuccess, showError]);\n\n  const handleViewDetail = useCallback((submission: Submission) => {\n    setSelectedSubmission(submission);\n    setIsModalOpen(true);\n  }, []);\n\n  const handleCloseModal = useCallback(() => {\n    setIsModalOpen(false);\n    setSelectedSubmission(null);\n  }, []);\n\n  const paginationInfo = useMemo(() => ({\n    currentPage,\n    totalPages,\n    filteredTotal,\n    limit,\n    startItem: ((currentPage - 1) * limit) + 1,\n    endItem: Math.min(currentPage * limit, filteredTotal)\n  }), [currentPage, totalPages, filteredTotal, limit]);\n\n  const getSortIcon = useCallback((field: string) => {\n    if (sortField !== field) {\n      return <ChevronUpDownIcon className=\"w-4 h-4 text-gray-400\" />;\n    }\n    return sortOrder === \"asc\" \n      ? <ChevronUpIcon className=\"w-4 h-4 text-blue-500\" />\n      : <ChevronDownIcon className=\"w-4 h-4 text-blue-500\" />;\n  }, [sortField, sortOrder]);\n\n  const formatDate = useCallback((dateString: string) => {\n    return new Date(dateString).toLocaleDateString(\"id-ID\", {\n      year: \"numeric\",\n      month: \"short\", \n      day: \"numeric\"\n    });\n  }, []);\n\n  const getStatusBadge = useCallback((status: string) => {\n    const statusConfig = {\n      'PENDING': { label: \"Menunggu\", className: \"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full\" },\n      'APPROVED': { label: \"Disetujui\", className: \"bg-green-100 text-green-700 px-2 py-0.5 rounded-full\" },\n      'REJECTED': { label: \"Ditolak\", className: \"bg-red-100 text-red-700 px-2 py-0.5 rounded-full\" }\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || { \n      label: status, \n      className: 'bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full' \n    };\n    \n    return (\n      <span className={`text-xs font-semibold ${config.className}`}>\n        {config.label}\n      </span>\n    );\n  }, []);\n\n  // Function to format nama_pekerja for table display\n  const formatNamaPekerjaPreview = useCallback((names: string, maxDisplay: number = 2): string => {\n    if (!names) return '';\n    const namesList = names\n      .split(/[\\n,]+/)\n      .map(name => name.trim())\n      .filter(name => name.length > 0);\n    \n    if (namesList.length <= maxDisplay) {\n      return namesList.join(', ');\n    }\n    \n    return `${namesList.slice(0, maxDisplay).join(', ')} +${namesList.length - maxDisplay} lainnya`;\n  }, []);\n\n\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-3 md:px-6 space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Total</h3>\n          <p className=\"text-2xl font-bold text-blue-600 mt-1\">{allSubmissionsStats?.total || 0}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Menunggu</h3>\n          <p className=\"text-2xl font-bold text-yellow-600 mt-1\">\n            {allSubmissionsStats?.pending || 0}\n          </p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Disetujui</h3>\n          <p className=\"text-2xl font-bold text-green-600 mt-1\">\n            {allSubmissionsStats?.approved || 0}\n          </p>\n        </div>\n        <div className=\"bg-white rounded-xl border shadow-sm p-4\">\n          <h3 className=\"text-sm font-medium text-gray-500\">Ditolak</h3>\n          <p className=\"text-2xl font-bold text-red-600 mt-1\">\n            {allSubmissionsStats?.rejected || 0}\n          </p>\n        </div>\n      </div>\n\n      {/* Header */}\n       <div className=\"bg-white rounded-xl border shadow-sm p-6 space-y-4\">\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-xl md:text-2xl font-semibold text-gray-900\">Pengajuan Saya</h1>\n          {/* <p className=\"text-sm text-gray-500 mt-1\">Daftar Pengajuan SIMLOK ({paginationInfo.totalSubmissions || 0} pengajuan)</p> */}\n        </div>\n        \n        <Link href=\"/vendor/submissions/create\">\n          <Button \n            variant=\"primary\"\n            size=\"md\"\n            startIcon={<PlusIcon className=\"w-4 h-4\" />}\n            className=\"whitespace-nowrap\"\n          >\n            Buat Pengajuan Baru\n          </Button>\n        </Link>\n      </div>\n\n      {/* Toolbar - Search and Filters */}\n      <div className=\"flex flex-col md:flex-row gap-3 md:items-center md:justify-between\">\n        <div className=\"relative w-full md:w-80\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            placeholder=\"Cari pekerjaan atau petugas…\"\n            value={searchTerm}\n            onChange={handleSearchChange}\n            onBlur={() => setIsInputFocused(false)}\n            onFocus={() => setIsInputFocused(true)}\n            className=\"block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n          />\n        </div>\n        \n        <select\n          value={statusFilter}\n          onChange={handleStatusFilterChange}\n          className=\"w-44 px-3 py-2.5 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors\"\n        >\n          <option value=\"\">Semua</option>\n          <option value=\"APPROVED\">Disetujui</option>\n          <option value=\"REJECTED\">Ditolak</option>\n          <option value=\"PENDING\">Menunggu</option>\n        </select>\n      </div>\n      </div>\n\n      {/* Content */}\n      {error ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Gagal memuat data pengajuan</h3>\n          <p className=\"text-gray-500 mb-4\">Periksa koneksi atau coba ulang</p>\n          <button \n            onClick={() => {\n              const params = {\n                page: currentPage,\n                limit,\n                search: debouncedSearchTerm,\n                sortBy: sortField,\n                sortOrder,\n                ...(statusFilter && { status: statusFilter }),\n              };\n              fetchVendorSubmissions(params);\n            }}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors\"\n          >\n            Coba Lagi\n          </button>\n        </div>\n      ) : submissions.length === 0 && !loading ? (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm p-12 text-center\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4\">\n            <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2h16a2 2 0 002-2v-5m0 0V9a2 2 0 00-2-2H6a2 2 0 00-2 2v4\" />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Belum ada pengajuan</h3>\n          <p className=\"text-gray-500 mb-6\">Buat pengajuan baru untuk memulai</p>\n          <Link href=\"/vendor/submissions/create\">\n            <Button \n              variant=\"primary\"\n              size=\"md\"\n              startIcon={<PlusIcon className=\"w-4 h-4\" />}\n            >\n              Buat Pengajuan Baru\n            </Button>\n          </Link>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto rounded-xl border bg-white shadow-sm\">\n          {/* Loading Skeleton */}\n          {loading ? (\n            <div className=\"divide-y\">\n              {/* Header skeleton */}\n              <div className=\"bg-gray-50/50 p-3\">\n                <div className=\"grid grid-cols-5 gap-4\">\n                  {Array.from({ length: 5 }).map((_, i) => (\n                    <div key={i} className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                  ))}\n                </div>\n              </div>\n              {/* Rows skeleton */}\n              {Array.from({ length: 5 }).map((_, i) => (\n                <div key={i} className=\"p-3\">\n                  <div className=\"grid grid-cols-5 gap-4 items-center\">\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse w-3/4\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-2/3\"></div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded animate-pulse w-1/2\"></div>\n                    </div>\n                    <div className=\"h-6 bg-gray-200 rounded-full animate-pulse w-20\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded animate-pulse w-16\"></div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <>\n              {/* Desktop Table View */}\n              <div className=\"hidden md:block\">\n                <table className=\"min-w-full table-fixed\">\n                  <colgroup>\n                    <col className=\"w-[28%]\" />\n                    <col className=\"w-[18%]\" />\n                    <col className=\"w-[22%]\" />\n                    <col className=\"w-[12%]\" />\n                    <col className=\"w-[10%]\" />\n                    <col className=\"w-[10%]\" />\n                  </colgroup>\n                  <thead>\n                    <tr className=\"bg-gray-50/50 border-b border-gray-200\">\n                      <th \n                        onClick={() => handleSort(\"job_description\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Pekerjaan & Petugas</span>\n                          {getSortIcon(\"job_description\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Sarana Kerja\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Lokasi & Waktu\n                      </th>\n                      <th \n                        onClick={() => handleSort(\"approval_status\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Status</span>\n                          {getSortIcon(\"approval_status\")}\n                        </div>\n                      </th>\n                      <th \n                        onClick={() => handleSort(\"created_at\")}\n                        className=\"p-3 text-left text-sm font-semibold text-gray-900 cursor-pointer hover:bg-gray-100 select-none transition-colors\"\n                      >\n                        <div className=\"flex items-center space-x-1\">\n                          <span>Tanggal</span>\n                          {getSortIcon(\"created_at\")}\n                        </div>\n                      </th>\n                      <th className=\"p-3 text-left text-sm font-semibold text-gray-900\">\n                        Aksi\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {submissions.map((submission: any) => (\n                      <tr \n                        key={submission.id} \n                        className=\"hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                        onClick={() => handleViewDetail(submission)}\n                      >\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm font-medium text-gray-900 break-words leading-snug\">\n                            {submission.job_description}\n                          </div>\n                          <div className=\"text-xs text-gray-500 mt-1 font-medium\">{submission.officer_name}</div>\n                          {/* <div className=\"text-xs text-gray-500 mt-1\" title={submission.worker_names}>\n                            Pekerja: {formatNamaPekerjaPreview(submission.worker_names, 3)}\n                          </div> */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm text-gray-800 break-words leading-snug\">\n                            {submission.work_facilities}\n                          </div>\n                          {/* {submission.other_notes && (\n                            <div className=\"text-xs text-gray-600 mt-1 break-words leading-relaxed\">\n                              <span className=\"font-medium\">Catatan:</span> {submission.other_notes}\n                            </div>\n                          )} */}\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-sm text-gray-800 leading-snug\">\n                            <div className=\"font-medium break-words\">{submission.work_location}</div>\n                            {/* {submission.implementation && (\n                              <div className=\"text-xs text-gray-600 mt-1 break-words\">\n                                <span className=\"font-medium\">Pelaksanaan:</span> {submission.implementation}\n                              </div>\n                            )} */}\n                            {submission.working_hours && (\n                              <div className=\"text-xs text-gray-600 mt-1\">\n                                <span className=\"font-medium\">Jam:</span> {submission.working_hours}\n                              </div>\n                            )}\n                          </div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"space-y-1\">\n                            {getStatusBadge(submission.approval_status)}\n                          </div>\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"text-xs text-gray-500\">{formatDate(submission.created_at)}</div>\n\n                        </td>\n                        <td className=\"p-3 align-top\">\n                          <div className=\"flex items-start gap-1\" onClick={(e) => e.stopPropagation()}>\n                            <Button\n                              onClick={() => handleViewDetail(submission)}\n                              variant=\"info\"\n                              size=\"sm\"\n                              title=\"Lihat detail submission\"\n                              className=\"text-xs \"\n                            >\n                              Lihat\n                            </Button>\n                            {submission.approval_status === 'PENDING' && (\n                              <>\n                                <Link href={`/vendor/submissions/edit/${submission.id}`} className=\"w-full\">\n                                  <Button\n                                    variant=\"warning\"\n                                    size=\"sm\"\n                                    title=\"Edit submission\"\n                                    className=\"text-xs w-full\"\n                                  >\n                                    Edit\n                                  </Button>\n                                </Link>\n                                <Button \n                                  onClick={() => handleDelete(submission.id)} \n                                  variant=\"destructive\" \n                                  size=\"sm\"\n                                  title=\"Hapus submission ini\"\n                                  className=\"text-xs w-full\"\n                                >\n                                  Hapus\n                                </Button>\n                              </>\n                            )}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Mobile Card View */}\n              <div className=\"md:hidden divide-y divide-gray-200\">\n                {submissions.map((submission: any) => (\n                  <div \n                    key={submission.id}\n                    className=\"p-4 hover:bg-gray-50/50 transition-colors cursor-pointer\"\n                    onClick={() => handleViewDetail(submission)}\n                  >\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-medium text-gray-900 break-words leading-snug\">{submission.job_description}</h3>\n                        <p className=\"text-sm text-gray-500 font-medium\">{submission.officer_name}</p>\n                      </div>\n                      {getStatusBadge(submission.approval_status)}\n                    </div>\n                    \n                    <div className=\"space-y-3\">\n                      <div>\n                        <p className=\"text-xs text-gray-500 mb-1\">\n                          <span className=\"font-medium\">Pekerja:</span> {formatNamaPekerjaPreview(submission.worker_names, 3)}\n                        </p>\n                        <p className=\"text-sm text-gray-800 break-words leading-snug\">\n                          <span className=\"font-medium\">Sarana:</span> {submission.work_facilities}\n                        </p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-sm text-gray-800 break-words leading-snug\">\n                          <span className=\"font-medium\">Lokasi:</span> {submission.work_location}\n                        </p>\n                        {submission.implementation && (\n                          <p className=\"text-xs text-gray-600 mt-1 break-words\">\n                            <span className=\"font-medium\">Pelaksanaan:</span> {submission.implementation}\n                          </p>\n                        )}\n                        {submission.working_hours && (\n                          <p className=\"text-xs text-gray-600 mt-1\">\n                            <span className=\"font-medium\">Jam Kerja:</span> {submission.working_hours}\n                          </p>\n                        )}\n                      </div>\n\n                      {(submission.other_notes || submission.notes) && (\n                        <div className=\"bg-gray-50 rounded-lg p-2\">\n                          {submission.other_notes && (\n                            <p className=\"text-xs text-gray-600 break-words leading-relaxed\">\n                              <span className=\"font-medium\">Catatan Lain:</span> {submission.other_notes}\n                            </p>\n                          )}\n                          {submission.notes && (\n                            <p className=\"text-xs text-gray-600 break-words leading-relaxed mt-1\">\n                              <span className=\"font-medium\">Catatan Admin:</span> {submission.notes}\n                            </p>\n                          )}\n                        </div>\n                      )}\n                      \n                      <div className=\"flex justify-between items-center text-xs text-gray-500\">\n                        <span>{formatDate(submission.created_at)}</span>\n                        <div className=\"text-right\">\n                          {submission.simlok_number && (\n                            <div>SIMLOK: {submission.simlok_number}</div>\n                          )}\n                          {submission.sika_number && (\n                            <div>SIKA: {submission.sika_number}</div>\n                          )}\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex items-center space-x-2 pt-2\" onClick={(e) => e.stopPropagation()}>\n                        <Button\n                          onClick={() => handleViewDetail(submission)}\n                          variant=\"info\"\n                          size=\"sm\"\n                          className=\"text-xs flex-1\"\n                        >\n                          Lihat Detail\n                        </Button>\n                        {submission.approval_status === 'PENDING' && (\n                          <>\n                            <Link href={`/vendor/submissions/edit/${submission.id}`}>\n                              <Button\n                                variant=\"warning\"\n                                size=\"sm\"\n                                className=\"text-xs\"\n                              >\n                                Edit\n                              </Button>\n                            </Link>\n                            <Button \n                              onClick={() => handleDelete(submission.id)} \n                              variant=\"destructive\" \n                              size=\"sm\"\n                              className=\"text-xs\"\n                            >\n                              Hapus\n                            </Button>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n\n          {/* Footer with Pagination */}\n          {totalPages > 1 && !loading && (\n            <div className=\"flex items-center justify-between text-sm text-gray-500 p-3 border-t\">\n              <span>{paginationInfo.startItem} - {paginationInfo.endItem} dari {paginationInfo.filteredTotal}</span>\n              \n              <div className=\"flex items-center space-x-1\">\n                <button\n                  onClick={() => setCurrentPage((prev: number) => Math.max(prev - 1, 1))}\n                  disabled={currentPage === 1}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  ←\n                </button>\n                \n                {[...Array(totalPages)].map((_, index) => {\n                  const page = index + 1;\n                  if (\n                    page === 1 ||\n                    page === totalPages ||\n                    (page >= currentPage - 1 && page <= currentPage + 1)\n                  ) {\n                    return (\n                      <button\n                        key={page}\n                        onClick={() => setCurrentPage(page)}\n                        className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                          currentPage === page\n                            ? \"bg-blue-600 text-white\"\n                            : \"border border-gray-300 text-gray-700 bg-white hover:bg-gray-50\"\n                        }`}\n                      >\n                        {page}\n                      </button>\n                    );\n                  } else if (\n                    page === currentPage - 2 ||\n                    page === currentPage + 2\n                  ) {\n                    return <span key={page} className=\"text-gray-400 px-1\">…</span>;\n                  }\n                  return null;\n                })}\n                \n                <button\n                  onClick={() => setCurrentPage((prev: number) => Math.min(prev + 1, totalPages))}\n                  disabled={currentPage === totalPages}\n                  className=\"px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  →\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Modal Detail */}\n      <SubmissionDetailModal\n        submission={selectedSubmission}\n        isOpen={isModalOpen}\n        onClose={handleCloseModal}\n      />\n\n      {/* Confirm Modal */}\n      <ConfirmModal\n        isOpen={confirmModal.isOpen}\n        title={confirmModal.title}\n        message={confirmModal.message}\n        onConfirm={confirmModal.onConfirm}\n        onClose={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))}\n        variant=\"danger\"\n      />\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/components/verifier/EnhancedSubmissionsList.tsx",
      "lang": "tsx",
      "size": 16250,
      "lines": 461,
      "hash": "9cf031919af0f88ea16004f4383b5a1e16994003bc667be0aca0d3fa07389087",
      "truncated": false,
      "content": "/**\n * Enhanced Mobile-First Submissions List for Verifier\n * Optimized for mobile user experience with card-based layout\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  MagnifyingGlassIcon,\n  FunnelIcon,\n  EyeIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon,\n  QrCodeIcon,\n  DocumentArrowDownIcon,\n  MapPinIcon,\n  BuildingOfficeIcon,\n  UserIcon,\n  AdjustmentsHorizontalIcon,\n  ChevronDownIcon,\n  XMarkIcon\n} from '@heroicons/react/24/outline';\nimport { useToast } from '@/hooks/useToast';\nimport Button from '../ui/button/Button';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\n\ninterface SubmissionData {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string;\n  approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';\n  simlok_number?: string;\n  simlok_date?: string;\n  created_at: string;\n}\n\ninterface FilterOptions {\n  status: 'ALL' | 'PENDING' | 'APPROVED' | 'REJECTED';\n  dateRange: 'ALL' | 'TODAY' | 'WEEK' | 'MONTH';\n  search: string;\n}\n\nexport default function EnhancedSubmissionsList() {\n  const { showError, showSuccess } = useToast();\n  \n  const [submissions, setSubmissions] = useState<SubmissionData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const [filtersOpen, setFiltersOpen] = useState(false);\n\n  const [filters, setFilters] = useState<FilterOptions>({\n    status: 'ALL',\n    dateRange: 'ALL',\n    search: ''\n  });\n  const [pagination, setPagination] = useState({\n    total: 0,\n    limit: 10,\n    offset: 0,\n    hasMore: true\n  });\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [filters, pagination.offset]);\n\n  const fetchSubmissions = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams({\n        limit: pagination.limit.toString(),\n        offset: pagination.offset.toString(),\n        status: filters.status,\n        dateRange: filters.dateRange,\n        search: filters.search\n      });\n\n      const response = await fetch(`/api/verifier/submissions?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        \n        // Append new submissions if loading more, otherwise replace\n        if (pagination.offset === 0) {\n          setSubmissions(data.submissions || []);\n        } else {\n          setSubmissions(prev => [...prev, ...(data.submissions || [])]);\n        }\n        \n        setPagination(prev => ({\n          ...prev,\n          total: data.pagination?.total || 0,\n          hasMore: data.pagination?.hasMore || false\n        }));\n      } else {\n        showError('Error', 'Gagal memuat data submissions');\n      }\n    } catch (error) {\n      console.error('Error fetching submissions:', error);\n      showError('Error', 'Gagal memuat data submissions');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFilterChange = (newFilters: Partial<FilterOptions>) => {\n    setFilters(prev => ({ ...prev, ...newFilters }));\n    setPagination(prev => ({ ...prev, offset: 0 }));\n  };\n\n  const handleScanResult = async (scannedData: string) => {\n    try {\n      setScannerOpen(false);\n      \n      // Extract submission ID from QR code data\n      let submissionId = scannedData;\n      \n      if (scannedData.startsWith('{')) {\n        try {\n          const qrData = JSON.parse(scannedData);\n          submissionId = qrData.submissionId || qrData.id || scannedData;\n        } catch (e) {\n          // If parsing fails, use the raw data\n        }\n      }\n\n      // Navigate to submission detail\n      window.location.href = `/verifier/submissions/${submissionId}`;\n      showSuccess('Success', 'QR Code berhasil dipindai');\n      \n    } catch (error) {\n      console.error('Error processing barcode:', error);\n      showError('Error', 'Gagal memproses QR Code');\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const configs = {\n      APPROVED: {\n        bg: 'bg-green-100',\n        text: 'text-green-800',\n        icon: CheckCircleIcon,\n        label: 'Disetujui'\n      },\n      REJECTED: {\n        bg: 'bg-red-100',\n        text: 'text-red-800',\n        icon: XCircleIcon,\n        label: 'Ditolak'\n      },\n      PENDING: {\n        bg: 'bg-yellow-100',\n        text: 'text-yellow-800',\n        icon: ClockIcon,\n        label: 'Pending'\n      }\n    };\n\n    const config = configs[status as keyof typeof configs] || configs.PENDING;\n    const IconComponent = config.icon;\n\n    return (\n      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${config.bg} ${config.text}`}>\n        <IconComponent className=\"w-3 h-3 mr-1\" />\n        {config.label}\n      </span>\n    );\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'short',\n      year: 'numeric'\n    });\n  };\n\n  const loadMore = () => {\n    setPagination(prev => ({\n      ...prev,\n      offset: prev.offset + prev.limit\n    }));\n  };\n\n  const clearFilters = () => {\n    setFilters({\n      status: 'ALL',\n      dateRange: 'ALL',\n      search: ''\n    });\n  };\n\n  const activeFiltersCount = Object.values(filters).filter(value => value !== 'ALL' && value !== '').length;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Mobile Header */}\n      <div className=\"bg-white border-b border-gray-200 sticky top-0 z-40\">\n        <div className=\"px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-xl font-bold text-gray-900\">\n                Daftar SIMLOK\n              </h1>\n              <p className=\"text-sm text-gray-500 mt-1\">\n                {pagination.total.toLocaleString()} submissions\n              </p>\n            </div>\n            \n            <div className=\"flex items-center space-x-2\">\n              {/* Filter Toggle */}\n              <button\n                onClick={() => setFiltersOpen(!filtersOpen)}\n                className=\"relative p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                <AdjustmentsHorizontalIcon className=\"w-5 h-5\" />\n                {activeFiltersCount > 0 && (\n                  <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center\">\n                    {activeFiltersCount}\n                  </span>\n                )}\n              </button>\n\n              {/* QR Scan Button */}\n              <Button\n                onClick={() => setScannerOpen(true)}\n                className=\"bg-blue-600 hover:bg-blue-700 px-3 py-2\"\n                size=\"sm\"\n              >\n                <QrCodeIcon className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Filters Panel */}\n        {filtersOpen && (\n          <div className=\"border-t border-gray-200 bg-gray-50 p-4 space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-sm font-medium text-gray-900\">Filters</h3>\n              <div className=\"flex items-center space-x-2\">\n                {activeFiltersCount > 0 && (\n                  <button\n                    onClick={clearFilters}\n                    className=\"text-xs text-blue-600 hover:text-blue-700\"\n                  >\n                    Clear All\n                  </button>\n                )}\n                <button\n                  onClick={() => setFiltersOpen(false)}\n                  className=\"p-1 text-gray-400 hover:text-gray-600\"\n                >\n                  <XMarkIcon className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Search */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Pencarian\n              </label>\n              <div className=\"relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <MagnifyingGlassIcon className=\"h-4 w-4 text-gray-400\" />\n                </div>\n                <input\n                  type=\"text\"\n                  value={filters.search}\n                  onChange={(e) => handleFilterChange({ search: e.target.value })}\n                  className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"Cari nomor SIMLOK, vendor...\"\n                />\n              </div>\n            </div>\n\n            {/* Status & Date Filters */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Status\n                </label>\n                <select\n                  value={filters.status}\n                  onChange={(e) => handleFilterChange({ status: e.target.value as FilterOptions['status'] })}\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                >\n                  <option value=\"ALL\">Semua</option>\n                  <option value=\"PENDING\">Pending</option>\n                  <option value=\"APPROVED\">Disetujui</option>\n                  <option value=\"REJECTED\">Ditolak</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Periode\n                </label>\n                <select\n                  value={filters.dateRange}\n                  onChange={(e) => handleFilterChange({ dateRange: e.target.value as FilterOptions['dateRange'] })}\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                >\n                  <option value=\"ALL\">Semua</option>\n                  <option value=\"TODAY\">Hari Ini</option>\n                  <option value=\"WEEK\">Minggu Ini</option>\n                  <option value=\"MONTH\">Bulan Ini</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"px-4 py-4\">\n        {loading && pagination.offset === 0 ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          </div>\n        ) : submissions.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <FunnelIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n              Tidak ada submissions\n            </h3>\n            <p className=\"mt-1 text-sm text-gray-500\">\n              Tidak ada submissions yang sesuai dengan filter.\n            </p>\n          </div>\n        ) : (\n          <>\n            {/* Card View */}\n            <div className=\"space-y-4\">\n              {submissions.map((submission) => (\n                <div\n                  key={submission.id}\n                  className=\"bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow\"\n                >\n                  <div className=\"p-4\">\n                    {/* Header */}\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center space-x-2\">\n                        <div className=\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center\">\n                          <DocumentArrowDownIcon className=\"w-4 h-4 text-blue-600\" />\n                        </div>\n                        <div>\n                          <div className=\"text-sm font-semibold text-gray-900\">\n                            {submission.simlok_number || 'Belum ada nomor'}\n                          </div>\n                          <div className=\"text-xs text-gray-500\">\n                            {formatDate(submission.created_at)}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {getStatusBadge(submission.approval_status)}\n                    </div>\n\n                    {/* Content */}\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-start space-x-3\">\n                        <BuildingOfficeIcon className=\"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        <div className=\"min-w-0 flex-1\">\n                          <div className=\"text-sm font-medium text-gray-900\">\n                            {submission.vendor_name}\n                          </div>\n                          <div className=\"text-xs text-gray-500\">\n                            {submission.officer_name}\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-start space-x-3\">\n                        <MapPinIcon className=\"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        <div className=\"text-sm text-gray-600\">\n                          {submission.work_location}\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-start space-x-3\">\n                        <UserIcon className=\"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        <div className=\"text-sm text-gray-600 line-clamp-2\">\n                          {submission.job_description}\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"mt-4 pt-3 border-t border-gray-100\">\n                      <Button\n                        onClick={() => window.location.href = `/verifier/submissions/${submission.id}`}\n                        variant=\"primary\"\n                        size=\"sm\"\n                        className=\"w-full justify-center\"\n                      >\n                        <EyeIcon className=\"w-4 h-4 mr-2\" />\n                        Lihat Detail\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Load More */}\n            {pagination.hasMore && (\n              <div className=\"mt-6\">\n                <Button\n                  onClick={loadMore}\n                  disabled={loading}\n                  variant=\"outline\"\n                  className=\"w-full justify-center py-3\"\n                  size=\"lg\"\n                >\n                  {loading ? (\n                    <>\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2\"></div>\n                      Memuat...\n                    </>\n                  ) : (\n                    <>\n                      <ChevronDownIcon className=\"w-4 h-4 mr-2\" />\n                      Muat Lebih Banyak\n                    </>\n                  )}\n                </Button>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Floating Action Button - Mobile */}\n      <div className=\"fixed bottom-6 right-6 md:hidden\">\n        <button\n          onClick={() => setScannerOpen(true)}\n          className=\"w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center\"\n        >\n          <QrCodeIcon className=\"w-6 h-6\" />\n        </button>\n      </div>\n\n      {/* QR Code Scanner */}\n      {scannerOpen && (\n        <CameraQRScanner\n          isOpen={scannerOpen}\n          onClose={() => setScannerOpen(false)}\n          onScan={handleScanResult}\n          title=\"Scan QR Code SIMLOK\"\n          description=\"Posisikan kamera pada QR code untuk membuka detail submission\"\n        />\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/verifier/EnhancedVerifierDashboard.tsx",
      "lang": "tsx",
      "size": 13315,
      "lines": 354,
      "hash": "4c0f2a19ce3d74fc49d47845b48f150b9f3ccd70ded3563fca67245412e2cbda",
      "truncated": false,
      "content": "/**\n * Enhanced Mobile-First Verifier Dashboard\n * Optimized for mobile user experience with touch-friendly interfaces\n */\n\n'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { \n  CameraIcon, \n  QrCodeIcon, \n  DocumentTextIcon, \n  ClockIcon,\n  CheckCircleIcon,\n  ExclamationTriangleIcon,\n  BellIcon,\n  UserIcon,\n  Bars3Icon,\n  XMarkIcon\n} from '@heroicons/react/24/outline';\nimport Button from '../ui/button/Button';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\nimport ScanHistory from '../scanner/ScanHistory';\n\ninterface DashboardStats {\n  todayScans: number;\n  totalVerified: number;\n  pendingReviews: number;\n  recentActivity: Array<{\n    id: string;\n    type: 'scan' | 'verify' | 'alert';\n    message: string;\n    timestamp: string;\n  }>;\n}\n\nexport default function EnhancedVerifierDashboard() {\n  const { data: session } = useSession();\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [stats, setStats] = useState<DashboardStats>({\n    todayScans: 0,\n    totalVerified: 0,\n    pendingReviews: 0,\n    recentActivity: []\n  });\n  const [greeting, setGreeting] = useState('');\n  const scanHistoryRef = useRef<{ closeDetailModal: () => void } | null>(null);\n\n  useEffect(() => {\n    // Set greeting based on time\n    const hour = new Date().getHours();\n    if (hour < 12) setGreeting('Selamat pagi');\n    else if (hour < 17) setGreeting('Selamat siang');\n    else setGreeting('Selamat malam');\n\n    // Fetch dashboard stats\n    fetchDashboardStats();\n  }, []);\n\n  const fetchDashboardStats = async () => {\n    try {\n      const response = await fetch('/api/verifier/dashboard-stats');\n      if (response.ok) {\n        const data = await response.json();\n        setStats(data);\n      }\n    } catch (error) {\n      console.error('Error fetching dashboard stats:', error);\n    }\n  };\n\n  const handleQuickScan = () => {\n    if (scanHistoryRef.current?.closeDetailModal) {\n      scanHistoryRef.current.closeDetailModal();\n    }\n    setScannerOpen(true);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Mobile Header */}\n      <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg\">\n        <div className=\"px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            {/* Logo & Title */}\n            <div className=\"flex items-center\">\n              <div className=\"flex-shrink-0\">\n                <div className=\"w-8 h-8 bg-white rounded-lg flex items-center justify-center\">\n                  <QrCodeIcon className=\"w-5 h-5 text-blue-600\" />\n                </div>\n              </div>\n              <div className=\"ml-3\">\n                <h1 className=\"text-lg font-semibold text-white\">\n                  SIMLOK Verifier\n                </h1>\n              </div>\n            </div>\n\n            {/* Mobile Menu Button */}\n            <div className=\"md:hidden\">\n              <button\n                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n                className=\"text-white hover:text-blue-200 p-2\"\n              >\n                {mobileMenuOpen ? (\n                  <XMarkIcon className=\"w-6 h-6\" />\n                ) : (\n                  <Bars3Icon className=\"w-6 h-6\" />\n                )}\n              </button>\n            </div>\n\n            {/* Desktop Navigation */}\n            <div className=\"hidden md:flex items-center space-x-4\">\n              <div className=\"text-white text-sm\">\n                {session?.user?.officer_name}\n              </div>\n              <div className=\"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center\">\n                <UserIcon className=\"w-5 h-5 text-white\" />\n              </div>\n            </div>\n          </div>\n\n          {/* Mobile Menu Dropdown */}\n          {mobileMenuOpen && (\n            <div className=\"md:hidden bg-blue-700 border-t border-blue-600\">\n              <div className=\"px-4 py-3 space-y-2\">\n                <div className=\"text-white font-medium\">\n                  {session?.user?.officer_name}\n                </div>\n                <div className=\"text-blue-200 text-sm\">\n                  Verifier SIMLOK\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Greeting & Quick Stats */}\n      <div className=\"px-4 sm:px-6 lg:px-8 py-6\">\n        <div className=\"mb-6\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-1\">\n            {greeting}! 👋\n          </h2>\n          <p className=\"text-gray-600\">\n            Siap memverifikasi dokumen SIMLOK hari ini?\n          </p>\n        </div>\n\n        {/* Quick Stats Cards - Mobile Optimized */}\n        <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <div className=\"bg-white rounded-xl shadow-sm border p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <QrCodeIcon className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {stats.todayScans}\n                </div>\n                <div className=\"text-xs text-gray-500\">Scan Hari Ini</div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-xl shadow-sm border p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\n                <CheckCircleIcon className=\"w-5 h-5 text-green-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {stats.totalVerified}\n                </div>\n                <div className=\"text-xs text-gray-500\">Terverifikasi</div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-xl shadow-sm border p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center\">\n                <ExclamationTriangleIcon className=\"w-5 h-5 text-orange-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {stats.pendingReviews}\n                </div>\n                <div className=\"text-xs text-gray-500\">Menunggu</div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-xl shadow-sm border p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center\">\n                <ClockIcon className=\"w-5 h-5 text-purple-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {new Date().toLocaleTimeString('id-ID', { \n                    hour: '2-digit', \n                    minute: '2-digit' \n                  })}\n                </div>\n                <div className=\"text-xs text-gray-500\">Waktu Sekarang</div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Main Action - Mobile First */}\n        <div className=\"mb-6\">\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-6 text-white shadow-lg\">\n            <div className=\"text-center\">\n              <div className=\"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <CameraIcon className=\"w-8 h-8 text-white\" />\n              </div>\n              <h3 className=\"text-xl font-bold mb-2\">\n                Scan QR/Barcode\n              </h3>\n              <p className=\"text-blue-100 mb-6 text-sm\">\n                Scan dokumen SIMLOK untuk verifikasi cepat dan akurat\n              </p>\n              \n              <Button\n                onClick={handleQuickScan}\n                className=\"bg-white text-blue-600 hover:bg-gray-100 font-semibold py-3 px-8 rounded-xl shadow-md w-full sm:w-auto\"\n                size=\"lg\"\n              >\n                <CameraIcon className=\"w-5 h-5 mr-2\" />\n                Mulai Scan\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Quick Actions Grid - Mobile Optimized */}\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n          <button\n            onClick={() => window.location.href = '/verifier/submissions'}\n            className=\"bg-white p-4 rounded-xl shadow-sm border hover:shadow-md transition-shadow\"\n          >\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                <DocumentTextIcon className=\"w-6 h-6 text-indigo-600\" />\n              </div>\n              <div className=\"text-sm font-medium text-gray-900\">Daftar SIMLOK</div>\n            </div>\n          </button>\n\n          <button\n            onClick={() => window.location.href = '/verifier/history'}\n            className=\"bg-white p-4 rounded-xl shadow-sm border hover:shadow-md transition-shadow\"\n          >\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                <ClockIcon className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div className=\"text-sm font-medium text-gray-900\">Riwayat Scan</div>\n            </div>\n          </button>\n\n          <button\n            onClick={() => window.location.href = '/api/verifier/export'}\n            className=\"bg-white p-4 rounded-xl shadow-sm border hover:shadow-md transition-shadow\"\n          >\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                <DocumentTextIcon className=\"w-6 h-6 text-yellow-600\" />\n              </div>\n              <div className=\"text-sm font-medium text-gray-900\">Export Data</div>\n            </div>\n          </button>\n\n          <button\n            onClick={handleQuickScan}\n            className=\"bg-white p-4 rounded-xl shadow-sm border hover:shadow-md transition-shadow\"\n          >\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-2\">\n                <QrCodeIcon className=\"w-6 h-6 text-red-600\" />\n              </div>\n              <div className=\"text-sm font-medium text-gray-900\">Quick Scan</div>\n            </div>\n          </button>\n        </div>\n\n        {/* Recent Activity - Mobile Friendly */}\n        {stats.recentActivity.length > 0 && (\n          <div className=\"bg-white rounded-xl shadow-sm border mb-6\">\n            <div className=\"p-4 border-b border-gray-200\">\n              <div className=\"flex items-center\">\n                <BellIcon className=\"w-5 h-5 text-gray-400 mr-2\" />\n                <h3 className=\"text-lg font-semibold text-gray-900\">\n                  Aktivitas Terbaru\n                </h3>\n              </div>\n            </div>\n            <div className=\"p-4 space-y-3\">\n              {stats.recentActivity.slice(0, 5).map((activity) => (\n                <div key={activity.id} className=\"flex items-start space-x-3\">\n                  <div className={`w-2 h-2 rounded-full mt-2 ${\n                    activity.type === 'scan' ? 'bg-blue-500' :\n                    activity.type === 'verify' ? 'bg-green-500' : 'bg-orange-500'\n                  }`} />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm text-gray-900\">{activity.message}</p>\n                    <p className=\"text-xs text-gray-500\">\n                      {new Date(activity.timestamp).toLocaleString('id-ID')}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Scan History - Embedded */}\n        <div className=\"bg-white rounded-xl shadow-sm border\">\n          <div className=\"p-4 border-b border-gray-200\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Riwayat Scan Terakhir\n            </h3>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              5 scan terbaru Anda\n            </p>\n          </div>\n          <ScanHistory \n            ref={scanHistoryRef}\n            className=\"border-0 shadow-none bg-transparent\"\n          />\n        </div>\n      </div>\n\n      {/* Enhanced QR Code Scanner */}\n      <CameraQRScanner\n        isOpen={scannerOpen}\n        onClose={() => setScannerOpen(false)}\n        onScan={(result: string) => {\n          console.log('Barcode/QR Scanned in enhanced verifier:', result);\n          setScannerOpen(false);\n          // Refresh stats after successful scan\n          fetchDashboardStats();\n        }}\n        title=\"Scan QR/Barcode SIMLOK\"\n        description=\"Posisikan kamera pada QR code atau barcode untuk memverifikasi dokumen SIMLOK\"\n      />\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/verifier/SubmissionDetail.tsx",
      "lang": "tsx",
      "size": 18587,
      "lines": 534,
      "hash": "28066774eef643fdda0b59609976e31f07721823b9d24ace57a74aee8617a6c3",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon,\n  QrCodeIcon,\n  PrinterIcon,\n  ArrowLeftIcon,\n  UserIcon,\n  BuildingOfficeIcon,\n  MapPinIcon,\n  CalendarIcon,\n  DocumentTextIcon,\n  PhotoIcon\n} from '@heroicons/react/24/outline';\nimport { useToast } from '@/hooks/useToast';\nimport Button from '../ui/button/Button';\nimport Image from 'next/image';\nimport * as QRCode from 'qrcode';\n\ninterface Worker {\n  id: string;\n  worker_name: string;\n  worker_photo?: string | null;\n}\n\ninterface SubmissionData {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  approval_status: string; // Changed from union type to string\n  simlok_number?: string | null;\n  simlok_date?: Date | string | null;\n  created_at: Date | string;\n  qrcode?: string | null;\n  other_notes?: string | null;\n  rejection_reason?: string | null;\n  worker_list?: Worker[];\n}\n\ninterface SubmissionDetailProps {\n  submission: SubmissionData;\n}\n\nexport default function SubmissionDetail({ submission }: SubmissionDetailProps) {\n  const { showSuccess, showError } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [qrCodeDataUrl, setQrCodeDataUrl] = useState<string>('');\n\n  // Generate QR Code when needed\n  const generateQRCode = async () => {\n    if (submission.qrcode && !qrCodeDataUrl) {\n      try {\n        const dataUrl = await QRCode.toDataURL(submission.qrcode, {\n          width: 200,\n          margin: 2,\n          color: {\n            dark: '#000000',\n            light: '#FFFFFF'\n          }\n        });\n        setQrCodeDataUrl(dataUrl);\n      } catch (error) {\n        console.error('Error generating QR code:', error);\n      }\n    }\n  };\n\n  // Generate QR code when component mounts if QR code exists\n  useEffect(() => {\n    if (submission.qrcode) {\n      generateQRCode();\n    }\n  }, [submission.qrcode]);\n\n  const handleApprove = async () => {\n    if (!confirm('Apakah Anda yakin ingin menyetujui SIMLOK ini?')) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch(`/api/submissions/${submission.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          approval_status: 'APPROVED'\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Berhasil', 'SIMLOK telah disetujui');\n        window.location.reload();\n      } else {\n        const error = await response.json();\n        showError('Error', error.message || 'Gagal menyetujui SIMLOK');\n      }\n    } catch (error) {\n      console.error('Error approving submission:', error);\n      showError('Error', 'Gagal menyetujui SIMLOK');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleReject = async () => {\n    const reason = prompt('Masukkan alasan penolakan:');\n    if (!reason || !reason.trim()) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const response = await fetch(`/api/submissions/${submission.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          approval_status: 'REJECTED',\n          rejection_reason: reason.trim()\n        }),\n      });\n\n      if (response.ok) {\n        showSuccess('Berhasil', 'SIMLOK telah ditolak');\n        window.location.reload();\n      } else {\n        const error = await response.json();\n        showError('Error', error.message || 'Gagal menolak SIMLOK');\n      }\n    } catch (error) {\n      console.error('Error rejecting submission:', error);\n      showError('Error', 'Gagal menolak SIMLOK');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'APPROVED':\n        return (\n          <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800\">\n            <CheckCircleIcon className=\"w-4 h-4 mr-2\" />\n            Disetujui\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800\">\n            <XCircleIcon className=\"w-4 h-4 mr-2\" />\n            Ditolak\n          </span>\n        );\n      default:\n        return (\n          <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800\">\n            <ClockIcon className=\"w-4 h-4 mr-2\" />\n            Menunggu Verifikasi\n          </span>\n        );\n    }\n  };\n\n  const formatDate = (dateInput: string | Date) => {\n    const date = typeof dateInput === 'string' ? new Date(dateInput) : dateInput;\n    return date.toLocaleString('id-ID', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <Button\n            onClick={() => window.history.back()}\n            variant=\"outline\"\n            size=\"sm\"\n          >\n            <ArrowLeftIcon className=\"w-4 h-4 mr-2\" />\n            Kembali\n          </Button>\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">\n              {submission.simlok_number || `SIMLOK ${submission.id.slice(-8)}`}\n            </h1>\n            <p className=\"text-gray-600\">\n              Dibuat: {formatDate(submission.created_at)}\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center space-x-3\">\n          {getStatusBadge(submission.approval_status)}\n          \n          {submission.approval_status === 'APPROVED' && submission.qrcode && (\n            <Button\n              onClick={() => setShowQRCode(true)}\n              variant=\"outline\"\n            >\n              <QrCodeIcon className=\"w-4 h-4 mr-2\" />\n              QR Code\n            </Button>\n          )}\n          \n          <Button\n            onClick={() => window.print()}\n            variant=\"outline\"\n          >\n            <PrinterIcon className=\"w-4 h-4 mr-2\" />\n            Print\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Basic Information */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\n              Informasi Umum\n            </h2>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"flex items-start space-x-3\">\n                <BuildingOfficeIcon className=\"w-5 h-5 text-gray-400 mt-1\" />\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500\">\n                    Nama Vendor\n                  </p>\n                  <p className=\"text-sm text-gray-900\">\n                    {submission.vendor_name}\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start space-x-3\">\n                <UserIcon className=\"w-5 h-5 text-gray-400 mt-1\" />\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500\">\n                    Petugas\n                  </p>\n                  <p className=\"text-sm text-gray-900\">\n                    {submission.officer_name}\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start space-x-3\">\n                <MapPinIcon className=\"w-5 h-5 text-gray-400 mt-1\" />\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500\">\n                    Lokasi Kerja\n                  </p>\n                  <p className=\"text-sm text-gray-900\">\n                    {submission.work_location}\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start space-x-3\">\n                <CalendarIcon className=\"w-5 h-5 text-gray-400 mt-1\" />\n                <div>\n                  <p className=\"text-sm font-medium text-gray-500\">\n                    Pelaksanaan\n                  </p>\n                  <p className=\"text-sm text-gray-900\">\n                    {submission.implementation || 'Tidak ditentukan'}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Job Description */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n              <DocumentTextIcon className=\"w-5 h-5 mr-2\" />\n              Deskripsi Pekerjaan\n            </h2>\n            <p className=\"text-sm text-gray-700 whitespace-pre-wrap\">\n              {submission.job_description}\n            </p>\n          </div>\n\n          {/* Workers List */}\n          {submission.worker_list && submission.worker_list.length > 0 && (\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4 flex items-center\">\n                <UserIcon className=\"w-5 h-5 mr-2\" />\n                Daftar Pekerja ({submission.worker_list.length})\n              </h2>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {submission.worker_list.map((worker) => (\n                  <div key={worker.id} className=\"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg\">\n                    {worker.worker_photo ? (\n                      <Image\n                        src={worker.worker_photo}\n                        alt={worker.worker_name}\n                        width={40}\n                        height={40}\n                        className=\"rounded-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center\">\n                        <PhotoIcon className=\"w-5 h-5 text-gray-400\" />\n                      </div>\n                    )}\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {worker.worker_name}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}          {/* Rejection Reason */}\n          {submission.approval_status === 'REJECTED' && submission.rejection_reason && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\n              <h2 className=\"text-lg font-medium text-red-800 mb-2\">\n                Alasan Penolakan\n              </h2>\n              <p className=\"text-sm text-red-700\">\n                {submission.rejection_reason}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Actions */}\n          {submission.approval_status === 'PENDING' && (\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n                Aksi Verifikasi\n              </h3>\n              \n              <div className=\"space-y-3\">\n                <Button\n                  onClick={handleApprove}\n                  disabled={loading}\n                  className=\"w-full bg-green-600 hover:bg-green-700\"\n                >\n                  {loading ? (\n                    'Memproses...'\n                  ) : (\n                    <>\n                      <CheckCircleIcon className=\"w-4 h-4 mr-2\" />\n                      Setujui SIMLOK\n                    </>\n                  )}\n                </Button>\n                \n                <Button\n                  onClick={handleReject}\n                  disabled={loading}\n                  variant=\"outline\"\n                  className=\"w-full border-red-300 text-red-700 hover:bg-red-50\"\n                >\n                  <XCircleIcon className=\"w-4 h-4 mr-2\" />\n                  Tolak SIMLOK\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Status History */}\n          <div className=\"bg-white shadow rounded-lg p-6\">\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n              Riwayat Status\n            </h3>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex items-start space-x-3\">\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full mt-2\"></div>\n                <div>\n                  <p className=\"text-sm font-medium text-gray-900\">\n                    Submission Dibuat\n                  </p>\n                  <p className=\"text-xs text-gray-500\">\n                    {formatDate(submission.created_at)}\n                  </p>\n                </div>\n              </div>\n              \n              {submission.approval_status !== 'PENDING' && (\n                <div className=\"flex items-start space-x-3\">\n                  <div className={`w-2 h-2 rounded-full mt-2 ${\n                    submission.approval_status === 'APPROVED' ? 'bg-green-500' : 'bg-red-500'\n                  }`}></div>\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">\n                      {submission.approval_status === 'APPROVED' ? 'Disetujui' : 'Ditolak'}\n                    </p>\n                    <p className=\"text-xs text-gray-500\">\n                      {formatDate(submission.created_at)}\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* SIMLOK Info */}\n          {submission.approval_status === 'APPROVED' && (\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-6\">\n              <h3 className=\"text-lg font-medium text-green-800 mb-4\">\n                Informasi SIMLOK\n              </h3>\n              \n              <div className=\"space-y-2\">\n                <div>\n                  <p className=\"text-sm font-medium text-green-700\">\n                    Nomor SIMLOK\n                  </p>\n                  <p className=\"text-sm text-green-600\">\n                    {submission.simlok_number || 'Sedang diproses'}\n                  </p>\n                </div>\n                \n                {submission.simlok_date && (\n                  <div>\n                    <p className=\"text-sm font-medium text-green-700\">\n                      Tanggal SIMLOK\n                    </p>\n                    <p className=\"text-sm text-green-600\">\n                      {new Date(submission.simlok_date).toLocaleDateString('id-ID')}\n                    </p>\n                  </div>\n                )}\n\n                {/* QR Code untuk Print */}\n                {submission.qrcode && qrCodeDataUrl && (\n                  <div className=\"hidden print:block mt-6\">\n                    <p className=\"text-sm font-medium text-green-700 mb-2\">\n                      QR Code SIMLOK\n                    </p>\n                    <Image\n                      src={qrCodeDataUrl}\n                      alt=\"QR Code SIMLOK\"\n                      width={120}\n                      height={120}\n                      className=\"border border-gray-300 rounded\"\n                    />\n                    <p className=\"text-xs text-green-600 mt-1 break-all\">\n                      {submission.simlok_number}\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* QR Code Modal */}\n      {showQRCode && submission.qrcode && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\n            <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" onClick={() => setShowQRCode(false)}></div>\n            \n            <div className=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full\">\n              <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6\">\n                <div className=\"text-center\">\n                  <h3 className=\"text-lg leading-6 font-medium text-gray-900 mb-4\">\n                    QR Code SIMLOK\n                  </h3>\n                  \n                  <div className=\"bg-white p-4 rounded-lg inline-block\">\n                    {qrCodeDataUrl ? (\n                      <Image\n                        src={qrCodeDataUrl}\n                        alt=\"QR Code SIMLOK\"\n                        width={200}\n                        height={200}\n                        className=\"mx-auto\"\n                      />\n                    ) : submission.qrcode ? (\n                      <div className=\"w-[200px] h-[200px] flex items-center justify-center bg-gray-100 rounded\">\n                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\n                        <span className=\"ml-2 text-sm text-gray-600\">Generating QR...</span>\n                      </div>\n                    ) : (\n                      <div className=\"w-[200px] h-[200px] flex items-center justify-center bg-gray-100 rounded text-gray-500\">\n                        <QrCodeIcon className=\"h-16 w-16\" />\n                      </div>\n                    )}\n                  </div>\n                  \n                  <p className=\"text-sm text-gray-600 mt-2 break-all\">\n                    {submission.qrcode}\n                  </p>\n                  \n                  <p className=\"mt-4 text-sm text-gray-500\">\n                    {submission.simlok_number}\n                  </p>\n                  \n                  <div className=\"mt-6\">\n                    <Button\n                      onClick={() => setShowQRCode(false)}\n                      variant=\"outline\"\n                      className=\"w-full\"\n                    >\n                      Tutup\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"
    },
    {
      "path": "src/components/verifier/SubmissionsList.tsx",
      "lang": "tsx",
      "size": 13010,
      "lines": 367,
      "hash": "1bc3adace459d369889bcf32176948edfc37e44fbbaa27674d4a192e3502454f",
      "truncated": false,
      "content": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { \n  MagnifyingGlassIcon,\n  FunnelIcon,\n  EyeIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ClockIcon,\n  QrCodeIcon,\n  DocumentArrowDownIcon\n} from '@heroicons/react/24/outline';\nimport { useToast } from '@/hooks/useToast';\nimport Button from '../ui/button/Button';\nimport CameraQRScanner from '../scanner/CameraQRScanner';\n\ninterface SubmissionData {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation: string;\n  approval_status: 'PENDING' | 'APPROVED' | 'REJECTED';\n  simlok_number?: string;\n  simlok_date?: string;\n  created_at: string;\n}\n\ninterface FilterOptions {\n  status: 'ALL' | 'PENDING' | 'APPROVED' | 'REJECTED';\n  dateRange: 'ALL' | 'TODAY' | 'WEEK' | 'MONTH';\n  search: string;\n}\n\nexport default function SubmissionsList() {\n  const { showError } = useToast();\n  \n  const [submissions, setSubmissions] = useState<SubmissionData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [scannerOpen, setScannerOpen] = useState(false);\n  const [filters, setFilters] = useState<FilterOptions>({\n    status: 'ALL',\n    dateRange: 'ALL',\n    search: ''\n  });\n  const [pagination, setPagination] = useState({\n    total: 0,\n    limit: 20,\n    offset: 0,\n    hasMore: true\n  });\n\n  useEffect(() => {\n    fetchSubmissions();\n  }, [filters, pagination.offset]);\n\n  const fetchSubmissions = async () => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams({\n        limit: pagination.limit.toString(),\n        offset: pagination.offset.toString(),\n        status: filters.status,\n        dateRange: filters.dateRange,\n        search: filters.search\n      });\n\n      const response = await fetch(`/api/verifier/submissions?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        setSubmissions(data.submissions || []);\n        setPagination(prev => ({\n          ...prev,\n          total: data.pagination?.total || 0,\n          hasMore: data.pagination?.hasMore || false\n        }));\n      } else {\n        showError('Error', 'Gagal memuat data submissions');\n      }\n    } catch (error) {\n      console.error('Error fetching submissions:', error);\n      showError('Error', 'Gagal memuat data submissions');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFilterChange = (newFilters: Partial<FilterOptions>) => {\n    setFilters(prev => ({ ...prev, ...newFilters }));\n    setPagination(prev => ({ ...prev, offset: 0 }));\n  };\n\n  const handleScanResult = async (scannedData: string) => {\n    try {\n      setScannerOpen(false);\n      \n      // Extract submission ID from QR code data\n      let submissionId = scannedData;\n      \n      if (scannedData.startsWith('{')) {\n        try {\n          const qrData = JSON.parse(scannedData);\n          submissionId = qrData.submissionId || qrData.id || scannedData;\n        } catch (e) {\n          // If parsing fails, use the raw data\n        }\n      }\n\n      // Navigate to submission detail\n      window.location.href = `/verifier/submissions/${submissionId}`;\n      \n    } catch (error) {\n      console.error('Error processing barcode:', error);\n      showError('Error', 'Gagal memproses QR Code');\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'APPROVED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n            <CheckCircleIcon className=\"w-3 h-3 mr-1\" />\n            Disetujui\n          </span>\n        );\n      case 'REJECTED':\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\n            <XCircleIcon className=\"w-3 h-3 mr-1\" />\n            Ditolak\n          </span>\n        );\n      default:\n        return (\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n            <ClockIcon className=\"w-3 h-3 mr-1\" />\n            Pending\n          </span>\n        );\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('id-ID', {\n      day: 'numeric',\n      month: 'short',\n      year: 'numeric'\n    });\n  };\n\n  const loadMore = () => {\n    setPagination(prev => ({\n      ...prev,\n      offset: prev.offset + prev.limit\n    }));\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">\n            Daftar SIMLOK\n          </h1>\n          <p className=\"text-gray-600\">\n            Total: {pagination.total.toLocaleString()} submissions\n          </p>\n        </div>\n        \n        <div className=\"flex space-x-3\">\n          <Button\n            onClick={() => setScannerOpen(true)}\n            className=\"bg-blue-600 hover:bg-blue-700\"\n          >\n            <QrCodeIcon className=\"w-4 h-4 mr-2\" />\n            Scan QR\n          </Button>\n          \n          <Button\n            onClick={() => window.location.href = '/api/verifier/export'}\n            variant=\"outline\"\n          >\n            <DocumentArrowDownIcon className=\"w-4 h-4 mr-2\" />\n            Export\n          </Button>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {/* Search */}\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Pencarian\n            </label>\n            <div className=\"relative\">\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400\" />\n              </div>\n              <input\n                type=\"text\"\n                value={filters.search}\n                onChange={(e) => handleFilterChange({ search: e.target.value })}\n                className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"Cari nomor SIMLOK, vendor, atau deskripsi...\"\n              />\n            </div>\n          </div>\n\n          {/* Status Filter */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Status\n            </label>\n            <select\n              value={filters.status}\n              onChange={(e) => handleFilterChange({ status: e.target.value as FilterOptions['status'] })}\n              className=\"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"ALL\">Semua Status</option>\n              <option value=\"PENDING\">Pending</option>\n              <option value=\"APPROVED\">Disetujui</option>\n              <option value=\"REJECTED\">Ditolak</option>\n            </select>\n          </div>\n\n          {/* Date Range Filter */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Periode\n            </label>\n            <select\n              value={filters.dateRange}\n              onChange={(e) => handleFilterChange({ dateRange: e.target.value as FilterOptions['dateRange'] })}\n              className=\"block w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"ALL\">Semua Periode</option>\n              <option value=\"TODAY\">Hari Ini</option>\n              <option value=\"WEEK\">Minggu Ini</option>\n              <option value=\"MONTH\">Bulan Ini</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Submissions List */}\n      <div className=\"bg-white shadow rounded-lg\">\n        {loading && pagination.offset === 0 ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n          </div>\n        ) : submissions.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <FunnelIcon className=\"mx-auto h-12 w-12 text-gray-400\" />\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\n              Tidak ada submissions\n            </h3>\n            <p className=\"mt-1 text-sm text-gray-500\">\n              Tidak ada submissions yang sesuai dengan filter yang dipilih.\n            </p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    SIMLOK\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Vendor\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Pekerjaan\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Tanggal\n                  </th>\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    Aksi\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {submissions.map((submission) => (\n                  <tr key={submission.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div>\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {submission.simlok_number || 'Belum ada nomor'}\n                        </div>\n                        <div className=\"text-sm text-gray-500\">\n                          {submission.officer_name}\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-900\">\n                        {submission.vendor_name}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {submission.work_location}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"text-sm text-gray-900 max-w-xs truncate\">\n                        {submission.job_description}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      {getStatusBadge(submission.approval_status)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                      {formatDate(submission.created_at)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                      <Button\n                        onClick={() => window.location.href = `/verifier/submissions/${submission.id}`}\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        <EyeIcon className=\"w-4 h-4 mr-1\" />\n                        Detail\n                      </Button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n\n        {/* Load More */}\n        {pagination.hasMore && submissions.length > 0 && (\n          <div className=\"px-6 py-4 border-t border-gray-200\">\n            <Button\n              onClick={loadMore}\n              disabled={loading}\n              variant=\"outline\"\n              className=\"w-full\"\n            >\n              {loading ? 'Memuat...' : 'Muat Lebih Banyak'}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {/* QR Code Scanner */}\n      {scannerOpen && (\n        <CameraQRScanner\n          isOpen={scannerOpen}\n          onClose={() => setScannerOpen(false)}\n          onScan={handleScanResult}\n        />\n      )}\n    </div>\n  );\n}\n"
    },
    {
      "path": "src/context/ThemeContext.tsx",
      "lang": "tsx",
      "size": 1759,
      "lines": 68,
      "hash": "2152c49b0ee12319d031b1641a014b482c842b75e4d579091ab1acb39b82ae0a",
      "truncated": false,
      "content": "\"use client\";\n\nimport type React from \"react\";\nimport { createContext, useState, useContext, useEffect } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeContextType = {\n  theme: Theme;\n  toggleTheme: () => void;\n};\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({\n  children,\n}) => {\n  const [theme, setTheme] = useState<Theme>(\"light\");\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  useEffect(() => {\n    // This code will only run on the client side\n    const savedTheme = localStorage.getItem(\"theme\") as Theme | null;\n    const initialTheme = savedTheme || \"light\"; // Default to light theme\n\n    setTheme(initialTheme);\n    setIsInitialized(true);\n  }, []);\n\n  useEffect(() => {\n    if (isInitialized) {\n      localStorage.setItem(\"theme\", theme);\n      if (theme === \"dark\") {\n        document.documentElement.classList.add(\"dark\");\n      } else {\n        document.documentElement.classList.remove(\"dark\");\n      }\n    }\n  }, [theme, isInitialized]);\n\n  const toggleTheme = () => {\n    setTheme((prevTheme) => (prevTheme === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  // Prevent hydration mismatch by not rendering until client-side\n  if (!isInitialized) {\n    return (\n      <ThemeContext.Provider value={{ theme: \"light\", toggleTheme }}>\n        {children}\n      </ThemeContext.Provider>\n    );\n  }\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n};\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n};\n"
    },
    {
      "path": "src/hooks/useModal.ts",
      "lang": "ts",
      "size": 265,
      "lines": 14,
      "hash": "a488af8a519972edf54648406b1854622ca4ca32d9111f387e4f50f920db5f7f",
      "truncated": false,
      "content": "import { useState } from 'react';\n\nexport const useModal = () => {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const openModal = () => setIsOpen(true);\n  const closeModal = () => setIsOpen(false);\n\n  return {\n    isOpen,\n    openModal,\n    closeModal,\n  };\n};"
    },
    {
      "path": "src/hooks/useRealTimeNotifications.ts",
      "lang": "ts",
      "size": 4618,
      "lines": 149,
      "hash": "ca6c2bb36befb6af2f6b34d04b8df16c48ce09600c2a9934fb74e628941851d5",
      "truncated": false,
      "content": "import { useEffect, useRef } from 'react';\nimport { useSession } from 'next-auth/react';\nimport { useNotificationsStore } from '@/store/notifications';\n\ninterface SSEMessage {\n  type: string;\n  data?: any;\n  message?: string;\n  timestamp?: string;\n}\n\nexport function useRealTimeNotifications() {\n  const { data: session } = useSession();\n  const eventSourceRef = useRef<EventSource | null>(null);\n  const { addItem, setUnreadCount, removeNotifications } = useNotificationsStore();\n\n  useEffect(() => {\n    if (!session?.user) {\n      // Clean up EventSource if user logs out\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n      return;\n    }\n\n    // Skip real-time notifications for verifiers\n    if (session.user.role === 'VERIFIER') {\n      return;\n    }\n\n    // Don't create multiple connections\n    if (eventSourceRef.current) {\n      return;\n    }\n\n    // Determine scope based on user role\n    let scope: string;\n    if (session.user.role === 'ADMIN' || session.user.role === 'SUPER_ADMIN') {\n      scope = 'admin';\n    } else if (session.user.role === 'REVIEWER') {\n      scope = 'reviewer';\n    } else if (session.user.role === 'APPROVER') {\n      scope = 'approver';\n    } else {\n      scope = 'vendor';\n    }\n\n    const params = new URLSearchParams({ scope });\n    \n    if (scope === 'vendor' && session.user.id) {\n      params.append('vendorId', session.user.id);\n    }\n\n    console.log('Establishing SSE connection for notifications...');\n    \n    const eventSource = new EventSource(`/api/notifications/stream?${params.toString()}`);\n    eventSourceRef.current = eventSource;\n\n    eventSource.onopen = () => {\n      console.log('SSE connection opened');\n    };\n\n    eventSource.onmessage = (event) => {\n      try {\n        const message: SSEMessage = JSON.parse(event.data);\n        console.log('SSE message received:', message);\n\n        switch (message.type) {\n          case 'connected':\n            console.log('Real-time notifications connected:', message.message);\n            break;\n\n          case 'notification:new':\n            if (message.data) {\n              console.log('New notification via SSE:', message.data);\n              \n              // Add notification to store with proper data\n              addItem({\n                id: message.data.id,\n                type: message.data.type || 'notification', // Use actual notification type\n                title: message.data.title,\n                message: message.data.message,\n                data: message.data.data || null, // Preserve the data field from server\n                createdAt: message.data.createdAt,\n                isRead: false\n              });\n            }\n            break;\n\n          case 'notification:unread_count':\n            if (message.data?.unreadCount !== undefined) {\n              console.log('Unread count update via SSE:', message.data.unreadCount);\n              setUnreadCount(message.data.unreadCount);\n            }\n            break;\n\n          case 'notification:removed':\n            if (message.data?.submissionId) {\n              console.log('Notification removal via SSE for submission:', message.data.submissionId);\n              removeNotifications(message.data.submissionId);\n            }\n            break;\n\n          case 'stats:update':\n            console.log('Stats update via SSE:', message.data);\n            // You can emit this to stats store if needed\n            break;\n\n          case 'heartbeat':\n            // Keep-alive message, no action needed\n            break;\n\n          default:\n            console.log('Unknown SSE message type:', message.type);\n        }\n      } catch (error) {\n        console.error('Error parsing SSE message:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('SSE connection error:', error);\n      \n      // Automatic reconnection will be handled by the browser\n      // but we can add custom logic here if needed\n      \n      if (eventSource.readyState === EventSource.CLOSED) {\n        console.log('SSE connection closed');\n        eventSourceRef.current = null;\n      }\n    };\n\n    // Cleanup on unmount\n    return () => {\n      if (eventSourceRef.current) {\n        console.log('Closing SSE connection');\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n    };\n  }, [session, addItem, setUnreadCount, removeNotifications]);\n\n  return {\n    isConnected: typeof window !== 'undefined' && eventSourceRef.current?.readyState === EventSource.OPEN,\n    eventSource: eventSourceRef.current\n  };\n}\n"
    },
    {
      "path": "src/hooks/useToast.ts",
      "lang": "ts",
      "size": 1182,
      "lines": 47,
      "hash": "0adc44194e721d71de907289b99da8d7d07d9f3b8f1f7b019cffae4b2997088d",
      "truncated": false,
      "content": "'use client';\n\ninterface ToastOptions {\n  variant: 'success' | 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  duration?: number;\n}\n\ndeclare global {\n  interface Window {\n    showToast?: (toast: ToastOptions) => void;\n  }\n}\n\nexport function useToast() {\n  const showToast = (toast: ToastOptions) => {\n    if (typeof window !== 'undefined' && window.showToast) {\n      window.showToast(toast);\n    }\n  };\n\n  const showSuccess = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'success', title, message, duration: duration || 5000 });\n  };\n\n  const showError = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'error', title, message, duration: duration || 5000 });\n  };\n\n  const showWarning = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'warning', title, message, duration: duration || 5000 });\n  };\n\n  const showInfo = (title: string, message: string, duration?: number) => {\n    showToast({ variant: 'info', title, message, duration: duration || 5000 });\n  };\n\n  return {\n    showToast,\n    showSuccess,\n    showError,\n    showWarning,\n    showInfo\n  };\n}\n"
    },
    {
      "path": "src/lib/api-utils.ts",
      "lang": "ts",
      "size": 3970,
      "lines": 151,
      "hash": "b6353de8a06d67f550c76208859f324334531382a9b83dbd49a917bd2b54400f",
      "truncated": false,
      "content": "/**\n * Common utilities for API route handlers\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\nimport { ZodError, ZodSchema } from 'zod';\nimport type { ApiError, ApiSuccess } from '@/shared/dto';\n\n/**\n * Standard API response helpers\n */\nexport function apiError(\n  message: string, \n  status: number = 400, \n  code?: string\n): NextResponse<ApiError> {\n  return NextResponse.json(\n    {\n      error: 'API Error',\n      message,\n      ...(code && { code }),\n    },\n    { status }\n  );\n}\n\nexport function apiSuccess<T = any>(\n  data?: T, \n  message?: string,\n  status: number = 200\n): NextResponse<ApiSuccess> {\n  return NextResponse.json(\n    {\n      success: true,\n      ...(data !== undefined && { data }),\n      ...(message && { message }),\n    },\n    { status }\n  );\n}\n\n/**\n * Validate request body with Zod schema\n */\nexport async function validateRequestBody<T>(\n  request: NextRequest,\n  schema: ZodSchema<T>\n): Promise<{ data: T; error?: never } | { data?: never; error: string }> {\n  try {\n    const body = await request.json();\n    const data = schema.parse(body);\n    return { data };\n  } catch (error) {\n    if (error instanceof ZodError) {\n      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);\n      return { error: `Validation failed: ${messages.join(', ')}` };\n    }\n    return { error: 'Invalid JSON body' };\n  }\n}\n\n/**\n * Validate query parameters with Zod schema\n */\nexport function validateQueryParams<T>(\n  request: NextRequest,\n  schema: ZodSchema<T>\n): { data: T; error?: never } | { data?: never; error: string } {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const params = Object.fromEntries(searchParams.entries());\n    const data = schema.parse(params);\n    return { data };\n  } catch (error) {\n    if (error instanceof ZodError) {\n      const messages = error.issues.map((e: any) => `${e.path.join('.')}: ${e.message}`);\n      return { error: `Validation failed: ${messages.join(', ')}` };\n    }\n    return { error: 'Invalid query parameters' };\n  }\n}\n\n/**\n * Get authenticated session with role checking\n */\nexport async function getAuthenticatedSession(\n  allowedRoles?: string[]\n): Promise<\n  | { session: any; error?: never }\n  | { session?: never; error: NextResponse }\n> {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user) {\n      return { error: apiError('Authentication required', 401) };\n    }\n\n    if (allowedRoles && !allowedRoles.includes(session.user.role)) {\n      return { error: apiError('Insufficient permissions', 403) };\n    }\n\n    return { session };\n  } catch (error) {\n    console.error('Auth error:', error);\n    return { error: apiError('Authentication failed', 401) };\n  }\n}\n\n/**\n * Safe async route handler wrapper\n */\nexport function withErrorHandling<T extends any[]>(\n  handler: (...args: T) => Promise<NextResponse>\n) {\n  return async (...args: T): Promise<NextResponse> => {\n    try {\n      return await handler(...args);\n    } catch (error) {\n      console.error('API route error:', error);\n      \n      if (error instanceof Error) {\n        return apiError(error.message, 500);\n      }\n      \n      return apiError('Internal server error', 500);\n    }\n  };\n}\n\n/**\n * CORS headers for API routes\n */\nexport function addCorsHeaders(response: NextResponse): NextResponse {\n  response.headers.set('Access-Control-Allow-Origin', process.env.NEXTAUTH_URL || '*');\n  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n  response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  response.headers.set('Access-Control-Max-Age', '86400');\n  return response;\n}\n\n/**\n * Handle OPTIONS requests for CORS\n */\nexport function handleOptions(): NextResponse {\n  const response = new NextResponse(null, { status: 200 });\n  return addCorsHeaders(response);\n}\n"
    },
    {
      "path": "src/lib/auth.ts",
      "lang": "ts",
      "size": 5372,
      "lines": 153,
      "hash": "4defbf2016971f0fd7d07f3978159581aac24b0dae843f27b50a65e511ac8873",
      "truncated": false,
      "content": "// app/lib/auth.ts\nimport Credentials from \"next-auth/providers/credentials\";\nimport { prisma } from \"./singletons\";\nimport bcrypt from \"bcryptjs\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport { JWT_CONFIG } from \"@/utils/jwt-config\";\n\nexport const authOptions: NextAuthOptions = {\n  secret: process.env.NEXTAUTH_SECRET || 'fallback-secret-for-development',\n  debug: process.env.NODE_ENV === 'development',\n  logger: {\n    error(code, metadata) {\n      if (code === 'JWT_SESSION_ERROR') {\n        console.log('JWT Session Error - clearing invalid token');\n        // Don't log the full error in production\n        return;\n      }\n      console.error('NextAuth Error:', code, metadata);\n    },\n    warn(code) {\n      console.warn('NextAuth Warning:', code);\n    },\n  },\n  providers: [\n    Credentials({\n      credentials: { email: {}, password: {} },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n\n        const user = await prisma.user.findUnique({\n          where: { email: credentials.email },\n        });\n        if (!user || !user.password) return null;\n\n        const ok = await bcrypt.compare(credentials.password, user.password);\n        if (!ok) return null;\n\n        console.log('Auth authorize - returning user:', { \n          id: user.id, \n          email: user.email, \n          role: user.role \n        }); // Debug log\n\n        // return the minimal shape Next-Auth expects\n        return {\n          id: user.id,\n          role: user.role,\n          name: user.officer_name,\n          email: user.email || null,\n          officer_name: user.officer_name,\n          vendor_name: user.vendor_name,\n          verified_at: user.verified_at,\n          created_at: user.created_at,\n        };\n      },\n    }),\n  ],\n  session: { \n    strategy: \"jwt\",\n    // Session expires after configured time (default: 6 hours)\n    maxAge: JWT_CONFIG.SESSION_MAX_AGE,\n    // Update age extends session by this amount each time user is active\n    updateAge: JWT_CONFIG.SESSION_UPDATE_AGE,\n  },\n  jwt: {\n    // JWT expires after configured time (default: 6 hours)\n    maxAge: JWT_CONFIG.JWT_EXPIRE_TIME,\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      try {\n        // Check if token is expired\n        const now = Date.now() / 1000; // Current time in seconds\n      \n      // user only exists on first sign-in, but we need to refresh verification status\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n        token.officer_name = user.officer_name;\n        token.vendor_name = user.vendor_name || null;\n        token.verified_at = user.verified_at || null;\n        if (user.created_at) {\n          token.created_at = user.created_at;\n        }\n        // Set issued at time and expiry using configured values\n        token.iat = now;\n        token.exp = now + JWT_CONFIG.JWT_EXPIRE_TIME;\n        console.log('JWT callback - storing user.id:', user.id);\n        console.log('JWT callback - token expires at:', new Date((now + JWT_CONFIG.JWT_EXPIRE_TIME) * 1000));\n      } else if (token.id) {\n        // Check if token is expired\n        if (token.exp && typeof token.exp === 'number') {\n          const now = Date.now() / 1000;\n          if (now >= token.exp) {\n            console.log('JWT callback - token expired, clearing session');\n            return {}; // Return empty object to clear token\n          }\n        }\n        \n        // Refresh user data from database to get latest verification status\n        try {\n          const latestUser = await prisma.user.findUnique({\n            where: { id: token.id as string },\n            select: { verified_at: true, role: true }\n          });\n          \n          if (latestUser) {\n            token.verified_at = latestUser.verified_at;\n            console.log('JWT callback - refreshed verified_at:', latestUser.verified_at);\n          }\n        } catch (error) {\n          console.error('Error refreshing user verification status:', error);\n        }\n      }\n      return token;\n      } catch (error) {\n        console.error('JWT callback error:', error);\n        // Return empty token on error to force re-authentication\n        return {};\n      }\n    },\n    async session({ session, token }) {\n      if (token) {\n        session.user.id   = token.id as string; // Use the stored user.id instead of token.sub\n        session.user.role = token.role as import(\"@prisma/client\").Role;\n        session.user.officer_name = token.officer_name as string;\n        session.user.vendor_name = token.vendor_name as string | null;\n        session.user.verified_at = token.verified_at as Date | null;\n        session.user.created_at = token.created_at as Date;\n        console.log('Session callback - session.user.id:', session.user.id); // Debug log\n      }\n      return session;\n    },\n  },\n  events: {\n    async signIn({ user }) {\n      console.log(`User ${user.email} signed in at ${new Date()}`);\n    },\n    async signOut() {\n      console.log(`User signed out at ${new Date()}`);\n    },\n    async session({ token }) {\n      // Called whenever a session is checked\n      if (token.exp && typeof token.exp === 'number') {\n        const now = Date.now() / 1000;\n        if (now >= token.exp) {\n          console.log('Session expired, will be cleared');\n        }\n      }\n    }\n  },\n  pages: { signIn: \"/login\" },\n};"
    },
    {
      "path": "src/lib/cache.ts",
      "lang": "ts",
      "size": 4801,
      "lines": 194,
      "hash": "7662cf99cd44a6658ce3cb9bade728606af6041071c48cf60923862a07c3630b",
      "truncated": false,
      "content": "/**\n * Redis Cache Helper with namespacing and TTL support\n */\n\nimport { redisPub as redis } from './singletons';\n\nconst CACHE_PREFIX = 'app:v1';\n\ninterface CacheOptions {\n  ttl?: number; // TTL in seconds\n  namespace?: string;\n}\n\nexport class Cache {\n  private static getKey(key: string, namespace?: string): string {\n    const ns = namespace ? `:${namespace}` : '';\n    return `${CACHE_PREFIX}${ns}:${key}`;\n  }\n\n  /**\n   * Get JSON value from cache\n   */\n  static async getJSON<T = any>(key: string, options: CacheOptions = {}): Promise<T | null> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const value = await redis.get(fullKey);\n      return value ? JSON.parse(value) : null;\n    } catch (error) {\n      console.warn('Cache.getJSON error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Set JSON value in cache with optional TTL\n   */\n  static async setJSON(\n    key: string, \n    value: any, \n    options: CacheOptions = {}\n  ): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const serialized = JSON.stringify(value);\n      \n      if (options.ttl) {\n        await redis.setex(fullKey, options.ttl, serialized);\n      } else {\n        await redis.set(fullKey, serialized);\n      }\n      \n      return true;\n    } catch (error) {\n      console.warn('Cache.setJSON error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get string value from cache\n   */\n  static async get(key: string, options: CacheOptions = {}): Promise<string | null> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      return await redis.get(fullKey);\n    } catch (error) {\n      console.warn('Cache.get error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Set string value in cache with optional TTL\n   */\n  static async set(\n    key: string, \n    value: string, \n    options: CacheOptions = {}\n  ): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      \n      if (options.ttl) {\n        await redis.setex(fullKey, options.ttl, value);\n      } else {\n        await redis.set(fullKey, value);\n      }\n      \n      return true;\n    } catch (error) {\n      console.warn('Cache.set error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Delete a key from cache\n   */\n  static async del(key: string, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      await redis.del(fullKey);\n      return true;\n    } catch (error) {\n      console.warn('Cache.del error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Invalidate cache by prefix pattern\n   */\n  static async invalidateByPrefix(prefix: string, namespace?: string): Promise<number> {\n    try {\n      const pattern = this.getKey(`${prefix}*`, namespace);\n      const keys = await redis.keys(pattern);\n      \n      if (keys.length === 0) return 0;\n      \n      await redis.del(...keys);\n      return keys.length;\n    } catch (error) {\n      console.warn('Cache.invalidateByPrefix error:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Check if key exists\n   */\n  static async exists(key: string, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.exists(fullKey);\n      return result === 1;\n    } catch (error) {\n      console.warn('Cache.exists error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Increment a numeric value\n   */\n  static async incr(key: string, options: CacheOptions = {}): Promise<number> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.incr(fullKey);\n      \n      // Set TTL if specified and this is a new key\n      if (options.ttl && result === 1) {\n        await redis.expire(fullKey, options.ttl);\n      }\n      \n      return result;\n    } catch (error) {\n      console.warn('Cache.incr error:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Set TTL for existing key\n   */\n  static async expire(key: string, ttl: number, options: CacheOptions = {}): Promise<boolean> {\n    try {\n      const fullKey = this.getKey(key, options.namespace);\n      const result = await redis.expire(fullKey, ttl);\n      return result === 1;\n    } catch (error) {\n      console.warn('Cache.expire error:', error);\n      return false;\n    }\n  }\n}\n\n// Predefined namespaces for different features\nexport const CacheNamespaces = {\n  STATS: 'stats',\n  NOTIFICATIONS: 'notifications',\n  SUBMISSIONS: 'submissions',\n  VENDORS: 'vendors',\n  AUTH: 'auth',\n} as const;\n\n// Common TTL values (in seconds)\nexport const CacheTTL = {\n  SHORT: 60,      // 1 minute\n  MEDIUM: 300,    // 5 minutes\n  LONG: 900,      // 15 minutes\n  HOUR: 3600,     // 1 hour\n  DAY: 86400,     // 24 hours\n} as const;\n"
    },
    {
      "path": "src/lib/cleanup-orphaned-notifications.ts",
      "lang": "ts",
      "size": 3336,
      "lines": 114,
      "hash": "68a13b02b6fe53a49b1fb52290a6bcbbfdb67cdb777c644adb2856aaec807e5f",
      "truncated": false,
      "content": "/**\n * Utility script to clean up orphaned notifications\n * These are notifications that reference submissions that no longer exist\n */\n\nimport { prisma } from '@/lib/singletons';\n\nexport async function cleanupOrphanedNotifications() {\n  console.log('Starting cleanup of orphaned notifications...');\n  \n  try {\n    // Get all notifications that have data field\n    const notificationsWithData = await prisma.notification.findMany({\n      where: {\n        data: {\n          not: null\n        }\n      }\n    });\n\n    console.log(`Found ${notificationsWithData.length} notifications with data to check`);\n\n    const orphanedNotifications = [];\n\n    // Check each notification to see if it references a valid submission\n    for (const notification of notificationsWithData) {\n      if (!notification.data) continue;\n\n      try {\n        const data = JSON.parse(notification.data);\n        \n        // Check if notification contains submissionId\n        if (data.submissionId) {\n          // Verify that the submission still exists\n          const submissionExists = await prisma.submission.findUnique({\n            where: { id: data.submissionId },\n            select: { id: true }\n          });\n\n          if (!submissionExists) {\n            orphanedNotifications.push({\n              id: notification.id,\n              submissionId: data.submissionId,\n              type: notification.type,\n              title: notification.title,\n              createdAt: notification.created_at\n            });\n          }\n        }\n      } catch (error) {\n        console.warn(`Failed to parse notification data for notification ${notification.id}:`, error);\n      }\n    }\n\n    console.log(`Found ${orphanedNotifications.length} orphaned notifications`);\n\n    if (orphanedNotifications.length > 0) {\n      console.log('Orphaned notifications:');\n      orphanedNotifications.forEach(notif => {\n        console.log(`- ${notif.id}: ${notif.title} (submission: ${notif.submissionId})`);\n      });\n\n      // Delete NotificationRead records first\n      const notificationIds = orphanedNotifications.map(n => n.id);\n      \n      const deletedReads = await prisma.notificationRead.deleteMany({\n        where: {\n          notification_id: {\n            in: notificationIds\n          }\n        }\n      });\n\n      console.log(`Deleted ${deletedReads.count} notification read records`);\n\n      // Delete the orphaned notifications\n      const deletedNotifications = await prisma.notification.deleteMany({\n        where: {\n          id: {\n            in: notificationIds\n          }\n        }\n      });\n\n      console.log(`Deleted ${deletedNotifications.count} orphaned notifications`);\n    } else {\n      console.log('No orphaned notifications found');\n    }\n\n    return {\n      checked: notificationsWithData.length,\n      orphaned: orphanedNotifications.length,\n      cleaned: orphanedNotifications.length\n    };\n\n  } catch (error) {\n    console.error('Error during cleanup:', error);\n    throw error;\n  }\n}\n\n// If this script is run directly (e.g., node cleanup-orphaned-notifications.js)\nif (require.main === module) {\n  cleanupOrphanedNotifications()\n    .then((result) => {\n      console.log('Cleanup completed:', result);\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('Cleanup failed:', error);\n      process.exit(1);\n    });\n}\n"
    },
    {
      "path": "src/lib/db.ts",
      "lang": "ts",
      "size": 3005,
      "lines": 122,
      "hash": "94e9415ef0d4d030d473932269d9784c5d61122128a2c958033ae6908f84d537",
      "truncated": false,
      "content": "import { PrismaClient } from '@prisma/client';\n\nimport { config } from '@/lib/env';\n\n/**\n * Global variable for Prisma client to prevent multiple instances in development\n */\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\n/**\n * Database client configuration\n */\nconst createPrismaClient = () =>\n  new PrismaClient({\n    log: config.isDevelopment ? ['query', 'error', 'warn'] : ['error'],\n    datasources: {\n      db: {\n        url: config.database.url,\n      },\n    },\n  });\n\n/**\n * Prisma client instance\n * Uses global variable in development to prevent multiple instances during hot reload\n */\nexport const db = globalThis.__prisma ?? createPrismaClient();\n\nif (config.isDevelopment) {\n  globalThis.__prisma = db;\n}\n\n/**\n * Database connection utilities\n */\nexport const dbUtils = {\n  /**\n   * Test database connection\n   */\n  async testConnection(): Promise<boolean> {\n    try {\n      await db.$queryRaw`SELECT 1`;\n      return true;\n    } catch (error) {\n      console.error('Database connection failed:', error);\n      return false;\n    }\n  },\n\n  /**\n   * Gracefully disconnect from database\n   */\n  async disconnect(): Promise<void> {\n    await db.$disconnect();\n  },\n\n  /**\n   * Execute database transaction\n   */\n  async transaction<T>(\n    fn: (prisma: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use' | '$extends'>) => Promise<T>\n  ): Promise<T> {\n    try {\n      return await db.$transaction(fn);\n    } catch (error) {\n      console.error('Transaction error:', error);\n      throw new DatabaseError(\n        'Transaction failed',\n        error instanceof Error ? error.message : 'Unknown error'\n      );\n    }\n  },\n} as const;\n\n/**\n * Type helpers for Prisma\n */\nexport type DbTransaction = Parameters<Parameters<typeof db.$transaction>[0]>[0];\n\n/**\n * Database error handling\n */\nexport class DatabaseError extends Error {\n  constructor(\n    message: string,\n    public code?: string,\n    public meta?: unknown\n  ) {\n    super(message);\n    this.name = 'DatabaseError';\n  }\n}\n\n/**\n * Handle Prisma errors and convert to user-friendly messages\n */\nexport function handleDatabaseError(error: unknown): never {\n  if (error instanceof Error) {\n    // Prisma specific errors\n    if ('code' in error) {\n      const prismaError = error as { code: string; meta?: unknown };\n      \n      switch (prismaError.code) {\n        case 'P2002':\n          throw new DatabaseError('A record with this information already exists', prismaError.code, prismaError.meta);\n        case 'P2025':\n          throw new DatabaseError('Record not found', prismaError.code, prismaError.meta);\n        case 'P2003':\n          throw new DatabaseError('Invalid reference to related record', prismaError.code, prismaError.meta);\n        default:\n          throw new DatabaseError('Database operation failed', prismaError.code, prismaError.meta);\n      }\n    }\n    \n    throw new DatabaseError(error.message);\n  }\n  \n  throw new DatabaseError('Unknown database error occurred');\n}\n"
    },
    {
      "path": "src/lib/env.ts",
      "lang": "ts",
      "size": 1834,
      "lines": 75,
      "hash": "6e09d5b0347990ed7ffc179d832976af85b5a57d509b765ee83ac5dc04e3b733",
      "truncated": false,
      "content": "import { z } from 'zod';\n\n/**\n * Environment variables validation schema\n * Ensures all required environment variables are present and valid\n */\nconst envSchema = z.object({\n  // Database\n  DATABASE_URL: z.string().url('DATABASE_URL must be a valid URL'),\n\n  // NextAuth\n  NEXTAUTH_URL: z.string().url('NEXTAUTH_URL must be a valid URL'),\n  NEXTAUTH_SECRET: z.string().min(32, 'NEXTAUTH_SECRET must be at least 32 characters'),\n\n  // Node Environment\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n\n  // Optional: File uploads\n  UPLOAD_DIR: z.string().default('public/uploads'),\n  MAX_FILE_SIZE: z.string().default('5242880').transform(val => parseInt(val, 10)), // 5MB\n\n  // Optional: External services\n  SMTP_HOST: z.string().optional(),\n  SMTP_PORT: z.string().transform(val => parseInt(val, 10)).optional(),\n  SMTP_USER: z.string().optional(),\n  SMTP_PASS: z.string().optional(),\n});\n\n/**\n * Validated environment variables\n * Use this instead of process.env directly for type safety\n */\nexport const env = envSchema.parse(process.env);\n\n/**\n * Environment-specific configurations\n */\nexport const config = {\n  isDevelopment: env.NODE_ENV === 'development',\n  isProduction: env.NODE_ENV === 'production',\n  isTest: env.NODE_ENV === 'test',\n  \n  // Database\n  database: {\n    url: env.DATABASE_URL,\n  },\n\n  // Authentication\n  auth: {\n    url: env.NEXTAUTH_URL,\n    secret: env.NEXTAUTH_SECRET,\n  },\n\n  // File uploads\n  uploads: {\n    dir: env.UPLOAD_DIR,\n    maxFileSize: env.MAX_FILE_SIZE,\n    allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'application/pdf'],\n  },\n\n  // API\n  api: {\n    baseUrl: env.NEXTAUTH_URL,\n    timeout: 30000, // 30 seconds\n  },\n\n  // UI\n  ui: {\n    toastDuration: 5000,\n    modalAnimationDuration: 200,\n  },\n} as const;\n\nexport type Config = typeof config;\n"
    },
    {
      "path": "src/lib/exportToExcel.ts",
      "lang": "ts",
      "size": 10017,
      "lines": 306,
      "hash": "03bb6bbc88d38948c55664d3c87b990abdeed6904dd045dfe939e7190bb53f86",
      "truncated": false,
      "content": "import * as XLSX from 'xlsx';\n\ninterface WorkerData {\n  id: string;\n  namaLengkap: string;\n  foto: string;\n  nik: string;\n  tempatLahir: string;\n  tanggalLahir: string;\n  jenisKelamin: string;\n  agama: string;\n  statusPerkawinan: string;\n  alamat: string;\n  noTelepon: string;\n  email: string;\n  pendidikanTerakhir: string;\n  jabatan: string;\n  pengalaman: string;\n  keahlianKhusus: string;\n  sertifikasi: string;\n  catatan: string;\n}\n\ninterface SubmissionData {\n  id: string;\n  nomorSurat: string;\n  perihal: string;\n  tujuan: string;\n  tempatPelaksanaan: string;\n  tanggalMulai: string;\n  tanggalSelesai: string;\n  statusApproval: string;\n  vendorName: string;\n  vendorCompany: string;\n  vendorEmail: string;\n  vendorPhone: string;\n  submittedAt: string;\n  approvedAt: string;\n  totalWorkers: number;\n  daftarPekerja: WorkerData[];\n  dokumenSika: string;\n  dokumenSimja: string;\n  catatan: string;\n  signerName: string;\n  signerTitle: string;\n  // Additional fields from current schema\n  jamKerja: string;\n  saranaKerja: string;\n  pelaksanaan: string;\n  lainLain: string;\n  nomorSimja: string;\n  tanggalSimja: string;\n  nomorSika: string;\n  tanggalSika: string;\n  nomorSimlok: string;\n  tanggalSimlok: string;\n  namaPerkerjaText: string;\n  content: string;\n  qrcode: string;\n  approvedBy: string;\n}\n\ninterface ExportOptions {\n  filename?: string;\n  sheetName?: string;\n  dateFrom?: string;\n  dateTo?: string;\n}\n\nexport const exportSubmissionsToExcel = (data: SubmissionData[], options: ExportOptions = {}) => {\n  try {\n    const {\n      filename = `submissions_export_${new Date().toISOString().split('T')[0]}.xlsx`,\n      sheetName = 'Submissions Data',\n      dateFrom,\n      dateTo\n    } = options;\n\n    // Filter data by date if provided\n    let filteredData = data;\n    if (dateFrom || dateTo) {\n      filteredData = data.filter(item => {\n        const itemDate = new Date(item.submittedAt);\n        const fromDate = dateFrom ? new Date(dateFrom) : null;\n        const toDate = dateTo ? new Date(dateTo) : null;\n\n        if (fromDate && toDate) {\n          // Set time to cover full day range\n          fromDate.setHours(0, 0, 0, 0);\n          toDate.setHours(23, 59, 59, 999);\n          return itemDate >= fromDate && itemDate <= toDate;\n        } else if (fromDate) {\n          fromDate.setHours(0, 0, 0, 0);\n          return itemDate >= fromDate;\n        } else if (toDate) {\n          toDate.setHours(23, 59, 59, 999);\n          return itemDate <= toDate;\n        }\n        return true;\n      });\n    }\n\n    // Transform submissions data for Excel export\n    const submissionsData = filteredData.map((item, index) => ({\n      'No': index + 1,\n      'Nomor SIMLOK': item.nomorSimlok || '-',\n      'Tanggal SIMLOK': item.tanggalSimlok || '-',\n      'ID Submission': item.id,\n      'Nomor Surat/Berdasarkan': item.nomorSurat,\n      'Perihal/Pekerjaan': item.perihal,\n      'Tujuan/Lokasi Kerja': item.tujuan,\n      'Tempat Pelaksanaan': item.tempatPelaksanaan,\n      'Pelaksanaan': item.pelaksanaan || '-',\n      'Jam Kerja': item.jamKerja,\n      'Sarana Kerja': item.saranaKerja,\n      'Lain-lain': item.lainLain || '-',\n      'Status Approval': item.statusApproval,\n      'Nama Vendor/Petugas': item.vendorName,\n      'Perusahaan Vendor': item.vendorCompany || '-',\n      'Email Vendor': item.vendorEmail,\n      'Telepon Vendor': item.vendorPhone || '-',\n      'Tanggal Submit': item.submittedAt,\n      'Approved By': item.approvedBy || '-',\n      'Total Pekerja': item.totalWorkers,\n      'Nomor SIMJA': item.nomorSimja || '-',\n      'Tanggal SIMJA': item.tanggalSimja || '-',\n      'Nomor SIKA': item.nomorSika || '-',\n      'Tanggal SIKA': item.tanggalSika || '-',\n      'Dokumen SIKA': item.dokumenSika || '-',\n      'Dokumen SIMJA': item.dokumenSimja || '-',\n      'Catatan': item.catatan || '-',\n      'Nama Penandatangan': item.signerName || '-',\n      'Jabatan Penandatangan': item.signerTitle || '-',\n      'QR Code': item.qrcode || '-',\n      'Daftar Pekerja': formatWorkerNames(item.namaPerkerjaText) || '-'\n    }));\n\n    // Create workbook\n    const wb = XLSX.utils.book_new();\n\n    // Add submissions sheet\n    const submissionsWs = XLSX.utils.json_to_sheet(submissionsData);\n    \n    // Set column widths for submissions\n    const submissionsColWidths = [\n      { wch: 5 },   // No\n      { wch: 15 },  // Nomor SIMLOK\n      { wch: 15 },  // Tanggal SIMLOK\n      { wch: 20 },  // ID Submission\n      { wch: 25 },  // Nomor Surat/Berdasarkan\n      { wch: 40 },  // Perihal/Pekerjaan\n      { wch: 25 },  // Tujuan/Lokasi Kerja\n      { wch: 25 },  // Tempat Pelaksanaan\n      { wch: 30 },  // Pelaksanaan\n      { wch: 15 },  // Jam Kerja\n      { wch: 30 },  // Sarana Kerja\n      { wch: 30 },  // Lain-lain\n      { wch: 15 },  // Status Approval\n      { wch: 25 },  // Nama Vendor/Petugas\n      { wch: 25 },  // Perusahaan Vendor\n      { wch: 25 },  // Email Vendor\n      { wch: 15 },  // Telepon Vendor\n      { wch: 15 },  // Tanggal Submit\n      { wch: 20 },  // Approved By\n      { wch: 12 },  // Total Pekerja\n      { wch: 15 },  // Nomor SIMJA\n      { wch: 15 },  // Tanggal SIMJA\n      { wch: 15 },  // Nomor SIKA\n      { wch: 15 },  // Tanggal SIKA\n      { wch: 20 },  // Dokumen SIKA\n      { wch: 20 },  // Dokumen SIMJA\n      { wch: 30 },  // Catatan\n      { wch: 25 },  // Nama Penandatangan\n      { wch: 25 },  // Jabatan Penandatangan\n      { wch: 15 },  // QR Code\n      { wch: 50 }   // Daftar Pekerja\n    ];\n    submissionsWs['!cols'] = submissionsColWidths;\n    \n    XLSX.utils.book_append_sheet(wb, submissionsWs, sheetName);\n\n    // Add workers detail sheet if there's worker data\n    const allWorkers: any[] = [];\n    filteredData.forEach((submission, _submissionIndex) => {\n      submission.daftarPekerja.forEach((worker, _workerIndex) => {\n        allWorkers.push({\n          'No': allWorkers.length + 1,\n          'ID Submission': submission.id,\n          'Nomor Surat': submission.nomorSurat,\n          'Vendor': submission.vendorName,\n          'Nama Lengkap': worker.namaLengkap,\n          'Foto Pekerja': worker.foto || '-',\n          // Note: Most detailed worker fields are not available in current schema\n        //   'NIK': worker.nik || '-',\n        //   'Tempat Lahir': worker.tempatLahir || '-',\n        //   'Tanggal Lahir': worker.tanggalLahir || '-',\n        //   'Jenis Kelamin': worker.jenisKelamin || '-',\n        //   'Agama': worker.agama || '-',\n        //   'Status Perkawinan': worker.statusPerkawinan || '-',\n        //   'Alamat': worker.alamat || '-',\n        //   'No Telepon': worker.noTelepon || '-',\n        //   'Email': worker.email || '-',\n        //   'Pendidikan Terakhir': worker.pendidikanTerakhir || '-',\n        //   'Jabatan': worker.jabatan || '-',\n        //   'Pengalaman': worker.pengalaman || '-',\n        //   'Keahlian Khusus': worker.keahlianKhusus || '-',\n        //   'Sertifikasi': worker.sertifikasi || '-',\n        //   'Catatan': worker.catatan || '-'\n        });\n      });\n    });\n\n    if (allWorkers.length > 0) {\n      const workersWs = XLSX.utils.json_to_sheet(allWorkers);\n      \n      // Set column widths for workers\n      const workersColWidths = [\n        { wch: 5 },   // No\n        { wch: 20 },  // ID Submission\n        { wch: 20 },  // Nomor Surat\n        { wch: 25 },  // Vendor\n        { wch: 25 },  // Nama Lengkap\n        { wch: 20 },  // Foto Pekerja\n        { wch: 20 },  // NIK\n        { wch: 15 },  // Tempat Lahir\n        { wch: 12 },  // Tanggal Lahir\n        { wch: 12 },  // Jenis Kelamin\n        { wch: 10 },  // Agama\n        { wch: 15 },  // Status Perkawinan\n        { wch: 40 },  // Alamat\n        { wch: 15 },  // No Telepon\n        { wch: 25 },  // Email\n        { wch: 20 },  // Pendidikan Terakhir\n        { wch: 20 },  // Jabatan\n        { wch: 30 },  // Pengalaman\n        { wch: 30 },  // Keahlian Khusus\n        { wch: 30 },  // Sertifikasi\n        { wch: 30 }   // Catatan\n      ];\n      workersWs['!cols'] = workersColWidths;\n      \n      XLSX.utils.book_append_sheet(wb, workersWs, 'Workers Detail');\n    }\n\n    // Add summary sheet\n    const summaryData = [\n      ['LAPORAN EXPORT SUBMISSIONS'],\n      [''],\n      ['Filter Tanggal:', dateFrom && dateTo ? `${formatDate(dateFrom)} - ${formatDate(dateTo)}` : \n        dateFrom ? `Dari: ${formatDate(dateFrom)}` : \n        dateTo ? `Sampai: ${formatDate(dateTo)}` : 'Semua Data'],\n      ['Total Submissions:', filteredData.length],\n      ['Total Pekerja:', allWorkers.length],\n      ['Export Time:', new Date().toLocaleString('id-ID')],\n      [''],\n      ['Status Summary:'],\n      ['APPROVED:', filteredData.filter(item => item.statusApproval === 'APPROVED').length],\n      ['PENDING:', filteredData.filter(item => item.statusApproval === 'PENDING').length],\n      ['REJECTED:', filteredData.filter(item => item.statusApproval === 'REJECTED').length]\n    ];\n    \n    const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);\n    XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');\n\n    // Write file\n    XLSX.writeFile(wb, filename);\n\n    return {\n      success: true,\n      message: `Data berhasil diexport ke ${filename}`,\n      totalData: filteredData.length\n    };\n\n  } catch (error) {\n    console.error('Error exporting to Excel:', error);\n    return {\n      success: false,\n      message: 'Gagal mengexport data ke Excel',\n      error: error instanceof Error ? error.message : 'Unknown error'\n    };\n  }\n};\n\n// Helper function to format date\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleDateString('id-ID', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  });\n};\n\n// Helper function to format worker names with bullet points\nconst formatWorkerNames = (namaPerkerjaText: string): string => {\n  if (!namaPerkerjaText) return '';\n  \n  const names = namaPerkerjaText\n    .split(/[\\n,]+/)\n    .map(name => name.trim())\n    .filter(name => name.length > 0);\n  \n  if (names.length === 0) return '';\n  \n  return names.map(name => `- ${name}`).join('\\n');\n};"
    },
    {
      "path": "src/lib/fileManager.ts",
      "lang": "ts",
      "size": 13075,
      "lines": 442,
      "hash": "33613f5bdca597642def74917a6f2a3bc157249138216aba6e133532f2f08b23",
      "truncated": false,
      "content": "import { join } from 'path';\nimport { mkdir, rename, unlink, readdir, stat } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport crypto from 'crypto';\n\nexport interface FileInfo {\n  originalName: string;\n  newName: string;\n  path: string;\n  url: string;\n  size: number;\n  type: string;\n  category: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';\n}\n\nexport class FileManager {\n  private baseUploadDir: string;\n\n  constructor() {\n    this.baseUploadDir = join(process.cwd(), 'public', 'uploads');\n  }\n\n  /**\n   * Get organized folder structure for user files\n   */\n  private getUserFolderStructure(userId: string) {\n    const userBaseDir = join(this.baseUploadDir, userId);\n    return {\n      base: userBaseDir,\n      sika: join(userBaseDir, 'dokumen-sika'),\n      simja: join(userBaseDir, 'dokumen-simja'),\n      idCard: join(userBaseDir, 'id-card'),\n      other: join(userBaseDir, 'lainnya'),\n      workerPhoto: join(userBaseDir, 'foto-pekerja')\n    };\n  }\n\n  /**\n   * Determine file category based on field name or file content\n   */\n  private getFileCategory(fieldName?: string, fileName?: string): 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo' {\n    if (fieldName) {\n      if (fieldName.includes('sika')) return 'sika';\n      if (fieldName.includes('simja')) return 'simja';\n      if (fieldName.includes('worker') || fieldName.includes('pekerja')) return 'worker-photo';\n    }\n    \n    if (fileName) {\n      const lowerName = fileName.toLowerCase();\n      if (lowerName.includes('sika')) return 'sika';\n      if (lowerName.includes('simja')) return 'simja';\n      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';\n      if (lowerName.includes('worker') || lowerName.includes('pekerja') || lowerName.includes('foto')) return 'worker-photo';\n    }\n    \n    return 'other';\n  }\n\n  /**\n   * Generate a clean, descriptive filename\n   */\n  private generateFileName(originalName: string, category: string, _userId: string): string {\n    const timestamp = Date.now();\n    const randomString = crypto.randomBytes(4).toString('hex');\n    const extension = originalName.split('.').pop()?.toLowerCase() || '';\n    \n    // Clean original name\n    const cleanOriginalName = originalName\n      .replace(/\\.[^/.]+$/, '') // Remove extension\n      .replace(/[^a-zA-Z0-9\\-_]/g, '_') // Replace special chars\n      .substring(0, 30); // Limit length\n\n    // Create descriptive name based on category\n    const categoryPrefix = {\n      sika: 'SIKA',\n      simja: 'SIMJA', \n      other: 'Doc',\n      'worker-photo': 'Worker'\n    }[category] || 'Doc';\n\n    return `${categoryPrefix}_${timestamp}_${randomString}_${cleanOriginalName}.${extension}`;\n  }\n\n  /**\n   * Create all necessary directories\n   */\n  private async createDirectories(userId: string): Promise<void> {\n    const folders = this.getUserFolderStructure(userId);\n    \n    for (const folder of Object.values(folders)) {\n      if (!existsSync(folder)) {\n        await mkdir(folder, { recursive: true });\n      }\n    }\n  }\n\n  /**\n   * Save worker photo with worker's name as filename\n   */\n  async saveWorkerPhoto(\n    fileBuffer: Buffer,\n    originalName: string,\n    userId: string,\n    workerName: string\n  ): Promise<FileInfo> {\n    // Clean worker name for filename\n    const cleanWorkerName = workerName\n      .replace(/[^a-zA-Z0-9\\-_\\s]/g, '') // Remove special chars except space\n      .replace(/\\s+/g, '_') // Replace spaces with underscore\n      .substring(0, 50); // Limit length\n\n    // Get file extension\n    const extension = originalName.split('.').pop()?.toLowerCase() || 'jpg';\n    \n    // Generate filename with worker name\n    const timestamp = Date.now();\n    const newFileName = `${cleanWorkerName}_${timestamp}.${extension}`;\n    \n    // Create directories\n    await this.createDirectories(userId);\n    \n    // Get worker photo folder\n    const folders = this.getUserFolderStructure(userId);\n    const targetFolder = folders.workerPhoto;\n\n    // Save file\n    const filePath = join(targetFolder, newFileName);\n    const { writeFile } = await import('fs/promises');\n    await writeFile(filePath, fileBuffer);\n\n    // Get file stats\n    const stats = await stat(filePath);\n\n    return {\n      originalName,\n      newName: newFileName,\n      path: filePath,\n      url: `/api/files/${userId}/worker-photo/${newFileName}`,\n      size: stats.size,\n      type: this.getFileType(originalName),\n      category: 'worker-photo'\n    };\n  }\n\n  /**\n   * Save uploaded file with proper organization\n   */\n  async saveFile(\n    fileBuffer: Buffer,\n    originalName: string,\n    userId: string,\n    fieldName?: string\n  ): Promise<FileInfo> {\n    // Determine category and generate filename\n    const category = this.getFileCategory(fieldName, originalName);\n    const newFileName = this.generateFileName(originalName, category, userId);\n    \n    // Create directories\n    await this.createDirectories(userId);\n    \n    // Get target folder\n    const folders = this.getUserFolderStructure(userId);\n    const targetFolder = {\n      sika: folders.sika,\n      simja: folders.simja,\n      id_card: folders.idCard,\n      other: folders.other,\n      'worker-photo': folders.workerPhoto\n    }[category];\n\n    if (!targetFolder) {\n      throw new Error(`Invalid category: ${category}`);\n    }\n\n    // Save file\n    const filePath = join(targetFolder, newFileName);\n    const { writeFile } = await import('fs/promises');\n    await writeFile(filePath, fileBuffer);\n\n    // Get file stats\n    const stats = await stat(filePath);\n\n    return {\n      originalName,\n      newName: newFileName,\n      path: filePath,\n      url: `/api/files/${userId}/${category}/${newFileName}`,\n      size: stats.size,\n      type: this.getFileType(originalName),\n      category\n    };\n  }\n\n  /**\n   * Rename existing file\n   */\n  async renameFile(\n    userId: string,\n    oldFileName: string,\n    newName: string,\n    category?: 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'\n  ): Promise<FileInfo | null> {\n    try {\n      const folders = this.getUserFolderStructure(userId);\n      \n      // Find the file in any category folder\n      let currentFilePath: string | null = null;\n      let currentCategory: string | null = null;\n\n      for (const [cat, folder] of Object.entries({\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      })) {\n        const testPath = join(folder, oldFileName);\n        if (existsSync(testPath)) {\n          currentFilePath = testPath;\n          currentCategory = cat;\n          break;\n        }\n      }\n\n      if (!currentFilePath || !currentCategory) {\n        throw new Error('File not found');\n      }\n\n      // Determine new category (use provided or keep current)\n      const targetCategory = category || currentCategory as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo';\n      \n      // Generate new filename\n      const extension = oldFileName.split('.').pop()?.toLowerCase() || '';\n      const cleanNewName = newName.replace(/[^a-zA-Z0-9\\-_]/g, '_');\n      const timestamp = Date.now();\n      const randomString = crypto.randomBytes(4).toString('hex');\n      \n      const newFileName = `${targetCategory.toUpperCase()}_${timestamp}_${randomString}_${cleanNewName}.${extension}`;\n      \n      // Get target folder\n      const targetFolder = {\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      }[targetCategory];\n\n      if (!targetFolder) {\n        throw new Error(`Invalid target category: ${targetCategory}`);\n      }\n\n      const newFilePath = join(targetFolder, newFileName);\n\n      // Rename/move file\n      await rename(currentFilePath, newFilePath);\n\n      // Get file stats\n      const stats = await stat(newFilePath);\n\n      return {\n        originalName: oldFileName,\n        newName: newFileName,\n        path: newFilePath,\n        url: `/api/files/${userId}/${targetCategory}/${newFileName}`,\n        size: stats.size,\n        type: this.getFileType(newFileName),\n        category: targetCategory\n      };\n\n    } catch (error) {\n      console.error('Error renaming file:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Delete file\n   */\n  async deleteFile(userId: string, fileName: string): Promise<boolean> {\n    try {\n      const folders = this.getUserFolderStructure(userId);\n      \n      // Find and delete the file from any category folder\n      for (const folder of Object.values({\n        sika: folders.sika,\n        simja: folders.simja,\n        id_card: folders.idCard,\n        other: folders.other,\n        'worker-photo': folders.workerPhoto\n      })) {\n        const filePath = join(folder, fileName);\n        if (existsSync(filePath)) {\n          await unlink(filePath);\n          return true;\n        }\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Error deleting file:', error);\n      return false;\n    }\n  }\n\n  /**\n   * List all files for a user\n   */\n  async listUserFiles(userId: string): Promise<{ [category: string]: FileInfo[] }> {\n    const folders = this.getUserFolderStructure(userId);\n    const result: { [category: string]: FileInfo[] } = {\n      sika: [],\n      simja: [],\n      id_card: [],\n      other: [],\n      'worker-photo': []\n    };\n\n    for (const [category, folder] of Object.entries({\n      sika: folders.sika,\n      simja: folders.simja,\n      id_card: folders.idCard,\n      other: folders.other,\n      'worker-photo': folders.workerPhoto\n    })) {\n      try {\n        if (existsSync(folder)) {\n          const files = await readdir(folder);\n          \n          for (const fileName of files) {\n            const filePath = join(folder, fileName);\n            const stats = await stat(filePath);\n            \n            if (result[category]) {\n              result[category].push({\n                originalName: fileName,\n                newName: fileName,\n                path: filePath,\n                url: `/api/files/${userId}/${category}/${fileName}`,\n                size: stats.size,\n                type: this.getFileType(fileName),\n                category: category as 'sika' | 'simja' | 'id_card' | 'other' | 'worker-photo'\n              });\n            }\n          }\n        }\n      } catch (error) {\n        console.error(`Error reading folder ${category}:`, error);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get file type from filename\n   */\n  private getFileType(filename: string): string {\n    const extension = filename.split('.').pop()?.toLowerCase();\n    \n    const types: { [key: string]: string } = {\n      pdf: 'application/pdf',\n      doc: 'application/msword',\n      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      jpg: 'image/jpeg',\n      jpeg: 'image/jpeg',\n      png: 'image/png',\n      gif: 'image/gif'\n    };\n\n    return types[extension || ''] || 'application/octet-stream';\n  }\n\n  /**\n   * Move existing files to organized structure (migration utility)\n   */\n  async migrateExistingFiles(userId: string): Promise<{ moved: number; errors: string[] }> {\n    const oldUserDir = join(this.baseUploadDir, userId);\n    const errors: string[] = [];\n    let moved = 0;\n\n    if (!existsSync(oldUserDir)) {\n      return { moved: 0, errors: ['User directory not found'] };\n    }\n\n    try {\n      // Create new organized structure\n      await this.createDirectories(userId);\n      \n      // Read files from old structure\n      const files = await readdir(oldUserDir);\n      \n      for (const fileName of files) {\n        const oldPath = join(oldUserDir, fileName);\n        const stats = await stat(oldPath);\n        \n        // Skip if it's a directory (already organized)\n        if (stats.isDirectory()) continue;\n        \n        try {\n          // Determine category from filename\n          const category = this.getFileCategory(undefined, fileName);\n          \n          // Get target folder\n          const folders = this.getUserFolderStructure(userId);\n          const targetFolder = {\n            sika: folders.sika,\n            simja: folders.simja,\n            id_card: folders.idCard,\n            other: folders.other,\n            'worker-photo': folders.workerPhoto\n          }[category];\n\n          if (!targetFolder) {\n            errors.push(`Invalid category ${category} for file ${fileName}`);\n            continue;\n          }\n\n          // Generate new organized filename\n          const newFileName = this.generateFileName(fileName, category, userId);\n          const newPath = join(targetFolder, newFileName);\n\n          // Move file\n          await rename(oldPath, newPath);\n          moved++;\n          \n        } catch (error) {\n          errors.push(`Failed to move ${fileName}: ${error}`);\n        }\n      }\n\n    } catch (error) {\n      errors.push(`Migration error: ${error}`);\n    }\n\n    return { moved, errors };\n  }\n}\n\n// Export singleton instance\nexport const fileManager = new FileManager();\n"
    },
    {
      "path": "src/lib/fileUrlHelper.ts",
      "lang": "ts",
      "size": 4601,
      "lines": 163,
      "hash": "8f9ec4a774db85ebb77e26a3271c6ecb1626c4041a749a60585069364bc7da68",
      "truncated": false,
      "content": "/**\n * File URL utilities for handling legacy and new file URL formats\n */\n\nexport class FileUrlHelper {\n  /**\n   * Convert legacy file URL to new categorized format\n   * Legacy: /api/files/userId/filename\n   * New: /api/files/userId/category/filename\n   */\n  static convertLegacyUrl(url: string, fieldName?: string): string {\n    if (!url) return url;\n\n    // Check if it's already in new format (has category)\n    const urlParts = url.split('/');\n    if (urlParts.length >= 6) {\n      return url; // Already in new format\n    }\n\n    // Extract userId and filename from legacy format\n    const userId = urlParts[3];\n    const filename = urlParts[4];\n\n    if (!userId || !filename) {\n      return url; // Invalid URL, return as is\n    }\n\n    // Determine category from field name or filename\n    const category = this.getCategoryFromField(fieldName, filename);\n\n    return `/api/files/${userId}/${category}/${filename}`;\n  }\n\n  /**\n   * Determine file category from field name or filename\n   */\n  static getCategoryFromField(fieldName?: string, filename?: string): string {\n    if (fieldName) {\n      if (fieldName.includes('sika')) return 'sika';\n      if (fieldName.includes('simja')) return 'simja';\n    }\n    \n    if (filename) {\n      const lowerName = filename.toLowerCase();\n      if (lowerName.includes('sika')) return 'sika';\n      if (lowerName.includes('simja')) return 'simja';\n      if (lowerName.includes('ktp') || lowerName.includes('id') || lowerName.includes('identitas')) return 'id_card';\n    }\n    \n    return 'other';\n  }\n\n  /**\n   * Get display filename from full filename\n   */\n  static getDisplayFilename(filename: string): string {\n    if (!filename) return '';\n    \n    // Remove timestamp and random string prefix if present\n    // Format: CATEGORY_timestamp_random_originalname.ext\n    const parts = filename.split('_');\n    if (parts.length >= 4 && parts[0]?.match(/^(SIKA|SIMJA|DOC)$/i)) {\n      // Remove first 3 parts (category, timestamp, random)\n      return parts.slice(3).join('_');\n    }\n    \n    return filename;\n  }\n\n  /**\n   * Get file extension from filename\n   */\n  static getFileExtension(filename: string): string {\n    return filename.split('.').pop()?.toLowerCase() || '';\n  }\n\n  /**\n   * Check if file is an image\n   */\n  static isImage(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension);\n  }\n\n  /**\n   * Check if file is a PDF\n   */\n  static isPDF(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return extension === 'pdf';\n  }\n\n  /**\n   * Check if file is a document\n   */\n  static isDocument(filename: string): boolean {\n    const extension = this.getFileExtension(filename);\n    return ['doc', 'docx', 'pdf', 'txt', 'rtf'].includes(extension);\n  }\n\n  /**\n   * Get MIME type from filename\n   */\n  static getMimeType(filename: string): string {\n    const extension = this.getFileExtension(filename);\n    \n    const mimeTypes: { [key: string]: string } = {\n      pdf: 'application/pdf',\n      doc: 'application/msword',\n      docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      jpg: 'image/jpeg',\n      jpeg: 'image/jpeg',\n      png: 'image/png',\n      gif: 'image/gif',\n      webp: 'image/webp',\n      txt: 'text/plain',\n      rtf: 'application/rtf'\n    };\n\n    return mimeTypes[extension] || 'application/octet-stream';\n  }\n\n  /**\n   * Format file size in human readable format\n   */\n  static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 B';\n    \n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n\n  /**\n   * Generate download filename for better user experience\n   */\n  static generateDownloadFilename(originalUrl: string, category: string, customName?: string): string {\n    if (customName) {\n      return customName;\n    }\n\n    const filename = originalUrl.split('/').pop() || 'download';\n    const extension = this.getFileExtension(filename);\n    \n    const categoryNames = {\n      sika: 'Dokumen_SIKA',\n      simja: 'Dokumen_SIMJA',\n      id_card: 'ID_Card',\n      other: 'Dokumen'\n    };\n\n    const prefix = categoryNames[category as keyof typeof categoryNames] || 'Dokumen';\n    const timestamp = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n    \n    return `${prefix}_${timestamp}.${extension}`;\n  }\n}\n\n// Export for easier imports\nexport const fileUrlHelper = FileUrlHelper;\n"
    },
    {
      "path": "src/lib/notificationCleanup.ts",
      "lang": "ts",
      "size": 4724,
      "lines": 147,
      "hash": "8b1fe418840c3b4e7cc185470cfe193fa19902b4696d20304e07a3231f07a19b",
      "truncated": false,
      "content": "import { PrismaClient } from '@prisma/client';\nimport { notifyNotificationsRemoved } from '@/server/events';\n\nconst prisma = new PrismaClient();\n\n/**\n * Clean up notifications that reference deleted submissions\n * This function is used to maintain data integrity\n */\nexport async function cleanupOrphanedNotifications() {\n  try {\n    console.log('🧹 Starting cleanup of orphaned notifications...');\n    \n    // Find all notifications that reference submissions\n    const submissionNotifications = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: 'submissionId' } },\n          { data: { contains: 'submission_id' } },\n          { message: { contains: 'ID' } },\n          { title: { contains: 'ID' } }\n        ]\n      }\n    });\n    \n    const orphanedNotifications = [];\n    \n    // Check each notification\n    for (const notif of submissionNotifications) {\n      let submissionId = null;\n      \n      // Extract submission ID from data field\n      if (notif.data) {\n        try {\n          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;\n          submissionId = data.submissionId || data.submission_id;\n        } catch (e) {\n          // ignore parsing errors\n        }\n      }\n      \n      // Extract from message/title if not found in data\n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notif.message.match(idPattern);\n        const titleMatch = notif.title.match(idPattern);\n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n      }\n      \n      if (submissionId) {\n        // Check if submission exists\n        const submission = await prisma.submission.findUnique({\n          where: { id: submissionId }\n        });\n        \n        if (!submission) {\n          orphanedNotifications.push({\n            notification: notif,\n            submissionId: submissionId\n          });\n        }\n      }\n    }\n    \n    if (orphanedNotifications.length > 0) {\n      console.log(`Found ${orphanedNotifications.length} orphaned notifications to clean up`);\n      \n      // Delete orphaned notifications\n      for (const item of orphanedNotifications) {\n        // First delete NotificationRead records\n        await prisma.notificationRead.deleteMany({\n          where: { notification_id: item.notification.id }\n        });\n        \n        // Then delete the notification\n        await prisma.notification.delete({\n          where: { id: item.notification.id }\n        });\n        \n        console.log(`✅ Deleted orphaned notification ${item.notification.id} (${item.notification.type})`);\n      }\n      \n      console.log(`✅ Successfully cleaned up ${orphanedNotifications.length} orphaned notifications`);\n      return orphanedNotifications.length;\n    } else {\n      console.log('✅ No orphaned notifications found');\n      return 0;\n    }\n    \n  } catch (error) {\n    console.error('❌ Error during notification cleanup:', error);\n    throw error;\n  }\n}\n\n/**\n * Clean up notifications specifically for a deleted submission\n * This is called when a submission is deleted\n */\nexport async function cleanupSubmissionNotifications(submissionId: string) {\n  try {\n    console.log(`🧹 Cleaning up notifications for deleted submission: ${submissionId}`);\n    \n    // Find notifications that reference this specific submission\n    const notificationsToDelete = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: submissionId } },\n          { message: { contains: submissionId } },\n          { title: { contains: submissionId } }\n        ]\n      }\n    });\n    \n    console.log(`Found ${notificationsToDelete.length} notifications to delete for submission ${submissionId}`);\n    \n    // Delete NotificationRead records first (due to foreign key constraints)\n    for (const notification of notificationsToDelete) {\n      await prisma.notificationRead.deleteMany({\n        where: { notification_id: notification.id }\n      });\n    }\n    \n    // Delete the notifications\n    const deleteResult = await prisma.notification.deleteMany({\n      where: {\n        OR: [\n          { data: { contains: submissionId } },\n          { message: { contains: submissionId } },\n          { title: { contains: submissionId } }\n        ]\n      }\n    });\n    \n    console.log(`✅ Deleted ${deleteResult.count} notifications for submission ${submissionId}`);\n    \n    // Broadcast notification removal to all clients\n    await notifyNotificationsRemoved(submissionId);\n    \n    return deleteResult.count;\n    \n  } catch (error) {\n    console.error(`❌ Error cleaning notifications for submission ${submissionId}:`, error);\n    throw error;\n  }\n}\n"
    },
    {
      "path": "src/lib/parseNumber.ts",
      "lang": "ts",
      "size": 1530,
      "lines": 46,
      "hash": "d5aef4068c71dd728521c3cc86dfaeecf87da274a6cd488dfaa2ab6df2c39d0b",
      "truncated": false,
      "content": "export function numberToBahasa(n: number): string {\n    if (n === 0) return \"Nol\";\n\n    const satuan = [\n        \"\",\n        \"Satu\",\n        \"Dua\",\n        \"Tiga\",\n        \"Empat\",\n        \"Lima\",\n        \"Enam\",\n        \"Tujuh\",\n        \"Delapan\",\n        \"Sembilan\",\n        \"Sepuluh\",\n        \"Sebelas\",\n    ];\n\n    function toWords(x: number): string {\n        let str = \"\";\n        if (x < 12) {\n            str = satuan[x] ?? \"\";\n        } else if (x < 20) {\n            str = toWords(x - 10) + \" Belas\";\n        } else if (x < 100) {\n            str = toWords(Math.floor(x / 10)) + \" Puluh \" + toWords(x % 10);\n        } else if (x < 200) {\n            str = \"Seratus \" + toWords(x - 100);\n        } else if (x < 1000) {\n            str = toWords(Math.floor(x / 100)) + \" Ratus \" + toWords(x % 100);\n        } else if (x < 2000) {\n            str = \"Seribu \" + toWords(x - 1000);\n        } else if (x < 1_000_000) {\n            str = toWords(Math.floor(x / 1000)) + \" Ribu \" + toWords(x % 1000);\n        } else if (x < 1_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000)) + \" Juta \" + toWords(x % 1_000_000);\n        } else if (x < 1_000_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000_000)) + \" Miliar \" + toWords(x % 1_000_000_000);\n        } else if (x < 1_000_000_000_000_000) {\n            str = toWords(Math.floor(x / 1_000_000_000_000)) + \" Triliun \" + toWords(x % 1_000_000_000_000);\n        }\n        return str.trim();\n    }\n\n    return toWords(n).replace(/\\s+/g, \" \").trim();\n}"
    },
    {
      "path": "src/lib/prisma.ts",
      "lang": "ts",
      "size": 129,
      "lines": 7,
      "hash": "70e88fe63451a592112b25f4607858c316af1b976003fa113c195f8842d25140",
      "truncated": false,
      "content": "/**\n * Legacy Prisma Client - Deprecated\n * Use prisma from @/lib/singletons instead\n */\n\nexport { prisma } from './singletons';\n"
    },
    {
      "path": "src/lib/qr-security.ts",
      "lang": "ts",
      "size": 6707,
      "lines": 222,
      "hash": "c3876d155c19694fe0f6a6a27d253dde37527e97f124827d4599257fa1275cbb",
      "truncated": false,
      "content": "import crypto from 'crypto';\n\n// Salt untuk hashing - harus disimpan secure\nconst QR_SALT = process.env.QR_SECURITY_SALT || 'default-salt-change-in-production';\n\nexport interface QrPayload {\n  id: string;\n  start_date: string | null;\n  end_date: string | null;\n  timestamp: number;\n}\n\nexport interface SimpleQrData {\n  i: string;           // submission ID (shortened key)\n  e: number;          // Expiration timestamp (shortened key)\n  s: string;          // Short signature for verification (shortened key)\n}\n\n/**\n * Generate simple QR code data with minimal information\n */\nexport function generateSimpleQrData(submission: {\n  id: string;\n  implementation_start_date?: string | Date | null;\n  implementation_end_date?: string | Date | null;\n}): SimpleQrData {\n  // Use only submission ID and expiration\n  const expiration = Date.now() + (24 * 60 * 60 * 1000); // 24 hours from now\n  \n  // Create a signature using only essential data\n  const signatureData = `${submission.id}|${expiration}|${QR_SALT}`;\n  const fullHash = crypto.createHash('sha256').update(signatureData).digest('hex');\n  \n  // Use first 32 characters of hash for improved security\n  const signature = fullHash.substring(0, 32);\n\n  return {\n    i: submission.id,    // shortened key names for smaller JSON\n    e: expiration,\n    s: signature\n  };\n}\n\n/**\n * Verify simple QR data\n */\nexport function verifySimpleQrData(qrData: SimpleQrData): boolean {\n  try {\n    // Check expiration\n    if (Date.now() > qrData.e) {\n      console.error('QR code has expired');\n      return false;\n    }\n\n    // Verify signature\n    const signatureData = `${qrData.i}|${qrData.e}|${QR_SALT}`;\n    const expectedHash = crypto.createHash('sha256').update(signatureData).digest('hex');\n    const expectedSignature = expectedHash.substring(0, 32);\n\n    if (expectedSignature !== qrData.s) {\n      console.error('QR signature verification failed');\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error('QR verification failed:', error);\n    return false;\n  }\n}\n\n/**\n * Generate QR code string that can be encoded to QR image (ULTRA SIMPLIFIED)\n */\nexport function generateQrString(submission: {\n  id: string;\n  implementation_start_date?: string | Date | null;\n  implementation_end_date?: string | Date | null;\n}): string {\n  const qrData = generateSimpleQrData(submission);\n  \n  // Create extremely compact QR string - no JSON, direct concatenation\n  // Format: SL:submissionId:expiration:signature\n  return `SL:${qrData.i}:${qrData.e}:${qrData.s}`;\n}\n\n/**\n * Parse QR string and verify it (ULTRA SIMPLIFIED)\n */\nexport function parseQrString(qrString: string): QrPayload | null {\n  try {\n    // Check if it's just a submission ID (legacy format or manual QR)\n    if (!qrString.includes(':') && !qrString.includes('|')) {\n      // This might be a raw submission ID - attempt to handle gracefully\n      if (qrString.length > 20 && qrString.match(/^[a-zA-Z0-9]+$/)) {\n        console.warn('QR code appears to be a raw submission ID (unsecure format):', qrString);\n        // Return a basic payload with just the ID for backward compatibility\n        return {\n          id: qrString,\n          start_date: null,\n          end_date: null,\n          timestamp: Date.now() // Current time as timestamp\n        };\n      }\n    }\n    \n    // Handle old base64 format for backward compatibility\n    if (qrString.includes('|')) {\n      const parts = qrString.split('|');\n      \n      if (parts.length !== 2 || parts[0] !== 'SL') {\n        console.error('Invalid QR format. Expected \"SL|base64data\", got:', qrString);\n        throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');\n      }\n\n      const base64Part = parts[1];\n      if (!base64Part) {\n        throw new Error('Missing QR data');\n      }\n\n      // Decode base64 data\n      const dataString = Buffer.from(base64Part, 'base64').toString('utf8');\n      const qrData: any = JSON.parse(dataString);\n      \n      // Handle old format with full keys\n      const normalizedData: SimpleQrData = {\n        i: qrData.id || qrData.i,\n        e: qrData.exp || qrData.e, \n        s: qrData.sig || qrData.s\n      };\n      \n      if (!normalizedData.i || !normalizedData.e || !normalizedData.s) {\n        throw new Error('Invalid QR data structure');\n      }\n\n      // Verify the QR data\n      if (!verifySimpleQrData(normalizedData)) {\n        throw new Error('QR verification failed');\n      }\n\n      // Convert to QrPayload format for compatibility\n      const payload: QrPayload = {\n        id: normalizedData.i,\n        start_date: null,\n        end_date: null,\n        timestamp: normalizedData.e - (24 * 60 * 60 * 1000)\n      };\n\n      return payload;\n    }\n    \n    // Handle new colon-separated format: SL:submissionId:expiration:signature\n    const parts = qrString.split(':');\n    \n    if (parts.length !== 4 || parts[0] !== 'SL') {\n      console.error('Invalid QR format. Expected \"SL:id:exp:sig\", got:', qrString);\n      throw new Error('Invalid QR format - please scan a valid SIMLOK QR code');\n    }\n\n    const [, submissionId, expirationStr, signature] = parts;\n    \n    if (!submissionId || !expirationStr || !signature) {\n      throw new Error('Missing QR data components');\n    }\n\n    const expiration = parseInt(expirationStr, 10);\n    if (isNaN(expiration)) {\n      throw new Error('Invalid expiration timestamp');\n    }\n\n    const qrData: SimpleQrData = {\n      i: submissionId,\n      e: expiration,\n      s: signature\n    };\n\n    // Verify the QR data\n    if (!verifySimpleQrData(qrData)) {\n      throw new Error('QR verification failed');\n    }\n\n    // Convert to QrPayload format for compatibility\n    const payload: QrPayload = {\n      id: qrData.i,\n      start_date: null, // We don't store dates in simple QR anymore\n      end_date: null,\n      timestamp: qrData.e - (24 * 60 * 60 * 1000) // Calculate original timestamp\n    };\n\n    return payload;\n  } catch (error) {\n    console.error('QR parsing failed:', error);\n    return null;\n  }\n}\n\n/**\n * Check if a QR payload is valid for the current date\n */\nexport function isQrValidForDate(payload: QrPayload, checkDate: Date = new Date()): boolean {\n  const startDate = payload.start_date ? new Date(payload.start_date) : null;\n  const endDate = payload.end_date ? new Date(payload.end_date) : null;\n\n  // If no implementation dates are set, QR is considered valid\n  if (!startDate && !endDate) {\n    return true;\n  }\n\n  // Check if current date is within implementation period\n  const now = checkDate.getTime();\n  \n  if (startDate && now < startDate.getTime()) {\n    return false; // Too early\n  }\n  \n  if (endDate && now > endDate.getTime()) {\n    return false; // Too late\n  }\n\n  return true;\n}\n"
    },
    {
      "path": "src/lib/redis.ts",
      "lang": "ts",
      "size": 1074,
      "lines": 45,
      "hash": "d1df385d3990dbbee220ba1d4b7d36c2b23c6bbbedd9d6fd77f9a104c8227095",
      "truncated": false,
      "content": "import Redis from 'ioredis';\n\ndeclare global {\n  var __redis_pub: Redis | undefined;\n  var __redis_sub: Redis | undefined;\n}\n\nlet pubClient: Redis;\nlet subClient: Redis;\n\nif (process.env.NODE_ENV === 'production') {\n  pubClient = new Redis(process.env.REDIS_URL!);\n  subClient = new Redis(process.env.REDIS_URL!);\n} else {\n  // In development, use globalThis to persist connections across hot reloads\n  if (!globalThis.__redis_pub) {\n    globalThis.__redis_pub = new Redis(process.env.REDIS_URL!);\n  }\n  if (!globalThis.__redis_sub) {\n    globalThis.__redis_sub = new Redis(process.env.REDIS_URL!);\n  }\n  \n  pubClient = globalThis.__redis_pub;\n  subClient = globalThis.__redis_sub;\n}\n\n// Error handling\npubClient.on('error', (err) => {\n  console.error('Redis pub client error:', err);\n});\n\nsubClient.on('error', (err) => {\n  console.error('Redis sub client error:', err);\n});\n\npubClient.on('connect', () => {\n  console.log('Redis pub client connected');\n});\n\nsubClient.on('connect', () => {\n  console.log('Redis sub client connected');\n});\n\nexport { pubClient, subClient };\n"
    },
    {
      "path": "src/lib/singletons.ts",
      "lang": "ts",
      "size": 2627,
      "lines": 102,
      "hash": "768d69f976e848c5bb44c3a428c8fb3e30d740207fdaec747cdef94e7762038f",
      "truncated": false,
      "content": "/**\n * Singletons for Prisma, Redis, and Socket.IO Server\n * Safe for Hot Module Replacement in development\n */\n\nimport { PrismaClient } from '@prisma/client';\nimport Redis from 'ioredis';\nimport { Server as SocketIOServer } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n  var __redis_pub: Redis | undefined;\n  var __redis_sub: Redis | undefined;\n  var __socket_io: SocketIOServer | undefined;\n}\n\n/**\n * Prisma Singleton\n */\nexport const prisma = globalThis.__prisma ?? new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n});\n\nif (process.env.NODE_ENV !== 'production') {\n  globalThis.__prisma = prisma;\n}\n\n/**\n * Redis Clients Singleton\n */\nfunction createRedisClient(prefix = ''): Redis {\n  const redisUrl = process.env.REDIS_URL || 'redis://localhost:6379';\n  \n  const client = new Redis(redisUrl, {\n    lazyConnect: true,\n    enableReadyCheck: false,\n    maxRetriesPerRequest: null,\n    ...(prefix && { keyPrefix: `${prefix}:` }),\n  });\n\n  client.on('error', (err) => {\n    console.warn(`Redis client error (${prefix || 'default'}):`, err.message);\n  });\n\n  client.on('connect', () => {\n    console.log(`Redis client connected (${prefix || 'default'})`);\n  });\n\n  return client;\n}\n\nexport const redisPub = globalThis.__redis_pub ?? createRedisClient('pub');\nexport const redisSub = globalThis.__redis_sub ?? createRedisClient('sub');\n\nif (process.env.NODE_ENV !== 'production') {\n  globalThis.__redis_pub = redisPub;\n  globalThis.__redis_sub = redisSub;\n}\n\n/**\n * Socket.IO Server Singleton\n * Will be initialized when HTTP server is available\n */\nexport function getSocketIO(): SocketIOServer | null {\n  return globalThis.__socket_io || null;\n}\n\nexport function setSocketIO(io: SocketIOServer): void {\n  globalThis.__socket_io = io;\n}\n\n/**\n * Initialize Socket.IO with Redis adapter\n */\nexport function initializeSocketIO(httpServer: any): SocketIOServer {\n  if (globalThis.__socket_io) {\n    return globalThis.__socket_io;\n  }\n\n  const io = new SocketIOServer(httpServer, {\n    path: '/api/socket',\n    addTrailingSlash: false,\n    cors: {\n      origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n      methods: ['GET', 'POST'],\n    },\n    transports: ['websocket', 'polling'],\n  });\n\n  // Setup Redis adapter\n  try {\n    io.adapter(createAdapter(redisPub, redisSub));\n    console.log('Socket.IO Redis adapter initialized');\n  } catch (error) {\n    console.warn('Socket.IO Redis adapter failed, using memory adapter:', error);\n  }\n\n  setSocketIO(io);\n  return io;\n}\n"
    },
    {
      "path": "src/lib/utils.ts",
      "lang": "ts",
      "size": 5448,
      "lines": 217,
      "hash": "2720a040ef543c7cb41a292253a47a350205600727608291cba584bf8d2ddf6f",
      "truncated": false,
      "content": "import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/**\n * Utility function to merge Tailwind CSS classes\n * Handles conflicts and ensures proper class precedence\n */\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n/**\n * Format date to Indonesian locale\n */\nexport function formatDate(\n  date: Date | string | null,\n  options: Intl.DateTimeFormatOptions = {}\n): string {\n  if (!date) return '-';\n  \n  const dateObject = typeof date === 'string' ? new Date(date) : date;\n  \n  const defaultOptions: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    ...options,\n  };\n  \n  return dateObject.toLocaleDateString('id-ID', defaultOptions);\n}\n\n/**\n * Format date to ISO string for input fields\n */\nexport function formatDateForInput(date: Date | string | null): string {\n  if (!date) return '';\n  \n  const dateObject = typeof date === 'string' ? new Date(date) : date;\n  return dateObject.toISOString().split('T')[0]!;\n}\n\n/**\n * Format currency to Indonesian Rupiah\n */\nexport function formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('id-ID', {\n    style: 'currency',\n    currency: 'IDR',\n    minimumFractionDigits: 0,\n  }).format(amount);\n}\n\n/**\n * Format file size in human readable format\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  \n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  \n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n}\n\n/**\n * Capitalize first letter of each word\n */\nexport function capitalize(str: string): string {\n  return str.replace(/\\w\\S*/g, txt => \n    txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n  );\n}\n\n/**\n * API response helpers for server actions and services\n */\nexport const actionResponse = {\n  success: <T>(data: T, message?: string) => ({\n    success: true as const,\n    data,\n    message,\n    error: null,\n  }),\n  \n  error: (message: string, error?: any) => {\n    console.error('Action Error:', message, error);\n    return {\n      success: false as const,\n      data: null,\n      message,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  },\n};\n\nexport const serviceResponse = {\n  success: <T>(data: T, message?: string) => ({\n    success: true as const,\n    data,\n    message,\n    error: null,\n  }),\n  \n  error: (message: string, error?: any) => {\n    console.error('Service Error:', message, error);\n    return {\n      success: false as const,\n      data: null,\n      message,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  },\n};\n\n/**\n * Generate a random string of specified length\n */\nexport function generateRandomString(length: number = 8): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n/**\n * Debounce function to limit function calls\n */\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: NodeJS.Timeout;\n  \n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n}\n\n/**\n * Deep clone an object\n */\nexport function deepClone<T>(obj: T): T {\n  if (obj === null || typeof obj !== 'object') return obj;\n  if (obj instanceof Date) return new Date(obj.getTime()) as unknown as T;\n  if (obj instanceof Array) return obj.map(item => deepClone(item)) as unknown as T;\n  if (typeof obj === 'object') {\n    const cloned = {} as T;\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        cloned[key] = deepClone(obj[key]);\n      }\n    }\n    return cloned;\n  }\n  return obj;\n}\n\n/**\n * Sleep function for async operations\n */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Safe JSON parse with fallback\n */\nexport function safeJsonParse<T>(json: string, fallback: T): T {\n  try {\n    return JSON.parse(json) as T;\n  } catch {\n    return fallback;\n  }\n}\n\n/**\n * Check if value is empty (null, undefined, empty string, empty array, empty object)\n */\nexport function isEmpty(value: unknown): boolean {\n  if (value === null || value === undefined) return true;\n  if (typeof value === 'string') return value.trim().length === 0;\n  if (Array.isArray(value)) return value.length === 0;\n  if (typeof value === 'object') return Object.keys(value).length === 0;\n  return false;\n}\n\n/**\n * Create URL with query parameters\n */\nexport function createUrl(baseUrl: string, params: Record<string, string | number | boolean | null | undefined>): string {\n  const url = new URL(baseUrl, typeof window !== 'undefined' ? window.location.origin : 'http://localhost:3000');\n  \n  Object.entries(params).forEach(([key, value]) => {\n    if (value !== null && value !== undefined) {\n      url.searchParams.set(key, String(value));\n    }\n  });\n  \n  return url.toString();\n}\n\n/**\n * Extract initials from full name\n */\nexport function getInitials(name: string, maxLength: number = 2): string {\n  return name\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase())\n    .slice(0, maxLength)\n    .join('');\n}\n"
    },
    {
      "path": "src/middleware/SessionValidation.ts",
      "lang": "ts",
      "size": 8685,
      "lines": 340,
      "hash": "972cae88d39ae694fb031539e09d83e46cd4bcd276bbe3e7b6aad70f65c0df59",
      "truncated": false,
      "content": "/**\n * Session Validation Middleware\n * Auto-logout when session ID doesn't exist in database\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { getToken } from 'next-auth/jwt';\nimport { prisma } from '@/lib/prisma';\n\ninterface SessionValidationResult {\n  isValid: boolean;\n  userId?: string;\n  sessionExpired?: boolean;\n  shouldLogout?: boolean;\n  reason?: string;\n}\n\nexport class SessionValidationService {\n  private static readonly EXCLUDED_PATHS = [\n    '/api/auth',\n    '/api/health',\n    '/login',\n    '/register',\n    '/_next',\n    '/favicon.ico',\n  ];\n\n  /**\n   * Validate session against database\n   */\n  static async validateSession(request: NextRequest): Promise<SessionValidationResult> {\n    try {\n      // Get token from NextAuth\n      const token = await getToken({ \n        req: request,\n        secret: process.env.NEXTAUTH_SECRET || 'fallback-secret'\n      });\n\n      if (!token || !token.sub) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'No valid token found',\n        };\n      }\n\n      const userId = token.sub;\n\n      // Check if user exists in database\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: {\n          id: true,\n          isActive: true,\n          verified_at: true,\n          lastActiveAt: true,\n          sessionExpiry: true,\n        },\n      });\n\n      if (!user) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User not found in database',\n        };\n      }\n\n      if (!user.isActive) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User account is deactivated',\n        };\n      }\n\n      if (!user.verified_at) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          reason: 'User account is not verified',\n        };\n      }\n\n      // Check session expiry if set\n      if (user.sessionExpiry && new Date() > user.sessionExpiry) {\n        return {\n          isValid: false,\n          shouldLogout: true,\n          sessionExpired: true,\n          reason: 'Session has expired',\n        };\n      }\n\n      // Update last active timestamp\n      await prisma.user.update({\n        where: { id: userId },\n        data: { lastActiveAt: new Date() },\n      });\n\n      return {\n        isValid: true,\n        userId: userId,\n      };\n\n    } catch (error) {\n      console.error('Session validation error:', error);\n      return {\n        isValid: false,\n        shouldLogout: true,\n        reason: 'Session validation failed',\n      };\n    }\n  }\n\n  /**\n   * Check if path should be excluded from session validation\n   */\n  static shouldExcludePath(pathname: string): boolean {\n    return this.EXCLUDED_PATHS.some(path => pathname.startsWith(path));\n  }\n\n  /**\n   * Create logout response with proper cleanup\n   */\n  static createLogoutResponse(request: NextRequest, reason?: string): NextResponse {\n    const response = NextResponse.redirect(new URL('/login', request.url));\n    \n    // Clear NextAuth cookies\n    response.cookies.delete('next-auth.session-token');\n    response.cookies.delete('__Secure-next-auth.session-token');\n    response.cookies.delete('next-auth.csrf-token');\n    response.cookies.delete('__Host-next-auth.csrf-token');\n    response.cookies.delete('next-auth.callback-url');\n    response.cookies.delete('__Secure-next-auth.callback-url');\n\n    // Add logout reason as query parameter\n    if (reason) {\n      const url = new URL('/login', request.url);\n      url.searchParams.set('logout_reason', encodeURIComponent(reason));\n      return NextResponse.redirect(url);\n    }\n\n    return response;\n  }\n\n  /**\n   * Middleware function for automatic session validation\n   */\n  static async middleware(request: NextRequest): Promise<NextResponse> {\n    const { pathname } = request.nextUrl;\n\n    // Skip validation for excluded paths\n    if (this.shouldExcludePath(pathname)) {\n      return NextResponse.next();\n    }\n\n    // Validate session\n    const validation = await this.validateSession(request);\n\n    if (!validation.isValid && validation.shouldLogout) {\n      console.log(`Auto-logout triggered: ${validation.reason}`);\n      return this.createLogoutResponse(request, validation.reason);\n    }\n\n    // Add user ID to request headers for downstream use\n    if (validation.userId) {\n      const requestHeaders = new Headers(request.headers);\n      requestHeaders.set('x-user-id', validation.userId);\n      \n      return NextResponse.next({\n        request: {\n          headers: requestHeaders,\n        },\n      });\n    }\n\n    return NextResponse.next();\n  }\n\n  /**\n   * Force logout user by clearing their session\n   */\n  static async forceLogout(userId: string, reason: string = 'Admin action'): Promise<void> {\n    try {\n      \n      // Update user session expiry to force logout\n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          sessionExpiry: new Date(), // Set to current time to expire immediately\n        },\n      });\n\n      console.log(`Force logout applied to user ${userId}: ${reason}`);\n    } catch (error) {\n      console.error('Force logout error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Extend user session\n   */\n  static async extendSession(\n    userId: string, \n    extensionMinutes: number = 60\n  ): Promise<void> {\n    try {\n      const newExpiry = new Date(Date.now() + extensionMinutes * 60 * 1000);\n      \n      await prisma.user.update({\n        where: { id: userId },\n        data: {\n          sessionExpiry: newExpiry,\n        },\n      });\n\n      console.log(`Session extended for user ${userId} until ${newExpiry.toISOString()}`);\n    } catch (error) {\n      console.error('Session extension error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check if session is about to expire (within warning threshold)\n   */\n  static async checkSessionExpiry(userId: string): Promise<{\n    isExpiring: boolean;\n    minutesRemaining?: number;\n    expiryTime?: Date;\n  }> {\n    try {\n      const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { sessionExpiry: true },\n      });\n\n      if (!user?.sessionExpiry) {\n        return { isExpiring: false };\n      }\n\n      const now = new Date();\n      const expiry = user.sessionExpiry;\n      const minutesRemaining = Math.floor((expiry.getTime() - now.getTime()) / (60 * 1000));\n\n      // Warn if session expires within 10 minutes\n      const isExpiring = minutesRemaining <= 10 && minutesRemaining > 0;\n\n      return {\n        isExpiring,\n        minutesRemaining: Math.max(0, minutesRemaining),\n        expiryTime: expiry,\n      };\n    } catch (error) {\n      console.error('Session expiry check error:', error);\n      return { isExpiring: false };\n    }\n  }\n\n  /**\n   * Get active sessions count for admin dashboard\n   */\n  static async getActiveSessionsCount(): Promise<number> {\n    try {\n      const fifteenMinutesAgo = new Date(Date.now() - 15 * 60 * 1000);\n      \n      const count = await prisma.user.count({\n        where: {\n          isActive: true,\n          lastActiveAt: {\n            gte: fifteenMinutesAgo,\n          },\n        },\n      });\n\n      return count;\n    } catch (error) {\n      console.error('Active sessions count error:', error);\n      return 0;\n    }\n  }\n}\n\n/**\n * API Route helper for session validation\n */\nexport async function validateApiSession(request: NextRequest): Promise<{\n  isValid: boolean;\n  userId?: string;\n  error?: string;\n}> {\n  const validation = await SessionValidationService.validateSession(request);\n  \n  if (!validation.isValid) {\n    return {\n      isValid: false,\n      error: validation.reason || 'Session invalid',\n    };\n  }\n\n  return {\n    isValid: true,\n    userId: validation.userId!,\n  };\n}\n\n/**\n * HOC for protecting API routes with session validation\n */\nexport function withSessionValidation(\n  handler: (request: NextRequest, context: any) => Promise<NextResponse>\n) {\n  return async (request: NextRequest, context: any): Promise<NextResponse> => {\n    const validation = await validateApiSession(request);\n    \n    if (!validation.isValid) {\n      return NextResponse.json(\n        { \n          error: 'Session invalid', \n          message: validation.error,\n          shouldLogout: true \n        },\n        { status: 401 }\n      );\n    }\n\n    // Add user ID to request for handler use\n    const requestHeaders = new Headers(request.headers);\n    requestHeaders.set('x-user-id', validation.userId!);\n    \n    const enhancedRequest = new NextRequest(request.url, {\n      ...request,\n      headers: requestHeaders,\n    });\n\n    return handler(enhancedRequest, context);\n  };\n}"
    },
    {
      "path": "src/providers/AppProvider.tsx",
      "lang": "tsx",
      "size": 717,
      "lines": 23,
      "hash": "6611302f3a1b379a2d81485a1227ffaea3feeb7ea171fd32c93ab5577b54d89d",
      "truncated": false,
      "content": "\"use client\";\n\nimport { SessionProvider } from \"next-auth/react\";\nimport { ThemeProvider } from \"@/context/ThemeContext\";\nimport SessionExpiryHandler from \"@/components/security/SessionExpiryHandler\";\nimport ToastContainer from \"@/components/ui/toast/ToastContainer\";\nimport { SocketProvider } from \"@/app/socket-provider\";\nimport { ReactNode } from \"react\";\n\nexport default function AppProviders({ children }: { children: ReactNode }) {\n  return (\n    <SessionProvider>\n      <ThemeProvider>\n        <SocketProvider>\n          <SessionExpiryHandler>\n            {children}\n            <ToastContainer />\n          </SessionExpiryHandler>\n        </SocketProvider>\n      </ThemeProvider>\n    </SessionProvider>\n  );\n}"
    },
    {
      "path": "src/server/events.ts",
      "lang": "ts",
      "size": 21835,
      "lines": 722,
      "hash": "93606309a46024c1ed542fabc02639a948c70ec9250128d481191bb275c405c6",
      "truncated": false,
      "content": "import { prisma } from '@/lib/singletons';\nimport { eventsPublisher } from './eventsPublisher';\nimport { notificationsPublisher } from './notificationsPublisher';\nimport type {\n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent\n} from '../shared/events';// Helper to count unread notifications\nasync function getUnreadCount(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId?: string): Promise<number> {\n  if (scope === 'admin') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'admin',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'reviewer') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'reviewer',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'approver') {\n    return await prisma.notification.count({\n      where: {\n        scope: 'approver',\n        reads: {\n          none: {}\n        }\n      }\n    });\n  } else if (scope === 'vendor' && vendorId) {\n    return await prisma.notification.count({\n      where: {\n        scope: 'vendor',\n        vendor_id: vendorId,\n        reads: {\n          none: {\n            vendor_id: vendorId\n          }\n        }\n      }\n    });\n  }\n  \n  return 0;\n}\n\nexport async function notifyAdminNewSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { user: true }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        type: 'new_submission',\n        title: 'Pengajuan Simlok Baru',\n        message: `Pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name}`,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name\n        })\n      }\n    });\n\n    // Emit events\n    const submissionEvent: AdminNewSubmissionEvent = {\n      submissionId,\n      createdAt: submission.created_at.toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'admin',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.adminNewSubmission(submissionEvent);\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count\n    const unreadCount = await getUnreadCount('admin');\n    const unreadCountEvent = {\n      scope: 'admin' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update stats\n    const totalPending = await prisma.submission.count({\n      where: { approval_status: 'PENDING' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'admin',\n      changes: {\n        pendingSubmissions: totalPending,\n        totalSubmissions: await prisma.submission.count()\n      }\n    });\n\n    // Also notify reviewers about new submission\n    await notifyReviewerNewSubmission(submissionId);\n\n    // Emit submission created event to reviewers\n    eventsPublisher.submissionCreated({\n      submissionId,\n      vendorName: submission.vendor_name,\n      officerName: submission.officer_name,\n      createdAt: submission.created_at.toISOString()\n    });\n\n  } catch (error) {\n    console.error('Error notifying admin new submission:', error);\n  }\n}\n\nexport async function notifyAdminNewVendor(vendorId: string) {\n  try {\n    // Get vendor details\n    const vendor = await prisma.user.findUnique({\n      where: { id: vendorId }\n    });\n\n    if (!vendor) {\n      throw new Error('Vendor not found');\n    }\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'admin',\n        type: 'new_vendor',\n        title: 'Pendaftaran Vendor Baru',\n        message: `Vendor baru mendaftar: ${vendor.vendor_name || vendor.officer_name}`,\n        data: JSON.stringify({\n          vendorId,\n          vendorName: vendor.vendor_name,\n          officerName: vendor.officer_name,\n          email: vendor.email\n        })\n      }\n    });\n\n    // Emit events\n    const vendorEvent: AdminNewVendorEvent = {\n      vendorId,\n      createdAt: vendor.created_at.toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'admin',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.adminNewVendor(vendorEvent);\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count\n    const unreadCount = await getUnreadCount('admin');\n    const unreadCountEvent = {\n      scope: 'admin' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update stats\n    const totalVendors = await prisma.user.count({\n      where: { role: 'VENDOR' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'admin',\n      changes: {\n        totalVendors\n      }\n    });\n\n  } catch (error) {\n    console.error('Error notifying admin new vendor:', error);\n  }\n}\n\nexport async function notifyVendorStatusChange(\n  vendorId: string, \n  submissionId: string, \n  status: 'PENDING' | 'APPROVED' | 'REJECTED'\n) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    const statusText = {\n      PENDING: 'Menunggu Persetujuan',\n      APPROVED: 'Disetujui',\n      REJECTED: 'Ditolak'\n    }[status];\n\n    // Truncate job description if too long\n    // const truncateText = (text: string, maxLength: number = 50) => {\n    //   return text.length > maxLength ? `${text.substring(0, maxLength)}...` : text;\n    // };\n\n    // const truncatedJobDescription = truncateText(submission.job_description);\n\n    // Create more informative title and message with submission ID\n    const title = status === 'APPROVED' \n      ? `Pengajuan Disetujui` \n      : status === 'REJECTED' \n        ? `Pengajuan Ditolak`\n        : `Pengajuan ${statusText}`;\n\n    const message = status === 'APPROVED'\n      ? `Selamat! Pengajuan Simlok Anda telah disetujui.`\n      : status === 'REJECTED'\n        ? `Pengajuan Simlok Anda ditolak. Silakan periksa keterangan pada pengajuan.`\n        : `Status pengajuan Simlok Anda berubah menjadi ${statusText.toLowerCase()}.`;\n\n    // Create notification record\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'vendor',\n        vendor_id: vendorId,\n        type: 'status_change',\n        title: title,\n        message: message,\n        data: JSON.stringify({\n          submissionId,\n          status,\n          jobDescription: submission.job_description\n        })\n      }\n    });\n\n    // Emit events\n    const statusEvent: VendorSubmissionStatusChangedEvent = {\n      submissionId,\n      status,\n      updatedAt: new Date().toISOString()\n    };\n\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'vendor',\n      vendorId,\n      createdAt: notification.created_at.toISOString()\n    };\n\n  eventsPublisher.vendorSubmissionStatusChanged(vendorId, statusEvent);\n  eventsPublisher.notificationNew(notificationEvent);\n  \n  // Emit specific submission finalized event\n  eventsPublisher.submissionFinalized(vendorId, {\n    submissionId,\n    finalStatus: status,\n    finalizedBy: 'Approver', // You might want to pass actual approver name\n    finalizedAt: new Date().toISOString()\n  });\n  \n  // Publish to real-time subscribers via Redis\n  await notificationsPublisher.publishNotification(notificationEvent);\n\n  // Update unread count\n  const unreadCount = await getUnreadCount('vendor', vendorId);\n  const unreadCountEvent = {\n    scope: 'vendor' as const,\n    vendorId,\n    unreadCount: unreadCount,\n    count: unreadCount\n  };\n  eventsPublisher.notificationUnreadCount(unreadCountEvent);\n  await notificationsPublisher.publishUnreadCount(unreadCountEvent);    // Update vendor stats\n    const vendorSubmissions = await prisma.submission.findMany({\n      where: { user_id: vendorId }\n    });\n\n    const stats = {\n      totalSubmissions: vendorSubmissions.length,\n      pendingSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'PENDING').length,\n      approvedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'APPROVED').length,\n      rejectedSubmissions: vendorSubmissions.filter((s: any) => s.approval_status === 'REJECTED').length\n    };\n\n    eventsPublisher.statsUpdate({\n      scope: 'vendor',\n      vendorId,\n      changes: stats\n    });\n\n  } catch (error) {\n    console.error('Error notifying vendor status change:', error);\n  }\n}\n\nexport async function notifyNotificationsRemoved(submissionId: string) {\n  try {\n    console.log(`Broadcasting notification removal for submission: ${submissionId}`);\n\n    // Create event for notification removal\n    const notificationRemovalEvent = {\n      submissionId,\n      timestamp: new Date().toISOString()\n    };\n\n    // Emit to Socket.io clients\n    eventsPublisher.notificationRemoved(notificationRemovalEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotificationRemoval(notificationRemovalEvent);\n\n    console.log(`✅ Broadcasted notification removal for submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error broadcasting notification removal:', error);\n  }\n}\n\nexport async function notifyReviewerNewUser(userId: string) {\n  try {\n    // Get user details\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    });\n\n    if (!user) {\n      throw new Error('User not found');\n    }\n\n    // Create notification record for reviewers\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'reviewer',\n        type: 'new_user_verification',\n        title: 'User Baru Perlu Verifikasi',\n        message: `User baru ${user.vendor_name || user.officer_name} perlu diverifikasi`,\n        data: JSON.stringify({\n          userId,\n          vendorName: user.vendor_name,\n          officerName: user.officer_name,\n          email: user.email,\n          phoneNumber: user.phone_number,\n          registrationDate: user.created_at.toISOString()\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'reviewer',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific user verification event\n    eventsPublisher.userVerificationNeeded({\n      userId,\n      vendorName: user.vendor_name || '',\n      officerName: user.officer_name,\n      email: user.email,\n      createdAt: user.created_at.toISOString()\n    });\n\n    // Update unread count for reviewers\n    const unreadCount = await getUnreadCount('reviewer');\n    const unreadCountEvent = {\n      scope: 'reviewer' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update reviewer stats\n    const totalPendingUsers = await prisma.user.count({\n      where: { \n        verified_at: null,\n        role: 'VENDOR' // Only vendor users need verification\n      }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingUserVerifications: totalPendingUsers\n      }\n    });\n\n    console.log(`✅ Notified reviewers about new user: ${userId}`);\n\n  } catch (error) {\n    console.error('Error notifying reviewer new user:', error);\n  }\n}\n\nexport async function notifyReviewerNewSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { user: true }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Create notification record for reviewers\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'reviewer',\n        type: 'new_submission_review',\n        title: 'Pengajuan Simlok Baru untuk Review',\n        message: `Ada pengajuan baru dari ${submission.vendor_name} - ${submission.officer_name} yang perlu direview`,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name,\n          jobDescription: submission.job_description\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'reviewer',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Update unread count for reviewers\n    const unreadCount = await getUnreadCount('reviewer');\n    const unreadCountEvent = {\n      scope: 'reviewer' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update reviewer stats\n    const totalPendingReview = await prisma.submission.count({\n      where: { review_status: 'PENDING_REVIEW' }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingReview: totalPendingReview,\n        totalSubmissions: await prisma.submission.count()\n      }\n    });\n\n    console.log(`✅ Notified reviewers about new submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error notifying reviewer new submission:', error);\n  }\n}\n\nexport async function notifyApproverReviewedSubmission(submissionId: string) {\n  try {\n    // Get submission details\n    const submission = await prisma.submission.findUnique({\n      where: { id: submissionId },\n      include: { \n        user: true,\n        reviewed_by_user: {\n          select: {\n            officer_name: true\n          }\n        }\n      }\n    });\n\n    if (!submission) {\n      throw new Error('Submission not found');\n    }\n\n    // Determine notification message and type based on review status\n    let notificationMessage: string;\n    let notificationType: string;\n    let notificationTitle: string;\n    \n    if (submission.review_status === 'MEETS_REQUIREMENTS') {\n      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan perlu persetujuan final`;\n      notificationType = 'reviewed_submission_approval';\n      notificationTitle = 'Pengajuan Simlok Perlu Persetujuan';\n    } else {\n      notificationMessage = `Pengajuan dari ${submission.vendor_name} - ${submission.officer_name} sudah direview dan tidak memenuhi syarat`;\n      notificationType = 'reviewed_submission_rejection';\n      notificationTitle = 'Pengajuan Simlok Sudah Direview';\n    }\n\n    // Create notification record for approvers (for both meets and doesn't meet requirements)\n    const notification = await prisma.notification.create({\n      data: {\n        scope: 'approver',\n        type: notificationType,\n        title: notificationTitle,\n        message: notificationMessage,\n        data: JSON.stringify({\n          submissionId,\n          vendorName: submission.vendor_name,\n          officerName: submission.officer_name,\n          jobDescription: submission.job_description,\n          reviewedBy: submission.reviewed_by_user?.officer_name,\n          reviewStatus: submission.review_status,\n          reviewNote: submission.review_note\n        })\n      }\n    });\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: notification.id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      data: notification.data,\n      scope: 'approver',\n      createdAt: notification.created_at.toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific submission reviewed event\n    eventsPublisher.submissionReviewed({\n      submissionId,\n      reviewStatus: submission.review_status,\n      reviewedBy: submission.reviewed_by_user?.officer_name || 'Unknown',\n      reviewedAt: new Date().toISOString()\n    });\n\n    // Update unread count for approvers\n    const unreadCount = await getUnreadCount('approver');\n    const unreadCountEvent = {\n      scope: 'approver' as const,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update approver stats\n    const totalPendingFinal = await prisma.submission.count({\n      where: { \n        review_status: 'MEETS_REQUIREMENTS',\n        final_status: 'PENDING_APPROVAL'\n      }\n    });\n\n    eventsPublisher.statsUpdate({\n      scope: 'approver',\n      changes: {\n        pendingFinalApproval: totalPendingFinal,\n        totalReviewedSubmissions: await prisma.submission.count({\n          where: { review_status: { not: 'PENDING_REVIEW' } }\n        })\n      }\n    });\n\n    console.log(`✅ Notified approvers about reviewed submission: ${submissionId}`);\n\n  } catch (error) {\n    console.error('Error notifying approver reviewed submission:', error);\n  }\n}\n\nexport async function notifyUserVerificationResult(\n  userId: string, \n  verificationStatus: 'VERIFY' | 'REJECT',\n  note?: string\n) {\n  try {\n    // Get user details\n    const user = await prisma.user.findUnique({\n      where: { id: userId }\n    });\n\n    if (!user) {\n      throw new Error('User not found');\n    }\n\n    const title = verificationStatus === 'VERIFY' \n      ? 'Akun Anda Telah Diverifikasi' \n      : 'Verifikasi Akun Ditolak';\n      \n    const message = verificationStatus === 'VERIFY'\n      ? 'Selamat! Akun vendor Anda telah diverifikasi dan sekarang dapat mengajukan permohonan Simlok.'\n      : `Maaf, akun vendor Anda tidak dapat diverifikasi. ${note || 'Silakan hubungi admin untuk informasi lebih lanjut.'}`;\n\n    // Create notification event\n    const notificationEvent: NotificationNewEvent = {\n      id: `temp_${Date.now()}`, // Will be replaced when notification is created\n      type: verificationStatus === 'VERIFY' ? 'user_verified' : 'user_rejected',\n      title: title,\n      message: message,\n      data: JSON.stringify({\n        userId,\n        verificationStatus,\n        note\n      }),\n      scope: 'vendor',\n      vendorId: userId,\n      createdAt: new Date().toISOString()\n    };\n\n    eventsPublisher.notificationNew(notificationEvent);\n    \n    // Publish to real-time subscribers via Redis\n    await notificationsPublisher.publishNotification(notificationEvent);\n\n    // Emit specific user verification result event\n    eventsPublisher.userVerificationResult(userId, {\n      userId,\n      status: verificationStatus,\n      verifiedAt: new Date().toISOString(),\n      note: note || ''\n    });\n\n    // Update unread count for the specific vendor\n    const unreadCount = await getUnreadCount('vendor', userId);\n    const unreadCountEvent = {\n      scope: 'vendor' as const,\n      vendorId: userId,\n      unreadCount: unreadCount,\n      count: unreadCount\n    };\n    eventsPublisher.notificationUnreadCount(unreadCountEvent);\n    await notificationsPublisher.publishUnreadCount(unreadCountEvent);\n\n    // Update vendor stats\n    const totalPendingUsers = await prisma.user.count({\n      where: { \n        verified_at: null,\n        role: 'VENDOR'\n      }\n    });\n\n    // Update reviewer stats  \n    eventsPublisher.statsUpdate({\n      scope: 'reviewer',\n      changes: {\n        pendingUserVerifications: totalPendingUsers\n      }\n    });\n\n    console.log(`✅ Notified user about verification result: ${userId} - ${verificationStatus}`);\n\n  } catch (error) {\n    console.error('Error notifying user verification result:', error);\n  }\n}\n\n// notifyReviewerFinalDecision function removed - reviewers no longer need notification when submissions are approved/rejected\n"
    },
    {
      "path": "src/server/eventsPublisher.ts",
      "lang": "ts",
      "size": 6437,
      "lines": 206,
      "hash": "d22b7f8a723b243cd524d66bc8f1afbe5cc438deb73cdb78980554be0de45749",
      "truncated": false,
      "content": "/**\n * Events Publisher Service\n * Handles all business event emissions to Socket.IO rooms\n */\n\nimport { getSocketIO } from '@/lib/singletons';\nimport { EVENT_NAMES, ROOMS } from '@/shared/events';\nimport type {\n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent,\n  NotificationUnreadCountEvent,\n  StatsUpdateEvent,\n} from '@/shared/events';\n\nclass EventsPublisher {\n  private io = getSocketIO();\n\n  /**\n   * Get Socket.IO instance (refreshed each call for HMR safety)\n   */\n  private getIO() {\n    if (!this.io) {\n      this.io = getSocketIO();\n    }\n    return this.io;\n  }\n\n  /**\n   * Emit event to admin room\n   */\n  private emitToAdmin(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.ADMIN).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to admin room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to reviewer room\n   */\n  private emitToReviewer(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.REVIEWER).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to reviewer room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to approver room\n   */\n  private emitToApprover(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.APPROVER).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to approver room:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit event to specific vendor room\n   */\n  private emitToVendor(vendorId: string, event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);\n      console.log(`[Events] Emitted ${event} to vendor ${vendorId}:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for event: ${event}`);\n    }\n  }\n\n  /**\n   * Emit new submission event to admin\n   */\n  adminNewSubmission(payload: AdminNewSubmissionEvent) {\n    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);\n  }\n\n  /**\n   * Emit new vendor registration to admin\n   */\n  adminNewVendor(payload: AdminNewVendorEvent) {\n    this.emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);\n  }\n\n  /**\n   * Emit submission status change to specific vendor\n   */\n  vendorSubmissionStatusChanged(vendorId: string, payload: VendorSubmissionStatusChangedEvent) {\n    this.emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);\n  }\n\n  /**\n   * Emit new notification\n   */\n  notificationNew(payload: NotificationNewEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);\n    }\n  }\n\n  /**\n   * Emit unread notification count update\n   */\n  notificationUnreadCount(payload: NotificationUnreadCountEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n    }\n  }\n\n  /**\n   * Emit stats update\n   */\n  statsUpdate(payload: StatsUpdateEvent) {\n    if (payload.scope === 'admin') {\n      this.emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'reviewer') {\n      this.emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'approver') {\n      this.emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);\n    } else if (payload.scope === 'vendor' && payload.vendorId) {\n      this.emitToVendor(payload.vendorId, EVENT_NAMES.STATS_UPDATE, payload);\n    }\n  }\n\n  /**\n   * Emit notification removal (broadcast to all clients)\n   */\n  notificationRemoved(payload: { submissionId: string; timestamp: string }) {\n    this.broadcast(EVENT_NAMES.NOTIFICATION_REMOVED, payload);\n  }\n\n  /**\n   * Emit submission reviewed event to approvers\n   */\n  submissionReviewed(payload: { submissionId: string; reviewStatus: string; reviewedBy: string; reviewedAt: string }) {\n    this.emitToApprover('submission:reviewed', payload);\n  }\n\n  /**\n   * Emit submission created event to reviewers\n   */\n  submissionCreated(payload: { submissionId: string; vendorName: string; officerName: string; createdAt: string }) {\n    this.emitToReviewer('submission:created', payload);\n  }\n\n  /**\n   * Emit submission finalized event to vendor\n   */\n  submissionFinalized(vendorId: string, payload: { submissionId: string; finalStatus: string; finalizedBy: string; finalizedAt: string }) {\n    this.emitToVendor(vendorId, 'submission:finalized', payload);\n  }\n\n  /**\n   * Emit user verification needed event to reviewers\n   */\n  userVerificationNeeded(payload: { userId: string; vendorName: string; officerName: string; email: string; createdAt: string }) {\n    this.emitToReviewer('user:verification-needed', payload);\n  }\n\n  /**\n   * Emit user verification result event to specific vendor\n   */\n  userVerificationResult(vendorId: string, payload: { userId: string; status: string; verifiedAt: string; note: string }) {\n    this.emitToVendor(vendorId, 'user:verification-result', payload);\n  }\n\n  /**\n   * Emit to all connected clients (use sparingly)\n   */\n  broadcast(event: string, payload: any) {\n    const io = this.getIO();\n    if (io) {\n      io.emit(event, payload);\n      console.log(`[Events] Broadcasted ${event}:`, payload);\n    } else {\n      console.warn(`[Events] Socket.IO not available for broadcast: ${event}`);\n    }\n  }\n}\n\n// Export singleton instance\nexport const eventsPublisher = new EventsPublisher();\n"
    },
    {
      "path": "src/server/notificationsPublisher.ts",
      "lang": "ts",
      "size": 4672,
      "lines": 150,
      "hash": "e77c8b5eb7045f53221228f41270376d63035e7cdac41ac11f9eb652b4fdea92",
      "truncated": false,
      "content": "/**\n * Real-time Notifications Publisher using Redis\n * Publishes notifications to Redis channels for Server-Sent Events\n */\n\nimport { redisPub } from '@/lib/singletons';\nimport type { NotificationNewEvent, NotificationUnreadCountEvent } from '@/shared/events';\n\nexport class NotificationsPublisher {\n  /**\n   * Publish new notification to real-time subscribers\n   */\n  async publishNotification(notification: NotificationNewEvent) {\n    try {\n      let channelName: string;\n      \n      switch (notification.scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${notification.vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown notification scope: ${notification.scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'notification:new',\n        data: notification\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📡 Published notification to ${channelName}:`, notification.title);\n    } catch (error) {\n      console.error('❌ Error publishing notification:', error);\n    }\n  }\n\n  /**\n   * Publish unread count update to real-time subscribers\n   */\n  async publishUnreadCount(update: NotificationUnreadCountEvent) {\n    try {\n      let channelName: string;\n      \n      switch (update.scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${update.vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown notification scope: ${update.scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'notification:unread_count',\n        data: update\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📊 Published unread count to ${channelName}:`, update.unreadCount);\n    } catch (error) {\n      console.error('❌ Error publishing unread count:', error);\n    }\n  }\n\n  /**\n   * Publish stats update to real-time subscribers\n   */\n  async publishStatsUpdate(scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, changes: Record<string, any>) {\n    try {\n      let channelName: string;\n      \n      switch (scope) {\n        case 'admin':\n          channelName = 'notifications:admin';\n          break;\n        case 'reviewer':\n          channelName = 'notifications:reviewer';\n          break;\n        case 'approver':\n          channelName = 'notifications:approver';\n          break;\n        case 'vendor':\n          channelName = `notifications:vendor:${vendorId}`;\n          break;\n        default:\n          throw new Error(`Unknown stats scope: ${scope}`);\n      }\n      \n      const message = JSON.stringify({\n        type: 'stats:update',\n        data: { scope, vendorId, changes }\n      });\n\n      await redisPub.publish(channelName, message);\n      console.log(`📈 Published stats update to ${channelName}:`, changes);\n    } catch (error) {\n      console.error('❌ Error publishing stats update:', error);\n    }\n  }\n\n  /**\n   * Publish notification removal to all subscribers\n   */\n  async publishNotificationRemoval(removal: { submissionId: string; timestamp: string }) {\n    try {\n      // Publish to both admin and vendor channels since notifications can affect both\n      const channels = ['notifications:admin'];\n      \n      // Also publish to all vendor channels (we could make this more specific later)\n      // For now, we'll just publish to admin and let clients handle filtering\n      \n      const message = JSON.stringify({\n        type: 'notification:removed',\n        data: removal\n      });\n\n      for (const channelName of channels) {\n        await redisPub.publish(channelName, message);\n      }\n      \n      // Also publish to a general notification channel that all clients can subscribe to\n      await redisPub.publish('notifications:all', message);\n      \n      console.log(`🗑️ Published notification removal for submission ${removal.submissionId}`);\n    } catch (error) {\n      console.error('❌ Error publishing notification removal:', error);\n    }\n  }\n}\n\n// Export singleton instance\nexport const notificationsPublisher = new NotificationsPublisher();\n"
    },
    {
      "path": "src/server/socket.ts",
      "lang": "ts",
      "size": 5398,
      "lines": 158,
      "hash": "7404c5a177a21307c83f60bbb1d6f9cfac445e2eb1142fbd68fb461d894dcb75",
      "truncated": false,
      "content": "import { Server } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\nimport { pubClient, subClient } from '../lib/redis';\nimport { EVENT_NAMES, ROOMS } from '../shared/events';\nimport type { \n  AdminNewSubmissionEvent,\n  AdminNewVendorEvent,\n  VendorSubmissionStatusChangedEvent,\n  NotificationNewEvent,\n  NotificationUnreadCountEvent,\n  StatsUpdateEvent\n} from '../shared/events';\n\ndeclare global {\n  var __socket_io: Server | undefined;\n}\n\nlet io: Server;\n\n// Use global Socket.IO instance from custom server or create new one\nif (typeof globalThis !== 'undefined' && (globalThis as any).__socket_io) {\n  io = (globalThis as any).__socket_io;\n} else {\n  // Fallback for development or API routes\n  if (process.env.NODE_ENV === 'production') {\n    io = new Server({\n      cors: {\n        origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n        methods: ['GET', 'POST'],\n      },\n    });\n  } else {\n    if (!globalThis.__socket_io) {\n      globalThis.__socket_io = new Server({\n        cors: {\n          origin: process.env.NEXTAUTH_URL || 'http://localhost:3000',\n          methods: ['GET', 'POST'],\n        },\n      });\n    }\n    io = globalThis.__socket_io;\n  }\n\n  // Set up Redis adapter only if not already set\n  if (!io.adapter || io.adapter.constructor.name === 'Adapter') {\n    try {\n      io.adapter(createAdapter(pubClient, subClient));\n      console.log('Redis adapter attached to Socket.IO');\n    } catch (error) {\n      console.error('Failed to attach Redis adapter:', error);\n    }\n  }\n}\n\n// Connection handler\nio.on('connection', (socket) => {\n  console.log('Client connected:', socket.id);\n\n  // Join rooms based on user role and vendor ID\n  socket.on('join', (data: { role: string; vendorId?: string }) => {\n    try {\n      const { role, vendorId } = data;\n      \n      if (role === 'ADMIN') {\n        socket.join(ROOMS.ADMIN);\n        console.log(`Socket ${socket.id} joined admin room`);\n      } else if (role === 'REVIEWER') {\n        socket.join(ROOMS.REVIEWER);\n        console.log(`Socket ${socket.id} joined reviewer room`);\n      } else if (role === 'APPROVER') {\n        socket.join(ROOMS.APPROVER);\n        console.log(`Socket ${socket.id} joined approver room`);\n      } else if (role === 'VENDOR' && vendorId) {\n        socket.join(ROOMS.VENDOR(vendorId));\n        console.log(`Socket ${socket.id} joined vendor room: ${vendorId}`);\n      }\n    } catch (error) {\n      console.error('Error joining room:', error);\n    }\n  });\n\n  socket.on('disconnect', () => {\n    console.log('Client disconnected:', socket.id);\n  });\n});\n\n// Helper functions for emitting events\nexport const emitToAdmin = (event: string, payload: any) => {\n  io.to(ROOMS.ADMIN).emit(event, payload);\n};\n\nexport const emitToReviewer = (event: string, payload: any) => {\n  io.to(ROOMS.REVIEWER).emit(event, payload);\n};\n\nexport const emitToApprover = (event: string, payload: any) => {\n  io.to(ROOMS.APPROVER).emit(event, payload);\n};\n\nexport const emitToVendor = (vendorId: string, event: string, payload: any) => {\n  io.to(ROOMS.VENDOR(vendorId)).emit(event, payload);\n};\n\nexport const emitBroadcast = (event: string, payload: any) => {\n  io.emit(event, payload);\n};\n\n// Typed emit functions\nexport const emitAdminNewSubmission = (payload: AdminNewSubmissionEvent) => {\n  emitToAdmin(EVENT_NAMES.ADMIN_NEW_SUBMISSION, payload);\n};\n\nexport const emitAdminNewVendor = (payload: AdminNewVendorEvent) => {\n  emitToAdmin(EVENT_NAMES.ADMIN_NEW_VENDOR, payload);\n};\n\nexport const emitVendorSubmissionStatusChanged = (vendorId: string, payload: VendorSubmissionStatusChangedEvent) => {\n  emitToVendor(vendorId, EVENT_NAMES.VENDOR_SUBMISSION_STATUS_CHANGED, payload);\n};\n\nexport const emitNotificationNew = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationNewEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.NOTIFICATION_NEW, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_NEW, payload);\n  }\n};\n\nexport const emitNotificationUnreadCount = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: NotificationUnreadCountEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.NOTIFICATION_UNREAD_COUNT, payload);\n  }\n};\n\nexport const emitStatsUpdate = (scope: 'admin' | 'vendor' | 'reviewer' | 'approver', vendorId: string | undefined, payload: StatsUpdateEvent) => {\n  if (scope === 'admin') {\n    emitToAdmin(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'reviewer') {\n    emitToReviewer(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'approver') {\n    emitToApprover(EVENT_NAMES.STATS_UPDATE, payload);\n  } else if (scope === 'vendor' && vendorId) {\n    emitToVendor(vendorId, EVENT_NAMES.STATS_UPDATE, payload);\n  }\n};\n\nexport { io };\n"
    },
    {
      "path": "src/services/FileCompressionService.ts",
      "lang": "ts",
      "size": 8977,
      "lines": 322,
      "hash": "71080790d4e5f846e4ec512912e18da35ebb71f01a60b4a6b36facce756873da",
      "truncated": false,
      "content": "/**\n * File Compression Service\n * Handles file compression with configurable quality and size limits\n */\n\nimport sharp from 'sharp';\nimport { writeFile, readFile } from 'fs/promises';\n\ninterface CompressionOptions {\n  maxSizeBytes: number;\n  quality: number;\n  format?: 'jpeg' | 'png' | 'webp';\n  maxWidth?: number;\n  maxHeight?: number;\n  outputDir?: string;\n}\n\ninterface CompressionResult {\n  success: boolean;\n  originalSize: number;\n  compressedSize: number;\n  compressionRatio: number;\n  filePath: string;\n  outputPath?: string;\n  error?: string;\n}\n\nexport class FileCompressionService {\n  private static readonly DEFAULT_QUALITY = 60;\n  private static readonly DEFAULT_MAX_SIZE = 2 * 1024 * 1024; // 2MB\n  private static readonly DEFAULT_MAX_WIDTH = 2048;\n  private static readonly DEFAULT_MAX_HEIGHT = 2048;\n\n  /**\n   * Compress an image file with specified options\n   */\n  static async compressImage(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    const config: CompressionOptions = {\n      maxSizeBytes: options.maxSizeBytes || this.DEFAULT_MAX_SIZE,\n      quality: options.quality || this.DEFAULT_QUALITY,\n      format: options.format || 'jpeg',\n      maxWidth: options.maxWidth || this.DEFAULT_MAX_WIDTH,\n      maxHeight: options.maxHeight || this.DEFAULT_MAX_HEIGHT,\n      outputDir: options.outputDir || '',\n    };\n\n    try {\n      // Read original file\n      const originalBuffer = await readFile(inputPath);\n      const originalSize = originalBuffer.length;\n\n      // If already within size limits, return as is\n      if (originalSize <= config.maxSizeBytes) {\n        return {\n          success: true,\n          originalSize,\n          compressedSize: originalSize,\n          compressionRatio: 1.0,\n          filePath: inputPath,\n          outputPath: inputPath,\n        };\n      }\n\n      // Get metadata\n      const metadata = await sharp(originalBuffer).metadata();\n      \n      // Determine output format\n      const outputFormat = config.format || this.getOutputFormat(metadata.format);\n      \n      // Calculate resize dimensions if needed\n      const { width, height } = this.calculateDimensions(\n        metadata.width || 0,\n        metadata.height || 0,\n        config.maxWidth!,\n        config.maxHeight!\n      );\n\n      // Start with initial quality\n      let currentQuality = config.quality;\n      let compressedBuffer: Buffer;\n      let iterations = 0;\n      const maxIterations = 5;\n\n      do {\n        // Apply compression\n        let sharpInstance = sharp(originalBuffer)\n          .resize(width, height, { \n            fit: 'inside',\n            withoutEnlargement: true \n          });\n\n        // Apply format-specific compression\n        switch (outputFormat) {\n          case 'jpeg':\n            sharpInstance = sharpInstance.jpeg({ \n              quality: currentQuality,\n              progressive: true,\n              mozjpeg: true\n            });\n            break;\n          case 'png':\n            sharpInstance = sharpInstance.png({ \n              quality: currentQuality,\n              compressionLevel: 9,\n              progressive: true\n            });\n            break;\n          case 'webp':\n            sharpInstance = sharpInstance.webp({ \n              quality: currentQuality,\n              effort: 6\n            });\n            break;\n        }\n\n        compressedBuffer = await sharpInstance.toBuffer();\n\n        // Check if size is acceptable\n        if (compressedBuffer.length <= config.maxSizeBytes || currentQuality <= 20) {\n          break;\n        }\n\n        // Reduce quality for next iteration\n        currentQuality = Math.max(20, currentQuality - 10);\n        iterations++;\n\n      } while (iterations < maxIterations);\n\n      // Generate output path\n      const outputPath = this.generateOutputPath(inputPath, outputFormat, config.outputDir);\n\n      // Save compressed file\n      await writeFile(outputPath, compressedBuffer);\n\n      const compressionRatio = compressedBuffer.length / originalSize;\n\n      console.log(`✅ Image compressed: ${this.formatFileSize(originalSize)} -> ${this.formatFileSize(compressedBuffer.length)} (${Math.round((1 - compressionRatio) * 100)}% reduction)`);\n\n      return {\n        success: true,\n        originalSize,\n        compressedSize: compressedBuffer.length,\n        compressionRatio,\n        filePath: inputPath,\n        outputPath,\n      };\n\n    } catch (error) {\n      console.error('Compression error:', error);\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: error instanceof Error ? error.message : 'Unknown compression error',\n      };\n    }\n  }\n\n  /**\n   * Compress a PDF file (placeholder - requires pdf-lib or similar)\n   */\n  static async compressPDF(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    try {\n      const originalBuffer = await readFile(inputPath);\n      const originalSize = originalBuffer.length;\n\n      // For now, just return the original if within limits\n      if (originalSize <= (options.maxSizeBytes || this.DEFAULT_MAX_SIZE)) {\n        return {\n          success: true,\n          originalSize,\n          compressedSize: originalSize,\n          compressionRatio: 1.0,\n          filePath: inputPath,\n          outputPath: inputPath,\n        };\n      }\n\n      // PDF compression would require additional libraries\n      console.warn('PDF compression not implemented yet');\n      return {\n        success: false,\n        originalSize,\n        compressedSize: originalSize,\n        compressionRatio: 1.0,\n        filePath: inputPath,\n        error: 'PDF compression not implemented',\n      };\n\n    } catch (error) {\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: error instanceof Error ? error.message : 'PDF compression failed',\n      };\n    }\n  }\n\n  /**\n   * Check if file type can be compressed\n   */\n  static canCompress(mimeType: string): boolean {\n    const compressibleTypes = [\n      'image/jpeg',\n      'image/jpg', \n      'image/png',\n      'image/webp',\n      'application/pdf'\n    ];\n    return compressibleTypes.includes(mimeType);\n  }\n\n  /**\n   * Generic file compression method\n   */\n  static async compressFile(\n    inputPath: string,\n    options: Partial<CompressionOptions> = {}\n  ): Promise<CompressionResult> {\n    // Detect file type from extension\n    const ext = inputPath.toLowerCase().split('.').pop();\n    \n    if (['jpg', 'jpeg', 'png', 'webp'].includes(ext || '')) {\n      return this.compressImage(inputPath, options);\n    } else if (ext === 'pdf') {\n      return this.compressPDF(inputPath, options);\n    } else {\n      return {\n        success: false,\n        originalSize: 0,\n        compressedSize: 0,\n        compressionRatio: 0,\n        filePath: inputPath,\n        error: `Unsupported file type: ${ext}`,\n      };\n    }\n  }\n\n  /**\n   * Calculate optimal dimensions while maintaining aspect ratio\n   */\n  private static calculateDimensions(\n    originalWidth: number,\n    originalHeight: number,\n    maxWidth: number,\n    maxHeight: number\n  ): { width: number; height: number } {\n    if (originalWidth <= maxWidth && originalHeight <= maxHeight) {\n      return { width: originalWidth, height: originalHeight };\n    }\n\n    const widthRatio = maxWidth / originalWidth;\n    const heightRatio = maxHeight / originalHeight;\n    const ratio = Math.min(widthRatio, heightRatio);\n\n    return {\n      width: Math.round(originalWidth * ratio),\n      height: Math.round(originalHeight * ratio),\n    };\n  }\n\n  /**\n   * Get appropriate output format based on input\n   */\n  private static getOutputFormat(inputFormat?: string): 'jpeg' | 'png' | 'webp' {\n    switch (inputFormat?.toLowerCase()) {\n      case 'png':\n        return 'png';\n      case 'webp':\n        return 'webp';\n      default:\n        return 'jpeg';\n    }\n  }\n\n  /**\n   * Generate output file path\n   */\n  private static generateOutputPath(\n    inputPath: string,\n    format: string,\n    outputDir?: string\n  ): string {\n    const pathParts = inputPath.split('/');\n    const fileName = pathParts.pop() || 'compressed';\n    const nameWithoutExt = fileName.split('.')[0];\n    const timestamp = Date.now();\n    \n    const outputFileName = `${nameWithoutExt}_compressed_${timestamp}.${format}`;\n    \n    if (outputDir) {\n      return `${outputDir}/${outputFileName}`;\n    }\n    \n    pathParts.push(outputFileName);\n    return pathParts.join('/');\n  }\n\n  /**\n   * Format file size for human display\n   */\n  static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 Bytes';\n    \n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  }\n}"
    },
    {
      "path": "src/services/FileValidationService.ts",
      "lang": "ts",
      "size": 11068,
      "lines": 375,
      "hash": "cac54f4afd1b6f96fd23796298699e27aa4d3286f1ca354bb2daa56503c2174b",
      "truncated": false,
      "content": "/**\n * File Validation Service\n * Comprehensive file type validation with security checks\n */\n\nimport { readFile } from 'fs/promises';\n\ninterface FileValidationResult {\n  isValid: boolean;\n  mimeType: string;\n  actualExtension: string;\n  size: number;\n  error?: string;\n  securityChecks: {\n    hasValidSignature: boolean;\n    isSafeExtension: boolean;\n    hasNoMaliciousContent: boolean;\n  };\n}\n\ninterface ValidationOptions {\n  allowedTypes: string[];\n  allowedExtensions: string[];\n  maxSize: number;\n  checkMagicBytes: boolean;\n  scanForMalware: boolean;\n}\n\nexport class FileValidationService {\n  // File signatures (magic bytes) for validation\n  private static readonly FILE_SIGNATURES = {\n    'image/jpeg': [\n      [0xFF, 0xD8, 0xFF],\n    ],\n    'image/png': [\n      [0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A],\n    ],\n    'application/pdf': [\n      [0x25, 0x50, 0x44, 0x46], // %PDF\n    ],\n    'application/msword': [\n      [0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1], // .doc\n    ],\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': [\n      [0x50, 0x4B, 0x03, 0x04], // .docx (ZIP-based)\n      [0x50, 0x4B, 0x05, 0x06], // .docx (empty ZIP)\n      [0x50, 0x4B, 0x07, 0x08], // .docx (spanned ZIP)\n    ],\n  };\n\n  // Allowed file types for SIMLOK system\n  private static readonly DEFAULT_ALLOWED_TYPES = [\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  ];\n\n  private static readonly DEFAULT_ALLOWED_EXTENSIONS = [\n    '.jpg',\n    '.jpeg',\n    '.png', \n    '.pdf',\n    '.doc',\n    '.docx',\n  ];\n\n  // Dangerous file extensions that should never be allowed\n  private static readonly DANGEROUS_EXTENSIONS = [\n    '.exe', '.bat', '.cmd', '.com', '.pif', '.scr', '.vbs', '.js',\n    '.jar', '.app', '.deb', '.pkg', '.dmg', '.rpm', '.msi',\n    '.sh', '.bash', '.zsh', '.fish', '.ps1', '.psm1',\n  ];\n\n  // Malicious patterns to check for\n  private static readonly MALICIOUS_PATTERNS = [\n    /javascript:/gi,\n    /vbscript:/gi,\n    /onload=/gi,\n    /onerror=/gi,\n    /<script[^>]*>/gi,\n    /<iframe[^>]*>/gi,\n    /eval\\(/gi,\n    /document\\.write/gi,\n  ];\n\n  /**\n   * Comprehensive file validation\n   */\n  static async validateFile(\n    filePath: string,\n    originalName: string,\n    options: Partial<ValidationOptions> = {}\n  ): Promise<FileValidationResult> {\n    const config: ValidationOptions = {\n      allowedTypes: options.allowedTypes || this.DEFAULT_ALLOWED_TYPES,\n      allowedExtensions: options.allowedExtensions || this.DEFAULT_ALLOWED_EXTENSIONS,\n      maxSize: options.maxSize || 10 * 1024 * 1024, // 10MB default\n      checkMagicBytes: options.checkMagicBytes ?? true,\n      scanForMalware: options.scanForMalware ?? true,\n    };\n\n    try {\n      const fileBuffer = await readFile(filePath);\n      const fileSize = fileBuffer.length;\n      \n      // Extract extension from original filename\n      const extension = this.getFileExtension(originalName);\n      \n      // Basic size validation\n      if (fileSize > config.maxSize) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File size ${this.formatFileSize(fileSize)} exceeds maximum allowed size ${this.formatFileSize(config.maxSize)}`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Check for dangerous extensions\n      if (this.DANGEROUS_EXTENSIONS.includes(extension.toLowerCase())) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File extension '${extension}' is not allowed for security reasons`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Extension validation\n      const isSafeExtension = config.allowedExtensions.includes(extension.toLowerCase());\n      if (!isSafeExtension) {\n        return {\n          isValid: false,\n          mimeType: '',\n          actualExtension: extension,\n          size: fileSize,\n          error: `File extension '${extension}' is not allowed. Allowed extensions: ${config.allowedExtensions.join(', ')}`,\n          securityChecks: {\n            hasValidSignature: false,\n            isSafeExtension: false,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Detect actual MIME type from file signature\n      const actualMimeType = this.detectMimeType(fileBuffer);\n      \n      // Magic bytes validation\n      let hasValidSignature = true;\n      if (config.checkMagicBytes && actualMimeType) {\n        hasValidSignature = this.validateFileSignature(fileBuffer, actualMimeType);\n        if (!hasValidSignature) {\n          return {\n            isValid: false,\n            mimeType: actualMimeType,\n            actualExtension: extension,\n            size: fileSize,\n            error: 'File signature does not match file extension (possible file tampering)',\n            securityChecks: {\n              hasValidSignature: false,\n              isSafeExtension: isSafeExtension,\n              hasNoMaliciousContent: false,\n            },\n          };\n        }\n      }\n\n      // MIME type validation\n      const mimeType = actualMimeType || this.getMimeTypeFromExtension(extension);\n      if (!config.allowedTypes.includes(mimeType)) {\n        return {\n          isValid: false,\n          mimeType,\n          actualExtension: extension,\n          size: fileSize,\n          error: `File type '${mimeType}' is not allowed. Allowed types: ${config.allowedTypes.join(', ')}`,\n          securityChecks: {\n            hasValidSignature,\n            isSafeExtension,\n            hasNoMaliciousContent: false,\n          },\n        };\n      }\n\n      // Malware/malicious content scan\n      let hasNoMaliciousContent = true;\n      if (config.scanForMalware) {\n        hasNoMaliciousContent = this.scanForMaliciousContent(fileBuffer);\n        if (!hasNoMaliciousContent) {\n          return {\n            isValid: false,\n            mimeType,\n            actualExtension: extension,\n            size: fileSize,\n            error: 'File contains potentially malicious content',\n            securityChecks: {\n              hasValidSignature,\n              isSafeExtension,\n              hasNoMaliciousContent: false,\n            },\n          };\n        }\n      }\n\n      return {\n        isValid: true,\n        mimeType,\n        actualExtension: extension,\n        size: fileSize,\n        securityChecks: {\n          hasValidSignature,\n          isSafeExtension,\n          hasNoMaliciousContent,\n        },\n      };\n\n    } catch (error) {\n      return {\n        isValid: false,\n        mimeType: '',\n        actualExtension: '',\n        size: 0,\n        error: error instanceof Error ? error.message : 'File validation failed',\n        securityChecks: {\n          hasValidSignature: false,\n          isSafeExtension: false,\n          hasNoMaliciousContent: false,\n        },\n      };\n    }\n  }\n\n  /**\n   * Detect MIME type from file signature (magic bytes)\n   */\n  private static detectMimeType(buffer: Buffer): string {\n    for (const [mimeType, signatures] of Object.entries(this.FILE_SIGNATURES)) {\n      for (const signature of signatures) {\n        if (this.checkSignature(buffer, signature)) {\n          return mimeType;\n        }\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Check if buffer starts with given signature\n   */\n  private static checkSignature(buffer: Buffer, signature: number[]): boolean {\n    if (buffer.length < signature.length) return false;\n    \n    for (let i = 0; i < signature.length; i++) {\n      if (buffer[i] !== signature[i]) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Validate file signature against expected MIME type\n   */\n  private static validateFileSignature(buffer: Buffer, mimeType: string): boolean {\n    const signatures = this.FILE_SIGNATURES[mimeType as keyof typeof this.FILE_SIGNATURES];\n    if (!signatures) return true; // Allow if no signature defined\n    \n    return signatures.some(signature => this.checkSignature(buffer, signature));\n  }\n\n  /**\n   * Get file extension from filename\n   */\n  private static getFileExtension(filename: string): string {\n    const lastDot = filename.lastIndexOf('.');\n    return lastDot !== -1 ? filename.substring(lastDot).toLowerCase() : '';\n  }\n\n  /**\n   * Get MIME type from file extension\n   */\n  private static getMimeTypeFromExtension(extension: string): string {\n    const mimeMap: Record<string, string> = {\n      '.jpg': 'image/jpeg',\n      '.jpeg': 'image/jpeg',\n      '.png': 'image/png',\n      '.pdf': 'application/pdf',\n      '.doc': 'application/msword',\n      '.docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    };\n    \n    return mimeMap[extension.toLowerCase()] || 'application/octet-stream';\n  }\n\n  /**\n   * Scan for malicious content patterns\n   */\n  private static scanForMaliciousContent(buffer: Buffer): boolean {\n    const content = buffer.toString('utf8', 0, Math.min(buffer.length, 8192)); // Check first 8KB\n    \n    return !this.MALICIOUS_PATTERNS.some(pattern => pattern.test(content));\n  }\n\n  /**\n   * Format file size for display\n   */\n  private static formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 Bytes';\n    \n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    \n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  }\n\n  /**\n   * Validate specific file types for SIMLOK categories\n   */\n  static validateSIMLOKFile(\n    filePath: string,\n    originalName: string,\n    category: 'sika' | 'simja' | 'id_card' | 'other'\n  ): Promise<FileValidationResult> {\n    let allowedTypes: string[];\n    let allowedExtensions: string[];\n\n    switch (category) {\n      case 'id_card':\n        // ID Card should be images only\n        allowedTypes = ['image/jpeg', 'image/png'];\n        allowedExtensions = ['.jpg', '.jpeg', '.png'];\n        break;\n        \n      case 'sika':\n      case 'simja':\n        // Documents can be images or PDFs\n        allowedTypes = [\n          'image/jpeg',\n          'image/png', \n          'application/pdf',\n          'application/msword',\n          'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n        ];\n        allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx'];\n        break;\n        \n      default:\n        allowedTypes = this.DEFAULT_ALLOWED_TYPES;\n        allowedExtensions = this.DEFAULT_ALLOWED_EXTENSIONS;\n    }\n\n    return this.validateFile(filePath, originalName, {\n      allowedTypes,\n      allowedExtensions,\n      maxSize: 10 * 1024 * 1024, // 10MB\n      checkMagicBytes: true,\n      scanForMalware: true,\n    });\n  }\n}"
    },
    {
      "path": "src/shared/dto.ts",
      "lang": "ts",
      "size": 3593,
      "lines": 119,
      "hash": "348bd51d9fa5fb6aa50cb616e888fae9c7591c78819220b11fae25b02e14e92a",
      "truncated": false,
      "content": "/**\n * Shared DTOs and validation schemas for API routes\n */\n\nimport { z } from 'zod';\n\n// Common response schemas\nexport const ApiErrorSchema = z.object({\n  error: z.string(),\n  message: z.string(),\n  code: z.string().optional(),\n});\n\nexport const ApiSuccessSchema = z.object({\n  success: z.boolean(),\n  data: z.any().optional(),\n  message: z.string().optional(),\n});\n\n// Pagination schemas\nexport const PaginationQuerySchema = z.object({\n  cursor: z.string().optional().nullable(),\n  limit: z.coerce.number().int().positive().max(100).default(10),\n});\n\nexport const PaginatedResponseSchema = z.object({\n  data: z.array(z.any()),\n  pagination: z.object({\n    nextCursor: z.string().nullable(),\n    hasMore: z.boolean(),\n    total: z.number().optional(),\n  }),\n});\n\n// Notification schemas\nexport const NotificationsQuerySchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n}).merge(PaginationQuerySchema);\n\nexport const NotificationSchema = z.object({\n  id: z.string(),\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().nullable(),\n  type: z.string(),\n  title: z.string(),\n  message: z.string(),\n  data: z.string().nullable(),\n  createdAt: z.string(),\n  isRead: z.boolean(),\n});\n\nexport const MarkAsReadSchema = z.object({\n  notificationId: z.string(),\n});\n\nexport const MarkAllAsReadSchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n});\n\n// Submission schemas\nexport const SubmissionStatusSchema = z.enum(['PENDING', 'APPROVED', 'REJECTED']);\n\nexport const CreateSubmissionSchema = z.object({\n  vendor_name: z.string().min(1),\n  based_on: z.string().min(1),\n  officer_name: z.string().min(1),\n  job_description: z.string().min(1),\n  work_location: z.string().min(1),\n  implementation: z.string().optional(),\n  working_hours: z.string().min(1),\n  other_notes: z.string().optional(),\n  work_facilities: z.string().min(1),\n  worker_names: z.string().min(1),\n  content: z.string().optional(),\n  notes: z.string().optional(),\n  signer_position: z.string().optional(),\n  signer_name: z.string().optional(),\n});\n\nexport const UpdateSubmissionStatusSchema = z.object({\n  status: SubmissionStatusSchema,\n  notes: z.string().optional(),\n});\n\n// User/Vendor schemas\nexport const CreateVendorSchema = z.object({\n  officer_name: z.string().min(1),\n  email: z.string().email(),\n  password: z.string().min(6),\n  vendor_name: z.string().min(1),\n  address: z.string().optional(),\n  phone_number: z.string().optional(),\n});\n\nexport const UpdateVendorStatusSchema = z.object({\n  verified: z.boolean(),\n});\n\n// Stats schemas\nexport const StatsQuerySchema = z.object({\n  scope: z.enum(['admin', 'vendor']),\n  vendorId: z.string().optional().nullable(),\n  range: z.enum(['day', 'week', 'month', 'year']).default('month'),\n});\n\n// Type exports\nexport type ApiError = z.infer<typeof ApiErrorSchema>;\nexport type ApiSuccess = z.infer<typeof ApiSuccessSchema>;\nexport type PaginationQuery = z.infer<typeof PaginationQuerySchema>;\nexport type PaginatedResponse = z.infer<typeof PaginatedResponseSchema>;\nexport type NotificationsQuery = z.infer<typeof NotificationsQuerySchema>;\nexport type NotificationDto = z.infer<typeof NotificationSchema>;\nexport type CreateSubmissionDto = z.infer<typeof CreateSubmissionSchema>;\nexport type UpdateSubmissionStatusDto = z.infer<typeof UpdateSubmissionStatusSchema>;\nexport type CreateVendorDto = z.infer<typeof CreateVendorSchema>;\nexport type StatsQuery = z.infer<typeof StatsQuerySchema>;\n"
    },
    {
      "path": "src/shared/events.ts",
      "lang": "ts",
      "size": 2708,
      "lines": 83,
      "hash": "e39a702c90c3aac1c58126c59ed599afca216223f97f78cdeee472023151714c",
      "truncated": false,
      "content": "import { z } from 'zod';\n\n// Event schemas\nexport const AdminNewSubmissionEvent = z.object({\n  submissionId: z.string(),\n  createdAt: z.string(),\n});\n\nexport const AdminNewVendorEvent = z.object({\n  vendorId: z.string(),\n  createdAt: z.string(),\n});\n\nexport const VendorSubmissionStatusChangedEvent = z.object({\n  submissionId: z.string(),\n  status: z.enum(['PENDING', 'APPROVED', 'REJECTED']),\n  updatedAt: z.string(),\n});\n\nexport const NotificationNewEvent = z.object({\n  id: z.string(),\n  type: z.string(),\n  title: z.string(),\n  message: z.string(),\n  data: z.string().nullable().optional(),\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  createdAt: z.string(),\n});\n\nexport const NotificationUnreadCountEvent = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  unreadCount: z.number(),\n  count: z.number(), // Legacy field for backward compatibility\n});\n\nexport const GetNotificationsSchema = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional().nullable(),\n  cursor: z.string().optional().nullable(),\n  limit: z.number().int().positive().max(100).default(10).optional(),\n});\n\nexport const StatsUpdateEvent = z.object({\n  scope: z.enum(['admin', 'vendor', 'reviewer', 'approver']),\n  vendorId: z.string().optional(),\n  changes: z.record(z.string(), z.union([z.number(), z.string()])),\n});\n\nexport const NotificationRemovedEvent = z.object({\n  submissionId: z.string(),\n  timestamp: z.string(),\n});\n\n// Event types\nexport type AdminNewSubmissionEvent = z.infer<typeof AdminNewSubmissionEvent>;\nexport type AdminNewVendorEvent = z.infer<typeof AdminNewVendorEvent>;\nexport type VendorSubmissionStatusChangedEvent = z.infer<typeof VendorSubmissionStatusChangedEvent>;\nexport type NotificationNewEvent = z.infer<typeof NotificationNewEvent>;\nexport type NotificationUnreadCountEvent = z.infer<typeof NotificationUnreadCountEvent>;\nexport type StatsUpdateEvent = z.infer<typeof StatsUpdateEvent>;\nexport type NotificationRemovedEvent = z.infer<typeof NotificationRemovedEvent>;\n\n// Event names\nexport const EVENT_NAMES = {\n  ADMIN_NEW_SUBMISSION: 'admin:new_submission',\n  ADMIN_NEW_VENDOR: 'admin:new_vendor',\n  VENDOR_SUBMISSION_STATUS_CHANGED: 'vendor:submission_status_changed',\n  NOTIFICATION_NEW: 'notification:new',\n  NOTIFICATION_UNREAD_COUNT: 'notification:unread_count',\n  NOTIFICATION_REMOVED: 'notification:removed',\n  STATS_UPDATE: 'stats:update',\n} as const;\n\n// Room names\nexport const ROOMS = {\n  ADMIN: 'admin',\n  REVIEWER: 'reviewer',\n  APPROVER: 'approver',\n  VENDOR: (vendorId: string) => `vendor:${vendorId}`,\n} as const;\n"
    },
    {
      "path": "src/store/lists.ts",
      "lang": "ts",
      "size": 2163,
      "lines": 83,
      "hash": "333c6cba1c5ce6e75fa3a945055b01ca3ac98ffd5e4ee584ddb149631503e297",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\nexport interface SubmissionListItem {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  job_description: string;\n  approval_status: string;\n  created_at: string;\n  work_location: string;\n}\n\nexport interface VendorListItem {\n  id: string;\n  vendor_name: string;\n  officer_name: string;\n  email: string;\n  created_at: string;\n  verified_at: string | null;\n}\n\ninterface ListsState {\n  submissions: SubmissionListItem[];\n  vendors: VendorListItem[];\n  submissionsLoading: boolean;\n  vendorsLoading: boolean;\n}\n\ninterface ListsActions {\n  setSubmissions: (submissions: SubmissionListItem[]) => void;\n  addSubmission: (submission: SubmissionListItem) => void;\n  updateSubmission: (id: string, updates: Partial<SubmissionListItem>) => void;\n  setVendors: (vendors: VendorListItem[]) => void;\n  addVendor: (vendor: VendorListItem) => void;\n  updateVendor: (id: string, updates: Partial<VendorListItem>) => void;\n  setSubmissionsLoading: (loading: boolean) => void;\n  setVendorsLoading: (loading: boolean) => void;\n  reset: () => void;\n}\n\nexport type ListsStore = ListsState & ListsActions;\n\nconst initialState: ListsState = {\n  submissions: [],\n  vendors: [],\n  submissionsLoading: false,\n  vendorsLoading: false,\n};\n\nexport const useListsStore = create<ListsStore>((set) => ({\n  ...initialState,\n\n  setSubmissions: (submissions) => set({ submissions }),\n\n  addSubmission: (submission) => set((state) => ({\n    submissions: [submission, ...state.submissions],\n  })),\n\n  updateSubmission: (id, updates) => set((state) => ({\n    submissions: state.submissions.map(item => \n      item.id === id ? { ...item, ...updates } : item\n    ),\n  })),\n\n  setVendors: (vendors) => set({ vendors }),\n\n  addVendor: (vendor) => set((state) => ({\n    vendors: [vendor, ...state.vendors],\n  })),\n\n  updateVendor: (id, updates) => set((state) => ({\n    vendors: state.vendors.map(item => \n      item.id === id ? { ...item, ...updates } : item\n    ),\n  })),\n\n  setSubmissionsLoading: (loading) => set({ submissionsLoading: loading }),\n\n  setVendorsLoading: (loading) => set({ vendorsLoading: loading }),\n\n  reset: () => set(initialState),\n}));\n"
    },
    {
      "path": "src/store/notifications.ts",
      "lang": "ts",
      "size": 6168,
      "lines": 197,
      "hash": "054147c1b35fb61fe09313460c617123db59adb26842f9bd89ebc4af4fd99d43",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\nexport interface Notification {\n  id: string;\n  type: string;\n  title: string;\n  message: string;\n  data?: any;\n  createdAt: string;\n  isRead: boolean;\n}\n\ninterface NotificationsState {\n  items: Notification[];\n  unreadCount: number;\n  loading: boolean;\n  hasMore: boolean;\n  cursor: string | null;\n}\n\ninterface NotificationsActions {\n  setItems: (items: Notification[]) => void;\n  addItem: (item: Notification) => void;\n  removeNotifications: (submissionId: string) => void;\n  setUnreadCount: (count: number) => void;\n  markAsRead: (id: string) => Promise<void>;\n  markAllAsRead: (scope?: string, vendorId?: string) => Promise<void>;\n  setLoading: (loading: boolean) => void;\n  setHasMore: (hasMore: boolean) => void;\n  setCursor: (cursor: string | null) => void;\n  reset: () => void;\n}\n\nexport type NotificationsStore = NotificationsState & NotificationsActions;\n\nconst initialState: NotificationsState = {\n  items: [],\n  unreadCount: 0,\n  loading: false,\n  hasMore: true,\n  cursor: null,\n};\n\nexport const useNotificationsStore = create<NotificationsStore>((set) => ({\n  ...initialState,\n\n  setItems: (items) => set({ items }),\n\n  addItem: (item) => set((state) => ({\n    items: [item, ...state.items],\n    unreadCount: item.isRead ? state.unreadCount : state.unreadCount + 1,\n  })),\n\n  removeNotifications: (submissionId) => set((state) => {\n    // Filter out notifications that reference the deleted submission\n    const filteredItems = state.items.filter(item => {\n      // Check if notification data contains the submission ID\n      if (item.data) {\n        try {\n          const data = typeof item.data === 'string' ? JSON.parse(item.data) : item.data;\n          if (data.submissionId === submissionId || data.submission_id === submissionId) {\n            return false; // Remove this notification\n          }\n        } catch (e) {\n          // If parsing fails, check message/title\n        }\n      }\n      \n      // Check message and title for submission ID\n      const hasIdInMessage = item.message.includes(submissionId);\n      const hasIdInTitle = item.title.includes(submissionId);\n      \n      return !hasIdInMessage && !hasIdInTitle; // Keep if ID not found\n    });\n    \n    // Calculate how many unread notifications were removed\n    const removedUnreadCount = state.items.filter(item => {\n      if (item.isRead) return false; // Skip already read notifications\n      \n      // Check if this notification references the deleted submission\n      if (item.data) {\n        try {\n          const data = typeof item.data === 'string' ? JSON.parse(item.data) : item.data;\n          if (data.submissionId === submissionId || data.submission_id === submissionId) {\n            return true; // This unread notification will be removed\n          }\n        } catch (e) {\n          // If parsing fails, check message/title\n        }\n      }\n      \n      const hasIdInMessage = item.message.includes(submissionId);\n      const hasIdInTitle = item.title.includes(submissionId);\n      \n      return hasIdInMessage || hasIdInTitle; // Count if ID found\n    }).length;\n    \n    console.log(`Removing ${state.items.length - filteredItems.length} notifications for submission ${submissionId}`);\n    console.log(`Reducing unread count by ${removedUnreadCount}`);\n    \n    return {\n      items: filteredItems,\n      unreadCount: Math.max(0, state.unreadCount - removedUnreadCount),\n    };\n  }),\n\n  setUnreadCount: (count) => set({ unreadCount: count }),\n\n  markAsRead: async (id) => {\n    // Update local state optimistically\n    set((state) => ({\n      items: state.items.map(item => \n        item.id === id ? { ...item, isRead: true } : item\n      ),\n      unreadCount: Math.max(0, state.unreadCount - 1),\n    }));\n\n    // Make API call to update server\n    try {\n      const response = await fetch(`/api/v1/notifications/${id}/read`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        // Update unread count from server response\n        if (result.data?.unreadCount !== undefined) {\n          set({ unreadCount: result.data.unreadCount });\n        }\n        console.log('✅ Notification marked as read on server:', id);\n      } else {\n        console.error('❌ Failed to mark notification as read on server:', response.statusText);\n        // Revert optimistic update on failure\n        set((state) => ({\n          items: state.items.map(item => \n            item.id === id ? { ...item, isRead: false } : item\n          ),\n          unreadCount: state.unreadCount + 1,\n        }));\n      }\n    } catch (error) {\n      console.error('💥 Error marking notification as read:', error);\n      // Revert optimistic update on error\n      set((state) => ({\n        items: state.items.map(item => \n          item.id === id ? { ...item, isRead: false } : item\n        ),\n        unreadCount: state.unreadCount + 1,\n      }));\n    }\n  },\n\n  markAllAsRead: async (scope?: string, vendorId?: string) => {\n    // Update local state optimistically\n    set((state) => ({\n      items: state.items.map(item => ({ ...item, isRead: true })),\n      unreadCount: 0,\n    }));\n\n    // Make API call to update server\n    try {\n      const response = await fetch('/api/v1/notifications/read-all', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          scope,\n          vendorId,\n        }),\n      });\n\n      if (response.ok) {\n        await response.json(); // Consume response\n        console.log('✅ All notifications marked as read on server');\n        // Ensure unread count is 0\n        set({ unreadCount: 0 });\n      } else {\n        console.error('❌ Failed to mark all notifications as read on server:', response.statusText);\n      }\n    } catch (error) {\n      console.error('💥 Error marking all notifications as read:', error);\n    }\n  },\n\n  setLoading: (loading) => set({ loading }),\n\n  setHasMore: (hasMore) => set({ hasMore }),\n\n  setCursor: (cursor) => set({ cursor }),\n\n  reset: () => set(initialState),\n}));\n"
    },
    {
      "path": "src/store/stats.ts",
      "lang": "ts",
      "size": 1374,
      "lines": 60,
      "hash": "ac3e2fbdf61fb25177e3cfae0e9f85a3bd641b66e6af06478eeff08af5aede73",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\ninterface StatsState {\n  // Admin stats\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  totalVendors: number;\n  \n  // Vendor stats\n  vendorTotalSubmissions: number;\n  vendorPendingSubmissions: number;\n  vendorApprovedSubmissions: number;\n  vendorRejectedSubmissions: number;\n  \n  loading: boolean;\n}\n\ninterface StatsActions {\n  updateStats: (changes: Record<string, number | string>) => void;\n  setLoading: (loading: boolean) => void;\n  reset: () => void;\n}\n\nexport type StatsStore = StatsState & StatsActions;\n\nconst initialState: StatsState = {\n  totalSubmissions: 0,\n  pendingSubmissions: 0,\n  approvedSubmissions: 0,\n  rejectedSubmissions: 0,\n  totalVendors: 0,\n  vendorTotalSubmissions: 0,\n  vendorPendingSubmissions: 0,\n  vendorApprovedSubmissions: 0,\n  vendorRejectedSubmissions: 0,\n  loading: false,\n};\n\nexport const useStatsStore = create<StatsStore>((set) => ({\n  ...initialState,\n\n  updateStats: (changes) => set((state) => {\n    const newState = { ...state };\n    \n    Object.entries(changes).forEach(([key, value]) => {\n      if (typeof value === 'number' && key in newState) {\n        (newState as any)[key] = value;\n      }\n    });\n    \n    return newState;\n  }),\n\n  setLoading: (loading) => set({ loading }),\n\n  reset: () => set(initialState),\n}));\n"
    },
    {
      "path": "src/store/useStatsStore.ts",
      "lang": "ts",
      "size": 2357,
      "lines": 87,
      "hash": "8a1bfd9aac04836272361737966fe73bebf9fd7bbc7579b976b64d95b0ce7106",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\ninterface AdminStats {\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  totalUsers: number;\n  pendingUsers: number;\n  totalVendors: number;\n  totalVerifiers: number;\n  pendingVerificationVendors: number;\n  pendingVerificationSubmissions: number;\n}\n\ninterface VendorStats {\n  totalSubmissions: number;\n  pendingSubmissions: number;\n  approvedSubmissions: number;\n  rejectedSubmissions: number;\n  draftSubmissions: number;\n  totalApproved: number;\n  totalPending: number;\n  totalRejected: number;\n}\n\ninterface StatsStore {\n  adminStats: AdminStats | null;\n  vendorStats: VendorStats | null;\n  loading: boolean;\n  error: string | null;\n  \n  // Actions\n  setAdminStats: (stats: AdminStats) => void;\n  setVendorStats: (stats: VendorStats) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  fetchAdminStats: () => Promise<void>;\n  fetchVendorStats: () => Promise<void>;\n}\n\nexport const useStatsStore = create<StatsStore>((set) => ({\n  adminStats: null,\n  vendorStats: null,\n  loading: false,\n  error: null,\n\n  setAdminStats: (stats) => set({ adminStats: stats }),\n  setVendorStats: (stats) => set({ vendorStats: stats }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n\n  fetchAdminStats: async () => {\n    try {\n      set({ loading: true, error: null });\n      const response = await fetch('/api/admin/dashboard/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch admin stats');\n      }\n      const stats = await response.json();\n      set({ adminStats: stats, loading: false });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch stats',\n        loading: false \n      });\n    }\n  },\n\n  fetchVendorStats: async () => {\n    try {\n      set({ loading: true, error: null });\n      const response = await fetch('/api/vendor/dashboard/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor stats');\n      }\n      const stats = await response.json();\n      set({ vendorStats: stats, loading: false });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch stats',\n        loading: false \n      });\n    }\n  },\n}));\n"
    },
    {
      "path": "src/store/useSubmissionStore.ts",
      "lang": "ts",
      "size": 7720,
      "lines": 268,
      "hash": "558da88f45234dbbbd1283af418d1da45d2916cdccf97a686263362740751d3e",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\ninterface Submission {\n  id: string;\n  title: string;\n  status: string;\n  vendor_id: string;\n  created_at: string;\n  updated_at: string;\n  vendor?: {\n    company_name: string;\n  };\n  [key: string]: any;\n}\n\ninterface SubmissionStore {\n  submissions: Submission[];\n  loading: boolean;\n  error: string | null;\n  statistics: {\n    total: number;\n    pending: number;\n    approved: number;\n    rejected: number;\n  } | null;\n  allSubmissionsStats: {\n    total: number;\n    pending: number;\n    approved: number;\n    rejected: number;\n  } | null;\n  filteredTotal: number;\n  \n  // Search and filters\n  searchTerm: string;\n  sortField: string;\n  sortOrder: string;\n  currentPage: number;\n  totalPages: number;\n  \n  // Actions\n  setSubmissions: (submissions: Submission[]) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  setSearchTerm: (term: string) => void;\n  setSortField: (field: string) => void;\n  setSortOrder: (order: string) => void;\n  setCurrentPage: (page: number | ((prev: number) => number)) => void;\n  setTotalPages: (pages: number) => void;\n  setStatistics: (stats: any) => void;\n  setAllSubmissionsStats: (stats: any) => void;\n  \n  // Fetch functions\n  fetchSubmissions: (params?: any) => Promise<void>;\n  fetchVendorSubmissions: (params?: any) => Promise<void>;\n  fetchVendorStats: () => Promise<void>;\n  fetchAdminStats: () => Promise<void>;\n  fetchLatestSubmissions: () => Promise<void>;\n  \n  // CRUD operations\n  updateSubmissionStatus: (id: string, status: string) => Promise<void>;\n  deleteSubmission: (id: string) => Promise<void>;\n}\n\nexport const useSubmissionStore = create<SubmissionStore>((set, get) => ({\n  submissions: [],\n  loading: false,\n  error: null,\n  statistics: null,\n  allSubmissionsStats: null,\n  filteredTotal: 0,\n  \n  searchTerm: '',\n  sortField: 'created_at',\n  sortOrder: 'desc',\n  currentPage: 1,\n  totalPages: 1,\n  \n  setSubmissions: (submissions) => set({ submissions }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\n  setSortField: (sortField) => set({ sortField }),\n  setSortOrder: (sortOrder) => set({ sortOrder }),\n  setCurrentPage: (currentPage) => {\n    if (typeof currentPage === 'function') {\n      set((state) => ({ currentPage: currentPage(state.currentPage) }));\n    } else {\n      set({ currentPage });\n    }\n  },\n  setTotalPages: (totalPages) => set({ totalPages }),\n  setStatistics: (statistics) => set({ statistics }),\n  setAllSubmissionsStats: (allSubmissionsStats) => set({ allSubmissionsStats }),\n  \n  fetchSubmissions: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        sortBy: params.sortBy || 'created_at',\n        sortOrder: params.sortOrder || 'desc',\n        ...(params.search && { search: params.search }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/admin/submissions?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch submissions');\n      }\n      \n      const data = await response.json();\n      console.log('Admin submissions API response:', data); // Debug log\n      set({ \n        submissions: data.submissions || [],\n        totalPages: data.pagination?.pages || 1,\n        filteredTotal: data.pagination?.total || 0,\n        loading: false \n      });\n    } catch (error) {\n      console.error('Error fetching submissions:', error); // Debug log\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n\n  fetchAdminStats: async () => {\n    try {\n      // Fetch statistics without any filters\n      const response = await fetch('/api/admin/submissions/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch admin stats');\n      }\n      \n      const data = await response.json();\n      set({ \n        allSubmissionsStats: data.statistics || null\n      });\n    } catch (error) {\n      console.error('Error fetching admin stats:', error);\n    }\n  },\n  \n  fetchVendorSubmissions: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        sortBy: params.sortBy || 'created_at',\n        sortOrder: params.sortOrder || 'desc',\n        ...(params.search && { search: params.search }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/vendor/submissions?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor submissions');\n      }\n      \n      const data = await response.json();\n      set({ \n        submissions: data.submissions || [],\n        totalPages: data.pagination?.pages || 1,\n        filteredTotal: data.pagination?.total || 0,\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n\n  fetchVendorStats: async () => {\n    try {\n      // Fetch statistics without any filters\n      const response = await fetch('/api/vendor/submissions/stats');\n      if (!response.ok) {\n        throw new Error('Failed to fetch vendor stats');\n      }\n      \n      const data = await response.json();\n      set({ \n        allSubmissionsStats: data.statistics || null\n      });\n    } catch (error) {\n      console.error('Error fetching vendor stats:', error);\n    }\n  },\n  \n  fetchLatestSubmissions: async () => {\n    try {\n      set({ loading: true, error: null });\n      \n      const response = await fetch('/api/admin/dashboard/recent-submissions');\n      if (!response.ok) {\n        throw new Error('Failed to fetch latest submissions');\n      }\n      \n      const data = await response.json();\n      set({ \n        submissions: data.submissions || [],\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch submissions',\n        loading: false \n      });\n    }\n  },\n  \n  updateSubmissionStatus: async (id: string, status: string) => {\n    try {\n      const response = await fetch(`/api/submissions/${id}/status`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ status }),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to update submission status');\n      }\n      \n      // Update local state\n      const submissions = get().submissions.map(sub => \n        sub.id === id ? { ...sub, status } : sub\n      );\n      set({ submissions });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to update submission'\n      });\n      throw error;\n    }\n  },\n  \n  deleteSubmission: async (id: string) => {\n    try {\n      const response = await fetch(`/api/submissions/${id}`, {\n        method: 'DELETE',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete submission');\n      }\n      \n      // Remove from local state\n      const submissions = get().submissions.filter(sub => sub.id !== id);\n      set({ submissions });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete submission'\n      });\n      throw error;\n    }\n  },\n}));\n"
    },
    {
      "path": "src/store/useUserStore.ts",
      "lang": "ts",
      "size": 5703,
      "lines": 215,
      "hash": "f69f796af4a51093b36ba6df5844cf178435d8a4554fb790ce75c34d138ca5bc",
      "truncated": false,
      "content": "import { create } from 'zustand';\n\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  role: string;\n  company_name?: string;\n  status: string;\n  created_at: string;\n  updated_at: string;\n  [key: string]: any;\n}\n\ninterface UserStore {\n  users: User[];\n  pendingUsers: User[];\n  loading: boolean;\n  error: string | null;\n  \n  // Search and filters\n  searchTerm: string;\n  roleFilter: string;\n  statusFilter: string;\n  currentPage: number;\n  totalPages: number;\n  \n  // Actions\n  setUsers: (users: User[]) => void;\n  setPendingUsers: (users: User[]) => void;\n  setLoading: (loading: boolean) => void;\n  setError: (error: string | null) => void;\n  setSearchTerm: (term: string) => void;\n  setRoleFilter: (role: string) => void;\n  setStatusFilter: (status: string) => void;\n  setCurrentPage: (page: number) => void;\n  setTotalPages: (pages: number) => void;\n  \n  // Fetch functions\n  fetchUsers: (params?: any) => Promise<void>;\n  fetchPendingUsers: () => Promise<void>;\n  \n  // CRUD operations\n  approveUser: (id: string) => Promise<void>;\n  rejectUser: (id: string) => Promise<void>;\n  updateUser: (id: string, data: Partial<User>) => Promise<void>;\n  deleteUser: (id: string) => Promise<void>;\n}\n\nexport const useUserStore = create<UserStore>((set, get) => ({\n  users: [],\n  pendingUsers: [],\n  loading: false,\n  error: null,\n  \n  searchTerm: '',\n  roleFilter: '',\n  statusFilter: '',\n  currentPage: 1,\n  totalPages: 1,\n  \n  setUsers: (users) => set({ users }),\n  setPendingUsers: (pendingUsers) => set({ pendingUsers }),\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\n  setRoleFilter: (roleFilter) => set({ roleFilter }),\n  setStatusFilter: (statusFilter) => set({ statusFilter }),\n  setCurrentPage: (currentPage) => set({ currentPage }),\n  setTotalPages: (totalPages) => set({ totalPages }),\n  \n  fetchUsers: async (params = {}) => {\n    try {\n      set({ loading: true, error: null });\n      \n      const searchParams = new URLSearchParams({\n        page: params.page?.toString() || '1',\n        limit: params.limit?.toString() || '10',\n        ...(params.search && { search: params.search }),\n        ...(params.role && { role: params.role }),\n        ...(params.status && { status: params.status }),\n      });\n      \n      const response = await fetch(`/api/admin/users?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch users');\n      }\n      \n      const data = await response.json();\n      set({ \n        users: data.users || [],\n        totalPages: data.pagination?.pages || 1,\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch users',\n        loading: false \n      });\n    }\n  },\n  \n  fetchPendingUsers: async () => {\n    try {\n      set({ loading: true, error: null });\n      \n      const response = await fetch('/api/admin/users/pending');\n      if (!response.ok) {\n        throw new Error('Failed to fetch pending users');\n      }\n      \n      const data = await response.json();\n      set({ \n        pendingUsers: data.users || [],\n        loading: false \n      });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch pending users',\n        loading: false \n      });\n    }\n  },\n  \n  approveUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}/approve`, {\n        method: 'POST',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to approve user');\n      }\n      \n      // Remove from pending users\n      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);\n      set({ pendingUsers });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to approve user'\n      });\n      throw error;\n    }\n  },\n  \n  rejectUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}/reject`, {\n        method: 'POST',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to reject user');\n      }\n      \n      // Remove from pending users\n      const pendingUsers = get().pendingUsers.filter(user => user.id !== id);\n      set({ pendingUsers });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to reject user'\n      });\n      throw error;\n    }\n  },\n  \n  updateUser: async (id: string, data: Partial<User>) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to update user');\n      }\n      \n      // Update local state\n      const users = get().users.map(user => \n        user.id === id ? { ...user, ...data } : user\n      );\n      set({ users });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to update user'\n      });\n      throw error;\n    }\n  },\n  \n  deleteUser: async (id: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${id}`, {\n        method: 'DELETE',\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete user');\n      }\n      \n      // Remove from local state\n      const users = get().users.filter(user => user.id !== id);\n      set({ users });\n    } catch (error) {\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete user'\n      });\n      throw error;\n    }\n  },\n}));\n"
    },
    {
      "path": "src/styles/datepicker.css",
      "lang": "css",
      "size": 4169,
      "lines": 220,
      "hash": "985d06bd5b85b5047884434775cb3908636afdd780612c9100c08c11064a44db",
      "truncated": false,
      "content": "/* Custom DatePicker Styles */\n#datepicker-portal {\n  z-index: 9999;\n  position: relative;\n}\n\n.react-datepicker-wrapper {\n  width: 100%;\n}\n\n.react-datepicker__input-container {\n  width: 100%;\n}\n\n.react-datepicker-popper {\n  z-index: 9999 !important;\n  position: fixed !important;\n}\n\n.react-datepicker-calendar {\n  border: 1px solid #d1d5db;\n  border-radius: 0.5rem;\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  font-family: inherit;\n  background: white;\n  z-index: 9999;\n}\n\n/* Ensure datepicker appears above modal overlays */\n.react-datepicker__tab-loop {\n  z-index: 9999 !important;\n  position: relative;\n}\n\n/* Fix for modal overflow issues */\n.fixed.inset-0.z-50.overflow-y-auto:has(.react-datepicker-popper) {\n  overflow: visible !important;\n}\n\n/* Alternative approach - ensure datepicker container is not clipped */\n.react-datepicker__tab-loop__div {\n  position: static !important;\n}\n\n/* Ensure proper layering in modals */\n.react-datepicker__month-container {\n  z-index: 9999;\n}\n\n/* Portal-specific styles */\n.react-datepicker__portal {\n  z-index: 9999 !important;\n  position: fixed !important;\n}\n\n.react-datepicker__portal .react-datepicker {\n  z-index: 9999 !important;\n  position: relative !important;\n}\n\n.react-datepicker__header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  border-radius: 0.5rem 0.5rem 0 0;\n  padding: 0.75rem;\n}\n\n.react-datepicker__current-month {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #374151;\n  margin-bottom: 0.5rem;\n}\n\n.react-datepicker__day-names {\n  margin-bottom: 0.25rem;\n}\n\n.react-datepicker__day-name {\n  color: #6b7280;\n  font-size: 0.75rem;\n  font-weight: 500;\n  width: 2rem;\n  line-height: 2rem;\n}\n\n.react-datepicker__month {\n  margin: 0.5rem;\n}\n\n.react-datepicker__day {\n  color: #374151;\n  font-size: 0.875rem;\n  width: 2rem;\n  line-height: 2rem;\n  border-radius: 0.375rem;\n  transition: all 0.15s ease-in-out;\n}\n\n.react-datepicker__day:hover {\n  background-color: #eff6ff;\n  color: #2563eb;\n}\n\n.react-datepicker__day--selected {\n  background-color: #2563eb;\n  color: white;\n}\n\n.react-datepicker__day--selected:hover {\n  background-color: #1d4ed8;\n}\n\n.react-datepicker__day--keyboard-selected {\n  background-color: #dbeafe;\n  color: #2563eb;\n}\n\n.react-datepicker__day--today {\n  background-color: #fef3c7;\n  color: #92400e;\n  font-weight: 600;\n}\n\n.react-datepicker__day--disabled {\n  color: #d1d5db;\n  cursor: not-allowed;\n}\n\n.react-datepicker__day--disabled:hover {\n  background-color: transparent;\n  color: #d1d5db;\n}\n\n.react-datepicker__day--outside-month {\n  color: #d1d5db;\n}\n\n.react-datepicker__navigation {\n  background: none;\n  border: none;\n  top: 0.75rem;\n  width: 2rem;\n  height: 2rem;\n  border-radius: 0.375rem;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__navigation:hover {\n  background-color: #f3f4f6;\n}\n\n.react-datepicker__navigation--previous {\n  left: 0.75rem;\n}\n\n.react-datepicker__navigation--next {\n  right: 0.75rem;\n}\n\n.react-datepicker__navigation-icon::before {\n  border-color: #6b7280;\n  border-width: 2px 2px 0 0;\n  width: 0.5rem;\n  height: 0.5rem;\n}\n\n.react-datepicker__today-button {\n  background-color: #f9fafb;\n  border-top: 1px solid #e5e7eb;\n  border-radius: 0 0 0.5rem 0.5rem;\n  color: #2563eb;\n  font-size: 0.875rem;\n  padding: 0.5rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__today-button:hover {\n  background-color: #f3f4f6;\n}\n\n/* Time picker styles */\n.react-datepicker__time-container {\n  border-left: 1px solid #e5e7eb;\n}\n\n.react-datepicker__time {\n  background: white;\n  border-radius: 0 0.5rem 0.5rem 0;\n}\n\n.react-datepicker__time-box {\n  width: 85px;\n}\n\n.react-datepicker__time-list {\n  height: 200px !important;\n}\n\n.react-datepicker__time-list-item {\n  padding: 0.5rem 0.75rem;\n  font-size: 0.875rem;\n  transition: background-color 0.15s ease-in-out;\n}\n\n.react-datepicker__time-list-item:hover {\n  background-color: #eff6ff;\n  color: #2563eb;\n}\n\n.react-datepicker__time-list-item--selected {\n  background-color: #2563eb;\n  color: white;\n}\n\n.react-datepicker__time-list-item--selected:hover {\n  background-color: #1d4ed8;\n}\n"
    },
    {
      "path": "src/types/next.auth.d.ts",
      "lang": "ts",
      "size": 796,
      "lines": 37,
      "hash": "42897483ec1a894072aa7fb2dcb0ca18774bcc5931308d52233b466be9bad142",
      "truncated": false,
      "content": "import NextAuth, { DefaultSession, DefaultUser } from \"next-auth\";\nimport { Role } from \"@prisma/client\";\n\ndeclare module \"next-auth\" {\n  interface Session {\n    user: {\n      id: string;\n      role: Role;\n      officer_name: string;\n      vendor_name?: string | null;\n      verified_at?: Date | null;\n      created_at?: Date;\n    } & DefaultSession[\"user\"];\n    accessToken?: string;\n  }\n\n  interface User extends DefaultUser {\n    role: Role;\n    officer_name: string;\n    vendor_name?: string | null;\n    verified_at?: Date | null;\n    created_at?: Date;\n  }\n}\n\ndeclare module \"next-auth/jwt\" {\n  interface JWT {\n    id?: string;\n    role?: Role;\n    officer_name?: string;\n    vendor_name?: string | null;\n    verified_at?: Date | null;\n    created_at?: Date;\n    accessToken?: string;\n  }\n}\n"
    },
    {
      "path": "src/types/submission.ts",
      "lang": "ts",
      "size": 1092,
      "lines": 41,
      "hash": "415981302e7d2c73545ccd5bb1558bfb9733d2125d185ff23d384118ebc7b6ad",
      "truncated": false,
      "content": "export interface SubmissionData {\n  vendor_name: string;\n  vendor_phone?: string;\n  based_on: string;\n  officer_name: string;\n  job_description: string;\n  work_location: string;\n  implementation?: string; // akan diisi oleh admin saat approve\n  working_hours: string;\n  other_notes?: string; // akan diisi oleh admin saat approve\n  work_facilities: string;\n  worker_count?: number; // jumlah pekerja\n  simja_number?: string;\n  simja_date?: string;\n  sika_number?: string;\n  sika_date?: string;\n  worker_names: string;\n  content?: string; // akan diisi oleh admin saat approve\n  sika_document_upload?: string;\n  simja_document_upload?: string;\n}\n\nexport interface SubmissionApprovalData {\n  approval_status: 'APPROVED' | 'REJECTED';\n  notes?: string;\n  simlok_number?: string;\n  simlok_date?: string;\n  implementation_start_date?: string;\n  implementation_end_date?: string;\n}\n\nexport interface WorkerList {\n  id: string;\n  worker_name: string;\n  worker_photo?: string | null;\n  submission_id: string;\n  created_at: Date;\n}\n\nexport type SubmissionStatus = 'PENDING' | 'APPROVED' | 'REJECTED';\n"
    },
    {
      "path": "src/types/user.ts",
      "lang": "ts",
      "size": 360,
      "lines": 16,
      "hash": "1bef551e36c0e3925de0152cfb6580b614cff6196243d639f860f6abd6402e5a",
      "truncated": false,
      "content": "import { Role } from \"@prisma/client\";\n\nexport interface UserData {\n  id: string;\n  officer_name: string;\n  email: string;\n  role: Role;\n  address?: string | null;\n  phone_number?: string | null;\n  vendor_name?: string | null;\n  created_at: string | Date;\n  verified_at?: string | Date | null;\n  verified_by?: string | null;\n  profile_photo?: string | null;\n}\n"
    },
    {
      "path": "src/utils/file-validation.ts",
      "lang": "ts",
      "size": 4182,
      "lines": 164,
      "hash": "46dd0eaa2d25313402cd0311fcd964b12baf56c88c03e3d6d7da0e0270423ad8",
      "truncated": false,
      "content": "/**\n * File validation utilities for consistent file size and type validation across the application\n */\n\n// File size constants\nexport const FILE_SIZE_LIMITS = {\n  DEFAULT: 8, // 8MB default limit\n  IMAGE: 8,   // 8MB for images\n  DOCUMENT: 8, // 8MB for documents\n} as const;\n\n// Allowed file types and extensions\nexport const ALLOWED_FILE_TYPES = {\n  DOCUMENTS: [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  ],\n  IMAGES: [\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'image/gif'\n  ],\n  ALL: [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'image/jpeg',\n    'image/jpg', \n    'image/png',\n    'image/gif'\n  ]\n} as const;\n\nexport const ALLOWED_FILE_EXTENSIONS = {\n  DOCUMENTS: ['.pdf', '.doc', '.docx'],\n  IMAGES: ['.jpg', '.jpeg', '.png', '.gif'],\n  ALL: ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif']\n} as const;\n\nexport interface FileValidationOptions {\n  maxSizeMB?: number;\n  allowedTypes?: readonly string[];\n  allowedExtensions?: readonly string[];\n}\n\nexport interface FileValidationResult {\n  isValid: boolean;\n  error?: string;\n  size?: number;\n  type?: string;\n  extension?: string;\n}\n\n/**\n * Validates file size, type, and extension\n */\nexport function validateFile(\n  file: File, \n  options: FileValidationOptions = {}\n): FileValidationResult {\n  const {\n    maxSizeMB = FILE_SIZE_LIMITS.DEFAULT,\n    allowedTypes = ALLOWED_FILE_TYPES.ALL,\n    allowedExtensions = ALLOWED_FILE_EXTENSIONS.ALL\n  } = options;\n\n  // Check file size (convert MB to bytes)\n  const maxSizeBytes = maxSizeMB * 1024 * 1024;\n  if (file.size > maxSizeBytes) {\n    return {\n      isValid: false,\n      error: `Ukuran file terlalu besar. Maksimal ${maxSizeMB}MB`,\n      size: file.size\n    };\n  }\n\n  // Check file type\n  if (!allowedTypes.includes(file.type as any)) {\n    return {\n      isValid: false,\n      error: `Tipe file tidak didukung. Tipe yang diizinkan: ${allowedExtensions.join(', ')}`,\n      type: file.type\n    };\n  }\n\n  // Check file extension\n  const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n  if (!allowedExtensions.includes(fileExtension as any)) {\n    return {\n      isValid: false,\n      error: `Ekstensi file tidak didukung. Ekstensi yang diizinkan: ${allowedExtensions.join(', ')}`,\n      extension: fileExtension\n    };\n  }\n\n  return {\n    isValid: true,\n    size: file.size,\n    type: file.type,\n    extension: fileExtension\n  };\n}\n\n/**\n * Validates file for document uploads (PDF, DOC, DOCX)\n */\nexport function validateDocumentFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.DOCUMENT): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: [...ALLOWED_FILE_TYPES.DOCUMENTS],\n    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.DOCUMENTS]\n  });\n}\n\n/**\n * Validates file for image uploads (JPG, JPEG, PNG, GIF)\n */\nexport function validateImageFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: [...ALLOWED_FILE_TYPES.IMAGES],\n    allowedExtensions: [...ALLOWED_FILE_EXTENSIONS.IMAGES]\n  });\n}\n\n/**\n * Validates file for worker photo uploads (JPG, JPEG, PNG only)\n */\nexport function validateWorkerPhotoFile(file: File, maxSizeMB: number = FILE_SIZE_LIMITS.IMAGE): FileValidationResult {\n  return validateFile(file, {\n    maxSizeMB,\n    allowedTypes: ['image/jpeg', 'image/jpg', 'image/png'],\n    allowedExtensions: ['.jpg', '.jpeg', '.png']\n  });\n}\n\n/**\n * Format file size in human readable format\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * Convert MB to bytes\n */\nexport function mbToBytes(mb: number): number {\n  return mb * 1024 * 1024;\n}\n\n/**\n * Convert bytes to MB\n */\nexport function bytesToMB(bytes: number): number {\n  return bytes / (1024 * 1024);\n}"
    },
    {
      "path": "src/utils/jwt-config.ts",
      "lang": "ts",
      "size": 1463,
      "lines": 48,
      "hash": "8c91f583837b30c9136b3a4ab05c21c6cefb9c1c71a69e360a9fcefb060d12f4",
      "truncated": false,
      "content": "// src/utils/jwt-config.ts\n\n/**\n * JWT Configuration utilities\n * Allows customization of JWT expiry times through environment variables\n */\n\nexport const JWT_CONFIG = {\n  // Default: 24 hours (86400 seconds)\n  JWT_EXPIRE_TIME: parseInt(process.env.JWT_EXPIRE_TIME || '86400'),\n  \n  // Default: 24 hours (86400 seconds)\n  SESSION_MAX_AGE: parseInt(process.env.SESSION_MAX_AGE || '86400'),\n  \n  // Default: 1 hour (3600 seconds) - how often session gets updated when user is active\n  SESSION_UPDATE_AGE: parseInt(process.env.SESSION_UPDATE_AGE || '3600'),\n  \n  // Client-side warning time (in minutes before expiry)\n  WARNING_BEFORE_EXPIRY: parseInt(process.env.WARNING_BEFORE_EXPIRY || '5'),\n  \n  // Auto refresh interval (in minutes)\n  AUTO_REFRESH_INTERVAL: parseInt(process.env.AUTO_REFRESH_INTERVAL || '30'),\n} as const;\n\nexport const formatExpiryTime = (seconds: number): string => {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  \n  if (hours > 0) {\n    return `${hours}h ${minutes}m`;\n  }\n  return `${minutes}m`;\n};\n\nexport const getExpiryDate = (fromNow: number = JWT_CONFIG.JWT_EXPIRE_TIME): Date => {\n  return new Date(Date.now() + (fromNow * 1000));\n};\n\nexport const isTokenExpired = (exp: number): boolean => {\n  const now = Date.now() / 1000;\n  return now >= exp;\n};\n\nexport const getTimeUntilExpiry = (exp: number): number => {\n  const now = Date.now() / 1000;\n  return Math.max(0, exp - now);\n};\n"
    },
    {
      "path": "src/utils/pdf/simlokTemplate.ts",
      "lang": "ts",
      "size": 32262,
      "lines": 983,
      "hash": "285d293b78bb8ce81cac49724d5fc02ad3e054140cb7db11702b9c8367a066cc",
      "truncated": false,
      "content": "// simlok-pdf.ts\nimport {\n  PDFDocument,\n  StandardFonts,\n  rgb,\n  type PDFFont,\n  type RGB,\n  type PDFImage,\n} from \"pdf-lib\";\nimport * as QRCode from 'qrcode';\nimport { numberToBahasa } from \"@/lib/parseNumber\";\n\n/**\n * Load logo image for PDF generation\n * Works both on client-side (fetch) and server-side (fs)\n */\nasync function loadLogo(pdfDoc: PDFDocument): Promise<PDFImage | null> {\n  try {\n    const logoPath = '/assets/logo_pertamina.png';\n    \n    if (typeof window !== 'undefined') {\n      // Client-side: use fetch\n      const response = await fetch(logoPath);\n      if (response.ok) {\n        const logoBytes = await response.arrayBuffer();\n        return await pdfDoc.embedPng(new Uint8Array(logoBytes));\n      }\n    } else {\n      // Server-side: use file system\n      const fs = await import('fs');\n      const path = await import('path');\n      const logoFilePath = path.join(process.cwd(), 'public', logoPath);\n      \n      if (fs.existsSync(logoFilePath)) {\n        const fileBuffer = fs.readFileSync(logoFilePath);\n        return await pdfDoc.embedPng(fileBuffer);\n      }\n    }\n  } catch (error) {\n    console.warn('Failed to load logo:', error);\n  }\n  \n  return null;\n}\n\n/**\n * Generate QR code image for PDF\n */\nasync function generateQRImage(pdfDoc: PDFDocument, qrString: string): Promise<PDFImage | null> {\n  try {\n    // Generate QR code as PNG buffer\n    const qrBuffer = await QRCode.toBuffer(qrString, {\n      type: 'png',\n      width: 200,\n      margin: 2,\n      color: {\n        dark: '#000000',\n        light: '#FFFFFF'\n      }\n    });\n    \n    // Embed QR code image into PDF\n    return await pdfDoc.embedPng(qrBuffer);\n  } catch (error) {\n    console.warn('Failed to generate QR code image:', error);\n    return null;\n  }\n}\n\n/** Struktur data mengikuti placeholder di template kamu */\nexport interface SubmissionPDFData {\n  simlok_number?: string | null;\n  simlok_date?: string | Date | null | undefined;\n  implementation_start_date?: string | Date | null | undefined;\n  implementation_end_date?: string | Date | null | undefined;\n  vendor_name: string;\n  simja_number?: string | null;\n  simja_date?: string | Date | null | undefined;\n  sika_number?: string | null;\n  sika_date?: string | Date | null | undefined;\n  job_description: string;\n  work_location: string;\n  implementation: string | null;\n  working_hours: string;            // contoh: \"08:30 - 06:30 WIB\"\n  other_notes?: string | null;\n  work_facilities: string;\n  worker_names?: string | null;\n  worker_count?: number | null;\n  content?: string | null;\n  signer_position?: string | null;\n  signer_name?: string | null;\n  qrcode?: string | null;  // QR code string for PDF\n  // Tambahkan untuk daftar pekerja dari tabel terpisah\n  final_status?: 'PENDING_APPROVAL' | 'APPROVED' | 'REJECTED' | null;\n  workerList?: Array<{\n    worker_name: string;\n    worker_photo?: string | null;\n  }>;\n  // Support database field name\n  worker_list?: Array<{\n    worker_name: string;\n    worker_photo?: string | null;\n  }>;\n}\n\nexport type SIMLOKOptions = {\n  logoBase64?: string;     // opsional\n  primary?: RGB;           // warna judul\n  cityIssued?: string;     // default \"Jakarta\"\n  headTitle?: string;      // default \"Sr Officer Security III\"\n  headName?: string;       // default \"Juliarto Santoso\"\n  fontSize?: number;       // default 12\n  leftLabelWidth?: number; // default 190\n  lineGap?: number;        // default 15.5\n};\n\nconst A4 = { w: 595.28, h: 841.89 };\nconst MARGIN = 50;\nconst LEFT_LABEL_WIDTH_DEFAULT = 160;\nconst LINE_GAP_DEFAULT = 15.5;\n\nfunction toDate(d?: string | Date | null) {\n  if (!d) return null;\n  return typeof d === \"string\" ? new Date(d) : d;\n}\n\nfunction fmtDateID(d?: string | Date | null) {\n  const dd = toDate(d);\n  if (!dd || isNaN(+dd)) return \"-\";\n  return dd.toLocaleDateString(\"id-ID\", {\n    day: \"2-digit\",\n    month: \"long\",\n    year: \"numeric\",\n  });\n}\n\n/**\n * Ekstrak tanggal dari text pelaksanaan\n * Contoh: \"Terhitung mulai tanggal 01 Agustus 2025 sampai 15 Agustus 2025\"\n * Akan mengambil tanggal pertama: \"01 Agustus 2025\"\n */\nfunction extractDateFromPelaksanaan(pelaksanaan?: string | null): Date | null {\n  if (!pelaksanaan) return null;\n  \n  // Pattern untuk menangkap tanggal dalam format: DD Bulan YYYY\n  const datePattern = /(\\d{1,2})\\s+(Januari|Februari|Maret|April|Mei|Juni|Juli|Agustus|September|Oktober|November|Desember)\\s+(\\d{4})/i;\n  const match = pelaksanaan.match(datePattern);\n  \n  if (!match) return null;\n  \n  const [, day, month, year] = match;\n  \n  // Mapping bulan Indonesia ke nomor bulan\n  const monthMap: { [key: string]: number } = {\n    'januari': 0, 'februari': 1, 'maret': 2, 'april': 3,\n    'mei': 4, 'juni': 5, 'juli': 6, 'agustus': 7,\n    'september': 8, 'oktober': 9, 'november': 10, 'desember': 11\n  };\n  \n  const monthIndex = month ? monthMap[month.toLowerCase()] : undefined;\n  if (monthIndex === undefined || !year || !day) return null;\n  \n  return new Date(parseInt(year), monthIndex, parseInt(day));\n}\n\n/** Hapus newline ganda & spasi berlebih agar wrap presisi */\nfunction normalizeInline(s?: string | null) {\n  if (!s) return \"\";\n  return s.replace(/\\s+/g, \" \").trim();\n}\n\nclass PDFKit {\n  doc!: PDFDocument;\n  page: any;\n  font!: PDFFont;\n  bold!: PDFFont;\n\n  x = MARGIN;\n  y = A4.h - MARGIN;\n\n  fs = 12;\n  lineGap = LINE_GAP_DEFAULT;\n  leftLabelWidth = LEFT_LABEL_WIDTH_DEFAULT;\n  pageCount = 0;\n  submissionData?: SubmissionPDFData;\n\n  async init() {\n    this.doc = await PDFDocument.create();\n    this.page = this.doc.addPage([A4.w, A4.h]);\n    this.font = await this.doc.embedFont(StandardFonts.Helvetica);\n    this.bold = await this.doc.embedFont(StandardFonts.HelveticaBold);\n    this.pageCount = 1;\n  }\n\n  async addPage() {\n    this.page = this.doc.addPage([A4.w, A4.h]);\n    this.pageCount++;\n    this.x = MARGIN;\n    \n    // Add header to pages 2 and beyond\n    if (this.pageCount > 1 && this.submissionData) {\n      await this.addHeader();\n      this.y = A4.h - 140; // Start content below header\n    } else {\n      this.y = A4.h - MARGIN;\n    }\n  }\n\n  async addHeader() {\n    if (!this.submissionData) return;\n    \n    // Add logo - await untuk memastikan logo ter-load\n    const logoImage = await loadLogo(this.doc);\n    if (logoImage) {\n      const logoWidth = 120;\n      const logoHeight = 40;\n      const logoX = A4.w - logoWidth - 40;\n      const logoY = A4.h - 60;\n      \n      this.page.drawImage(logoImage, {\n        x: logoX,\n        y: logoY,\n        width: logoWidth,\n        height: logoHeight,\n      });\n    }\n    \n    // Add header dengan nomor SIMLOK\n    const simlokNumber = this.submissionData.simlok_number || \"[DRAFT]/XX/09/2025\";\n    this.text(`Lampiran Simlok No. ${simlokNumber}`, MARGIN, A4.h - 80, {\n      size: 12,\n      bold: true,\n      color: rgb(0, 0, 0),\n    });\n\n    // Add nama vendor di bawah lampiran\n    this.text(\"Nama petugas \", MARGIN, A4.h - 100, {\n      size: 11,\n      bold: false,\n      color: rgb(0, 0, 0),\n    });\n\n    // Hitung lebar text \"Nama petugas \" untuk positioning nama vendor\n    const namaPetugasWidth = this.measure(\"Nama petugas \", { size: 11, bold: false });\n    this.text(this.submissionData.vendor_name, MARGIN + namaPetugasWidth, A4.h - 100, {\n      size: 11,\n      bold: true,\n      color: rgb(0, 0, 0),\n    });\n\n    // // Add separator line\n    // const lineY = A4.h - 120;\n    // const lineStartX = MARGIN;\n    // const lineEndX = A4.w - MARGIN;\n    // this.page.drawLine({\n    //   start: { x: lineStartX, y: lineY },\n    //   end: { x: lineEndX, y: lineY },\n    //   thickness: 0.5,\n    //   color: rgb(0.7, 0.7, 0.7),\n    // });\n  }\n\n  measure(text: string, opts?: { size?: number; bold?: boolean }) {\n    const size = opts?.size ?? this.fs;\n    const f = opts?.bold ? this.bold : this.font;\n    return f.widthOfTextAtSize(text, size);\n  }\n\n  text(\n    t: string,\n    x: number,\n    y: number,\n    o?: { size?: number; bold?: boolean; color?: RGB }\n  ) {\n    this.page.drawText(t, {\n      x,\n      y,\n      size: o?.size ?? this.fs,\n      font: o?.bold ? this.bold : this.font,\n      color: o?.color ?? rgb(0, 0, 0),\n    });\n  }\n\n  center(t: string, y: number, o?: { size?: number; bold?: boolean; color?: RGB }) {\n    const w = this.measure(t, o);\n    const cx = (A4.w - w) / 2;\n    this.text(t, cx, y, o);\n  }\n\n  async wrap(\n    t: string,\n    x: number,\n    maxW: number,\n    o?: { size?: number; bold?: boolean }\n  ) {\n    const size = o?.size ?? this.fs;\n    const f = o?.bold ? this.bold : this.font;\n    const words = t.split(/\\s+/);\n    let line = \"\";\n    const lines: string[] = [];\n    for (const w of words) {\n      const test = line ? line + \" \" + w : w;\n      const width = f.widthOfTextAtSize(test, size);\n      if (width > maxW && line) {\n        lines.push(line);\n        line = w;\n      } else line = test;\n    }\n    if (line) lines.push(line);\n    for (const ln of lines) {\n      await this.pageBreak();\n      this.text(ln, x, this.y, { size, bold: o?.bold ?? false });\n      this.y -= this.lineGap;\n    }\n  }\n\n  async pageBreak(min = 60) {\n    if (this.y < MARGIN + min) await this.addPage();\n  }\n\n  /**\n   * Baris bernomor dengan label di kiri, titik dua di kolom tengah,\n   * dan value yang dibungkus di kolom kanan.\n   */\n  async numberedRow(\n    no: number,\n    label: string,\n    rawValue?: string | null,\n    opts?: { valueBold?: boolean }\n  ) {\n    const value = (rawValue ?? \"\").toString();\n    await this.pageBreak();\n\n    // Label kiri (bold)\n    const left = `${no}. ${label}`;\n    this.text(left, this.x, this.y, { bold: false });\n\n    // Titik dua di kolom tengah agar align konsisten\n    const colonX = this.x + this.leftLabelWidth - this.measure(\":\", { size: this.fs }) - 2;\n    this.text(\":\", colonX, this.y);\n\n    // Value di kolom kanan (wrap)\n    const rightX = this.x + this.leftLabelWidth + 4;\n    const rightW = A4.w - MARGIN - rightX;\n    await this.wrap(normalizeInline(value) || \"-\", rightX, rightW, {\n      bold: !!opts?.valueBold,\n    });\n  }\n}\n\nexport async function generateSIMLOKPDF(submissionData: SubmissionPDFData): Promise<Uint8Array> {\n  const k = new PDFKit();\n  await k.init();\n  \n  // Store submission data for header generation\n  k.submissionData = submissionData;\n  \n  const { page } = k;\n  const { width, height } = page.getSize();\n\n  // Load and embed the Pertamina logo\n  const logoImage = await loadLogo(k.doc);\n\n  const s = submissionData;\n\n  // Set PDF metadata with SIMLOK information\n  const simlokNumber = s.simlok_number ? `${s.simlok_number}` : \"SIMLOK\";\n  const simlokTitle = `SIMLOK NO-${simlokNumber}`;\n  const currentDate = new Date();\n  \n  k.doc.setTitle(simlokTitle);\n  k.doc.setSubject(\"Surat Izin Masuk Lokasi PT PERTAMINA (PERSERO)\");\n  k.doc.setAuthor(\"PT PERTAMINA (PERSERO)\");\n  k.doc.setKeywords([\"SIMLOK\", \"Pertamina\", \"Izin Masuk\", simlokNumber, s.vendor_name]);\n  k.doc.setProducer(\"SIMLOK System\");\n  k.doc.setCreator(\"SIMLOK PDF Generator\");\n  k.doc.setCreationDate(currentDate);\n  k.doc.setModificationDate(currentDate);\n\n  // Set initial styling\n  k.fs = 12;\n  k.lineGap = LINE_GAP_DEFAULT;\n  k.leftLabelWidth = LEFT_LABEL_WIDTH_DEFAULT;\n\n  // Add logo to top-right if available\n  if (logoImage) {\n    const logoWidth = 120;\n    const logoHeight = 40;\n    const logoX = width - logoWidth - 40; // 40 pixels from right edge\n    const logoY = height - 60; // 80 pixels from top (higher than title)\n    \n    page.drawImage(logoImage, {\n      x: logoX,\n      y: logoY,\n      width: logoWidth,\n      height: logoHeight,\n    });\n  }\n\n  // Add centered header\n  k.center(\"SURAT IZIN MASUK LOKASI\", height - 100, {\n    size: 16,\n    bold: true,\n    color: rgb(0, 0, 0),\n  });\n\n  // Add border bottom line under the title\n  const titleY = height - 80;\n  const lineY = titleY - 25; // 25 pixels below the title\n  const lineStartX = 185; // Start line position\n  const lineEndX = A4.w - 185; // End line position\n  page.drawLine({\n    start: { x: lineStartX, y: lineY },\n    end: { x: lineEndX, y: lineY },\n    thickness: 1,\n    color: rgb(0, 0, 0),\n  });\n\n  // SIMLOK number (centered)\n  const simlokNo = s.simlok_number ? `${s.simlok_number}` : \"\";\n  k.center(`SIMLOK NO-${simlokNo}`, height - 120, {\n    size: 14,\n  });\n\n  // Introduction text\n  k.text(\"Dengan ini di berikan izin memasuki lokasi PT PERTAMINA (PERSERO) kepada\", 50, height - 160, {\n    size: 12,\n  });\n\n  // Move to content area and add numbered items\n  k.y = height - 190;\n\n  await k.numberedRow(1, \"Nama\", s.vendor_name, { valueBold: false });\n\n  // Format berdasarkan (SIMJA info)\n  const berdasarkan = s.simja_number\n    ? `${normalizeInline(s.simja_number)} Tgl. ${fmtDateID(s.simja_date)}`\n    : \"\";\n  \n  await k.numberedRow(2, \"Berdasarkan\", berdasarkan);\n  await k.numberedRow(3, \"Pekerjaan\", s.job_description);\n  await k.numberedRow(4, \"Lokasi Kerja\", s.work_location);\n  await k.numberedRow(5, \"Pelaksanaan\", normalizeInline(s.implementation || \"\"));\n  await k.numberedRow(6, \"Jam Kerja\", `Mulai pukul ${s.working_hours}`);\n  \n  // Special handling for \"Lain-lain\" to show as bulleted list\n  if (s.other_notes && s.other_notes.trim().length > 0) {\n    await k.pageBreak();\n    \n    // Label kiri (bold)\n    const left = \"7. Lain-lain\";\n    k.text(left, k.x, k.y, { bold: false });\n\n    // Titik dua di kolom tengah\n    const colonX = k.x + k.leftLabelWidth - k.measure(\":\", { size: k.fs }) - 2;\n    k.text(\":\", colonX, k.y);\n\n    // Process lain-lain as bulleted list\n   const lines = s.other_notes.split('\\n').map((l: string) => l.trim()).filter(Boolean);\nconst rightX = k.x + k.leftLabelWidth + 4;\nconst rightW = A4.w - MARGIN - rightX;\n\nfor (let idx = 0; idx < lines.length; idx++) {\n  const line = lines[idx];\n  const isFirst = idx === 0;\n  const isLast  = idx === lines.length - 2;\n\n  if (isFirst) {\n    await k.wrap(` ${line}`, rightX, rightW);\n  } else {\n    // newline (spasi vertikal) sebelum baris terakhir\n    if (isLast) k.y -= k.lineGap;\n\n    await k.pageBreak();\n    await k.wrap(` ${line}`, rightX, rightW);\n  }\n}\n\n  } else {\n    await k.numberedRow(7, \"Lain-lain\", \"\");\n  }\n  \n  // Get actual worker count from worker data if worker_count is null/0\n  const currentWorkerData = s.workerList || (s as any).worker_list;\n  const actualWorkerCount = s.worker_count || (currentWorkerData ? currentWorkerData.length : 0);\n  \n  await k.numberedRow(8, \"Sarana Kerja\", `${s.work_facilities}. Jumlah Pekerja ${actualWorkerCount} (${numberToBahasa(actualWorkerCount)}) Orang`);\n\n  // Add content paragraph if available\n  k.y -= 10;\n  if (s.content && s.content.trim().length > 0) {\n    await k.pageBreak();\n    await k.wrap(normalizeInline(s.content), 50, A4.w - 2 * MARGIN);\n    k.y -= 10;\n  }\n\n  // Add bottom text\n//   k.pageBreak();\n//   k.wrap(`Surat izin masuk lokasi ini diberikan dengan ketentuan agar mematuhi semua peraturan\n// tentang keamanan dan keselamatan kerja dan ketertiban, apabila pihak ke-III melakukan\n// kesalahan atau kelalaian yang mengakibatkan kerugian PT. Pertamina (Persero), maka\n// kerugian tersebut menjadi tanggung jawab pihak ke-III/rekanan. Lakukan perpanjangan\n// SIMLOK 2 hari sebelum masa berlaku habis.`, 50, A4.w - 2 * MARGIN);\n\n  // Add signature section\n  k.y -= 20;\n  const signatureY = k.y;\n\n  // Extract date from pelaksanaan or use tanggal_simlok as fallback\n  const dateFromPelaksanaan = extractDateFromPelaksanaan(s.implementation);\n  const displayDate = dateFromPelaksanaan || toDate(s.simlok_date);\n\n  // Right side - Location and Date (above Head title)\n  k.text(\"Dikeluarkan di : Jakarta\", A4.w - 230, signatureY);\n  k.text(\"Pada tanggal : \" + fmtDateID(displayDate), A4.w - 230, signatureY - 20);\n\n  // Right side - Head title and name (below location/date)\n  const jabatanSigner = s.signer_position || \"Head Or Security Region I\";\n  const namaSigner = s.signer_name || \"Julianto Santoso\";\n  \n  // Calculate precise positions for perfect centering\n  const jabatanY = signatureY - 50;\n  const namaY = signatureY - 180;\n  \n  // Draw jabatan\n  k.text(jabatanSigner, A4.w - 230, jabatanY);\n  \n  // Add QR code if available - positioned with simple pixel values for easy maintenance\n  if (s.qrcode && s.final_status === 'APPROVED') {\n    const qrImage = await generateQRImage(k.doc, s.qrcode);\n    if (qrImage) {\n      const qrSize = 100;\n      const qrX = 385; // Fixed X position from left edge\n      const qrY = signatureY - 160; // Fixed Y position: between jabatan (-50) and nama (-180)\n      \n      // Draw QR code at fixed pixel position\n      page.drawImage(qrImage, {\n        x: qrX,\n        y: qrY,\n        width: qrSize,\n        height: qrSize,\n      });\n    }\n  }\n  \n  // Draw nama\n  k.text(namaSigner, A4.w - 230, namaY, { bold: true });\n\n  // Add second page with worker photos if available\n  // Handle both workerList (interface) and worker_list (database)\n  const workerData = s.workerList || (s as any).worker_list;\n  console.log('=== WORKER DATA DEBUG ===');\n  if (workerData && workerData.length > 0) {\n    console.log(`Found ${workerData.length} workers`);\n    workerData.forEach((worker: any, index: number) => {\n      console.log(`Worker ${index + 1}: ${worker.worker_name}, Photo: ${worker.worker_photo ? 'YES' : 'NO'}`);\n      if (worker.worker_photo) {\n        console.log(`  Photo type: ${typeof worker.worker_photo}, Length: ${worker.worker_photo.length}`);\n        console.log(`  Preview: ${worker.worker_photo.substring(0, 50)}...`);\n      }\n    });\n    await addWorkerPhotosPage(k, workerData);\n  } else {\n    console.log('No worker data found');\n  }\n\n  return k.doc.save();\n}\n\n/**\n * Load and embed photo from file path or base64\n */\nasync function loadWorkerPhoto(pdfDoc: PDFDocument, photoPath?: string | null): Promise<PDFImage | null> {\n  if (!photoPath) {\n    console.log('No photo path provided');\n    return null;\n  }\n\n  console.log('Loading worker photo...');\n  console.log('Photo starts with \"data:\":', photoPath.startsWith('data:'));\n  console.log('Photo preview:', photoPath.substring(0, 100) + '...');\n\n  try {\n    // Check if it's a base64 string (could be with or without data: prefix)\n    if (photoPath.startsWith('data:image/') || photoPath.startsWith('data:') || photoPath.match(/^[A-Za-z0-9+/=]+$/)) {\n      console.log('Processing base64 image');\n      let base64Data: string | undefined;\n      let imageFormat = 'jpeg'; // default\n      \n      if (photoPath.startsWith('data:image/')) {\n        // Standard data URL format: data:image/jpeg;base64,/9j/4AAQ...\n        const base64Parts = photoPath.split(',');\n        if (base64Parts.length > 1) {\n          base64Data = base64Parts[1];\n          // Extract format from mime type\n          if (photoPath.includes('image/png')) {\n            imageFormat = 'png';\n          } else if (photoPath.includes('image/jpeg') || photoPath.includes('image/jpg')) {\n            imageFormat = 'jpeg';\n          }\n        } else {\n          throw new Error('Invalid data URL format');\n        }\n      } else if (photoPath.startsWith('data:')) {\n        // Generic data format\n        const base64Parts = photoPath.split(',');\n        base64Data = base64Parts.length > 1 ? base64Parts[1] : photoPath.replace('data:', '');\n      } else {\n        // Pure base64 string\n        base64Data = photoPath;\n      }\n      \n      console.log('Base64 data length:', base64Data?.length || 0);\n      console.log('Image format detected:', imageFormat);\n      \n      if (base64Data) {\n        let photoBytes: Buffer;\n        \n        if (typeof window !== 'undefined') {\n          // Client-side: use Uint8Array for better browser compatibility\n          const binaryString = atob(base64Data);\n          const bytes = new Uint8Array(binaryString.length);\n          for (let i = 0; i < binaryString.length; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n          }\n          photoBytes = Buffer.from(bytes);\n        } else {\n          // Server-side: use Buffer directly\n          photoBytes = Buffer.from(base64Data, 'base64');\n        }\n        \n        if (imageFormat === 'png' || photoPath.includes('image/png')) {\n          console.log('Embedding PNG image');\n          return await pdfDoc.embedPng(photoBytes);\n        } else {\n          console.log('Embedding JPG image');\n          return await pdfDoc.embedJpg(photoBytes);\n        }\n      }\n    } else {\n      // Handle file path - could be API path or direct file path\n      console.log('Processing file path photo');\n      let fullPath: string;\n      \n      if (photoPath.startsWith('/api/files/')) {\n        // API endpoint path - convert to actual file path\n        // /api/files/userId/folder/filename -> /uploads/userId/folder/filename\n        fullPath = photoPath.replace('/api/files/', '/uploads/');\n        console.log('Converted API path to file path:', fullPath);\n      } else {\n        // Regular file path\n        fullPath = photoPath.startsWith('/') ? photoPath : `/uploads/${photoPath}`;\n      }\n      \n      console.log('Full photo path:', fullPath);\n      \n      if (typeof window !== 'undefined') {\n        // Client-side: use fetch - try both API endpoint and file path\n        console.log('Client-side photo loading');\n        \n        // First try the API endpoint\n        if (photoPath.startsWith('/api/files/')) {\n          console.log('Trying API endpoint first');\n          const apiResponse = await fetch(photoPath);\n          console.log('API fetch response status:', apiResponse.status, apiResponse.ok);\n          if (apiResponse.ok) {\n            const photoBytes = await apiResponse.arrayBuffer();\n            const uint8Array = new Uint8Array(photoBytes);\n            \n            if (fullPath.toLowerCase().includes('.png')) {\n              return await pdfDoc.embedPng(uint8Array);\n            } else {\n              return await pdfDoc.embedJpg(uint8Array);\n            }\n          }\n        }\n        \n        // Fallback to direct file path\n        console.log('Trying direct file path');\n        const response = await fetch(fullPath);\n        console.log('File fetch response status:', response.status, response.ok);\n        if (response.ok) {\n          const photoBytes = await response.arrayBuffer();\n          const uint8Array = new Uint8Array(photoBytes);\n          \n          // Try to determine format from file extension or content\n          if (fullPath.toLowerCase().includes('.png')) {\n            return await pdfDoc.embedPng(uint8Array);\n          } else {\n            return await pdfDoc.embedJpg(uint8Array);\n          }\n        }\n      } else {\n        // Server-side: use file system\n        console.log('Server-side photo loading');\n        const fs = await import('fs');\n        const path = await import('path');\n        \n        // Simplified path resolution - no more fallbacks\n        let photoFilePath: string;\n        \n        if (photoPath.startsWith('/api/files/')) {\n          // Parse API path: /api/files/userId/category/filename\n          const apiParts = photoPath.split('/');\n          if (apiParts.length >= 5) {\n            const userId = apiParts[3];\n            const category = apiParts[4];\n            const filename = apiParts.slice(5).join('/');\n            \n            // Validate required components\n            if (!userId || !category || !filename) {\n              throw new Error('Invalid API path components');\n            }\n            \n            // Map category to actual folder name (from fileManager.ts)\n            const categoryFolders: Record<string, string> = {\n              sika: 'dokumen-sika',\n              simja: 'dokumen-simja',\n              id_card: 'id-card',\n              other: 'lainnya',\n              'worker-photo': 'foto-pekerja' // New category for worker photos\n            };\n            \n            const folderName = categoryFolders[category] || category;\n            \n            photoFilePath = path.join(process.cwd(), 'public', 'uploads', userId, folderName, filename);\n            console.log('Resolved photo file path:', photoFilePath);\n          } else {\n            throw new Error('Invalid API path format');\n          }\n        } else {\n          // Regular file path\n          photoFilePath = path.join(process.cwd(), 'public', fullPath);\n        }\n        \n        if (fs.existsSync(photoFilePath)) {\n          console.log('Photo file exists, reading...');\n          const fileBuffer = fs.readFileSync(photoFilePath);\n          \n          if (photoFilePath.toLowerCase().includes('.png')) {\n            console.log('Embedding PNG image from file');\n            return await pdfDoc.embedPng(fileBuffer);\n          } else {\n            console.log('Embedding JPG image from file');\n            return await pdfDoc.embedJpg(fileBuffer);\n          }\n        } else {\n          console.log('Photo file not found:', photoFilePath);\n        }\n      }\n    }\n  } catch (error) {\n    console.warn('Failed to load worker photo:', photoPath, error);\n  }\n  \n  return null;\n}\n\n/**\n * Add second page with worker photos\n */\nasync function addWorkerPhotosPage(\n  k: PDFKit, \n  workerList: Array<{ worker_name: string; worker_photo?: string | null }>\n) {\n  // Only proceed if there are workers\n  if (!workerList || workerList.length === 0) {\n    return;\n  }\n\n  // Add new page - header akan otomatis ditambahkan\n  await k.addPage();\n  \n  // // Add header\n  // k.center(\"DAFTAR PEKERJA\", A4.h - 100, {\n  //   size: 16,\n  //   bold: true,\n  //   color: rgb(0, 0, 0),\n  // });\n  \n  // Add line under header\n  // const headerY = A4.h - 40;\n  // const lineY = headerY - 65;\n  // const lineStartX = 190;\n  // const lineEndX = A4.w - 190;\n  // k.page.drawLine({\n  //   start: { x: lineStartX, y: lineY },\n  //   end: { x: lineEndX, y: lineY },\n  //   thickness: 1,\n  //   color: rgb(0, 0, 0),\n  // });\n  \n  // Header akan otomatis ditambahkan oleh k.addPage() karena ini halaman kedua\n\n\n  // Calculate grid layout optimized for 3x3 photos\n  const photosPerRow = 3;\n  const photoWidth = 130;  // Optimized for better fit\n  const photoHeight = 170; // Optimized for better fit\n  const marginHorizontal = (A4.w - (photosPerRow * photoWidth)) / (photosPerRow + 1);\n  const marginVertical = 12; // Reduced vertical margin\n  const nameSpacing = 20; // Space for worker name below photo\n  \n  let currentRow = 0;\n  let currentCol = 0;\n  const startY = A4.h - 140; // Optimized start position to fit header\n\n  console.log(`=== WORKER LAYOUT DEBUG ===`);\n  console.log(`Total workers: ${workerList.length}`);\n  console.log(`Photos per row: ${photosPerRow}`);\n  console.log(`Photo dimensions: ${photoWidth}x${photoHeight}`);\n  console.log(`Margins - H: ${marginHorizontal}, V: ${marginVertical}`);\n  console.log(`Start Y: ${startY}`);\n\n  // Process each worker\n  for (let i = 0; i < workerList.length; i++) {\n    const worker = workerList[i];\n    if (!worker) continue; // Skip if worker is undefined\n    \n    // Calculate position\n    const x = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));\n    const y = startY - (currentRow * (photoHeight + marginVertical + nameSpacing)); // Use nameSpacing constant\n\n    console.log(`Worker ${i+1} (${worker.worker_name}): Row ${currentRow}, Col ${currentCol}, Position (${Math.round(x)}, ${Math.round(y)})`);\n\n    // Check if we need a new page (optimized for 3x3 grid)\n    const bottomY = y - photoHeight;\n    const pageLimit = MARGIN + 30;\n    console.log(`  Bottom Y: ${Math.round(bottomY)}, Page limit: ${pageLimit}, Need new page: ${bottomY < pageLimit}`);\n    \n    // Check if we need a new page - either by space limit or by 3x3 grid limit (max 9 per page)\n    const workersOnCurrentPage = (currentRow * photosPerRow) + currentCol;\n    const needNewPageBySpace = bottomY < pageLimit;\n    const needNewPageByGrid = workersOnCurrentPage >= 9; // 3x3 = 9 workers max per page\n    \n    console.log(`  Workers on page: ${workersOnCurrentPage}, Need new page by grid: ${needNewPageByGrid}`);\n    \n    if (needNewPageBySpace || needNewPageByGrid) {\n      console.log(`  Adding new page for worker ${i+1}`);\n      await k.addPage(); // Header akan otomatis ditambahkan oleh addPage()\n      \n      currentRow = 0;\n      currentCol = 0;\n      const newY = startY - (currentRow * (photoHeight + marginVertical + nameSpacing));\n      // Recalculate x for new page\n      const newX = marginHorizontal + (currentCol * (photoWidth + marginHorizontal));\n      \n      // Draw on new page\n      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, newX, newY, photoWidth, photoHeight);\n    } else {\n      // Draw on current page\n      await drawWorkerCard(k.page, k.doc, k.font, k.bold, worker, x, y, photoWidth, photoHeight);\n    }\n\n    // Move to next position\n    currentCol++;\n    if (currentCol >= photosPerRow) {\n      currentCol = 0;\n      currentRow++;\n    }\n  }\n}\n\n/**\n * Draw individual worker card with photo and name\n */\nasync function drawWorkerCard(\n  page: any,\n  doc: PDFDocument,\n  font: PDFFont,\n  boldFont: PDFFont,\n  worker: { worker_name: string; worker_photo?: string | null },\n  x: number,\n  y: number,\n  photoWidth: number,\n  photoHeight: number\n) {\n  // Draw photo frame\n  page.drawRectangle({\n    x: x,\n    y: y - photoHeight,\n    width: photoWidth,\n    height: photoHeight,\n    borderColor: rgb(0.8, 0.8, 0.8),\n    borderWidth: 1,\n    color: rgb(0.98, 0.98, 0.98),\n  });\n\n  // Load and draw photo if available\n  if (worker.worker_photo) {\n    console.log('Worker has photo:', worker.worker_name, worker.worker_photo);\n    const photoImage = await loadWorkerPhoto(doc, worker.worker_photo);\n    if (photoImage) {\n      console.log('Photo loaded successfully for:', worker.worker_name);\n      // Calculate dimensions to maintain aspect ratio\n      const imgDims = photoImage.scale(1);\n      const imgAspectRatio = imgDims.width / imgDims.height;\n      const frameAspectRatio = photoWidth / photoHeight;\n      \n      let drawWidth = photoWidth - 10; // 5px padding on each side\n      let drawHeight = photoHeight - 10;\n      let drawX = x + 5;\n      let drawY = y - photoHeight + 5;\n      \n      // Adjust dimensions to fit within frame while maintaining aspect ratio\n      if (imgAspectRatio > frameAspectRatio) {\n        // Image is wider, fit to width\n        drawHeight = drawWidth / imgAspectRatio;\n        drawY = y - (photoHeight + drawHeight) / 2;\n      } else {\n        // Image is taller, fit to height\n        drawWidth = drawHeight * imgAspectRatio;\n        drawX = x + (photoWidth - drawWidth) / 2;\n      }\n      \n      page.drawImage(photoImage, {\n        x: drawX,\n        y: drawY,\n        width: drawWidth,\n        height: drawHeight,\n      });\n    } else {\n      console.log('Photo not loaded for:', worker.worker_name);\n      // Draw placeholder text if photo couldn't be loaded\n      page.drawText(\"Foto tidak\", { \n        x: x + photoWidth/2 - 25, \n        y: y - photoHeight/2 + 10, \n        size: 10, \n        font: font,\n        color: rgb(0.6, 0.6, 0.6) \n      });\n      page.drawText(\"tersedia\", { \n        x: x + photoWidth/2 - 20, \n        y: y - photoHeight/2 - 5, \n        size: 10, \n        font: font,\n        color: rgb(0.6, 0.6, 0.6) \n      });\n    }\n  } else {\n    console.log('Worker has no photo:', worker.worker_name);\n    // Draw placeholder for no photo\n    page.drawText(\"Tidak ada\", { \n      x: x + photoWidth/2 - 25, \n      y: y - photoHeight/2 + 10, \n      size: 10, \n      font: font,\n      color: rgb(0.6, 0.6, 0.6) \n    });\n    page.drawText(\"foto\", { \n      x: x + photoWidth/2 - 10, \n      y: y - photoHeight/2 - 5, \n      size: 10, \n      font: font,\n      color: rgb(0.6, 0.6, 0.6) \n    });\n  }\n\n  // Draw worker name below photo with reduced spacing\n  const nameY = y - photoHeight - 15; // Reduced from 15 to 8\n  const maxNameWidth = photoWidth - 4; // Leave 2px margin on each side\n  let displayName = worker.worker_name;\n  let textWidth = boldFont.widthOfTextAtSize(displayName, 9);\n  \n  // Truncate name if too long to fit in photo width\n  if (textWidth > maxNameWidth) {\n    while (textWidth > maxNameWidth && displayName.length > 0) {\n      displayName = displayName.substring(0, displayName.length - 4) + '...';\n      textWidth = boldFont.widthOfTextAtSize(displayName, 9);\n    }\n  }\n  \n  const nameX = x + (photoWidth - textWidth) / 2; // Center the name\n  \n  page.drawText(displayName, { \n    x: nameX, \n    y: nameY, \n    size: 9, // Reduced font size from 10 to 9\n    font: boldFont,\n    color: rgb(0, 0, 0)\n  });\n}\n"
    },
    {
      "path": "test-mobile-scanner.js",
      "lang": "js",
      "size": 3010,
      "lines": 80,
      "hash": "f556dfffb5986665e3b854ef17fc0a6f4ec2649272d709719af9fee74b563498",
      "truncated": false,
      "content": "// Test untuk memastikan scanner mobile sudah optimal\nconsole.log('📱 Testing mobile scanner configuration...\\n');\n\n// Simulasi mobile device\nconst mockMobile = {\n  userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15',\n  innerWidth: 375,\n  innerHeight: 667\n};\n\nconsole.log('🔧 Scanner Configuration Tests:');\n\n// Test 1: QR Box sizing for mobile\nconst qrBoxWidth = Math.min(250, mockMobile.innerWidth - 80);\nconst qrBoxHeight = Math.min(250, mockMobile.innerWidth - 80);\nconsole.log(`✓ QR Box Size: ${qrBoxWidth}x${qrBoxHeight}px (optimal for ${mockMobile.innerWidth}px screen)`);\n\n// Test 2: Video constraints for back camera\nconst videoConstraints = {\n  facingMode: \"environment\", // Force back camera\n  width: { ideal: 1280 },\n  height: { ideal: 720 }\n};\nconsole.log('✓ Video Constraints:', JSON.stringify(videoConstraints, null, 2));\n\n// Test 3: Disabled features\nconst disabledFeatures = {\n  showTorchButtonIfSupported: false,\n  showZoomSliderIfSupported: false,\n  rememberLastUsedCamera: false\n};\nconsole.log('✓ Disabled Features:', JSON.stringify(disabledFeatures, null, 2));\n\n// Test 4: CSS Selectors for hiding elements\nconst hiddenElements = [\n  'select',\n  '.html5-qrcode-camera-selection',\n  '.html5-qrcode-torch-button',\n  '.html5-qrcode-zoom-slider',\n  'button[title*=\"torch\"]',\n  'button[title*=\"flash\"]',\n  'button[title*=\"camera\"]',\n  'input[type=\"range\"]'\n];\nconsole.log('✓ Hidden UI Elements:');\nhiddenElements.forEach(selector => {\n  console.log(`   - ${selector}`);\n});\n\n// Test 5: Mobile-specific CSS rules\nconsole.log('\\n📱 Mobile-specific optimizations:');\nconsole.log('✓ Back camera enforced via facingMode: \"environment\"');\nconsole.log('✓ All camera selection UI completely hidden');\nconsole.log('✓ Torch/flash buttons disabled');\nconsole.log('✓ Zoom slider removed');\nconsole.log('✓ Video element optimized for mobile viewing');\nconsole.log('✓ No camera switching options available');\n\n// Test 6: Professional appearance\nconsole.log('\\n🎨 Professional Scanner Features:');\nconsole.log('✓ Clean UI with only video feed and QR overlay');\nconsole.log('✓ No confusing technical options for users');\nconsole.log('✓ Automatic back camera selection');\nconsole.log('✓ Responsive design for mobile screens');\nconsole.log('✓ Professional modal system for results');\n\nconsole.log('\\n🎯 Expected User Experience:');\nconsole.log('1. User clicks \"Mulai Scan QR Code\"');\nconsole.log('2. Scanner opens directly with back camera');\nconsole.log('3. Clean video feed with QR detection overlay');\nconsole.log('4. No camera selection or technical options visible');\nconsole.log('5. Scan result shows in professional modal');\nconsole.log('6. Simple \"Stop Scanning\" button to exit');\n\nconsole.log('\\n✅ Mobile scanner optimization completed!');\nconsole.log('   📷 Back camera enforced');\nconsole.log('   🎛️ All settings hidden');\nconsole.log('   📱 Mobile-optimized UI');\nconsole.log('   🎨 Professional appearance');\n"
    },
    {
      "path": "test-notification-cleanup.js",
      "lang": "js",
      "size": 3791,
      "lines": 112,
      "hash": "8f19ac2b6a0238bcfd8a9d4779dda74e76b986f9d190a0f2058a6a5e22c55838",
      "truncated": false,
      "content": "const { PrismaClient } = require('@prisma/client');\nconst prisma = new PrismaClient();\n\nasync function testNotificationCleanup() {\n  try {\n    console.log('🧪 Testing notification cleanup functionality...');\n    \n    // Get all notifications to see their structure\n    const allNotifications = await prisma.notification.findMany({\n      take: 5,\n      orderBy: { created_at: 'desc' }\n    });\n    \n    console.log('\\n📋 Sample notifications:');\n    allNotifications.forEach((notif, index) => {\n      console.log(`${index + 1}. ID: ${notif.id}`);\n      console.log(`   Type: ${notif.type}`);\n      console.log(`   Title: ${notif.title}`);\n      console.log(`   Message: ${notif.message}`);\n      console.log(`   Data: ${notif.data}`);\n      console.log(`   Created: ${notif.created_at}`);\n      console.log('   ---');\n    });\n    \n    // Test the cleanup function logic\n    console.log('\\n🔍 Testing cleanup logic...');\n    \n    // Find notifications that reference submissions\n    const submissionNotifications = await prisma.notification.findMany({\n      where: {\n        OR: [\n          { data: { contains: 'submissionId' } },\n          { data: { contains: 'submission_id' } },\n          { message: { contains: 'ID' } },\n          { title: { contains: 'ID' } }\n        ]\n      }\n    });\n    \n    console.log(`\\n📊 Found ${submissionNotifications.length} notifications that might reference submissions:`);\n    \n    submissionNotifications.forEach((notif, index) => {\n      console.log(`${index + 1}. ${notif.type} - ${notif.title}`);\n      \n      // Try to extract submission ID\n      let submissionId = null;\n      if (notif.data) {\n        try {\n          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;\n          submissionId = data.submissionId || data.submission_id;\n        } catch (e) {\n          console.log(`   ❌ Error parsing data: ${e.message}`);\n        }\n      }\n      \n      // Extract from message/title\n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notif.message.match(idPattern);\n        const titleMatch = notif.title.match(idPattern);\n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n      }\n      \n      console.log(`   Submission ID: ${submissionId || 'Not found'}`);\n      console.log(`   Data: ${JSON.stringify(notif.data)}`);\n    });\n    \n    // Test if any referenced submissions exist\n    console.log('\\n🔍 Checking if referenced submissions still exist...');\n    \n    for (const notif of submissionNotifications) {\n      let submissionId = null;\n      \n      if (notif.data) {\n        try {\n          const data = typeof notif.data === 'string' ? JSON.parse(notif.data) : notif.data;\n          submissionId = data.submissionId || data.submission_id;\n        } catch (e) {\n          // ignore\n        }\n      }\n      \n      if (!submissionId) {\n        const idPattern = /ID[:\\s]+([a-zA-Z0-9]+)/i;\n        const messageMatch = notif.message.match(idPattern);\n        const titleMatch = notif.title.match(idPattern);\n        submissionId = messageMatch?.[1] || titleMatch?.[1];\n      }\n      \n      if (submissionId) {\n        const submission = await prisma.submission.findUnique({\n          where: { id: submissionId }\n        });\n        \n        if (!submission) {\n          console.log(`❌ Notification ${notif.id} references missing submission: ${submissionId}`);\n          console.log(`   Type: ${notif.type}, Title: ${notif.title}`);\n        } else {\n          console.log(`✅ Notification ${notif.id} references existing submission: ${submissionId}`);\n        }\n      }\n    }\n    \n  } catch (error) {\n    console.error('❌ Error during test:', error);\n  } finally {\n    await prisma.$disconnect();\n  }\n}\n\ntestNotificationCleanup();\n"
    },
    {
      "path": "test-qr-optimization.js",
      "lang": "js",
      "size": 2009,
      "lines": 49,
      "hash": "3317fa2c84b3a36c923b837ebb2d54da5381db6d754cd91c0638090d976bfab0",
      "truncated": false,
      "content": "// Test file to compare QR code lengths\nimport { generateQrString } from './src/lib/qr-security.js';\n\n// Sample submission data\nconst sampleSubmission = {\n  id: 'cmf9wfenv0002sid11tsws75w',\n  implementation_start_date: '2025-09-16',\n  implementation_end_date: '2025-09-30'\n};\n\n// Generate new ultra-compact QR\nconst newQrString = generateQrString(sampleSubmission);\n\nconsole.log('=== QR CODE OPTIMIZATION COMPARISON ===\\n');\n\nconsole.log('🔍 BEFORE (Old Base64 + JSON format):');\nconsole.log('Format: SL|eyJpZCI6InN1Ym1pc3Npb25JZCIsImV4cCI6MTcyNjQ5MjA4Mjg4MSwic2lnIjoiYWJjZGVmZ2gifQ==');\nconsole.log('Length: ~80-100+ characters');\nconsole.log('Structure: SL + | + base64(JSON)');\n\nconsole.log('\\n✅ AFTER (New Colon-separated format):');\nconsole.log(`Format: ${newQrString}`);\nconsole.log(`Length: ${newQrString.length} characters`);\nconsole.log('Structure: SL + : + submissionId + : + expiration + : + 6charSignature');\n\nconsole.log('\\n📊 OPTIMIZATION RESULTS:');\nconst oldApproxLength = 85; // Conservative estimate\nconst newLength = newQrString.length;\nconst reduction = oldApproxLength - newLength;\nconst percentReduction = Math.round((reduction / oldApproxLength) * 100);\n\nconsole.log(`• Old length: ~${oldApproxLength} characters`);\nconsole.log(`• New length: ${newLength} characters`);\nconsole.log(`• Reduction: ${reduction} characters (${percentReduction}% smaller)`);\n\nconsole.log('\\n🎯 QR CODE SCANNING BENEFITS:');\nconsole.log('• Simpler pattern = easier to scan');\nconsole.log('• Shorter string = more reliable scanning');\nconsole.log('• Less dense QR code = better mobile camera recognition');\nconsole.log('• Faster processing = quicker verification');\n\nconsole.log('\\n🔒 SECURITY MAINTAINED:');\nconsole.log('• 6-character signature still provides good security');\nconsole.log('• Expiration timestamp prevents replay attacks');\nconsole.log('• Salt-based hashing prevents tampering');\nconsole.log('• Backward compatibility with old format maintained');\n\nexport {};\n"
    },
    {
      "path": "test-qr-parsing.js",
      "lang": "js",
      "size": 1500,
      "lines": 44,
      "hash": "0e02abd226d27a7dd004ed39d781d974a14a96517c87d7052d550545c45cf42a",
      "truncated": false,
      "content": "// Test QR parsing functionality\nimport { generateQrString, parseQrString } from './src/lib/qr-security.js';\n\nconst sampleSubmission = {\n  id: 'cmf9wfenv0002sid11tsws75w',\n  implementation_start_date: '2025-09-16',\n  implementation_end_date: '2025-09-30'\n};\n\nconsole.log('=== QR PARSING TEST ===\\n');\n\n// Generate QR\nconst qrString = generateQrString(sampleSubmission);\nconsole.log('1. Generated QR String:');\nconsole.log(`   ${qrString}`);\nconsole.log(`   Length: ${qrString.length} characters\\n`);\n\n// Parse QR\nconst parsed = parseQrString(qrString);\nconsole.log('2. Parsed QR Data:');\nconsole.log('   Success:', parsed !== null);\nif (parsed) {\n  console.log(`   ID: ${parsed.id}`);\n  console.log(`   Start Date: ${parsed.start_date}`);\n  console.log(`   End Date: ${parsed.end_date}`);\n  console.log(`   Timestamp: ${new Date(parsed.timestamp).toISOString()}`);\n}\n\n// Test backward compatibility with old format\nconsole.log('\\n3. Testing Backward Compatibility:');\nconst oldFormatQR = 'SL|eyJpIjoiY21mOXdmZW52MDAwMnNpZDExdHN3czc1dyIsImUiOjE3MjY0OTIwODI4ODEsInMiOiJiNWQ1YmQifQ==';\nconst parsedOld = parseQrString(oldFormatQR);\nconsole.log('   Old format parsing success:', parsedOld !== null);\n\n// Test raw submission ID compatibility  \nconsole.log('\\n4. Testing Raw ID Compatibility:');\nconst rawId = 'cmf9wfenv0002sid11tsws75w';\nconst parsedRaw = parseQrString(rawId);\nconsole.log('   Raw ID parsing success:', parsedRaw !== null);\n\nconsole.log('\\n✅ All parsing tests completed!');\n\nexport {};\n"
    },
    {
      "path": "test-simplified-qr.js",
      "lang": "js",
      "size": 1385,
      "lines": 37,
      "hash": "7d6c8098bb146fe33e22b07d12916e84e4c4c26ab88fdcfe02ead4a27e87da6b",
      "truncated": false,
      "content": "/**\n * Simple test script to generate a QR code with the new simplified format\n * Run this with: node test-simplified-qr.js\n */\n\nconst { generateQrString } = require('./src/lib/qr-security.ts');\n\n// Test submission data\nconst testSubmission = {\n  id: 'test-submission-123',\n  implementation_start_date: new Date('2024-01-15'),\n  implementation_end_date: new Date('2024-01-30')\n};\n\ntry {\n  const qrString = generateQrString(testSubmission);\n  console.log('Generated QR String:', qrString);\n  console.log('QR String Length:', qrString.length);\n  console.log('QR String Size in Bytes:', Buffer.byteLength(qrString, 'utf8'));\n  \n  // For comparison, let's see how much shorter this is\n  const oldFormatExample = `SIMLOK|${Buffer.from(JSON.stringify({\n    id: testSubmission.id,\n    start_date: testSubmission.implementation_start_date.toISOString(),\n    end_date: testSubmission.implementation_end_date.toISOString(),\n    timestamp: Date.now()\n  }), 'utf8').toString('base64')}|${crypto.createHash('sha256').update('test').digest('hex')}`;\n  \n  console.log('\\nComparison:');\n  console.log('New format length:', qrString.length);\n  console.log('Old format would be:', oldFormatExample.length);\n  console.log('Reduction:', ((oldFormatExample.length - qrString.length) / oldFormatExample.length * 100).toFixed(1) + '%');\n  \n} catch (error) {\n  console.error('Error generating QR:', error);\n}\n"
    },
    {
      "path": "tsconfig.json",
      "lang": "json",
      "size": 1096,
      "lines": 41,
      "hash": "34d3c70369d02d87167829c2e4a0f2efd8efe607f193d4cd3f49731890826fa0",
      "truncated": false,
      "content": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2017\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"preserve\",\n    \"incremental\": true,\n    \"baseUrl\": \".\",\n    \"plugins\": [\n      {\n        \"name\": \"next\"\n      }\n    ],\n    \"paths\": {\n      \"@/*\": [\"./src/*\"],\n      \"@/components/*\": [\"./src/components/*\"],\n      \"@/lib/*\": [\"./src/lib/*\"],\n      \"@/types/*\": [\"./src/types/*\"],\n      \"@/hooks/*\": [\"./src/hooks/*\"],\n      \"@/utils/*\": [\"./src/utils/*\"],\n      \"@/server/*\": [\"./src/server/*\"]\n    },\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"exactOptionalPropertyTypes\": true,\n    \"noImplicitReturns\": true,\n    \"noFallthroughCasesInSwitch\": true,\n    \"noUncheckedIndexedAccess\": true\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\"],\n  \"exclude\": [\"node_modules\", \"dist\", \".next\", \"coverage\"]\n}\n"
    }
  ]
}